"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[41872],{64581:function(e,l){l.Z={src:"/_next/static/media/imgSerials.d1ee59bb.png",height:17,width:23,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAGCAMAAADJ2y/JAAAAIVBMVEUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABt0UjBAAAAC3RSTlMCZzsmQ6RbWbaSTwNdgTwAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAArSURBVHicY2BiZ2BgYOBiZmBmYmRjZGRhYGBg4eBkZWVDYjAzMbKDpWCKARB/AJwjPQgCAAAAAElFTkSuQmCC",blurWidth:8,blurHeight:6}},41872:function(e,l,n){n.d(l,{Z:function(){return el}});var d=n(52322),t=n(29326),i=n(9522),a=n(2784),r=n(89330),o=n(39812),s=n(60218),u=n(48601),c=n(82737),m=n(62202),v=n(65950),p=n(26612),x=n(5088),h=n(21581),f=n(8661),I=n(38449),y=n(65215),b=n(7121),g=n(27423),j=n(31389),C=n(33625),k=n(22341),F=n(80983),w=n(39704),A=n(61802),Z=n(19473),N=n(98345),R=n(90587),V=n(91406),P=n(2801),O=n(62362),D=n(21326),S=n(69387),q=n(71987);function J(e){var l;let{labels:n,maxAccess:t,api:i,parameters:r,window:o}=e,{getRequest:u}=(0,a.useContext)(v.$),{platformLabels:c}=(0,a.useContext)(Z.l);(0,D.Z)({title:c.serials,window:o});let m=[{field:"srlSeqNo",flex:.5,headerName:n.rowCount},{field:"srlNo",flex:1,headerName:n.srlNo},{field:"weight",flex:1,headerName:n.weight,type:"number"}],{query:{data:x},refetch:h}=(0,q.J)({queryFn:f,endpointId:i,datasetId:p.i.MFJobOrders,params:{disabledReqParams:!0,maxAccess:t}});async function f(){return await u({extension:i,parameters:r})}let I=null==x?void 0:null===(l=x.list)||void 0===l?void 0:l.reduce((e,l)=>e+l.weight,0);return(0,d.jsxs)(j.R,{children:[(0,d.jsx)(O.Q,{children:(0,d.jsx)(S.Z,{columns:m,gridData:x,rowId:["recordId"],maxAccess:t,refetch:h,pageSize:50,paginationType:"client"})}),(0,d.jsx)(C.g,{children:(0,d.jsx)(s.ZP,{container:!0,spacing:2,children:(0,d.jsx)(s.ZP,{item:!0,xs:4,sx:{p:2,ml:2},children:(0,d.jsx)(V.Z,{name:"totalWeight",label:n.totWeight,value:I,readOnly:!0})})})})]})}J.width=680,J.height=600;var W=n(23361),z=n(76399),M=n(54074);function _(e){var l,n,t,i;let{labels:r,maxAccess:o,recordId:c}=e,{postRequest:p,getRequest:x}=(0,a.useContext)(v.$),{platformLabels:h}=(0,a.useContext)(Z.l),f=!!c,{formik:I}=(0,F.c)({validateOnChange:!0,initialValues:{jobId:c,data:[{id:1,jobId:c,seqNo:1,itemWeight:0}]},validationSchema:u.Ry({data:u.IX().of(u.Ry({itemWeight:u.Z_().test("check-value","itemWeight must be at least 0.01",function(e){return!!e&&!(e<=0)})}))}),onSubmit:async e=>{let l=e.data.filter(e=>e.itemWeight).map((e,l)=>({...e,seqNo:l+1,jobId:c}));await p({extension:R.u.SamplePack.set2,record:JSON.stringify({jobId:c,data:l})}),m.ZP.success(h.Edited)}}),y=e=>{let l=e.length!==I.values.data.length?e.map((e,l)=>({...e,seqNo:l+1})):e;I.setFieldValue("data",l)},b=I.values.data.filter(e=>e.itemWeight>0),g=b.reduce((e,l)=>{var n;return e+(parseFloat(null==l?void 0:null===(n=l.itemWeight)||void 0===n?void 0:n.toString().replace(/,/g,""))||0)},0),k=b.length>0?g/b.length:0,w=b.length,A=[{component:"numberfield",label:r.seqNo,name:"seqNo",props:{readOnly:!0}},{component:"numberfield",label:r.itemWgt,name:"itemWeight",flex:2}];async function N(){var e,l;let n=await x({extension:R.u.SamplePack.qry,parameters:"_jobId=".concat(c,"&_filter=")}),d=(null==n?void 0:null===(e=n.list)||void 0===e?void 0:e.length)!=0?await Promise.all(null==n?void 0:null===(l=n.list)||void 0===l?void 0:l.map(async(e,l)=>({...e,id:l+1,itemWeight:(null==e?void 0:e.itemWeight)||0}))):[{id:1,itemWeight:0,seqNo:1}];I.setValues({jobId:c,data:d})}return(0,a.useEffect)(()=>{c&&N()},[c]),(0,d.jsx)(M.Z,{onSave:I.handleSubmit,maxAccess:o,editMode:f,children:(0,d.jsxs)(j.R,{children:[(0,d.jsx)(O.Q,{children:(0,d.jsx)(z._,{value:null===(l=I.values)||void 0===l?void 0:l.data,error:null===(n=I.errors)||void 0===n?void 0:n.data,onChange:e=>y(e),initialValues:null==I?void 0:null===(i=I.initialValues)||void 0===i?void 0:null===(t=i.data)||void 0===t?void 0:t[0],columns:A,name:"data",maxAccess:o})}),(0,d.jsx)(C.g,{children:(0,d.jsxs)(s.ZP,{container:!0,sx:{pt:2},children:[(0,d.jsx)(s.ZP,{item:!0,xs:4,children:(0,d.jsx)(V.Z,{name:"avgWeight",label:r.average,value:k,readOnly:!0})}),(0,d.jsx)(s.ZP,{item:!0,xs:4,children:(0,d.jsx)(V.Z,{name:"totalCount",label:r.totalCount,value:w,readOnly:!0})}),(0,d.jsx)(s.ZP,{item:!0,xs:4,children:(0,d.jsx)(V.Z,{name:"totWeight",label:r.totWeight,value:g,readOnly:!0})})]})})]})})}var T=n(63518),Q=n(78618),E=n(58276);function U(e){var l,n,t,i,O,D,S,q,z,M;let{labels:U,maxAccess:L,setStore:B,store:$,setRefetchRouting:G,invalidate:Y,lockRecord:K,refetchJob:H,setRefetchJob:X,window:ee}=e,{getRequest:el,postRequest:en}=(0,a.useContext)(v.$),{stack:ed}=(0,A.zY)(),{platformLabels:et}=(0,a.useContext)(Z.l),ei=(0,a.useRef)(null),ea=null==$?void 0:$.recordId,[er,eo]=(0,a.useState)(null),[es,eu]=(0,a.useState)({recordId:null,resourceId:null}),{addLockedScreen:ec}=(0,a.useContext)(E.Z),{documentType:em,maxAccess:ev,changeDT:ep}=(0,N.H)({functionId:b.J.JobOrder,access:L,enabled:!ea}),ex={recordId:ea||null,dtId:null,reference:null,date:new Date,plantId:null,designId:null,workCenterId:null,itemId:null,sku:null,itemName:null,clientId:null,routingId:null,routingSeqNo:null,startingDT:null,endingDT:null,description:"",weight:0,qty:0,pcs:0,stdWeight:0,netSerialsWeight:0,producedWgt:0,expectedQty:0,expectedPcs:0,RMCost:0,deliveryDate:null,spId:null,sizeId:null,lineId:null,itemsPL:null,designPL:null,trackBy:null,avgWeight:0,categoryId:null,itemCategoryId:null,classId:null,standardId:null,rubberId:null,threeDDId:null,status:1,itemFromDesign:!1,standardCost:null},{formik:eh}=(0,F.c)({maxAccess:ev,documentType:{key:"dtId",value:null==em?void 0:em.dtId},initialValues:ex,validationSchema:u.Ry({date:u.Z_().required(),expectedQty:u.Rx().required(),expectedPcs:u.Rx().moreThan(0).required(),workCenterId:u.Rx().required()}),onSubmit:async e=>{let l={...e};l.qty||delete l.qty;let n=await en({extension:R.u.MFJobOrder.set,record:JSON.stringify({...l,date:(null==l?void 0:l.date)?(0,o.ku)(null==l?void 0:l.date):null,endingDT:(null==l?void 0:l.endingDT)?(0,o.ku)(null==l?void 0:l.endingDT):null,startingDT:(null==l?void 0:l.startingDT)?(0,o.ku)(null==l?void 0:l.startingDT):null,deliveryDate:(null==l?void 0:l.deliveryDate)?(0,o.ku)(null==l?void 0:l.deliveryDate):null})});ei.current&&(ei.current.value=parseInt(n.recordId),await ei.current.submit()),Y();let d=ef?et.Edited:et.Added;m.ZP.success(d),B(e=>({...e,recordId:null==n?void 0:n.recordId}));let t=await eZ(n.recordId);ee.setTitle&&!ef&&ee.setTitle(t?"".concat(U.jobOrder," ").concat(t):U.jobOrder)}}),ef=!!eh.values.recordId,eI=-1==eh.values.status,ey=4==eh.values.status,eb=3==eh.values.status,eg=[{key:"Locked",condition:eb,onClick:"onUnpostConfirmation",disabled:!0},{key:"Unlocked",condition:!eb,onClick:eF,disabled:!ef||eb||eI},{key:"RecordRemarks",condition:!0,onClick:"onRecordRemarks",disabled:!ef},{key:"Cancel",condition:!0,onClick:()=>{eA(et.CancelConf,et.Confirmation,ek)},disabled:!ef||eI||eb},{key:"WorkFlow",condition:!0,onClick:ew,disabled:!ef},{key:"GL",condition:!0,onClick:"onClickGL",datasetId:p.i.GLMFJobOrders,disabled:!ef,error:(null==eh?void 0:null===(l=eh.values)||void 0===l?void 0:l.endingDT)?null:{message:U.emptyEndingDate},values:{...eh.values,date:null==eh?void 0:null===(n=eh.values)||void 0===n?void 0:n.endingDT,notes:null==eh?void 0:null===(t=eh.values)||void 0===t?void 0:t.description}},{key:"IV",condition:!0,onClick:"onInventoryTransaction",disabled:!ef||!eb},{key:"SerialsLots",condition:!0,onClick:function(){ed({Component:J,props:{labels:U,maxAccess:ev,api:R.u.MFSerial.qry,parameters:"_jobId=".concat(ea)}})}},{key:"Start",condition:!ey,onClick:()=>{eA(et.StartRecord,et.Confirmation,ej)},disabled:!ef||ey||eb||eI},{key:"Stop",condition:ey,onClick:()=>{eA(et.StopRecord,et.Confirmation,eC)},disabled:!ef||!ey||eb},{key:"Sample",condition:!0,onClick:function(){ed({Component:_,props:{labels:U,maxAccess:ev,recordId:eh.values.recordId,itemId:eh.values.itemId},width:500,height:600,title:U.samples})},disabled:(!ef||!ey||!eb)&&!(ey||eb)}];async function ej(){var e;if((null===(e=Object.keys(null==eh?void 0:eh.errors))||void 0===e?void 0:e.length)>0){eq();return}let l=await en({extension:R.u.MFJobOrder.start,record:JSON.stringify({...eh.values,date:(0,o.ku)(eh.values.date),deliveryDate:eh.values.deliveryDate?(0,o.ku)(eh.values.deliveryDate):null})});m.ZP.success(et.Started),Y(),await eZ(l.recordId),G(!0)}async function eC(){var e;if((null===(e=Object.keys(null==eh?void 0:eh.errors))||void 0===e?void 0:e.length)>0){eq();return}let l=await en({extension:R.u.MFJobOrder.stop,record:JSON.stringify({...eh.values,date:(0,o.ku)(eh.values.date),deliveryDate:eh.values.deliveryDate?(0,o.ku)(eh.values.deliveryDate):null})});m.ZP.success(et.Stoped),Y(),await eZ(l.recordId),G(!0)}async function ek(){let e=await en({extension:R.u.MFJobOrder.cancel,record:JSON.stringify({...eh.values,date:(0,o.ku)(eh.values.date),deliveryDate:eh.values.deliveryDate?(0,o.ku)(eh.values.deliveryDate):null})});m.ZP.success(et.Cancelled),Y(),await eZ(e.recordId),B(e=>({...e,isCancelled:!0}))}async function eF(){let e=await en({extension:R.u.MFJobOrder.post,record:JSON.stringify({...eh.values,date:(0,o.ku)(eh.values.date),deliveryDate:eh.values.deliveryDate?(0,o.ku)(eh.values.deliveryDate):null})});m.ZP.success(et.Posted),K({recordId:e.recordId,reference:eh.values.reference,resourceId:p.i.MFJobOrders,onSuccess:()=>{ec({resourceId:p.i.MFJobOrders,recordId:e.recordId,reference:eh.values.reference}),eZ(e.recordId),B(e=>({...e,isPosted:!0}))},isAlreadyLocked:e=>{ee.close(),ed({Component:Q.Z,props:{DialogText:"".concat(et.RecordLocked," ").concat(e),width:600,height:200,title:et.Dialog}})}}),Y()}async function ew(){ed({Component:w.Z,props:{functionId:b.J.JobOrder,recordId:eh.values.recordId}})}function eA(e,l,n){ed({Component:W.Z,props:{DialogText:e,okButtonAction:async()=>{await n()},fullScreen:!1,close:!0},width:400,height:150,title:l})}async function eZ(e){if(!e)return;let l=await el({extension:R.u.MFJobOrder.get2,parameters:"_recordId=".concat(e)}),{jobOrder:n,...d}=(null==l?void 0:l.record)||{};return eh.setValues({...n,date:(0,o.a1)(null==n?void 0:n.date),endingDT:(0,o.a1)(null==n?void 0:n.endingDT),startingDT:(0,o.a1)(null==n?void 0:n.startingDT),deliveryDate:(0,o.a1)(null==n?void 0:n.deliveryDate)}),B(e=>({...e,recordId:null==n?void 0:n.recordId,isPosted:(null==n?void 0:n.status)==3,jobReference:null==n?void 0:n.reference,isCancelled:(null==n?void 0:n.status)==-1,status:null==n?void 0:n.status,routingId:(null==n?void 0:n.routingId)||null,...d})),eh.values.recordId||K({recordId:null==n?void 0:n.recordId,reference:null==n?void 0:n.reference,resourceId:p.i.MFJobOrders,onSuccess:()=>{ec({resourceId:p.i.MFJobOrders,recordId:null==n?void 0:n.recordId,reference:null==n?void 0:n.reference})}}),null==n?void 0:n.reference}async function eN(e){if(e)return await el({extension:R.u.Routing.get,parameters:"_recordId=".concat(e)})}async function eR(e){var l,n,d,t,i;if(2==er&&eS(e.recordId,er),!(null==e?void 0:e.recordId)){eh.setFieldValue("itemId",null),eh.setFieldValue("itemName",null),eh.setFieldValue("sku",null),eh.setFieldValue("itemsPL",null),eh.setFieldValue("stdWeight",null),eh.setFieldValue("itemCategoryId",null),eh.setFieldValue("itemFromDesign",!1);return}let a=await el({extension:y.$.Physical.get,parameters:"_itemId=".concat(null==e?void 0:e.recordId)}),r=await el({extension:y.$.ItemProduction.get,parameters:"_recordId=".concat(null==e?void 0:e.recordId)});eh.setFieldValue("itemId",null==e?void 0:e.recordId),eh.setFieldValue("itemName",null==e?void 0:e.name),eh.setFieldValue("sku",null==e?void 0:e.sku),eh.setFieldValue("stdWeight",null==a?void 0:null===(l=a.record)||void 0===l?void 0:l.weight),eh.setFieldValue("expectedQty",(null==a?void 0:null===(n=a.record)||void 0===n?void 0:n.weight)&&eh.values.expectedPcs?eh.values.expectedPcs*(null==a?void 0:null===(d=a.record)||void 0===d?void 0:d.weight):0),eh.setFieldValue("itemsPL",null==r?void 0:null===(t=r.record)||void 0===t?void 0:t.lineId),eh.setFieldValue("lineId",null==r?void 0:null===(i=r.record)||void 0===i?void 0:i.lineId),eh.setFieldValue("itemCategoryId",null==e?void 0:e.categoryId)}async function eV(e){if(1==er?eS(e.recordId,er):2==er&&eS(e.itemId,er),eh.setFieldValue("designId",(null==e?void 0:e.recordId)||null),eh.setFieldValue("designRef",(null==e?void 0:e.reference)||""),eh.setFieldValue("designName",(null==e?void 0:e.name)||""),eh.setFieldValue("stdWeight",null==e?void 0:e.stdWeight),eh.setFieldValue("expectedQty",(null==e?void 0:e.stdWeight)&&eh.values.expectedPcs?eh.values.expectedPcs*(null==e?void 0:e.stdWeight):0),!ey){var l;let n=await eN(null==e?void 0:e.routingId);(null==n?void 0:null===(l=n.record)||void 0===l?void 0:l.isInactive)?(eh.setFieldValue("routingId",null),eh.setFieldValue("routingRef",null),eh.setFieldValue("routingName",null)):(eh.setFieldValue("routingId",(null==e?void 0:e.routingId)||null),eh.setFieldValue("routingRef",null==e?void 0:e.routingRef),eh.setFieldValue("routingName",null==e?void 0:e.routingName))}eh.setFieldValue("lineId",null==e?void 0:e.lineId),eh.setFieldValue("designPL",null==e?void 0:e.lineId),eh.setFieldValue("classId",null==e?void 0:e.classId),eh.setFieldValue("standardId",null==e?void 0:e.standardId),eh.setFieldValue("itemCategoryId",(null==e?void 0:e.itemCategoryId)||null),eh.setFieldValue("threeDDId",null==e?void 0:e.threeDDId),eh.setFieldValue("threeDDRef",null==e?void 0:e.threeDDRef),eh.setFieldValue("rubberId",null==e?void 0:e.rubberId),eh.setFieldValue("rubberRef",null==e?void 0:e.rubberRef),eh.setFieldValue("itemId",null==e?void 0:e.itemId),eh.setFieldValue("itemName",null==e?void 0:e.itemName),eh.setFieldValue("sku",null==e?void 0:e.sku)}async function eP(e){var l;if(!(null==e?void 0:e.recordId))return;let n=await el({extension:k.P.Address.qry,parameters:"_params=1|".concat(e.recordId)});return await eO(null==n?void 0:null===(l=n.list[0])||void 0===l?void 0:l.addressId)}async function eO(e){var l;if(!e)return null;let n=await el({extension:I.r.Address.format,parameters:"_addressId=".concat(e)});return null==n?void 0:null===(l=n.record)||void 0===l?void 0:l.formattedAddress.replace(/(\r\n|\r|\n)+/g,"\r\n")}async function eD(e,l){var n,d,t;if(!e){l||(eh.setFieldValue("wcRef",null),eh.setFieldValue("wcName",null),eh.setFieldValue("workCenterId",null));return}let i=await el({extension:R.u.RoutingSequence.qry,parameters:"_routingId=".concat(e)});eh.setFieldValue("wcRef",(null==i?void 0:null===(n=i.list[0])||void 0===n?void 0:n.workCenterRef)||""),eh.setFieldValue("wcName",(null==i?void 0:null===(d=i.list[0])||void 0===d?void 0:d.workCenterName)||""),eh.setFieldValue("workCenterId",(null==i?void 0:null===(t=i.list[0])||void 0===t?void 0:t.workCenterId)||null)}function eS(e,l){eu({recordId:e,resourceId:1==l?p.i.Design:2==l?p.i.Item:3==l?p.i.MFJobOrders:null})}async function eq(){if(Object.keys(await eh.validateForm()).length){let e=Object.keys(await eh.validateForm()).reduce((e,l)=>(eh.touched[l]||(e[l]=!0),e),{});Object.keys(e).length&&eh.setTouched(e,!0)}}return(0,a.useEffect)(()=>{!async function(){if(!ef){if(eh.values.dtId){var e;let l=await el({extension:R.u.DocumentTypeDefault.get,parameters:"_dtId=".concat(eh.values.dtId)});eh.setFieldValue("plantId",(null==l?void 0:null===(e=l.record)||void 0===e?void 0:e.plantId)||null)}else eh.setFieldValue("plantId",null)}}()},[eh.values.dtId]),(0,a.useEffect)(()=>{ea&&H&&eZ(ea),X(!1)},[H]),(0,a.useEffect)(()=>{!async function(){var e;let l=await el({extension:I.r.Defaults.get,parameters:"_filter=&_key=mf_jo_pic_source"});eo((null==l?void 0:null===(e=l.record)||void 0===e?void 0:e.value)||3),ea&&await eZ(ea)}()},[]),(0,d.jsx)(c.Z,{resourceId:p.i.MFJobOrders,functionId:b.J.JobOrder,form:eh,maxAccess:ev,previewReport:ef,actions:eg,editMode:ef,disabledSubmit:eI||eb,disabledSavedClear:eI||eb,children:(0,d.jsx)(j.R,{children:(0,d.jsx)(C.g,{children:(0,d.jsxs)(s.ZP,{container:!0,children:[(0,d.jsxs)(s.ZP,{container:!0,spacing:2,xs:8,children:[(0,d.jsx)(s.ZP,{item:!0,xs:12,children:(0,d.jsx)(f.Z,{endpointId:R.u.MFJobOrder.pack,reducer:e=>{var l;return null==e?void 0:null===(l=e.record)||void 0===l?void 0:l.documentTypes},name:"dtId",label:U.documentType,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],readOnly:ef,valueField:"recordId",displayField:["reference","name"],values:eh.values,maxAccess:ev,onChange:(e,l)=>{eh.setFieldValue("dtId",null==l?void 0:l.recordId),ep(l)},error:eh.touched.dtId&&!!eh.errors.dtId})}),(0,d.jsxs)(s.ZP,{container:!0,item:!0,xs:12,spacing:2,children:[(0,d.jsx)(s.ZP,{item:!0,xs:6,children:(0,d.jsxs)(s.ZP,{container:!0,direction:"column",spacing:2,children:[(0,d.jsx)(s.ZP,{item:!0,children:(0,d.jsx)(x.Z,{name:"reference",label:U.reference,value:null==eh?void 0:null===(i=eh.values)||void 0===i?void 0:i.reference,maxAccess:!ef&&ev,readOnly:ef,onChange:eh.handleChange,onClear:()=>eh.setFieldValue("reference",""),error:eh.touched.reference&&!!eh.errors.reference})}),(0,d.jsx)(s.ZP,{item:!0,children:(0,d.jsx)(r.Z,{name:"date",required:!0,readOnly:!0,label:U.date,value:null==eh?void 0:null===(O=eh.values)||void 0===O?void 0:O.date,editMode:ef,maxAccess:ev})}),(0,d.jsx)(s.ZP,{item:!0,children:(0,d.jsx)(r.Z,{name:"startingDT",label:U.startingDate,value:null==eh?void 0:null===(D=eh.values)||void 0===D?void 0:D.startingDT,onChange:eh.setFieldValue,editMode:ef,maxAccess:ev,readOnly:!0})}),(0,d.jsx)(s.ZP,{item:!0,children:(0,d.jsx)(r.Z,{name:"endingDT",readOnly:!0,label:U.endingDate,value:null==eh?void 0:null===(S=eh.values)||void 0===S?void 0:S.endingDT,editMode:ef,maxAccess:ev})}),(0,d.jsx)(s.ZP,{item:!0,children:(0,d.jsx)(r.Z,{name:"deliveryDate",readOnly:eI||ey||eb,label:U.deliveryDate,value:null==eh?void 0:null===(q=eh.values)||void 0===q?void 0:q.deliveryDate,onChange:eh.setFieldValue,editMode:ef,maxAccess:ev,onClear:()=>eh.setFieldValue("deliveryDate",null),error:eh.touched.deliveryDate&&!!eh.errors.deliveryDate})}),(0,d.jsx)(s.ZP,{item:!0,xs:12,children:(0,d.jsx)(f.Z,{endpointId:R.u.MFJobOrder.pack,reducer:e=>{var l;return null==e?void 0:null===(l=e.record)||void 0===l?void 0:l.plants},name:"plantId",label:et.plant,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"plant Ref"},{key:"name",value:"Name"}],values:eh.values,readOnly:eI||eb,onChange:(e,l)=>{eh.setFieldValue("plantId",(null==l?void 0:l.recordId)||null)},error:eh.touched.plantId&&!!eh.errors.plantId})}),(0,d.jsx)(s.ZP,{item:!0,children:(0,d.jsx)(g.U,{endpointId:y.$.Item.snapshot,name:"itemId",readOnly:eI||eb,label:U.item,valueField:"sku",displayField:"sku",valueShow:"sku",secondValueShow:"itemName",columnsInDropDown:[{key:"sku",value:"SKU"},{key:"name",value:"Name"}],form:eh,displayFieldWidth:2,onChange:async(e,l)=>{if(ey){eh.setFieldValue("itemId",(null==l?void 0:l.recordId)||null),eh.setFieldValue("itemName",(null==l?void 0:l.name)||""),eh.setFieldValue("sku",(null==l?void 0:l.sku)||"");return}await eR(l)},errorCheck:"itemId",maxAccess:ev})}),(0,d.jsx)(s.ZP,{item:!0,children:(0,d.jsx)(f.Z,{endpointId:R.u.MFJobOrder.pack,reducer:e=>{var l;return null==e?void 0:null===(l=e.record)||void 0===l?void 0:l.itemSizes},name:"sizeId",label:U.size,readOnly:eI||ey||eb,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:eh.values,valueField:"recordId",displayField:["reference","name"],maxAccess:ev,onChange:(e,l)=>{eh.setFieldValue("sizeId",null==l?void 0:l.recordId)},error:eh.touched.sizeId&&!!eh.errors.sizeId})}),(0,d.jsx)(s.ZP,{item:!0,children:(0,d.jsx)(V.Z,{name:"expectedQty",label:U.expectedQty,value:eh.values.expectedQty,required:!0,readOnly:eI||ey||eb,onChange:e=>eh.setFieldValue("expectedQty",e.target.value),onClear:()=>eh.setFieldValue("expectedQty",0),error:eh.touched.expectedQty&&!!eh.errors.expectedQty})}),(0,d.jsx)(s.ZP,{item:!0,children:(0,d.jsx)(V.Z,{name:"expectedPcs",label:U.expectedPcs,value:eh.values.expectedPcs,required:!0,readOnly:eI||ey||eb,onChange:e=>{eh.setFieldValue("expectedPcs",e.target.value),eh.setFieldValue("expectedQty",eh.values.stdWeight?eh.values.stdWeight*e.target.value:0)},onClear:()=>{eh.setFieldValue("expectedPcs",0),eh.setFieldValue("expectedQty",0)},error:eh.touched.expectedPcs&&!!eh.errors.expectedPcs})}),(0,d.jsx)(s.ZP,{item:!0,children:(0,d.jsx)(g.U,{endpointId:R.u.Design.snapshot,valueField:"reference",displayField:"name",name:"designId",label:U.design,form:eh,firstValue:eh.values.designRef,secondValue:eh.values.designName,errorCheck:"designId",maxAccess:ev,displayFieldWidth:2,readOnly:eI||eb,onChange:async(e,l)=>{if(ey){eh.setFieldValue("designRef",(null==l?void 0:l.reference)||""),eh.setFieldValue("designName",(null==l?void 0:l.name)||""),eh.setFieldValue("designId",(null==l?void 0:l.recordId)||null);return}await eV(l),await eD(null==l?void 0:l.routingId,!1)}})}),(0,d.jsx)(s.ZP,{item:!0,children:(0,d.jsx)(V.Z,{name:"netSerialsWeight",label:U.netSerialsWeight,value:eh.values.netSerialsWeight,readOnly:!0})})]})}),(0,d.jsx)(s.ZP,{item:!0,xs:6,children:(0,d.jsxs)(s.ZP,{container:!0,spacing:2,children:[(0,d.jsx)(s.ZP,{item:!0,xs:12,children:(0,d.jsx)(h.Z,{name:"description",label:U.description,value:eh.values.description,rows:2.8,maxAccess:ev,readOnly:eI||eb,onChange:eh.handleChange,onClear:()=>eh.setFieldValue("description",""),error:eh.touched.description&&!!eh.errors.description})}),(0,d.jsx)(s.ZP,{item:!0,xs:6,children:(0,d.jsx)(V.Z,{name:"stdWeight",label:U.itemWeight,value:eh.values.stdWeight,readOnly:!0})}),(0,d.jsx)(s.ZP,{item:!0,xs:6,children:(0,d.jsx)(V.Z,{name:"standardCost",label:U.standardCost,value:eh.values.standardCost,readOnly:!0})}),(0,d.jsx)(s.ZP,{item:!0,xs:12,children:(0,d.jsx)(V.Z,{name:"avgWeight",label:U.avgWeight,value:eh.values.avgWeight,readOnly:!0})}),(0,d.jsx)(s.ZP,{item:!0,xs:12,children:(0,d.jsx)(f.Z,{endpointId:R.u.MFJobOrder.pack,reducer:e=>{var l;return null==e?void 0:null===(l=e.record)||void 0===l?void 0:l.productionLines},name:"lineId",label:U.line,values:eh.values,valueField:"recordId",displayField:"name",maxAccess:ev,readOnly:eI||eb,onChange:(e,l)=>{eh.setFieldValue("lineId",null==l?void 0:l.recordId)},error:eh.touched.lineId&&!!eh.errors.lineId})}),(0,d.jsx)(s.ZP,{item:!0,xs:12,children:(0,d.jsx)(g.U,{endpointId:R.u.Routing.snapshot,valueField:"reference",displayField:"name",name:"routingId",label:U.routing,form:eh,minChars:2,firstValue:eh.values.routingRef,secondValue:eh.values.routingName,errorCheck:"routingId",maxAccess:ev,displayFieldWidth:2,readOnly:eI||ey||eb,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],onChange:async(e,l)=>{await eD(null==l?void 0:l.recordId,!0),eh.setFieldValue("routingRef",(null==l?void 0:l.reference)||null),eh.setFieldValue("routingName",(null==l?void 0:l.name)||null),eh.setFieldValue("routingId",(null==l?void 0:l.recordId)||null)}})}),(0,d.jsx)(s.ZP,{item:!0,xs:12,children:(0,d.jsx)(g.U,{endpointId:R.u.WorkCenter.snapshot,valueField:"reference",displayField:"name",name:"workCenterId",label:U.workCenter,form:eh,firstValue:eh.values.wcRef,required:!0,secondValue:eh.values.wcName,errorCheck:"workCenterId",maxAccess:ev,readOnly:(null==eh?void 0:null===(z=eh.values)||void 0===z?void 0:z.routingId)||(null==eh?void 0:null===(M=eh.values)||void 0===M?void 0:M.designId),displayFieldWidth:2,onChange:(e,l)=>{eh.setFieldValue("wcRef",(null==l?void 0:l.reference)||""),eh.setFieldValue("wcName",(null==l?void 0:l.name)||""),eh.setFieldValue("workCenterId",(null==l?void 0:l.recordId)||null)}})}),(0,d.jsx)(s.ZP,{item:!0,xs:12,children:(0,d.jsx)(V.Z,{name:"qty",label:U.netProduction,value:eh.values.qty,readOnly:!0,maxAccess:ev})}),(0,d.jsx)(s.ZP,{item:!0,xs:12,children:(0,d.jsx)(V.Z,{name:"pcs",label:U.producedPcs,value:eh.values.pcs,readOnly:!0,maxAccess:ev})}),(0,d.jsx)(s.ZP,{item:!0,xs:12,children:(0,d.jsx)(V.Z,{name:"RMCost",label:U.rmCost,value:eh.values.RMCost,readOnly:!0,maxAccess:ev})}),(0,d.jsx)(s.ZP,{item:!0,xs:12,children:(0,d.jsx)(f.Z,{endpointId:R.u.MFJobOrder.pack,reducer:e=>{var l;return null==e?void 0:null===(l=e.record)||void 0===l?void 0:l.productionClasses},values:eh.values,name:"classId",label:U.productionClass,valueField:"recordId",displayField:"name",maxAccess:ev,readOnly:eI||ey||eb,onChange:(e,l)=>{eh.setFieldValue("classId",null==l?void 0:l.recordId)},error:eh.touched.classId&&!!eh.errors.classId})}),(0,d.jsx)(s.ZP,{item:!0,xs:12,children:(0,d.jsx)(f.Z,{endpointId:R.u.MFJobOrder.pack,reducer:e=>{var l;return null==e?void 0:null===(l=e.record)||void 0===l?void 0:l.productionStandards},values:eh.values,name:"standardId",label:U.productionStandard,valueField:"recordId",displayField:"reference",readOnly:eI||ey||eb,maxAccess:ev,onChange:(e,l)=>{eh.setFieldValue("standardId",null==l?void 0:l.recordId)},error:eh.touched.standardId&&!!eh.errors.standardId})})]})})]})]}),(0,d.jsxs)(s.ZP,{container:!0,spacing:2,xs:4,sx:{pl:2},children:[(0,d.jsx)(s.ZP,{item:!0,children:(0,d.jsx)(P.Z,{ref:ei,resourceId:p.i.MFJobOrders,recordId:eh.values.recordId,seqNo:0,customWidth:300,customHeight:180,disabled:eI||eb,isAbsolutePath:!0,parentImage:es})}),(0,d.jsx)(s.ZP,{item:!0,xs:12,children:(0,d.jsx)(f.Z,{endpointId:R.u.MFJobOrder.pack,reducer:e=>{var l;return null==e?void 0:null===(l=e.record)||void 0===l?void 0:l.jobCategories},name:"categoryId",label:U.category,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],valueField:"recordId",maxAccess:ev,displayField:"name",readOnly:eI||ey||eb,values:eh.values,onChange:(e,l)=>{eh.setFieldValue("categoryId",null==l?void 0:l.recordId)},error:eh.touched.categoryId&&!!eh.errors.categoryId})}),(0,d.jsx)(s.ZP,{item:!0,xs:12,children:(0,d.jsx)(f.Z,{endpointId:R.u.MFJobOrder.pack,reducer:e=>{var l;return null==e?void 0:null===(l=e.record)||void 0===l?void 0:l.categories},name:"itemCategoryId",label:U.itemCategory,readOnly:!0,valueField:"recordId",displayField:["caRef","name"],values:eh.values,error:eh.touched.itemCategoryId&&!!eh.errors.itemCategoryId,maxAccess:ev})}),(0,d.jsx)(s.ZP,{item:!0,xs:12,children:(0,d.jsx)(g.U,{endpointId:T.z.ThreeDDrawing.snapshot2,valueField:"reference",displayField:"reference",secondDisplayField:!1,name:"threeDDId",label:U.threeDD,form:eh,valueShow:"threeDDRef",maxAccess:ev,readOnly:eI||ey||eb,onChange:(e,l)=>{eh.setFieldValue("threeDDId",(null==l?void 0:l.recordId)||null),eh.setFieldValue("threeDDRef",(null==l?void 0:l.reference)||""),eh.setFieldValue("fileReference",(null==l?void 0:l.fileReference)||"")},errorCheck:"threeDDId"})}),(0,d.jsx)(s.ZP,{item:!0,xs:12,children:(0,d.jsx)(g.U,{endpointId:T.z.Rubber.snapshot,valueField:"reference",displayField:"reference",secondDisplayField:!1,name:"rubberId",label:U.rubber,form:eh,valueShow:"rubberRef",maxAccess:ev,readOnly:eI||ey||eb,onChange:(e,l)=>{eh.setFieldValue("rubberId",(null==l?void 0:l.recordId)||null),eh.setFieldValue("rubberRef",(null==l?void 0:l.reference)||"")},errorCheck:"rubberId"})}),(0,d.jsx)(s.ZP,{item:!0,xs:12,children:(0,d.jsx)(f.Z,{endpointId:R.u.MFJobOrder.pack,reducer:e=>{var l;return null==e?void 0:null===(l=e.record)||void 0===l?void 0:l.salesPeople},name:"spId",label:U.orderedBy,columnsInDropDown:[{key:"spRef",value:"Reference"},{key:"name",value:"Name"}],valueField:"recordId",maxAccess:ev,displayField:"name",readOnly:eI||ey||eb,values:eh.values,onChange:(e,l)=>{eh.setFieldValue("spId",null==l?void 0:l.recordId)},error:eh.touched.spId&&!!eh.errors.spId})}),(0,d.jsx)(s.ZP,{item:!0,xs:12,children:(0,d.jsx)(g.U,{endpointId:k.P.Client.snapshot,name:"clientId",label:U.client,valueField:"reference",displayField:"name",valueShow:"clientRef",secondValueShow:"clientName",form:eh,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],onChange:async(e,l)=>{await eP(l),eh.setFieldValue("clientName",(null==l?void 0:l.name)||""),eh.setFieldValue("clientRef",(null==l?void 0:l.reference)||""),eh.setFieldValue("clientId",(null==l?void 0:l.recordId)||null)},secondFieldName:"clientName",errorCheck:"clientId",maxAccess:ev,readOnly:eI||ey||eb,displayFieldWidth:3,editMode:ef})}),(0,d.jsx)(s.ZP,{item:!0,xs:12,children:(0,d.jsx)(h.Z,{name:"billAddress",label:U.billAddress,value:eh.values.billAddress,rows:3.5,maxLength:"100",readOnly:eI||ey||eb,maxAccess:ev,onChange:e=>eh.setFieldValue("billAddress",e.target.value),onClear:()=>eh.setFieldValue("billAddress",null)})})]})]})})})})}function L(e){let{labels:l,maxAccess:n,store:t,refetchRouting:i,setRefetchRouting:r,setRefetchJob:o}=e,{postRequest:c,getRequest:p}=(0,a.useContext)(v.$),{platformLabels:h}=(0,a.useContext)(Z.l),{recordId:f,jobReference:I,jobRoutings:y}=t||{},b={Unreached:{key:5,value:"Unreached"}},{formik:g}=(0,F.c)({maxAccess:n,initialValues:{jobId:f,jobReference:I,routings:[{id:1,jobId:null,seqNo:"",name:"",workCenterId:"",operationId:"",status:b.Unreached.key,qty:"",qtyIn:"",pcs:"",pcsIn:""}]},validationSchema:u.Ry({routings:u.IX().of(u.Ry({seqNo:u.Z_().required(),name:u.Z_().required(),operationName:u.Z_().required(),workCenterRef:u.Z_().required(),workCenterName:u.Z_().required()}))}),onSubmit:async e=>{let l=e.routings.map(e=>({...e,seqNo:parseInt(e.seqNo),status:e.status||b.Unreached.key,jobId:f}));await c({extension:R.u.JobRouting.set2,record:JSON.stringify({jobId:f,data:l})}),m.ZP.success(h.Edited),o(!0)}}),k=[{component:"numberfield",label:l.seqNo,name:"seqNo",flex:1,props:{unClearable:!0},propsReducer(e){let{row:l,props:n}=e;return{...n,readOnly:[1,2,3,4].includes(l.status)}}},{component:"textfield",label:l.seqName,name:"name",flex:2,propsReducer(e){let{row:l,props:n}=e;return{...n,readOnly:[1,2,3,4].includes(l.status)}}},{component:"resourcelookup",label:l.wcRef,name:"workCenterRef",flex:2,props:{endpointId:R.u.WorkCenter.snapshot,displayField:"reference",valueField:"recordId",mapping:[{from:"recordId",to:"workCenterId"},{from:"reference",to:"workCenterRef"},{from:"name",to:"workCenterName"}],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],displayFieldWidth:3},async onChange(e){let{row:{update:l,newRow:n}}=e;if(!(null==n?void 0:n.workCenterId)){l({workCenterId:"",workCenterRef:"",workCenterName:"",operationId:"",operationRef:"",operationName:""});return}l({workCenterId:null==n?void 0:n.workCenterId,workCenterRef:null==n?void 0:n.workCenterRef,workCenterName:null==n?void 0:n.workCenterName})},propsReducer(e){let{row:l,props:n}=e;return{...n,readOnly:[1,2,3,4].includes(l.status)}}},{component:"textfield",label:l.wcName,name:"workCenterName",flex:2.7,props:{readOnly:!0}},{component:"resourcecombobox",label:l.operation,name:"operationName",flex:2,variableParameters:[{key:"workCenterId",value:"workCenterId"}],props:{endpointId:R.u.Operation.qry,displayField:"reference",valueField:"recordId",mapping:[{from:"recordId",to:"operationId"},{from:"reference",to:"operationRef"},{from:"name",to:"operationName"}],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],displayFieldWidth:2.5},propsReducer(e){let{row:l,props:n}=e;return{...n,readOnly:[1,2,3,4].includes(l.status)||!l.workCenterId}}},{component:"textfield",label:l.status,name:"statusName",flex:2,props:{readOnly:!0}},{component:"numberfield",label:l.qtyIn,flex:1,name:"qtyIn",props:{readOnly:!0}},{component:"numberfield",label:l.pcsIn,flex:1,name:"pcsIn",props:{readOnly:!0}},{component:"numberfield",label:l.qty,flex:1,name:"qty",props:{readOnly:!0}},{component:"numberfield",label:l.pcs,flex:1,name:"pcs",props:{readOnly:!0}}],w=[{key:"Sync",condition:!0,onClick:A,disabled:(null==t?void 0:t.status)!=1}];async function A(){if(!(null==t?void 0:t.routingId))return;let e=await p({extension:R.u.RoutingSequence.qry,parameters:"_routingId=".concat(null==t?void 0:t.routingId)}),l=((null==e?void 0:e.list)||[]).map((e,l)=>({...e,id:l+1,status:b.Unreached.key,statusName:b.Unreached.value,qtyIn:0,pcsIn:0,qty:0,pcs:0}));g.setFieldValue("routings",l)}return(0,a.useEffect)(()=>{!async function(){var e,l;if(!i||!f)return;let n=await p({extension:R.u.JobRouting.qry,parameters:"_jobId=".concat(f,"&_workcenterId=0&_status=0")}),d=(null==n?void 0:null===(e=n.list)||void 0===e?void 0:e.length)!=0?await Promise.all(null==n?void 0:null===(l=n.list)||void 0===l?void 0:l.map(async(e,l)=>({...e,id:l+1}))):[{id:1}];g.setValues({jobId:f,jobReference:I,routings:d}),r(!1)}()},[i]),(0,a.useEffect)(()=>{!async function(){g.setValues({jobId:f,jobReference:I,routings:(null==y?void 0:y.length)>0?await Promise.all(null==y?void 0:y.map(async(e,l)=>({...e,id:l+1}))):[{id:1}]})}()},[y]),(0,d.jsx)(M.Z,{onSave:g.handleSubmit,maxAccess:n,editMode:!!f,actions:w,disabledSubmit:(null==t?void 0:t.isCancelled)||(null==t?void 0:t.isPosted),children:(0,d.jsxs)(j.R,{children:[(0,d.jsx)(C.g,{children:(0,d.jsx)(s.ZP,{container:!0,spacing:2,children:(0,d.jsx)(s.ZP,{item:!0,xs:4,children:(0,d.jsx)(x.Z,{value:g.values.jobReference,label:l.reference,readOnly:!0})})})}),(0,d.jsx)(O.Q,{children:(0,d.jsx)(z._,{onChange:(e,l)=>{g.setFieldValue("routings",e)},value:g.values.routings,error:g.errors.routings,columns:k,name:"routings",maxAccess:n,allowDelete:!(null==t?void 0:t.isPosted)&&!(null==t?void 0:t.isCancelled),deleteHideCondition:{status:[1,2,3,4]}})})]})})}var B=n(98434);function $(e){var l;let{store:n,maxAccess:t,labels:i}=e,{stack:r}=(0,A.zY)(),{jobWorksheets:o,jobReference:s}=n||{},[u,c]=(0,a.useState)([]);(0,a.useEffect)(()=>{!async function(){c(o)}()},[o]);let m=[{field:"reference",headerName:i.reference,flex:1},{field:"date",headerName:i.date,flex:1,type:"date"},{field:"jobRef",headerName:i.jobRef,flex:1},{field:"wcName",headerName:i.workCenter,flex:1},{field:"laborName",headerName:i.labor,flex:1},{field:"statusName",headerName:i.status,flex:1}];return(0,d.jsx)(j.R,{children:(0,d.jsx)(O.Q,{children:(0,d.jsx)(S.Z,{name:"worksheetTable",columns:m,gridData:{list:null===(l=u||[])||void 0===l?void 0:l.map(e=>({...e,jobRef:s}))},onEdit:e=>{var l;l=null==e?void 0:e.recordId,r({Component:B.Z,props:{recordId:l,joInvalidate:refetch}})},rowId:["worksheetId"],maxAccess:t,pagination:!1})})})}function G(e){var l,n,t,i;let{labels:r,maxAccess:o,store:c}=e,{postRequest:p}=(0,a.useContext)(v.$),{platformLabels:x}=(0,a.useContext)(Z.l),{jobOverheads:h,recordId:f,isPosted:I,isCancelled:y}=c||{},{formik:b}=(0,F.c)({maxAccess:o,validateOnChange:!0,initialValues:{items:[{id:1,jobId:f,overheadId:"",seqNo:"",amount:0,units:0,unitCost:0}]},validationSchema:u.Ry({items:u.IX().of(u.Ry({overheadRef:u.Z_().test(function(e){var l,n,d;let t=this.parent.units;return(null===(d=this.options.from[1])||void 0===d?void 0:null===(n=d.value)||void 0===n?void 0:null===(l=n.items)||void 0===l?void 0:l.length)===1&&(!t||0==t)||!!e}),overheadName:u.Z_().test(function(e){var l,n,d;let t=this.parent.units;return(null===(d=this.options.from[1])||void 0===d?void 0:null===(n=d.value)||void 0===n?void 0:null===(l=n.items)||void 0===l?void 0:l.length)===1&&(!t||0==t)||!!e}),units:u.Z_().test("check-value","Units must be at least 1",function(e){if(this.parent.overheadRef){let l=Number(e);if(!e||isNaN(l))return!1}return!0})}))}),onSubmit:async e=>{let l=null==e?void 0:e.items.map((e,l)=>({...e,seqNo:l+1,jobId:f})).filter(e=>e.overheadRef||e.units);await p({extension:R.u.JobOverhead.set2,record:JSON.stringify({jobId:f,items:l})}),m.ZP.success(x.Edited)}}),g=null==b?void 0:null===(n=b.values)||void 0===n?void 0:null===(l=n.items)||void 0===l?void 0:l.reduce((e,l)=>{var n;return e+Math.round(parseFloat(null==l?void 0:null===(n=l.amount)||void 0===n?void 0:n.toString().replace(/,/g,""))||0)},0),k=[{component:"resourcelookup",label:r.overheadRef,name:"overheadRef",props:{endpointId:R.u.Overhead.snapshot,displayField:"reference",valueField:"reference",mapping:[{from:"recordId",to:"overheadId"},{from:"reference",to:"overheadRef"},{from:"name",to:"overheadName"},{from:"unitCost",to:"unitCost"}],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],displayFieldWidth:2},async onChange(e){let{row:{update:l,newRow:n}}=e;l({overheadId:null==n?void 0:n.overheadId,overheadRef:null==n?void 0:n.overheadRef,overheadName:null==n?void 0:n.overheadName,unitCost:(null==n?void 0:n.unitCost)||0})}},{component:"textfield",label:r.overheadName,name:"overheadName",props:{readOnly:!0}},{component:"numberfield",label:r.units,name:"units",async onChange(e){let{row:{update:l,newRow:n}}=e;l({amount:(null==n?void 0:n.units)*(null==n?void 0:n.unitCost)||0})}},{component:"numberfield",label:r.unitCost,name:"unitCost",props:{readOnly:!0}},{component:"numberfield",label:r.amount,name:"amount",props:{readOnly:!0}}],w=[{key:"GenerateJob",condition:!0,onClick:A,disabled:I||y}];async function A(){await p({extension:R.u.JobOverhead.generate,record:JSON.stringify({jobId:f})}),m.ZP.success(x.Generated)}return(0,a.useEffect)(()=>{!async function(){b.setFieldValue("items",(null==h?void 0:h.length)>0?await Promise.all(null==h?void 0:h.map((e,l)=>({...e,id:l+1}))):b.initialValues.items)}()},[h]),(0,d.jsx)(M.Z,{onSave:b.handleSubmit,maxAccess:o,editMode:!!f,actions:w,isCleared:!0,disabledSubmit:y||I,children:(0,d.jsxs)(j.R,{children:[(0,d.jsx)(O.Q,{children:(0,d.jsx)(z._,{onChange:e=>b.setFieldValue("items",e),value:b.values.items,error:b.errors.items,columns:k,initialValues:null==b?void 0:null===(i=b.initialValues)||void 0===i?void 0:null===(t=i.items)||void 0===t?void 0:t[0],name:"items",maxAccess:o,allowDelete:!I&&!y})}),(0,d.jsx)(C.g,{children:(0,d.jsx)(s.ZP,{container:!0,p:2,children:(0,d.jsx)(s.ZP,{item:!0,xs:2,children:(0,d.jsx)(V.Z,{name:"totalAmount",label:r.total,value:g,readOnly:!0})})})})]})})}function Y(e){let{store:l,maxAccess:n,labels:t}=e,i=(null==l?void 0:l.jobMaterials)||[],a=[{field:"sku",headerName:t.sku,flex:1},{field:"itemName",headerName:t.itemName,flex:1},{field:"itemCategoryName",headerName:t.category,flex:1},{field:"qty",headerName:t.qty,flex:1,type:"number"},{field:"loss",headerName:t.loss,flex:1,type:"number"},{field:"unitCost",headerName:t.unitCost,flex:1,type:"number"},{field:"netCost",headerName:t.netCost,flex:1,type:"number"},{field:"isMetal",headerName:t.isMetal,flex:.6,type:"checkbox"}],r=null==i?void 0:i.reduce((e,l)=>{var n,d;return e+(parseFloat(null==l?void 0:null===(n=l.qty)||void 0===n?void 0:n.toString().replace(/,/g,""))||0)-(parseFloat(null==l?void 0:null===(d=l.loss)||void 0===d?void 0:d.toString().replace(/,/g,""))||0)},0);return(0,d.jsxs)(j.R,{children:[(0,d.jsx)(O.Q,{children:(0,d.jsx)(S.Z,{name:"materialsTable",columns:a,gridData:{list:i},rowId:["itemId"],maxAccess:n,pagination:!1})}),(0,d.jsx)(C.g,{children:(0,d.jsx)(s.ZP,{container:!0,p:4,children:(0,d.jsx)(s.ZP,{item:!0,xs:2,children:(0,d.jsx)(V.Z,{name:"totalQty",label:t.totQty,value:r,readOnly:!0})})})})]})}function K(e){var l,n;let{labels:t,maxAccess:i,store:r}=e,{postRequest:o,getRequest:c}=(0,a.useContext)(v.$),{platformLabels:x}=(0,a.useContext)(Z.l),{jobItemSizes:h,isCancelled:f,isPosted:I,recordId:b}=r,{formik:g}=(0,F.c)({validateOnChange:!0,initialValues:{jobId:null,jobItemSizes:[{id:1,jobId:null,sizeId:"",expectedQty:0,expectedPcs:0,qty:0,pcs:0}]},validationSchema:u.Ry({jobItemSizes:u.IX().of(u.Ry({sizeRef:u.Z_().test(function(e){var l,n,d;return(null===(d=this.options.from[1])||void 0===d?void 0:null===(n=d.value)||void 0===n?void 0:null===(l=n.jobItemSizes)||void 0===l?void 0:l.length)===1||!!e}),sizeName:u.Z_().test(function(e){var l,n,d;return(null===(d=this.options.from[1])||void 0===d?void 0:null===(n=d.value)||void 0===n?void 0:null===(l=n.jobItemSizes)||void 0===l?void 0:l.length)===1||!!e})}))}),onSubmit:async e=>{let l=e.jobItemSizes.map(e=>({...e,jobId:b})).filter(e=>e.sizeRef);await o({extension:R.u.JobItemSize.set2,record:JSON.stringify({jobId:b,jobItemSizes:l})}),m.ZP.success(x.Edited)}}),k=e=>g.values.jobItemSizes.reduce((l,n)=>l+(parseFloat(null==n?void 0:n[e])||0),0),w=k("expectedPcs"),A=k("expectedQty"),N=k("pcs"),P=k("qty"),D=[{component:"resourcelookup",label:t.sizeRef,name:"sizeRef",props:{endpointId:y.$.ItemSizes.snapshot,displayField:"reference",valueField:"reference",minChars:2,mapping:[{from:"recordId",to:"sizeId"},{from:"reference",to:"sizeRef"},{from:"name",to:"sizeName"}],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],displayFieldWidth:2},async onChange(e){let{row:{update:l,newRow:n}}=e;l({sizeId:null==n?void 0:n.sizeId,sizeRef:null==n?void 0:n.sizeRef,sizeName:null==n?void 0:n.sizeName})}},{component:"textfield",label:t.sizeName,name:"sizeName",props:{readOnly:!0}},{component:"numberfield",label:t.expectedPcs,name:"expectedPcs",props:{maxLength:6}},{component:"numberfield",label:t.expectedQty,name:"expectedQty",props:{maxLength:6}},{component:"numberfield",label:t.pcs,name:"pcs",props:{maxLength:6}},{component:"numberfield",label:t.qty,name:"qty",props:{maxLength:6}}];return(0,a.useEffect)(()=>{!async function(){g.setValues({jobId:b,jobItemSizes:(null==h?void 0:h.length)>0?await Promise.all(null==h?void 0:h.map(async(e,l)=>({...e,id:l+1}))):g.initialValues.jobItemSizes})}()},[h]),(0,d.jsx)(M.Z,{resourceId:p.i.MFJobOrders,onSave:g.handleSubmit,maxAccess:i,disabledSubmit:f||I,children:(0,d.jsxs)(j.R,{children:[(0,d.jsx)(O.Q,{children:(0,d.jsx)(z._,{onChange:e=>g.setFieldValue("jobItemSizes",e),value:g.values.jobItemSizes,error:g.errors.jobItemSizes,initialValues:null==g?void 0:null===(n=g.initialValues)||void 0===n?void 0:null===(l=n.jobItemSizes)||void 0===l?void 0:l[0],columns:D,name:"jobItemSizes",maxAccess:i,allowDelete:I&&f})}),(0,d.jsx)(C.g,{children:(0,d.jsxs)(s.ZP,{container:!0,spacing:2,p:1,children:[(0,d.jsx)(s.ZP,{item:!0,xs:3,children:(0,d.jsx)(V.Z,{name:"totExpectedPcs",label:t.totExpectedPcs,value:w,readOnly:!0})}),(0,d.jsx)(s.ZP,{item:!0,xs:3,children:(0,d.jsx)(V.Z,{name:"totExpectedQty",label:t.totExpectedQty,value:A,readOnly:!0})}),(0,d.jsx)(s.ZP,{item:!0,xs:3,children:(0,d.jsx)(V.Z,{name:"totPcs",label:t.totPcs,value:N,readOnly:!0})}),(0,d.jsx)(s.ZP,{item:!0,xs:3,children:(0,d.jsx)(V.Z,{name:"totQty",label:t.totQty,value:P,readOnly:!0})})]})})]})})}var H=e=>{let{labels:l,maxAccess:n,store:t}=e,i=[{field:"workCenterRef",headerName:l.workCenterRef,flex:1},{field:"workCenterName",headerName:l.workCenterName,flex:1},{field:"qty",headerName:l.qty,flex:1},{field:"pcs",headerName:l.pcs,flex:1},{field:"statusName",headerName:l.status,flex:1}];return(0,d.jsx)(j.R,{children:(0,d.jsx)(O.Q,{children:(0,d.jsx)(S.Z,{name:"workCenterTable",columns:i,gridData:{list:(null==t?void 0:t.jobWorkCenters)||[]},rowId:["recordId"],pageSize:50,pagination:!1,maxAccess:n})})})},X=n(67920);function ee(e){var l,t,i,r;let{labels:o,maxAccess:c,store:p}=e,{postRequest:x}=(0,a.useContext)(v.$),{platformLabels:h}=(0,a.useContext)(Z.l),{recordId:f,jobItems:I}=p||{},{stack:b}=(0,A.zY)(),{schema:g,requiredFields:C}=(0,X.m)({sku:e=>null==e?void 0:e.sku,itemName:e=>null==e?void 0:e.itemName,qty:e=>(null==e?void 0:e.qty)>0},!0,c,"items"),{formik:k}=(0,F.c)({initialValues:{items:[{id:1,jobId:f,itemId:null,seqNo:1,qty:0,pcs:0,sku:"",itemName:""}]},conditionSchema:["items"],validationSchema:u.Ry({items:u.IX().of(g)}),onSubmit:async e=>{let l=null==e?void 0:e.items.filter(e=>Object.values(C).some(l=>l(e))).map((e,l)=>({...e,seqNo:l+1,jobId:f}));await x({extension:R.u.JobOrdersItem.set2,record:JSON.stringify({jobId:f,items:l})}),m.ZP.success(h.Updated)}}),w=[{component:"resourcelookup",label:o.item,name:"sku",props:{endpointId:y.$.Item.snapshot,valueField:"sku",displayField:"sku",displayFieldWidth:2,mapping:[{from:"recordId",to:"itemId"},{from:"sku",to:"sku"},{from:"name",to:"itemName"},{from:"trackBy",to:"trackBy"}],columnsInDropDown:[{key:"sku",value:"SKU"},{key:"name",value:"Name"}]}},{component:"textfield",label:o.itemName,name:"itemName",props:{readOnly:!0}},{component:"numberfield",label:o.qty,name:"qty",props:{allowNegative:!1,maxLength:9},updateOn:"blur",async onChange(e){let{row:{update:l,newRow:n}}=e;l({qty:(null==n?void 0:n.qty)||0,extendedCost:((null==n?void 0:n.qty)||0)*((null==n?void 0:n.unitCost)||0)})}},{component:"numberfield",label:o.pcs,name:"pcs",props:{decimalScale:0,maxLength:5}},{component:"numberfield",label:o.unitCost,name:"unitCost",props:{readOnly:!0,decimalScale:2}},{component:"numberfield",label:o.extendedCost,name:"extendedCost",props:{readOnly:!0,decimalScale:2}},{component:"button",name:"serials",label:h.serials,flex:.5,props:{onCondition:e=>1===e.trackBy?{imgSrc:n(64581).Z.src,hidden:!1}:{imgSrc:"",hidden:!0}},onClick:(e,l)=>{b({Component:J,props:{labels:o,maxAccess:c,api:R.u.MFSerial.qry2,parameters:"_jobId=".concat(f,"&_seqNo=").concat(l.seqNo)}})}}],N=(null==k?void 0:null===(t=k.values)||void 0===t?void 0:null===(l=t.items)||void 0===l?void 0:l.length)>0?k.values.items.reduce((e,l)=>{var n;return e+(parseFloat(null===(n=l.extendedCost)||void 0===n?void 0:n.toString().replace(/,/g,""))||0)},0):0;return(0,a.useEffect)(()=>{!async function(){k.setValues({jobId:f,items:(null==I?void 0:I.length)>0?await Promise.all(null==I?void 0:I.map((e,l)=>({...e,id:l+1,extendedCost:((null==e?void 0:e.unitCost)||0)*((null==e?void 0:e.qty)||0)}))):k.initialValues.items})}()},[I]),(0,d.jsx)(M.Z,{onSave:k.handleSubmit,maxAccess:c,isParentWindow:!1,disabledSubmit:(null==p?void 0:p.isCancelled)||(null==p?void 0:p.isPosted),children:(0,d.jsxs)(j.R,{children:[(0,d.jsx)(O.Q,{children:(0,d.jsx)(z._,{name:"items",onChange:e=>k.setFieldValue("items",e),value:k.values.items,error:k.errors.items,columns:w,initialValues:null==k?void 0:null===(r=k.initialValues)||void 0===r?void 0:null===(i=r.items)||void 0===i?void 0:i[0],maxAccess:c,allowDelete:!(null==p?void 0:p.isPosted)&&!(null==p?void 0:p.isCancelled)})}),(0,d.jsx)(s.ZP,{container:!0,p:4,justifyContent:"flex-end",children:(0,d.jsx)(s.ZP,{item:!0,xs:2,children:(0,d.jsx)(V.Z,{name:"totalCost",label:o.totalCost,value:N,readOnly:!0})})})]})})}var el=e=>{let{recordId:l,jobReference:n,access:r,labels:o,invalidate:s,lockRecord:u,window:c}=e,[m,v]=(0,a.useState)(0),[p,x]=(0,a.useState)({recordId:l,jobReference:n,isPosted:!1,isCancelled:!1}),[h,f]=(0,a.useState)(!1),[I,y]=(0,a.useState)(!1),b=[{label:o.jobOrder},{label:o.routing,disabled:!p.recordId,onRefetch:()=>{f(!0)}},{label:o.worksheet,disabled:!p.recordId},{label:o.overhead,disabled:!p.recordId},{label:o.materials,disabled:!p.recordId},{label:o.size,disabled:!p.recordId},{label:o.workCenter,disabled:!p.recordId},{label:o.item,disabled:!p.recordId}];return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(i.Y,{tabs:b,activeTab:m,setActiveTab:v,maxAccess:r}),(0,d.jsx)(t.Z,{index:0,value:m,maxAccess:r,children:(0,d.jsx)(U,{store:p,setStore:x,labels:o,maxAccess:r,setRefetchRouting:f,invalidate:s,lockRecord:u,refetchJob:I,setRefetchJob:y,window:c})}),(0,d.jsx)(t.Z,{index:1,value:m,maxAccess:r,children:(0,d.jsx)(L,{store:p,labels:o,maxAccess:r,refetchRouting:h,setRefetchRouting:f,setRefetchJob:y})}),(0,d.jsx)(t.Z,{index:2,value:m,maxAccess:r,children:(0,d.jsx)($,{store:p,labels:o,maxAccess:r})}),(0,d.jsx)(t.Z,{index:3,value:m,maxAccess:r,children:(0,d.jsx)(G,{store:p,labels:o,maxAccess:r})}),(0,d.jsx)(t.Z,{index:4,value:m,maxAccess:r,children:(0,d.jsx)(Y,{store:p,labels:o,maxAccess:r})}),(0,d.jsx)(t.Z,{index:5,value:m,maxAccess:r,children:(0,d.jsx)(K,{store:p,labels:o,maxAccess:r})}),(0,d.jsx)(t.Z,{index:6,value:m,maxAccess:r,children:(0,d.jsx)(H,{store:p,labels:o,maxAccess:r})}),(0,d.jsx)(t.Z,{index:7,value:m,maxAccess:r,children:(0,d.jsx)(ee,{store:p,labels:o,maxAccess:r})})]})}},67920:function(e,l,n){n.d(l,{m:function(){return t}});var d=n(48601);function t(e,l,n){var t;let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"items",a={...e};return null==n||null===(t=n.record)||void 0===t||t.controls.forEach(e=>{let{controlId:l,accessLevel:n}=e,[d,t]=null==l?void 0:l.split(".");d!==i||2!==n||t in a||(a[t]=e=>(null==e?void 0:e[t])!=null),(1===n||4===n)&&t in a&&delete a[t]}),{schema:d.Ry().shape({...Object.keys(a).reduce((e,n)=>(e[n]=d.nK().nullable().test(function(e){var d;let t=this.parent,[,i]=this.path.match(/^(\w+)\[(\d+)\]/)||[],r=(null===(d=this.options.context)||void 0===d?void 0:d[i])||[];if(l||!l&&r.length>1){if(null!==t[n]&&void 0!==t[n]&&0!==t[n]&&""!==a[n]&&!a[n](t))return!1;if(!Object.entries(a).some(e=>{let[,l]=e;return!!l(t)}))return!0}return!!a[n](t)&&void 0!==e}),e),{})}),requiredFields:a}}},78618:function(e,l,n){var d=n(52322),t=n(23925),i=n(31389),a=n(62362);let r=e=>{let{DialogText:l,bottomSection:n}=e;return(0,d.jsxs)(i.R,{children:[(0,d.jsx)(a.Q,{children:(0,d.jsx)(t.Z,{sx:{p:12},textAlign:"center",children:l})}),n]})};r.width=600,r.height=200,l.Z=r}}]);