(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[48290],{2801:function(e,l,r){"use strict";var n=r(52322),a=r(23925),d=r(2784),i=r(80983),o=r(65950),t=r(38449),s=r(19473),c=r(35656),u=r(10498),v=r.n(u),m=r(69627);let f=(0,d.forwardRef)((e,l)=>{let{resourceId:u,error:f,seqNo:I,recordId:h,width:p=140,height:x=140,customWidth:g,customHeight:y,disabled:b=!1,isAbsolutePath:_=!1,parentImage:D}=e,N=(0,d.useRef)(null),j=(0,d.useRef)(null),Z=(0,d.useRef)({}),{getRequest:w,postRequest:C}=(0,d.useContext)(o.$),{platformLabels:F}=(0,d.useContext)(s.l),[V,k]=(0,d.useState)(""),A=null==D?void 0:D.recordId,O=null==D?void 0:D.resourceId,{formik:S}=(0,i.c)({initialValues:{}}),{width:q}=(0,c.d)(),P=q>=1680?1:q>=1600?.9:q<=1024?.7:.7+(q-1024)/576*.22000000000000008;(0,d.useImperativeHandle)(l,()=>({submit:R}));let R=()=>{var e,r,n,a,d,i,o,s,c,v,m,f;if(b)return;let I=(null==l?void 0:null===(e=l.current)||void 0===e?void 0:e.value)||h;if(_){if((null===(i=S.values)||void 0===i?void 0:null===(d=i.file)||void 0===d?void 0:d.name)||S.values.url){let e={...S.values,fileName:(null===(c=S.values.file)||void 0===c?void 0:c.name)||S.values.url,resourceId:u,recordId:I};return C({extension:t.r.Attachment.set2,record:JSON.stringify(e),file:null===(v=S.values)||void 0===v?void 0:v.file}).then(()=>$(I))}return V||null===(o=Z.current)||void 0===o||!o.fileName||(null===(s=S.values)||void 0===s?void 0:s.fileName)?void 0:C({extension:t.r.Attachment.del,record:JSON.stringify(Z.current)}).then(()=>$(I))}if(null===(r=S.values)||void 0===r?void 0:r.file){let e={...S.values,recordId:I};return C({extension:t.r.Attachment.set,record:JSON.stringify(e),file:null===(m=S.values)||void 0===m?void 0:m.file}).then(()=>$(I))}if(!V&&(null===(n=Z.current)||void 0===n?void 0:n.url)&&!(null===(a=S.values)||void 0===a?void 0:a.url))return C({extension:t.r.Attachment.del,record:JSON.stringify(Z.current),file:null===(f=Z.current)||void 0===f?void 0:f.url}).then(()=>$(I))},B=()=>{k(""),S.setValues({})},$=async e=>{let l=e||h;if(!u)return;if(_&&l){let e=await w({extension:t.r.Attachment.get2,parameters:"_resourceId=".concat(u,"&_seqNo=").concat(I,"&_recordId=").concat(l)}),r=(null==e?void 0:e.record)||{};S.setValues({...r,resourceId:u}),Z.current={...r,resourceId:u},k((null==r?void 0:r.fileName)?"".concat(r.fileName,"?t=").concat(Date.now()):"");return}let r=O||u,n=A||l;if(!n)return;let a=await w({extension:t.r.Attachment.get,parameters:"_resourceId=".concat(r,"&_seqNo=").concat(I,"&_recordId=").concat(n)}),d=(null==a?void 0:a.record)||{};S.setValues({...d,resourceId:r}),Z.current={...d,resourceId:r},k((null==d?void 0:d.url)?"".concat(d.url,"?t=").concat(Date.now()):"")};return(0,d.useEffect)(()=>{A||h?$():B()},[A,h]),(0,n.jsxs)(a.Z,{className:v().container,children:[(0,n.jsx)(a.Z,{className:v().previewBox,style:{width:"100%",maxWidth:(g||p)*P,height:(y||x)*P},onClick:()=>{b||N.current.click()},children:(0,n.jsx)("img",{src:V||r(68802).default.src,alt:"",className:v().previewImage,style:{border:f?"2px solid #F44336":"none"},onError:e=>{e.currentTarget.src=r(68802).default.src}})}),(0,n.jsxs)(a.Z,{className:v().bottomSection,children:[(0,n.jsx)("input",{hidden:!0,type:"file",accept:"image/png, image/jpeg, image/jpg",ref:N,onChange:e=>{var l,r;let n=null==e?void 0:null===(r=e.target)||void 0===r?void 0:null===(l=r.files)||void 0===l?void 0:l[0];if(!n)return;if(Math.round(n.size/1024)>500){alert(F.MaxFileSize);return}let a=new Date(n.lastModifiedDate),d="".concat(a.getDate(),"/").concat(a.getMonth()+1,"/").concat(a.getFullYear());S.setValues({resourceId:u,recordId:h,seqNo:0,fileName:n.name,folderId:null,folderName:null,date:d,url:null,file:n});let i=new FileReader;j.current=i,i.onloadend=e=>k(e.target.result),i.readAsDataURL(n)},disabled:b}),(0,n.jsx)(m.Z,{onClick:B,image:"clear.png",tooltipText:F.Clear,color:"#F44336",border:"none",disabled:b})]})]})});l.Z=f},48290:function(e,l,r){"use strict";r.d(l,{Z:function(){return F}});var n=r(52322),a=r(60218),d=r(48601),i=r(2784),o=r(82737),t=r(2801),s=r(62202),c=r(65950),u=r(26612),v=r(31389),m=r(62362),f=r(80983),I=r(8661),h=r(19473),p=r(27423),x=r(65215),g=r(91406),y=r(5088),b=r(71987),_=r(45300),D=r(38449),N=r(65947);let j=async(e,l)=>(await e({extension:D.r.NumberRange.get,parameters:"_recordId=".concat(l)})).record,Z=(e,l,r)=>{let n=(e=JSON.parse(JSON.stringify(e))).record.controls,a=n.find(e=>e.controlId===r);return a?a.accessLevel=l.mandatory?N.$7:N.rr:l.mandatory||l.readOnly?n.push({sgId:"",resourceId:"",controlId:r,accessLevel:l.mandatory?N.$7:N.rr}):n=n.filter(e=>e.controlId!==r),{...e,record:{...e.record,controls:n}}},w=async function(e){let l,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"barcode",n=arguments.length>2?arguments[2]:void 0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,d=arguments.length>4?arguments[4]:void 0,i={readOnly:!1,mandatory:!1};if(d)i={readOnly:!0,mandatory:!1};else if(a){let r=await j(e,a);l=null==r?void 0:r.external,i=r?l?{readOnly:!1,mandatory:!0}:{readOnly:!1,mandatory:!1}:{readOnly:!1,mandatory:!0}}else i={readOnly:!1,mandatory:!0};return n&&(n=Z(n,i,r)),{field:i,maxAccess:n,selectNraId:a}};var C=r(19689);function F(e){var l,r,D,N,j,Z;let{labels:F,access:V,store:k,recordId:A,msId:O,barcode:S}=e,{postRequest:q,getRequest:P}=(0,i.useContext)(c.$),{platformLabels:R}=(0,i.useContext)(h.l),B=(0,b.E)({endpointId:x.$.Barcodes.qry}),{maxAccess:$,changeDT:Q}=function(e){var l;let{access:r,fieldName:n,editMode:a=!0,store:d}=e,{getRequest:o}=(0,i.useContext)(c.$),[t,s]=(0,i.useState)((null==d?void 0:d.nraId)||null),u=async e=>await w(o,n,r,e,a),v=(0,_.a)({retry:!1,staleTime:0,queryKey:[t,!!r],queryFn:()=>u(t)});return{refBehavior:v.data,maxAccess:null==v?void 0:null===(l=v.data)||void 0===l?void 0:l.maxAccess,changeDT(e){s(e)}}}({access:V,editMode:!1,fieldName:"barcode",store:k}),U=(0,i.useRef)(null),{formik:E}=(0,f.c)({initialValues:{recordId:A,barcodeId:null,itemId:A||(null==k?void 0:k.recordId),sku:null==k?void 0:k._reference,defaultQty:"",itemName:null==k?void 0:k._name,muId:null,msId:O,scaleDescription:null,posDescription:null,barcode:null,isInactive:!1},maxAccess:$,validateOnChange:!0,validationSchema:d.Ry({itemId:d.Z_().required(),barcode:d.Z_().required()}),onSubmit:async e=>{let l={...e,recordId:parseInt(A)},r=await q({extension:x.$.Barcodes.set,record:JSON.stringify(l)});U.current&&(U.current.value=parseInt(r.recordId),await U.current.submit()),e.recordId?s.ZP.success(R.Edited):(s.ZP.success(R.Added),E.setFieldValue("recordId",E.values.barcode),E.setFieldValue("barcodeId",r.recordId)),B()}}),J=!!E.values.recordId;return(0,i.useEffect)(()=>{!async function(){if(k&&!J){E.setValues({...E.values,itemId:null==k?void 0:k.recordId,sku:null==k?void 0:k._reference,itemName:null==k?void 0:k._name,posDescription:null==k?void 0:k._name,scaleDescription:null==k?void 0:k._name});return}if(S&&A){let e=await P({extension:x.$.Barcodes.get,parameters:"_barcode=".concat(S)});E.setValues({...e.record,scaleDescription:e.record.scaleDescription,posDescription:e.record.posDescription,barcodeId:null==e?void 0:e.record.recordId,recordId:null==e?void 0:e.record.barcode})}}()},[]),(0,i.useEffect)(()=>{Q(null==k?void 0:k.nraId)},[null==k?void 0:k.nraId]),(0,n.jsx)(o.Z,{resourceId:u.i.Barcodes,form:E,maxAccess:V,editMode:J,children:(0,n.jsx)(v.R,{children:(0,n.jsx)(m.Q,{children:(0,n.jsxs)(a.ZP,{container:!0,spacing:2,children:[(0,n.jsx)(a.ZP,{item:!0,xs:8,children:(0,n.jsxs)(a.ZP,{container:!0,spacing:2,children:[(0,n.jsx)(a.ZP,{item:!0,xs:12,children:(0,n.jsx)(p.U,{endpointId:x.$.Item.snapshot,name:"itemId",label:null==F?void 0:F.sku,readOnly:J||!!(null==k?void 0:k._reference)&&!!(null==k?void 0:k._name),valueField:"recordId",displayField:"sku",valueShow:"sku",secondValueShow:"itemName",form:E,columnsInDropDown:[{key:"sku",value:"SKU"},{key:"name",value:"Name"}],onChange:(e,l)=>{E.setFieldValue("itemId",null==l?void 0:l.recordId),E.setFieldValue("itemName",null==l?void 0:l.name),E.setFieldValue("sku",null==l?void 0:l.sku),E.setFieldValue("itemRef",null==l?void 0:l.sku),E.setFieldValue("msId",null==l?void 0:l.msId),E.setFieldValue("scaleDescription",null==l?void 0:l.name),E.setFieldValue("posDescription",null==l?void 0:l.name)},maxAccess:V,required:!0,displayFieldWidth:2})}),(0,n.jsx)(a.ZP,{item:!0,xs:12,children:(0,n.jsx)(y.Z,{name:"barcode",label:null==F?void 0:F.barcode,value:null==E?void 0:null===(l=E.values)||void 0===l?void 0:l.barcode,maxLength:"20",readOnly:J,required:!0,maxAccess:$,onChange:E.handleChange,onClear:()=>E.setFieldValue("barcode",""),error:E.touched.barcode&&!!E.errors.barcode})}),(0,n.jsx)(a.ZP,{item:!0,xs:12,children:(0,n.jsx)(I.Z,{endpointId:x.$.MeasurementUnit.qry,parameters:(null==E?void 0:null===(r=E.values)||void 0===r?void 0:r.msId)?"_msId=".concat(null==E?void 0:null===(D=E.values)||void 0===D?void 0:D.msId):"",readOnly:!(null==E?void 0:null===(N=E.values)||void 0===N?void 0:N.msId),name:"muId",label:null==F?void 0:F.msUnit,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:E.values,onChange:(e,l)=>{E.setFieldValue("muId",null==l?void 0:l.recordId)},error:E.touched.muId&&!!E.errors.muId,maxAccess:V})})]})}),(0,n.jsx)(a.ZP,{item:!0,xs:4,children:(0,n.jsx)(t.Z,{ref:U,resourceId:u.i.Barcodes,seqNo:0,recordId:E.values.barcodeId})}),(0,n.jsx)(a.ZP,{item:!0,xs:12,children:(0,n.jsx)(g.Z,{name:"defaultQty",label:null==F?void 0:F.defaultQty,value:null==E?void 0:null===(j=E.values)||void 0===j?void 0:j.defaultQty,maxAccess:V,onChange:E.handleChange,onClear:()=>E.setFieldValue("defaultQty",""),error:E.touched.defaultQty&&!!E.errors.defaultQty})}),(0,n.jsx)(a.ZP,{item:!0,xs:12,children:(0,n.jsx)(y.Z,{name:"scaleDescription",label:null==F?void 0:F.scaleDescription,value:E.values.scaleDescription,maxAccess:V,maxLength:"20",onChange:E.handleChange,onClear:()=>E.setFieldValue("scaleDescription",""),error:E.touched.scaleDescription&&!!E.errors.scaleDescription})}),(0,n.jsx)(a.ZP,{item:!0,xs:12,children:(0,n.jsx)(y.Z,{name:"posDescription",label:null==F?void 0:F.posDescription,value:E.values.posDescription,maxAccess:V,maxLength:"25",onChange:E.handleChange,onClear:()=>E.setFieldValue("posDescription",""),error:E.touched.posDescription&&!!E.errors.posDescription})}),(0,n.jsx)(a.ZP,{item:!0,xs:12,children:(0,n.jsx)(C.Z,{name:"isInactive",value:null===(Z=E.values)||void 0===Z?void 0:Z.isInactive,onChange:e=>E.setFieldValue("isInactive",e.target.checked),label:null==F?void 0:F.isInactive,maxAccess:V})})]})})})})}F.width=750,F.height=500},10498:function(e){e.exports={container:"ImageUpload_container__I2BWx",previewBox:"ImageUpload_previewBox__JogCN",previewImage:"ImageUpload_previewImage___eqQX",bottomSection:"ImageUpload_bottomSection__jpph8"}}}]);