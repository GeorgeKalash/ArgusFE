"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[58669],{75163:function(e,l,d){d.d(l,{Z:function(){return A}});var t=d(52322),n=d(69387),a=d(60218),i=d(80983),s=d(8661),r=d(31389),o=d(62362),u=d(2784),c=d(65950),v=d(38449),m=d(22341),p=d(33625),I=d(27423),y=d(5088),x=d(19473),h=d(21326),f=d(54074),P=d(69627),b=d(71987),F=d(26612);function A(e){let{labels:l,shipment:d=!1,bill:A=!1,deliveryOrder:g=!1,form:V,handleAddressValues:w,checkedAddressId:D,window:k}=e,{getRequest:C}=(0,u.useContext)(c.$),{platformLabels:Z}=(0,u.useContext)(x.l);(0,h.Z)({title:Z.AddressFilter,window:k});let{formik:T}=(0,i.c)({initialValues:{search:"",cityId:null,countryId:null},validateOnChange:!0,onSubmit:async()=>{var e;let l=null==O?void 0:null===(e=O.list)||void 0===e?void 0:e.find(e=>e.checked);if(!(null==l?void 0:l.addressId)){w({shipAddress:"",BillAddress:"",address:""}),k.close();return}if(d||A||g){let e=await S(null==l?void 0:l.addressId);d&&w({shipAddress:e,shipAddressId:null==l?void 0:l.addressId,shipToAddressId:null==l?void 0:l.addressId}),A&&w({billAddress:e,billAddressId:null==l?void 0:l.addressId,billToAddressId:null==l?void 0:l.addressId}),g&&w({address:e,addressId:null==l?void 0:l.addressId})}k.close()}});async function S(e){var l;if(!e)return;let d=await C({extension:v.r.Address.format,parameters:"_addressId=".concat(e)});return null==d?void 0:null===(l=d.record)||void 0===l?void 0:l.formattedAddress.replace(/(\r\n|\r|\n)+/g,"\r\n")}let j=async function(){var e;let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{_startAt:d=0,_pageSize:t=50}=l,n=!!T.values.search&&!!T.values.countryId&&!!T.values.cityId&&!!V.clientId,a=await C({extension:n?m.P.FilterAddress.snapshot:m.P.Address.page,parameters:n?"_countryId=".concat(T.values.countryId,"&_cityId=").concat(T.values.cityId,"&_clientId=").concat(V.clientId,"&_filter=").concat(T.values.search):"_startAt=".concat(d,"&_pageSize=").concat(t,"&_params=1|").concat(V.clientId)}),i=(null==a?void 0:null===(e=a.list)||void 0===e?void 0:e.map(e=>{var l;return{addressId:e.addressId||e.recordId,address:null!==(l=e.formattedAddress)&&void 0!==l?l:"".concat(e.name||"",", ").concat(e.street1||"",", ").concat(e.street2||"",", ").concat(e.city||"",", ").concat(e.phone||"",",").concat(e.phone2||"",",").concat(e.email1||""),checked:(e.addressId||e.recordId)===D}}))||[];return{list:i,_startAt:d,count:i.length}},{query:{data:O},paginationParameters:N,refetch:_}=(0,b.J)({queryFn:j,endpointId:m.P.Address.page,datasetId:F.i.Address});async function R(){var e;let l=await C({extension:v.r.Defaults.get,parameters:"_filter=&_key=countryId"});T.setFieldValue("countryId",parseInt(null==l?void 0:null===(e=l.record)||void 0===e?void 0:e.value))}return(0,u.useEffect)(()=>{!async function(){await R()}()},[]),(0,t.jsx)(f.Z,{onSave:T.handleSubmit,children:(0,t.jsxs)(r.R,{children:[(0,t.jsx)(p.g,{children:(0,t.jsxs)(a.ZP,{container:!0,spacing:2,children:[(0,t.jsx)(a.ZP,{item:!0,xs:12,children:(0,t.jsx)(s.Z,{endpointId:v.r.Country.qry,name:"countryId",label:l.country,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:T.values,onChange:(e,l)=>{T.setFieldValue("cityId",""),T.setFieldValue("countryId",(null==l?void 0:l.recordId)||null)}})}),(0,t.jsx)(a.ZP,{item:!0,xs:12,children:(0,t.jsx)(I.U,{endpointId:v.r.City.snapshot,parameters:{_countryId:T.values.countryId,_stateId:0},valueField:"name",displayField:"name",name:"city",label:l.city,form:T,secondDisplayField:!1,onChange:(e,l)=>{T.setFieldValue("cityId",(null==l?void 0:l.recordId)||null),T.setFieldValue("city",(null==l?void 0:l.name)||null)}})}),(0,t.jsx)(a.ZP,{item:!0,xs:6,children:(0,t.jsx)(y.Z,{name:"search",value:T.values.search,label:l.search,onClear:()=>{T.setFieldValue("search","")},onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),e.stopPropagation())},onChange:T.handleChange})}),(0,t.jsx)(a.ZP,{item:!0,xs:2,children:(0,t.jsx)(P.Z,{label:l.apply,onClick:_,disabled:!(T.values.countryId&&T.values.cityId)})})]})}),(0,t.jsx)(o.Q,{children:(0,t.jsx)(n.Z,{name:"addressFilterTable",columns:[{field:"address",headerName:"",flex:6}],gridData:O,rowId:["addressId"],pageSize:50,paginationType:"api",paginationParameters:N,checkTitle:"",checkboxFlex:1,rowSelection:"single",showCheckboxColumn:!0,viewCheckButtons:!0})})]})})}A.width=950,A.height=600},58669:function(e,l,d){var t=d(52322),n=d(89330),a=d(39812),i=d(60218),s=d(2784),r=d(48601),o=d(82737),u=d(62202),c=d(65950),v=d(71987),m=d(26612),p=d(5088),I=d(21581),y=d(8661),x=d(38449),h=d(65215),f=d(7121),P=d(27423),b=d(62362),F=d(76399),A=d(31389),g=d(33625),V=d(91406),w=d(22341),D=d(80983),k=d(39704),C=d(61802),Z=d(19473),T=d(86626),S=d(18996),j=d(16096),O=d(75163),N=d(96026),_=d(98345),R=d(849),q=d(19689),L=d(19568),W=d(67920),z=d(50023),B=d(21326),Q=d(45937),E=d(90587),J=d(35934);let M=e=>{var l,M,U,X,$,K,Y,G,H,ee,el,ed,et,en,ea,ei,es,er;let{recordId:eo,currency:eu,window:ec}=e,{getRequest:ev,postRequest:em}=(0,s.useContext)(c.$),{stack:ep}=(0,C.zY)(),{stack:eI}=(0,N.V)(),{platformLabels:ey,defaultsData:ex,userDefaultsData:eh}=(0,s.useContext)(Z.l),[ef,eP]=(0,s.useState)({text:"%",value:2}),[eb,eF]=(0,s.useState)({}),eA=(0,s.useRef)([]),[eg,eV]=(0,s.useState)([]),[ew,eD]=(0,s.useState)(!1),[ek,eC]=(0,s.useState)({userDefaultsList:{},systemDefaultsList:{}}),eZ=(0,s.useRef)({}),{labels:eT,access:eS}=(0,z.Z)({datasetId:m.i.SalesOrder,editMode:!!eo});(0,B.Z)({title:eT.salesOrder,window:ec});let ej=(null==ex?void 0:null===(M=ex.list)||void 0===M?void 0:null===(l=M.find(e=>{let{key:l}=e;return"allowSalesNoLinesTrx"===l}))||void 0===l?void 0:l.value)=="true",{documentType:eO,maxAccess:eN,changeDT:e_}=(0,_.H)({functionId:f.J.SalesOrder,access:eS,enabled:!eo});async function eR(e){if(!e)return null;let l=await ev({extension:w.P.SalesPerson.get,parameters:"_recordId=".concat(e)}),d=null==l?void 0:l.record;return!d||d.isInactive?null:e}let eq={recordId:eo,dtId:null,reference:"",date:new Date,dueDate:new Date,plantId:null,clientId:"",currencyId:parseInt(eu),szId:"",spId:null,siteId:null,description:"",status:1,releaseStatus:"",wip:1,deliveryStatus:1,printStatusName:"",isVattable:!1,exWorks:!1,taxId:"",shipAddress:"",billAddress:"",subtotal:"",miscAmount:0,amount:0,vatAmount:"",tdAmount:0,overdraft:!1,plId:"",ptId:"",billToAddressId:"",shipToAddressId:"",maxDiscount:"",currentDiscount:"",exRate:1,rateCalcMethod:"",tdType:2,tdPct:0,initialTdPct:0,baseAmount:0,volume:"",weight:"",qty:0,serializedAddress:"",items:[{id:1,orderId:eo||0,itemId:"",sku:"",itemName:"",seqNo:"",siteId:"",muId:"",qty:0,volume:0,weight:1,msId:0,muQty:0,baseQty:0,mdType:1,basePrice:0,mdValue:0,unitPrice:0,unitCost:0,overheadId:"",vatAmount:0,mdAmount:0,upo:0,extendedPrice:0,mdAmountPct:null,priceType:1,applyVat:!1,taxId:"",taxDetails:null,notes:""}]},eL=(0,v.E)({endpointId:w.P.SalesOrder.page}),{schema:eW,requiredFields:ez}=(0,W.m)({sku:e=>null==e?void 0:e.sku,itemName:e=>null==e?void 0:e.itemName,qty:e=>(null==e?void 0:e.qty)>0},ej,eN,"items"),{formik:eB}=(0,D.c)({maxAccess:eN,documentType:{key:"dtId",value:null==eO?void 0:eO.dtId},conditionSchema:["items"],initialValues:eq,validateOnChange:!0,validationSchema:r.Ry({date:r.Z_().required(),currencyId:r.Z_().required(),clientId:r.Z_().required(),items:r.IX().of(eW)}),onSubmit:async e=>{var l;let d={...e};if(delete d.items,d.date=(0,a.ku)(d.date),d.dueDate=(0,a.ku)(d.dueDate),d.miscAmount=d.miscAmount||0,e.rateCalcMethod||delete d.rateCalcMethod,d.serializedAddress){let e={clientId:d.clientId,address:eb},l=await em({extension:w.P.Address.set,record:JSON.stringify(e)});d.shipToAddressId=l.recordId}let t=null===(l=e.items.filter(e=>{var l;return null===(l=Object.values(ez))||void 0===l?void 0:l.every(l=>l(e))}))||void 0===l?void 0:l.map((l,d)=>{let{physicalProperty:t,...n}=l;return{...n,seqNo:d+1,siteId:e.siteId,applyVat:e.isVattable}}),n=await em({extension:w.P.SalesOrder.set2,record:JSON.stringify({header:d,items:t})}),i=eQ?ey.Edited:ey.Added;u.ZP.success(i),await e0(n.recordId),eL()}}),eQ=!!eB.values.recordId,eE=2===eB.values.wip;async function eJ(e,l){if(!e)return;let d=(null==eg?void 0:eg.filter(e=>e.msId===l))||[];eA.current=d}function eM(e,l,d){let t=parseFloat(e)||0;return l===d?(t<0||t>100)&&(t=0):t<0&&(t=0),t}let eU=[{component:"resourcelookup",label:eT.sku,name:"sku",flex:2,props:{endpointId:h.$.Item.snapshot,parameters:{_categoryId:0,_msId:0,_startAt:0,_size:1e3},displayField:"sku",valueField:"sku",mapping:[{from:"recordId",to:"itemId"},{from:"sku",to:"sku"},{from:"name",to:"itemName"},{from:"msId",to:"msId"},{from:"isInactive",to:"isInactive"}],columnsInDropDown:[{key:"sku",value:"SKU"},{key:"name",value:"Item Name"}],displayFieldWidth:5},async onChange(e){var l,d,t;let{row:{update:n,newRow:a}}=e;if(!a.itemId)return;if(a.isInactive){n({...eB.initialValues.items[0],id:a.id}),eI({message:eT.inactiveItem});return}eJ(null==a?void 0:a.itemId,null==a?void 0:a.msId);let i=await e5(a.itemId),s=await e8(a.itemId),r=null==eg?void 0:null===(l=eg.filter(e=>e.recordId===(null==s?void 0:s.defSaleMUId)))||void 0===l?void 0:l[0],o=await e4(a.itemId,n,(null==r?void 0:r.recordId)||0),u=null,c=null;if(eB.values.taxId){let e=(await e9(eB.values.taxId)).map(e=>({taxId:eB.values.taxId,taxCodeId:e.taxCodeId,taxBase:e.taxBase,amount:e.amount}));u=eB.values.taxId,c=e}else if(s.taxId){let e=(await e9(s.taxId)).map(e=>({taxId:s.taxId,taxCodeId:e.taxCodeId,taxBase:e.taxBase,amount:e.amount}));u=s.taxId,c=e}n({volume:(null==i?void 0:i.volume)||0,weight:(null==i?void 0:i.weight)||0,vatAmount:(null==s?void 0:s.vatPct)||0,basePrice:(null==o?void 0:o.basePrice)||0,unitPrice:(null==o?void 0:o.unitPrice)||0,upo:(null==o?void 0:o.upo)||0,priceType:(null==o?void 0:o.priceType)||1,mdAmount:eB.values.initialTdPct||0,qty:0,msId:null==s?void 0:s.msId,muRef:(null==r?void 0:r.reference)||"",muId:(null==r?void 0:r.recordId)||null,muQty:0,extendedPrice:0,mdValue:0,taxId:u,taxDetails:c||null,mdType:1,siteId:null==eB?void 0:null===(d=eB.values)||void 0===d?void 0:d.siteId,siteRef:await lp(null==eB?void 0:null===(t=eB.values)||void 0===t?void 0:t.siteId)})}},{component:"textfield",label:eT.itemName,name:"itemName",flex:3,props:{readOnly:!0}},{component:"resourcecombobox",label:eT.site,name:"siteRef",props:{endpointId:h.$.Site.qry,displayField:"reference",valueField:"recordId",mapping:[{from:"recordId",to:"siteId"},{from:"reference",to:"siteRef"},{from:"name",to:"siteName"}],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],displayFieldWidth:3}},{component:"resourcecombobox",label:eT.measurementUnit,name:"muRef",props:{store:null==eA?void 0:eA.current,displayField:"reference",valueField:"recordId",mapping:[{from:"reference",to:"muRef"},{from:"qty",to:"muQty"},{from:"recordId",to:"muId"}]},async onChange(e){var l;let{row:{update:d,newRow:t}}=e;(null==t?void 0:t.muId)||d({baseQty:0});let n=null==eA?void 0:eA.current.find(e=>e.recordId===(null==t?void 0:t.muId)),a=null!==(l=null==t?void 0:t.muQty)&&void 0!==l?l:null==n?void 0:n.qty,i=await e4(null==t?void 0:t.itemId,"",null==t?void 0:t.muId);d(e7({...t,baseQty:(null==t?void 0:t.qty)*a||0,basePrice:(null==i?void 0:i.basePrice)||0,unitPrice:(null==i?void 0:i.unitPrice)||0,upo:(null==i?void 0:i.upo)||0,priceType:(null==i?void 0:i.priceType)||1},T.bT))},propsReducer(e){let{props:l}=e;return{...l,store:null==eA?void 0:eA.current}}},{component:"numberfield",label:eT.quantity,name:"qty",updateOn:"blur",props:{decimalScale:2},async onChange(e){var l;let{row:{update:d,newRow:t}}=e;eJ(null==t?void 0:t.itemId,null==t?void 0:t.msId);let n=null==eA?void 0:eA.current.find(e=>e.recordId===(null==t?void 0:t.muId)),a=null!==(l=null==t?void 0:t.muQty)&&void 0!==l?l:null==n?void 0:n.qty;d({...e7(t,T.bT),baseQty:(null==t?void 0:t.qty)*a})}},{component:"numberfield",label:eT.volume,name:"volume",props:{decimalScale:2,readOnly:!0}},{component:"numberfield",label:eT.weight,name:"weight",props:{decimalScale:2,readOnly:!0}},{component:"numberfield",label:eT.baseprice,name:"basePrice",updateOn:"blur",props:{decimalScale:5},async onChange(e){let{row:{update:l,newRow:d}}=e;l(e7(d,T.yO))}},{component:"numberfield",label:eT.unitPrice,name:"unitPrice",updateOn:"blur",props:{decimalScale:5},async onChange(e){let{row:{update:l,newRow:d}}=e;l(e7(d,T.Xf))}},{component:"numberfield",label:eT.upo,name:"upo",updateOn:"blur",props:{decimalScale:2},async onChange(e){let{row:{update:l,newRow:d}}=e;l(e7(d,T.zL))}},{component:"numberfield",label:eT.VAT,name:"vatAmount",props:{decimalScale:2,readOnly:!0}},{component:"button",name:"taxDetailsButton",props:{onCondition:e=>e.itemId&&e.taxId?{imgSrc:d(54022).default.src,hidden:!1}:{imgSrc:"",hidden:!0}},label:eT.tax,onClick:(e,l)=>{ep({Component:L.Z,props:{taxId:null==l?void 0:l.taxId,obj:l}})}},{component:"numberfield",label:eT.markdown,name:"mdAmount",updateOn:"blur",flex:2,props:{decimalScale:2,ShowDiscountIcons:!0,iconsClicked:eX,type:"numeric",iconKey:e=>{let{value:l,data:d}=e;return((null==l?void 0:l.mdType)||(null==d?void 0:d.mdType))===T.Xo?"%":"123"}},async onChange(e){let{row:{update:l,newRow:d}}=e;l(e7(d,T.On)),function(e,l){let d=Number(e.unitPrice)*(eB.values.maxDiscount/100);if(eB.values.maxDiscount){var t;1==e.mdType?e.mdAmount>eB.values.maxDiscount&&(t=eB.values.maxDiscount,parseFloat(e.mdAmount)>t&&(eB.setFieldValue("mdAmount",t),e.mdAmount=t,l(e7(e,T.On)),eI({message:eT.clientMaxPctDiscount+" "+t+"%"}))):e.mdAmount>d&&e.mdAmount>d&&(eB.setFieldValue("mdType",2),eB.setFieldValue("mdAmount",d),e.mdType=2,e.mdAmount=d,l(e7(e,T.On)),eI({message:eT.clientMaxDiscount+" "+d}))}}(d,l)}},{component:"button",name:"saTrx",label:eT.salesTrx,props:{onCondition:e=>({disabled:!e.itemId})},onClick:(e,l,d,t)=>{var n;ep({Component:R.Z,props:{recordId:0,functionId:f.J.SalesInvoice,itemId:null==l?void 0:l.itemId,clientId:null==eB?void 0:null===(n=eB.values)||void 0===n?void 0:n.clientId}})}},{component:"numberfield",label:eT.extendedprice,name:"extendedPrice",updateOn:"blur",props:{decimalScale:2},async onChange(e){let{row:{update:l,newRow:d}}=e;l(e7(d,T.bh))}},{component:"textfield",label:eT.notes,name:"notes",flex:2}];async function eX(e){let{updateRow:l,value:d,data:t}=e,n=((null==d?void 0:d.mdType)||(null==t?void 0:t.mdType))===T.Xo?T.RD:T.Xo,a=eM(null==d?void 0:d.mdAmount,n,T.Xo);l({id:t.id,changes:{mdAmount:a,mdAmountPct:n,mdType:n},commitOnBlur:!0})}async function e$(){let e={...eB.values};delete e.items,e.date=(0,a.ku)(e.date),e.dueDate=(0,a.ku)(e.dueDate);let l=await em({extension:w.P.SalesOrder.cancel,record:JSON.stringify(e)});u.ZP.success(ey.Cancel),eL(),await e0(l.recordId)}async function eK(){let e={...eB.values};delete e.items,e.date=(0,a.ku)(e.date),e.dueDate=(0,a.ku)(e.dueDate),await em({extension:w.P.SalesOrder.postToInvoice,record:JSON.stringify(e)}),u.ZP.success(ey.Invoice),eL(),ec.close()}async function eY(){ep({Component:k.Z,props:{functionId:f.J.SalesOrder,recordId:eB.values.recordId}})}async function eG(){let e=await em({extension:E.u.ProductionOrderFromSaleOrder.gen,record:JSON.stringify({soId:eB.values.recordId})});ep({Component:J.Z,props:{recordId:e.recordId}}),u.ZP.success(ey.Generated)}let eH=[{key:"RecordRemarks",condition:!0,onClick:"onRecordRemarks",disabled:!eQ},{key:"Approval",condition:!0,onClick:"onApproval",disabled:!eE},{key:"Close",condition:!eE,onClick:async function(){let e={...eB.values};delete e.items,e.date=(0,a.ku)(e.date),e.dueDate=(0,a.ku)(e.dueDate);let l=await em({extension:w.P.SalesOrder.close,record:JSON.stringify(e)});u.ZP.success(ey.Closed),eL(),await e0(l.recordId)},disabled:eE||!eQ},{key:"Reopen",condition:eE,onClick:async function(){let e={...eB.values};delete e.items,e.date=(0,a.ku)(e.date),e.dueDate=(0,a.ku)(e.dueDate);let l=await em({extension:w.P.SalesOrder.reopen,record:JSON.stringify(e)});u.ZP.success(ey.Reopened),eL(),await e0(l.recordId)},disabled:!(eE&&(1==eB.values.deliveryStatus||5==eB.values.deliveryStatus))},{key:"Terminate",condition:!0,onClick:e$,disabled:!((2==eB.values.deliveryStatus||1==eB.values.deliveryStatus)&&4==eB.values.status)},{key:"WorkFlow",condition:!0,onClick:eY,disabled:!eQ},{key:"Invoice",condition:!0,onClick:eK,disabled:!(1===eB.values.deliveryStatus&&3!==eB.values.status&&eE)},{key:"generateProdOrder",condition:!0,onClick:eG,disabled:!(1===eB.values.deliveryStatus&&3!==eB.values.status&&eE)}];async function e0(e){var l;if(!e)return;let{header:d,items:t}=await e2(e),n=await e6(null==d?void 0:d.clientId),a=await e1(null==d?void 0:d.shipToAddressId),i=await e1(null==d?void 0:d.billToAddressId);(null==d?void 0:d.tdType)==1||(null==d?void 0:d.tdType)==null?eP({text:"123",value:1}):eP({text:"%",value:2});let s=(null==d?void 0:d.isVattable)?eZ.current:{},r=(null==t?void 0:t.length)!=0?await Promise.all(null==t?void 0:t.map(async(e,l)=>{let d=await e8(null==e?void 0:e.itemId);return{...e,id:l+1,basePrice:e.basePrice,unitPrice:e.unitPrice,upo:e.upo,vatAmount:e.vatAmount,extendedPrice:e.extendedPrice,msId:(null==d?void 0:d.msId)||e.msId,taxDetails:(null==s?void 0:s[null==e?void 0:e.taxId])||null}})):eB.initialValues.items;eB.setValues({...d,currentDiscount:(null==d?void 0:d.tdType)==1||(null==d?void 0:d.tdType)==null?null==d?void 0:d.tdAmount:null==d?void 0:d.tdPct,amount:parseFloat(null==d?void 0:d.amount).toFixed(2),shipAddress:a,billAddress:i,tdPct:(null==d?void 0:d.tdPct)||0,initialTdPct:(null==n?void 0:null===(l=n.record)||void 0===l?void 0:l.tdPct)||0,items:r})}async function e2(e){var l,d;let t=await ev({extension:w.P.SalesOrder.get2,parameters:"_recordId=".concat(e)});return t.record.header.date=(0,a.a1)(null==t?void 0:null===(d=t.record)||void 0===d?void 0:null===(l=d.header)||void 0===l?void 0:l.date),t.record}async function e1(e){var l;if(!e)return;let d=await ev({extension:x.r.Address.format,parameters:"_addressId=".concat(e)});return null==d?void 0:null===(l=d.record)||void 0===l?void 0:l.formattedAddress.replace(/(\r\n|\r|\n)+/g,"\r\n")}let e6=async e=>{if(e)return await ev({extension:w.P.Client.get,parameters:"_recordId=".concat(e)})};async function e3(e){var l,d,t,n,a,i,s,r,o;if(!e)return;let u=await e6(e);eB.setFieldValue("currencyId",null==u?void 0:null===(l=u.record)||void 0===l?void 0:l.currencyId);let c=await eR((null==u?void 0:null===(d=u.record)||void 0===d?void 0:d.spId)||eB.values.spId);eB.setFieldValue("spId",c),eB.setFieldValue("ptId",null==u?void 0:null===(t=u.record)||void 0===t?void 0:t.ptId),eB.setFieldValue("plId",(null==u?void 0:null===(n=u.record)||void 0===n?void 0:n.plId)||ek.systemDefaultsList.plId||0),eB.setFieldValue("szId",null==u?void 0:null===(a=u.record)||void 0===a?void 0:a.szId),eB.setFieldValue("shipToAddressId",(null==u?void 0:null===(i=u.record)||void 0===i?void 0:i.shipAddressId)||null),eB.setFieldValue("billToAddressId",(null==u?void 0:null===(s=u.record)||void 0===s?void 0:s.billAddressId)||null);let v=await e1(null==u?void 0:null===(r=u.record)||void 0===r?void 0:r.shipAddressId),m=await e1(null==u?void 0:null===(o=u.record)||void 0===o?void 0:o.billAddressId);eB.setFieldValue("shipAddress",v||""),eB.setFieldValue("billAddress",m||"")}async function e5(e){let l=await ev({extension:h.$.ItemPhysProp.get,parameters:"_itemId=".concat(e)});return null==l?void 0:l.record}async function e8(e){let l=await ev({extension:h.$.Item.get,parameters:"_recordId=".concat(e)});return null==l?void 0:l.record}async function e9(e){return e&&eZ.current[e]?eZ.current[e]:[]}async function e4(e,l,d){if(!eB.values.currencyId){l({itemId:null,itemName:null,sku:null}),eI({message:eT.noCurrency});return}let t=await ev({extension:w.P.ItemConvertPrice.get,parameters:"_itemId=".concat(e,"&_clientId=").concat(eB.values.clientId,"&_currencyId=").concat(eB.values.currencyId,"&_plId=").concat(eB.values.plId,"&_muId=").concat(d||0)});return null==t?void 0:t.record}function e7(e,l,d){var t,n;ew||eD(!0);let a=eM(null==e?void 0:e.mdAmount,null==e?void 0:e.mdType,T.Xo),i=(0,T.Ch)({priceType:(null==e?void 0:e.priceType)||0,basePrice:parseFloat(null==e?void 0:e.basePrice)||0,volume:(null==e?void 0:e.volume)||0,weight:null==e?void 0:e.weight,unitPrice:(null==e?void 0:e.unitPrice)||0,upo:parseFloat(null==e?void 0:e.upo)||0,qty:null==e?void 0:e.qty,extendedPrice:null==e?void 0:e.extendedPrice,mdAmount:a,mdType:null==e?void 0:e.mdType,baseLaborPrice:0,totalWeightPerG:0,mdValue:null==e?void 0:e.mdValue,tdPct:(null==eB?void 0:null===(t=eB.values)||void 0===t?void 0:t.tdPct)||0,dirtyField:l}),s=(0,S.VW)({priceType:null==i?void 0:i.priceType,basePrice:null==i?void 0:i.basePrice,qty:null==i?void 0:i.qty,weight:null==i?void 0:i.weight,extendedPrice:null==i?void 0:i.extendedPrice,baseLaborPrice:null==i?void 0:i.baseLaborPrice,vatAmount:(null==i?void 0:i.vatAmount)||0,tdPct:(null==eB?void 0:null===(n=eB.values)||void 0===n?void 0:n.tdPct)||0,taxDetails:eB.values.isVattable?e.taxDetails:null}),r={...e,id:null==e?void 0:e.id,qty:null==i?void 0:i.qty,volume:null==i?void 0:i.volume,weight:null==i?void 0:i.weight,basePrice:null==i?void 0:i.basePrice,unitPrice:null==i?void 0:i.unitPrice,extendedPrice:null==i?void 0:i.extendedPrice,upo:null==i?void 0:i.upo,mdValue:null==i?void 0:i.mdValue,mdType:null==i?void 0:i.mdType,mdAmount:null==i?void 0:i.mdAmount,vatAmount:null==s?void 0:s.vatAmount};return d?{changes:r}:r}let le=null===(U=eB.values.items)||void 0===U?void 0:U.filter(e=>void 0!==e.itemId).map(e=>({...e,basePrice:e.basePrice||0,unitPrice:e.unitPrice||0,upo:e.upo||0,vatAmount:e.vatAmount||0,weight:e.weight||0,volume:e.volume||0,extendedPrice:e.extendedPrice||0})),ll=(0,j.Ww)(le),ld=0==eB.values.miscAmount?0:parseFloat(eB.values.miscAmount),lt=(0,j.Ot)(le,{totalQty:0,totalWeight:0,totalVolume:0,totalUpo:0,sumVat:0,sumExtended:parseFloat(ll),tdAmount:parseFloat(eB.values.tdAmount),net:0,miscAmount:ld}),ln=ew?null==lt?void 0:lt.totalQty:(null===(X=eB.values)||void 0===X?void 0:X.qty)||0,la=ew?null==lt?void 0:lt.net:(null===($=eB.values)||void 0===$?void 0:$.amount)||0,li=ew?null==lt?void 0:lt.totalVolume:(null===(K=eB.values)||void 0===K?void 0:K.volume)||0,ls=ew?null==lt?void 0:lt.totalWeight:(null===(Y=eB.values)||void 0===Y?void 0:Y.weight)||0,lr=ew?ll:(null===(G=eB.values)||void 0===G?void 0:G.subtotal)||0,lo=ew?null==lt?void 0:lt.sumVat:(null===(H=eB.values)||void 0===H?void 0:H.vatAmount)||0;function lu(e,l,d,t){var n;n=function(e,l,d,t){var n;let a=(0,j.Yi)({tdAmount:parseFloat(t),tdPlain:1==e,tdPct:2==e,tdType:e,subtotal:lr,currentDiscount:t,hiddenTdPct:l,hiddenTdAmount:parseFloat(d),typeChange:e});return eB.setFieldValue("tdAmount",(null==a?void 0:a.hiddenTdAmount)?null==a?void 0:null===(n=a.hiddenTdAmount)||void 0===n?void 0:n.toFixed(2):0),eB.setFieldValue("tdType",null==a?void 0:a.tdType),eB.setFieldValue("currentDiscount",(null==a?void 0:a.currentDiscount)||0),eB.setFieldValue("tdPct",(null==a?void 0:a.hiddenTdPct)||0),(null==a?void 0:a.hiddenTdPct)||0}(e,l,d,t),eB.values.items.map((e,l)=>{let d=(0,S.VW)({priceType:null==e?void 0:e.priceType,basePrice:null==e?void 0:e.basePrice,qty:null==e?void 0:e.qty,weight:null==e?void 0:e.weight,extendedPrice:null==e?void 0:e.extendedPrice,baseLaborPrice:parseFloat(null==e?void 0:e.baseLaborPrice),vatAmount:null==e?void 0:e.vatAmount,tdPct:n,taxDetails:eB.values.isVattable?e.taxDetails:null});eB.setFieldValue("items[".concat(l,"].vatAmount"),null==d?void 0:d.vatAmount)})}function lc(e){Object.entries(e).forEach(e=>{let[l,d]=e;eB.setFieldValue(l,d)})}function lv(e,l){var d,t;ep({Component:O.Z,props:{maxAccess:eN,labels:eT,shipment:e,bill:l,checkedAddressId:e?null===(d=eB.values)||void 0===d?void 0:d.shipToAddressId:null===(t=eB.values)||void 0===t?void 0:t.billToAddressId,form:eB.values,handleAddressValues:lc}})}let lm=async()=>{var e,l;let d=await ev({extension:w.P.SalesOrder.pack,parameters:""}),t=((null==d?void 0:null===(e=d.record)||void 0===e?void 0:e.taxDetails)||[]).reduce((e,l)=>(e[l.taxId]||(e[l.taxId]=[]),e[l.taxId].push(l),e),{});return eZ.current=t,(null==d?void 0:null===(l=d.record)||void 0===l?void 0:l.measurementUnits)||[]};async function lp(e){var l;if(!e)return;let d=await ev({extension:h.$.Site.get,parameters:"_recordId=".concat(e)});return null==d?void 0:null===(l=d.record)||void 0===l?void 0:l.reference}async function lI(){let e=["siteId","salesTD","plId"],l=["plantId","siteId","spId"],d=((null==ex?void 0:ex.list)||[]).reduce((l,d)=>{let{key:t,value:n}=d;return e.includes(t)&&(l[t]="True"===n||"False"===n?n:n?parseInt(n):null),l},{}),t=((null==eh?void 0:eh.list)||[]).reduce((e,d)=>{let{key:t,value:n}=d;return l.includes(t)&&(e[t]=n?parseInt(n):null),e},{});return eC(e=>({...e,userDefaultsList:t,systemDefaultsList:d})),{userDefaultsList:t,systemDefaultsList:d}}async function ly(e){var l,d;if(!e)return;let t=await ev({extension:w.P.DocumentTypeDefault.get,parameters:"_dtId=".concat(e)}),n=await eR((null==t?void 0:null===(l=t.record)||void 0===l?void 0:l.spId)||ek.userDefaultsList.spId);eB.setFieldValue("spId",n),eB.setFieldValue("plantId",(null==t?void 0:null===(d=t.record)||void 0===d?void 0:d.plantId)||ek.userDefaultsList.plantId||null)}async function lx(){let e={printStatus:2,recordId:eB.values.recordId};await em({extension:w.P.PrintedSA.printed,record:JSON.stringify(e)}),eL()}return(0,s.useEffect)(()=>{let e="",{name:l,street1:d,street2:t,city:n,phone:a,phone2:i,email1:s}=eb;(l||d||t||n||a||i||s)&&(e="".concat(l||"","\n").concat(d||"","\n").concat(t||"","\n").concat(n||"","\n").concat(a||"","\n").concat(i||"","\n").concat(s||"")),eB.setFieldValue("shipAddress",e),eB.setFieldValue("serializedAddress",e)},[eb]),(0,s.useEffect)(()=>{eB.setFieldValue("qty",parseFloat(ln).toFixed(2)),eB.setFieldValue("amount",parseFloat(la).toFixed(2)),eB.setFieldValue("volume",parseFloat(li).toFixed(2)),eB.setFieldValue("weight",parseFloat(ls).toFixed(2)),eB.setFieldValue("subtotal",parseFloat(lr).toFixed(2)),eB.setFieldValue("vatAmount",parseFloat(lo).toFixed(2))},[ln,la,li,ls,lr,lo]),(0,s.useEffect)(()=>{if(ew){let e=parseFloat(eB.values.tdPct)*parseFloat(lr)/100;lu(eB.values.tdType,eB.values.tdPct,e,eB.values.currentDiscount)}},[lr]),(0,s.useEffect)(()=>{var e,l;(null===(e=eB.values)||void 0===e?void 0:e.dtId)&!eo&&ly(null===(l=eB.values)||void 0===l?void 0:l.dtId)},[null===(ee=eB.values)||void 0===ee?void 0:ee.dtId]),(0,s.useEffect)(()=>{!async function(){eV(await lm());let e=await lI();if(eo)e0(eo);else{e.systemDefaultsList.salesTD?(eP({text:"%",value:2}),eB.setFieldValue("tdType",2)):(eP({text:"123",value:1}),eB.setFieldValue("tdType",1));let l=e.userDefaultsList.siteId,d=e.systemDefaultsList.siteId,t=e.userDefaultsList.plantId,n=e.userDefaultsList.spId,a=await eR(parseInt(n));eB.setFieldValue("siteId",parseInt(l||d)),eB.setFieldValue("spId",a),eB.setFieldValue("plantId",parseInt(t))}}()},[]),(0,t.jsx)(o.Z,{resourceId:m.i.SalesOrder,functionId:f.J.SalesOrder,form:eB,maxAccess:eN,previewReport:eQ,previewBtnClicked:lx,isClosed:eE,actions:eH,editMode:eQ,disabledSubmit:eE&&!eQ,disabledSavedClear:eE&&!eQ,children:(0,t.jsxs)(A.R,{children:[(0,t.jsx)(g.g,{children:(0,t.jsxs)(i.ZP,{container:!0,spacing:2,children:[(0,t.jsx)(i.ZP,{item:!0,xs:8,children:(0,t.jsxs)(i.ZP,{container:!0,spacing:2,children:[(0,t.jsx)(i.ZP,{item:!0,xs:4,children:(0,t.jsx)(y.Z,{endpointId:w.P.SalesOrder.pack,reducer:e=>{var l;return null==e?void 0:null===(l=e.record)||void 0===l?void 0:l.documentTypes},name:"dtId",label:eT.documentType,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],readOnly:eQ,valueField:"recordId",displayField:["reference","name"],values:eB.values,maxAccess:eN,onChange:(e,l)=>{e_(l),eB.setFieldValue("dtId",(null==l?void 0:l.recordId)||null)},error:eB.touched.dtId&&!!eB.errors.dtId})}),(0,t.jsx)(i.ZP,{item:!0,xs:4,children:(0,t.jsx)(y.Z,{endpointId:w.P.SalesOrder.pack,reducer:e=>{var l;return null==e?void 0:null===(l=e.record)||void 0===l?void 0:l.salesPeople},filter:eQ?void 0:e=>!e.isInactive,name:"spId",label:eT.salesPerson,columnsInDropDown:[{key:"spRef",value:"Reference"},{key:"name",value:"Name"}],readOnly:eE,valueField:"recordId",displayField:"name",values:eB.values,displayFieldWidth:1.5,maxAccess:eN,onChange:(e,l)=>{eB.setFieldValue("spId",l?l.recordId:null)},error:eB.touched.spId&&!!eB.errors.spId})}),(0,t.jsx)(i.ZP,{item:!0,xs:4,children:(0,t.jsx)(y.Z,{endpointId:w.P.SalesOrder.pack,reducer:e=>{var l;return null==e?void 0:null===(l=e.record)||void 0===l?void 0:l.currencies},name:"currencyId",label:eT.currency,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],required:!0,readOnly:eE,values:eB.values,maxAccess:eN,onChange:(e,l)=>{eB.setFieldValue("currencyId",(null==l?void 0:l.recordId)||null),eB.setFieldValue("items",[{id:1}])},error:eB.touched.currencyId&&!!eB.errors.currencyId})}),(0,t.jsx)(i.ZP,{item:!0,xs:4,children:(0,t.jsx)(p.Z,{name:"reference",label:eT.reference,value:null==eB?void 0:null===(el=eB.values)||void 0===el?void 0:el.reference,maxAccess:!eQ&&eN,readOnly:eQ,onChange:eB.handleChange,onClear:()=>eB.setFieldValue("reference",""),error:eB.touched.reference&&!!eB.errors.reference})}),(0,t.jsx)(i.ZP,{item:!0,xs:4,children:(0,t.jsx)(n.Z,{name:"date",required:!0,label:eT.date,value:null==eB?void 0:null===(ed=eB.values)||void 0===ed?void 0:ed.date,onChange:eB.setFieldValue,editMode:eQ,readOnly:eE,maxAccess:eN,onClear:()=>eB.setFieldValue("date",""),error:eB.touched.date&&!!eB.errors.date})}),(0,t.jsx)(i.ZP,{item:!0,xs:4,children:(0,t.jsx)(y.Z,{endpointId:w.P.SalesOrder.pack,reducer:e=>{var l;return null==e?void 0:null===(l=e.record)||void 0===l?void 0:l.plants},name:"plantId",label:eT.plant,readOnly:eE,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:eB.values,valueField:"recordId",displayField:["reference","name"],maxAccess:eN,onChange:(e,l)=>{eB.setFieldValue("plantId",l?l.recordId:null)},displayFieldWidth:2,error:eB.touched.plantId&&!!eB.errors.plantId})})]})}),(0,t.jsx)(i.ZP,{item:!0,xs:4,children:(0,t.jsxs)(i.ZP,{container:!0,spacing:2,children:[(0,t.jsx)(i.ZP,{item:!0,xs:6,children:(0,t.jsx)(I.Z,{name:"shipAddress",label:eT.shipTo,value:eB.values.shipAddress,rows:2.5,maxLength:"100",readOnly:!0,disabled:eB.values.exWorks,maxAccess:eN,viewDropDown:eB.values.clientId,viewAdd:eB.values.clientId&&!eQ,onChange:e=>eB.setFieldValue("shipAddress",e.target.value),onClear:()=>eB.setFieldValue("shipAddress",""),onDropDown:()=>lv(!0,!1),handleAddAction:()=>void ep({Component:Q.Z,props:{address:eb,setAddress:eF,isCleared:!1,datasetId:m.i.ADDSalesOrder}})})}),(0,t.jsx)(i.ZP,{item:!0,xs:6,children:(0,t.jsx)(I.Z,{name:"billAddress",label:eT.billTo,value:eB.values.billAddress,rows:2.5,maxLength:"100",readOnly:eE,maxAccess:eN,viewDropDown:eB.values.clientId,onChange:e=>eB.setFieldValue("BillAddress",e.target.value),onClear:()=>eB.setFieldValue("BillAddress",""),onDropDown:()=>lv(!1,!0)})})]})}),(0,t.jsx)(i.ZP,{item:!0,xs:3,children:(0,t.jsx)(P.U,{endpointId:w.P.Client.snapshot,valueField:"reference",displayField:"name",secondFieldLabel:eT.name,name:"clientId",label:eT.client,form:eB,required:!0,readOnly:eE,displayFieldWidth:6,valueShow:"clientRef",secondValueShow:"clientName",maxAccess:eN,editMode:eQ,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"},{key:"szName",value:"Sales Zone"}],onChange:async(e,l)=>{eB.setFieldValue("clientId",null==l?void 0:l.recordId),eB.setFieldValue("clientName",null==l?void 0:l.name),eB.setFieldValue("clientRef",null==l?void 0:l.reference),eB.setFieldValue("isVattable",(null==l?void 0:l.isSubjectToVAT)||!1),eB.setFieldValue("maxDiscount",null==l?void 0:l.maxDiscount),eB.setFieldValue("tdPct",null==l?void 0:l.tdPct),eB.setFieldValue("initialTdPct",null==l?void 0:l.tdPct),eB.setFieldValue("taxId",null==l?void 0:l.taxId),eF({}),e3(null==l?void 0:l.recordId)},errorCheck:"clientId"})}),(0,t.jsx)(i.ZP,{item:!0,xs:1,children:(0,t.jsx)(q.Z,{name:"isVattable",value:null===(et=eB.values)||void 0===et?void 0:et.isVattable,onChange:e=>eB.setFieldValue("isVattable",e.target.checked),label:eT.VAT,disabled:null===(en=eB.values.items[0])||void 0===en?void 0:en.itemId,maxAccess:eN})}),(0,t.jsx)(i.ZP,{item:!0,xs:2,children:(0,t.jsx)(y.Z,{endpointId:w.P.SalesOrder.pack,reducer:e=>{var l;return null==e?void 0:null===(l=e.record)||void 0===l?void 0:l.taxSchedules},name:"taxId",label:eT.tax,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],readOnly:!0,values:eB.values,onChange:(e,l)=>{eB.setFieldValue("taxId",l?l.recordId:"")},error:eB.touched.taxId&&!!eB.errors.taxId,maxAccess:eN})}),(0,t.jsx)(i.ZP,{item:!0,xs:2,children:(0,t.jsx)(y.Z,{endpointId:w.P.SalesOrder.pack,reducer:e=>{var l;return null==e?void 0:null===(l=e.record)||void 0===l?void 0:l.sites},name:"siteId",readOnly:eE,label:eT.site,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:eB.values,valueField:"recordId",displayField:["reference","name"],maxAccess:eN,displayFieldWidth:2,onChange:(e,l)=>{eB.setFieldValue("siteId",l?l.recordId:null),eB.setFieldValue("siteRef",l?l.reference:null),eB.setFieldValue("siteName",l?l.name:null)},error:eB.touched.siteId&&!!eB.errors.siteId})}),(0,t.jsx)(i.ZP,{item:!0,xs:2,children:(0,t.jsx)(y.Z,{endpointId:w.P.SalesOrder.pack,reducer:e=>{var l;return null==e?void 0:null===(l=e.record)||void 0===l?void 0:l.saleZones},name:"szId",label:eT.saleZone,valueField:"recordId",displayField:"name",readOnly:eE,values:eB.values,displayFieldWidth:1.5,maxAccess:eN,onChange:(e,l)=>{eB.setFieldValue("szId",l?l.recordId:null)},error:eB.touched.szId&&!!eB.errors.szId})}),(0,t.jsx)(i.ZP,{item:!0,xs:2,children:(0,t.jsx)(q.Z,{name:"exWorks",value:null===(ea=eB.values)||void 0===ea?void 0:ea.exWorks,onChange:e=>{let{name:l,checked:d}=e.target;eB.setFieldValue(l,d),d&&eB.setFieldValue("shipAddress","")},label:eT.exWorks,maxAccess:eN,disabled:eE})})]})}),(0,t.jsx)(b.Q,{children:(0,t.jsx)(F._,{onChange:(e,l)=>{eB.setFieldValue("items",e),"delete"===l&&eD(!0)},onSelectionChange:(e,l,d)=>{"muRef"==d&&eJ(null==e?void 0:e.itemId,null==e?void 0:e.msId)},value:eB.values.items,error:eB.errors.items,initialValues:null==eB?void 0:null===(es=eB.initialValues)||void 0===es?void 0:null===(ei=es.items)||void 0===ei?void 0:ei[0],columns:eU,name:"items",maxAccess:eN,disabled:eE||!eB.values.clientId,allowDelete:!eE})}),(0,t.jsx)(g.g,{children:(0,t.jsxs)(i.ZP,{container:!0,spacing:2,sx:{pt:2},children:[(0,t.jsx)(i.ZP,{item:!0,xs:6,children:(0,t.jsxs)(i.ZP,{container:!0,spacing:2,children:[(0,t.jsx)(i.ZP,{item:!0,xs:12,children:(0,t.jsx)(I.Z,{name:"description",label:eT.description,value:eB.values.description,rows:3,editMode:eQ,readOnly:eE,maxAccess:eN,onChange:e=>eB.setFieldValue("description",e.target.value),onClear:()=>eB.setFieldValue("description",""),error:eB.touched.description&&!!eB.errors.description})}),(0,t.jsx)(i.ZP,{item:!0,xs:12,children:(0,t.jsx)(q.Z,{name:"overdraft",value:null===(er=eB.values)||void 0===er?void 0:er.overdraft,onChange:e=>eB.setFieldValue("overdraft",e.target.checked),readOnly:!0,label:eT.overdraft,maxAccess:eS})})]})}),(0,t.jsx)(i.ZP,{item:!0,xs:3,children:(0,t.jsxs)(i.ZP,{container:!0,spacing:2,children:[(0,t.jsx)(i.ZP,{item:!0,xs:12,children:(0,t.jsx)(V.Z,{name:"totalQTY",label:eT.totQty,value:ln,readOnly:!0})}),(0,t.jsx)(i.ZP,{item:!0,xs:12,children:(0,t.jsx)(V.Z,{name:"totalVolume",maxAccess:eN,label:eT.totVolume,value:li,readOnly:!0})}),(0,t.jsx)(i.ZP,{item:!0,xs:12,children:(0,t.jsx)(V.Z,{name:"totalWeight",maxAccess:eN,label:eT.totWeight,value:ls,readOnly:!0})})]})}),(0,t.jsx)(i.ZP,{item:!0,xs:3,children:(0,t.jsxs)(i.ZP,{container:!0,spacing:2,children:[(0,t.jsx)(i.ZP,{item:!0,xs:12,children:(0,t.jsx)(V.Z,{name:"subTotal",maxAccess:eN,label:eT.subtotal,value:lr,readOnly:!0})}),(0,t.jsx)(i.ZP,{item:!0,xs:12,children:(0,t.jsx)(V.Z,{name:"discount",maxAccess:eN,label:eT.discount,value:eB.values.currentDiscount,displayCycleButton:!0,readOnly:eE,iconKey:ef.text,cycleButtonLabel:ef.text,decimalScale:2,handleButtonClick:()=>{let e,l,d;eD(!0),1==ef.value?(e=parseFloat(l=eB.values.currentDiscount<0||eB.values.currentDiscount>100?0:eB.values.currentDiscount)*parseFloat(lr)/100,d=l,eB.setFieldValue("tdAmount",e),eB.setFieldValue("tdPct",l),eB.setFieldValue("currentDiscount",l)):(l=parseFloat(e=eB.values.currentDiscount<0||lr<eB.values.currentDiscount?0:eB.values.currentDiscount)/parseFloat(lr)*100,d=e,eB.setFieldValue("tdPct",l),eB.setFieldValue("tdAmount",e),eB.setFieldValue("currentDiscount",e)),eP(t=>{let n="%"===t.text?{text:"123",value:1}:{text:"%",value:2};return eB.setFieldValue("tdType",n.value),lu(n.value,l,e,d),n})},ShowDiscountIcons:!0,onChange:e=>{let l=Number(e.target.value.replace(/,/g,""));1==eB.values.tdType?((l<0||lr<l)&&(l=0),eB.setFieldValue("tdAmount",l)):((l<0||l>100)&&(l=0),eB.setFieldValue("tdPct",l)),eB.setFieldValue("currentDiscount",l)},onBlur:async e=>{eD(!0);let l=Number(e.target.value.replace(/,/g,"")),d=Number(e.target.value.replace(/,/g,"")),t=Number(e.target.value.replace(/,/g,""));1==eB.values.tdType&&(d=parseFloat(l)/parseFloat(lr)*100,eB.setFieldValue("tdPct",d)),2==eB.values.tdType&&(t=parseFloat(l)*parseFloat(lr)/100,eB.setFieldValue("tdAmount",t)),lu(eB.values.tdType,d,t,l)},onClear:()=>{eB.setFieldValue("tdAmount",0),eB.setFieldValue("tdPct",0),lu(eB.values.tdType,0,0,0)}})}),(0,t.jsx)(i.ZP,{item:!0,xs:12,children:(0,t.jsx)(V.Z,{name:"miscAmount",maxAccess:eN,label:eT.misc,value:eB.values.miscAmount||0,decimalScale:2,readOnly:eE,onChange:e=>eB.setFieldValue("miscAmount",e.target.value),onBlur:async()=>{eD(!0)},onClear:()=>{eB.setFieldValue("miscAmount",0)}})}),(0,t.jsx)(i.ZP,{item:!0,xs:12,children:(0,t.jsx)(V.Z,{name:"vatAmount",maxAccess:eN,label:eT.VAT,value:lo,readOnly:!0})}),(0,t.jsx)(i.ZP,{item:!0,xs:12,children:(0,t.jsx)(V.Z,{name:"amount",maxAccess:eN,label:eT.net,value:la,readOnly:!0})})]})})]})})]})})};M.width=1300,M.height=750,l.Z=M}}]);