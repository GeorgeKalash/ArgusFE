(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[44129],{2801:function(e,l,d){"use strict";var r=d(52322),n=d(23925),a=d(2784),i=d(80983),o=d(65950),t=d(38449),s=d(19473),u=d(35656),c=d(10498),v=d.n(c),m=d(69627);let I=(0,a.forwardRef)((e,l)=>{let{resourceId:c,error:I,seqNo:p,recordId:x,width:h=140,height:f=140,customWidth:y,customHeight:g,disabled:F=!1,isAbsolutePath:Z=!1,parentImage:j}=e,C=(0,a.useRef)(null),k=(0,a.useRef)(null),S=(0,a.useRef)({}),{getRequest:w,postRequest:_}=(0,a.useContext)(o.$),{platformLabels:b}=(0,a.useContext)(s.l),[N,P]=(0,a.useState)(""),A=null==j?void 0:j.recordId,V=null==j?void 0:j.resourceId,{formik:O}=(0,i.c)({initialValues:{}}),{width:q}=(0,u.d)(),D=q>=1680?1:q>=1600?.9:q<=1024?.7:.7+(q-1024)/576*.22000000000000008;(0,a.useImperativeHandle)(l,()=>({submit:R}));let R=()=>{var e,d,r,n,a,i,o,s,u,v,m,I;if(F)return;let p=(null==l?void 0:null===(e=l.current)||void 0===e?void 0:e.value)||x;if(Z){if((null===(i=O.values)||void 0===i?void 0:null===(a=i.file)||void 0===a?void 0:a.name)||O.values.url){let e={...O.values,fileName:(null===(u=O.values.file)||void 0===u?void 0:u.name)||O.values.url,resourceId:c,recordId:p};return _({extension:t.r.Attachment.set2,record:JSON.stringify(e),file:null===(v=O.values)||void 0===v?void 0:v.file}).then(()=>z(p))}return N||null===(o=S.current)||void 0===o||!o.fileName||(null===(s=O.values)||void 0===s?void 0:s.fileName)?void 0:_({extension:t.r.Attachment.del,record:JSON.stringify(S.current)}).then(()=>z(p))}if(null===(d=O.values)||void 0===d?void 0:d.file){let e={...O.values,recordId:p};return _({extension:t.r.Attachment.set,record:JSON.stringify(e),file:null===(m=O.values)||void 0===m?void 0:m.file}).then(()=>z(p))}if(!N&&(null===(r=S.current)||void 0===r?void 0:r.url)&&!(null===(n=O.values)||void 0===n?void 0:n.url))return _({extension:t.r.Attachment.del,record:JSON.stringify(S.current),file:null===(I=S.current)||void 0===I?void 0:I.url}).then(()=>z(p))},G=()=>{P(""),O.setValues({})},z=async e=>{let l=e||x;if(!c)return;if(Z&&l){let e=await w({extension:t.r.Attachment.get2,parameters:"_resourceId=".concat(c,"&_seqNo=").concat(p,"&_recordId=").concat(l)}),d=(null==e?void 0:e.record)||{};O.setValues({...d,resourceId:c}),S.current={...d,resourceId:c},P((null==d?void 0:d.fileName)?"".concat(d.fileName,"?t=").concat(Date.now()):"");return}let d=V||c,r=A||l;if(!r)return;let n=await w({extension:t.r.Attachment.get,parameters:"_resourceId=".concat(d,"&_seqNo=").concat(p,"&_recordId=").concat(r)}),a=(null==n?void 0:n.record)||{};O.setValues({...a,resourceId:d}),S.current={...a,resourceId:d},P((null==a?void 0:a.url)?"".concat(a.url,"?t=").concat(Date.now()):"")};return(0,a.useEffect)(()=>{A||x?z():G()},[A,x]),(0,r.jsxs)(n.Z,{className:v().container,children:[(0,r.jsx)(n.Z,{className:v().previewBox,style:{width:"100%",maxWidth:(y||h)*D,height:(g||f)*D},onClick:()=>{F||C.current.click()},children:(0,r.jsx)("img",{src:N||d(68802).default.src,alt:"",className:v().previewImage,style:{border:I?"2px solid #F44336":"none"},onError:e=>{e.currentTarget.src=d(68802).default.src}})}),(0,r.jsxs)(n.Z,{className:v().bottomSection,children:[(0,r.jsx)("input",{hidden:!0,type:"file",accept:"image/png, image/jpeg, image/jpg",ref:C,onChange:e=>{var l,d;let r=null==e?void 0:null===(d=e.target)||void 0===d?void 0:null===(l=d.files)||void 0===l?void 0:l[0];if(!r)return;if(Math.round(r.size/1024)>500){alert(b.MaxFileSize);return}let n=new Date(r.lastModifiedDate),a="".concat(n.getDate(),"/").concat(n.getMonth()+1,"/").concat(n.getFullYear());O.setValues({resourceId:c,recordId:x,seqNo:0,fileName:r.name,folderId:null,folderName:null,date:a,url:null,file:r});let i=new FileReader;k.current=i,i.onloadend=e=>P(e.target.result),i.readAsDataURL(r)},disabled:F}),(0,r.jsx)(m.Z,{onClick:G,image:"clear.png",tooltipText:b.Clear,color:"#F44336",border:"none",disabled:F})]})]})});l.Z=I},44129:function(e,l,d){"use strict";d.d(l,{Z:function(){return N}});var r=d(52322),n=d(60218),a=d(2784),i=d(48601),o=d(82737),t=d(2801),s=d(62202),u=d(65950),c=d(26612),v=d(5088),m=d(80983),I=d(19473),p=d(31389),x=d(89330),h=d(8661),f=d(38449),y=d(7121),g=d(21581),F=d(98345),Z=d(39812),j=d(65215),C=d(33625),k=d(63518),S=d(84100),w=d(90587),_=d(50023),b=d(21326);function N(e){var l,d,N,P,A,V;let{recordId:O,invalidate:q,window:D}=e,{getRequest:R,postRequest:G}=(0,a.useContext)(u.$),{platformLabels:z}=(0,a.useContext)(I.l),L=(0,a.useRef)(null),J=y.J.Sketch,{labels:E,access:T}=(0,_.Z)({datasetId:c.i.Sketch,editMode:!!O});(0,b.Z)({title:null==E?void 0:E.Sketch,window:D});let{documentType:U,maxAccess:M,changeDT:$}=(0,F.H)({functionId:J,access:T,enabled:!O});function B(){q&&q()}let{formik:W}=(0,m.c)({documentType:{key:"dtId",value:null==U?void 0:U.dtId},initialValues:{recordId:null,reference:"",dtId:null,date:new Date,designerId:null,itemGroupId:null,productionClassId:null,productionStandardId:null,designGroupId:null,designFamilyId:null,metalId:null,collectionId:null,source:null,statusName:"",notes:"",status:1,wip:1},maxAccess:M,validateOnChange:!0,validationSchema:i.Ry({date:i.hT().required(),itemGroupId:i.Z_().required(),source:i.Z_().required(),productionLineId:i.Rx().required()}),onSubmit:async e=>{let l={...e,date:(0,Z.ku)(null==e?void 0:e.date)},d=await G({extension:k.z.Sketch.set,record:JSON.stringify(l)});L.current&&(L.current.value=d.recordId,await L.current.submit()),await Y(d.recordId),B(),s.ZP.success(X?z.Edited:z.Added)}});async function H(e){if(e){var l;let d=await R({extension:k.z.DocumentTypeDefault.get,parameters:"_dtId=".concat(e)});return W.setFieldValue("productionLineId",(null==d?void 0:null===(l=d.record)||void 0===l?void 0:l.productionLineId)||null),d}}(0,a.useEffect)(()=>{var e;W.values.dtId&&!O&&H(null==W?void 0:null===(e=W.values)||void 0===e?void 0:e.dtId)},[W.values.dtId]);let K=2===W.values.wip,Q=3===W.values.status,X=!!W.values.recordId;async function Y(e){var l;let d=await R({extension:k.z.Sketch.get,parameters:"_recordId=".concat(e)});d.record.date=(0,Z.a1)(null==d?void 0:null===(l=d.record)||void 0===l?void 0:l.date),W.setValues({...d.record})}let ee=[{key:"Approval",condition:!0,onClick:"onApproval",disabled:!K},{key:"Locked",condition:Q,onClick:"onUnpostConfirmation",disabled:!0},{key:"Unlocked",condition:!Q,onClick:async()=>{var e;let l={...W.values,date:(0,Z.ku)(null===(e=W.values)||void 0===e?void 0:e.date)};await G({extension:k.z.Sketch.post,record:JSON.stringify(l)}),await Y(W.values.recordId),s.ZP.success(z.Posted),B()},disabled:!X||!K},{key:"Close",condition:!K,onClick:async()=>{await G({extension:k.z.Sketch.close,record:JSON.stringify({recordId:W.values.recordId})}),await Y(W.values.recordId),s.ZP.success(z.Closed),B()},disabled:!X||Q},{key:"Reopen",condition:K,onClick:async()=>{var e;let l={...W.values,date:(0,Z.ku)(null===(e=W.values)||void 0===e?void 0:e.date)};await G({extension:k.z.Sketch.reopen,record:JSON.stringify(l)}),await Y(W.values.recordId),s.ZP.success(z.Reopened),B()},disabled:!X||Q}];return(0,a.useEffect)(()=>{!async function(){O&&await Y(O)}()},[]),(0,r.jsx)(o.Z,{resourceId:c.i.Sketch,form:W,maxAccess:M,editMode:X,actions:ee,functionId:J,disabledSubmit:K||Q,children:(0,r.jsx)(p.R,{children:(0,r.jsx)(C.g,{children:(0,r.jsxs)(n.ZP,{container:!0,spacing:2,children:[(0,r.jsx)(n.ZP,{item:!0,xs:6,children:(0,r.jsxs)(n.ZP,{container:!0,spacing:2,children:[(0,r.jsx)(n.ZP,{item:!0,xs:12,children:(0,r.jsx)(h.Z,{endpointId:f.r.DocumentType.qry,parameters:"_dgId=".concat(J,"&_startAt=0&_pageSize=50"),filter:X?void 0:e=>1===e.activeStatus,name:"dtId",label:E.documentType,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],valueField:"recordId",displayField:["reference","name"],readOnly:X,values:null==W?void 0:W.values,onChange:async(e,l)=>{W.setFieldValue("dtId",(null==l?void 0:l.recordId)||null),$(l),(null==l?void 0:l.recordId)||W.setFieldValue("productionLineId",null)},error:W.touched.dtId&&!!W.errors.dtId,maxAccess:M})}),(0,r.jsx)(n.ZP,{item:!0,xs:12,children:(0,r.jsx)(v.Z,{name:"reference",label:E.reference,value:null==W?void 0:null===(l=W.values)||void 0===l?void 0:l.reference,readOnly:X,maxAccess:!X&&M,onChange:W.handleChange,onClear:()=>W.setFieldValue("reference",""),error:W.touched.reference&&!!W.errors.reference})}),(0,r.jsx)(n.ZP,{item:!0,xs:12,children:(0,r.jsx)(h.Z,{datasetId:S.v.SKETCH_SOURCE,name:"source",label:E.sketchSource,valueField:"key",displayField:"value",required:!0,values:W.values,onChange:(e,l)=>{W.setFieldValue("source",(null==l?void 0:l.key)||null)},readOnly:Q||K,maxAccess:M,error:W.touched.source&&!!W.errors.source})}),(0,r.jsx)(n.ZP,{item:!0,xs:12,children:(0,r.jsx)(h.Z,{endpointId:k.z.Designer.qry,name:"designerId",label:E.designer,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name",width:4},{key:"typeName",value:"Type"}],displayFieldWidth:2,readOnly:K,maxAccess:M,values:W.values,onChange:(e,l)=>{W.setFieldValue("designerId",(null==l?void 0:l.recordId)||null)},error:W.touched.designerId&&!!W.errors.designerId})}),(0,r.jsx)(n.ZP,{item:!0,xs:12,children:(0,r.jsx)(h.Z,{endpointId:w.u.DesignFamily.qry,name:"designFamilyId",label:E.familyGroup,valueField:"recordId",displayField:"name",values:W.values,readOnly:Q||K,onChange:(e,l)=>W.setFieldValue("designFamilyId",(null==l?void 0:l.recordId)||null),error:(null==W?void 0:null===(d=W.touched)||void 0===d?void 0:d.designFamilyId)&&!!(null==W?void 0:null===(N=W.errors)||void 0===N?void 0:N.designFamilyId),maxAccess:M})}),(0,r.jsx)(n.ZP,{item:!0,xs:12,children:(0,r.jsx)(h.Z,{endpointId:w.u.DesignGroup.qry,name:"designGroupId",label:E.designGroup,valueField:"recordId",displayField:"name",values:W.values,readOnly:Q||K,onChange:(e,l)=>{W.setFieldValue("designGroupId",(null==l?void 0:l.recordId)||null)},error:(null==W?void 0:null===(P=W.touched)||void 0===P?void 0:P.designGroupId)&&!!(null==W?void 0:null===(A=W.errors)||void 0===A?void 0:A.designGroupId),maxAccess:M})}),(0,r.jsx)(n.ZP,{item:!0,xs:12,children:(0,r.jsx)(x.Z,{name:"date",label:E.date,value:null==W?void 0:null===(V=W.values)||void 0===V?void 0:V.date,required:!0,onChange:W.setFieldValue,onClear:()=>W.setFieldValue("date",null),readOnly:Q||K,error:W.touched.date&&!!W.errors.date,maxAccess:M})}),(0,r.jsx)(n.ZP,{item:!0,xs:12,children:(0,r.jsx)(h.Z,{endpointId:j.$.Metals.qry,name:"metalId",label:E.purity,valueField:"recordId",displayField:["reference"],values:W.values,onChange:(e,l)=>{W.setFieldValue("metalId",(null==l?void 0:l.recordId)||null),W.setFieldValue("metalPurity",(null==l?void 0:l.purity)||null)},readOnly:Q||K,error:W.touched.metalId&&!!W.errors.metalId,maxAccess:M})}),(0,r.jsx)(n.ZP,{item:!0,xs:12,children:(0,r.jsx)(h.Z,{endpointId:j.$.Group.qry,parameters:"_startAt=0&_pageSize=1000",values:W.values,name:"itemGroupId",required:!0,label:E.itemGroup,valueField:"recordId",displayField:["reference","name"],displayFieldWidth:1,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],readOnly:Q||K,maxAccess:M,onChange:(e,l)=>{W.setFieldValue("itemGroupId",(null==l?void 0:l.recordId)||null)},error:W.touched.itemGroupId&&W.errors.itemGroupId})}),(0,r.jsx)(n.ZP,{item:!0,xs:12,children:(0,r.jsx)(h.Z,{endpointId:w.u.ProductionClass.qry,values:W.values,name:"productionClassId",label:E.productionClass,valueField:"recordId",displayField:"name",maxAccess:M,readOnly:Q||K,onChange:(e,l)=>{W.setFieldValue("productionClassId",(null==l?void 0:l.recordId)||null)},error:W.touched.productionClassId&&!!W.errors.productionClassId})}),(0,r.jsx)(n.ZP,{item:!0,xs:12,children:(0,r.jsx)(h.Z,{endpointId:w.u.ProductionStandard.qry,values:W.values,name:"productionStandardId",label:E.productionStandard,valueField:"recordId",displayField:"reference",maxAccess:M,readOnly:Q||K,onChange:(e,l)=>{W.setFieldValue("productionStandardId",(null==l?void 0:l.recordId)||null)},error:W.touched.productionStandardId&&!!W.errors.productionStandardId})}),(0,r.jsx)(n.ZP,{item:!0,xs:12,children:(0,r.jsx)(h.Z,{endpointId:j.$.Collections.qry,name:"collectionId",label:E.collection,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],maxAccess:M,readOnly:Q||K,values:W.values,onChange:(e,l)=>{W.setFieldValue("collectionId",(null==l?void 0:l.recordId)||null)},error:W.touched.collectionId&&!!W.errors.collectionId})})]})}),(0,r.jsx)(n.ZP,{item:!0,xs:6,children:(0,r.jsxs)(n.ZP,{container:!0,spacing:2,children:[(0,r.jsx)(n.ZP,{item:!0,xs:12,children:(0,r.jsx)(t.Z,{ref:L,resourceId:c.i.Sketch,seqNo:0,recordId:O,height:250})}),(0,r.jsx)(n.ZP,{item:!0,xs:12,children:(0,r.jsx)(h.Z,{endpointId:w.u.ProductionLine.qry,parameters:"_startAt=0&_pageSize=1000",values:W.values,name:"productionLineId",label:E.productionLine,valueField:"recordId",displayField:["reference","name"],maxAccess:M,required:!0,onChange:(e,l)=>{W.setFieldValue("productionLineId",(null==l?void 0:l.recordId)||null)},readOnly:!0,error:W.touched.productionLineId&&W.errors.productionLineId})}),(0,r.jsx)(n.ZP,{item:!0,xs:12,children:(0,r.jsx)(v.Z,{name:"statusName",label:E.status,readOnly:!0,value:W.values.statusName})}),(0,r.jsx)(n.ZP,{item:!0,xs:12,children:(0,r.jsx)(g.Z,{name:"notes",type:"text",label:E.notes,value:W.values.notes,readOnly:Q||K,rows:3,maxAccess:M,onChange:e=>W.setFieldValue("notes",e.target.value||null),onClear:()=>W.setFieldValue("notes",""),error:W.touched.notes&&!!W.errors.notes})})]})})]})})})})}},10498:function(e){e.exports={container:"ImageUpload_container__I2BWx",previewBox:"ImageUpload_previewBox__JogCN",previewImage:"ImageUpload_previewImage___eqQX",bottomSection:"ImageUpload_bottomSection__jpph8"}}}]);