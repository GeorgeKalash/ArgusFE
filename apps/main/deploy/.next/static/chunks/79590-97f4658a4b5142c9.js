"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[79590],{64581:function(e,l){l.Z={src:"/_next/static/media/imgSerials.d1ee59bb.png",height:17,width:23,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAGCAMAAADJ2y/JAAAAIVBMVEUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABt0UjBAAAAC3RSTlMCZzsmQ6RbWbaSTwNdgTwAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAArSURBVHicY2BiZ2BgYOBiZmBmYmRjZGRhYGBg4eBkZWVDYjAzMbKDpWCKARB/AJwjPQgCAAAAAElFTkSuQmCC",blurWidth:8,blurHeight:6}},93736:function(e,l,a){a.d(l,{K:function(){return i}});let d="RG.FI.asmx/",i={FiOpeningBalance:{gen:d+"genOBA"},FiAging:{qry:d+"FI404"},AccountSummary:{AccFI405b:d+"FI405b"},DocumentAging:{AgingFI406a:d+"FI406a",AgingFI406b:d+"FI406b"},TrialBalance:{FI402View:d+"FI402o",FI401o2:d+"FI401o2"}}},67920:function(e,l,a){a.d(l,{m:function(){return i}});var d=a(48601);function i(e,l,a){var i;let t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"items",n={...e};return null==a||null===(i=a.record)||void 0===i||i.controls.forEach(e=>{let{controlId:l,accessLevel:a}=e,[d,i]=null==l?void 0:l.split(".");d!==t||2!==a||i in n||(n[i]=e=>(null==e?void 0:e[i])!=null),(1===a||4===a)&&i in n&&delete n[i]}),{schema:d.Ry().shape({...Object.keys(n).reduce((e,a)=>(e[a]=d.nK().nullable().test(function(e){var d;let i=this.parent,[,t]=this.path.match(/^(\w+)\[(\d+)\]/)||[],o=(null===(d=this.options.context)||void 0===d?void 0:d[t])||[];if(l||!l&&o.length>1){if(null!==i[a]&&void 0!==i[a]&&0!==i[a]&&""!==n[a]&&!n[a](i))return!1;if(!Object.entries(n).some(e=>{let[,l]=e;return!!l(i)}))return!0}return!!n[a](i)&&void 0!==e}),e),{})}),requiredFields:n}}},16463:function(e,l,a){a.d(l,{Z:function(){return F}});var d=a(52322),i=a(2784),t=a(49864),n=a(65950),o=a(27423),r=a(26612),u=a(71987),s=a(33625),c=a(62362),v=a(31389),m=a(8661),h=a(25870),p=a(69627),I=a(84100),x=a(19473),y=a(80983),f=a(38449),b=a(69387),A=a(93736),g=a(21326);function F(e){let{accountId:l,moduleId:a,window:F}=e,{getRequest:P}=(0,i.useContext)(n.$),{platformLabels:V}=(0,i.useContext)(x.l),[C,w]=(0,i.useState)([]);(0,g.Z)({title:V.AccountSummary,window:F});let{labels:N,access:k}=(0,u.J)({datasetId:r.i.AccountSummary}),T=[{field:"days",headerName:N.days,flex:1,type:"number"}],[Z,j]=(0,i.useState)(T),{formik:S}=(0,y.c)({maxAccess:k,initialValues:{accountId:null,accountRef:"",accountName:"",agpId:null,moduleId:a}});async function D(){var e,l,d,i;let t;let n=2,o=[...T],r=await P({extension:f.r.Currency.qry,parameters:"_filter="});if(1==a?t=null==r?void 0:null===(e=r.list)||void 0===e?void 0:e.filter(e=>e.sale):2==a&&(t=null==r?void 0:null===(l=r.list)||void 0===l?void 0:l.filter(e=>e.purchase)),0==t.length)return;null==t||t.forEach((e,l)=>{o.push({field:"column".concat(l+1),headerName:e.reference,flex:1,type:"number"})}),j(o);let u=await P({extension:h.H.AgingLeg.qry,parameters:"_agpId=".concat(S.values.agpId)}),s=null==u?void 0:null===(d=u.list)||void 0===d?void 0:d.map(e=>{let l=Array(t.length+2).fill(0);return l[0]=null,l[1]=e.days,l}),c=(t||[]).map(e=>P({extension:A.K.AccountSummary.AccFI405b,parameters:"_agpId=".concat(S.values.agpId,"&_currencyId=").concat(e.recordId,"&_accountId=").concat(S.values.accountId)}).then(e=>({summaryRes:e})));(await Promise.all(c)).forEach(e=>{var l;let{summaryRes:a}=e;null==a||null===(l=a.list)||void 0===l||l.forEach(e=>{null==s||s.forEach(l=>{l[1]==e.seqDays&&(l[n]=e.amount)})}),n++});let v=Array(t.length+2).fill(null);for(let e=2;e<t.length+2;e++){let l=0;null==s||s.map(a=>{l+=Number(a[e]||0)}),v[e]=l}let m=s.filter(e=>null!==e[1]).map(e=>{let[l,a,...d]=e,i={days:a};return d.forEach((e,l)=>{i["column".concat(l+1)]=e.toFixed(2)}),i}),p={};for(let e=0;e<t.length;e++)p["column".concat(e+1)]=null!==(i=v[e+2].toFixed(2))&&void 0!==i?i:0;m.push(p),w({list:m})}return(0,i.useEffect)(()=>{!async function(){if(l&&a){var e,d,i;let a=await P({extension:h.H.Account.get,parameters:"_recordId=".concat(l)});S.setFieldValue("accountId",null==a?void 0:null===(e=a.record)||void 0===e?void 0:e.recordId),S.setFieldValue("accountRef",null==a?void 0:null===(d=a.record)||void 0===d?void 0:d.reference),S.setFieldValue("accountName",null==a?void 0:null===(i=a.record)||void 0===i?void 0:i.name)}}()},[]),(0,d.jsxs)(v.R,{children:[(0,d.jsx)(s.g,{children:(0,d.jsxs)(t.Z,{container:!0,spacing:2,p:2,children:[(0,d.jsx)(t.Z,{item:!0,xs:12,children:(0,d.jsx)(o.U,{endpointId:h.H.Account.snapshot,name:"accountId",label:N.account,valueField:"reference",displayField:"name",valueShow:"accountRef",secondValueShow:"accountName",form:S,readOnly:S.values.accountId&&S.values.moduleId,required:!0,maxAccess:k,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],onChange:async(e,l)=>{S.setFieldValue("accountId",(null==l?void 0:l.recordId)||null),S.setFieldValue("accountName",(null==l?void 0:l.name)||""),S.setFieldValue("accountRef",(null==l?void 0:l.reference)||"")}})}),(0,d.jsx)(t.Z,{item:!0,xs:6,children:(0,d.jsx)(m.Z,{endpointId:h.H.AgingProfile.qry,parameters:"_startAt=0&_pageSize=1000&filter=",name:"agpId",label:N.agingProfile,values:S.values,valueField:"recordId",displayField:"name",maxAccess:k,required:!0,onChange:(e,l)=>{S.setFieldValue("agpId",(null==l?void 0:l.recordId)||null),(null==l?void 0:l.recordId)||w({list:[]})}})}),(0,d.jsx)(t.Z,{item:!0,xs:5,children:(0,d.jsx)(m.Z,{datasetId:I.v.FI_AGING_MODULE,label:N.module,name:"moduleId",values:S.values,valueField:"key",displayField:"value",maxAccess:k,required:!0,readOnly:S.values.moduleId,onChange:(e,l)=>{S.setFieldValue("moduleId",(null==l?void 0:l.key)||null)}})}),(0,d.jsx)(t.Z,{item:!0,xs:1,children:(0,d.jsx)(p.Z,{onClick:D,image:"preview.png",disabled:!S.values.agpId||!S.values.moduleId||!S.values.accountId,tooltipText:V.Preview})})]})}),(0,d.jsx)(c.Q,{children:(0,d.jsx)(b.Z,{columns:Z,gridData:C,isLoading:!1,pagination:!1})})]})}F.width=1e3,F.height=500},45937:function(e,l,a){var d=a(52322),i=a(38449),t=a(93894),n=a(2784),o=a(65950),r=a(19473),u=a(21326);let s=e=>{let{recordId:l,editMode:a,onSubmit:s=()=>{},window:c,actions:v=[],address:m,setAddress:h,required:p=!0,...I}=e,{getRequest:x,postRequest:y}=(0,n.useContext)(o.$),{platformLabels:f}=(0,n.useContext)(r.l),[b,A]=(0,n.useState)(l||null),[g,F]=(0,n.useState)(null),P=!!m&&!!h,V=P?m:g,C=P?h:F;(0,u.Z)({title:f.Address,window:c});let w=async e=>{if(!p){C(e),s(e,c);return}let l={...e,recordId:b||(null==V?void 0:V.recordId)||null},a=await y({extension:i.r.Address.set,record:JSON.stringify(l)}),d=(null==a?void 0:a.recordId)||b||null,t={...l,recordId:d,addressId:d};A(d),C(t),s(t,c)};return(0,n.useEffect)(()=>{!P&&b&&(async()=>{let e=await x({extension:i.r.Address.get,parameters:"_filter=&_recordId=".concat(b)});F((null==e?void 0:e.record)||null)})()},[b,P]),(0,d.jsx)(t.O,{editMode:a,setAddress:C,address:V,onSubmit:w,actions:v,window:c,...I})};s.width=600,s.height=500,l.Z=s},93894:function(e,l,a){a.d(l,{O:function(){return c}});var d=a(52322),i=a(2784),t=a(82737),n=a(13073),o=a(80983),r=a(31389),u=a(33625),s=a(48601);let c=e=>{let{setAddress:l,address:a,editMode:c,window:v,readOnly:m,allowPost:h=!0,optional:p=!1,onSubmit:I,isSavedClear:x=!0,isCleared:y=!0,changeClear:f=!1,actions:b=[],...A}=e,[g,F]=(0,i.useState)(!p),[P,V]=(0,i.useState)({}),{formik:C}=(0,o.c)({maxAccess:P.maxAccess,initialValues:{recordId:null,name:"",countryId:null,countryName:"",stateId:null,stateName:"",cityId:null,city:"",street1:"",street2:"",email1:"",email2:"",phone:"",phone2:"",phone3:"",addressId:null,postalCode:"",cityDistrictId:null,cityDistrict:"",bldgNo:"",unitNo:"",subNo:"",poBox:""},validateOnChange:!0,validateOnBlur:!0,validationSchema:s.Ry({...P.validate}),onSubmit:e=>{l(e),h?I(e,v):v.close()}});return(0,i.useEffect)(()=>{p&&(C.values.name||C.values.street1||C.values.countryId||C.values.cityId)&&F(!0),!p||C.values.name||C.values.street1||C.values.countryId||C.values.cityId||F(!1)},[C.values]),(0,d.jsx)(t.Z,{form:C,maxAccess:P.maxAccess,isInfo:!1,disabledSubmit:m,editMode:c,isSavedClear:x,isCleared:y,onClear:f?()=>{C.resetForm({values:C.initialValues})}:void 0,actions:b,...A,children:(0,d.jsx)(r.R,{children:(0,d.jsx)(u.g,{children:(0,d.jsx)(n.Z,{addressValidation:C,readOnly:m,required:g,setFormik:V,address:a,...A})})})})}},79590:function(e,l,a){a.d(l,{Z:function(){return Y}});var d=a(52322),i=a(89330),t=a(39812),n=a(60218),o=a(2784),r=a(48601),u=a(82737),s=a(62202),c=a(65950),v=a(71987),m=a(5088),h=a(21581),p=a(8661),I=a(65215),x=a(27423),y=a(62362),f=a(76399),b=a(31389),A=a(33625),g=a(91406),F=a(22341),P=a(25870),V=a(80983),C=a(39704),w=a(849),N=a(61802),k=a(19473),T=a(86626),Z=a(18996),j=a(16096),S=a(75163),D=a(1251),O=a(26553),R=a(96026),_=a(98345),q=a(78618),M=a(19689),L=a(26612),W=a(77595),B=a(30657),E=a(19568),G=a(85572),U=a(16463),Q=a(45937),$=a(67920),K=a(7121),J=a(58276),z=a(69627),X=a(72747);function Y(e){var l,Y,H,ee,el,ea,ed,ei,et,en,eo,er,eu,es,ec,ev,em,eh,ep,eI,ex,ey,ef,eb,eA,eg,eF,eP,eV,eC,ew,eN,ek,eT,eZ,ej,eS,eD,eO,eR,e_,eq,eM,eL,eW,eB,eE,eG,eU,eQ,e$,eK,eJ,ez,eX,eY,eH,e0,e2,e1,e3,e6,e5,e8,e9,e4,e7,le,ll,la,ld,li,lt,ln,lo,lr,lu,ls,lc,lv,lm,lh,lp,lI,lx,ly,lf,lb,lA,lg,lF,lP,lV,lC,lw,lN,lk,lT,lZ,lj,lS,lD,lO,lR;let{labels:l_,access:lq,recordId:lM,functionId:lL,window:lW,lockRecord:lB,getResourceId:lE,getGLResource:lG}=e,{getRequest:lU,postRequest:lQ}=(0,o.useContext)(c.$),{addLockedScreen:l$}=(0,o.useContext)(J.Z),{stack:lK}=(0,R.V)(),{stack:lJ}=(0,N.zY)(),{platformLabels:lz,defaultsData:lX,userDefaultsData:lY}=(0,o.useContext)(k.l),[lH,l0]=(0,o.useState)({text:"%",value:j.a$}),[l2,l1]=(0,o.useState)([]),[l3,l6]=(0,o.useState)({}),[l5,l8]=(0,o.useState)(!1),[l9,l4]=(0,o.useState)(null),[l7,ae]=(0,o.useState)(null),[al,aa]=(0,o.useState)(!1),ad=(0,o.useRef)([]),ai=(0,o.useRef)({}),{documentType:at,maxAccess:an}=(0,_.H)({functionId:lL,access:lq,enabled:!lM,objectName:"header"}),ao=(0,v.E)({endpointId:F.P.SalesTransaction.qry}),ar=(null==lX?void 0:null===(Y=lX.list)||void 0===Y?void 0:null===(l=Y.find(e=>{let{key:l}=e;return"allowSalesNoLinesTrx"===l}))||void 0===l?void 0:l.value)=="true",{schema:au,requiredFields:as}=(0,$.m)({sku:e=>null==e?void 0:e.sku,itemName:e=>null==e?void 0:e.itemName,qty:e=>(null==e?void 0:e.qty)>0},ar);async function ac(e){if(!e)return null;let l=await lU({extension:F.P.SalesPerson.get,parameters:"_recordId=".concat(e)}),a=null==l?void 0:l.record;return!a||a.isInactive?null:e}let{formik:av}=(0,V.c)({maxAccess:an,documentType:{key:"header.dtId",value:null==at?void 0:at.dtId},initialValues:{recordId:lM||null,search:"",header:{dgId:lL,recordId:null,dtId:null,reference:"",date:new Date,dueDate:new Date,plantId:null,clientId:null,clientName:"",clientRef:"",currencyId:null,currencyName:"",szId:null,spId:null,siteId:null,description:"",status:1,isVattable:!1,taxId:null,subtotal:0,miscAmount:0,amount:0,vatAmount:0,tdAmount:0,plId:null,ptId:null,billAddressId:null,billAddress:"",maxDiscount:"",currentDiscount:0,exRate:1,rateCalcMethod:1,tdType:j.a$,tdPct:0,baseAmount:0,volume:0,weight:0,qty:0,isVerified:!1,contactId:null,commitItems:!1,postMetalToFinancials:!1,metalPrice:0,KGmetalPrice:0,balance:0,accountId:0},items:[{id:1,orderId:lM||0,barcode:"",itemId:"",sku:"",itemName:"",seqNo:1,siteId:null,muId:null,qty:0,defaultQty:null,volume:0,weight:0,isMetal:!1,metalId:null,metalPurity:0,msId:0,muRef:"",muQty:0,minPrice:0,baseQty:0,mdType:T.Xo,basePrice:0,baseLaborPrice:0,totalWeightPerG:0,mdValue:0,unitPrice:0,unitCost:0,overheadId:"",vatAmount:0,mdAmount:0,upo:0,extendedPrice:0,priceType:0,applyVat:!1,taxId:null,taxDetails:null,notes:"",totalWeight:0}],serials:[],lots:[],taxes:[]},validateOnChange:!0,validationSchema:r.Ry({header:r.Ry({date:r.Z_().required(),currencyId:r.Z_().required(),clientId:r.Z_().required(),siteId:r.Z_().nullable().test(function(e){let{dtId:l,commitItems:a}=this.parent;return!!l&&(!l||!a)||!!e})}),items:r.IX().of(au)}),onSubmit:async e=>{if(e.header.serializedAddress){let l={clientId:e.header.clientId,address:l3},a=await lQ({extension:F.P.Address.set,record:JSON.stringify(l)});e.header.billAddressId=a.recordId}let l=[],a=e.items.filter(e=>{var l;return null===(l=Object.values(as))||void 0===l?void 0:l.every(l=>l(e))}).map(e=>{let{id:a,isVattable:d,taxDetails:i,...t}=e,{serials:n,...o}=t;if(n){let e=n.map((e,l)=>({...e,srlSeqNo:0,id:l,componentSeqNo:0,trxId:av.values.recordId||0,itemId:null==t?void 0:t.itemId,seqNo:a}));l=[...l,...e]}return{...o,seqNo:a,applyVat:d}}),d={header:{...e.header,date:(0,t.ku)(e.header.date),dueDate:(0,t.ku)(e.header.dueDate)},items:a,serials:l,taxes:Object.values([...e.taxes,...e.items.filter(e=>{let{taxDetails:l}=e;return l&&l.length>0}).map(e=>{let{taxDetails:l,id:a}=e;return{seqNo:a,...l[0]}})].reduce((l,a)=>(e.items.some(e=>e.id===a.seqNo)&&(l[a.seqNo]=a),l),{})),...(e=>{let{header:l,items:a,taxes:d,serials:i,...t}=e;return t})(e)},i=await lQ({extension:F.P.SalesTransaction.set2,record:JSON.stringify(d)}),n=aI?lz.Edited:lz.Added;s.ZP.success(n),await a6(i.recordId),ao()}}),am=(0,o.useRef)(null==av?void 0:null===(H=av.values)||void 0===H?void 0:H.items),ah=e=>{switch(Number(e)){case K.J.SalesInvoice:return L.i.MCRSalesInvoice;case K.J.SalesReturn:return L.i.MCRSalesReturn;case K.J.ConsignmentIn:return L.i.MCRClientGOCIn;case K.J.ConsignmentOut:return L.i.MCRClientGOCOut;default:return null}},ap=3===av.values.header.status,aI=!!av.values.header.recordId;async function ax(e,l,a,d,i,t,n){var o,r,u,s,c,v,m,h,p,x,y,f,b,A,g;let F;let P={},V=(null==d?void 0:d.weight)||0,C=null!==(p=null==d?void 0:d.metalPurity)&&void 0!==p?p:0,w=null!==(x=null==d?void 0:d.isMetal)&&void 0!==x&&x,N=null!==(y=null==d?void 0:d.metalId)&&void 0!==y?y:null,k=null!==(f=null==a?void 0:a.baseLaborPrice)&&void 0!==f?f:0,Z=await ak(null==l?void 0:l.msId),j=null!==(b=null==av?void 0:null===(r=av.values)||void 0===r?void 0:null===(o=r.header)||void 0===o?void 0:o.postMetalToFinancials)&&void 0!==b&&b,S=(null!==(A=null==av?void 0:null===(s=av.values)||void 0===s?void 0:null===(u=s.header)||void 0===u?void 0:u.KGmetalPrice)&&void 0!==A?A:0)*C/1e3,D=!1===j?S:0,O=D+k,R=(null==a?void 0:a.priceType)===3?V*O:(null==a?void 0:a.unitPrice)||0,_=parseFloat((null==a?void 0:a.minPrice)||0).toFixed(3),q=null,M=null;if(av.values.header.taxId){let e=await aL(av.values.header.taxId),l=null==e?void 0:e.map(e=>({invoiceId:av.values.recordId,taxSeqNo:e.seqNo,taxId:av.values.header.taxId,taxCodeId:e.taxCodeId,taxBase:e.taxBase,amount:e.amount}));q=av.values.header.taxId,M=l}else if(null==i?void 0:i.taxId){let e=await aL(i.taxId),l=null==e?void 0:e.map(e=>{var l;return{invoiceId:av.values.recordId,taxSeqNo:e.seqNo,taxId:i.taxId,taxCodeId:e.taxCodeId,taxBase:e.taxBase,amount:null!==(l=e.amount)&&void 0!==l?l:0}});q=i.taxId,M=l}if(parseFloat(R)<parseFloat(_)&&a3(_,R),t&&(P={...P,sku:null==a?void 0:a.sku,barcode:null==a?void 0:a.barcode,itemName:null==a?void 0:a.itemName,itemId:null==a?void 0:a.itemId}),i.categoryId){let e=await lU({extension:I.$.Category.get,parameters:"_recordId=".concat(i.categoryId)});F=null==e?void 0:null===(g=e.record)||void 0===g?void 0:g.name}av.setFieldValue("header.mdAmount",av.values.header.currentDiscount?av.values.header.currentDiscount:0);let L=aE({...P={...P,qty:0,decimals:null==Z?void 0:Z.decimals,isMetal:w,metalId:N,metalPurity:C,metalRef:(null==d?void 0:d.metalRef)||"",volume:(null==d?void 0:d.volume)||0,weight:V,basePrice:!1===w?(null==a?void 0:a.basePrice)||0:C>0?D:0,baseLaborPrice:k,totalWeightPerG:O,unitPrice:R,upo:(null==a?void 0:a.upo)||0,priceType:(null==a?void 0:a.priceType)||1,msId:null==i?void 0:i.msId,categoryId:i.categoryId,categoryName:F,muRef:(null==n?void 0:n.reference)||"",muId:(null==n?void 0:n.recordId)||null,mdAmount:av.values.header.maxDiscount?av.values.header.maxDiscount:0,mdValue:0,mdType:T.Xo,extendedPrice:0,mdValue:0,taxId:q,minPrice:_,siteId:(null===(v=av.values)||void 0===v?void 0:null===(c=v.header)||void 0===c?void 0:c.siteId)||null,siteRef:(null===(h=av.values)||void 0===h?void 0:null===(m=h.header)||void 0===m?void 0:m.siteRef)||null,taxDetails:M,taxDetailsButton:!0},id:null==l?void 0:l.id,qty:(null==l?void 0:l.defaultQty)||1},T.bT),W=ab(P.basePrice)?T.yO:ab(P.unitPrice)?T.Xf:null;W&&(L=aE(L,W)),e({...L,priceWithVAT:aG(L,null==M?void 0:M[0],T.yO)})}async function ay(e,l,a,d){if(e&&l&&a){var i,n,o,r,u,s,c,v;let m=await lU({extension:D.q.Currency.get,parameters:"_currencyId=".concat(e,"&_date=").concat((0,t.Uf)(l),"&_rateDivision=").concat(a)}),h=(0,B.fB)({amount:0===d?0:null!=d?d:av.values.header.amount,exRate:null===(i=m.record)||void 0===i?void 0:i.exRate,baseAmount:0,rateCalcMethod:null===(n=m.record)||void 0===n?void 0:n.rateCalcMethod,dirtyField:B.ss});av.setFieldValue("header.baseAmount",parseFloat(null==h?void 0:h.baseAmount).toFixed(2)||0),av.setFieldValue("header.exRate",null===(o=m.record)||void 0===o?void 0:o.exRate),av.setFieldValue("header.rateCalcMethod",null===(r=m.record)||void 0===r?void 0:r.rateCalcMethod),av.setFieldValue("header.rateCalcMethodName",null===(u=m.record)||void 0===u?void 0:u.rateCalcMethodName),av.setFieldValue("header.rateTypeName",null===(s=m.record)||void 0===s?void 0:s.rateTypeName),av.setFieldValue("header.exchangeId",null===(c=m.record)||void 0===c?void 0:c.exchangeId),av.setFieldValue("header.exchangeName",null===(v=m.record)||void 0===v?void 0:v.exchangeName)}}let af=e=>1===e.trackBy?{imgSrc:a(64581).Z.src,hidden:!1}:{imgSrc:"",hidden:!0};function ab(e){return null!=e&&""!=e&&!isNaN(e)&&0!=e}let aA=[{component:"textfield",label:l_.barcode,name:"barcode",updateOn:"blur",async onChange(e){let{row:{update:l,newRow:a}}=e;if(!(null==a?void 0:a.barcode))return;let d=await aB(a);if(d){var i;let e=await aq(null==d?void 0:d.itemId),t=await aM(null==d?void 0:d.itemId);aU(null==t?void 0:t.itemId,null==t?void 0:t.msId);let n=null==l2?void 0:null===(i=l2.filter(e=>e.recordId===(null==t?void 0:t.defSaleMUId)))||void 0===i?void 0:i[0];await ax(l,a,d,e,t,!0,n)}else l({barcode:null})}},{component:"resourcelookup",label:l_.sku,name:"sku",flex:2,props:{endpointId:I.$.Item.snapshot,parameters:{_categoryId:0,_msId:0,_startAt:0,_size:1e3},displayField:"sku",valueField:"sku",mapping:[{from:"recordId",to:"itemId"},{from:"sku",to:"sku"},{from:"name",to:"itemName"},{from:"trackBy",to:"trackBy"},{from:"msId",to:"msId"}],columnsInDropDown:[{key:"sku",value:"SKU"},{key:"name",value:"Item Name"}],displayFieldWidth:5},async onChange(e){var l;let{row:{update:a,newRow:d}}=e;if(!d.itemId)return;let i=await aq(d.itemId),t=await aM(d.itemId);aU(null==d?void 0:d.itemId,null==d?void 0:d.msId);let n=null==l2?void 0:null===(l=l2.filter(e=>e.recordId===(null==t?void 0:t.defSaleMUId)))||void 0===l?void 0:l[0],o=await aW(d.itemId,null==n?void 0:n.recordId);await ax(a,d,o,i,t,!1,n)},propsReducer(e){let{row:l,props:a}=e;return{...a,imgSrc:af(l)}}},{component:"textfield",label:l_.itemName,name:"itemName",flex:3,props:{readOnly:!0}},{component:"resourcecombobox",label:l_.category,name:"categoryName",flex:3,props:{endpointId:I.$.Category.qry,parameters:"_pagesize=100&_startAt=0&_name=",displayField:"name",valueField:"recordId",mapping:[{from:"recordId",to:"categoryId"},{from:"name",to:"categoryName"}],readOnly:!0}},{component:"resourcecombobox",label:l_.site,name:"siteRef",props:{endpointId:I.$.Site.qry,displayField:"reference",valueField:"recordId",mapping:[{from:"recordId",to:"siteId"},{from:"reference",to:"siteRef"},{from:"name",to:"siteName"}],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],displayFieldWidth:3}},{component:"resourcecombobox",label:l_.measurementUnit,name:"muRef",props:{store:null==ad?void 0:ad.current,displayField:"reference",valueField:"recordId",mapping:[{from:"reference",to:"muRef"},{from:"qty",to:"muQty"},{from:"recordId",to:"muId"}]},async onChange(e){var l,a,d,i,t,n,o;let{row:{update:r,newRow:u}}=e;(null==u?void 0:u.muId)||r({baseQty:0});let s=await aW(null==u?void 0:u.itemId,null==u?void 0:u.muId),c=null==ad?void 0:ad.current.filter(e=>e.recordId===(null==u?void 0:u.muId)),v=(null==u?void 0:u.qty)*(null==c?void 0:c.muQty),m=(null==s?void 0:s.priceType)===3?((null==u?void 0:u.weight)||0)*(((null==av?void 0:null===(a=av.values)||void 0===a?void 0:null===(l=a.header)||void 0===l?void 0:l.postMetalToFinancials)?0:null==s?void 0:s.basePrice)+((null==s?void 0:s.baseLaborPrice)||0)):(null==s?void 0:s.unitPrice)||0,h=null!==(o=null==av?void 0:null===(i=av.values)||void 0===i?void 0:null===(d=i.header)||void 0===d?void 0:d.postMetalToFinancials)&&void 0!==o&&o,p=((null==av?void 0:null===(n=av.values)||void 0===n?void 0:null===(t=n.header)||void 0===t?void 0:t.KGmetalPrice)||0)*((null==u?void 0:u.metalPurity)||0)/1e3;r(aE({...u,qtyInBase:v,muQty:null==u?void 0:u.muQty,unitPrice:m,minPrice:(null==s?void 0:s.minPrice)||0,upo:(null==s?void 0:s.upo)||0,priceType:(null==s?void 0:s.priceType)||1,basePrice:(null==u?void 0:u.isMetal)===!1?(null==s?void 0:s.basePrice)||0:(null==u?void 0:u.metalPurity)>0&&!1===h?p:0},T.bT))},propsReducer(e){let{row:l,props:a}=e;return{...a,store:null==ad?void 0:ad.current}}},{component:"numberfield",label:l_.quantity,name:"qty",updateOn:"blur",props:{onCondition:e=>({decimalScale:null==e?void 0:e.decimals,readOnly:!(null==e?void 0:e.itemId)})},async onChange(e){let{row:{update:l,newRow:a}}=e,d=aE(a,T.bT);l({...d,totalWeight:(d.weight||0)*(a.qty||0)})}},{component:"numberfield",label:l_.volume,name:"volume",props:{decimalScale:2,readOnly:!0}},{component:"numberfield",label:l_.weight,name:"weight",props:{decimalScale:2,readOnly:!0}},{component:"numberfield",label:l_.totalWeight,name:"totalWeight",props:{readOnly:!0}},{component:"textfield",label:l_.metal,name:"metalRef",props:{readOnly:!0}},{component:"numberfield",label:l_.baseprice,name:"basePrice",updateOn:"blur",props:{decimalScale:5},async onChange(e){let{row:{update:l,newRow:a}}=e;l(aE(a,T.yO))}},{component:"numberfield",label:l_.baseLaborPrice,name:"baseLaborPrice",updateOn:"blur",async onChange(e){let{row:{update:l,newRow:a}}=e;l(aE(a,T.tV))}},{component:"numberfield",label:l_.totalPPG,name:"totalWeightPerG",updateOn:"blur",async onChange(e){let{row:{update:l,newRow:a}}=e;l(aE(a,T.kx))}},{component:"numberfield",label:l_.unitPrice,name:"unitPrice",updateOn:"blur",props:{decimalScale:3},async onChange(e){let{row:{update:l,oldRow:a,newRow:d}}=e,i=parseFloat(d.unitPrice||0).toFixed(3),t=parseFloat((null==a?void 0:a.minPrice)||0).toFixed(3);parseFloat(t)>0&&parseFloat(i)<parseFloat(t)&&a3(t,i),l(aE(d,T.Xf))}},{component:"numberfield",label:l_.priceWithVAT,name:"priceWithVAT"},{component:"numberfield",label:l_.upo,name:"upo",updateOn:"blur",props:{decimalScale:2},async onChange(e){let{row:{update:l,newRow:a}}=e;l(aE(a,T.zL))}},{component:"numberfield",label:l_.VAT,name:"vatAmount",props:{decimalScale:2,readOnly:!0}},{component:"button",name:"taxDetails",props:{onCondition:e=>e.itemId&&e.taxId?{imgSrc:a(54022).default.src,hidden:!1}:{imgSrc:"",hidden:!0}},label:l_.tax,onClick:(e,l)=>{lJ({Component:E.Z,props:{taxId:null==l?void 0:l.taxId,obj:l}})}},{component:"numberfield",label:l_.markdown,name:"mdAmount",updateOn:"blur",flex:2,props:{decimalScale:2,ShowDiscountIcons:!0,iconsClicked:aF,type:"numeric",iconKey:e=>{let{value:l,data:a}=e;return((null==l?void 0:l.mdType)||(null==a?void 0:a.mdType))===T.Xo?"%":"123"}},async onChange(e){let{row:{update:l,newRow:a}}=e;l(aE(a,T.On)),function(e,l){let a=e.unitPrice*(av.values.header.maxDiscount/100);av.values.header.maxDiscount&&(e.mdType==T.Xo?e.mdAmount>av.values.header.maxDiscount&&av.values.header.maxDiscount>e&&(av.setFieldValue("header.mdType",2),av.setFieldValue("header.mdAmount",e),l.mdType=2,l.mdAmount=e,(void 0)(aE(l,T.On)),lK({message:l_.clientMaxDiscount+" "+e})):e.mdAmount>a&&e.mdAmount>a&&(av.setFieldValue("header.mdAmount",a),e.mdAmount=a,l(aE(e,T.On)),lK({message:l_.clientMaxPctDiscount+" "+a+"%"})))}(a,l)}},{component:"button",name:"saTrx",props:{imgSrc:a(32631).default.src,onCondition:e=>({disabled:!e.itemId})},label:l_.salesTrx,onClick:(e,l,a,d)=>{var i,t;lJ({Component:w.Z,props:{recordId:0,functionId:lL,itemId:null==l?void 0:l.itemId,clientId:null==av?void 0:null===(t=av.values)||void 0===t?void 0:null===(i=t.header)||void 0===i?void 0:i.clientId}})}},{component:"numberfield",label:l_.extendedprice,name:"extendedPrice",updateOn:"blur",props:{decimalScale:2},async onChange(e){let{row:{update:l,newRow:a}}=e;l(aE(a,T.bh))}},{component:"textfield",label:l_.notes,name:"notes"},{component:"button",name:"serials",label:lz.serials,props:{onCondition:af},onClick:(e,l,a,d)=>{if((null==l?void 0:l.trackBy)===1){var i;lJ({Component:G.u,props:{labels:l_,row:l,disabled:ap,siteId:null==av?void 0:null===(i=av.values)||void 0===i?void 0:i.header.siteId,maxAccess:an,checkForSiteId:!0,updateRow:d}})}}}];function ag(e,l,a){let d=parseFloat(e)||0;return l===a?(d<0||d>100)&&(d=0):d<0&&(d=0),d}async function aF(e){let{updateRow:l,value:a,data:d}=e,i=((null==a?void 0:a.mdType)||(null==d?void 0:d.mdType))===T.Xo?T.RD:T.Xo,t=ag(null==a?void 0:a.mdAmount,i,T.Xo);l({id:d.id,changes:{mdAmount:t,mdAmountPct:i,mdType:i},commitOnBlur:!0})}let aP=async()=>{await lQ({extension:F.P.SaleTransaction.post,record:JSON.stringify(av.values.header)}),s.ZP.success(lz.Posted),ao(),lW.close()},aV=async()=>{await lQ({extension:F.P.SaleTransaction.unpost,record:JSON.stringify(av.values.header)}).then(e=>{s.ZP.success(lz.Posted),lB({recordId:e.recordId,reference:av.values.header.reference,resourceId:lE(parseInt(lL)),onSuccess:()=>{l$({resourceId:lE(parseInt(lL)),recordId:lM,reference:av.values.header.reference}),a6(e.recordId)},isAlreadyLocked:e=>{lW.close(),lJ({Component:q.Z,props:{DialogText:"".concat(lz.RecordLocked," ").concat(e),title:lz.Dialog},title:lz.Dialog})}}),ao()})},aC=async()=>{var e;return(null==am?void 0:null===(e=am.current)||void 0===e?void 0:e.filter(e=>e.metalId).map(e=>({qty:e.qty,metalRef:"",metalId:e.metalId,metalPurity:e.metalPurity,weight:e.weight,priceType:e.priceType})))||[]};async function aw(){let e={...av.values.header,isVerified:!av.values.header.isVerified};delete e.items,await lQ({extension:F.P.SalesTransaction.verify,record:JSON.stringify(e)}),s.ZP.success(av.values.header.isVerified?lz.Unverfied:lz.Verified),a6(av.values.header.recordId),ao()}let aN=[{key:"RecordRemarks",condition:!0,onClick:"onRecordRemarks",disabled:!aI},{key:"WorkFlow",condition:!0,onClick:async function(){lJ({Component:C.Z,props:{functionId:lL,recordId:av.values.header.recordId}})},disabled:!aI},{key:"FI Trx",condition:!0,onClick:"onClickIT",disabled:!aI},{key:"SA Trx",condition:!0,onClick:"onClickSATRX",disabled:!aI},{key:"Aging",condition:!0,onClick:"onClickAging",disabled:!aI},{key:"GL",condition:!0,onClick:"onClickGL",valuesPath:{...av.values.header,notes:av.values.header.description},datasetId:lG(lL),disabled:!aI},{key:"Metals",condition:!0,onClick:"onClickMetal",handleMetalClick:aC},{key:"Locked",condition:ap,onClick:"onUnpostConfirmation",onSuccess:aV,disabled:!ap||av.values.header.isVerified},{key:"Unlocked",condition:!ap,onClick:aP,disabled:!aI},{key:"ClientSalesTransaction",condition:!0,onClick:"onClientSalesTransaction",disabled:!(null===(ee=av.values.header)||void 0===ee?void 0:ee.clientId)},{key:"AccountSummary",condition:!0,onClick:()=>{lJ({Component:U.Z,props:{accountId:parseInt(av.values.header.accountId),moduleId:1}})},disabled:!av.values.header.clientId},{key:"Verify",condition:!av.values.header.isVerified,onClick:aw,disabled:av.values.header.isVerified||!aI||!ap},{key:"Unverify",condition:av.values.header.isVerified,onClick:aw,disabled:!av.values.header.isVerified}];async function ak(e){let l=await lU({extension:I.$.Measurement.get,parameters:"_recordId=".concat(e)});return null==l?void 0:l.record}async function aT(e,l){var a,d,i,t,n,o;let r=null==e?void 0:e.header,u=null==e?void 0:e.items,s=null==e?void 0:e.taxes,c=null==e?void 0:null===(a=e.accountBalance)||void 0===a?void 0:a.balance,v=null==e?void 0:null===(d=e.client)||void 0===d?void 0:d.accountId,m=null==e?void 0:null===(i=e.client)||void 0===i?void 0:i.maxDiscount,h=null==e?void 0:e.formattedAddress;(null==r?void 0:r.tdType)===1||(null==r?void 0:r.tdType)==null?l0({text:"123",value:1}):l0({text:"%",value:2});let p=r.isVattable?ai.current:{},I=await Promise.all(null==u?void 0:u.map(async(l,a)=>{var d;return{...l,id:a+1,basePrice:l.basePrice,unitPrice:l.unitPrice,upo:l.upo,vatAmount:l.vatAmount,extendedPrice:l.extendedPrice,totalWeight:(l.weight||0)*(l.qty||0),serials:null==e?void 0:null===(d=e.serials)||void 0===d?void 0:d.filter(e=>e.seqNo==l.seqNo).map((e,l)=>({...e,id:l})),priceWithVAT:aG(l,null==p?void 0:p[0],T.yO),totalWeightPerG:function(e,l,a){let d=(0,T.Ch)({priceType:null==l?void 0:l.priceType,basePrice:parseFloat((null==l?void 0:l.basePrice)||0),volume:parseFloat(null==l?void 0:l.volume)||0,weight:parseFloat(null==l?void 0:l.weight),unitPrice:parseFloat((null==l?void 0:l.unitPrice)||0),upo:0,qty:parseFloat(null==l?void 0:l.qty)||0,extendedPrice:parseFloat(null==l?void 0:l.extendedPrice),mdAmount:(null==e?void 0:e.mdAmount)||0,mdType:(null==l?void 0:l.mdType)||1,baseLaborPrice:(null==l?void 0:l.baseLaborPrice)||0,totalWeightPerG:null==l?void 0:l.TotPricePerG,mdValue:parseFloat(null==l?void 0:l.mdValue),tdPct:0,dirtyField:a});return(null==d?void 0:d.totalWeightPerG)?parseFloat(d.totalWeightPerG).toFixed(2):0}(r,l,T.yO),taxDetails:p[l.taxId]||null}}));am.current=I,av.setValues({...av.values,recordId:r.recordId||null,header:{...av.values.header,...r,amount:null!==(o=parseFloat(null==r?void 0:r.amount).toFixed(2))&&void 0!==o?o:0,billAddress:h,currentDiscount:(null==r?void 0:r.tdType)==1||(null==r?void 0:r.tdType)==null?null==r?void 0:r.tdAmount:null==r?void 0:r.tdPct,KGmetalPrice:(null==r?void 0:r.metalPrice)*1e3,subtotal:null==r?void 0:r.subtotal.toFixed(2),accountId:v,commitItems:null==l?void 0:null===(t=l.record)||void 0===t?void 0:t.commitItems,postMetalToFinancials:null==l?void 0:null===(n=l.record)||void 0===n?void 0:n.postMetalToFinancials,maxDiscount:m||0,balance:c},items:I,taxes:[...s]}),av.values.recordId||lB({recordId:r.recordId,reference:r.reference,resourceId:lE(parseInt(lL)),onSuccess:()=>{l$({resourceId:lE(parseInt(lL)),recordId:r.recordId,reference:r.reference})}})}async function aZ(e){var l,a,d,i;let n=await lU({extension:F.P.SalesTransaction.get2,parameters:"_recordId=".concat(e)});return n.record.header.date=(0,t.a1)(null==n?void 0:null===(a=n.record)||void 0===a?void 0:null===(l=a.header)||void 0===l?void 0:l.date),n.record.header.dueDate=(0,t.a1)(null==n?void 0:null===(i=n.record)||void 0===i?void 0:null===(d=i.header)||void 0===d?void 0:d.dueDate),n.record}let aj=async()=>{var e,l;let a=await lU({extension:F.P.SaleTransaction.pack,parameters:"_functionId=".concat(lL)}),d=((null==a?void 0:null===(e=a.record)||void 0===e?void 0:e.taxDetails)||[]).reduce((e,l)=>(e[l.taxId]||(e[l.taxId]=[]),e[l.taxId].push(l),e),{});return ai.current=d,(null==a?void 0:null===(l=a.record)||void 0===l?void 0:l.measurementUnits)||[]};async function aS(e){if(e){var l;return(null===(l=(await lU({extension:D.q.Currency.get,parameters:"_currencyId=".concat(e,"&_date=").concat((0,t.Uf)(av.values.header.date),"&_rateDivision=").concat(O.B.SALES)})).record)||void 0===l?void 0:l.exRate)*1e3}}async function aD(){var e;let l=null==lX?void 0:null===(e=lX.list)||void 0===e?void 0:e.find(e=>{let{key:l}=e;return"baseMetalCuId"===l}),a=(null==l?void 0:l.value)?parseInt(l.value):null;if(null!=a){let e=await aS(a);null!=e?(av.setFieldValue("header.KGmetalPrice",e),av.setFieldValue("header.metalPrice",e/1e3)):(av.setFieldValue("header.KGmetalPrice",0),av.setFieldValue("header.metalPrice",0))}}async function aO(e,l){let a=await lU({extension:P.H.AccountCreditLimit.get,parameters:"_accountId=".concat(l,"&_currencyId=").concat(e)});return null==a?void 0:a.record}async function aR(e){var l,a,d,i,t,n;if(!(null==e?void 0:e.recordId)){av.setFieldValue("header.clientId",null),av.setFieldValue("header.clientName",null),av.setFieldValue("header.clientRef",null);return}let o=await ac(e.spId),r=e.accountId,u=null!==(d=null!==(a=e.currencyId)&&void 0!==a?a:av.values.header.currencyId)&&void 0!==d?d:null;if(!u){lK({message:l_.NoCurrencyAvailable});return}let s=await aO(u,r),c=await a_(null==e?void 0:e.accountId,av.values.header.currencyId,e.billAddressId);av.setValues({...av.values,header:{...av.values.header,clientId:null==e?void 0:e.recordId,clientName:null==e?void 0:e.name,clientRef:null==e?void 0:e.reference,isVattable:(null==e?void 0:e.isSubjectToVAT)||!1,maxDiscount:null==e?void 0:e.maxDiscount,taxId:null==e?void 0:e.taxId,currencyId:u,spId:o,ptId:null!==(i=e.ptId)&&void 0!==i?i:l9.ptId,plId:null!==(t=e.plId)&&void 0!==t?t:l9.plId,szId:e.szId,billAddressId:e.billAddressId,billAddress:null==c?void 0:c.address,creditLimit:null!==(n=null==s?void 0:s.limit)&&void 0!==n?n:0,accountId:null==e?void 0:e.accountId,balance:null==c?void 0:null===(l=c.accountBalance)||void 0===l?void 0:l.balance}})}async function a_(e,l,a){let d=await lU({extension:F.P.Client.pack,parameters:"_accountId=".concat(e,"&_currencyId=").concat(l,"&_addressId=").concat(a||0)});return null==d?void 0:d.record}async function aq(e){let l=await lU({extension:I.$.ItemPhysProp.get,parameters:"_itemId=".concat(e)});return null==l?void 0:l.record}async function aM(e){let l=await lU({extension:I.$.Item.get,parameters:"_recordId=".concat(e)});return null==l?void 0:l.record}async function aL(e){return e&&ai.current[e]?ai.current[e]:[]}async function aW(e,l){let a=await lU({extension:F.P.ItemConvertPrice.get,parameters:"_itemId=".concat(e,"&_clientId=").concat(av.values.header.clientId,"&_currencyId=").concat(av.values.header.currencyId,"&_plId=").concat(av.values.header.plId,"&_muId=").concat(l||0)});return null==a?void 0:a.record}async function aB(e){let l=await lU({extension:F.P.ItemConvertPrice.get2,parameters:"_barcode=".concat(null==e?void 0:e.barcode,"&_clientId=").concat(av.values.header.clientId,"&_currencyId=").concat(av.values.header.currencyId,"&_plId=").concat(av.values.header.plId,"&_exRate=").concat(av.values.header.exRate,"&_rateCalcMethod=").concat(av.values.header.rateCalcMethod)});return null==l?void 0:l.record}function aE(e,l,a){var d,i,t,n,o,r,u;al||aa(!0);let s=ag(null==e?void 0:e.mdAmount,null==e?void 0:e.mdType,T.Xo),c=(0,T.Ch)({priceType:null==e?void 0:e.priceType,basePrice:parseFloat((null==e?void 0:e.basePrice)||0),volume:(null==e?void 0:e.volume)||0,weight:null==e?void 0:e.weight,unitPrice:parseFloat(null==e?void 0:e.unitPrice)||0,upo:parseFloat(null==e?void 0:e.upo)||0,qty:parseFloat((null==e?void 0:e.qty)||0),extendedPrice:parseFloat(null==e?void 0:e.extendedPrice),mdAmount:s,mdType:null==e?void 0:e.mdType,mdValue:null==e?void 0:e.mdValue,baseLaborPrice:parseFloat((null==e?void 0:e.baseLaborPrice)||0),totalWeightPerG:(null==e?void 0:e.totalWeightPerG)||0,tdPct:(null==av?void 0:null===(i=av.values)||void 0===i?void 0:null===(d=i.header)||void 0===d?void 0:d.tdPct)||0,dirtyField:l});(null==e?void 0:null===(t=e.taxDetails)||void 0===t?void 0:t.length)>0&&(e.taxDetails=[e.taxDetails[0]]);let v=(0,Z.VW)({priceType:null==c?void 0:c.priceType,basePrice:null==c?void 0:c.basePrice,unitPrice:null==c?void 0:c.unitPrice,qty:null==c?void 0:c.qty,weight:null==c?void 0:c.weight,extendedPrice:null==c?void 0:c.extendedPrice,baseLaborPrice:null==c?void 0:c.baseLaborPrice,vatAmount:(null==c?void 0:c.vatAmount)||0,tdPct:null==av?void 0:null===(o=av.values)||void 0===o?void 0:null===(n=o.header)||void 0===n?void 0:n.tdPct,taxDetails:(null===(r=av.values.header)||void 0===r?void 0:r.isVattable)?e.taxDetails:null}),m={...e,id:null==e?void 0:e.id,qty:(null==c?void 0:c.qty)?null==c?void 0:c.qty:0,volume:(null==c?void 0:c.volume)?c.volume:0,weight:(null==c?void 0:c.weight)?c.weight:0,basePrice:(null==c?void 0:c.basePrice)?c.basePrice:0,unitPrice:(null==c?void 0:c.unitPrice)?c.unitPrice:0,extendedPrice:(null==c?void 0:c.extendedPrice)?c.extendedPrice:0,upo:null==c?void 0:c.upo,mdValue:null==c?void 0:c.mdValue,mdType:null==c?void 0:c.mdType,baseLaborPrice:(null==c?void 0:c.baseLaborPrice)?parseFloat(c.baseLaborPrice).toFixed(2):0,totalWeightPerG:(null==c?void 0:c.totalWeightPerG)?parseFloat(c.totalWeightPerG).toFixed(2):0,mdAmount:(null==c?void 0:c.mdAmount)?c.mdAmount:0,vatAmount:(null==v?void 0:v.vatAmount)?v.vatAmount:0,priceWithVAT:aG(e,null==e?void 0:null===(u=e.taxDetails)||void 0===u?void 0:u[0],T.yO)};return a?{changes:m}:m}function aG(){var e,l;let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2?arguments[2]:void 0,t=null!==(e=null==a?void 0:a.unitPrice)&&void 0!==e?e:0,n=null!==(l=null==a?void 0:a.priceWithVAT)&&void 0!==l?l:0;if(!d)return(n?Math.abs(n-t):t).toFixed(2);let{amount:o=0,taxBase:r}=d;switch(i){case T.yO:return(t*(1+o/100)).toFixed(2);case T.Xf:if(1==r)return(n/(1+o/100)).toFixed(2);if(2==r)return n.toFixed(2);return(n-t).toFixed(2);default:return}}async function aU(e,l){if(!e)return;let a=(null==l2?void 0:l2.filter(e=>e.msId===l))||[];ad.current=a}let aQ=null===(el=av.values.items)||void 0===el?void 0:el.filter(e=>void 0!==e.itemId).map(e=>({...e,basePrice:e.basePrice||0,unitPrice:e.unitPrice||0,upo:e.upo||0,vatAmount:e.vatAmount||0,weight:e.weight||0,volume:e.volume||0,extendedPrice:e.extendedPrice||0})),a$=(0,j.Ww)(aQ),aK=0==av.values.miscAmount?0:parseFloat(av.values.header.miscAmount)||0,aJ=(0,j.Ot)(aQ,{totalQty:0,totalWeight:0,totalVolume:0,totalUpo:0,sumVat:0,sumExtended:parseFloat(a$),tdAmount:parseFloat(av.values.header.tdAmount),net:0,miscAmount:aK||0}),az=al?null==aJ?void 0:aJ.totalQty:(null===(ed=av.values)||void 0===ed?void 0:null===(ea=ed.header)||void 0===ea?void 0:ea.qty)||0,aX=al?null==aJ?void 0:aJ.net:(null===(ei=av.values)||void 0===ei?void 0:ei.header.amount)||0,aY=al?null==aJ?void 0:aJ.totalVolume:(null===(et=av.values)||void 0===et?void 0:et.header.volume)||0,aH=al?null==aJ?void 0:aJ.totalWeight:(null===(en=av.values)||void 0===en?void 0:en.header.weight)||0,a0=al?a$.toFixed(2):(null===(eo=av.values)||void 0===eo?void 0:eo.header.subtotal)||0,a2=al?null==aJ?void 0:aJ.sumVat:(null===(er=av.values)||void 0===er?void 0:er.header.vatAmount)||0;async function a1(e,l,a,d){var i;i=function(e,l,a,d){var i;let t=(0,j.Yi)({tdAmount:parseFloat(d)||0,tdPlain:1==e,tdPct:2==e,tdType:e,subtotal:a0,currentDiscount:d,hiddenTdPct:l||0,hiddenTdAmount:parseFloat(a)||0,typeChange:e});return av.setFieldValue("header.tdAmount",(null==t?void 0:t.hiddenTdAmount)?null==t?void 0:null===(i=t.hiddenTdAmount)||void 0===i?void 0:i.toFixed(2):0),av.setFieldValue("header.tdType",null==t?void 0:t.tdType),av.setFieldValue("header.currentDiscount",(null==t?void 0:t.currentDiscount)||0),av.setFieldValue("header.tdPct",null==t?void 0:t.hiddenTdPct),null==t?void 0:t.hiddenTdPct}(e,l,a,d),av.values.items.map((e,l)=>{var a,d;(null==e?void 0:null===(a=e.taxDetails)||void 0===a?void 0:a.length)>0&&(e.taxDetails=[e.taxDetails[0]]);let t=(0,Z.VW)({priceType:null==e?void 0:e.priceType,basePrice:null==e?void 0:e.basePrice,qty:null==e?void 0:e.qty,weight:null==e?void 0:e.weight,extendedPrice:null==e?void 0:e.extendedPrice,baseLaborPrice:parseFloat(null==e?void 0:e.baseLaborPrice),vatAmount:null==e?void 0:e.vatAmount,tdPct:i,taxDetails:(null===(d=av.values.header)||void 0===d?void 0:d.isVattable)?e.taxDetails:null});av.setFieldValue("items[".concat(l,"].vatAmount"),null==t?void 0:t.vatAmount)})}function a3(e,l){parseFloat(e)>0&&parseFloat(l)<parseFloat(e)&&lK({message:"".concat(l_.minPriceError,": ").concat(e)})}async function a6(e,l){let a={},d=await aZ(e);l&&(a=await a8(d.header.dtId)),await aT(d,a)}function a5(e){Object.entries(e).forEach(e=>{let[l,a]=e;av.setFieldValue("header.".concat(l),a)})}function a8(e){if(e)return lU({extension:F.P.DocumentTypeDefault.get,parameters:"_dtId=".concat(e)})}(0,o.useEffect)(()=>{let e="",{name:l,street1:a,street2:d,city:i,phone:t,phone2:n,email1:o}=l3;(l||a||d||i||t||n||o)&&(e="".concat(l||"","\n").concat(a||"","\n").concat(d||"","\n").concat(i||"","\n").concat(t||"","\n").concat(n||"","\n").concat(o||"")),av.setFieldValue("header.billAddress",e),av.setFieldValue("header.serializedAddress",e)},[l3]);let a9=(0,o.useMemo)(()=>{var e;if(null==av?void 0:null===(e=av.values)||void 0===e?void 0:e.search){let e=av.values.items.filter(e=>{var l,a,d,i,t,n,o,r,u,s;return(null===(a=e.barcode)||void 0===a?void 0:null===(l=a.toString())||void 0===l?void 0:l.includes(av.values.search))||(null===(t=e.sku)||void 0===t?void 0:null===(i=t.toString())||void 0===i?void 0:null===(d=i.toLowerCase())||void 0===d?void 0:d.includes(av.values.search.toLowerCase()))||(null===(r=e.itemName)||void 0===r?void 0:null===(o=r.toString())||void 0===o?void 0:null===(n=o.toLowerCase())||void 0===n?void 0:n.includes(av.values.search.toLowerCase()))||(null===(s=e.qty)||void 0===s?void 0:null===(u=s.toString())||void 0===u?void 0:u.includes(av.values.search))});return e.length>0?e:[]}return av.values.items},[av.values.search,av.values.items]);async function a4(e){var l;if(!e)return;let a=await lU({extension:I.$.Site.get,parameters:"_recordId=".concat(e)});return null==a?void 0:null===(l=a.record)||void 0===l?void 0:l.reference}async function a7(e){var l,a,d,i,t,n;let o=await a8(e);(null==o?void 0:o.record)!=null?(aD(),l8(!0)):(av.setFieldValue("header.metalPrice",0),av.setFieldValue("header.KGmetalPrice",0),l8(!1));let r=(null==o?void 0:null===(l=o.record)||void 0===l?void 0:l.siteId)||(null==l7?void 0:l7.siteId)||null,u=await a4(r);av.setFieldValue("header.postMetalToFinancials",null==o?void 0:null===(a=o.record)||void 0===a?void 0:a.postMetalToFinancials),av.setFieldValue("header.plantId",(null==o?void 0:null===(d=o.record)||void 0===d?void 0:d.plantId)||(null==l7?void 0:l7.plantId)||null);let s=await ac((null==o?void 0:null===(i=o.record)||void 0===i?void 0:i.spId)||(null==l7?void 0:l7.spId));av.setFieldValue("header.spId",s),av.setFieldValue("header.siteId",r),av.setFieldValue("header.siteRef",u||""),av.setFieldValue("header.commitItems",null==o?void 0:null===(t=o.record)||void 0===t?void 0:t.commitItems),aS(),(null==o?void 0:null===(n=o.record)||void 0===n?void 0:n.commitItems)==!1&&(av.setFieldValue("header.siteId",null),av.setFieldValue("header.siteRef",""))}async function de(){var e;let l={};return(null==lX?void 0:null===(e=lX.list)||void 0===e?void 0:e.filter(e=>"baseMetalCuId"===e.key||"mc_defaultRTSA"===e.key||"plId"===e.key||"ptId"===e.key||"allowSalesNoLinesTrx"===e.key||"salesTD"===e.key||"sdpClientName"===e.key||"sdpItemName"===e.key||"currencyId"===e.key)).forEach(e=>{l[e.key]="True"===e.value||"False"===e.value?e.value:e.value?parseInt(e.value):null}),l4(l),l}async function dl(){var e;let l={};return(null==lY?void 0:null===(e=lY.list)||void 0===e?void 0:e.filter(e=>"plantId"===e.key||"siteId"===e.key||"spId"===e.key)).forEach(e=>l[e.key]=e.value?parseInt(e.value):null),ae(l),l}(0,o.useEffect)(()=>{var e,l,a,d;av.setFieldValue("header.qty",parseFloat(az).toFixed(2)),av.setFieldValue("header.weight",parseFloat(aH).toFixed(2)),av.setFieldValue("header.volume",parseFloat(aY).toFixed(2)),av.setFieldValue("header.amount",parseFloat(aX).toFixed(2));let i=(0,B.fB)({amount:null!=aX?aX:0,exRate:null===(l=av.values)||void 0===l?void 0:null===(e=l.header)||void 0===e?void 0:e.exRate,baseAmount:0,rateCalcMethod:null===(d=av.values)||void 0===d?void 0:null===(a=d.header)||void 0===a?void 0:a.rateCalcMethod,dirtyField:B.ss});av.setFieldValue("header.baseAmount",parseFloat(null==i?void 0:i.baseAmount).toFixed(2)||0),av.setFieldValue("header.subtotal",parseFloat(a0).toFixed(2)),av.setFieldValue("header.vatAmount",parseFloat(a2).toFixed(2))},[az,aX,aY,aH,a0,a2]),(0,o.useEffect)(()=>{if(al){var e,l;let a=parseFloat((null===(l=av.values)||void 0===l?void 0:null===(e=l.header)||void 0===e?void 0:e.tdPct)||0)*parseFloat(a0)/100;a1(av.values.header.tdType,av.values.header.tdPct,a,av.values.header.currentDiscount)}},[a0]),(0,o.useEffect)(()=>{!async function(){let e=await aj();l1(e),aD();let l=await de();dl(),lM?e&&await a6(lM,!0):"True"==l.salesTD?(l0({text:"%",value:j.a$}),av.setFieldValue("header.tdType",2)):(l0({text:"123",value:1}),av.setFieldValue("header.tdType",1))}()},[]),(0,o.useEffect)(()=>{var e,l;(null===(e=av.values)||void 0===e?void 0:e.header.dtId)&&!lM&&a7(null===(l=av.values)||void 0===l?void 0:l.header.dtId)},[null===(eu=av.values)||void 0===eu?void 0:eu.header.dtId]),(0,o.useEffect)(()=>{l9&&da()},[l9]);let da=async()=>{aI||av.setFieldValue("header.currencyId",(null==l9?void 0:l9.currencyId)||null),av.setFieldValue("header.plantId",(null==l7?void 0:l7.plantId)||null);let e=await ac(null==l7?void 0:l7.spId);av.setFieldValue("header.spId",e);let l=(null==l7?void 0:l7.siteId)||null,a=await a4(l);av.setFieldValue("header.siteId",l),av.setFieldValue("header.siteRef",a||"")};async function dd(){let e={printStatus:2,recordId:av.values.header.recordId};await lQ({extension:F.P.FlagTR,record:JSON.stringify(e)}),ao()}async function di(e){Object.entries(e).forEach(e=>{let[l,a]=e;av.setFieldValue("header.".concat(l),a)})}return(0,o.useEffect)(()=>{ai.current={}},[av.values.header.taxId,av.values.header.currencyId,av.values.header.date,av.values.header.isVattable]),(0,d.jsx)(u.Z,{resourceId:lE(parseInt(lL)),form:av,functionId:lL,maxAccess:an,previewReport:aI,previewBtnClicked:dd,actions:aN,editMode:aI,disabledSubmit:ap,children:(0,d.jsxs)(b.R,{children:[(0,d.jsx)(A.g,{children:(0,d.jsxs)(n.ZP,{container:!0,spacing:2,children:[(0,d.jsx)(n.ZP,{item:!0,xs:3,children:(0,d.jsx)(p.Z,{endpointId:F.P.SaleTransaction.pack,parameters:"_functionId=".concat(lL),reducer:e=>{var l;return null==e?void 0:null===(l=e.record)||void 0===l?void 0:l.documentTypes},name:"header.dtId",readOnly:aI||(null===(es=av.values.items)||void 0===es?void 0:es.some(e=>e.sku)),label:l_.documentType,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],valueField:"recordId",displayField:["reference","name"],values:av.values.header,maxAccess:an,onChange:async(e,l)=>{let a=l?l.recordId:null;await av.setFieldValue("header.dtId",a),l||(av.setFieldValue("header.dtId",null),av.setFieldValue("header.siteId",null),av.setFieldValue("header.metalPrice",0),av.setFieldValue("header.KGmetalPrice",0),l8(!1))},error:(null==av?void 0:null===(ev=av.touched)||void 0===ev?void 0:null===(ec=ev.header)||void 0===ec?void 0:ec.dtId)&&!!(null==av?void 0:null===(eh=av.errors)||void 0===eh?void 0:null===(em=eh.header)||void 0===em?void 0:em.dtId)})}),(0,d.jsx)(n.ZP,{item:!0,xs:3,children:(0,d.jsx)(p.Z,{endpointId:F.P.SaleTransaction.pack,parameters:"_functionId=".concat(lL),reducer:e=>{var l;return null==e?void 0:null===(l=e.record)||void 0===l?void 0:l.salesPeople},name:"header.spId",readOnly:ap,label:l_.salesPerson,filter:aI?void 0:e=>!e.isInactive,columnsInDropDown:[{key:"spRef",value:"Reference"},{key:"name",value:"Name"}],valueField:"recordId",displayField:"name",values:av.values.header,maxAccess:an,displayFieldWidth:1.5,onChange:(e,l)=>{av.setFieldValue("header.spId",l?l.recordId:null)},error:(null==av?void 0:null===(eI=av.touched)||void 0===eI?void 0:null===(ep=eI.header)||void 0===ep?void 0:ep.spId)&&!!(null==av?void 0:null===(ey=av.errors)||void 0===ey?void 0:null===(ex=ey.header)||void 0===ex?void 0:ex.spId)})}),(0,d.jsx)(n.ZP,{item:!0,xs:3,children:(0,d.jsx)(p.Z,{endpointId:F.P.SaleTransaction.pack,parameters:"_functionId=".concat(lL),reducer:e=>{var l;return null==e?void 0:null===(l=e.record)||void 0===l?void 0:l.plants},name:"header.plantId",label:l_.plant,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],readOnly:ap,values:av.values.header,valueField:"recordId",displayField:["reference","name"],maxAccess:an,onChange:(e,l)=>{av.setFieldValue("header.plantId",l?l.recordId:null)},displayFieldWidth:2,error:(null==av?void 0:null===(eb=av.touched)||void 0===eb?void 0:null===(ef=eb.header)||void 0===ef?void 0:ef.plantId)&&!!(null==av?void 0:null===(eg=av.errors)||void 0===eg?void 0:null===(eA=eg.header)||void 0===eA?void 0:eA.plantId)})}),(0,d.jsx)(n.ZP,{item:!0,xs:2,children:(0,d.jsx)(p.Z,{endpointId:F.P.SaleTransaction.pack,parameters:"_functionId=".concat(lL),reducer:e=>{var l;return null==e?void 0:null===(l=e.record)||void 0===l?void 0:l.currencies},name:"header.currencyId",label:l_.currency,filter:e=>1==e.currencyType,valueField:"recordId",displayField:["reference","name"],readOnly:ap,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],required:!0,values:av.values.header,maxAccess:an,onChange:async(e,l)=>{var a;await ay(null==l?void 0:l.recordId,null===(a=av.values.header)||void 0===a?void 0:a.date,O.B.FINANCIALS),av.setFieldValue("header.currencyId",(null==l?void 0:l.recordId)||null),av.setFieldValue("header.currencyName",null==l?void 0:l.name)},error:(null===(eP=av.touched)||void 0===eP?void 0:null===(eF=eP.header)||void 0===eF?void 0:eF.currencyId)&&!!(null===(eC=av.errors)||void 0===eC?void 0:null===(eV=eC.header)||void 0===eV?void 0:eV.currencyId)})}),(0,d.jsx)(n.ZP,{item:!0,xs:1,children:(0,d.jsx)(z.Z,{image:"popup.png",tooltipText:lz.add,onClick:()=>{var e;return e=av.values.header,void lJ({Component:W.Z,props:{DatasetIdAccess:ah(lL),data:e,onOk:e=>{av.setFieldValue("header",{...av.values.header,...e})}}})},disabled:av.values.header.currencyId===(null==l9?void 0:l9.currencyId)})}),(0,d.jsx)(n.ZP,{item:!0,xs:2,children:(0,d.jsx)(m.Z,{name:"header.reference",label:l_.reference,value:null==av?void 0:null===(eN=av.values)||void 0===eN?void 0:null===(ew=eN.header)||void 0===ew?void 0:ew.reference,maxAccess:!aI&&an,readOnly:aI,onChange:av.handleChange,onClear:()=>av.setFieldValue("header.reference",""),error:(null==av?void 0:null===(eT=av.touched)||void 0===eT?void 0:null===(ek=eT.header)||void 0===ek?void 0:ek.reference)&&!!(null==av?void 0:null===(ej=av.errors)||void 0===ej?void 0:null===(eZ=ej.header)||void 0===eZ?void 0:eZ.reference)})}),(0,d.jsx)(n.ZP,{item:!0,xs:2,children:(0,d.jsx)(i.Z,{name:"header.date",required:!0,label:l_.date,readOnly:ap,value:null==av?void 0:null===(eD=av.values)||void 0===eD?void 0:null===(eS=eD.header)||void 0===eS?void 0:eS.date,onChange:async(e,l)=>{av.setFieldValue("header.date",l),await ay(av.values.header.currencyId,l,O.B.FINANCIALS)},editMode:aI,maxAccess:an,onClear:()=>av.setFieldValue("header.date",null),error:(null===(eR=av.touched)||void 0===eR?void 0:null===(eO=eR.header)||void 0===eO?void 0:eO.date)&&!!(null===(eq=av.errors)||void 0===eq?void 0:null===(e_=eq.header)||void 0===e_?void 0:e_.date)})}),(0,d.jsx)(n.ZP,{item:!0,xs:4,children:(0,d.jsx)(p.Z,{endpointId:F.P.SaleTransaction.pack,parameters:"_functionId=".concat(lL),reducer:e=>{var l;return null==e?void 0:null===(l=e.record)||void 0===l?void 0:l.sites},name:"header.siteId",label:l_.site,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:av.values.header,valueField:"recordId",displayField:["reference","name"],maxAccess:an,readOnly:ap||(null===(eM=av.values.items)||void 0===eM?void 0:eM.some(e=>e.sku))||(null==av?void 0:null===(eW=av.values)||void 0===eW?void 0:null===(eL=eW.header)||void 0===eL?void 0:eL.dtId)&&!(null==av?void 0:null===(eE=av.values)||void 0===eE?void 0:null===(eB=eE.header)||void 0===eB?void 0:eB.commitItems),required:!(null==av?void 0:null===(eG=av.values)||void 0===eG?void 0:eG.header.dtId)||(null==av?void 0:null===(eU=av.values)||void 0===eU?void 0:eU.header.dtId)&&(null==av?void 0:null===(eQ=av.values)||void 0===eQ?void 0:eQ.header.commitItems)==!0,onChange:(e,l)=>{av.setFieldValue("header.siteId",l?l.recordId:null),av.setFieldValue("header.siteRef",l?l.reference:null),av.setFieldValue("header.siteName",l?l.name:null)},error:(null==av?void 0:null===(eK=av.touched)||void 0===eK?void 0:null===(e$=eK.header)||void 0===e$?void 0:e$.siteId)&&!!(null===(ez=av.errors)||void 0===ez?void 0:null===(eJ=ez.header)||void 0===eJ?void 0:eJ.siteId)})}),(0,d.jsx)(n.ZP,{item:!0,xs:2,children:(0,d.jsx)(g.Z,{name:"header.creditLimit",maxAccess:an,label:l_.creditLimit,value:av.values.header.creditLimit,readOnly:!0})}),(0,d.jsx)(n.ZP,{item:!0,xs:2,children:(0,d.jsx)(p.Z,{endpointId:F.P.SaleTransaction.pack,parameters:"_functionId=".concat(lL),reducer:e=>{var l;return null==e?void 0:null===(l=e.record)||void 0===l?void 0:l.saleZones},name:"header.szId",label:l_.saleZone,readOnly:ap,columnsInDropDown:[{key:"name",value:"Name"}],valueField:"recordId",displayField:"name",values:av.values.header,maxAccess:an,onChange:(e,l)=>{av.setFieldValue("header.szId",l?l.recordId:null)},error:(null==av?void 0:null===(eY=av.touched)||void 0===eY?void 0:null===(eX=eY.header)||void 0===eX?void 0:eX.szId)&&!!(null==av?void 0:null===(e0=av.errors)||void 0===e0?void 0:null===(eH=e0.header)||void 0===eH?void 0:eH.szId)})}),(0,d.jsx)(n.ZP,{item:!0,xs:4,children:(0,d.jsx)(x.U,{endpointId:F.P.Client.snapshot,name:"header.clientId",label:l_.client,valueField:"reference",displayField:"name",valueShow:"clientRef",secondValueShow:"clientName",formObject:av.values.header,form:av,firstFieldWidth:4,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name",grid:8},{key:"szName",value:"Sales Zone"},{key:"keywords",value:"Keywords"},{key:"cgName",value:"Client Group"}],onChange:(e,l)=>{aR(l)},secondField:{name:"header.clientName",editable:!0,onChange:(e,l)=>{av.setFieldValue("header.clientName",l)}},maxAccess:an,required:!0,autoSelectFistValue:!av.values.clientId,readOnly:av.values.items.length>0&&av.values.items[0].sku,displayFieldWidth:5,editMode:aI,error:(null===(e1=av.touched)||void 0===e1?void 0:null===(e2=e1.header)||void 0===e2?void 0:e2.clientId)&&!!(null===(e6=av.errors)||void 0===e6?void 0:null===(e3=e6.header)||void 0===e3?void 0:e3.clientId)})}),(0,d.jsx)(n.ZP,{item:!0,xs:1,children:(0,d.jsx)(z.Z,{onClick:()=>{lJ({Component:X.Z,props:{formValues:av.values.header,onSubmit:e=>di(e)}})},image:"popup.png",disabled:!(aI&&!ap&&av.values.header.clientId||!aI&&av.values.header.clientId&&(null===(e5=av.values.items)||void 0===e5?void 0:e5.length)>0&&(null===(e8=av.values.items)||void 0===e8?void 0:e8.some(e=>null==e?void 0:e.itemId))),tooltipText:lz.editClient})}),(0,d.jsx)(n.ZP,{item:!0,xs:1,children:(0,d.jsx)(M.Z,{name:"header.isVattable",value:null===(e4=av.values)||void 0===e4?void 0:null===(e9=e4.header)||void 0===e9?void 0:e9.isVattable,onChange:e=>av.setFieldValue("header.isVattable",e.target.checked),label:l_.VAT,maxAccess:an,disabled:(null==av?void 0:null===(e7=av.values)||void 0===e7?void 0:e7.items)&&(null==av?void 0:null===(ll=av.values)||void 0===ll?void 0:null===(le=ll.items[0])||void 0===le?void 0:le.itemId)})}),(0,d.jsx)(n.ZP,{item:!0,xs:2,children:(0,d.jsx)(p.Z,{endpointId:F.P.SaleTransaction.pack,parameters:"_functionId=".concat(lL),reducer:e=>{var l;return null==e?void 0:null===(l=e.record)||void 0===l?void 0:l.taxSchedules},name:"header.taxId",label:l_.tax,valueField:"recordId",displayField:["name"],readOnly:!0,values:av.values.header,error:(null==av?void 0:null===(ld=av.touched)||void 0===ld?void 0:null===(la=ld.header)||void 0===la?void 0:la.taxId)&&!!(null==av?void 0:null===(lt=av.errors)||void 0===lt?void 0:null===(li=lt.header)||void 0===li?void 0:li.taxId),maxAccess:an})}),(0,d.jsx)(n.ZP,{item:!0,xs:2,children:(0,d.jsx)(p.Z,{endpointId:(null==av?void 0:null===(lo=av.values)||void 0===lo?void 0:null===(ln=lo.header)||void 0===ln?void 0:ln.clientId)&&F.P.Contact.qry,parameters:"_clientId=".concat(null==av?void 0:null===(lu=av.values)||void 0===lu?void 0:null===(lr=lu.header)||void 0===lr?void 0:lr.clientId),name:"header.contactId",label:l_.contact,valueField:"recordId",readOnly:ap,displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:av.values.header,maxAccess:an,onChange:(e,l)=>{av.setFieldValue("header.contactId",(null==l?void 0:l.recordId)||null)},error:(null==av?void 0:null===(lc=av.touched)||void 0===lc?void 0:null===(ls=lc.header)||void 0===ls?void 0:ls.contactId)&&!!(null==av?void 0:null===(lm=av.errors)||void 0===lm?void 0:null===(lv=lm.header)||void 0===lv?void 0:lv.contactId)})}),(0,d.jsx)(n.ZP,{item:!0,xs:2,children:(0,d.jsx)(m.Z,{name:"search",value:av.values.search,label:lz.Search,onClear:()=>{av.setFieldValue("search","")},onChange:e=>{let{value:l}=e.target;av.setFieldValue("search",l)}})}),(0,d.jsx)(n.ZP,{item:!0,xs:3,children:l5&&(0,d.jsx)(g.Z,{name:"header.KGmetalPrice",label:l_.metalPrice,value:av.values.header.KGmetalPrice,maxAccess:an,readOnly:!0})})]})}),(0,d.jsx)(y.Q,{children:(0,d.jsx)(f._,{onChange:(e,l,a)=>{let d=e;if(av.values.search){let e=av.values.items.map(e=>{let l=d.find(l=>l.id===e.id);return l?{...e,...l}:e});av.setFieldValue("items",e),am.current=e}else av.setFieldValue("items",d),am.current=d;if("delete"===l){let l=av.values.items.filter(e=>e.id!==a.id);d=e.filter(e=>e.id!==a.id),av.setFieldValue("items",l),aa(!0)}},value:a9,error:av.errors.items,initialValues:null==av?void 0:null===(lh=av.initialValues)||void 0===lh?void 0:lh.items[0],onSelectionChange:(e,l,a)=>{"muRef"==a&&aU(null==e?void 0:e.itemId,null==e?void 0:e.msId)},name:"items",columns:aA,maxAccess:an,allowDelete:!ap,allowAddNewLine:!av.values.search,disabled:ap||!(null===(lI=av.values)||void 0===lI?void 0:null===(lp=lI.header)||void 0===lp?void 0:lp.currencyId)||!(null===(ly=av.values)||void 0===ly?void 0:null===(lx=ly.header)||void 0===lx?void 0:lx.clientId)||!((null===(lb=av.values)||void 0===lb?void 0:null===(lf=lb.header)||void 0===lf?void 0:lf.dtId)&&!(null===(lg=av.values)||void 0===lg?void 0:null===(lA=lg.header)||void 0===lA?void 0:lA.commitItems))&&!(null===(lP=av.values)||void 0===lP?void 0:null===(lF=lP.header)||void 0===lF?void 0:lF.siteId)})}),(0,d.jsx)(A.g,{children:(0,d.jsxs)(n.ZP,{container:!0,spacing:2,sx:{pt:2},children:[(0,d.jsx)(n.ZP,{item:!0,xs:4,children:(0,d.jsxs)(n.ZP,{container:!0,spacing:2,children:[(0,d.jsx)(n.ZP,{item:!0,xs:12,children:(0,d.jsx)(h.Z,{name:"header.billAddress",label:l_.billTo,value:av.values.header.billAddress,rows:3,maxLength:"100",readOnly:!av.values.header.clientId||ap,maxAccess:an,viewDropDown:av.values.header.clientId,viewAdd:av.values.header.clientId&&!aI,onChange:e=>av.setFieldValue("header.billAddress",e.target.value),onClear:()=>av.setFieldValue("header.billAddress",""),onDropDown:()=>{var e,l;lJ({Component:S.Z,props:{maxAccess:an,labels:l_,bill:!0,form:av.values.header,checkedAddressId:null===(l=av.values)||void 0===l?void 0:null===(e=l.header)||void 0===e?void 0:e.billAddressId,handleAddressValues:a5}})},handleAddAction:()=>void lJ({Component:Q.Z,props:{address:l3,setAddress:l6,isCleared:!1,datasetId:L.i.ADDSalesTransaction}}),error:(null==av?void 0:null===(lC=av.touched)||void 0===lC?void 0:null===(lV=lC.header)||void 0===lV?void 0:lV.billAddress)&&!!(null==av?void 0:null===(lN=av.errors)||void 0===lN?void 0:null===(lw=lN.header)||void 0===lw?void 0:lw.billAddress)})}),(0,d.jsx)(n.ZP,{item:!0,xs:12,children:(0,d.jsx)(h.Z,{name:"header.description",label:l_.description,value:av.values.header.description,rows:3,readOnly:ap,maxAccess:an,onChange:e=>av.setFieldValue("header.description",e.target.value),onClear:()=>av.setFieldValue("header.description",""),error:(null==av?void 0:null===(lT=av.touched)||void 0===lT?void 0:null===(lk=lT.header)||void 0===lk?void 0:lk.description)&&!!(null==av?void 0:null===(lj=av.errors)||void 0===lj?void 0:null===(lZ=lj.header)||void 0===lZ?void 0:lZ.description)})})]})}),(0,d.jsx)(n.ZP,{item:!0,xs:2}),(0,d.jsx)(n.ZP,{item:!0,xs:3,children:(0,d.jsxs)(n.ZP,{container:!0,spacing:2,children:[(0,d.jsx)(n.ZP,{item:!0,xs:12,children:(0,d.jsx)(g.Z,{name:"header.qty",maxAccess:an,label:l_.totQty,value:az,readOnly:!0})}),(0,d.jsx)(n.ZP,{item:!0,xs:12,children:(0,d.jsx)(g.Z,{name:"header.volume",maxAccess:an,label:l_.totVolume,value:aY,readOnly:!0})}),(0,d.jsx)(n.ZP,{item:!0,xs:12,children:(0,d.jsx)(g.Z,{name:"header.weight",maxAccess:an,label:l_.totWeight,value:aH,readOnly:!0})}),(0,d.jsx)(n.ZP,{item:!0,xs:12,children:(0,d.jsx)(g.Z,{name:"header.balance",maxAccess:an,label:l_.balance,value:av.values.header.balance,readOnly:!0})})]})}),(0,d.jsx)(n.ZP,{item:!0,xs:3,children:(0,d.jsxs)(n.ZP,{container:!0,spacing:2,children:[(0,d.jsx)(n.ZP,{item:!0,xs:12,children:(0,d.jsx)(g.Z,{name:"header.subTotal",maxAccess:an,label:l_.subtotal,value:a0,readOnly:!0})}),(0,d.jsx)(n.ZP,{item:!0,xs:12,children:(0,d.jsx)(g.Z,{name:"header.discount",maxAccess:an,label:l_.discount,value:av.values.header.currentDiscount,displayCycleButton:!0,cycleButtonLabel:lH.text,decimalScale:2,readOnly:ap,handleButtonClick:()=>{let e,l,a;aa(!0),1==lH.value?(e=parseFloat(l=av.values.header.currentDiscount<0||av.values.header.currentDiscount>100?0:av.values.header.currentDiscount)*parseFloat(av.values.header.subtotal)/100,a=l,av.setFieldValue("header.tdAmount",e),av.setFieldValue("header.tdPct",l),av.setFieldValue("header.currentDiscount",l)):(l=parseFloat(e=av.values.header.currentDiscount<0||av.values.header.subtotal<av.values.header.currentDiscount?0:av.values.header.currentDiscount)/parseFloat(av.values.header.subtotal)*100,a=e,av.setFieldValue("header.tdPct",l),av.setFieldValue("header.tdAmount",e),av.setFieldValue("currentDiscount",e)),l0(d=>{let i="%"===d.text?{text:"123",value:1}:{text:"%",value:2};return av.setFieldValue("header.tdType",i.value),a1(i.value,l,e,a),i})},iconKey:lH.text,ShowDiscountIcons:!0,onChange:e=>{let l=Number(e.target.value.replace(/,/g,""));av.values.header.tdType==j.a$?((l<0||l>100)&&(l=0),av.setFieldValue("header.tdPct",l)):((l<0||av.values.header.subtotal<l)&&(l=0),av.setFieldValue("header.tdAmount",l)),av.setFieldValue("header.currentDiscount",l)},onBlur:async e=>{let l=Number(e.target.value.replace(/,/g,"")),a=Number(e.target.value.replace(/,/g,"")),d=Number(e.target.value.replace(/,/g,""));av.values.header.tdType==j.ER&&(a=parseFloat(l)/parseFloat(a0)*100,av.setFieldValue("header.tdPct",a)),av.values.header.tdType==j.a$&&(d=parseFloat(l)*parseFloat(a0)/100,av.setFieldValue("header.tdAmount",d)),aa(!0),await a1(av.values.header.tdType,a,d,l)},onClear:()=>{av.setFieldValue("header.tdAmount",0),av.setFieldValue("header.tdPct",0),a1(av.values.header.tdType,0,0,0)}})}),(0,d.jsx)(n.ZP,{item:!0,xs:12,children:(0,d.jsx)(g.Z,{name:"header.miscAmount",maxAccess:an,label:l_.misc,value:av.values.header.miscAmount,decimalScale:2,readOnly:ap,onChange:e=>{var l,a,d;av.setFieldValue("header.miscAmount",e.target.value);let i=(0,B.fB)({amount:null!==(d=e.target.value)&&void 0!==d?d:0,exRate:null===(l=av.values)||void 0===l?void 0:l.exRate,baseAmount:0,rateCalcMethod:null===(a=av.values)||void 0===a?void 0:a.rateCalcMethod,dirtyField:B.ss});av.setFieldValue("header.baseAmount",parseFloat(null==i?void 0:i.baseAmount).toFixed(2)||0)},onBlur:async()=>{aa(!0)},onClear:()=>av.setFieldValue("header.miscAmount",0),error:(null==av?void 0:null===(lD=av.touched)||void 0===lD?void 0:null===(lS=lD.header)||void 0===lS?void 0:lS.miscAmount)&&!!(null==av?void 0:null===(lR=av.errors)||void 0===lR?void 0:null===(lO=lR.header)||void 0===lO?void 0:lO.miscAmount)})}),(0,d.jsx)(n.ZP,{item:!0,xs:12,children:(0,d.jsx)(g.Z,{name:"header.vatAmount",maxAccess:an,label:l_.VAT,value:a2,readOnly:!0})}),(0,d.jsx)(n.ZP,{item:!0,xs:12,children:(0,d.jsx)(g.Z,{name:"header.amount",maxAccess:an,label:l_.net,value:aX,readOnly:!0})})]})})]})})]})})}Y.width=1330,Y.height=720},77595:function(e,l,a){a.d(l,{Z:function(){return A}});var d=a(52322),i=a(60218),t=a(2784),n=a(26612),o=a(5088),r=a(80983),u=a(31389),s=a(62362),c=a(91406),v=a(30657),m=a(65950),h=a(1251),p=a(39812),I=a(26553),x=a(71987),y=a(21326),f=a(19473),b=a(54074);function A(e){var l,a,A,g,F,P,V,C,w;let{data:N,onOk:k,DatasetIdAccess:T,window:Z}=e,{getRequest:j}=(0,t.useContext)(m.$),{platformLabels:S}=(0,t.useContext)(f.l);(0,y.Z)({title:S.MultiCurrencyRate,window:Z});let{labels:D,access:O}=(0,x.J)({endpointId:h.q.Currency.get,DatasetIdAccess:T,datasetId:n.i.MultiCurrencyRate}),{formik:R}=(0,r.c)({initialValues:{currencyId:null==N?void 0:N.currencyId,currencyName:null==N?void 0:N.currencyName,exchangeId:null==N?void 0:N.exchangeId,exchangeName:null==N?void 0:N.exchangeName,rateCalcMethod:null==N?void 0:N.rateCalcMethod,rateCalcMethodName:null==N?void 0:N.rateCalcMethodName,rateTypeId:null==N?void 0:N.rateTypeId,exRate:(null==N?void 0:N.exRate)||null,amount:(null==N?void 0:N.amount)||0,baseAmount:null==N?void 0:N.baseAmount,rateTypeName:null==N?void 0:N.rateTypeName},maxAccess:O,validateOnChange:!0});async function _(){if((null==N?void 0:N.currencyId)&&(null==N?void 0:N.date)){var e,l,a,d,i;let t=await j({extension:h.q.Currency.get,parameters:"_currencyId=".concat(null==N?void 0:N.currencyId,"&_date=").concat((0,p.Uf)(null==N?void 0:N.date),"&_rateDivision=").concat(I.B.FINANCIALS)});R.setFieldValue("rateCalcMethod",null===(e=t.record)||void 0===e?void 0:e.rateCalcMethod),R.setFieldValue("rateCalcMethodName",null===(l=t.record)||void 0===l?void 0:l.rateCalcMethodName),R.setFieldValue("exchangeId",null===(a=t.record)||void 0===a?void 0:a.exchangeId),R.setFieldValue("exchangeName",null===(d=t.record)||void 0===d?void 0:d.exchangeName),R.setFieldValue("rateTypeName",null===(i=t.record)||void 0===i?void 0:i.rateTypeName)}}(0,t.useEffect)(()=>{!async function(){await _()}()},[]);let q=()=>{k&&(k({...R.values,exRate:R.values.exRate,baseAmount:R.values.baseAmount,amount:R.values.amount}),Z.close())},M=[{key:"Ok",condition:!0,onClick:q,disabled:!1}];return(0,d.jsx)(b.Z,{onSave:q,actions:M,maxAccess:O,editMode:!1,isSaved:!1,children:(0,d.jsx)(u.R,{children:(0,d.jsx)(s.Q,{children:(0,d.jsxs)(i.ZP,{container:!0,spacing:2,children:[(0,d.jsx)(i.ZP,{item:!0,xs:12,children:(0,d.jsx)(o.Z,{name:"currencyName",value:null==R?void 0:null===(l=R.values)||void 0===l?void 0:l.currencyName,label:D.currency,readOnly:!0})}),(0,d.jsx)(i.ZP,{item:!0,xs:12,children:(0,d.jsx)(o.Z,{name:"rateTypeName",value:null==R?void 0:null===(a=R.values)||void 0===a?void 0:a.rateTypeName,label:D.rateType,readOnly:!0})}),(0,d.jsx)(i.ZP,{item:!0,xs:12,children:(0,d.jsx)(o.Z,{name:"exchangeName",value:null==R?void 0:null===(A=R.values)||void 0===A?void 0:A.exchangeName,label:D.exchangeTable,readOnly:!0})}),(0,d.jsx)(i.ZP,{item:!0,xs:12,children:(0,d.jsx)(o.Z,{name:"rateCalcMethodName",value:null==R?void 0:null===(g=R.values)||void 0===g?void 0:g.rateCalcMethodName,label:D.rateCalcMethod,readOnly:!0})}),(0,d.jsx)(i.ZP,{item:!0,xs:12,children:(0,d.jsx)(c.Z,{name:"exRate",value:null==R?void 0:null===(F=R.values)||void 0===F?void 0:F.exRate,label:D.rate,readOnly:(null==R?void 0:null===(P=R.values)||void 0===P?void 0:P.amount)==0,maxAccess:O,onClear:()=>{R.setFieldValue("baseAmount",""),R.setFieldValue("exRate","")},decimalScale:7,onChange:e=>{var l,a;let d=e.target.value;if(!d){R.setFieldValue("exRate",""),R.setFieldValue("baseAmount","");return}R.setFieldValue("exRate",d);let i=(0,v.fB)({amount:(null==N?void 0:N.amount)||0,exRate:d,baseAmount:parseFloat((null==R?void 0:null===(l=R.values)||void 0===l?void 0:l.baseAmount)||0).toFixed(2),rateCalcMethod:null==R?void 0:null===(a=R.values)||void 0===a?void 0:a.rateCalcMethod,dirtyField:v.ss});R.setValues({...R.values,...i,baseAmount:parseFloat(i.baseAmount).toFixed(2)})}})}),(0,d.jsx)(i.ZP,{item:!0,xs:12,children:(0,d.jsx)(c.Z,{name:"amount",value:null==R?void 0:null===(V=R.values)||void 0===V?void 0:V.amount,label:D.amount,readOnly:!0})}),(0,d.jsx)(i.ZP,{item:!0,xs:12,children:(0,d.jsx)(c.Z,{name:"baseAmount",value:null==R?void 0:null===(C=R.values)||void 0===C?void 0:C.baseAmount,label:D.baseAmount,readOnly:(null==R?void 0:null===(w=R.values)||void 0===w?void 0:w.amount)==0,onClear:()=>{R.setFieldValue("baseAmount",""),R.setFieldValue("exRate","")},maxAccess:O,onChange:e=>{var l,a;let d=e.target.value;if(!d){R.setFieldValue("baseAmount",""),R.setFieldValue("exRate","");return}R.setFieldValue("baseAmount",d);let i=(0,v.fB)({amount:(null==N?void 0:N.amount)||0,exRate:null==R?void 0:null===(l=R.values)||void 0===l?void 0:l.exRate,baseAmount:parseFloat(d||0).toFixed(2),rateCalcMethod:null==R?void 0:null===(a=R.values)||void 0===a?void 0:a.rateCalcMethod,dirtyField:v.i5});R.setValues({...R.values,...i})}})})]})})})})}A.width=500,A.height=500},78618:function(e,l,a){var d=a(52322),i=a(23925),t=a(31389),n=a(62362);let o=e=>{let{DialogText:l,bottomSection:a}=e;return(0,d.jsxs)(t.R,{children:[(0,d.jsx)(n.Q,{children:(0,d.jsx)(i.Z,{sx:{p:12},textAlign:"center",children:l})}),a]})};o.width=600,o.height=200,l.Z=o},85572:function(e,l,a){a.d(l,{u:function(){return P}});var d=a(52322),i=a(31389),t=a(62362),n=a(26612),o=a(60218),r=a(8661),u=a(80983),s=a(48601),c=a(71987),v=a(2784),m=a(65950),h=a(91406),p=a(27423),I=a(65215),x=a(76399),y=a(33625),f=a(96026),b=a(19473),A=a(51235),g=a(21326),F=a(54074);let P=e=>{var l,a,P,V,C,w;let{row:N,siteId:k,checkForSiteId:T,window:Z,updateRow:j,disabled:S}=e,{getRequest:D}=(0,v.useContext)(m.$),{stack:O}=(0,f.V)(),{platformLabels:R,systemChecks:_}=(0,v.useContext)(b.l),q=_.some(e=>e.checkId===A.F.ALLOW_INVENTORY_NEGATIVE_QTY),M=(null==_?void 0:null===(l=_.find(e=>e.checkId===A.F.POS_JUMP_TO_NEXT_LINE))||void 0===l?void 0:l.value)||!1,{labels:L,maxAccess:W}=(0,c.J)({datasetId:n.i.Serial});(0,g.Z)({title:R.serials,window:Z});let{formik:B}=(0,u.c)({maxAccess:W,initialValues:{sku:null==N?void 0:N.sku,itemName:null==N?void 0:N.itemName,itemId:null==N?void 0:N.itemId,siteId:k,totalWeight:(null==N?void 0:N.qty)||0,pieces:null,items:(null==N?void 0:N.serials)||[]},validateOnChange:!0,validationSchema:s.Ry({items:s.IX().of(s.Ry({srlNo:s.Z_().test(function(e){var l,a,d;return(null===(d=this.options.from[1])||void 0===d?void 0:null===(a=d.value)||void 0===a?void 0:null===(l=a.items)||void 0===l?void 0:l.length)===1||!!e})}))}),onSubmit:async e=>{let l=e.items.filter(e=>null==e?void 0:e.srlNo).map((e,l)=>({...e,id:l+1,srlSeqNo:l+1,srlNo:e.srlNo,seqNo:N.id}));j({changes:{serials:l,...(null==N?void 0:N.hasOwnProperty("serialCount"))&&{serialCount:(null==l?void 0:l.length)||0}}}),Z.close()}}),E=B.values.items.reduce((e,l)=>e+(parseFloat(l.weight)||0),0),G=B.values.totalWeight-E||0,U=[{component:"textfield",name:"srlNo",label:L.serialNo,jumpToNextLine:M,updateOn:"blur",onChange:async e=>{let{row:{update:l,newRow:a,oldRow:d,addRow:i}}=e;a.srlNo!==(null==d?void 0:d.srlNo)&&await K(a,l,i)}},{component:"numberfield",name:"weight",label:L.weight,props:{readOnly:!0}}],Q=e=>{let l=B.values.items.map(l=>l.id===e?{...l,srlNo:"",weight:""}:l);B.setFieldValue("items",l)},$=e=>{let l=B.values.items.filter(l=>l.id!==e);0===l.length&&(l=[{id:0,srlNo:"",weight:""}]),B.setFieldValue("items",l)},K=async(e,l,a)=>{let{srlNo:d,id:i}=e;if(d){var t;let n=await D({extension:I.$.Serial.get,parameters:"_srlNo=".concat(d)});n.record?(null==n?void 0:null===(t=n.record)||void 0===t?void 0:t.itemId)!==(null==N?void 0:N.itemId)?(O({message:R.serialDoesNotBelongItem}),Q(i)):T&&!q&&B.values.siteId?(await D({extension:I.$.AvailabilitySerial.get,parameters:"_srlNo=".concat(d,"&_siteId=").concat(B.values.siteId)})).record?(l({weight:n.record.weight}),a({fieldName:"srlNo",changes:{id:e.id,srlNo:e.srlNo,weight:n.record.weight}})):(O({message:L.invalidSerial}),Q(i)):(l({weight:n.record.weight}),a({fieldName:"srlNo",changes:{id:e.id,srlNo:e.srlNo,weight:n.record.weight}})):(O({message:R.unknownSerial}),$(i))}},J=[{key:"Ok",condition:!0,onClick:()=>B.handleSubmit(),disabled:S}];return(0,d.jsx)(F.Z,{onSave:B.handleSubmit,isSaved:!1,actions:J,maxAccess:W,children:(0,d.jsxs)(i.R,{children:[(0,d.jsx)(y.g,{children:(0,d.jsxs)(o.ZP,{container:!0,spacing:2,children:[(0,d.jsx)(o.ZP,{item:!0,xs:12,children:(0,d.jsx)(p.U,{endpointId:I.$.Item.snapshot,name:"itemId",label:null==L?void 0:L.sku,valueField:"recordId",displayField:"sku",valueShow:"sku",secondValueShow:"itemName",form:B,readOnly:!0})}),(0,d.jsx)(o.ZP,{item:!0,xs:12,children:(0,d.jsx)(r.Z,{endpointId:I.$.Site.qry,name:"siteId",label:L.site,values:B.values,valueField:"recordId",displayField:["reference","name"],maxAccess:W,readOnly:!0})}),(0,d.jsx)(o.ZP,{item:!0,xs:12,children:(0,d.jsx)(h.Z,{name:"totalWeight",label:L.totalWeight,maxAccess:W,value:B.values.totalWeight,readOnly:!0})}),(0,d.jsx)(o.ZP,{item:!0,xs:12,children:(0,d.jsx)(h.Z,{name:"weightAssigned",label:L.weightAssigned,maxAccess:W,value:E,readOnly:!0})}),(0,d.jsx)(o.ZP,{item:!0,xs:12,children:(0,d.jsx)(h.Z,{name:"balanceWeight",label:L.balanceWeight,maxAccess:W,value:G,readOnly:!0})}),(0,d.jsx)(o.ZP,{item:!0,xs:12,children:(0,d.jsx)(h.Z,{name:"pieces",label:L.pieces,maxAccess:W,value:null==B?void 0:null===(V=B.values)||void 0===V?void 0:null===(P=V.items)||void 0===P?void 0:null===(a=P.filter(e=>void 0!==e.srlNo))||void 0===a?void 0:a.length,readOnly:!0})})]})}),(0,d.jsx)(t.Q,{children:(0,d.jsx)(x._,{onChange:e=>B.setFieldValue("items",e),value:null===(C=B.values)||void 0===C?void 0:C.items,error:null===(w=B.errors)||void 0===w?void 0:w.items,name:"items",columns:U,maxAccess:W,disabled:S,allowDelete:!S,allowAddNewLine:!S})})]})})};P.width=500,P.height=700}}]);