"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[53164],{1685:function(e,l,n){n.d(l,{m:function(){return r}});let r=e=>{let l=window.sessionStorage.getItem(e);return l?JSON.parse(l):null}},98345:function(e,l,n){n.d(l,{H:function(){return I},G:function(){return h}});var r=n(45300),d=n(2784),a=n(96026),t=n(38449);n(26612);var i=n(65947),o=n(1685);let s=async(e,l,n)=>{try{let r=await e({extension:l,parameters:n});return l.includes("qry")?r:r.record}catch(e){return null}},u=(e,l,n,r)=>{let d=(e=JSON.parse(JSON.stringify(e))).record.controls,a=d.find(e=>"reference"===e.controlId);return a?a.accessLevel=(null==l?void 0:l.mandatory)?i.$7:i.rr:(null==l?void 0:l.mandatory)?d.push({sgId:0,resourceId:"",controlId:"".concat(r?r+".":"","reference"),accessLevel:(null==l?void 0:l.mandatory)?i.$7:i.rr}):(null==l?void 0:l.readOnly)?d.push({sgId:0,resourceId:"",controlId:"".concat(r?r+".":"","reference"),accessLevel:(null==l?void 0:l.readOnly)?i.rr:i.$7}):d=e.record.controls.filter(e=>"reference"!=e.controlId),n&&d.push({sgId:0,resourceId:"",controlId:"".concat(r?r+".":"","dtId"),accessLevel:i.$7}),{...e,record:{...e.record,controls:d}}},c=async(e,l,n)=>{let r,d;switch(n){case"dtId":let a=(0,o.m)("userData"),i=null==a?void 0:a.userId;d="_userId=".concat(i,"&_functionId=").concat(l),r=t.r.UserFunction.get;break;case"glbSysNumberRange":d="_recordId=".concat(l),r=t.r.SystemFunction.get;break;case"DocumentType":d="_dgId=".concat(l,"&_startAt=",0,"&_pageSize=",50),r=t.r.DocumentType.qry;break;case"DcTypNumberRange":d="_recordId=".concat(l),r=t.r.DocumentType.get;break;case"isExternal":d="_recordId=".concat(l),r=t.r.NumberRange.get;break;default:return null}return await s(e,r,d)},v=async function(e){let l,n,r,d,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,t=arguments.length>2?arguments[2]:void 0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,o=!(arguments.length>4)||void 0===arguments[4]||arguments[4],s=arguments.length>5?arguments[5]:void 0,v=void 0===i&&a&&await c(e,a,"dtId"),m=null==v?void 0:v.dtId,h="",I=!0;if(v&&void 0===i||"nraId"===i){if(m){let n=await c(e,m,"DcTypNumberRange");l=null==n?void 0:n.nraId,I=!((null==n?void 0:n.activeStatus)<0),l||(h="Assign the document type to a number range")}if((!m||!I)&&o&&a){var x;let l=await c(e,a,"DocumentType");d=(null==l?void 0:null===(x=l.list)||void 0===x?void 0:x.filter(e=>(null==e?void 0:e.activeStatus)===1).length)>0}}if(("nraId"===i||void 0===i)&&a){if((!m||m)&&!l||l&&!I){let n=await c(e,a,"glbSysNumberRange");(l=null==n?void 0:n.nraId)&&d&&(d=!1),I=!0}h=l||d?"":"Assign the system Function to a number range"}i>0&&!l&&(l=i),l&&I?(n={readOnly:null==(r=await c(e,l,"isExternal"))||!r.external,mandatory:null!=r&&!!r.external},t&&(t=await u(t,n,d,s))):!l&&t&&(t=await u(t,n,d,s));let y=s?"".concat(s,".reference"):"reference";return{dtId:m,resetReference:null==n?void 0:n.readOnly,dcTypeRequired:d,reference:{fieldName:y,isEmpty:(null==r?void 0:r.external)!==void 0&&(null==r||!r.external)},errorMessage:h,maxAccess:t,selectNraId:i}};var m=n(65950);function h(e){let{functionId:l,action:n,hasDT:r}=e,{getRequest:t}=(0,d.useContext)(m.$),{stack:i}=(0,a.V)();return{proxyAction:async()=>{let e=await v(t,l,"",void 0,r);(null==e?void 0:e.errorMessage)?i({message:null==e?void 0:e.errorMessage}):await n()}}}function I(e){var l;let{functionId:n,access:t,hasDT:i,enabled:o=!0,objectName:s=""}=e,{getRequest:u}=(0,d.useContext)(m.$),{stack:c}=(0,a.V)(),[h,I]=(0,d.useState)(),x=async e=>{let l=await v(u,n,t,e,i,s);if(!l.errorMessage)return l;c({message:null==l?void 0:l.errorMessage})},y=(0,r.a)({retry:!1,staleTime:0,enabled:o,queryKey:[n,h,!!t,o],queryFn:h||"nraId"===h?()=>x(h):()=>x()});return{documentType:y.data,maxAccess:(null==y?void 0:null===(l=y.data)||void 0===l?void 0:l.maxAccess)||t,changeDT(e){I((null==e?void 0:e.nraId)||"nraId")}}}},53164:function(e,l,n){n.d(l,{Z:function(){return A}});var r=n(52322),d=n(60218),a=n(2784),t=n(48601),i=n(82737),o=n(2801),s=n(62202),u=n(65950),c=n(71987),v=n(26612),m=n(5088),h=n(80983),I=n(19473),x=n(31389),y=n(89330),g=n(8661),f=n(38449),p=n(7121),D=n(21581),F=n(98345),b=n(39812),j=n(33625),Z=n(63518),C=n(90587),P=n(27423),w=n(91406),O=n(93883),R=n(93432),N=n(38096),V=n(61802),S=n(21326),k=n(50023);function A(e){var l,n,A,L,_,G,T,q;let{recordId:z,window:E}=e,{getRequest:M,postRequest:J}=(0,a.useContext)(u.$),{platformLabels:$}=(0,a.useContext)(I.l),U=(0,a.useRef)(null),H=p.J.ThreeDPrint,{stack:K}=(0,V.zY)(),{labels:W,access:Y}=(0,k.Z)({datasetId:v.i.Printing,editMode:!!z}),{documentType:B,maxAccess:Q,changeDT:X}=(0,F.H)({functionId:H,access:Y,enabled:!z});(0,S.Z)({title:$.threeDPrinting,window:E});let ee=(0,c.E)({endpointId:Z.z.Printing.page}),{formik:el}=(0,h.c)({documentType:{key:"dtId",value:null==B?void 0:B.dtId},initialValues:{recordId:null,reference:"",dtId:null,date:new Date,threeDDId:null,fileReference:"",setPcs:null,weight:null,machineId:null,startDate:null,endDate:null,notes:"",jobId:null,productionClassId:null,productionLineId:null,collectionId:null,productionStandardRef:"",designGroupId:null,designFamilyId:null,designerName:"",metalRef:"",collectionName:"",itemGroupName:"",density:null,nbOfLayers:null,status:1,wip:1},maxAccess:Q,validateOnChange:!0,validationSchema:t.Ry({date:t.hT().required(),threeDDId:t.Rx().required(),machineId:t.Rx().required(),setPcs:t.Rx().nullable()}),onSubmit:async e=>{let l={...e,date:(0,b.ku)(null==e?void 0:e.date)},n=await J({extension:Z.z.Printing.set,record:JSON.stringify(l)});U.current&&(U.current.value=n.recordId,await U.current.submit()),ea(n.recordId),ee(),s.ZP.success(e.recordId?$.Added:$.Edited)}}),en=3===el.values.status,er=4==el.values.status,ed=!!el.values.recordId;async function ea(e){var l,n,r;let d=await M({extension:Z.z.Printing.get,parameters:"_recordId=".concat(e)});el.setValues({...d.record,date:(0,b.a1)(null==d?void 0:null===(l=d.record)||void 0===l?void 0:l.date),startDate:(0,b.a1)(null==d?void 0:null===(n=d.record)||void 0===n?void 0:n.startDate),endDate:(0,b.a1)(null==d?void 0:null===(r=d.record)||void 0===r?void 0:r.endDate)})}async function et(e){if(e){var l;let n=await M({extension:Z.z.DocumentTypeDefault.get,parameters:"_dtId=".concat(e)});el.setFieldValue("productionLineId",null==n?void 0:null===(l=n.record)||void 0===l?void 0:l.productionLineId)}}async function ei(e){let l=await M({extension:R.C.getLabels,parameters:"_dataset=".concat(e)});return l.list?Object.fromEntries(l.list.map(e=>{let{key:l,value:n}=e;return[l,n]})):{}}(0,a.useEffect)(()=>{var e;el.values.dtId&&!z&&et(null==el?void 0:null===(e=el.values)||void 0===e?void 0:e.dtId)},[el.values.dtId]);let eo=[{key:"Locked",condition:!0,onClick:async()=>{var e;let l={...el.values,date:(0,b.ku)(null===(e=el.values)||void 0===e?void 0:e.date)};await J({extension:Z.z.Printing.post,record:JSON.stringify(l)}),ea(el.values.recordId),s.ZP.success($.Posted),ee()},disabled:!ed||en||!er},{key:"threeDDesign",condition:!0,onClick:async()=>{var e;let l=await ei(v.i.ThreeDDesign);K({Component:N.Z,props:{recordId:null===(e=el.values)||void 0===e?void 0:e.threeDDId,labels:l},width:1200,height:700,title:l.ThreeDDesign})},disabled:!el.values.threeDDId},{key:"Start",condition:!0,onClick:es,disabled:!ed||en||er}];async function es(){var e;let l={...el.values,date:(0,b.ku)(null===(e=el.values)||void 0===e?void 0:e.date)},n=await J({extension:Z.z.Printing.start,record:JSON.stringify(l)});s.ZP.success($.Started),ee(),ea(n.recordId)}(0,a.useEffect)(()=>{z&&ea(z)},[]);let eu=async e=>await M({extension:Z.z.ThreeDDrawing.get,parameters:"_recordId=".concat(e)});return(0,r.jsx)(i.Z,{resourceId:v.i.Printing,form:el,maxAccess:Q,editMode:ed,actions:eo,functionId:H,disabledSubmit:en,children:(0,r.jsx)(x.R,{children:(0,r.jsx)(j.g,{children:(0,r.jsxs)(d.ZP,{container:!0,spacing:2,children:[(0,r.jsx)(d.ZP,{item:!0,xs:6,children:(0,r.jsxs)(d.ZP,{container:!0,spacing:2,children:[(0,r.jsx)(d.ZP,{item:!0,xs:12,children:(0,r.jsx)(g.Z,{endpointId:f.r.DocumentType.qry,parameters:"_dgId=".concat(H,"&_startAt=0&_pageSize=50"),filter:ed?void 0:e=>1===e.activeStatus,name:"dtId",label:W.documentType,readOnly:ed,valueField:"recordId",displayField:"name",values:null==el?void 0:el.values,onChange:async(e,l)=>{el.setFieldValue("dtId",(null==l?void 0:l.recordId)||null),X(l),(null==l?void 0:l.recordId)||el.setFieldValue("productionLineId",null)},error:el.touched.dtId&&!!el.errors.dtId,maxAccess:Q})}),(0,r.jsx)(d.ZP,{item:!0,xs:12,children:(0,r.jsx)(m.Z,{name:"reference",label:W.reference,value:null==el?void 0:null===(l=el.values)||void 0===l?void 0:l.reference,readOnly:ed,maxAccess:!ed&&Q,onChange:el.handleChange,onClear:()=>el.setFieldValue("reference",""),error:el.touched.reference&&!!el.errors.reference})}),(0,r.jsx)(d.ZP,{item:!0,xs:12,children:(0,r.jsx)(P.U,{endpointId:C.u.MFJobOrder.snapshot,valueField:"reference",displayField:"reference",secondDisplayField:!1,name:"jobId",label:W.jobOrder,form:el,valueShow:"jobRef",maxAccess:Q,editMode:ed,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"itemName",value:"Item Name"}],readOnly:en||er,onChange:(e,l)=>{el.setFieldValue("jobId",(null==l?void 0:l.recordId)||null),el.setFieldValue("jobRef",(null==l?void 0:l.reference)||"")},errorCheck:"jobId"})}),(0,r.jsx)(d.ZP,{item:!0,xs:12,children:(0,r.jsx)(P.U,{endpointId:Z.z.ThreeDDrawing.snapshot3DD2,parameters:{_productionLineId:el.values.productionLineId||0},valueField:"reference",displayField:"reference",secondDisplayField:!1,name:"threeDDId",label:W.threeDD,form:el,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"date",value:"Date",type:"date"},{key:"designerRef",value:"Designer"}],valueShow:"threeDDRef",maxAccess:Q,readOnly:en||er,required:!0,onChange:async(e,l)=>{if(el.setFieldValue("threeDDRef",(null==l?void 0:l.reference)||""),el.setFieldValue("fileReference",(null==l?void 0:l.fileReference)||""),el.setFieldValue("designerName",(null==l?void 0:l.designerName)||""),el.setFieldValue("designerId",(null==l?void 0:l.designerId)||""),el.setFieldValue("productionClassId",(null==l?void 0:l.productionClassId)||null),el.setFieldValue("productionStandardId",(null==l?void 0:l.productionStandardId)||null),el.setFieldValue("productionStandardRef",(null==l?void 0:l.productionStandardRef)||""),el.setFieldValue("metalRef",(null==l?void 0:l.metalRef)||""),el.setFieldValue("metalId",(null==l?void 0:l.metalId)||null),el.setFieldValue("collectionName",(null==l?void 0:l.collectionName)||""),el.setFieldValue("collectionId",(null==l?void 0:l.collectionId)||null),el.setFieldValue("itemGroupName",(null==l?void 0:l.itemGroupName)||""),el.setFieldValue("itemGroupId",(null==l?void 0:l.itemGroupId)||null),null==l?void 0:l.recordId){var n,r;let e=await eu(null==l?void 0:l.recordId);el.setFieldValue("designFamilyId",(null==e?void 0:null===(n=e.record)||void 0===n?void 0:n.designFamilyId)||null),el.setFieldValue("designGroupId",(null==e?void 0:null===(r=e.record)||void 0===r?void 0:r.designGroupId)||null)}el.setFieldValue("threeDDId",(null==l?void 0:l.recordId)||null)},errorCheck:"threeDDId"})}),(0,r.jsx)(d.ZP,{item:!0,xs:12,children:(0,r.jsx)(g.Z,{endpointId:C.u.DesignFamily.qry,name:"designFamilyId",label:W.familyGroup,valueField:"recordId",displayField:"name",values:el.values,readOnly:!0,onChange:(e,l)=>el.setFieldValue("designFamilyId",(null==l?void 0:l.recordId)||null),error:(null==el?void 0:null===(n=el.touched)||void 0===n?void 0:n.designFamilyId)&&!!(null==el?void 0:null===(A=el.errors)||void 0===A?void 0:A.designFamilyId),maxAccess:Q})}),(0,r.jsx)(d.ZP,{item:!0,xs:12,children:(0,r.jsx)(g.Z,{endpointId:C.u.DesignGroup.qry,name:"designGroupId",label:W.designGroup,valueField:"recordId",displayField:"name",values:el.values,readOnly:!0,onChange:(e,l)=>el.setFieldValue("designGroupId",(null==l?void 0:l.recordId)||null),error:(null==el?void 0:null===(L=el.touched)||void 0===L?void 0:L.designGroupId)&&!!(null==el?void 0:null===(_=el.errors)||void 0===_?void 0:_.designGroupId),maxAccess:Q})}),(0,r.jsx)(d.ZP,{item:!0,xs:12,children:(0,r.jsx)(y.Z,{name:"date",required:!0,label:W.date,readOnly:en||er,value:null==el?void 0:null===(G=el.values)||void 0===G?void 0:G.date,onChange:el.setFieldValue,maxAccess:Q,onClear:()=>el.setFieldValue("date",""),error:el.touched.date&&!!el.errors.date})}),(0,r.jsx)(d.ZP,{item:!0,xs:12,children:(0,r.jsx)(O.Z,{name:"startDate",label:W.startDate,value:null===(T=el.values)||void 0===T?void 0:T.startDate,readOnly:!0})}),(0,r.jsx)(d.ZP,{item:!0,xs:12,children:(0,r.jsx)(O.Z,{name:"endDate",label:W.endDate,value:null===(q=el.values)||void 0===q?void 0:q.endDate,readOnly:!0})}),(0,r.jsx)(d.ZP,{item:!0,xs:12,children:(0,r.jsx)(g.Z,{endpointId:C.u.Machine.qry,name:"machineId",label:W.machine,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:el.values,onChange:(e,l)=>{el.setFieldValue("machineId",(null==l?void 0:l.recordId)||null)},required:!0,readOnly:en||er,error:el.touched.machineId&&!!el.errors.machineId,maxAccess:Q})}),(0,r.jsx)(d.ZP,{item:!0,xs:12,children:(0,r.jsx)(g.Z,{endpointId:C.u.ProductionLine.qry,parameters:"_startAt=0&_pageSize=1000",values:el.values,name:"productionLineId",label:W.productionLine,valueField:"recordId",displayField:["reference","name"],displayFieldWidth:1,maxAccess:Q,readOnly:!0,error:el.touched.productionLineId&&el.errors.productionLineId})}),(0,r.jsx)(d.ZP,{item:!0,xs:12,children:(0,r.jsx)(g.Z,{endpointId:C.u.ProductionClass.qry,values:el.values,name:"productionClassId",label:W.productionClass,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],maxAccess:Q,readOnly:en||er,onChange:(e,l)=>{el.setFieldValue("productionClassId",(null==l?void 0:l.recordId)||null)},error:el.touched.productionClassId&&!!el.errors.productionClassId})}),(0,r.jsx)(d.ZP,{item:!0,xs:12,children:(0,r.jsx)(w.Z,{name:"nbOfLayers",label:W.nbOfLayers,value:el.values.nbOfLayers,maxAccess:Q,maxLength:4,decimalScale:0,readOnly:en,onChange:el.handleChange,onClear:()=>el.setFieldValue("nbOfLayers",""),error:el.touched.nbOfLayers&&!!el.errors.nbOfLayers})}),(0,r.jsx)(d.ZP,{item:!0,xs:12,children:(0,r.jsx)(w.Z,{name:"density",label:W.density,value:el.values.density,maxAccess:Q,readOnly:en,maxLength:9,decimalScale:3,onChange:el.handleChange,onClear:()=>el.setFieldValue("density",null),error:el.touched.density&&!!el.errors.density})}),(0,r.jsx)(d.ZP,{item:!0,xs:12,children:(0,r.jsx)(w.Z,{name:"setPcs",label:W.pieces,value:el.values.setPcs,maxAccess:Q,readOnly:en,maxLength:4,decimalScale:0,onChange:el.handleChange,onClear:()=>el.setFieldValue("setPcs",null),error:el.touched.setPcs&&!!el.errors.setPcs})}),(0,r.jsx)(d.ZP,{item:!0,xs:12,children:(0,r.jsx)(w.Z,{name:"weight",label:W.weight,value:el.values.weight,maxAccess:Q,readOnly:en,onChange:el.handleChange,maxLength:8,decimalScale:2,onClear:()=>el.setFieldValue("weight",null),error:el.touched.weight&&!!el.errors.weight})})]})}),(0,r.jsx)(d.ZP,{item:!0,xs:6,children:(0,r.jsxs)(d.ZP,{container:!0,spacing:2,children:[(0,r.jsx)(d.ZP,{item:!0,xs:12,children:(0,r.jsx)(o.Z,{ref:U,resourceId:v.i.Printing,seqNo:0,recordId:z,height:250})}),(0,r.jsx)(d.ZP,{item:!0,xs:12,children:(0,r.jsx)(m.Z,{name:"fileReference",label:W.threeDDFile,value:el.values.fileReference,maxAccess:Q,onChange:el.handleChange,readOnly:en,onClear:()=>el.setFieldValue("fileReference",""),error:el.touched.fileReference&&!!el.errors.fileReference})}),(0,r.jsx)(d.ZP,{item:!0,xs:12,children:(0,r.jsx)(m.Z,{name:"designerName",label:W.designer,value:el.values.designerName,maxAccess:Q,readOnly:!0,error:el.touched.designerName&&!!el.errors.designerName})}),(0,r.jsx)(d.ZP,{item:!0,xs:12,children:(0,r.jsx)(m.Z,{name:"productionStandardRef",label:W.productionStandard,value:el.values.productionStandardRef,maxAccess:Q,readOnly:!0,error:el.touched.productionStandardRef&&!!el.errors.productionStandardRef})}),(0,r.jsx)(d.ZP,{item:!0,xs:12,children:(0,r.jsx)(m.Z,{name:"metalRef",label:W.purity,value:el.values.metalRef,maxAccess:Q,readOnly:!0,error:el.touched.metalRef&&!!el.errors.metalRef})}),(0,r.jsx)(d.ZP,{item:!0,xs:12,children:(0,r.jsx)(m.Z,{name:"collectionName",label:W.collection,value:el.values.collectionName,maxAccess:Q,readOnly:!0,error:el.touched.collectionName&&!!el.errors.collectionName})}),(0,r.jsx)(d.ZP,{item:!0,xs:12,children:(0,r.jsx)(m.Z,{name:"itemGroupName",label:W.itemGroup,value:el.values.itemGroupName,maxAccess:Q,readOnly:!0,error:el.touched.itemGroupName&&!!el.errors.itemGroupName})}),(0,r.jsx)(d.ZP,{item:!0,xs:12,children:(0,r.jsx)(D.Z,{name:"notes",type:"text",label:W.notes,value:el.values.notes,readOnly:en,rows:3,maxAccess:Q,onChange:e=>el.setFieldValue("notes",e.target.value||null),onClear:()=>el.setFieldValue("notes",""),error:el.touched.notes&&!!el.errors.notes})})]})})]})})})})}A.width=750,A.height=650}}]);