"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[99090],{99090:function(e,l,a){var r=a(52322),t=a(60218),d=a(2784),n=a(48601),o=a(82737),u=a(65950),s=a(71987),i=a(26612),c=a(5088),m=a(80983),v=a(19473),x=a(31389),h=a(62362),y=a(89330),p=a(8661),I=a(7121),A=a(84100),f=a(98345),F=a(39812),C=a(88469),R=a(62202),w=a(27423),Z=a(38449),V=a(91406),_=a(84141),j=a(61802),N=a(53621),g=a(24074),q=a(75991),O=a(19689),S=a(50023),P=a(21326);let b=e=>{var l,a,b,k,M,T,E,L,B,D,J,U,H,G,Q,W;let{recordId:Y,plantId:z,dtId:X,isOpenOutwards:$=!1,refetch:K,window:ee}=e,{getRequest:el,postRequest:ea}=(0,d.useContext)(u.$),{platformLabels:er,defaultsData:et}=(0,d.useContext)(v.l),{stack:ed}=(0,j.zY)(),{labels:en,access:eo}=(0,S.Z)({datasetId:i.i.OutwardsReturn});(0,P.Z)({title:en.outwardsReturn,window:ee});let{maxAccess:eu}=(0,f.H)({functionId:I.J.OutwardsReturn,access:eo,hasDT:!1}),es=(0,s.E)({endpointId:C.N.OutwardsReturn.page});async function ei(e){return await el({extension:C.N.OutwardsReturn.get,parameters:"_recordId=".concat(e)})}async function ec(e){return await el({extension:C.N.OutwardsTransfer.get,parameters:"_recordId=".concat(e)})}let{formik:em}=(0,m.c)({initialValues:{recordId:Y||null,dtId:X||null,reference:"",owt_Id:null,owt_reference:"",owt_rateCalcMethod:null,owt_exRate:null,ad_exRate:null,ad_rateCalcMethod:null,exRateChangeStatus:null,requestedBy:null,date:new Date,currencyId:null,corId:null,clientId:null,cashAccountId:null,wip:1,status:1,corReplyStatus:null,plantName:null,plantRef:null,currencyName:null,currencyRef:null,corName:null,corRef:null,plantId:parseInt(z),cashAccountName:null,cashAccountRef:null,fcAmount:"",productId:"",productName:"",dispersalType:null,dispersalName:null,corCurrencyId:null,corRateCalcMethod:null,corExRate:null,commission:null,vatAmount:null,reasonId:null,tdAmount:null,amount:null,exRate:null,rateCalcMethod:null,lcAmount:"",releaseStatus:null,otpVerified:!1,settlementStatus:null,interfaceId:null,attemptNo:1},maxAccess:eu,validateOnChange:!0,validationSchema:n.Ry({date:n.Z_().required(),owt_Id:n.Rx().required(),owt_reference:n.Z_().required(),requestedBy:n.Z_().required(),currencyId:n.Z_().required(),clientId:n.Rx().required(),corId:n.Rx().required(),fcAmount:n.Z_().required(),dispersalName:n.Z_().required(),vatAmount:n.Z_().required(),settlementStatus:n.Rx().required(),reasonId:n.Rx().required(),lcAmount:n.Z_().required().test(function(e){let{amount:l}=this.parent;return parseFloat(e)<=parseFloat(l||0)}),exRate:n.Z_().required(),commission:n.Z_().required(),amount:n.Z_().required()}),onSubmit:async e=>{let l={...e};l.date=(0,F.ku)(l.date);let a=await ea({extension:C.N.OutwardsReturn.set,record:JSON.stringify(l)});if(a.recordId){var r;R.ZP.success(er.Added);let e=await ei(a.recordId);em.setValues({...e.record,cellPhone:e.record.cellPhone,date:(0,F.a1)(e.record.date)}),Y||(r=a.recordId,ed({Component:_.Z,props:{values:em.values,recordId:r,functionId:I.J.OutwardsReturn}})),$&&K(),eF(a.recordId)}else R.ZP.success(er.Edited);es()}});async function ev(){var e,l;let a=null==et?void 0:null===(l=et.list)||void 0===l?void 0:null===(e=l.find(e=>{let{key:l}=e;return"baseCurrencyId"===l}))||void 0===e?void 0:e.value;return a&&await em.setFieldValue("raCurrencyId",a),a}let ex=(e,l,a)=>1===a?e*l:e/l,eh=!!em.values.recordId,ey=2===em.values.wip,ep=async e=>{var l;let a=await ea({extension:C.N.OutwardsReturn.close,record:JSON.stringify({recordId:null!==(l=em.values.recordId)&&void 0!==l?l:e})});a.recordId&&(R.ZP.success(er.Closed),es(),eF(a.recordId))},eI=async()=>{let e={...em.values};e.date=(0,F.ku)(e.date);let l=await ea({extension:C.N.OutwardsReturn.reopen,record:JSON.stringify(e)});l.recordId&&(R.ZP.success(er.Reopened),es(),eF(l.recordId))},eA=3===em.values.status,ef=[{key:"Close",condition:!ey,onClick:ep,disabled:ey||!eh},{key:"Reopen",condition:ey,onClick:eI,disabled:!ey||eA},{key:"Locked",condition:!0,onClick:async()=>{let e={...em.values};e.date=(0,F.ku)(e.date);let l=await ea({extension:C.N.OutwardsReturn.post,record:JSON.stringify(e)});l.recordId&&(R.ZP.success(er.Posted),es(),eF(l.recordId))},disabled:eA||!eh||!ey},{key:"Approval",condition:!0,onClick:"onApproval",disabled:!ey}],eF=async e=>{var l,a,r,t,d,n,o,u;let s=await ev(),i=await ei(e),c=await ec(null==i?void 0:null===(l=i.record)||void 0===l?void 0:l.owt_Id);if(s){let e=await eC(i.record.plantId,null===(a=i.record)||void 0===a?void 0:a.currencyId,null==c?void 0:null===(r=c.record)||void 0===r?void 0:r.rateTypeId,s),l=parseFloat(null==e?void 0:e.rate);if(isNaN(l))return;let m=parseFloat((null==c?void 0:null===(t=c.record)||void 0===t?void 0:t.fcAmount)||0);parseFloat((null==c?void 0:null===(d=c.record)||void 0===d?void 0:d.lcAmount)||0);let v=ex(m,l,parseInt(null==c?void 0:null===(n=c.record)||void 0===n?void 0:n.rateCalcMethod,10));em.setValues({...i.record,amount:null==c?void 0:null===(o=c.record)||void 0===o?void 0:o.amount,owt_lcAmount:null==c?void 0:null===(u=c.record)||void 0===u?void 0:u.lcAmount,derivedLcAmount:v,date:(0,F.a1)(i.record.date)})}};async function eC(e,l,a,r){if(e&&l&&a&&r)return(await el({extension:g.u.ExchangeMap.get,parameters:"_plantId=".concat(e,"&_currencyId=").concat(l,"&_rateTypeId=").concat(a,"&_raCurrencyId=").concat(r)})).record}(0,d.useEffect)(()=>{!async function(){Y&&eF(Y)}()},[]),(0,d.useEffect)(()=>{!async function(){(Y||eh)&&await ev()}()},[Y,eh]);let eR=(e,l)=>{e===l&&em.setFieldValue("exRateChangeStatus","1"),e<l&&em.setFieldValue("exRateChangeStatus","3"),e>l&&em.setFieldValue("exRateChangeStatus","2")};return(0,r.jsx)(o.Z,{resourceId:i.i.OutwardsReturn,form:em,maxAccess:eu,actions:ef,editMode:eh,functionId:I.J.OutwardsReturn,previewReport:eh,disabledSubmit:!$&&(eA||ey),children:(0,r.jsx)(x.R,{children:(0,r.jsx)(h.Q,{children:(0,r.jsx)(t.ZP,{container:!0,spacing:2,sx:{pt:5,display:"flex"},children:(0,r.jsxs)(t.ZP,{container:!0,item:!0,xs:12,spacing:2,sx:{display:"flex",flexDirection:"row"},children:[(0,r.jsx)(t.ZP,{item:!0,xs:6,children:(0,r.jsxs)(q.Z,{title:"Outwards Transfer",children:[(0,r.jsx)(t.ZP,{item:!0,xs:6,children:(0,r.jsx)(c.Z,{name:"reference",label:en.reference,value:null==em?void 0:null===(l=em.values)||void 0===l?void 0:l.reference,maxAccess:!eh&&eu,maxLength:"30",readOnly:eh||eA||ey,onChange:em.handleChange,error:em.touched.reference&&!!em.errors.reference})}),(0,r.jsx)(t.ZP,{item:!0,xs:6,children:(0,r.jsx)(y.Z,{name:"date",label:en.date,value:null===(a=em.values)||void 0===a?void 0:a.date,required:!0,readOnly:eA||ey||$,onChange:em.setFieldValue,onClear:()=>em.setFieldValue("date",""),error:em.touched.date&&!!em.errors.date,maxAccess:eu})}),(0,r.jsx)(t.ZP,{item:!0,xs:6,children:(0,r.jsx)(w.U,{endpointId:C.N.OutwardsTransfer.snapshot,valueField:"reference",displayField:"reference",name:"owt_reference",secondDisplayField:!1,required:!0,label:en.outwards,form:em,readOnly:eA||ey||$,columnsInDropDown:[{key:"reference",value:"Ref."},{key:"amount",value:"Amount"},{key:"commission",value:"Commission"},{key:"corName",value:"Correspondent"},{key:"clientName",value:"Client Name"},{key:"currencyRef",value:"Currency Ref."}],displayFieldWidth:4,onChange:async(e,l)=>{var a,r;em.setFieldValue("owt_Id",l?l.recordId:""),em.setFieldValue("owt_reference",l?l.reference:""),em.setFieldValue("owt_exRate",l?l.exRate:""),em.setFieldValue("owt_rateCalcMethod",l?l.rateCalcMethod:""),em.setFieldValue("owt_lcAmount",l?l.lcAmount:""),em.setFieldValue("clientId",l?l.clientId:""),em.setFieldValue("clientName",l?l.clientName:""),em.setFieldValue("clientRef",l?l.clientRef:""),em.setFieldValue("currencyId",l?l.currencyId:""),em.setFieldValue("currencyName",l?l.currencyName:""),em.setFieldValue("currencyRef",l?l.currencyRef:""),em.setFieldValue("fcAmount",l?l.fcAmount:""),em.setFieldValue("corId",l?l.corId:""),em.setFieldValue("corName",l?l.corName:""),em.setFieldValue("corRef",l?l.corRef:""),em.setFieldValue("corReplyStatus",l?l.corReplyStatus:""),em.setFieldValue("cashAccountId",l?l.cashAccountId:""),em.setFieldValue("cashAccountName",l?l.cashAccountName:""),em.setFieldValue("cashAccountRef",l?l.cashAccountRef:""),em.setFieldValue("dispersalType",l?l.dispersalType:""),em.setFieldValue("dispersalName",l?l.dispersalName:""),em.setFieldValue("corRateCalcMethod",l?l.corRateCalcMethod:""),em.setFieldValue("corExRate",l?l.corExRate:""),em.setFieldValue("commission",l?l.commission:""),em.setFieldValue("vatAmount",l?l.vatAmount:""),em.setFieldValue("tdAmount",l?l.tdAmount:""),em.setFieldValue("amount",l?l.amount:""),em.setFieldValue("releaseStatus",l?l.releaseStatus:""),em.setFieldValue("corCurrencyId",l?l.corCurrencyId:""),em.setFieldValue("productId",l?l.productId:""),em.setFieldValue("productName",l?l.productName:""),em.setFieldValue("rateTypeId",l?l.rateTypeId:""),em.setFieldValue("owt_Id",(null==l?void 0:l.recordId)||"");let t=await ev(),[d,n]=await Promise.all([(null==l?void 0:l.corId)?el({extension:N.d.Correspondent.get,parameters:"_recordId=".concat(null==l?void 0:l.corId)}):Promise.resolve({record:{}}),eC(null===(a=em.values)||void 0===a?void 0:a.plantId,null==l?void 0:l.currencyId,null==l?void 0:l.rateTypeId,t)]);em.setFieldValue("interfaceId",null==d?void 0:null===(r=d.record)||void 0===r?void 0:r.interfaceId);let o=parseFloat((null==l?void 0:l.fcAmount)||0),u=parseFloat((null==l?void 0:l.lcAmount)||0),s=parseInt(null==l?void 0:l.rateCalcMethod,10),i=ex(o,null==n?void 0:n.rate,s);em.values.originalLcAmount||em.setFieldValue("originalLcAmount",Math.min(u,i)),em.setFieldValue("derivedLcAmount",i),em.setFieldValue("exRate",Math.min(parseFloat((null==l?void 0:l.exRate)||0),(null==n?void 0:n.rate)||0)),em.setFieldValue("rateCalcMethod",Math.min(parseInt(null==l?void 0:l.rateCalcMethod,10)||0,s)),em.setFieldValue("ad_exRate",null==n?void 0:n.rate),em.setFieldValue("ad_rateCalcMethod",null==n?void 0:n.rateCalcMethod)},error:em.touched.owt_reference&&!!em.errors.owt_reference,maxAccess:eu})}),(0,r.jsx)(t.ZP,{item:!0,xs:6,children:(0,r.jsx)(p.Z,{endpointId:Z.r.Currency.qry,name:"currencyId",label:en.currency,valueField:"recordId",displayField:["reference","name"],maxAccess:eu,values:em.values,error:em.touched.currencyId&&!!em.errors.currencyId,readOnly:eh})}),(0,r.jsx)(t.ZP,{item:!0,xs:6,children:(0,r.jsx)(V.Z,{name:"fcAmount",label:en.fcAmount,value:null==em?void 0:null===(b=em.values)||void 0===b?void 0:b.fcAmount,required:!0,readOnly:!0,maxAccess:eu,onChange:em.handleChange,onClear:()=>em.setFieldValue("fcAmount",""),error:em.touched.fcAmount&&!!em.errors.fcAmount})}),(0,r.jsx)(t.ZP,{item:!0,xs:6,children:(0,r.jsx)(V.Z,{name:"owt_lcAmount",label:en.lcAmount,value:null==em?void 0:null===(k=em.values)||void 0===k?void 0:k.owt_lcAmount,required:!0,readOnly:!0,maxAccess:eu,onChange:em.handleChange,onClear:()=>em.setFieldValue("owt_lcAmount",""),error:em.touched.owt_lcAmount&&!!em.errors.owt_lcAmount})}),(0,r.jsx)(t.ZP,{item:!0,xs:6,children:(0,r.jsx)(c.Z,{name:"dispersalName",label:en.dispersalName,value:null==em?void 0:null===(M=em.values)||void 0===M?void 0:M.dispersalName,onChange:em.handleChange,error:em.touched.dispersalName&&!!em.errors.dispersalName,maxAccess:eu,readOnly:!0,required:!0})}),(0,r.jsx)(t.ZP,{item:!0,xs:6,children:(0,r.jsx)(w.U,{readOnly:!0,valueField:"reference",displayField:"name",name:"clientId",label:en.client,form:em,required:!0,displayFieldWidth:2,valueShow:"clientRef",secondValueShow:"clientName",maxAccess:eu,error:em.touched.clientId&&!!em.errors.clientId})}),(0,r.jsx)(t.ZP,{item:!0,xs:6,children:(0,r.jsx)(V.Z,{name:"owt_exRate",label:en.exRate,value:null==em?void 0:null===(T=em.values)||void 0===T?void 0:T.owt_exRate,required:!0,readOnly:!0,maxAccess:eu})}),(0,r.jsx)(t.ZP,{item:!0,xs:6,children:(0,r.jsx)(c.Z,{name:"productName",label:en.product,value:null==em?void 0:null===(E=em.values)||void 0===E?void 0:E.productName,onChange:em.handleChange,error:em.touched.productName&&!!em.errors.productName,maxAccess:eu,readOnly:!0})}),(0,r.jsx)(t.ZP,{item:!0,xs:6,children:(0,r.jsx)(V.Z,{name:"commission",label:en.commission,value:null==em?void 0:null===(L=em.values)||void 0===L?void 0:L.commission,required:!0,readOnly:!0,maxAccess:eu,error:em.touched.commission&&!!em.errors.commission})}),(0,r.jsx)(t.ZP,{item:!0,xs:6,children:(0,r.jsx)(V.Z,{name:"vatAmount",label:en.vatAmount,value:null==em?void 0:null===(B=em.values)||void 0===B?void 0:B.vatAmount,readOnly:!0,required:!0,maxAccess:eu,onChange:em.handleChange,onClear:()=>em.setFieldValue("vatAmount",""),error:em.touched.vatAmount&&!!em.errors.vatAmount})}),(0,r.jsx)(t.ZP,{item:!0,xs:12,children:(0,r.jsx)(w.U,{valueField:"reference",displayField:"name",name:"corId",label:en.correspondent,form:em,required:!0,valueShow:"corRef",secondValueShow:"corName",readOnly:!0,maxAccess:eu,error:em.touched.corId&&!!em.errors.corId})}),(0,r.jsx)(t.ZP,{item:!0,xs:6,children:(0,r.jsx)(V.Z,{name:"tdAmount",label:en.tdAmount,value:null==em?void 0:null===(D=em.values)||void 0===D?void 0:D.tdAmount,readOnly:!0,maxAccess:eu,onChange:em.handleChange,onClear:()=>em.setFieldValue("tdAmount",""),error:em.touched.tdAmount&&!!em.errors.tdAmount})}),(0,r.jsx)(t.ZP,{item:!0,xs:6,children:(0,r.jsx)(O.Z,{name:"otpVerified",value:null===(J=em.values)||void 0===J?void 0:J.otpVerified,onChange:e=>em.setFieldValue("otpVerified",e.target.checked),label:en.otpVerified,disabled:!0,maxAccess:eo})}),(0,r.jsx)(t.ZP,{item:!0,xs:6,children:(0,r.jsx)(V.Z,{name:"amount",label:en.amount,value:null==em?void 0:null===(U=em.values)||void 0===U?void 0:U.amount,required:!0,readOnly:!0,maxAccess:eu,onChange:em.handleChange,onClear:()=>em.setFieldValue("amount",""),error:em.touched.amount&&!!em.errors.amount})})]})}),(0,r.jsxs)(t.ZP,{item:!0,xs:6,children:[(0,r.jsxs)(q.Z,{title:"Calculated",children:[(0,r.jsx)(t.ZP,{item:!0,xs:12,children:(0,r.jsx)(p.Z,{datasetId:A.v.REQUESTED_BY,name:"requestedBy",label:en.requestedBy,valueField:"key",displayField:"value",values:em.values,required:!0,readOnly:eA||ey||$,maxAccess:eu,onChange:(e,l)=>{em.setFieldValue("requestedBy",null==l?void 0:l.key)},error:em.touched.requestedBy&&!!em.errors.requestedBy})}),(0,r.jsx)(t.ZP,{item:!0,xs:12,children:(0,r.jsx)(p.Z,{endpointId:C.N.OutwardReturnReason.qry,name:"reasonId",label:en.returnReason,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],filter:e=>{let l=em.values.requestedBy;return"1"===l?e.company:"2"===l?e.correspondant:"3"!==l||e.client},values:em.values,onChange:(e,l)=>{var a,r,t,d,n;if(em.setFieldValue("reasonId",l?null==l?void 0:l.recordId:""),(null==l?void 0:l.rateStatus)=="1")em.setFieldValue("lcAmount",em.values.amount),eR(null==em?void 0:null===(a=em.values)||void 0===a?void 0:a.amount,null==em?void 0:null===(r=em.values)||void 0===r?void 0:r.amount);else if((null==l?void 0:l.rateStatus)=="2")em.setFieldValue("lcAmount",em.values.derivedLcAmount),eR(null==em?void 0:null===(t=em.values)||void 0===t?void 0:t.amount,null==em?void 0:null===(d=em.values)||void 0===d?void 0:d.derivedLcAmount);else if((null==l?void 0:l.rateStatus)=="3"){let e=em.values.originalLcAmount;em.setFieldValue("lcAmount",Math.min(em.values.amount,em.values.derivedLcAmount)),eR(null==em?void 0:null===(n=em.values)||void 0===n?void 0:n.amount,e)}},required:!0,maxAccess:eu,error:em.touched.reasonId&&!!em.errors.reasonId,readOnly:eA||ey||$||!em.values.requestedBy})}),(0,r.jsx)(t.ZP,{item:!0,xs:12,children:(0,r.jsx)(p.Z,{datasetId:A.v.SETTLEMENT_STATUS,name:"settlementStatus",label:en.settlementStatus,valueField:"key",displayField:"value",values:em.values,onChange:(e,l)=>{em.setFieldValue("settlementStatus",null==l?void 0:l.key)},defaultIndex:(null==em?void 0:null===(H=em.values)||void 0===H?void 0:H.interfaceId)&&0,required:!0,readOnly:!Y||$&&!!em.values.interfaceId||!$&&(eA||ey||!!em.values.interfaceId),maxAccess:eu,error:em.touched.settlementStatus&&!!em.errors.settlementStatus})}),(0,r.jsx)(t.ZP,{item:!0,xs:12,children:(0,r.jsx)(V.Z,{name:"ad_exRate",label:en.exRate,value:null==em?void 0:null===(G=em.values)||void 0===G?void 0:G.ad_exRate,required:!0,readOnly:!0,maxAccess:eu,onChange:em.handleChange,onClear:()=>em.setFieldValue("ad_exRate",""),error:em.touched.ad_exRate&&!!em.errors.ad_exRate})}),(0,r.jsx)(t.ZP,{item:!0,xs:12,children:(0,r.jsx)(V.Z,{name:"derivedLcAmount",label:en.amount,value:null==em?void 0:null===(Q=em.values)||void 0===Q?void 0:Q.derivedLcAmount,required:!0,readOnly:!0})})]}),(0,r.jsxs)(q.Z,{title:"Amount",children:[(0,r.jsx)(t.ZP,{item:!0,xs:12,children:(0,r.jsx)(V.Z,{name:"lcAmount",label:en.lcAmount,value:null==em?void 0:null===(W=em.values)||void 0===W?void 0:W.lcAmount,required:!0,readOnly:!0,maxAccess:eu,onChange:em.handleChange,onClear:()=>em.setFieldValue("lcAmount",""),error:em.touched.lcAmount&&!!em.errors.lcAmount})}),(0,r.jsx)(t.ZP,{item:!0,xs:12,children:(0,r.jsx)(p.Z,{datasetId:A.v.EXCHANGE_RATE_CHANGE_STATUS,name:"exRateChangeStatus",label:en.exRateChangeStatus,valueField:"key",displayField:"value",values:em.values,required:!0,readOnly:!0,maxAccess:eu})})]})]})]})})})})})};b.width=1200,b.height=630,l.Z=b}}]);