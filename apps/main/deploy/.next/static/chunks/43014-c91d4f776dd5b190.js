(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[43014],{93736:function(e,l,a){"use strict";a.d(l,{K:function(){return n}});let i="RG.FI.asmx/",n={FiOpeningBalance:{gen:i+"genOBA"},FiAging:{qry:i+"FI404"},AccountSummary:{AccFI405b:i+"FI405b"},DocumentAging:{AgingFI406a:i+"FI406a",AgingFI406b:i+"FI406b"},TrialBalance:{FI402View:i+"FI402o",FI401o2:i+"FI401o2"}}},16463:function(e,l,a){"use strict";a.d(l,{Z:function(){return w}});var i=a(52322),n=a(2784),t=a(49864),d=a(65950),o=a(27423),r=a(26612),s=a(71987),u=a(33625),c=a(62362),v=a(31389),m=a(8661),p=a(25870),I=a(69627),f=a(84100),h=a(19473),x=a(80983),g=a(38449),y=a(69387),b=a(93736),F=a(21326);function w(e){let{accountId:l,moduleId:a,window:w}=e,{getRequest:P}=(0,n.useContext)(d.$),{platformLabels:j}=(0,n.useContext)(h.l),[k,N]=(0,n.useState)([]);(0,F.Z)({title:j.AccountSummary,window:w});let{labels:Z,access:C}=(0,s.J)({datasetId:r.i.AccountSummary}),A=[{field:"days",headerName:Z.days,flex:1,type:"number"}],[D,S]=(0,n.useState)(A),{formik:V}=(0,x.c)({maxAccess:C,initialValues:{accountId:null,accountRef:"",accountName:"",agpId:null,moduleId:a}});async function O(){var e,l,i,n;let t;let d=2,o=[...A],r=await P({extension:g.r.Currency.qry,parameters:"_filter="});if(1==a?t=null==r?void 0:null===(e=r.list)||void 0===e?void 0:e.filter(e=>e.sale):2==a&&(t=null==r?void 0:null===(l=r.list)||void 0===l?void 0:l.filter(e=>e.purchase)),0==t.length)return;null==t||t.forEach((e,l)=>{o.push({field:"column".concat(l+1),headerName:e.reference,flex:1,type:"number"})}),S(o);let s=await P({extension:p.H.AgingLeg.qry,parameters:"_agpId=".concat(V.values.agpId)}),u=null==s?void 0:null===(i=s.list)||void 0===i?void 0:i.map(e=>{let l=Array(t.length+2).fill(0);return l[0]=null,l[1]=e.days,l}),c=(t||[]).map(e=>P({extension:b.K.AccountSummary.AccFI405b,parameters:"_agpId=".concat(V.values.agpId,"&_currencyId=").concat(e.recordId,"&_accountId=").concat(V.values.accountId)}).then(e=>({summaryRes:e})));(await Promise.all(c)).forEach(e=>{var l;let{summaryRes:a}=e;null==a||null===(l=a.list)||void 0===l||l.forEach(e=>{null==u||u.forEach(l=>{l[1]==e.seqDays&&(l[d]=e.amount)})}),d++});let v=Array(t.length+2).fill(null);for(let e=2;e<t.length+2;e++){let l=0;null==u||u.map(a=>{l+=Number(a[e]||0)}),v[e]=l}let m=u.filter(e=>null!==e[1]).map(e=>{let[l,a,...i]=e,n={days:a};return i.forEach((e,l)=>{n["column".concat(l+1)]=e.toFixed(2)}),n}),I={};for(let e=0;e<t.length;e++)I["column".concat(e+1)]=null!==(n=v[e+2].toFixed(2))&&void 0!==n?n:0;m.push(I),N({list:m})}return(0,n.useEffect)(()=>{!async function(){if(l&&a){var e,i,n;let a=await P({extension:p.H.Account.get,parameters:"_recordId=".concat(l)});V.setFieldValue("accountId",null==a?void 0:null===(e=a.record)||void 0===e?void 0:e.recordId),V.setFieldValue("accountRef",null==a?void 0:null===(i=a.record)||void 0===i?void 0:i.reference),V.setFieldValue("accountName",null==a?void 0:null===(n=a.record)||void 0===n?void 0:n.name)}}()},[]),(0,i.jsxs)(v.R,{children:[(0,i.jsx)(u.g,{children:(0,i.jsxs)(t.Z,{container:!0,spacing:2,p:2,children:[(0,i.jsx)(t.Z,{item:!0,xs:12,children:(0,i.jsx)(o.U,{endpointId:p.H.Account.snapshot,name:"accountId",label:Z.account,valueField:"reference",displayField:"name",valueShow:"accountRef",secondValueShow:"accountName",form:V,readOnly:V.values.accountId&&V.values.moduleId,required:!0,maxAccess:C,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],onChange:async(e,l)=>{V.setFieldValue("accountId",(null==l?void 0:l.recordId)||null),V.setFieldValue("accountName",(null==l?void 0:l.name)||""),V.setFieldValue("accountRef",(null==l?void 0:l.reference)||"")}})}),(0,i.jsx)(t.Z,{item:!0,xs:6,children:(0,i.jsx)(m.Z,{endpointId:p.H.AgingProfile.qry,parameters:"_startAt=0&_pageSize=1000&filter=",name:"agpId",label:Z.agingProfile,values:V.values,valueField:"recordId",displayField:"name",maxAccess:C,required:!0,onChange:(e,l)=>{V.setFieldValue("agpId",(null==l?void 0:l.recordId)||null),(null==l?void 0:l.recordId)||N({list:[]})}})}),(0,i.jsx)(t.Z,{item:!0,xs:5,children:(0,i.jsx)(m.Z,{datasetId:f.v.FI_AGING_MODULE,label:Z.module,name:"moduleId",values:V.values,valueField:"key",displayField:"value",maxAccess:C,required:!0,readOnly:V.values.moduleId,onChange:(e,l)=>{V.setFieldValue("moduleId",(null==l?void 0:l.key)||null)}})}),(0,i.jsx)(t.Z,{item:!0,xs:1,children:(0,i.jsx)(I.Z,{onClick:O,image:"preview.png",disabled:!V.values.agpId||!V.values.moduleId||!V.values.accountId,tooltipText:j.Preview})})]})}),(0,i.jsx)(c.Q,{children:(0,i.jsx)(y.Z,{columns:D,gridData:k,isLoading:!1,pagination:!1})})]})}w.width=1e3,w.height=500},43014:function(e,l,a){"use strict";var i=a(52322),n=a(89330),t=a(39812),d=a(60218),o=a(2784),r=a(48601),s=a(82737),u=a(62202),c=a(65950),v=a(26612),m=a(5088),p=a(21581),I=a(8661),f=a(7121),h=a(27423),x=a(62362),g=a(76399),y=a(31389),b=a(33625),F=a(91406),w=a(22341),P=a(80983),j=a(39704),k=a(61802),N=a(19473),Z=a(18996),C=a(98345),A=a(69387),D=a(19568),S=a(81330),V=a(86626),O=a(51235),R=a(96026),_=a(16463);let L=e=>{var l,L,q,T,E,W,J,G,B,H,z,M,U,X,$,K,Q,Y,ee,el,ea,ei,en,et,ed,eo,er,es,eu,ec,ev;let{labels:em,access:ep,recordId:eI,invalidate:ef}=e,{getRequest:eh,postRequest:ex}=(0,o.useContext)(c.$),{stack:eg}=(0,k.zY)(),{stack:ey}=(0,R.V)(),{platformLabels:eb,defaultsData:eF,userDefaultsData:ew,systemChecks:eP}=(0,o.useContext)(N.l),[ej,ek]=(0,o.useState)(!1),eN=(0,o.useRef)(null),{documentType:eZ,maxAccess:eC,changeDT:eA}=(0,C.H)({functionId:f.J.DraftSerialsIn,access:ep,enabled:!eI});(0,o.useEffect)(()=>{(null==eZ?void 0:eZ.dtId)&&e2(eZ.dtId)},[null==eZ?void 0:eZ.dtId]);let eD=parseInt(null==eF?void 0:null===(L=eF.list)||void 0===L?void 0:null===(l=L.find(e=>"currencyId"===e.key))||void 0===l?void 0:l.value),eS=parseInt(null==eF?void 0:null===(T=eF.list)||void 0===T?void 0:null===(q=T.find(e=>"plId"===e.key))||void 0===q?void 0:q.value),eV=parseInt(null==ew?void 0:null===(W=ew.list)||void 0===W?void 0:null===(E=W.find(e=>"spId"===e.key))||void 0===E?void 0:E.value),eO=parseInt(null==ew?void 0:null===(G=ew.list)||void 0===G?void 0:null===(J=G.find(e=>"siteId"===e.key))||void 0===J?void 0:J.value),{formik:eR}=(0,P.c)({maxAccess:eC,documentType:{key:"dtId",value:null==eZ?void 0:eZ.dtId},initialValues:{recordId:eI||"",dtId:null,reference:"",date:new Date,plantId:null,clientId:null,clientRef:"",clientName:"",currencyId:eD||null,spId:eV||null,siteId:eO||null,description:"",status:1,wip:1,isVattable:!1,taxId:null,subtotal:0,amount:0,vatAmount:0,plId:eS||null,ptId:null,weight:0,accountId:null,disSkuLookup:!1,autoSrlNo:!0,search:"",serials:[{id:1,draftId:eI||0,srlNo:"",metalId:"",designId:"",itemId:"",sku:"",itemName:"",seqNo:"",extendedPrice:0,baseLaborPrice:0,weight:0,metalRef:"",designRef:"",vatAmount:0,vatPct:0,unitPrice:0,taxId:null,taxDetails:null,priceType:0,volume:0}],metalGridData:[],itemGridData:[]},validateOnChange:!0,validationSchema:r.Ry({date:r.Z_().required(),currencyId:r.Z_().required(),clientId:r.Z_().required(),spId:r.Z_().required(),siteId:r.Z_().required(),serials:r.IX().of(r.Ry().shape({srlNo:r.Z_().test({name:"srlNo-first-row-check",test(e,l){let{parent:a}=l;return(null==a?void 0:a.id)==1||(!((null==a?void 0:a.id)>1)||!!e)&&e}})}))}),onSubmit:async e=>{let{itemGridData:l,metalGridData:a,search:i,autoSrlNo:n,disSkuLookup:d,serials:o,date:r,...s}=e,c={...s,pcs:o.length,date:(0,t.ku)(r)},v=eR.values.serials.filter(e=>e.srlNo).map((e,l)=>{let{taxDetails:a,recordId:i,...n}=e;return{...n,seqNo:l+1,draftId:i||0}});ex({extension:w.P.DraftInvoice.set2,record:JSON.stringify({header:c,items:v})}).then(async e=>{u.ZP.success(eT?eb.Edited:eb.Added),await eL(e.recordId),ef()})}});async function e_(){var e;if(eN.current)return;let l=await eh({extension:w.P.DraftInvoice.pack,parameters:""}),a=(null==l?void 0:null===(e=l.record)||void 0===e?void 0:e.taxDetails)||[];eN.current=a}async function eL(e){let l=await eH(e);await eK(l)}let eq=null==eP?void 0:null===(B=eP.find(e=>e.checkId===O.F.POS_JUMP_TO_NEXT_LINE))||void 0===B?void 0:B.value,eT=!!eR.values.recordId,eE=2===eR.values.wip,eW=async e=>{var l;if(!(null==e?void 0:e.draftId)||!(null==e?void 0:e.itemId))return!0;let a={draftId:null==eR?void 0:null===(l=eR.values)||void 0===l?void 0:l.recordId,lineItem:e};return await ex({extension:w.P.DraftInvoiceSerial.del,record:JSON.stringify(a)}),!0};async function eJ(e,l){if(null==l?void 0:l.srlNo){l.draftId=e;let a=await ex({extension:w.P.DraftInvoiceSerial.append,record:JSON.stringify({draftId:e,lineItem:l}),noHandleError:!0});return(null==a?void 0:a.error)?(ey({message:null==a?void 0:a.error}),!1):(u.ZP.success(eb.Saved),ef(),!0)}}function eG(e){return e.reduce((e,l)=>{let a=parseFloat(l.unitPrice)||0,i=parseFloat(l.vatAmount)||0,n=parseFloat(l.weight)||0;return e.subtotal+=a,e.vatAmount+=i,e.weight+=n,e.amount+=a+i,e},{subtotal:0,vatAmount:0,weight:0,amount:0})}async function eB(e){let l=[e],a=eG(l),{itemGridData:i,metalGridData:n,search:d,autoSrlNo:o,disSkuLookup:r,date:s,...c}=eR.values,v={header:{...c,pcs:l.length,...a,date:(0,t.ku)(s)},items:[e]},m=await ex({extension:w.P.DraftInvoice.set2,record:JSON.stringify(v)});(null==m?void 0:m.recordId)&&(u.ZP.success(eb.Saved),eL(null==m?void 0:m.recordId))}async function eH(e){var l,a,i,n;if(!e)return null;let d=await eh({extension:w.P.DraftInvoice.get2,parameters:"_recordId=".concat(e)}),o=await eh({extension:w.P.Client.get,parameters:"_recordId=".concat(null==d?void 0:null===(a=d.record)||void 0===a?void 0:null===(l=a.header)||void 0===l?void 0:l.clientId)});return d.record.header.date=(0,t.a1)(null==d?void 0:null===(n=d.record)||void 0===n?void 0:null===(i=n.header)||void 0===i?void 0:i.date),d.record.header.accountId=o.record.accountId,(null==d?void 0:d.record)||{}}let ez=[{component:"textfield",label:em.srlNo,name:"srlNo",flex:1.2,...(null==eR?void 0:null===(H=eR.values)||void 0===H?void 0:H.autoSrlNo)&&{updateOn:"blur"},jumpToNextLine:eq,disableDuplicate:!0,propsReducer(e){let{row:l,props:a}=e;return{...a,readOnly:null==l?void 0:l.srlNo}},async onChange(e){var l,a,i,n,t,d,o,r,s,u,c,v,m,p,I,f,h,x,g,y,b,F,P,j,k,N,C,A,D;let{row:{update:S,newRow:O,oldRow:R,addRow:_}}=e;if(!(null==O?void 0:O.srlNo))return;let L=await eh({extension:w.P.DraftInvoiceSerial.get,parameters:"_currencyId=".concat(null==eR?void 0:null===(l=eR.values)||void 0===l?void 0:l.currencyId,"&_plId=").concat(null==eR?void 0:null===(a=eR.values)||void 0===a?void 0:a.plId,"&_srlNo=").concat(null==O?void 0:O.srlNo,"&_siteId=").concat(null==eR?void 0:null===(i=eR.values)||void 0===i?void 0:i.siteId)});if(null==eR?void 0:null===(n=eR.values)||void 0===n?void 0:n.autoSrlNo){let e={fieldName:"srlNo",changes:{id:O.id,seqNo:O.id,draftId:(null==eR?void 0:null===(t=eR.values)||void 0===t?void 0:t.recordId)||0,srlNo:(null==L?void 0:null===(d=L.record)||void 0===d?void 0:d.srlNo)||"",sku:(null==L?void 0:null===(o=L.record)||void 0===o?void 0:o.sku)||"",itemName:(null==L?void 0:null===(r=L.record)||void 0===r?void 0:r.itemName)||"",weight:(null==L?void 0:null===(s=L.record)||void 0===s?void 0:s.weight)||0,itemId:(null==L?void 0:null===(u=L.record)||void 0===u?void 0:u.itemId)||null,priceType:(null==L?void 0:null===(c=L.record)||void 0===c?void 0:c.priceType)||0,metalId:(null==L?void 0:null===(v=L.record)||void 0===v?void 0:v.metalId)||null,metalRef:(null==L?void 0:null===(m=L.record)||void 0===m?void 0:m.metalRef)||"",designId:(null==L?void 0:null===(p=L.record)||void 0===p?void 0:p.designId)||null,designRef:(null==L?void 0:null===(I=L.record)||void 0===I?void 0:I.designRef)||null,categoryName:null==L?void 0:null===(f=L.record)||void 0===f?void 0:f.categoryName,volume:(null==L?void 0:null===(h=L.record)||void 0===h?void 0:h.volume)||0,baseLaborPrice:(null==L?void 0:null===(x=L.record)||void 0===x?void 0:x.baseLaborPrice)||0,unitPrice:parseFloat(null==L?void 0:null===(g=L.record)||void 0===g?void 0:g.unitPrice).toFixed(2)||0,vatPct:(null==L?void 0:null===(y=L.record)||void 0===y?void 0:y.vatPct)||0,vatAmount:parseFloat(null==L?void 0:null===(b=L.record)||void 0===b?void 0:b.vatAmount).toFixed(2)||0,...(null==L?void 0:null===(F=L.record)||void 0===F?void 0:F.taxId)&&{taxId:(null===(P=eR.values)||void 0===P?void 0:P.taxId)||(null==L?void 0:null===(j=L.record)||void 0===j?void 0:j.taxId),taxDetails:await eQ((null===(k=eR.values)||void 0===k?void 0:k.taxId)||(null==L?void 0:null===(N=L.record)||void 0===N?void 0:N.taxId))}}},{unitPrice:l,baseLaborPrice:a}=function(e,l){ej||ek(!0);let a=(0,V.Ch)({priceType:3,basePrice:0,volume:parseFloat((null==e?void 0:e.volume)||0),weight:1,unitPrice:parseFloat(null==e?void 0:e.baseLaborPrice),upo:0,qty:parseFloat(null==e?void 0:e.weight),extendedPrice:parseFloat(null==e?void 0:e.unitPrice).toFixed(2),mdAmount:0,mdType:0,baseLaborPrice:0,totalWeightPerG:0,mdValue:0,tdPct:0,dirtyField:l}),i=(0,Z.VW)({priceType:null==a?void 0:a.priceType,basePrice:0,qty:parseFloat(null==e?void 0:e.weight),weight:parseFloat(null==e?void 0:e.weight),extendedPrice:parseFloat(null==a?void 0:a.extendedPrice),tdPct:0,baseLaborPrice:0,taxDetails:parseFloat(null==e?void 0:e.taxDetails)});return{unitPrice:parseFloat(null==a?void 0:a.extendedPrice).toFixed(2),baseLaborPrice:parseFloat(null==a?void 0:a.unitPrice).toFixed(2),vatAmount:parseFloat(null==i?void 0:i.vatAmount).toFixed(2)}}(e.changes,V.Xf);e.changes.unitPrice=l,e.changes.baseLaborPrice=a,null!=e.changes.taxId&&(e.changes.extendedPrice=l,e.changes.taxDetails=await eQ(e.changes.taxId)),ej||ek(!0),((null==eR?void 0:null===(C=eR.values)||void 0===C?void 0:C.recordId)?await eJ(null==eR?void 0:null===(A=eR.values)||void 0===A?void 0:A.recordId,e.changes):await eB(e.changes))?await _(e):S({...null==eR?void 0:null===(D=eR.initialValues)||void 0===D?void 0:D.serials,id:null==O?void 0:O.id,srlNo:""})}}},{component:"numberfield",label:em.weight,name:"weight",props:{readOnly:!0}},{component:"textfield",label:em.sku,name:"sku",props:{readOnly:!0}},{component:"textfield",label:em.itemName,name:"itemName",flex:2,props:{readOnly:!0}},{component:"textfield",label:em.metalRef,name:"metalRef",flex:.6,props:{readOnly:!0}},{component:"numberfield",label:em.vatAmount,name:"vatAmount",props:{readOnly:!0}},{component:"button",name:"taxDetailsButton",flex:.75,props:{onCondition:e=>e.itemId&&e.taxId?{imgSrc:a(54022).default.src,hidden:!1}:{imgSrc:"",hidden:!0}},label:em.tax,onClick:(e,l)=>{l.qty=l.weight,l.basePrice=0,eg({Component:D.Z,props:{taxId:null==l?void 0:l.taxId,obj:l}})}},{component:"numberfield",label:em.baseLaborPrice,name:"baseLaborPrice",updateOn:"blur",props:{decimalScale:2,readOnly:!0}},{component:"numberfield",label:em.unitPrice,name:"unitPrice",props:{readOnly:!0}}];async function eM(){let{serials:e,...l}=eR.values;await ex({extension:w.P.DraftInvoice.reopen,record:JSON.stringify({...l,date:(0,t.ku)(eR.values.date)})}).then(()=>{var e;u.ZP.success(eb.Reopened),ef(),eL(null==eR?void 0:null===(e=eR.values)||void 0===e?void 0:e.recordId)})}async function eU(){eg({Component:j.Z,props:{functionId:f.J.DraftSerialsIn,recordId:eR.values.recordId}})}async function eX(){var e;eg({Component:S.Z,props:{endPoint:w.P.DraftInvoiceSerial.batch,header:{draftId:null==eR?void 0:null===(e=eR.values)||void 0===e?void 0:e.recordId},onCloseimport:async()=>{await eL(eR.values.recordId)},maxAccess:eC}})}let e$=[{key:"Close",condition:!eE,onClick:async function(){let{serials:e,...l}=eR.values;await ex({extension:w.P.DraftInvoice.close,record:JSON.stringify({...l,date:(0,t.ku)(eR.values.date)})}).then(()=>{var e;u.ZP.success(eb.Closed),ef(),eL(null==eR?void 0:null===(e=eR.values)||void 0===e?void 0:e.recordId)})},disabled:eE||!eT||!(null==eR?void 0:null===(U=eR.values)||void 0===U?void 0:null===(M=U.serials)||void 0===M?void 0:null===(z=M[0])||void 0===z?void 0:z.srlNo)},{key:"Reopen",condition:eE,onClick:eM,disabled:!eE||3==eR.values.status||!eT},{key:"WorkFlow",condition:!0,onClick:eU,disabled:!eT},{key:"Import",condition:!0,onClick:()=>eX(),disabled:!eT||1!=eR.values.status||eE},{key:"AccountSummary",condition:!0,onClick:()=>{eg({Component:_.Z,props:{accountId:parseInt(eR.values.accountId),moduleId:1}})},disabled:!eR.values.clientId}];async function eK(e){var l,a;if(!e)return;let{header:i={},items:n=[]}=e,t=await Promise.all((n||[]).map(async(e,l)=>{let a=(null==i?void 0:i.isVattable)&&e.taxId?await eQ(e.taxId):null;return{...e,id:l+1,baseLaborPrice:parseFloat(e.baseLaborPrice).toFixed(2),unitPrice:parseFloat(e.unitPrice).toFixed(2),vatAmount:parseFloat(e.vatAmount).toFixed(2),amount:parseFloat(e.amount).toFixed(2),taxDetails:a}}));await eR.setValues({...eR.values,...i,plId:eS||(null==eR?void 0:null===(l=eR.values)||void 0===l?void 0:l.plId),amount:null==i?void 0:i.amount,vatAmount:null==i?void 0:i.vatAmount,subtotal:null==i?void 0:i.subtotal,weight:null==i?void 0:i.weight,serials:t.length?t:null==eR?void 0:null===(a=eR.initialValues)||void 0===a?void 0:a.serials})}async function eQ(e){if(!e)return[];let l=eN.current;return l?null==l?void 0:l.filter(l=>l.taxId===e):[]}let eY=eR.values.search?eR.values.serials.filter(e=>{var l,a,i,n,t,d,o,r,s,u;return(null===(a=e.srlNo)||void 0===a?void 0:null===(l=a.toString())||void 0===l?void 0:l.includes(eR.values.search))||(null===(t=e.sku)||void 0===t?void 0:null===(n=t.toString())||void 0===n?void 0:null===(i=n.toLowerCase())||void 0===i?void 0:i.includes(eR.values.search.toLowerCase()))||(null===(r=e.itemName)||void 0===r?void 0:null===(o=r.toString())||void 0===o?void 0:null===(d=o.toLowerCase())||void 0===d?void 0:d.includes(eR.values.search.toLowerCase()))||(null===(u=e.weight)||void 0===u?void 0:null===(s=u.toString())||void 0===s?void 0:s.includes(eR.values.search))}):eR.values.serials,e0=(e,l,a)=>{if("delete"===l){let e=eR.values.serials;e=e.filter(e=>e.id!==a.id),eR.setFieldValue("serials",e),ek(!0)}else eR.setFieldValue("serials",e)};async function e2(e){if(e){var l,a,i;let n=await eh({extension:w.P.DocumentTypeDefault.get,parameters:"_dtId=".concat(e)});eR.setFieldValue("plantId",(null==n?void 0:null===(l=n.record)||void 0===l?void 0:l.plantId)||null),eR.setFieldValue("spId",(null==n?void 0:null===(a=n.record)||void 0===a?void 0:a.spId)||eV||null),eR.setFieldValue("siteId",(null==n?void 0:null===(i=n.record)||void 0===i?void 0:i.siteId)||eO||null)}}async function e1(){if(Object.keys(await eR.validateForm()).length){let e=Object.keys(await eR.validateForm()).reduce((e,l)=>(eR.touched[l]||(e[l]=!0),e),{});Object.keys(e).length&&eR.setTouched(e,!0)}}return(0,o.useEffect)(()=>{var e,l;if(null==eR?void 0:null===(l=eR.values)||void 0===l?void 0:null===(e=l.serials)||void 0===e?void 0:e.length){let e=null==eR?void 0:null===(a=eR.values)||void 0===a?void 0:a.serials,l=e.reduce((e,l)=>{let{metalId:a,weight:i,metalRef:n}=l;return a&&(e[a]||(e[a]={metal:n,pcs:0,totalWeight:0}),e[a].pcs+=1,e[a].totalWeight+=parseFloat(i||0)),e},{});Object.keys(l).forEach(e=>{l[e].totalWeight=parseFloat(l[e].totalWeight.toFixed(2))}),eR.setFieldValue("metalGridData",Object.values(l));var a,i=0;let n=e.reduce((e,l)=>{let{sku:a,itemId:n,itemName:t,weight:d,categoryName:o}=l;return n&&(e[n]||(i++,e[n]={sku:a,pcs:0,weight:0,itemName:t,seqNo:i,categoryName:o}),e[n].pcs+=1,e[n].weight=parseFloat((e[n].weight+parseFloat(d||0)).toFixed(2))),e},{});eR.setFieldValue("itemGridData",Object.values(n).sort((e,l)=>e.seqNo-l.seqNo))}},[null==eR?void 0:null===(X=eR.values)||void 0===X?void 0:X.serials]),(0,o.useEffect)(()=>{var e;if(!(null===(e=eR.values.serials)||void 0===e?void 0:e.length))return;let l=eG(eR.values.serials);eR.setFieldValue("subtotal",l.subtotal),eR.setFieldValue("vatAmount",l.vatAmount),eR.setFieldValue("weight",l.weight),eR.setFieldValue("amount",l.amount)},[eR.values.serials]),(0,o.useEffect)(()=>{!async function(){var e,l;eS||ey({message:em.noSelectedplId}),await e_(),(null==eR?void 0:null===(e=eR.values)||void 0===e?void 0:e.recordId)&&await eL(null==eR?void 0:null===(l=eR.values)||void 0===l?void 0:l.recordId)}()},[]),(0,i.jsx)(s.Z,{resourceId:v.i.DraftSerialsInvoices,functionId:f.J.DraftSerialsIn,form:eR,maxAccess:eC,previewReport:eT,isClosed:eE,actions:e$,editMode:eT,disabledSubmit:eE&&!eT,disabledSavedClear:eE&&!eT,children:(0,i.jsxs)(y.R,{children:[(0,i.jsx)(b.g,{children:(0,i.jsxs)(d.ZP,{container:!0,spacing:2,children:[(0,i.jsx)(d.ZP,{item:!0,xs:4,children:(0,i.jsx)(I.Z,{endpointId:w.P.DraftInvoice.pack,reducer:e=>{var l;return null==e?void 0:null===(l=e.record)||void 0===l?void 0:l.documentTypes},name:"dtId",label:em.documentType,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],readOnly:eT,required:!0,valueField:"recordId",displayField:["reference","name"],values:eR.values,maxAccess:eC,onChange:async(e,l)=>{eR.setFieldValue("dtId",null==l?void 0:l.recordId),await e2(null==l?void 0:l.recordId),eA(l)},error:eR.touched.dtId&&!!eR.errors.dtId})}),(0,i.jsx)(d.ZP,{item:!0,xs:4,children:(0,i.jsx)(I.Z,{endpointId:w.P.DraftInvoice.pack,reducer:e=>{var l;return null==e?void 0:null===(l=e.record)||void 0===l?void 0:l.sites},name:"siteId",readOnly:eE||(null==eR?void 0:null===(K=eR.values)||void 0===K?void 0:null===($=K.serials)||void 0===$?void 0:$.some(e=>e.srlNo)),label:em.site,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:eR.values,required:!0,valueField:"recordId",displayField:["reference","name"],maxAccess:eC,onChange:(e,l)=>{(null==l?void 0:l.isInactive)?(eR.setFieldValue("siteId",null),ey({message:em.inactiveSite})):eR.setFieldValue("siteId",null==l?void 0:l.recordId)},error:eR.touched.siteId&&!!eR.errors.siteId})}),(0,i.jsx)(d.ZP,{item:!0,xs:2,children:(0,i.jsx)(I.Z,{endpointId:w.P.DraftInvoice.pack,reducer:e=>{var l;return null==e?void 0:null===(l=e.record)||void 0===l?void 0:l.currencies},filter:e=>1===e.currencyType,name:"currencyId",label:em.currency,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],required:!0,readOnly:eE,values:eR.values,maxAccess:eC,onChange:(e,l)=>{eR.setFieldValue("currencyId",(null==l?void 0:l.recordId)||null)},error:eR.touched.currencyId&&!!eR.errors.currencyId})}),(0,i.jsx)(d.ZP,{item:!0,xs:2,children:(0,i.jsx)(m.Z,{name:"search",value:eR.values.search,label:eb.Search,onClear:()=>{eR.setFieldValue("search","")},onChange:e=>{let{value:l}=e.target;eR.setFieldValue("search",l)},onSearch:e=>eR.setFieldValue("search",e),search:!0})}),(0,i.jsx)(d.ZP,{item:!0,xs:4,children:(0,i.jsx)(m.Z,{name:"reference",label:em.reference,value:null==eR?void 0:null===(Q=eR.values)||void 0===Q?void 0:Q.reference,maxAccess:!eT&&eC,readOnly:eT,onChange:eR.handleChange,onClear:()=>eR.setFieldValue("reference",""),error:eR.touched.reference&&!!eR.errors.reference})}),(0,i.jsx)(d.ZP,{item:!0,xs:4,children:(0,i.jsx)(I.Z,{endpointId:w.P.DraftInvoice.pack,reducer:e=>{var l;return null==e?void 0:null===(l=e.record)||void 0===l?void 0:l.plants},name:"plantId",label:em.plant,readOnly:!0,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:eR.values,valueField:"recordId",displayField:["reference","name"],maxAccess:eC,onChange:(e,l)=>{eR.setFieldValue("plantId",null==l?void 0:l.recordId)},error:eR.touched.plantId&&!!eR.errors.plantId})}),(0,i.jsx)(d.ZP,{item:!0,xs:4,children:(0,i.jsx)(I.Z,{endpointId:(null==eR?void 0:null===(Y=eR.values)||void 0===Y?void 0:Y.clientId)&&w.P.Contact.contact,parameters:"_clientId=".concat(eR.values.clientId),name:"contactId",label:em.contact,readOnly:eE,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:eR.values,valueField:"recordId",displayField:["reference","name"],maxAccess:eC,onChange:(e,l)=>{eR.setFieldValue("contactId",(null==l?void 0:l.recordId)||null)},error:eR.touched.contactId&&!!eR.errors.contactId})}),(0,i.jsx)(d.ZP,{item:!0,xs:4,children:(0,i.jsx)(n.Z,{name:"date",required:!0,label:em.postingDate,value:null==eR?void 0:null===(ee=eR.values)||void 0===ee?void 0:ee.date,onChange:eR.setFieldValue,editMode:eT,readOnly:eE,maxAccess:eC,onClear:()=>eR.setFieldValue("date",""),error:eR.touched.date&&!!eR.errors.date})}),(0,i.jsx)(d.ZP,{item:!0,xs:4,children:(0,i.jsx)(I.Z,{endpointId:w.P.DraftInvoice.pack,reducer:e=>{var l;return null==e?void 0:null===(l=e.record)||void 0===l?void 0:l.salesPeople},name:"spId",required:!0,label:em.salesPerson,columnsInDropDown:[{key:"spRef",value:"Reference"},{key:"name",value:"Name"}],readOnly:eE,valueField:"recordId",displayField:"name",values:eR.values,onChange:(e,l)=>{eR.setFieldValue("spId",(null==l?void 0:l.recordId)||null)},error:eR.touched.spId&&!!eR.errors.spId})}),(0,i.jsx)(d.ZP,{item:!0,xs:4,children:(0,i.jsx)(I.Z,{endpointId:w.P.DraftInvoice.pack,reducer:e=>{var l;return null==e?void 0:null===(l=e.record)||void 0===l?void 0:l.taxSchedules},name:"taxId",label:em.tax,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],readOnly:!0,values:eR.values,maxAccess:eC,onChange:(e,l)=>{eR.setFieldValue("taxId",(null==l?void 0:l.recordId)||null)},error:eR.touched.taxId&&!!eR.errors.taxId})}),(0,i.jsx)(d.ZP,{item:!0,xs:8,children:(0,i.jsx)(d.ZP,{item:!0,xs:12,children:(0,i.jsx)(h.U,{endpointId:w.P.Client.snapshot,filter:{isInactive:!1},valueField:"reference",displayField:"name",secondFieldLabel:em.name,name:"clientId",label:em.client,form:eR,required:!0,readOnly:eE,displayFieldWidth:2,firstFieldWidth:3,valueShow:"clientRef",secondValueShow:"clientName",maxAccess:eC,editMode:eT,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"},{key:"szName",value:"Sales Zone"},{key:"keywords",value:"Keywords"},{key:"cgName",value:"Client Group"}],onChange:async(e,l)=>{eR.setFieldValue("clientName",null==l?void 0:l.name),eR.setFieldValue("clientRef",null==l?void 0:l.reference),eR.setFieldValue("accountId",null==l?void 0:l.accountId),eR.setFieldValue("isVattable",(null==l?void 0:l.isSubjectToVAT)||!1),eR.setFieldValue("taxId",null==l?void 0:l.taxId),eR.setFieldValue("clientId",(null==l?void 0:l.recordId)||null)},errorCheck:"clientId"})})}),(0,i.jsx)(d.ZP,{item:!0,xs:4,children:(0,i.jsx)(p.Z,{name:"description",label:em.description,value:eR.values.description,rows:1.25,editMode:eT,readOnly:eE,maxAccess:eC,onChange:e=>eR.setFieldValue("description",e.target.value),onClear:()=>eR.setFieldValue("description",""),error:eR.touched.description&&!!eR.errors.description})})]})}),(0,i.jsx)(x.Q,{children:(0,i.jsx)(g._,{onChange:(e,l,a)=>e0(e,l,a),value:eY||[],error:eR.errors.serials,initialValues:null==eR?void 0:null===(ea=eR.initialValues)||void 0===ea?void 0:null===(el=ea.serials)||void 0===el?void 0:el[0],columns:ez,name:"serials",maxAccess:eC,disabled:eE||Object.entries((null==eR?void 0:eR.errors)||{}).filter(e=>{let[l]=e;return"serials"!==l}).length>0,allowDelete:!eE,allowAddNewLine:!(null==eR?void 0:null===(ei=eR.values)||void 0===ei?void 0:ei.search)&&((null===(et=eR.values)||void 0===et?void 0:null===(en=et.serials)||void 0===en?void 0:en.length)===0||!!(null===(eu=eR.values)||void 0===eu?void 0:null===(es=eu.serials)||void 0===es?void 0:null===(ed=es[(null===(er=eR.values)||void 0===er?void 0:null===(eo=er.serials)||void 0===eo?void 0:eo.length)-1])||void 0===ed?void 0:ed.srlNo)),autoDelete:eW,onValidationRequired:e1})}),(0,i.jsxs)(d.ZP,{container:!0,spacing:2,children:[(0,i.jsx)(d.ZP,{item:!0,xs:6.5,sx:{display:"flex",flex:1},children:(0,i.jsx)(A.Z,{name:"item",columns:[{field:"seqNo",headerName:em.seqNo,type:"number",flex:.75},{field:"sku",headerName:em.sku,flex:1},{field:"itemName",headerName:em.itemDesc,flex:2},{field:"categoryName",headerName:em.category,flex:2},{field:"pcs",headerName:em.pcs,type:"number",flex:1},{field:"weight",headerName:em.weight,type:"number",flex:1}],gridData:{count:1,list:null==eR?void 0:null===(ec=eR.values)||void 0===ec?void 0:ec.itemGridData},rowId:["sku"],maxAccess:ep,pagination:!1})}),(0,i.jsx)(d.ZP,{item:!0,xs:3,sx:{display:"flex",flex:1},children:(0,i.jsx)(A.Z,{name:"metal",gridData:{count:1,list:null==eR?void 0:null===(ev=eR.values)||void 0===ev?void 0:ev.metalGridData},maxAccess:ep,columns:[{field:"metal",headerName:em.metal,flex:1},{field:"pcs",headerName:em.pcs,type:"number",flex:1},{field:"totalWeight",headerName:em.totalWeight,type:"number",flex:1}],rowId:["metal"],pagination:!1})}),(0,i.jsx)(d.ZP,{item:!0,xs:.5}),(0,i.jsx)(d.ZP,{item:!0,xs:2,children:(0,i.jsxs)(d.ZP,{container:!0,spacing:2,children:[(0,i.jsx)(d.ZP,{item:!0,xs:12}),(0,i.jsx)(d.ZP,{item:!0,xs:12,children:(0,i.jsx)(F.Z,{name:"weight",maxAccess:eC,label:em.totalWeight,value:eR.values.weight,readOnly:!0})}),(0,i.jsx)(d.ZP,{item:!0,xs:12}),(0,i.jsx)(d.ZP,{item:!0,xs:12,children:(0,i.jsx)(F.Z,{name:"subtotal",maxAccess:eC,label:em.subtotal,value:eR.values.subtotal,readOnly:!0})}),(0,i.jsx)(d.ZP,{item:!0,xs:12,children:(0,i.jsx)(F.Z,{name:"vatAmount",maxAccess:eC,label:em.vat,value:eR.values.vatAmount,readOnly:!0})}),(0,i.jsx)(d.ZP,{item:!0,xs:12,children:(0,i.jsx)(F.Z,{name:"amount",maxAccess:eC,label:em.total,value:eR.values.amount,readOnly:!0})})]})})]})]})})};L.width=1300,L.height=750,l.Z=L},81330:function(e,l,a){"use strict";a.d(l,{Z:function(){return b}});var i=a(52322),n=a(2784),t=a(60218),d=a(31389),o=a(5088),r=a(21581),s=a(78711),u=a(19473),c=a(23361),v=a(21326);let m=e=>{let{window:l,onConfirm:a,fullScreen:t,open:d,dialogText:o}=e,{platformLabels:r}=(0,n.useContext)(u.l);return(0,v.Z)({title:r.import,window:l}),(0,i.jsx)(c.Z,{open:(null==d?void 0:d.flag)||!1,DialogText:o,okButtonAction:()=>{"function"==typeof a&&a(),l.close()},fullScreen:t,cancelButtonAction:()=>l.close(),height:"140px"})};m.width=470,m.height=170;var p=a(61802),I=a(65950),f=a(62202),h=a(62362),x=a(69627),g=a(54074);let y=e=>{var l,a;let{endPoint:c,header:y,onCloseimport:b,maxAccess:F,window:w}=e,{stack:P}=(0,p.zY)(),{platformLabels:j}=(0,n.useContext)(u.l),k=(0,n.useRef)(null),[N,Z]=(0,n.useState)(null),[C,A]=(0,n.useState)([]),{postRequest:D}=(0,n.useContext)(I.$);(0,v.Z)({title:j.importSerials,window:w});let S=(0,s.TA)({initialValues:{serials:"",serialCount:0}}),V=e=>{let l=e.split("\n").filter(e=>""!==e.trim()).length;S.setFieldValue("serialCount",l)},O=async()=>{P({Component:m,props:{open:{flag:!0},fullScreen:!1,onConfirm:R,dialogText:j.importConfirmation}})},R=async()=>{var e;let l=null===(e=S.values.serials)||void 0===e?void 0:e.replace(/\n/g,",\r\n"),a={...y,serials:l||C};await D({extension:c,record:JSON.stringify(a)}),f.ZP.success(j.Imported),b(),w.close()},_=[{key:"Import",condition:!0,onClick:O,disabled:!(null==N?void 0:N.name)&&!(null==S?void 0:null===(l=S.values)||void 0===l?void 0:l.serials)}];return(0,i.jsx)(g.Z,{actions:_,onSave:()=>O(),disabledSubmit:!(null==N?void 0:N.name)&&!(null==S?void 0:null===(a=S.values)||void 0===a?void 0:a.serials),isSaved:!1,children:(0,i.jsxs)(d.R,{children:[(0,i.jsx)(h.Q,{children:(0,i.jsxs)(t.ZP,{container:!0,spacing:2,children:[(0,i.jsx)(t.ZP,{item:!0,xs:7,children:(0,i.jsx)(o.Z,{name:"name",label:j.SelectCSV,value:null==N?void 0:N.name,disabled:S.values.serials||!!(null==N?void 0:N.name),readOnly:!0,maxAccess:F})}),(0,i.jsx)(t.ZP,{item:!0,xs:3,children:(0,i.jsx)(x.Z,{onClick:()=>{k.current.click()},label:"".concat(j.Browse,"..."),color:"primary",disabled:!!(null==N?void 0:N.name)||S.values.serials})}),(0,i.jsx)(t.ZP,{item:!0,xs:2,children:(0,i.jsx)(x.Z,{image:"clear.png",onClick:()=>{Z(null),A([]),k.current.value=null},label:j.Clear,color:"#f44336"})}),(0,i.jsxs)(t.ZP,{item:!0,xs:12,children:[S.values.serialCount>0&&(0,i.jsxs)("label",{style:{marginBottom:"8px",display:"block"},maxAccess:F,children:[j.serials," ( ",S.values.serialCount," )"]}),(0,i.jsx)(r.Z,{name:"serials",label:j.serials,value:S.values.serials,rows:3,readOnly:null==N?void 0:N.name,onChange:e=>{S.setFieldValue("serials",e.target.value),V(e.target.value)},onClear:()=>{S.setFieldValue("serials",""),S.setFieldValue("serialCount",0)},error:S.touched.serials&&!!S.errors.serials,maxAccess:F})]})]})}),(0,i.jsx)("input",{type:"file",accept:".csv",ref:k,style:{display:"none"},onChange:e=>{let l=e.target.files[0];if(Z(l),l){let e=new FileReader;e.onload=e=>{A(e.target.result)},e.readAsText(l)}}})]})})};y.width=550,y.height=270;var b=y},39704:function(e,l,a){"use strict";var i=a(52322),n=a(2784),t=a(22341),d=a(65950),o=a(85325),r=a(21326),s=a(19473),u=a(35656),c=a(24868),v=a.n(c);let m=e=>{let{functionId:l,recordId:a,window:c}=e,{getRequest:m}=(0,n.useContext)(d.$),{languageId:p}=(0,n.useContext)(o.V),{platformLabels:I}=(0,n.useContext)(s.l),f=a+"-"+l;(0,r.Z)({title:I.WorkFlow,window:c});let{width:h}=(0,u.d)(),x=h<=1024,g=h>1024&&h<=1280,y=x?10:g?12:14,b=x?75:g?85:95,F=x?15:g?20:25,w=async()=>{var e="_functionId=".concat(l,"&_recordId=").concat(a);let i=await m({extension:t.P.WorkFlow.graph,parameters:e});return null==i?void 0:i.record},P=e=>{let l=[],a=[],i="",n="";return e.objects.forEach(e=>{l.push({functionName:e.functionName,reference:e.reference,date:e.date})}),e.workflow.forEach(l=>{e.objects.forEach(e=>{let a=e.functionName.split(" ").join("\r\n");l.parentId===e.recordId&&l.parentFunctionId===e.functionId&&(i=e.reference+"\r\n"+e.date+"\r\n"+a,l.parentId),l.childId===e.recordId&&l.childFunctionId===e.functionId&&(n=e.reference+"\r\n"+e.date+"\r\n"+a,l.childId)}),""===i||""===n||a.push({from:i,to:n,value:1,labelText:""}),i="",n=""}),a};return(0,n.useEffect)(()=>{!async function(){var e=await w();if(e){let l=(e,l)=>{let a=document.createElement("script");a.type="text/javascript",a.src=e,a.async=!0,a.onload=l,document.head.appendChild(a)};l("https://cdn.amcharts.com/lib/4/core.js",()=>{l("https://cdn.amcharts.com/lib/4/charts.js",()=>{l("https://cdn.amcharts.com/lib/4/themes/animated.js",()=>{am4core.ready(()=>{let l=am4core.create(f,am4charts.SankeyDiagram),a=P(e);l.data=a,l.dataFields.fromName="from",l.dataFields.toName="to",l.dataFields.value="value",l.paddingRight=2===p?0:40,l.paddingLeft=2===p?40:0,l.tooltip.label.fontSize=y;let i=l.nodes.template;i.draggable=!1,i.inert=!0,i.clickable=!1,i.width=b,i.height=F,i.nameLabel.label.fontSize=y,i.nameLabel.locationX=2===p?.85:0,i.nameLabel.height=void 0,i.nameLabel.label.fontWeight="bold";let n=l.links.template;n.middleLine.strokeOpacity=.3,n.middleLine.stroke=am4core.color("#555"),n.middleLine.strokeWidth=5,n.middleLine.hoverable=!1,n.fillOpacity=0,n.hoverable=!0,n.hoverOnFocus=!0,n.fill=am4core.color("#A8C686"),n.isHover=!0,l.appear(1e3,100)})})})})}}()},[]),(0,i.jsx)("div",{id:f,className:v().root})};m.width=950,l.Z=m},24868:function(e){e.exports={root:"WorkFlow_root__EINm1"}}}]);