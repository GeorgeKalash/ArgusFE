(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[78451],{51264:function(e,a,l){"use strict";l.d(a,{p:function(){return r}});let n="LO.asmx/",r={LoCollector:{qry:n+"qryCOL",get:n+"getCOL",set:n+"setCOL",page:n+"pageCOL",del:n+"delCOL"},LoCarrier:{qry:n+"qryCAR",get:n+"getCAR",set:n+"setCAR",page:n+"pageCAR",del:n+"delCAR"},Shipment:{get2:n+"get2SHP",set2:n+"set2SHP"},Transportation:{get:n+"getTPT",set:n+"setTPT"}}},75991:function(e,a,l){"use strict";var n=l(52322),r=l(60218),o=l(76385);a.Z=e=>{let{children:a,title:l,form:t=!1,...i}=e;return(0,n.jsxs)(r.ZP,{container:!0,spacing:{xs:1,sm:1.25,md:1.5},sx:{border:"1px solid",borderColor:"#cdd3d4",position:"relative",ml:0,my:l?{xs:.75,sm:1,md:1.25}:0,p:t?0:"clamp(8px, 0.8vw, 14px)",pt:t?0:l?"clamp(14px, 1.2vw, 22px)":"clamp(8px, 0.8vw, 14px)",...i.sx},children:[!!l&&(0,n.jsx)(o.Z,{variant:"h6",sx:{position:"absolute",top:"clamp(-12px, -0.9vw, -8px)",left:"clamp(10px, 1vw, 14px)",bgcolor:"#F4F5FA",px:"clamp(6px, 0.7vw, 12px)",py:"clamp(1px, 0.2vw, 3px)",fontSize:"clamp(10px, 0.75vw, 14px)",lineHeight:1.2,fontWeight:600,whiteSpace:"nowrap",maxWidth:"calc(100% - 20px)",overflow:"hidden",textOverflow:"ellipsis"},children:l}),a]})}},91088:function(e,a,l){"use strict";l.d(a,{u:function(){return C}});var n=l(52322),r=l(31389),o=l(33625),t=l(62362),i=l(26612),c=l(60218),d=l(5088),s=l(8661),p=l(76399),u=l(80983),m=l(51264),v=l(48601),x=l(71987),g=l(2784),f=l(65950),h=l(84100),y=l(25506),k=l(62202),I=l(75991),b=l(96026),w=l(21326),j=l(19473),N=l(54074);let C=e=>{var a,l,C,Z,q,R,F,L,O,S,A;let{recordId:P,functionId:_,editMode:T,totalBaseAmount:E,window:V}=e,{postRequest:D,getRequest:W}=(0,g.useContext)(f.$),[Q,H]=(0,g.useState)(null),{stack:z}=(0,b.V)(),{platformLabels:B}=(0,g.useContext)(j.l);(0,w.Z)({title:B.Transportation,window:V});let{formik:M}=(0,u.c)({initialValues:{recordId:P,functionId:_,policyNo:"",carrierId:"",packages:[{id:1,recordId:"",functionId:"",seqNo:"",packageType:"",qty:"",amount:"",packageReferences:[{id:1,typeId:"",packageSeqNo:"",recordId:"",functionId:"",seqNo:1,reference:""}]}]},validateOnChange:!0,validationSchema:v.Ry({carrierId:v.Z_().required(),packages:v.IX().of(v.Ry().shape({packageTypeName:v.Z_().required(),qty:v.Z_().required(),amount:v.Z_().required()})).required()}),onSubmit:async e=>{let a=M.values.packages.map((e,a)=>{var l;return{...e,seqNo:a+1,recordId:P,functionId:_,packageReferences:(null===(l=e.packageReferences.map(e=>({seqNo:a+1,recordId:P,functionId:_,reference:e.reference})))||void 0===l?void 0:l.filter(e=>!!(null==e?void 0:e.reference)))||[]}}),l={header:{recordId:P,functionId:_,carrierId:e.carrierId,policyNo:e.policyNo},packages:a};await D({extension:m.p.Shipment.set2,record:JSON.stringify(l)}),k.ZP.success("Record Updated Successfully")}}),J=M.values.packages.findIndex(e=>e.id===Q),{labels:K,maxAccess:X}=(0,x.J)({datasetId:i.i.LOShipments}),$=null===(l=M.values)||void 0===l?void 0:null===(a=l.packages)||void 0===a?void 0:a.reduce((e,a)=>{var l;return e+(parseFloat(null===(l=a.qty)||void 0===l?void 0:l.toString().replace(/,/g,""))||0)},0),G=null===(Z=M.values)||void 0===Z?void 0:null===(C=Z.packages)||void 0===C?void 0:C.reduce((e,a)=>{var l;return e+(parseFloat(null===(l=a.amount)||void 0===l?void 0:l.toString().replace(/,/g,""))||0)},0),U=e=>{var a,l,n,r,o,t;(null===(l=M.values.packages[J])||void 0===l?void 0:null===(a=l.packageReferences)||void 0===a?void 0:a.length)<e.length&&(e[null===(r=M.values.packages[J])||void 0===r?void 0:null===(n=r.packageReferences)||void 0===n?void 0:n.length].seqNo=(null===(t=M.values.packages[J])||void 0===t?void 0:null===(o=t.packageReferences)||void 0===o?void 0:o.length)+1),M.setFieldValue("packages[".concat(J,"].packageReferences"),e)},Y=(e,a)=>{let l=e.target.value;if(M.values.packages.some(e=>e.packageReferences.some((e,n)=>e.reference===l&&n!==a-1))){z({message:K.referenceDuplicateMessage});let e=[...M.values.packages[J].packageReferences],l=a-1;e[l]={id:l,...e[l],reference:""},M.setFieldValue("packages[".concat(J,"].packageReferences"),e)}},ee=e=>{let a=null==e?void 0:e.map(e=>{let a=parseInt(null==e?void 0:e.qty,10),l=null==e?void 0:e.packageReferences;return(null==l?void 0:l.length)===0&&(l=[{seqNo:1,id:1,reference:""}]),a<(null==l?void 0:l.length)&&(l=l.slice(0,a)),e.packageReferences=l,e});M.setFieldValue("packages",a)};return(0,g.useEffect)(()=>{!async function(){if(P&&_){var e,a,l;let n=await W({extension:m.p.Shipment.get2,parameters:"_recordId=".concat(P,"&_functionId=").concat(_)}),r=n.record.packages.map((e,a)=>{var l;return{...e,id:a+1,packageReferences:null==e?void 0:null===(l=e.packageReferences)||void 0===l?void 0:l.map((e,a)=>({...e,id:a+1,seqNo:a+1}))}});H((null===(a=n.record)||void 0===a?void 0:null===(e=a.packages)||void 0===e?void 0:e.length)>0&&1),(null==n?void 0:null===(l=n.record)||void 0===l?void 0:l.header)&&M.setValues({...n.record.header,packages:r})}}()},[]),(0,n.jsx)(N.Z,{onSave:M.handleSubmit,editMode:!0,children:(0,n.jsxs)(r.R,{children:[(0,n.jsx)(o.g,{children:(0,n.jsxs)(c.ZP,{container:!0,wrap:"nowrap",spacing:2,children:[(0,n.jsx)(c.ZP,{item:!0,xs:6,children:(0,n.jsx)(s.Z,{endpointId:m.p.LoCarrier.qry,name:"carrierId",label:K.carrier,values:M.values,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],required:!0,readOnly:T,maxAccess:X,onChange:(e,a)=>{M&&M.setFieldValue("carrierId",a?a.recordId:"")},error:M.touched.carrierId&&!!M.errors.carrierId})}),(0,n.jsx)(c.ZP,{item:!0,xs:6,children:(0,n.jsx)(d.Z,{name:"policyNo",label:K.policyNo,value:M.values.policyNo,onChange:M.handleChange,onClear:()=>M.setFieldValue("policyNo",""),maxAccess:X,maxLength:"30",readOnly:T,error:M.touched.policyNo&&!!M.errors.policyNo})})]})}),(0,n.jsx)(t.Q,{children:(0,n.jsxs)(c.ZP,{container:!0,xs:12,spacing:2,children:[(0,n.jsx)(c.ZP,{item:!0,xs:8,sx:{display:"flex",flex:1},children:(0,n.jsx)(I.Z,{sx:{flex:1},children:(0,n.jsxs)(c.ZP,{container:!0,wrap:"nowrap",sx:{flexDirection:"column",flex:1},children:[(0,n.jsx)(t.Q,{children:(0,n.jsx)(p._,{onChange:e=>ee(e),value:M.values.packages,error:M.errors.packages,maxAccess:X,rowSelectionModel:Q,allowAddNewLine:!T,initialValues:null==M?void 0:null===(R=M.initialValues)||void 0===R?void 0:null===(q=R.packages)||void 0===q?void 0:q[0],allowDelete:!T,onSelectionChange:e=>{e&&H(e.id)},columns:[{component:"resourcecombobox",label:K.type,name:"packageTypeName",props:{datasetId:h.v.PACKAGE_TYPE,displayField:"value",valueField:"key",mapping:[{from:"key",to:"packageType"},{from:"value",to:"packageTypeName"}],readOnly:T}},{component:"numberfield",name:"qty",label:K.qty,props:{readOnly:T}},{component:"numberfield",label:K.amount,name:"amount",props:{readOnly:T}}]})}),(0,n.jsx)(o.g,{children:(0,n.jsxs)(c.ZP,{container:!0,direction:"row",wrap:"nowrap",sx:{pt:5,justifyContent:"flex-end"},children:[(0,n.jsx)(c.ZP,{item:!0,xs:3,children:(0,n.jsx)(d.Z,{name:"totalBaseAmount",maxAccess:X,value:(0,y.bj)(E),label:K.totalBaseAmount,readOnly:!0})}),(0,n.jsx)(c.ZP,{item:!0,xs:3,sx:{pl:3},children:(0,n.jsx)(d.Z,{name:"totalQty",maxAccess:X,value:(0,y.bj)($),label:K.totalQty,readOnly:!0})}),(0,n.jsx)(c.ZP,{item:!0,xs:3,sx:{pl:3},children:(0,n.jsx)(d.Z,{name:"totalAmount",maxAccess:X,value:(0,y.bj)(G.toFixed(2)),label:K.totalAmount,readOnly:!0})})]})})]})})}),(0,n.jsx)(c.ZP,{item:!0,xs:4,sx:{display:"flex",flex:1},children:(0,n.jsx)(I.Z,{xs:4,sx:{flex:1},children:(0,n.jsx)(t.Q,{children:Q&&M.values.packages[J]&&(0,n.jsx)(p._,{onChange:e=>U(e),value:M.values.packages.find(e=>e.id===Q).packageReferences||[{seqNo:"1",id:1,reference:""}],maxAccess:X,allowAddNewLine:!T&&(null==M?void 0:null===(O=M.values)||void 0===O?void 0:null===(L=O.packages[J])||void 0===L?void 0:null===(F=L.packageReferences)||void 0===F?void 0:F.length)<parseInt(null==M?void 0:null===(A=M.values)||void 0===A?void 0:null===(S=A.packages[J])||void 0===S?void 0:S.qty,10),allowDelete:!1,columns:[{component:"numberfield",name:"seqNo",label:K.seqNo,props:{readOnly:!0}},{component:"textfield",label:K.cellNumber,name:"reference",props:{maxLength:20,mandatory:!0,readOnly:T},onBlur:(e,a)=>Y(e,a),onKeyDown:(e,a)=>Y(e,a)}]},Q)})})})]})})]})})};C.width=1200,C.height=670},39704:function(e,a,l){"use strict";var n=l(52322),r=l(2784),o=l(22341),t=l(65950),i=l(85325),c=l(21326),d=l(19473),s=l(35656),p=l(24868),u=l.n(p);let m=e=>{let{functionId:a,recordId:l,window:p}=e,{getRequest:m}=(0,r.useContext)(t.$),{languageId:v}=(0,r.useContext)(i.V),{platformLabels:x}=(0,r.useContext)(d.l),g=l+"-"+a;(0,c.Z)({title:x.WorkFlow,window:p});let{width:f}=(0,s.d)(),h=f<=1024,y=f>1024&&f<=1280,k=h?10:y?12:14,I=h?75:y?85:95,b=h?15:y?20:25,w=async()=>{var e="_functionId=".concat(a,"&_recordId=").concat(l);let n=await m({extension:o.P.WorkFlow.graph,parameters:e});return null==n?void 0:n.record},j=e=>{let a=[],l=[],n="",r="";return e.objects.forEach(e=>{a.push({functionName:e.functionName,reference:e.reference,date:e.date})}),e.workflow.forEach(a=>{e.objects.forEach(e=>{let l=e.functionName.split(" ").join("\r\n");a.parentId===e.recordId&&a.parentFunctionId===e.functionId&&(n=e.reference+"\r\n"+e.date+"\r\n"+l,a.parentId),a.childId===e.recordId&&a.childFunctionId===e.functionId&&(r=e.reference+"\r\n"+e.date+"\r\n"+l,a.childId)}),""===n||""===r||l.push({from:n,to:r,value:1,labelText:""}),n="",r=""}),l};return(0,r.useEffect)(()=>{!async function(){var e=await w();if(e){let a=(e,a)=>{let l=document.createElement("script");l.type="text/javascript",l.src=e,l.async=!0,l.onload=a,document.head.appendChild(l)};a("https://cdn.amcharts.com/lib/4/core.js",()=>{a("https://cdn.amcharts.com/lib/4/charts.js",()=>{a("https://cdn.amcharts.com/lib/4/themes/animated.js",()=>{am4core.ready(()=>{let a=am4core.create(g,am4charts.SankeyDiagram),l=j(e);a.data=l,a.dataFields.fromName="from",a.dataFields.toName="to",a.dataFields.value="value",a.paddingRight=2===v?0:40,a.paddingLeft=2===v?40:0,a.tooltip.label.fontSize=k;let n=a.nodes.template;n.draggable=!1,n.inert=!0,n.clickable=!1,n.width=I,n.height=b,n.nameLabel.label.fontSize=k,n.nameLabel.locationX=2===v?.85:0,n.nameLabel.height=void 0,n.nameLabel.label.fontWeight="bold";let r=a.links.template;r.middleLine.strokeOpacity=.3,r.middleLine.stroke=am4core.color("#555"),r.middleLine.strokeWidth=5,r.middleLine.hoverable=!1,r.fillOpacity=0,r.hoverable=!0,r.hoverOnFocus=!0,r.fill=am4core.color("#A8C686"),r.isHover=!0,a.appear(1e3,100)})})})})}}()},[]),(0,n.jsx)("div",{id:g,className:u().root})};m.width=950,a.Z=m},24868:function(e){e.exports={root:"WorkFlow_root__EINm1"}}}]);