"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[69952],{69952:function(e,l,t){t.d(l,{Z:function(){return J}});var d=t(52322),a=t(89330),n=t(39812),i=t(60218),r=t(21429),o=t(2784),u=t(48601),s=t(82737),c=t(62202),v=t(65950),m=t(71987),h=t(26612),y=t(5088),p=t(21581),x=t(8661),I=t(38449),f=t(65215),P=t(7121),b=t(27423),g=t(62362),F=t(76399),A=t(31389),V=t(33625),k=t(91406),q=t(2454),j=t(25870),w=t(80983),C=t(39704),D=t(61802),Z=t(19473),T=t(86626),O=t(18996),N=t(16096),S=t(98345),R=t(84100),_=t(61520),M=t(19568),Q=t(19689),W=t(69627),E=t(96026),L=t(23361),B=t(67920),H=t(21326),$=t(50023);function J(e){var l,J,X,U,G,Y,z,K,ee,el,et,ed,ea,en,ei,er,eo,eu,es,ec,ev,em,eh,ey,ep,ex,eI,ef,eP,eb,eg,eF,eA,eV,ek,eq,ej,ew,eC,eD,eZ,eT,eO,eN,eS,eR,e_,eM,eQ,eW,eE,eL,eB,eH,e$,eJ,eX,eU,eG,eY,ez,eK,e0,e2,e1,e3,e6,e9,e5;let{recordId:e8,window:e4}=e,{getRequest:e7,postRequest:le}=(0,o.useContext)(v.$),{stack:ll}=(0,D.zY)(),{platformLabels:lt,defaultsData:ld,userDefaultsData:la}=(0,o.useContext)(Z.l),[ln,li]=(0,o.useState)([]),lr=(0,o.useRef)([]),[lo,lu]=(0,o.useState)(!1),ls=P.J.PurchaseOrder,{stack:lc}=(0,E.V)(),{labels:lv,access:lm}=(0,$.Z)({datasetId:h.i.PurchaseTransactions,editMode:!!e8});(0,H.Z)({title:lv.purchaseOrder,window:e4});let lh=parseInt(null==la?void 0:null===(J=la.list)||void 0===J?void 0:null===(l=J.find(e=>"plantId"===e.key))||void 0===l?void 0:l.value),ly=parseInt(null==ld?void 0:null===(U=ld.list)||void 0===U?void 0:null===(X=U.find(e=>"currencyId"===e.key))||void 0===X?void 0:X.value),[lp,lx]=(0,o.useState)({text:"%",value:2}),{documentType:lI,maxAccess:lf}=(0,S.H)({functionId:ls,access:lm,enabled:!e8,objectName:"header"}),lP={recordId:e8,requestId:null,requestRef:null,currentDiscount:0,import:!1,header:{status:1,wip:1,releaseStatus:null,dtId:null,functionId:ls,recordId:null,date:new Date,deliveryDate:null,reference:"",isVattable:!1,currencyId:ly,plantId:lh,subtotal:0,vatAmount:0,miscAmount:0,amount:0,description:"",tdType:lp.value,tdPct:0,tdAmount:0,volume:0,weight:0,qty:0,vendorId:null,vendorName:"",vendorRef:"",paymentMethod:null,exWorks:!1,deliveryStatus:null,vendorDocRef:"",deliveryMethodId:null,ptId:null,taxId:null},items:[{id:1,poSeqNo:"",poId:0,seqNo:null,componentSeqNo:null,itemId:null,sku:"",itemName:"",trackingStatusId:null,trackingStatusName:"",muId:null,spId:null,qty:0,baseQty:0,unitPrice:null,baseLaborPrice:0,isMetal:!1,metalId:null,metalPurity:0,basePrice:0,mdType:T.Xo,mdValue:0,mdAmount:0,pieces:0,extendedPrice:0,applyVat:!1,vatAmount:0,vatPct:0,unitCost:0,priceType:0,weight:0,volume:0,notes:"",upo:0,poRef:"",trackBy:"",lotCategoryId:null,taxId:null,deliveryDate:null,requestId:null,requestRef:"",requestSeqNo:null,receivedQty:0,invoicedQty:0,msId:null,muRef:"",muQty:0,netUnitPrice:0,netUnitPriceVariation:0}]},lb=(0,m.E)({endpointId:q.y.PurchaseOrder.page}),{schema:lg,requiredFields:lF}=(0,B.m)({sku:e=>null==e?void 0:e.sku,itemName:e=>null==e?void 0:e.itemName,qty:e=>(null==e?void 0:e.qty)>0},!0,lf,"items"),{formik:lA}=(0,w.c)({maxAccess:lf,documentType:{key:"header.dtId",value:null==lI?void 0:lI.dtId},conditionSchema:["items"],initialValues:lP,validateOnChange:!0,validationSchema:u.Ry({header:u.Ry({date:u.hT().required(),currencyId:u.Rx().required(),vendorId:u.Rx().required()}),items:u.IX().of(lg)}),onSubmit:async e=>{let l={header:{...e.header,date:(0,n.ku)(e.header.date),tdPct:e.header.tdPct||0,tdAmount:e.header.tdAmount||0},items:e.items.filter(e=>{var l;return null===(l=Object.values(lF))||void 0===l?void 0:l.every(l=>l(e))}).map(e=>{let{id:l,isVattable:t,taxDetails:d,...a}=e;return{...a,seqNo:l,applyVat:t,deliveryDate:a.deliveryDate?(0,n.ku)(a.deliveryDate):null}})},t=await le({extension:q.y.PurchaseOrder.set2,record:JSON.stringify(l)});c.ZP.success((null==e?void 0:e.recordId)?lt.Edited:lt.Added),await l5(t.recordId),lb()}});async function lV(e){var l;let t=await e7({extension:q.y.DocumentTypeDefault.get,parameters:"_dtId=".concat(e)});lA.setFieldValue("header.plantId",(null==t?void 0:null===(l=t.record)||void 0===l?void 0:l.plantId)||lh)}let lk=!!lA.values.header.recordId;async function lq(e,l){if(!e)return;let t=(null==ln?void 0:ln.filter(e=>e.msId===l))||[];lr.current=t}let lj=[{component:"resourcelookup",label:lv.sku,name:"sku",flex:2,props:{endpointId:f.$.Item.snapshot,parameters:{_categoryId:0,_msId:0,_startAt:0,_size:1e3},filter:{purchaseItem:!0},displayField:"sku",valueField:"sku",mapping:[{from:"recordId",to:"itemId"},{from:"sku",to:"sku"},{from:"name",to:"itemName"},{from:"msId",to:"msId"},{from:"isInactive",to:"isInactive"}],columnsInDropDown:[{key:"sku",value:"SKU"},{key:"name",value:"Name"},{key:"flName",value:"FL Name"}],displayFieldWidth:5,minChars:2},async onChange(e){let{row:{update:l,newRow:t}}=e;if(!(null==t?void 0:t.itemId)){l({enabled:!1});return}if(t.isInactive){l({...lA.initialValues.items[0],id:t.id}),lc({message:lv.inactiveItem});return}lq(null==t?void 0:t.itemId,null==t?void 0:t.msId),l(await lJ(t.itemId))}},{component:"textfield",label:lv.itemName,name:"itemName",flex:3,props:{readOnly:!0}},{component:"resourcecombobox",label:lv.mu,name:"muRef",props:{store:null==lr?void 0:lr.current,displayField:"reference",valueField:"recordId",mapping:[{from:"reference",to:"muRef"},{from:"qty",to:"muQty"},{from:"recordId",to:"muId"}]},async onChange(e){let{row:{update:l,newRow:t}}=e;if(t){let e=null==lr?void 0:lr.current.filter(e=>e.recordId===(null==t?void 0:t.muId));l({qtyInBase:(null==t?void 0:t.qty)*(null==e?void 0:e.muQty),muQty:null==t?void 0:t.muQty})}},propsReducer(e){let{props:l}=e;return{...l,store:null==lr?void 0:lr.current}}},{component:"numberfield",label:lv.quantity,name:"qty",updateOn:"blur",props:{decimalScale:3},async onChange(e){let{row:{update:l,newRow:t}}=e;l(lX(t,T.bT))}},{component:"numberfield",label:lv.volume,name:"volume",props:{decimalScale:2,readOnly:!0}},{component:"numberfield",label:lv.weight,name:"weight",props:{decimalScale:2,readOnly:!0}},{component:"numberfield",label:lv.baseprice,name:"basePrice",updateOn:"blur",props:{decimalScale:5},async onChange(e){let{row:{update:l,newRow:t}}=e;l(lX(t,T.yO))}},{component:"textfield",label:lv.requestRef,name:"requestRef",props:{readOnly:!0}},{component:"numberfield",label:lv.unitCost,name:"unitPrice",updateOn:"blur",props:{decimalScale:3},async onChange(e){let{row:{update:l,newRow:t}}=e;l(lX(t,T.Xf))}},{component:"button",name:"costHistory",props:{imgSrc:t(32631).default.src,onCondition:e=>({disabled:!e.itemId})},label:lv.costHistory,onClick:(e,l)=>{ll({Component:_.Z,props:{itemId:null==l?void 0:l.itemId,obj:l}})}},{component:"numberfield",label:lv.VAT,name:"vatAmount",props:{decimalScale:2,readOnly:!0}},{component:"button",name:"taxDetails",props:{onCondition:e=>e.itemId&&e.taxId?{imgSrc:t(54022).default.src,hidden:!1}:{imgSrc:"",hidden:!0}},label:lv.tax,onClick:(e,l)=>{ll({Component:M.Z,props:{taxId:null==l?void 0:l.taxId,obj:l}})}},{component:"numberfield",label:lv.markdown,name:"mdAmount",updateOn:"blur",flex:2,props:{decimalScale:2,ShowDiscountIcons:!0,iconsClicked:lC,type:"numeric",iconKey:e=>{let{value:l,data:t}=e;return((null==l?void 0:l.mdType)||(null==t?void 0:t.mdType))===T.Xo?"%":"123"}},async onChange(e){let{row:{update:l,newRow:t}}=e;l(lX(t,T.On))}},{component:"numberfield",label:lv.extendedCost,name:"extendedPrice",updateOn:"blur",props:{decimalScale:2},async onChange(e){let{row:{update:l,newRow:t}}=e;l(lX(t,T.bh))}},{component:"textfield",label:lv.notes,name:"notes"},{component:"date",label:lv.deliveryDate,name:"deliveryDate"}];function lw(e,l,t){let d=parseFloat(e)||0;return l===t?(d<0||d>100)&&(d=0):d<0&&(d=0),d}async function lC(e){let{updateRow:l,value:t,data:d}=e,a=((null==t?void 0:t.mdType)||(null==d?void 0:d.mdType))===T.Xo?T.RD:T.Xo,n=lw(null==t?void 0:t.mdAmount,a,T.Xo);l({id:d.id,changes:{mdAmount:n,mdAmountPct:a,mdType:a},commitOnBlur:!0})}console.log(lA);let lD=async()=>{await le({extension:q.y.PurchaseOrder.transfer,record:JSON.stringify({...lA.values.header,date:(0,n.ku)(lA.values.header.date)})}).then(()=>{var e;c.ZP.success(lt.Posted),lb(),l5(null==lA?void 0:null===(e=lA.values)||void 0===e?void 0:e.header.recordId)})},lZ=async()=>{await le({extension:q.y.PurchaseOrder.terminate,record:JSON.stringify({...lA.values.header,date:(0,n.ku)(lA.values.header.date)})}).then(()=>{var e;c.ZP.success(lt.Saved),lb(),l5(null==lA?void 0:null===(e=lA.values)||void 0===e?void 0:e.header.recordId)})},lT=async()=>{await le({extension:q.y.PurchaseOrder.close,record:JSON.stringify({...lA.values.header,date:(0,n.ku)(lA.values.header.date)})}).then(()=>{var e;c.ZP.success(lt.Closed),lb(),l5(null==lA?void 0:null===(e=lA.values)||void 0===e?void 0:e.header.recordId)})},lO=async()=>{await le({extension:q.y.PurchaseOrder.reopen,record:JSON.stringify({...lA.values.header,date:(0,n.ku)(lA.values.header.date)})}).then(()=>{var e;c.ZP.success(lt.Reopened),lb(),l5(null==lA?void 0:null===(e=lA.values)||void 0===e?void 0:e.header.recordId)})};async function lN(){let e=await lA.validateForm();if(Object.keys(e).length){var l;let t=Object.keys((null==e?void 0:e.header)||{}).reduce((e,l)=>((lA.touched.header||{})[l]||(e[l]=!0),e),{}),d=null==e?void 0:null===(l=e.items)||void 0===l?void 0:l.reduce((e,l,t)=>((lA.touched.items||[])[t]||(e[t]=!0),e),{});d&&(Object.keys(t).length||Object.keys(d).length)&&lA.setTouched({...lA.touched,header:t,items:d},!0)}}let lS=2===lA.values.header.wip,lR=[{key:"RecordRemarks",condition:!0,onClick:"onRecordRemarks",disabled:!lk},{key:"WorkFlow",condition:!0,onClick:()=>{ll({Component:C.Z,props:{functionId:ls,recordId:lA.values.header.recordId}})},disabled:!lk},{key:"Terminate",condition:!0,onClick:()=>{ll({Component:L.Z,props:{DialogText:lt.terminateConfirmation,okButtonAction:async()=>{await lZ()},fullScreen:!1,close:!0},width:500,height:150,title:lt.Confirmation})},disabled:!((2==lA.values.header.deliveryStatus||1==lA.values.header.deliveryStatus)&&4==lA.values.header.status)},{key:"Invoice",condition:!0,onClick:lD,disabled:!(3!==lA.values.header.status&&lS&&4===lA.values.header.status)},{key:"Close",condition:!lS,onClick:lT,disabled:lS||!lk},{key:"Reopen",condition:lS,onClick:lO,disabled:!lS||4===lA.values.header.deliveryStatus||3==lA.values.header.status||!lk},{key:"Attachment",condition:!0,onClick:"onClickAttachment",disabled:!lk},{key:"Approval",condition:!0,onClick:"onApproval",disabled:!lS}];async function l_(e){var l;let t=null==e?void 0:e.header,d=null==e?void 0:e.items;(null==t?void 0:t.tdType)===1||(null==t?void 0:t.tdType)==null?lx({text:"123",value:1}):lx({text:"%",value:2});let a=await Promise.all(null==d?void 0:d.map(async(e,l)=>{let t=(null==e?void 0:e.taxId)&&await lB(e.taxId);return{...e,id:l+1,basePrice:e.basePrice?e.basePrice:0,unitPrice:e.unitPrice?e.unitPrice:0,vatAmount:e.vatAmount?e.vatAmount:0,extendedPrice:e.extendedPrice?e.extendedPrice:0,deliveryDate:(0,n.a1)(e.deliveryDate),puTrx:!0,taxDetails:t}}));lA.setValues({recordId:t.recordId||null,dtId:t.dtId||null,currentDiscount:(null==t?void 0:t.tdType)==1||(null==t?void 0:t.tdType)==null?null==t?void 0:t.tdAmount:null==t?void 0:t.tdPct,header:{...lA.values.header,...t,amount:parseFloat(null==t?void 0:t.amount).toFixed(2),date:(0,n.a1)(null==t?void 0:t.date),deliveryDate:(null==t?void 0:t.deliveryDate)&&(0,n.a1)(null==t?void 0:t.deliveryDate)},items:a.length>0?a:null==lA?void 0:null===(l=lA.initialValues)||void 0===l?void 0:l.items})}async function lM(e){return(await e7({extension:q.y.PurchaseOrder.get2,parameters:"_poId=".concat(e)})).record}let lQ=async()=>await e7({extension:f.$.MeasurementUnit.qry,parameters:"_msId=0"});async function lW(e){let l=(null==e?void 0:e.tradeDiscount)?N.a$:lA.values.header.tdType;l==N.a$&&lx({text:"%",value:2}),lA.setValues({...lA.values,currentDiscount:(null==e?void 0:e.tradeDiscount)||0,header:{...lA.values.header,vendorId:null==e?void 0:e.recordId,vendorName:null==e?void 0:e.name,vendorRef:null==e?void 0:e.reference,isVattable:(null==e?void 0:e.isTaxable)||!1,tdAmount:null==e?void 0:e.tradeDiscount,tdPct:null==e?void 0:e.tradeDiscount,tdType:l,taxId:null==e?void 0:e.taxId,paymentMethod:null==e?void 0:e.paymentMethod}})}async function lE(e){let l=await e7({extension:f.$.ItemPhysProp.get,parameters:"_itemId=".concat(e)});return null==l?void 0:l.record}async function lL(e){let l=await e7({extension:f.$.Item.get,parameters:"_recordId=".concat(e)});return null==l?void 0:l.record}async function lB(e){let l=await e7({extension:j.H.TaxDetailPack.qry,parameters:"_taxId=".concat(e)});return null==l?void 0:l.list}async function lH(e){let{vendorId:l,currencyId:t}=lA.values.header,d=await e7({extension:q.y.VendorPrice.get,parameters:"_itemId=".concat(e,"&_vendorId=").concat(l,"&_currencyId=").concat(t,"&_functionId=").concat(ls)});return null==d?void 0:d.record}async function l$(e,l,t){var d,a,n,i,r,o;let u=(null==e?void 0:e.weight)||0,s=null!==(i=null==e?void 0:e.metalPurity)&&void 0!==i?i:0,c=null!==(r=null==e?void 0:e.isMetal)&&void 0!==r&&r,v=null!==(o=null==e?void 0:e.metalId)&&void 0!==o?o:null,m=t?t.priceList:0,h=t?t.baseLaborPrice:0,y=null,p=null;if(lA.values.header.taxId){let e=(await lB(lA.values.header.taxId)).map(e=>({invoiceId:lA.values.recordId||0,taxSeqNo:e.seqNo,taxId:lA.values.header.taxId,taxCodeId:e.taxCodeId,taxBase:e.taxBase,amount:e.amount}));y=lA.values.header.taxId,p=e}else if(l.taxId){let e=(await lB(l.taxId)).map(e=>({invoiceId:lA.values.recordId||0,taxSeqNo:e.seqNo,taxId:l.taxId,taxCodeId:e.taxCodeId,taxBase:e.taxBase,amount:e.amount}));y=l.taxId,p=e}let x=null==ln?void 0:ln.filter(e=>e.msId===(null==l?void 0:l.msId));return{sku:(null==l?void 0:l.sku)||"",itemName:(null==l?void 0:l.name)||"",itemId:(null==l?void 0:l.recordId)||null,isMetal:c,metalId:v,metalPurity:s,volume:(null==e?void 0:e.volume)||0,weight:u,basePrice:0,baseLaborPrice:h,TotPricePerG:h,unitPrice:m,priceType:(null==l?void 0:l.priceType)||1,qty:0,msId:null==l?void 0:l.msId,muRef:null==x?void 0:null===(d=x[0])||void 0===d?void 0:d.reference,muId:null==x?void 0:null===(a=x[0])||void 0===a?void 0:a.recordId,muQty:null==x?void 0:null===(n=x[0])||void 0===n?void 0:n.qty,mdAmount:0,mdValue:0,mdType:1,extendedPrice:0,mdValue:0,taxId:y,taxDetails:p}}async function lJ(e,l){let t=await lE(e),d=await lL(e),a=l?"":await lH(e);return await l$(t,d,a)}async function lB(e){let l=await e7({extension:j.H.TaxDetailPack.qry,parameters:"_taxId=".concat(e)});return null==l?void 0:l.list}function lX(e,l,t){var d,a,n,i,r;lo||lu(!0);let o=lw(null==e?void 0:e.mdAmount,null==e?void 0:e.mdType,T.Xo),u=(0,T.Ch)({priceType:null==e?void 0:e.priceType,basePrice:(null==e?void 0:e.basePrice)||0,volume:(null==e?void 0:e.volume)||0,weight:null==e?void 0:e.weight,unitPrice:(null==e?void 0:e.unitPrice)||0,upo:0,qty:null==e?void 0:e.qty,extendedPrice:null==e?void 0:e.extendedPrice,mdAmount:o,mdType:null==e?void 0:e.mdType,mdValue:null==e?void 0:e.mdValue,baseLaborPrice:0,totalWeightPerG:(null==e?void 0:e.totalWeightPerG)||0,tdPct:(null==lA?void 0:null===(a=lA.values)||void 0===a?void 0:null===(d=a.header)||void 0===d?void 0:d.tdPct)||0,dirtyField:l});(null==e?void 0:null===(n=e.taxDetails)||void 0===n?void 0:n.length)>0&&(e.taxDetails=[e.taxDetails[0]]);let s=(0,O.VW)({priceType:null==u?void 0:u.priceType,basePrice:null==u?void 0:u.basePrice,unitPrice:null==u?void 0:u.unitPrice,qty:null==u?void 0:u.qty,weight:null==u?void 0:u.weight,extendedPrice:null==u?void 0:u.extendedPrice,baseLaborPrice:null==u?void 0:u.baseLaborPrice,vatAmount:(null==u?void 0:u.vatAmount)||0,tdPct:null==lA?void 0:null===(r=lA.values)||void 0===r?void 0:null===(i=r.header)||void 0===i?void 0:i.tdPct,taxDetails:!0===lA.values.header.isVattable?e.taxDetails:null}),c=(null==u?void 0:u.qty)*(null==e?void 0:e.muQty),v={...e,id:null==e?void 0:e.id,qty:(null==u?void 0:u.qty)?null==u?void 0:u.qty:0,baseQty:c||0,volume:(null==u?void 0:u.volume)?u.volume:0,weight:(null==u?void 0:u.weight)?u.weight:0,basePrice:(null==u?void 0:u.basePrice)?u.basePrice:0,unitPrice:(null==u?void 0:u.unitPrice)?u.unitPrice:0,extendedPrice:(null==u?void 0:u.extendedPrice)?u.extendedPrice:0,mdValue:null==u?void 0:u.mdValue,mdType:null==u?void 0:u.mdType,mdAmount:(null==u?void 0:u.mdAmount)?u.mdAmount:0,vatAmount:(null==s?void 0:s.vatAmount)?s.vatAmount:0};return t?{changes:v}:v}let lU=null===(G=lA.values.items)||void 0===G?void 0:G.filter(e=>void 0!==e.itemId).map(e=>({...e,basePrice:e.basePrice||0,unitPrice:e.unitPrice||0,vatAmount:(null==e?void 0:e.vatAmount)?e.vatAmount:0,weight:e.weight||0,volume:e.volume||0,extendedPrice:e.extendedPrice||0})),lG=(0,N.Ww)(lU),lY=0==lA.values.miscAmount?0:parseFloat(lA.values.header.miscAmount),lz=(0,N.Ot)(lU,{totalQty:0,totalWeight:0,totalVolume:0,sumVat:0,sumExtended:parseFloat(lG),tdAmount:parseFloat(lA.values.header.tdAmount),net:0,miscAmount:lY||0}),lK=lo?null==lz?void 0:lz.totalQty:(null===(z=lA.values)||void 0===z?void 0:null===(Y=z.header)||void 0===Y?void 0:Y.qty)||0,l0=lo?null==lz?void 0:lz.net:(null===(K=lA.values)||void 0===K?void 0:K.header.amount)||0,l2=lo?null==lz?void 0:lz.totalVolume:(null===(ee=lA.values)||void 0===ee?void 0:ee.header.volume)||0,l1=lo?null==lz?void 0:lz.totalWeight:(null===(el=lA.values)||void 0===el?void 0:el.header.weight)||0,l3=lo?lG:(null===(et=lA.values)||void 0===et?void 0:et.header.subtotal)||0,l6=lo?null==lz?void 0:lz.sumVat:(null===(ed=lA.values)||void 0===ed?void 0:ed.header.vatAmount)||0;async function l9(e,l,t,d){var a;a=function(e,l,t,d){var a;let n=(0,N.Yi)({tdAmount:parseFloat(d),tdPlain:1==e,tdPct:2==e,tdType:e,subtotal:l3,currentDiscount:d,hiddenTdPct:l,hiddenTdAmount:parseFloat(t),typeChange:e});return lA.setFieldValue("header.tdAmount",(null==n?void 0:n.hiddenTdAmount)?null==n?void 0:null===(a=n.hiddenTdAmount)||void 0===a?void 0:a.toFixed(2):0),lA.setFieldValue("header.tdType",null==n?void 0:n.tdType),lA.setFieldValue("currentDiscount",(null==n?void 0:n.currentDiscount)||0),lA.setFieldValue("header.tdPct",(null==n?void 0:n.hiddenTdPct)||0),null==n?void 0:n.hiddenTdPct}(e,l,t,d),lA.values.items.map((e,l)=>{var t;if((null==e?void 0:null===(t=e.taxDetails)||void 0===t?void 0:t.length)>0&&(e.taxDetails=[e.taxDetails[0]]),!e.requestId){let t=(0,O.VW)({priceType:null==e?void 0:e.priceType,basePrice:null==e?void 0:e.basePrice,qty:null==e?void 0:e.qty,weight:null==e?void 0:e.weight,extendedPrice:null==e?void 0:e.extendedPrice,baseLaborPrice:parseFloat(null==e?void 0:e.baseLaborPrice),vatAmount:null==e?void 0:e.vatAmount,tdPct:a,taxDetails:!0===lA.values.header.isVattable?e.taxDetails:null});lA.setFieldValue("items[".concat(l,"].vatAmount"),null==t?void 0:t.vatAmount)}})}async function l5(e){let l=await lM(e);l&&l_(l)}(0,o.useEffect)(()=>{lA.setFieldValue("header.qty",parseFloat(lK).toFixed(2)),lA.setFieldValue("header.weight",parseFloat(l1).toFixed(2)),lA.setFieldValue("header.volume",parseFloat(l2).toFixed(2)),lA.setFieldValue("header.amount",parseFloat(l0).toFixed(2)),lA.setFieldValue("header.subtotal",parseFloat(l3).toFixed(2)),lA.setFieldValue("header.vatAmount",parseFloat(l6).toFixed(2))},[lK,l0,l2,l1,l3,l6]),(0,o.useEffect)(()=>{if(lo){let e=2===lA.values.header.tdType?parseFloat(lA.values.header.tdPct)*parseFloat(l3)/100:parseFloat(lA.values.header.tdAmount);l9(lA.values.header.tdType,lA.values.header.tdPct,e,lA.values.currentDiscount)}},[l3]),(0,o.useEffect)(()=>{!async function(){let e=await lQ();li(null==e?void 0:e.list)}()},[]),(0,o.useEffect)(()=>{var e,l;(null===(e=lA.values)||void 0===e?void 0:e.header.dtId)&&!e8&&lV(null===(l=lA.values)||void 0===l?void 0:l.header.dtId)},[null===(ea=lA.values)||void 0===ea?void 0:ea.header.dtId]),(0,o.useEffect)(()=>{!async function(){if(e8&&ln){let e=await lM(e8);await l_(e)}}()},[e8,ln]);let l8=async()=>{var e;let l=null===(e=(await e7({extension:q.y.QuotationItem.preview,parameters:"_requestId=".concat(lA.values.requestId,"&_vendorId=").concat(lA.values.header.vendorId)})).list)||void 0===e?void 0:e.reduce((e,l)=>{var t,d;return e[l.requestSeqNo]={unitPrice:null===(t=parseFloat(l.unitPrice))||void 0===t?void 0:t.toFixed(2),basePrice:null===(d=parseFloat(l.unitPrice))||void 0===d?void 0:d.toFixed(2)},e},{});lA.values.items.forEach((e,t)=>{let{unitPrice:d,basePrice:a}=l[null==e?void 0:e.requestSeqNo]||{};void 0!==d&&(lA.setFieldValue("items[".concat(t,"].unitPrice"),d),lA.setFieldValue("items[".concat(t,"].basePrice"),a),lA.setFieldValue("items[".concat(t,"].vatAmount"),0),lA.setFieldValue("items[".concat(t,"].extendedPrice"),d*e.qty||0))})},l4=async()=>{var e,l,t,d;if(lN(),Object.entries((null==lA?void 0:lA.errors.header)||{}).filter(e=>{let[l]=e;return l}).length>0)return;if(!lA.values.header.vendorId){lA.setFieldTouched("header.vendorId",!0);return}let a=await e7({extension:q.y.RequisitionDetail.qry,parameters:"_trxId=".concat(lA.values.requestId)});if(a.list.length<1){lc({message:lv.noItemsToImport});return}if(lA.values.items.find(e=>e.requestId==lA.values.requestId)){lc({message:lv.allItemsAreImported});return}lA.setFieldValue("import",!0);let i=lA.values.items.length&&(null===(e=lA.values.items[0])||void 0===e?void 0:e.sku)?(null===(l=lA.values.items)||void 0===l?void 0:l.length)+1:1,r=await Promise.all(a.list.map(async e=>{let l=await lJ(e.itemId,!0),t=["muId","isMetal","metalPurity","msId","muRef","muQty","metalId","baseLaborPrice","TotPricePerG"],d=Object.keys(l).filter(e=>!t.includes(e)).reduce((e,t)=>(e[t]=l[t],e),{});return{id:i++,...d,qty:e.baseQty,requestRef:lA.values.requestRef,requestId:lA.values.requestId,deliveryDate:(0,n.a1)(e.deliveryDate),requestSeqNo:e.seqNo,unitPrice:0,vatAmount:0,baseQty:0,mdAmountPct:1}}));lA.setFieldValue("items",(null===(t=lA.values.items)||void 0===t?void 0:t.length)>0&&(null===(d=lA.values.items[0])||void 0===d?void 0:d.sku)?[...lA.values.items,...r]:r)};return(0,d.jsx)(s.Z,{resourceId:h.i.PurchaseTransactions,form:lA,functionId:ls,maxAccess:lf,previewReport:lk,actions:lR,editMode:lk,disabledSubmit:lS,children:(0,d.jsxs)(A.R,{children:[(0,d.jsx)(V.g,{children:(0,d.jsxs)(i.ZP,{container:!0,spacing:2,children:[(0,d.jsx)(i.ZP,{item:!0,xs:3,children:(0,d.jsxs)(i.ZP,{container:!0,spacing:2,children:[(0,d.jsx)(i.ZP,{item:!0,xs:12,children:(0,d.jsx)(x.Z,{endpointId:I.r.DocumentType.qry,parameters:"_startAt=0&_pageSize=1000&_dgId=".concat(P.J.PurchaseOrder),name:"header.dtId",readOnly:lk,label:lv.documentType,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],valueField:"recordId",displayField:["reference","name"],values:lA.values.header,maxAccess:lf,onChange:(e,l)=>{(null==l?void 0:l.recordId)&&lA.setFieldTouched("header.dtId",!1),lA.setFieldValue("header.dtId",(null==l?void 0:l.recordId)||null)},error:(null===(en=lA.touched.header)||void 0===en?void 0:en.dtId)&&!!(null===(ei=lA.errors.header)||void 0===ei?void 0:ei.dtId)})}),(0,d.jsx)(i.ZP,{item:!0,xs:12,children:(0,d.jsx)(y.Z,{name:"header.reference",label:lv.reference,value:null==lA?void 0:null===(eo=lA.values)||void 0===eo?void 0:null===(er=eo.header)||void 0===er?void 0:er.reference,maxAccess:!lk&&lf,readOnly:lk,onChange:lA.handleChange,onClear:()=>lA.setFieldValue("header.reference",""),error:(null===(eu=lA.touched.header)||void 0===eu?void 0:eu.reference)&&!!(null===(es=lA.errors.header)||void 0===es?void 0:es.reference)})}),(0,d.jsx)(i.ZP,{item:!0,xs:12,children:(0,d.jsx)(b.U,{endpointId:q.y.Vendor.snapshot,name:"header.vendorId",label:lv.vendor,valueField:"reference",displayField:"name",valueShow:"vendorRef",secondValueShow:"vendorName",formObject:lA.values.header,form:lA,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"},{key:"flName",value:"FL Name"}],onChange:(e,l)=>lW(l),secondFieldName:"header.vendorName",onSecondValueChange:(e,l)=>lA.setFieldValue("header.vendorName",l),errorCheck:"header.vendorId",maxAccess:lf,required:!0,readOnly:lS||(null==lA?void 0:null===(ev=lA.values)||void 0===ev?void 0:null===(ec=ev.items)||void 0===ec?void 0:ec.length)>0&&(null==lA?void 0:null===(eh=lA.values)||void 0===eh?void 0:null===(em=eh.items[0])||void 0===em?void 0:em.sku),displayFieldWidth:3})}),(0,d.jsx)(i.ZP,{item:!0,xs:12,children:(0,d.jsx)(b.U,{endpointId:q.y.PurchaseRequisition.snapshot,name:"requestId",label:lv.requisition,filter:{status:4},valueField:"reference",valueShow:"requestRef",formObject:lA.values,form:lA,secondDisplayField:!1,onChange:(e,l)=>{lA.setFieldValue("requestId",(null==l?void 0:l.recordId)||null),lA.setFieldValue("requestRef",(null==l?void 0:l.reference)||"")},errorCheck:"requestId",maxAccess:lf,readOnly:lS})})]})}),(0,d.jsx)(i.ZP,{item:!0,xs:3,children:(0,d.jsxs)(i.ZP,{container:!0,spacing:2,children:[(0,d.jsx)(i.ZP,{item:!0,xs:12,children:(0,d.jsx)(a.Z,{name:"header.date",required:!0,label:lv.date,readOnly:lS,value:null==lA?void 0:null===(ep=lA.values)||void 0===ep?void 0:null===(ey=ep.header)||void 0===ey?void 0:ey.date,onChange:(e,l)=>lA.setFieldValue("header.date",l),editMode:lk,maxAccess:lf,onClear:()=>lA.setFieldValue("header.date",null),error:(null===(eI=lA.touched)||void 0===eI?void 0:null===(ex=eI.header)||void 0===ex?void 0:ex.date)&&!!(null===(eP=lA.errors)||void 0===eP?void 0:null===(ef=eP.header)||void 0===ef?void 0:ef.date)})}),(0,d.jsx)(i.ZP,{item:!0,xs:12,children:(0,d.jsx)(x.Z,{endpointId:I.r.Currency.qry,name:"header.currencyId",label:lv.currency,valueField:"recordId",displayField:["reference","name"],readOnly:lS,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],required:!0,values:lA.values.header,maxAccess:lf,onChange:(e,l)=>lA.setFieldValue("header.currencyId",(null==l?void 0:l.recordId)||null),error:(null===(eg=lA.touched)||void 0===eg?void 0:null===(eb=eg.header)||void 0===eb?void 0:eb.currencyId)&&!!(null===(eA=lA.errors)||void 0===eA?void 0:null===(eF=eA.header)||void 0===eF?void 0:eF.currencyId)})}),(0,d.jsx)(i.ZP,{item:!0,xs:12}),(0,d.jsx)(i.ZP,{item:!0,xs:12}),(0,d.jsx)(i.ZP,{item:!0,xs:12}),(0,d.jsx)(i.ZP,{item:!0,xs:12}),(0,d.jsx)(i.ZP,{item:!0,xs:12}),(0,d.jsx)(i.ZP,{item:!0,xs:2,children:(0,d.jsx)(W.Z,{onClick:()=>l4(),color:"#231f20",tooltipText:lt.import,disabled:!lA.values.requestId,image:"import.png"})}),(0,d.jsx)(i.ZP,{item:!0,xs:2,children:(0,d.jsx)(W.Z,{onClick:()=>l8(),color:"#3D6186",tooltipText:lt.Preview,disabled:!lA.values.import||!lA.values.requestId,image:"quotation-icon.png"})}),(0,d.jsx)(i.ZP,{item:!0,xs:8})]})}),(0,d.jsx)(i.ZP,{item:!0,xs:3,children:(0,d.jsxs)(i.ZP,{container:!0,spacing:2,children:[(0,d.jsx)(i.ZP,{item:!0,xs:12,children:(0,d.jsx)(x.Z,{endpointId:I.r.Plant.qry,name:"header.plantId",label:lv.plant,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],readOnly:lS,values:lA.values.header,valueField:"recordId",displayField:["reference","name"],maxAccess:lf,onChange:(e,l)=>lA.setFieldValue("header.plantId",(null==l?void 0:l.recordId)||null),displayFieldWidth:2,error:(null===(eV=lA.touched.header)||void 0===eV?void 0:eV.plantId)&&!!(null===(ek=lA.errors.header)||void 0===ek?void 0:ek.plantId)})}),(0,d.jsx)(i.ZP,{item:!0,xs:12,children:(0,d.jsx)(x.Z,{datasetId:R.v.PAYMENT_METHOD,name:"header.paymentMethod",readOnly:lS,label:lv.paymentMethod,valueField:"key",displayField:"value",values:lA.values.header,onChange:(e,l)=>lA.setFieldValue("header.paymentMethod",(null==l?void 0:l.key)||null),error:(null===(eq=lA.touched.header)||void 0===eq?void 0:eq.paymentMethod)&&!!(null===(ej=lA.errors.header)||void 0===ej?void 0:ej.paymentMethod),maxAccess:lf})}),(0,d.jsx)(i.ZP,{item:!0,xs:12,children:(0,d.jsx)(x.Z,{endpointId:j.H.TaxSchedules.qry,name:"header.taxId",label:lv.tax,valueField:"recordId",displayField:["name"],readOnly:!(null===(eC=lA.values)||void 0===eC?void 0:null===(ew=eC.header)||void 0===ew?void 0:ew.isVattable)||(null==lA?void 0:null===(eZ=lA.values)||void 0===eZ?void 0:null===(eD=eZ.items)||void 0===eD?void 0:eD.length)>0&&(null==lA?void 0:null===(eO=lA.values)||void 0===eO?void 0:null===(eT=eO.items[0])||void 0===eT?void 0:eT.sku),values:lA.values.header,onChange:(e,l)=>lA.setFieldValue("header.taxId",(null==l?void 0:l.recordId)||null),error:(null===(eN=lA.touched.header)||void 0===eN?void 0:eN.taxId)&&!!(null===(eS=lA.errors.header)||void 0===eS?void 0:eS.taxId),maxAccess:lf})}),(0,d.jsx)(i.ZP,{item:!0,xs:12,children:(0,d.jsx)(y.Z,{name:"header.vendorDocRef",label:lv.vendorDocRef,value:null==lA?void 0:null===(e_=lA.values)||void 0===e_?void 0:null===(eR=e_.header)||void 0===eR?void 0:eR.vendorDocRef,maxAccess:lf,readOnly:lS,maxLength:"15",onChange:lA.handleChange,onClear:()=>lA.setFieldValue("header.vendorDocRef",""),error:(null===(eM=lA.touched.header)||void 0===eM?void 0:eM.vendorDocRef)&&!!(null===(eQ=lA.errors.header)||void 0===eQ?void 0:eQ.vendorDocRef)})})]})}),(0,d.jsx)(i.ZP,{item:!0,xs:3,children:(0,d.jsxs)(i.ZP,{container:!0,spacing:2,children:[(0,d.jsx)(i.ZP,{item:!0,xs:12,children:(0,d.jsx)(a.Z,{name:"header.deliveryDate",label:lv.deliveryDate,readOnly:lS,value:null==lA?void 0:null===(eE=lA.values)||void 0===eE?void 0:null===(eW=eE.header)||void 0===eW?void 0:eW.deliveryDate,onChange:(e,l)=>lA.setFieldValue("header.deliveryDate",l),editMode:lk,maxAccess:lf,onClear:()=>lA.setFieldValue("header.deliveryDate",""),error:(null===(eB=lA.touched)||void 0===eB?void 0:null===(eL=eB.header)||void 0===eL?void 0:eL.deliveryDate)&&!!(null===(e$=lA.errors)||void 0===e$?void 0:null===(eH=e$.header)||void 0===eH?void 0:eH.deliveryDate)})}),(0,d.jsx)(i.ZP,{item:!0,xs:12,children:(0,d.jsx)(x.Z,{endpointId:q.y.DeliveryMethods.qry,name:"header.deliveryMethodId",label:lv.deliveryMethod,readOnly:lS,valueField:"recordId",displayField:["name"],values:lA.values.header,onChange:(e,l)=>lA.setFieldValue("header.deliveryMethodId",(null==l?void 0:l.recordId)||null),error:(null===(eJ=lA.touched.header)||void 0===eJ?void 0:eJ.deliveryMethodId)&&!!(null===(eX=lA.errors.header)||void 0===eX?void 0:eX.deliveryMethodId),maxAccess:lf})}),(0,d.jsx)(i.ZP,{item:!0,xs:12,children:(0,d.jsx)(x.Z,{endpointId:q.y.PaymentTerms.qry,name:"header.ptId",label:lv.paymentTerms,readOnly:lS,valueField:"recordId",displayField:["name"],values:lA.values.header,onChange:(e,l)=>lA.setFieldValue("header.ptId",(null==l?void 0:l.recordId)||null),error:(null===(eU=lA.touched.header)||void 0===eU?void 0:eU.ptId)&&!!(null===(eG=lA.errors.header)||void 0===eG?void 0:eG.ptId),maxAccess:lf})}),(0,d.jsx)(i.ZP,{item:!0,xs:6,children:(0,d.jsx)(Q.Z,{name:"header.isVattable",value:null===(ez=lA.values)||void 0===ez?void 0:null===(eY=ez.header)||void 0===eY?void 0:eY.isVattable,onChange:e=>lA.setFieldValue("header.isVattable",e.target.checked),label:lv.VAT,disabled:(null==lA?void 0:null===(eK=lA.values)||void 0===eK?void 0:eK.items)&&(null==lA?void 0:null===(e2=lA.values)||void 0===e2?void 0:null===(e0=e2.items[0])||void 0===e0?void 0:e0.itemId),maxAccess:lf})}),(0,d.jsx)(i.ZP,{item:!0,xs:6,children:(0,d.jsx)(Q.Z,{name:"header.exWorks",value:null===(e3=lA.values)||void 0===e3?void 0:null===(e1=e3.header)||void 0===e1?void 0:e1.exWorks,onChange:e=>lA.setFieldValue("header.exWorks",e.target.checked),label:lv.exWorks,disabled:lS,maxAccess:lf})})]})})]})}),(0,d.jsx)(g.Q,{children:(0,d.jsx)(F._,{onChange:(e,l)=>{lA.setFieldValue("items",e),"delete"===l&&lu(!0)},onSelectionChange:(e,l,t)=>{"muRef"==t&&lq(null==e?void 0:e.itemId,null==e?void 0:e.msId)},value:null==lA?void 0:null===(e6=lA.values)||void 0===e6?void 0:e6.items,initialValues:lA.initialValues.items[0],error:lA.errors.items,allowDelete:!lS,name:"items",columns:lj,maxAccess:lf,disabled:lS||!lA.values.header.vendorId||!lA.values.header.vendorId||Object.entries((null==lA?void 0:lA.errors)||{}).filter(e=>{let[l]=e;return"items"!==l}).length>0,onValidationRequired:lN})}),(0,d.jsx)(V.g,{children:(0,d.jsxs)(i.ZP,{container:!0,spacing:2,sx:{mt:"5px"},children:[(0,d.jsx)(i.ZP,{item:!0,xs:6,children:(0,d.jsx)(p.Z,{name:"header.description",label:lv.description,value:lA.values.header.description,rows:3,readOnly:lS,maxAccess:lf,onChange:e=>lA.setFieldValue("header.description",e.target.value),onClear:()=>lA.setFieldValue("header.description",""),error:(null===(e9=lA.touched.header)||void 0===e9?void 0:e9.description)&&!!(null===(e5=lA.errors.header)||void 0===e5?void 0:e5.description)})}),(0,d.jsx)(i.ZP,{item:!0,xs:3,children:(0,d.jsxs)(r.Z,{spacing:2,children:[(0,d.jsx)(k.Z,{name:"header.volume",maxAccess:lf,label:lv.totVolume,value:l2,readOnly:!0}),(0,d.jsx)(k.Z,{name:"header.qty",maxAccess:lf,label:lv.totQty,value:lK,readOnly:!0})]})}),(0,d.jsx)(i.ZP,{item:!0,xs:3,children:(0,d.jsxs)(r.Z,{spacing:2,children:[(0,d.jsx)(k.Z,{name:"header.subTotal",maxAccess:lf,label:lv.subtotal,value:l3,readOnly:!0}),(0,d.jsx)(k.Z,{name:"header.tdAmount",maxAccess:lf,label:lv.discount,value:lA.values.currentDiscount,displayCycleButton:!0,cycleButtonLabel:lp.text,decimalScale:2,readOnly:lS,iconKey:lp.text,handleButtonClick:()=>{let e,l,t;lu(!0);let d=lA.values.currentDiscount;1==lp.value?(e=parseFloat(l=d<0||d>100?0:d)*parseFloat(l3)/100,t=l,lA.setFieldValue("header.tdAmount",e),lA.setFieldValue("header.tdPct",l),lA.setFieldValue("currentDiscount",l)):(l=parseFloat(e=d<0||l3<d?0:d)/parseFloat(l3)*100,t=e,lA.setFieldValue("header.tdPct",l),lA.setFieldValue("header.tdAmount",e),lA.setFieldValue("currentDiscount",e)),lx(d=>{let a="%"===d.text?{text:"123",value:1}:{text:"%",value:2};return lA.setFieldValue("tdType",a.value),l9(a.value,l,e,t),a})},ShowDiscountIcons:!0,onChange:e=>{let l=Number(e.target.value.replace(/,/g,""));lA.values.header.tdType==N.a$?((l<0||l>100)&&(l=0),lA.setFieldValue("header.tdPct",l)):((l<0||lA.values.header.subtotal<l)&&(l=0),lA.setFieldValue("header.tdAmount",l)),lA.setFieldValue("currentDiscount",l)},onBlur:async e=>{let l=Number(e.target.value.replace(/,/g,"")),t=Number(e.target.value.replace(/,/g,"")),d=Number(e.target.value.replace(/,/g,""));lA.values.header.tdType==N.ER&&(t=parseFloat(l)/parseFloat(l3)*100,lA.setFieldValue("header.tdPct",t)),lA.values.header.tdType==N.a$&&(d=parseFloat(l)*parseFloat(l3)/100,lA.setFieldValue("header.tdAmount",d)),lu(!0),await l9(lA.values.header.tdType,t,d,l)},onClear:()=>{lA.setFieldValue("header.tdAmount",0),lA.setFieldValue("header.tdPct",0),l9(lA.values.header.tdType,0,0,0)}}),(0,d.jsx)(k.Z,{name:"header.miscAmount",maxAccess:lf,label:lv.misc,value:lA.values.header.miscAmount,decimalScale:2,readOnly:lS,onChange:e=>lA.setFieldValue("header.miscAmount",e.target.value||0),onBlur:async()=>{lu(!0)},onClear:()=>lA.setFieldValue("header.miscAmount",0)}),(0,d.jsx)(k.Z,{name:"header.vatAmount",maxAccess:lf,label:lv.VAT,value:l6,readOnly:!0}),(0,d.jsx)(k.Z,{name:"header.amount",maxAccess:lf,label:lv.net,value:l0,readOnly:!0})]})})]})})]})})}J.width=1330,J.height=720},61520:function(e,l,t){var d=t(52322),a=t(2784),n=t(69387),i=t(26612),r=t(71987),o=t(65950),u=t(31389),s=t(62362),c=t(2454),v=t(33625),m=t(60218),h=t(5088),y=t(19473),p=t(21326);let x=e=>{let{itemId:l,obj:t,window:x}=e,{getRequest:I}=(0,a.useContext)(o.$),{platformLabels:f}=(0,a.useContext)(y.l);(0,p.Z)({title:f.CostHistory,window:x});let{query:{data:P},labels:b,access:g}=(0,r.J)({queryFn:A,endpointId:c.y.ItemCostHistory.qry,datasetId:i.i.ItemCostHistory}),F=[{field:"date",headerName:b.date,flex:1,type:"date"},{field:"vendorName",headerName:b.vendor,flex:1},,{field:"currencyName",headerName:b.currency,flex:1},{field:"baseLaborPrice",headerName:b.baseLaborPrice,flex:1,type:"number"},{field:"unitPrice",headerName:b.unitPrice,flex:1,type:"number"},{field:"markdown",headerName:b.markdown,flex:1,type:"number"},{field:"tradeDiscount",headerName:b.tradeDiscount,flex:1,type:"number"}];async function A(){return await I({extension:c.y.ItemCostHistory.qry,parameters:"_itemId=".concat(l)})}return(0,d.jsxs)(u.R,{children:[(0,d.jsx)(v.g,{children:(0,d.jsxs)(m.ZP,{container:!0,spacing:2,sx:{p:2},children:[(0,d.jsx)(m.ZP,{item:!0,xs:5,children:(0,d.jsx)(h.Z,{label:b.sku,value:t.sku,readOnly:!0})}),(0,d.jsx)(m.ZP,{item:!0,xs:6}),(0,d.jsx)(m.ZP,{item:!0,xs:5,children:(0,d.jsx)(h.Z,{label:b.itemName,value:t.itemName,readOnly:!0})})]})}),(0,d.jsx)(s.Q,{children:(0,d.jsx)(n.Z,{columns:F,gridData:P,rowId:["recordId"],isLoading:!1,maxAccess:g,pagination:!1})})]})};x.width=1e3,l.Z=x},16096:function(e,l,t){t.d(l,{ER:function(){return d},Ot:function(){return u},Ww:function(){return o},Yi:function(){return i},a$:function(){return a}});let d=1,a=2,n=e=>{if(!0===e.tdPct){e.tdAmount>100?1===e.typeChange?e.tdAmount=0:e.tdAmount=e.currentDiscount:e.currentDiscount=e.tdAmount,e.hiddenTdPct=e.tdAmount;let l=e.subtotal*e.tdAmount/100;e.hiddenTdAmount=l,e.tdType=a}else if(e.tdAmount>e.subtotal)1===e.typeChange?e.tdAmount=0:e.tdAmount=e.currentDiscount;else{e.currentDiscount=e.tdAmount;let l=0===e.subtotal?0:100*e.tdAmount/e.subtotal;e.hiddenTdPct=l,e.hiddenTdAmount=e.tdAmount,e.tdType=d}return e},i=e=>e=n(e),r=(e,l)=>(e.forEach(e=>{l.totalQty+=parseFloat(e.qty),l.totalWeight+=e.qty*e.weight,l.totalVolume+=e.qty*e.volume,l.totalUpo+=e.upo,l.sumVat+=e.vatAmount}),l.net=l.sumExtended+l.sumVat+((null==l?void 0:l.miscAmount)||0)-((null==l?void 0:l.tdAmount)||0),l),o=e=>e.reduce((e,l)=>e+(Number(l.extendedPrice)||0),0),u=(e,l)=>l=r(e,l)}}]);