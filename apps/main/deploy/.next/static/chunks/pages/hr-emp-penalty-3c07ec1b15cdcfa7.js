(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[62813],{6039:function(e,n,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/hr-emp-penalty",function(){return a(30067)}])},30067:function(e,n,a){"use strict";a.r(n),a.d(n,{default:function(){return w}});var t=a(52322),l=a(2784),r=a(62202),o=a(69387),d=a(65950),s=a(71987),i=a(26612),c=a(31389),u=a(33625),m=a(62362),y=a(61802),p=a(19473),f=a(36908),v=a(92407),h=a(27423),x=a(60218),I=a(98345),g=a(7121),N=a(1838),w=()=>{let{getRequest:e,postRequest:n}=(0,l.useContext)(d.$),{platformLabels:a}=(0,l.useContext)(p.l),{stack:w}=(0,y.zY)(),[b,P]=(0,l.useState)({employeeId:null,employeeRef:"",employeeName:""});async function _(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{_startAt:a=0,_pageSize:t=50}=n;return{...await e({extension:v.y.EmployeePenalty.page,parameters:"_startAt=".concat(a,"&_pageSize=").concat(t,"&_size=50&_sortBy=date&_employeeId=").concat(b.employeeId||0)}),_startAt:a}}async function C(e){let{filters:n,pagination:a}=e;return _({_startAt:a._startAt||0,params:null==n?void 0:n.params})}let{query:{data:k},labels:S,paginationParameters:F,refetch:R,access:E,filterBy:j,invalidate:A}=(0,s.J)({queryFn:_,endpointId:v.y.EmployeePenalty.page,datasetId:i.i.EmployeePenalties,filter:{filterFn:C}}),Z=[{field:"reference",headerName:S.ref,flex:1},{field:"employeeName",headerName:S.empName,flex:1},{field:"penaltyName",headerName:S.penalty,flex:1},{field:"date",headerName:S.date,flex:1,type:"date"},{field:"amount",headerName:S.amount,flex:1,type:"number"},{field:"notes",headerName:S.notes,flex:1},{field:"statusName",headerName:S.status,flex:1},{field:"rsName",headerName:S.releaseStatus,flex:1},{field:"wipName",headerName:S.wip,flex:1}],O=async()=>{await V()},D=async e=>{await n({extension:v.y.EmployeePenalty.del,record:JSON.stringify(e)}),A(),r.ZP.success(a.Deleted)},{proxyAction:V}=(0,I.G)({functionId:g.J.Penalty,action:q,hasDT:!1});function q(e){w({Component:N.Z,props:{recordId:e}})}return(0,t.jsxs)(c.R,{children:[(0,t.jsx)(u.g,{children:(0,t.jsx)(f.Z,{onAdd:O,maxAccess:E,hasSearch:!1,filterBy:j,leftSection:(0,t.jsx)(x.ZP,{item:!0,xs:12,children:(0,t.jsx)(h.U,{endpointId:v.y.Employee.snapshot,parameters:{_branchId:0},filter:{activeStatus:1},valueField:"reference",displayField:"fullName",name:"employeeId",label:S.employee,secondFieldLabel:S.empName,formObject:b,displayFieldWidth:2,valueShow:"employeeRef",secondValueShow:"employeeName",columnsInDropDown:[{key:"reference",value:"Reference"},{key:"fullName",value:"Name"}],maxAccess:E,onChange:(e,n)=>{P({employeeId:(null==n?void 0:n.recordId)||null,employeeRef:(null==n?void 0:n.reference)||"",employeeName:(null==n?void 0:n.fullName)||""})}})})})}),(0,t.jsx)(m.Q,{children:(0,t.jsx)(o.Z,{name:"table",columns:Z,gridData:k,rowId:["recordId"],onEdit:e=>{q(null==e?void 0:e.recordId)},onDelete:D,pageSize:50,paginationType:"api",maxAccess:E,refetch:R,paginationParameters:F})})]})}},1685:function(e,n,a){"use strict";a.d(n,{m:function(){return t}});let t=e=>{let n=window.sessionStorage.getItem(e);return n?JSON.parse(n):null}},98345:function(e,n,a){"use strict";a.d(n,{H:function(){return f},G:function(){return p}});var t=a(45300),l=a(2784),r=a(96026),o=a(38449);a(26612);var d=a(65947),s=a(1685);let i=async(e,n,a)=>{try{let t=await e({extension:n,parameters:a});return n.includes("qry")?t:t.record}catch(e){return null}},c=(e,n,a,t)=>{let l=(e=JSON.parse(JSON.stringify(e))).record.controls,r=l.find(e=>"reference"===e.controlId);return r?r.accessLevel=(null==n?void 0:n.mandatory)?d.$7:d.rr:(null==n?void 0:n.mandatory)?l.push({sgId:0,resourceId:"",controlId:"".concat(t?t+".":"","reference"),accessLevel:(null==n?void 0:n.mandatory)?d.$7:d.rr}):(null==n?void 0:n.readOnly)?l.push({sgId:0,resourceId:"",controlId:"".concat(t?t+".":"","reference"),accessLevel:(null==n?void 0:n.readOnly)?d.rr:d.$7}):l=e.record.controls.filter(e=>"reference"!=e.controlId),a&&l.push({sgId:0,resourceId:"",controlId:"".concat(t?t+".":"","dtId"),accessLevel:d.$7}),{...e,record:{...e.record,controls:l}}},u=async(e,n,a)=>{let t,l;switch(a){case"dtId":let r=(0,s.m)("userData"),d=null==r?void 0:r.userId;l="_userId=".concat(d,"&_functionId=").concat(n),t=o.r.UserFunction.get;break;case"glbSysNumberRange":l="_recordId=".concat(n),t=o.r.SystemFunction.get;break;case"DocumentType":l="_dgId=".concat(n,"&_startAt=",0,"&_pageSize=",50),t=o.r.DocumentType.qry;break;case"DcTypNumberRange":l="_recordId=".concat(n),t=o.r.DocumentType.get;break;case"isExternal":l="_recordId=".concat(n),t=o.r.NumberRange.get;break;default:return null}return await i(e,t,l)},m=async function(e){let n,a,t,l,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,o=arguments.length>2?arguments[2]:void 0,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,s=!(arguments.length>4)||void 0===arguments[4]||arguments[4],i=arguments.length>5?arguments[5]:void 0,m=void 0===d&&r&&await u(e,r,"dtId"),y=null==m?void 0:m.dtId,p="",f=!0;if(m&&void 0===d||"nraId"===d){if(y){let a=await u(e,y,"DcTypNumberRange");n=null==a?void 0:a.nraId,f=!((null==a?void 0:a.activeStatus)<0),n||(p="Assign the document type to a number range")}if((!y||!f)&&s&&r){var v;let n=await u(e,r,"DocumentType");l=(null==n?void 0:null===(v=n.list)||void 0===v?void 0:v.filter(e=>(null==e?void 0:e.activeStatus)===1).length)>0}}if(("nraId"===d||void 0===d)&&r){if((!y||y)&&!n||n&&!f){let a=await u(e,r,"glbSysNumberRange");(n=null==a?void 0:a.nraId)&&l&&(l=!1),f=!0}p=n||l?"":"Assign the system Function to a number range"}d>0&&!n&&(n=d),n&&f?(a={readOnly:null==(t=await u(e,n,"isExternal"))||!t.external,mandatory:null!=t&&!!t.external},o&&(o=await c(o,a,l,i))):!n&&o&&(o=await c(o,a,l,i));let h=i?"".concat(i,".reference"):"reference";return{dtId:y,resetReference:null==a?void 0:a.readOnly,dcTypeRequired:l,reference:{fieldName:h,isEmpty:(null==t?void 0:t.external)!==void 0&&(null==t||!t.external)},errorMessage:p,maxAccess:o,selectNraId:d}};var y=a(65950);function p(e){let{functionId:n,action:a,hasDT:t}=e,{getRequest:o}=(0,l.useContext)(y.$),{stack:d}=(0,r.V)();return{proxyAction:async()=>{let e=await m(o,n,"",void 0,t);(null==e?void 0:e.errorMessage)?d({message:null==e?void 0:e.errorMessage}):await a()}}}function f(e){var n;let{functionId:a,access:o,hasDT:d,enabled:s=!0,objectName:i=""}=e,{getRequest:c}=(0,l.useContext)(y.$),{stack:u}=(0,r.V)(),[p,f]=(0,l.useState)(),v=async e=>{let n=await m(c,a,o,e,d,i);if(!n.errorMessage)return n;u({message:null==n?void 0:n.errorMessage})},h=(0,t.a)({retry:!1,staleTime:0,enabled:s,queryKey:[a,p,!!o,s],queryFn:p||"nraId"===p?()=>v(p):()=>v()});return{documentType:h.data,maxAccess:(null==h?void 0:null===(n=h.data)||void 0===n?void 0:n.maxAccess)||o,changeDT(e){f((null==e?void 0:e.nraId)||"nraId")}}}},1838:function(e,n,a){"use strict";a.d(n,{Z:function(){return F}});var t=a(52322),l=a(60218),r=a(2784),o=a(48601),d=a(82737),s=a(62202),i=a(65950),c=a(71987),u=a(26612),m=a(8661),y=a(5088),p=a(80983),f=a(31389),v=a(62362),h=a(19473),x=a(39812),I=a(89330),g=a(91406),N=a(21581),w=a(27423),b=a(92407),P=a(98345),_=a(7121),C=a(83562),k=a(21326),S=a(50023);function F(e){var n;let{recordId:a,window:F}=e,{getRequest:R,postRequest:E}=(0,r.useContext)(i.$),{platformLabels:j}=(0,r.useContext)(h.l),{labels:A,access:Z}=(0,S.Z)({datasetId:u.i.EmployeePenalties,editMode:!!a});(0,k.Z)({title:A.empPenalty,window:F});let{maxAccess:O}=(0,P.H)({functionId:_.J.Penalty,access:Z,enabled:!a}),{formik:D}=(0,p.c)({initialValues:{recordId:a||null,reference:"",penaltyId:null,employeeId:null,employeeRef:"",employeeName:"",date:new Date,amount:null,notes:"",status:1,wip:1},maxAccess:O,validateOnChange:!0,validationSchema:o.Ry({date:o.hT().required().test(function(e){return e<=new Date}),penaltyId:o.Rx().required(),amount:o.Rx().required(),employeeId:o.Rx().required()}),onSubmit:async e=>{let{employeeName:n,employeeRef:a,date:t,...l}=e,r=await E({extension:b.y.EmployeePenalty.set,record:JSON.stringify({...l,date:(0,x.ku)(t)})});s.ZP.success(l.recordId?j.Edited:j.Added),J(r.recordId),V()}}),V=(0,c.E)({endpointId:b.y.EmployeePenalty.page}),q=!!D.values.recordId,T=2===D.values.wip;async function J(e){if(e){let{record:n}=await R({extension:b.y.EmployeePenalty.get,parameters:"_recordId=".concat(e)});D.setValues({...n,date:(0,x.a1)(n.date)})}}(0,r.useEffect)(()=>{J(a)},[]);let{employeeName:$,employeeRef:L,date:M,...z}=D.values,U=[{key:"RecordRemarks",condition:!0,onClick:"onRecordRemarks",disabled:!q},{key:"Close",condition:!T,onClick:async()=>{await E({extension:b.y.EmployeePenalty.close,record:JSON.stringify({...z,date:(0,x.ku)(M)})}),s.ZP.success(j.Closed),J(D.values.recordId),V()},disabled:T||!q},{key:"Reopen",condition:T,onClick:async()=>{await E({extension:b.y.EmployeePenalty.reopen,record:JSON.stringify({...z,date:(0,x.ku)(M)})}),s.ZP.success(j.Reopened),J(D.values.recordId),V()},disabled:!T},{key:"Approval",condition:!0,onClick:"onApproval",disabled:!T}];return(0,t.jsx)(d.Z,{resourceId:u.i.EmployeePenalties,functionId:_.J.Penalty,form:D,actions:U,maxAccess:O,editMode:q,children:(0,t.jsx)(f.R,{children:(0,t.jsx)(v.Q,{children:(0,t.jsxs)(l.ZP,{container:!0,spacing:2,children:[(0,t.jsx)(l.ZP,{item:!0,xs:12,children:(0,t.jsx)(y.Z,{name:"reference",label:A.ref,value:D.values.reference,maxAccess:O,readOnly:q,maxLength:"10",onChange:D.handleChange,onClear:()=>D.setFieldValue("reference",""),error:D.touched.reference&&!!D.errors.reference})}),(0,t.jsx)(l.ZP,{item:!0,xs:12,children:(0,t.jsx)(I.Z,{name:"date",required:!0,label:A.date,value:null===(n=D.values)||void 0===n?void 0:n.date,onChange:D.setFieldValue,onClear:()=>D.setFieldValue("date",null),error:D.touched.date&&!!D.errors.date,maxAccess:O,readOnly:T,max:new Date})}),(0,t.jsx)(l.ZP,{item:!0,xs:12,children:(0,t.jsx)(m.Z,{endpointId:C.m.PenaltyType.qry,name:"penaltyId",label:A.penalty,required:!0,valueField:"recordId",readOnly:T,displayField:"name",values:D.values,maxAccess:O,onChange:(e,n)=>{D.setFieldValue("penaltyId",(null==n?void 0:n.recordId)||null)},error:D.touched.penaltyId&&!!D.errors.penaltyId})}),(0,t.jsx)(l.ZP,{item:!0,xs:12,children:(0,t.jsx)(w.U,{endpointId:b.y.Employee.snapshot,parameters:{_branchId:0},filter:{activeStatus:1},valueField:"reference",displayField:"fullName",name:"employeeId",required:!0,readOnly:T,label:A.employee,secondFieldLabel:A.empName,form:D,displayFieldWidth:2,valueShow:"employeeRef",secondValueShow:"employeeName",columnsInDropDown:[{key:"reference",value:"Reference"},{key:"fullName",value:"Name"}],maxAccess:O,onChange:async(e,n)=>{D.setFieldValue("employeeRef",(null==n?void 0:n.reference)||""),D.setFieldValue("employeeName",(null==n?void 0:n.fullName)||""),D.setFieldValue("employeeId",(null==n?void 0:n.recordId)||null)},errorCheck:"employeeId"})}),(0,t.jsx)(l.ZP,{item:!0,xs:12,children:(0,t.jsx)(g.Z,{name:"amount",label:A.amount,value:D.values.amount,maxAccess:O,readOnly:T,required:!0,onChange:D.handleChange,onClear:()=>D.setFieldValue("amount",null),error:D.touched.amount&&!!D.errors.amount})}),(0,t.jsx)(l.ZP,{item:!0,xs:12,children:(0,t.jsx)(N.Z,{name:"notes",label:A.notes,value:D.values.notes,rows:3,readOnly:T,maxAccess:O,onChange:e=>D.setFieldValue("notes",e.target.value),onClear:()=>D.setFieldValue("notes",""),error:D.touched.notes&&!!D.errors.notes})})]})})})})}F.width=600,F.height=470}},function(e){e.O(0,[92515,2494,36908,49774,92888,40179],function(){return e(e.s=6039)}),_N_E=e.O()}]);