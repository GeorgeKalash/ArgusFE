(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[44824],{10823:function(e,l,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/undelivered-items",function(){return n(97894)}])},97894:function(e,l,n){"use strict";n.r(l),n.d(l,{default:function(){return w}});var r=n(52322),t=n(2784),a=n(62202),s=n(48601),d=n(65950),i=n(71987),o=n(26612),c=n(31389),u=n(33625),p=n(62362),m=n(19473),v=n(65215),g=n(60218),I=n(27423),h=n(80983),x=n(38449),y=n(22341),f=n(8661),R=n(7121),P=n(76399);let O="RG.SA.asmx/openSO";var b=n(39812),D=n(30043),T=n(69627),V=n(21581),j=n(61802),C=n(10005),Z=n(96026),F=n(89330),q=n(54074),w=()=>{var e,l,n,w;let{getRequest:k,postRequest:N}=(0,t.useContext)(d.$),{platformLabels:_,defaultsData:A}=(0,t.useContext)(m.l),{stack:E}=(0,j.zY)(),{stack:S}=(0,Z.V)(),{labels:B,access:L}=(0,i.J)({datasetId:o.i.UndeliveredItems}),{labels:z,access:H}=(0,i.J)({datasetId:o.i.DeliveriesOrders}),Q=null==A?void 0:null===(e=A.list)||void 0===e?void 0:e.find(e=>{let{key:l}=e;return"DEORDMaxVarPct"===l}),{formik:U}=(0,h.c)({maxAccess:L,initialValues:{recordId:null,dtId:null,groupId:0,plantId:null,siteId:null,categoryId:0,clientId:null,clientRef:"",clientName:"",date:new Date,soId:0,items:[],marginDefault:null==Q?void 0:Q.value,notes:""},validateOnChange:!0,validationSchema:s.Ry({plantId:s.Rx().required(),siteId:s.Rx().required(),clientId:s.Rx().required()}),onSubmit:async e=>{let{clientId:l,siteId:n,notes:r,items:t,dtId:s,plantId:d,date:i}=e,o=t.filter(e=>e.isChecked).map(e=>{let{scheduledDate:l,functionId:n,id:r,isChecked:t,...a}=e;return a});if((null==o?void 0:o.length)<1){S({message:B.checkItemsBeforeAppend});return}N({extension:D.U.DeliveriesOrders.gen,record:JSON.stringify({clientId:l,siteId:n,notes:r,plantId:d,dtId:s,date:i?(0,b.ku)(i):null,items:o})}).then(l=>{if(l.recordId){E({Component:C.Z,props:{labels:z,recordId:l.recordId,maxAccess:H,refresh:!1,plantId:d,dtId:s},width:1300,height:700,title:z.deliveryOrder}),a.ZP.success(_.Generated);let n=e.items.map(e=>{let{isChecked:l,...n}=e;return{...n,isChecked:!1,deliverNow:0}});U.setFieldValue("items",n)}})}}),{groupId:W,plantId:G,siteId:J,categoryId:M,clientId:$,soId:X,marginDefault:Y}=U.values;async function K(){var e;let l=await k({extension:O,parameters:"_categoryId=".concat(M,"&_siteId=").concat(J,"&_groupId=").concat(W,"&_clientId=").concat($||0,"&_soId=").concat(X,"&_plantId=").concat(G)}),n=null==l?void 0:null===(e=l.list)||void 0===e?void 0:e.map((e,l)=>({...e,id:l+1,date:(0,b.a1)(e.date),balance:e.qty-e.deliveredQty}));U.setFieldValue("items",n)}(0,t.useEffect)(()=>{K()},[$,M,W]);let ee=[{component:"checkbox",name:"isChecked",flex:.3,checkAll:{value:(null===(l=U.values.items)||void 0===l?void 0:l.length)>0&&(null===(n=U.values.items)||void 0===n?void 0:n.every(e=>null==e?void 0:e.isChecked)),visible:!0,onChange(e){let{checked:l}=e,n=U.values.items.map(e=>{let{isChecked:n,...r}=e;return{...r,isChecked:l,deliverNow:l?r.balance:0}});U.setFieldValue("items",n)}},async onChange(e){let{row:{update:l,newRow:n}}=e;l({deliverNow:n.isChecked?n.balance:0})}},{component:"textfield",label:B.reference,name:"reference",props:{readOnly:!0}},{component:"date",label:B.date,name:"date",props:{readOnly:!0}},{component:"textfield",label:B.clientRef,name:"clientRef",props:{readOnly:!0}},{component:"textfield",label:B.client,name:"clientName",props:{readOnly:!0}},{component:"textfield",label:B.sku,name:"sku",props:{readOnly:!0}},{component:"textfield",label:B.item,name:"itemName",props:{readOnly:!0}},{component:"numberfield",label:B.qty,name:"qty",props:{readOnly:!0}},{component:"numberfield",label:B.deliveredQty,name:"deliveredQty",props:{readOnly:!0}},{component:"numberfield",label:B.balance,name:"balance",props:{readOnly:!0}},{component:"numberfield",label:B.genQty,name:"deliverNow",updateOn:"blur",propsReducer(e){let{row:l,props:n}=e;return{...n,readOnly:!l.isChecked}},async onChange(e){let{row:{update:l,newRow:n}}=e,{deliverNow:r,balance:t,qty:a}=n,s=r;if(r>t){let e=100*(r-t)/a;Y&&0==Y?s=t:Y&&e<Y&&(s=r)}else r<0&&(s=0);l({deliverNow:s})}}];return(0,r.jsx)(q.Z,{onSave:U.handleSubmit,maxAccess:L,fullSize:!0,children:(0,r.jsxs)(c.R,{children:[(0,r.jsx)(u.g,{children:(0,r.jsxs)(g.ZP,{container:!0,spacing:2,p:2,children:[(0,r.jsx)(g.ZP,{item:!0,xs:3,children:(0,r.jsxs)(g.ZP,{container:!0,spacing:2,children:[(0,r.jsx)(g.ZP,{item:!0,xs:12,children:(0,r.jsx)(f.Z,{endpointId:x.r.DocumentType.qry,parameters:"_dgId=".concat(R.J.DeliveryOrder,"&_startAt=",0,"&_pageSize=",1e3),name:"dtId",label:B.documentType,valueField:"recordId",displayField:"name",values:U.values,onChange:(e,l)=>{U.setFieldValue("dtId",(null==l?void 0:l.recordId)||null)},error:U.touched.dtId&&!!U.errors.dtId,maxAccess:L})}),(0,r.jsx)(g.ZP,{item:!0,xs:12,children:(0,r.jsx)(f.Z,{endpointId:v.$.Category.qry,parameters:"_pagesize=30&_startAt=0&_name=",name:"categoryId",label:B.category,valueField:"recordId",displayField:"name",displayFieldWidth:1,values:null==U?void 0:U.values,maxAccess:L,onChange:(e,l)=>{U.setFieldValue("categoryId",(null==l?void 0:l.recordId)||0)},error:U.touched.categoryId&&!!U.errors.categoryId})}),(0,r.jsx)(g.ZP,{item:!0,xs:12,children:(0,r.jsx)(f.Z,{endpointId:v.$.Group.qry,parameters:"_startAt=0&_pageSize=1000",name:"groupId",label:B.group,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:U.values,onChange:(e,l)=>{U.setFieldValue("groupId",(null==l?void 0:l.recordId)||0)},error:U.touched.groupId&&!!U.errors.groupId,maxAccess:L})})]})}),(0,r.jsx)(g.ZP,{item:!0,xs:3,children:(0,r.jsxs)(g.ZP,{container:!0,spacing:2,children:[(0,r.jsx)(g.ZP,{item:!0,xs:12,children:(0,r.jsx)(I.U,{endpointId:y.P.Client.snapshot,parameters:{_category:0},valueField:"reference",displayField:"name",name:"clientId",label:B.client,form:U,displayFieldWidth:2,valueShow:"clientRef",secondValueShow:"clientName",maxAccess:L,columnsInDropDown:[{key:"reference",value:"Ref."},{key:"name",value:"Name"}],required:!0,onChange:async(e,l)=>{U.setFieldValue("clientId",(null==l?void 0:l.recordId)||null),U.setFieldValue("clientName",(null==l?void 0:l.name)||""),U.setFieldValue("clientRef",(null==l?void 0:l.reference)||"")},errorCheck:"clientId"})}),(0,r.jsx)(g.ZP,{item:!0,xs:12,children:(0,r.jsx)(f.Z,{endpointId:v.$.Site.qry,name:"siteId",label:B.site,valueField:"recordId",displayField:["reference","name"],maxAccess:L,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:U.values,onChange:(e,l)=>{U.setFieldValue("siteId",(null==l?void 0:l.recordId)||null),U.setFieldValue("siteRef",(null==l?void 0:l.reference)||""),U.setFieldValue("siteName",(null==l?void 0:l.name)||"")},required:!0,error:U.touched.siteId&&!!U.errors.siteId})}),(0,r.jsx)(g.ZP,{item:!0,xs:12,children:(0,r.jsx)(f.Z,{endpointId:x.r.Plant.qry,name:"plantId",label:B.plant,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:U.values,onChange:(e,l)=>{U.setFieldValue("plantId",(null==l?void 0:l.recordId)||null)},required:!0,error:U.touched.plantId&&!!U.errors.plantId,maxAccess:L})})]})}),(0,r.jsx)(g.ZP,{item:!0,xs:3,children:(0,r.jsxs)(g.ZP,{container:!0,spacing:2,children:[(0,r.jsx)(g.ZP,{item:!0,xs:12,children:(0,r.jsx)(I.U,{endpointId:y.P.SalesOrder.snapshot,parameters:{_size:30,_startAt:0},valueField:"reference",displayField:"name",name:"soId",label:B.salesOrder,form:U,required:"2"===U.values.type||2===U.values.type,valueShow:"soRef",secondDisplayField:!1,maxAccess:L,onChange:async(e,l)=>{U.setFieldValue("soId",(null==l?void 0:l.recordId)||0),U.setFieldValue("soRef",(null==l?void 0:l.reference)||"")},errorCheck:"soId"})}),(0,r.jsx)(g.ZP,{item:!0,xs:12,children:(0,r.jsx)(V.Z,{name:"notes",label:B.notes,value:U.values.notes,maxLength:"100",rows:2.5,maxAccess:L,onChange:U.handleChange,onClear:()=>U.setFieldValue("notes",""),error:U.touched.notes&&!!U.errors.notes})})]})}),(0,r.jsx)(g.ZP,{item:!0,xs:3,children:(0,r.jsxs)(g.ZP,{container:!0,spacing:2,children:[(0,r.jsx)(g.ZP,{item:!0,xs:12,children:(0,r.jsx)(F.Z,{name:"date",label:B.date,value:null==U?void 0:null===(w=U.values)||void 0===w?void 0:w.date,onChange:U.setFieldValue,readOnly:!0,maxAccess:L,onClear:()=>U.setFieldValue("date",""),error:U.touched.date&&!!U.errors.date})}),(0,r.jsx)(g.ZP,{item:!0,xs:12}),(0,r.jsx)(g.ZP,{item:!0,xs:12}),(0,r.jsx)(g.ZP,{item:!0,xs:12}),(0,r.jsx)(g.ZP,{item:!0,xs:12}),(0,r.jsx)(g.ZP,{item:!0,xs:12,children:(0,r.jsx)(T.Z,{variant:"contained",image:"preview.png",label:_.Preview,onClick:()=>K(),color:"#231f20"})})]})})]})}),(0,r.jsx)(p.Q,{children:(0,r.jsx)(P._,{onChange:e=>U.setFieldValue("items",e),value:U.values.items,error:U.errors.items,columns:ee,name:"items",allowDelete:!1,allowAddNewLine:!1,maxAccess:L})})]})})}},30043:function(e,l,n){"use strict";n.d(l,{U:function(){return t}});let r="DE.asmx/",t={Driver:{snapshot:r+"snapshotDRV",page:r+"pageDRV",set:r+"setDRV",get:r+"getDRV",qry:r+"qryDRV",del:r+"delDRV"},Vehicle:{page:r+"pageVEH",set:r+"setVEH",get:r+"getVEH",qry:r+"qryVEH",del:r+"delVEH"},Trip:{page:r+"pageTRP",set:r+"setTRP",get:r+"getTRP",qry:r+"qryTRP",del:r+"delTRP",snapshot:r+"snapshotTRP",snapshot2:r+"snapshot2TRP",reopen:r+"reopenTRP",post:r+"postTRP",unpost:r+"unpostTRP",close:r+"closeTRP",generate:r+"generateTRP",setTRP2:r+"setTRP2",assign:r+"assignTRP",unassign:r+"unassignedTRP"},TripOrderPack2:{set2:r+"set2TRO"},TripOrder:{qry:r+"qryTRO"},Reduild:{rebuild:r+"rebuildMW"},TRP:{flag:r+"flagTRP"},ExpenseTypes:{get:r+"getET",set:r+"setET",del:r+"delET",page:r+"pageET"},DeliveriesOrders:{qry:r+"qryORD",get:r+"getORD",snapshot:r+"snapshotORD",unpost:r+"unpostORD",gen:r+"genORD",post:r+"postORD",del:r+"delORD",cancel:r+"cancelORD",flag:r+"flagORD",set2:r+"set2ORD"},Invoice:{generate:r+"generateIVC2",generateInv:r+"generateIVC",preview:r+"previewIVC"},OrderItem:{qry:r+"qryORI",get:r+"getORI"},MW:{qry:r+"qryMW2"},GenerateTrip:{root:r+"rootSZ",firstLevel:r+"firstLevelSZ",undelivered2:r+"undeliveredSO2",previewTRP:r+"previewTRP"},DeliveryLeadTime:{get:r+"getLDT",page:r+"pageLDT",set:r+"setLDT",del:r+"delLDT"},Volume:{vol:r+"volZO"},AllocatedVolume:{qry:r+"qryVEH2"},InboundTransp:{pack:r+"getPackINB",page:r+"pageINB",set2:r+"set2INB",get:r+"getINB",get2:r+"get2INB",del:r+"delINB",snapshot:r+"snapshotINB",post:r+"postINB",unpost:r+"unpostINB"},InboundOrders:{qry:r+"qryINO"}}}},function(e){e.O(0,[10005,49774,92888,40179],function(){return e(e.s=10823)}),_N_E=e.O()}]);