(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[42590],{47293:function(e,l,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/sales-quotations",function(){return t(59127)}])},59127:function(e,l,t){"use strict";t.r(l),t.d(l,{default:function(){return U}});var a=t(52322),n=t(2784),d=t(71987),i=t(65950),o=t(69387),s=t(62202),r=t(61802),u=t(26612),c=t(31389),v=t(33625),m=t(62362),p=t(19473),x=t(98345),y=t(7121),I=t(22341),f=t(96026),F=t(36908),h=t(89330),b=t(39812),P=t(60218),A=t(48601),g=t(82737),D=t(5088),V=t(21581),w=t(8661),C=t(38449),j=t(65215),Z=t(27423),T=t(76399),S=t(91406),k=t(25870),N=t(80983),_=t(39704),O=t(86626),q=t(18996),Q=t(16096),R=t(75163),L=t(849),z=t(19689),E=t(19568),B=t(253),W=t(45937),J=t(67920),M=t(69627),$=t(72747);function X(e){var l,o,F,X,U,K,Y,H,G,ee,el,et,ea,en,ed,ei,eo,es,er,eu,ec,ev,em,ep,ex,ey;let{labels:eI,access:ef,recordId:eF,currency:eh,window:eb}=e,{getRequest:eP,postRequest:eA}=(0,n.useContext)(i.$),{stack:eg}=(0,r.zY)(),{stack:eD}=(0,f.V)(),{platformLabels:eV,defaultsData:ew,userDefaultsData:eC}=(0,n.useContext)(p.l),[ej,eZ]=(0,n.useState)({text:"%",value:2}),[eT,eS]=(0,n.useState)({}),ek=(0,n.useRef)([]),[eN,e_]=(0,n.useState)([]),[eO,eq]=(0,n.useState)(null),[eQ,eR]=(0,n.useState)(!1),eL=(null==ew?void 0:null===(o=ew.list)||void 0===o?void 0:null===(l=o.find(e=>{let{key:l}=e;return"allowSalesNoLinesTrx"===l}))||void 0===l?void 0:l.value)=="true",{documentType:ez,maxAccess:eE,changeDT:eB}=(0,x.H)({functionId:y.J.SalesQuotation,access:ef,enabled:!eF});async function eW(e){if(!e)return null;let l=await eP({extension:I.P.SalesPerson.get,parameters:"_recordId=".concat(e)}),t=null==l?void 0:l.record;return!t||t.isInactive?null:e}let eJ={recordId:eF,dtId:null,reference:null,date:new Date,expiryDate:null,deliveryDate:null,validity:null,plantId:null,clientId:"",bpId:null,bpRef:null,bpName:null,currencyId:parseInt(eh),szId:null,spId:null,siteId:null,description:null,status:1,isVattable:!1,exWorks:!1,taxId:null,shipAddress:"",subtotal:0,miscAmount:0,amount:0,vatAmount:0,tdAmount:0,plId:null,ptId:null,shipToAddressId:null,maxDiscount:0,currentDiscount:0,exRate:1,rateCalcMethod:null,tdType:2,tdPct:0,baseAmount:0,volume:0,weight:0,qty:0,serializedAddress:null,items:[{id:1,quotationId:eF||0,itemId:null,sku:null,itemName:null,seqNo:1,siteId:null,muId:null,qty:0,volume:0,weight:1,msId:0,muQty:0,baseQty:0,mdType:1,basePrice:0,mdValue:0,unitPrice:0,unitCost:0,overheadId:null,vatAmount:0,mdAmount:0,upo:0,extendedPrice:0,mdAmountPct:null,priceType:1,applyVat:!1,taxId:null,taxDetails:null,notes:null}]},eM=(0,d.E)({endpointId:I.P.SalesQuotations.page}),{schema:e$,requiredFields:eX}=(0,J.m)({sku:e=>null==e?void 0:e.sku,qty:e=>(null==e?void 0:e.qty)>0},eL,eE,"items"),{formik:eU}=(0,N.c)({maxAccess:eE,documentType:{key:"dtId",value:null==ez?void 0:ez.dtId},conditionSchema:["items"],initialValues:eJ,validationSchema:A.Ry({currencyId:A.Z_().required(),date:A.Z_().required(),clientId:A.Z_().nullable().test(function(e){return!!this.parent.bpId||!!e}),bpId:A.Z_().nullable().test(function(e){return!!this.parent.clientId||!!e}),items:A.IX().of(e$)}),onSubmit:async e=>{let l={...e,date:(0,b.ku)(e.date),miscAmount:e.miscAmount||0};if(delete l.items,["expiryDate","deliveryDate","rateCalcMethod"].forEach(t=>{e[t]||delete l[t]}),l.serializedAddress){let e=await eA({extension:I.P.Address.set,record:JSON.stringify({clientId:l.clientId,address:eT})});l.shipToAddressId=e.recordId}let t=eU.values.items.filter(e=>{var l;return null===(l=Object.values(eX))||void 0===l?void 0:l.every(l=>l(e))}).map((l,t)=>{let{physicalProperty:a,...n}=l;return{...n,seqNo:t+1,applyVat:e.isVattable}}),a=await eA({extension:I.P.SalesQuotations.set2,record:JSON.stringify({header:l,items:t})});s.ZP.success(eK?eV.Edited:eV.Added),await ly(a.recordId),eM()}}),eK=!!eU.values.recordId,eY=1===eU.values.status;async function eH(e){var l,t;let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!e)return;let n=null===(t=eU.values.items)||void 0===t?void 0:null===(l=t.find(l=>parseInt(l.itemId)===e))||void 0===l?void 0:l.msId,d=0==n&&a||n,i=(null==eN?void 0:eN.filter(e=>e.msId==d))||[];ek.current=i}let eG=[{component:"resourcelookup",label:eI.sku,name:"sku",flex:2,props:{endpointId:j.$.Item.snapshot,parameters:{_categoryId:0,_msId:0,_startAt:0,_size:1e3},displayField:"sku",valueField:"sku",mapping:[{from:"recordId",to:"itemId"},{from:"sku",to:"sku"},{from:"name",to:"itemName"}],columnsInDropDown:[{key:"sku",value:"SKU"},{key:"name",value:"Item Name"},{key:"flName",value:"FL Name"}],displayFieldWidth:5,filter:{salesItem:!0}},async onChange(e){var l,t,a,n,d,i;let{row:{update:o,newRow:s}}=e;if(!s.itemId)return;let r=await e4(s.itemId),u=await le(s.itemId),c=await lt(s.itemId,o),v=null,m=null;if(eU.values.taxId){let e=(await ll(eU.values.taxId)).map(e=>({taxId:eU.values.taxId,taxCodeId:e.taxCodeId,taxBase:e.taxBase,amount:e.amount}));v=eU.values.taxId,m=e}else if(null==u?void 0:u.taxId){let e=(await ll(u.taxId)).map(e=>({taxId:u.taxId,taxCodeId:e.taxCodeId,taxBase:e.taxBase,amount:e.amount}));v=u.taxId,m=e}let p=null==eN?void 0:eN.filter(e=>e.msId===(null==u?void 0:u.msId));eH(null==s?void 0:s.itemId,null==u?void 0:u.msId);let x=null==ek?void 0:null===(l=ek.current)||void 0===l?void 0:l.filter(e=>e.recordId===(null==s?void 0:s.muId));o({volume:parseFloat(null==r?void 0:r.volume)||0,weight:parseFloat((null==r?void 0:r.weight)||0).toFixed(2),vatAmount:parseFloat((null==u?void 0:u.vatPct)||0).toFixed(2),basePrice:parseFloat((null==c?void 0:c.basePrice)||0).toFixed(5),unitPrice:parseFloat((null==c?void 0:c.unitPrice)||0).toFixed(3),upo:parseFloat((null==c?void 0:c.upo)||0).toFixed(2),priceType:(null==c?void 0:c.priceType)||1,mdAmount:eU.values.maxDiscount?parseFloat(eU.values.maxDiscount).toFixed(2):0,qty:0,msId:null==u?void 0:u.msId,muRef:null==p?void 0:null===(t=p[0])||void 0===t?void 0:t.reference,muId:null==p?void 0:null===(a=p[0])||void 0===a?void 0:a.recordId,extendedPrice:parseFloat("0").toFixed(2),mdValue:0,taxId:v,taxDetails:m||null,mdType:1,siteId:null==eU?void 0:null===(n=eU.values)||void 0===n?void 0:n.siteId,siteRef:await lF(null==eU?void 0:null===(d=eU.values)||void 0===d?void 0:d.siteId),baseQty:Number(null==x?void 0:null===(i=x[0])||void 0===i?void 0:i.qty)*Number(null==s?void 0:s.qty)}),eU.setFieldValue("mdAmount",eU.values.currentDiscount?eU.values.currentDiscount:0)}},{component:"textfield",label:eI.itemName,name:"itemName",flex:3,props:{readOnly:!0}},{component:"resourcecombobox",label:eI.measurementUnit,name:"muRef",props:{store:null==ek?void 0:ek.current,displayField:"reference",valueField:"recordId",mapping:[{from:"reference",to:"muRef"},{from:"qty",to:"muQty"},{from:"recordId",to:"muId"}]},async onChange(e){var l;let{row:{update:t,newRow:a}}=e,n=null==ek?void 0:ek.current.find(e=>e.recordId===(null==a?void 0:a.muId)),d=null!==(l=null==a?void 0:a.muQty)&&void 0!==l?l:null==n?void 0:n.qty;t({baseQty:(null==a?void 0:a.qty)*d})},propsReducer(e){let{row:l,props:t}=e;return{...t,store:null==ek?void 0:ek.current}}},{component:"numberfield",label:eI.quantity,name:"qty",updateOn:"blur",onChange(e){var l;let{row:{update:t,newRow:a}}=e;eH(null==a?void 0:a.itemId,null==a?void 0:a.msId);let n=ln(a,O.bT),d=null==ek?void 0:ek.current.find(e=>e.recordId===(null==a?void 0:a.muId)),i=null!==(l=null==a?void 0:a.muQty)&&void 0!==l?l:null==d?void 0:d.qty;t({...n,baseQty:(null==a?void 0:a.qty)*i})}},{component:"numberfield",label:eI.volume,name:"volume",props:{readOnly:!0}},{component:"numberfield",label:eI.weight,name:"weight",props:{readOnly:!0}},{component:"numberfield",label:eI.baseprice,name:"basePrice",props:{decimalScale:5},updateOn:"blur",async onChange(e){let{row:{update:l,newRow:t}}=e;l(ln(t,O.yO))}},{component:"numberfield",label:eI.unitPrice,name:"unitPrice",props:{decimalScale:5},updateOn:"blur",async onChange(e){let{row:{update:l,newRow:t}}=e;l(ln(t,O.Xf))}},{component:"numberfield",label:eI.upo,name:"upo",updateOn:"blur",async onChange(e){let{row:{update:l,newRow:t}}=e;l(ln(t,O.zL))}},{component:"numberfield",label:eI.VAT,name:"vatAmount",props:{readOnly:!0}},{component:"button",name:"taxDetailsButton",props:{onCondition:e=>e.itemId&&e.taxId?{imgSrc:t(54022).default.src,hidden:!1}:{imgSrc:"",hidden:!0}},label:eI.tax,onClick:(e,l)=>{eg({Component:E.Z,props:{taxId:null==l?void 0:l.taxId,obj:l}})}},{component:"numberfield",label:eI.markdown,name:"mdAmount",updateOn:"blur",flex:2,props:{ShowDiscountIcons:!0,iconsClicked:e0,type:"numeric",iconKey:e=>{let{value:l,data:t}=e;return((null==l?void 0:l.mdType)||(null==t?void 0:t.mdType))===O.Xo?"%":"123"}},async onChange(e){let{row:{update:l,newRow:t}}=e;l(ln(t,O.On)),function(e,l){let t=e.unitPrice*(eU.values.maxDiscount/100);if(eU.values.maxDiscount){var a;1==e.mdType?e.mdAmount>eU.values.maxDiscount&&(a=eU.values.maxDiscount,parseFloat(e.mdAmount)>a&&(eU.setFieldValue("mdAmount",a),e.mdAmount=a,l(ln(e,O.On)),eD({message:eI.clientMaxPctDiscount+" "+a+"%"}))):e.mdAmount>t&&e.mdAmount>t&&(eU.setFieldValue("mdType",2),eU.setFieldValue("mdAmount",t),e.mdType=2,e.mdAmount=t,l(ln(e,O.On)),eD({message:eI.clientMaxDiscount+" "+t}))}}(t,l)}},{component:"button",name:"saTrx",label:eI.salesTrx,props:{onCondition:e=>({disabled:!e.itemId})},onClick:(e,l,t,a)=>{var n;eg({Component:L.Z,props:{recordId:0,functionId:y.J.SalesInvoice,itemId:null==l?void 0:l.itemId,clientId:null==eU?void 0:null===(n=eU.values)||void 0===n?void 0:n.clientId}})}},{component:"numberfield",label:eI.extendedprice,name:"extendedPrice",updateOn:"blur",async onChange(e){let{row:{update:l,newRow:t}}=e;l(ln(t,O.bh))}},{component:"textfield",label:eI.notes,name:"notes",flex:2}];async function e0(e){let{updateRow:l,value:t,data:a}=e,n=((null==t?void 0:t.mdType)||(null==a?void 0:a.mdType))===O.Xo?O.RD:O.Xo,d=la(null==t?void 0:t.mdAmount,n);l({id:a.id,changes:{mdAmount:d,mdAmountPct:n,mdType:n},commitOnBlur:!0})}let e2=[{key:"RecordRemarks",condition:!0,onClick:"onRecordRemarks",disabled:!eK},{key:"WorkFlow",condition:!0,onClick:async function(){eg({Component:_.Z,props:{functionId:y.J.SalesQuotation,recordId:eU.values.recordId}})},disabled:!eK},{key:"Invoice",condition:!0,onClick:async function(){let e={...eU.values};delete e.items,e.date=(0,b.ku)(e.date),e.deliveryDate=e.deliveryDate&&(0,b.ku)(e.deliveryDate),e.expiryDate=e.expiryDate&&(0,b.ku)(e.expiryDate),await eA({extension:I.P.SalesQuotations.postToInvTrx,record:JSON.stringify(e)}),s.ZP.success(eV.Invoice),eM(),eb.close()},disabled:!(eK&&eY)},{key:"Order",condition:!0,onClick:async function(){let e={...eU.values};delete e.items,e.date=(0,b.ku)(e.date),e.deliveryDate=e.deliveryDate&&(0,b.ku)(e.deliveryDate),e.expiryDate=e.expiryDate&&(0,b.ku)(e.expiryDate),await eA({extension:I.P.SalesQuotations.postQuotTrx,record:JSON.stringify(e)}),s.ZP.success(eV.Order),eM(),eb.close()},disabled:!(eK&&eY)},{key:"Consignments",condition:!0,onClick:async function(){let e={...eU.values};delete e.items,e.date=(0,b.ku)(e.date),e.deliveryDate=e.deliveryDate&&(0,b.ku)(e.deliveryDate),e.expiryDate=e.expiryDate&&(0,b.ku)(e.expiryDate),await eA({extension:I.P.SalesQuotations.postToCons,record:JSON.stringify(e)}),s.ZP.success(eV.Consignments),eM(),eb.close()},disabled:!(eK&&eY)}];async function e1(e,l,t){var a,n,d,i,o,s,r,u,c,v;let m=await e5(null==e?void 0:null===(a=e.record)||void 0===a?void 0:a.shipToAddressId);(null==e?void 0:null===(n=e.record)||void 0===n?void 0:n.tdType)==1||(null==e?void 0:null===(d=e.record)||void 0===d?void 0:d.tdType)==null?eZ({text:"123",value:1}):eZ({text:"%",value:2});let p=(null==l?void 0:l.list.length)!=0?await Promise.all(null===(i=l.list)||void 0===i?void 0:i.map(async(l,t)=>{var a;let n=(null==e?void 0:null===(a=e.record)||void 0===a?void 0:a.isVattable)?await ll(l.taxId):null,d=await le(null==l?void 0:l.itemId);return{...l,id:t+1,basePrice:parseFloat(l.basePrice).toFixed(5),unitPrice:parseFloat(l.unitPrice).toFixed(3),upo:parseFloat(l.upo).toFixed(2),vatAmount:parseFloat(l.vatAmount).toFixed(2),extendedPrice:parseFloat(l.extendedPrice).toFixed(2),msId:(null==d?void 0:d.msId)||l.msId,taxDetails:n}})):eU.values.items;eU.setValues({...e.record,currentDiscount:(null==e?void 0:null===(o=e.record)||void 0===o?void 0:o.tdType)==1||(null==e?void 0:null===(s=e.record)||void 0===s?void 0:s.tdType)==null?null==e?void 0:null===(r=e.record)||void 0===r?void 0:r.tdAmount:null==e?void 0:null===(u=e.record)||void 0===u?void 0:u.tdPct,amount:parseFloat(null==e?void 0:null===(c=e.record)||void 0===c?void 0:c.amount).toFixed(2),maxDiscount:(null==t?void 0:null===(v=t.record)||void 0===v?void 0:v.tdPct)||0,shipAddress:m,items:p})}async function e3(e){var l,t,a;let n=await eP({extension:I.P.SalesQuotations.get,parameters:"_recordId=".concat(e)});return n.record.date=(0,b.a1)(null==n?void 0:null===(l=n.record)||void 0===l?void 0:l.date),n.record.expiryDate=(0,b.a1)(null==n?void 0:null===(t=n.record)||void 0===t?void 0:t.expiryDate),n.record.deliveryDate=(0,b.a1)(null==n?void 0:null===(a=n.record)||void 0===a?void 0:a.deliveryDate),n}async function e9(e){return await eP({extension:I.P.QuotationItem.qry,parameters:"_params=1|".concat(e,"&_startAt=0&_pageSize=3000&_sortBy=seqno")})}async function e5(e){var l;if(!e)return;let t=await eP({extension:C.r.Address.format,parameters:"_addressId=".concat(e)});return null==t?void 0:null===(l=t.record)||void 0===l?void 0:l.formattedAddress.replace(/(\r\n|\r|\n)+/g,"\r\n")}async function e6(e){if(e)return await eP({extension:I.P.Client.get,parameters:"_recordId=".concat(e)})}async function e8(e){var l,t,a,n,d,i,o,s;if(!e)return;let r=await e6(e);eU.setFieldValue("ptId",null==r?void 0:null===(l=r.record)||void 0===l?void 0:l.ptId),eU.setFieldValue("plId",(null==r?void 0:null===(t=r.record)||void 0===t?void 0:t.plId)||(null===(a=eU.values)||void 0===a?void 0:a.plId)||0),eU.setFieldValue("szId",null==r?void 0:null===(n=r.record)||void 0===n?void 0:n.szId),eU.setFieldValue("currencyId",null==r?void 0:null===(d=r.record)||void 0===d?void 0:d.currencyId);let u=await eW((null==r?void 0:null===(i=r.record)||void 0===i?void 0:i.spId)||eU.values.spId);eU.setFieldValue("spId",u),eU.setFieldValue("shipToAddressId",(null==r?void 0:null===(o=r.record)||void 0===o?void 0:o.shipAddressId)||null);let c=await e5(null==r?void 0:null===(s=r.record)||void 0===s?void 0:s.shipAddressId);eU.setFieldValue("shipAddress",c||"")}async function e7(e){if(!e)return;let l=await eP({extension:B.F.BPAddress.qry,parameters:"_bpId=".concat(e,"&_filter=")}),t=null==l?void 0:l.list[0].addressId,a=await e5(t);eU.setFieldValue("shipAddress",a||"")}async function e4(e){let l=await eP({extension:j.$.ItemPhysProp.get,parameters:"_itemId=".concat(e)});return null==l?void 0:l.record}async function le(e){let l=await eP({extension:j.$.Item.get,parameters:"_recordId=".concat(e)});return null==l?void 0:l.record}async function ll(e){if(!e)return;let l=await eP({extension:k.H.TaxDetailPack.qry,parameters:"_taxId=".concat(e)});return null==l?void 0:l.list}async function lt(e,l){if(!eU.values.currencyId){l({itemId:null,itemName:null,sku:null}),eD({message:eI.noCurrency});return}let t=await eP({extension:I.P.ItemConvertPrice.get,parameters:"_itemId=".concat(e,"&_clientId=").concat(eU.values.clientId||0,"&_currencyId=").concat(eU.values.currencyId,"&_plId=").concat(eU.values.plId,"&_muId=0")});return null==t?void 0:t.record}function la(e,l){let t=parseFloat(e)||0;return l===O.Xo?(t<0||t>100)&&(t=0):t<0&&(t=0),t}function ln(e,l,t){var a,n;eQ||eR(!0);let d=la(null==e?void 0:e.mdAmount,null==e?void 0:e.mdType),i=(0,O.Ch)({priceType:(null==e?void 0:e.priceType)||0,basePrice:parseFloat(null==e?void 0:e.basePrice)||0,volume:parseFloat(null==e?void 0:e.volume)||0,weight:parseFloat(null==e?void 0:e.weight),unitPrice:parseFloat((null==e?void 0:e.unitPrice)||0),upo:parseFloat(null==e?void 0:e.upo)?parseFloat(null==e?void 0:e.upo):0,qty:parseFloat(null==e?void 0:e.qty),extendedPrice:parseFloat(null==e?void 0:e.extendedPrice),mdAmount:d,mdType:null==e?void 0:e.mdType,baseLaborPrice:0,totalWeightPerG:0,mdValue:parseFloat(null==e?void 0:e.mdValue),tdPct:(null==eU?void 0:null===(a=eU.values)||void 0===a?void 0:a.tdPct)||0,dirtyField:l}),o=(0,q.VW)({priceType:null==i?void 0:i.priceType,basePrice:null==i?void 0:i.basePrice,qty:null==i?void 0:i.qty,weight:null==i?void 0:i.weight,extendedPrice:parseFloat(null==i?void 0:i.extendedPrice),baseLaborPrice:null==i?void 0:i.baseLaborPrice,vatAmount:parseFloat(null==i?void 0:i.vatAmount),tdPct:null==eU?void 0:null===(n=eU.values)||void 0===n?void 0:n.tdPct,taxDetails:eU.values.isVattable?e.taxDetails:null}),s={...e,id:null==e?void 0:e.id,qty:(null==i?void 0:i.qty)?parseFloat(null==i?void 0:i.qty).toFixed(2):0,volume:(null==i?void 0:i.volume)?parseFloat(i.volume).toFixed(2):0,weight:parseFloat(null==i?void 0:i.weight).toFixed(2),basePrice:(null==i?void 0:i.basePrice)?parseFloat(i.basePrice).toFixed(5):0,unitPrice:(null==i?void 0:i.unitPrice)?parseFloat(i.unitPrice).toFixed(3):0,extendedPrice:(null==i?void 0:i.extendedPrice)?parseFloat(i.extendedPrice).toFixed(2):0,upo:parseFloat(null==i?void 0:i.upo).toFixed(2),mdValue:null==i?void 0:i.mdValue,mdType:null==i?void 0:i.mdType,mdAmount:(null==i?void 0:i.mdAmount)?parseFloat(i.mdAmount).toFixed(2):0,vatAmount:(null==o?void 0:o.vatAmount)?parseFloat(o.vatAmount).toFixed(2):0};return t?{changes:s}:s}let ld=null===(F=eU.values.items)||void 0===F?void 0:F.filter(e=>void 0!==e.itemId).map(e=>({...e,basePrice:parseFloat(e.basePrice)||0,unitPrice:parseFloat(e.unitPrice)||0,upo:parseFloat(e.upo)||0,vatAmount:parseFloat(e.vatAmount)||0,weight:parseFloat(e.weight)||0,volume:parseFloat(e.volume)||0,extendedPrice:parseFloat(e.extendedPrice)||0})),li=(0,Q.Ww)(ld),lo=0==eU.values.miscAmount?0:parseFloat(eU.values.miscAmount),ls=(0,Q.Ot)(ld,{totalQty:0,totalWeight:0,totalVolume:0,totalUpo:0,sumVat:0,sumExtended:parseFloat(li),tdAmount:parseFloat(eU.values.tdAmount),net:0,miscAmount:lo}),lr=eQ?null==ls?void 0:ls.totalQty:(null===(X=eU.values)||void 0===X?void 0:X.qty)||0,lu=eQ?null==ls?void 0:ls.net:(null===(U=eU.values)||void 0===U?void 0:U.amount)||0,lc=eQ?null==ls?void 0:ls.totalVolume:(null===(K=eU.values)||void 0===K?void 0:K.volume)||0,lv=eQ?null==ls?void 0:ls.totalWeight:(null===(Y=eU.values)||void 0===Y?void 0:Y.weight)||0,lm=eQ?li:(null===(H=eU.values)||void 0===H?void 0:H.subtotal)||0,lp=eQ?null==ls?void 0:ls.sumVat:(null===(G=eU.values)||void 0===G?void 0:G.vatAmount)||0;function lx(e,l,t,a){!function(e,l,t,a){var n;let d=(0,Q.Yi)({tdAmount:parseFloat(a),tdPlain:1==e,tdPct:2==e,tdType:e,subtotal:lm,currentDiscount:a,hiddenTdPct:l,hiddenTdAmount:parseFloat(t),typeChange:e});eU.setFieldValue("tdAmount",(null==d?void 0:d.hiddenTdAmount)?null==d?void 0:null===(n=d.hiddenTdAmount)||void 0===n?void 0:n.toFixed(2):0),eU.setFieldValue("tdType",null==d?void 0:d.tdType),eU.setFieldValue("currentDiscount",(null==d?void 0:d.currentDiscount)||0),eU.setFieldValue("tdPct",null==d?void 0:d.hiddenTdPct)}(e,l,t,a),eU.values.items.map((e,t)=>{let a=(0,q.VW)({priceType:null==e?void 0:e.priceType,basePrice:parseFloat(null==e?void 0:e.basePrice),qty:null==e?void 0:e.qty,weight:null==e?void 0:e.weight,extendedPrice:parseFloat(null==e?void 0:e.extendedPrice),baseLaborPrice:parseFloat(null==e?void 0:e.baseLaborPrice),vatAmount:parseFloat(null==e?void 0:e.vatAmount),tdPct:l,taxDetails:eU.values.isVattable?e.taxDetails:null});eU.setFieldValue("items[".concat(t,"].vatAmount"),parseFloat(null==a?void 0:a.vatAmount).toFixed(2))})}async function ly(e){let l=await e3(e),t=await e9(e),a=await e6(l.record.clientId);await e1(l,t,a)}function lI(e){Object.entries(e).forEach(e=>{let[l,t]=e;eU.setFieldValue(l,t)})}let lf=async()=>await eP({extension:j.$.MeasurementUnit.qry,parameters:"_msId=0"});async function lF(e){var l;if(!e)return;let t=await eP({extension:j.$.Site.get,parameters:"_recordId=".concat(e)});return null==t?void 0:null===(l=t.record)||void 0===l?void 0:l.reference}async function lh(){let e=["siteId","salesTD","plId"],l=["plantId","siteId","spId"],t=((null==ew?void 0:ew.list)||[]).reduce((l,t)=>{let{key:a,value:n}=t;return e.includes(a)&&(l[a]="True"===n||"False"===n?n:n?parseInt(n):null),l},{}),a=((null==eC?void 0:eC.list)||[]).reduce((e,t)=>{let{key:a,value:n}=t;return l.includes(a)&&(e[a]=n?parseInt(n):null),e},{});return eq({userDefaultsList:a,systemDefaultsList:t}),{userDefaultsList:a,systemDefaultsList:t}}async function lb(e){Object.entries(e).forEach(e=>{let[l,t]=e;eU.setFieldValue(l,t)})}async function lP(e){var l,t;if(!e)return;let a=await eP({extension:I.P.DocumentTypeDefault.get,parameters:"_dtId=".concat(e)}),n=await eW((null==a?void 0:null===(l=a.record)||void 0===l?void 0:l.spId)||eO.userDefaultsList.spId);eU.setFieldValue("spId",n),eU.setFieldValue("plantId",(null==a?void 0:null===(t=a.record)||void 0===t?void 0:t.plantId)||eO.userDefaultsList.plantId||null)}return(0,n.useEffect)(()=>{let e="",{name:l,street1:t,street2:a,city:n,phone:d,phone2:i,email1:o}=eT;(l||t||a||n||d||i||o)&&(e="".concat(l||"","\n").concat(t||"","\n").concat(a||"","\n").concat(n||"","\n").concat(d||"","\n").concat(i||"","\n").concat(o||"")),eU.setFieldValue("shipAddress",e),eU.setFieldValue("serializedAddress",e)},[eT]),(0,n.useEffect)(()=>{eU.setFieldValue("qty",parseFloat(lr).toFixed(2)),eU.setFieldValue("amount",parseFloat(lu).toFixed(2)),eU.setFieldValue("volume",parseFloat(lc).toFixed(2)),eU.setFieldValue("weight",parseFloat(lv).toFixed(2)),eU.setFieldValue("subtotal",parseFloat(lm).toFixed(2)),eU.setFieldValue("vatAmount",parseFloat(lp).toFixed(2))},[lr,lu,lc,lv,lm,lp]),(0,n.useEffect)(()=>{if(eQ){let e=parseFloat(eU.values.tdPct)*parseFloat(lm)/100;lx(eU.values.tdType,eU.values.tdPct,e,eU.values.currentDiscount)}},[lm]),(0,n.useEffect)(()=>{var e,l;(null===(e=eU.values)||void 0===e?void 0:e.dtId)&&!eF&&lP(null===(l=eU.values)||void 0===l?void 0:l.dtId)},[null===(ee=eU.values)||void 0===ee?void 0:ee.dtId]),(0,n.useEffect)(()=>{!async function(){let e=await lf();e_(null==e?void 0:e.list);let l=await lh();if(eF)await ly(eF);else{var t;l.systemDefaultsList.salesTD?(eZ({text:"%",value:2}),eU.setFieldValue("tdType",2)):(eZ({text:"123",value:1}),eU.setFieldValue("tdType",1));let e=l.userDefaultsList.siteId,a=l.systemDefaultsList.siteId,n=l.userDefaultsList.plantId,d=l.userDefaultsList.spId;eU.setFieldValue("siteId",parseInt(e||a));let i=await eW(d);eU.setFieldValue("spId",i),eU.setFieldValue("plantId",parseInt(n)),eU.setFieldValue("plId",parseInt(null==l?void 0:null===(t=l.systemDefaultsList)||void 0===t?void 0:t.plId))}}()},[]),(0,a.jsx)(g.Z,{resourceId:u.i.SalesQuotations,functionId:y.J.SalesQuotation,form:eU,maxAccess:eE,previewReport:eK,actions:e2,editMode:eK,disabledSubmit:!eY,disabledSavedClear:!eY,children:(0,a.jsxs)(c.R,{children:[(0,a.jsx)(v.g,{children:(0,a.jsxs)(P.ZP,{container:!0,spacing:2,children:[(0,a.jsx)(P.ZP,{item:!0,xs:3,children:(0,a.jsxs)(P.ZP,{container:!0,spacing:2,children:[(0,a.jsx)(P.ZP,{item:!0,xs:12,children:(0,a.jsx)(w.Z,{endpointId:C.r.DocumentType.qry,parameters:"_startAt=0&_pageSize=1000&_dgId=".concat(y.J.SalesQuotation),name:"dtId",label:eI.documentType,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],readOnly:eK,valueField:"recordId",displayField:["reference","name"],values:eU.values,maxAccess:eE,onChange:(e,l)=>{eU.setFieldValue("dtId",null==l?void 0:l.recordId),eB(l)},error:eU.touched.dtId&&!!eU.errors.dtId})}),(0,a.jsx)(P.ZP,{item:!0,xs:12,children:(0,a.jsx)(D.Z,{name:"reference",label:eI.reference,value:null==eU?void 0:null===(el=eU.values)||void 0===el?void 0:el.reference,maxAccess:!eK&&eE,readOnly:eK,onChange:eU.handleChange,onClear:()=>eU.setFieldValue("reference",null),error:eU.touched.reference&&!!eU.errors.reference})}),(0,a.jsx)(P.ZP,{item:!0,xs:10,children:(0,a.jsx)(Z.U,{endpointId:I.P.Client.snapshot,valueField:"reference",displayField:"name",secondFieldLabel:eI.name,name:"clientId",label:eI.client,form:eU,readOnly:(null==eU?void 0:null===(et=eU.values)||void 0===et?void 0:et.bpId)||(null==eU?void 0:null===(en=eU.values)||void 0===en?void 0:null===(ea=en.items)||void 0===ea?void 0:ea.some(e=>e.itemId)),displayFieldWidth:4,valueShow:"clientRef",secondValueShow:"clientName",maxAccess:eE,editMode:eK,required:!eU.values.bpId,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],onChange:async(e,l)=>{e8(null==l?void 0:l.recordId),eU.setFieldValue("isVattable",(null==l?void 0:l.isSubjectToVAT)||!1),eU.setFieldValue("taxId",null==l?void 0:l.taxId),eU.setFieldValue("maxDiscount",null==l?void 0:l.maxDiscount),eU.setFieldValue("clientName",null==l?void 0:l.name),eU.setFieldValue("clientRef",null==l?void 0:l.reference),eU.setFieldValue("clientId",(null==l?void 0:l.recordId)||null)},errorCheck:"clientId"})}),(0,a.jsx)(P.ZP,{item:!0,children:(0,a.jsx)(M.Z,{onClick:()=>{eg({Component:$.Z,props:{formValues:eU.values,onSubmit:e=>lb(e)}})},image:"popup.png",disabled:!(eK&&eY&&eU.values.clientId),tooltipText:eV.editClient})}),(0,a.jsx)(P.ZP,{item:!0,xs:12,children:(0,a.jsx)(Z.U,{endpointId:B.F.MasterData.qry2,parameters:{_functionId:y.J.SalesQuotation,_startAt:0,_pageSize:1e3,_sortBy:"reference desc"},valueField:"reference",displayField:"name",name:"bpId",label:eI.lead,form:eU,required:!eU.values.clientId,readOnly:(null==eU?void 0:null===(ed=eU.values)||void 0===ed?void 0:ed.clientId)||(null==eU?void 0:null===(eo=eU.values)||void 0===eo?void 0:null===(ei=eo.items)||void 0===ei?void 0:ei.some(e=>e.itemId)),displayFieldWidth:3,valueShow:"bpRef",secondValueShow:"bpName",maxAccess:eE,editMode:eK,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],onChange:async(e,l)=>{e7(null==l?void 0:l.recordId),eU.setFieldValue("bpName",(null==l?void 0:l.name)||""),eU.setFieldValue("bpRef",(null==l?void 0:l.reference)||""),eU.setFieldValue("bpId",(null==l?void 0:l.recordId)||null)},errorCheck:"bpId"})})]})}),(0,a.jsx)(P.ZP,{item:!0,xs:3,children:(0,a.jsxs)(P.ZP,{container:!0,spacing:2,children:[(0,a.jsx)(P.ZP,{item:!0,xs:12,children:(0,a.jsx)(w.Z,{endpointId:I.P.SalesPerson.qry,name:"spId",label:eI.salesPerson,filter:eK?void 0:e=>!e.isInactive,columnsInDropDown:[{key:"spRef",value:"Reference"},{key:"name",value:"Name"}],readOnly:!eY,valueField:"recordId",displayField:"name",values:eU.values,displayFieldWidth:1.5,onChange:(e,l)=>{eU.setFieldValue("spId",null==l?void 0:l.recordId)},error:eU.touched.spId&&!!eU.errors.spId})}),(0,a.jsx)(P.ZP,{item:!0,xs:12,children:(0,a.jsx)(h.Z,{name:"date",required:!0,label:eI.date,value:null==eU?void 0:null===(es=eU.values)||void 0===es?void 0:es.date,onChange:eU.setFieldValue,editMode:eK,readOnly:!eY,maxAccess:eE,onClear:()=>eU.setFieldValue("date",null),error:eU.touched.date&&!!eU.errors.date})}),(0,a.jsx)(P.ZP,{item:!0,xs:12,children:(0,a.jsx)(w.Z,{endpointId:k.H.TaxSchedules.qry,name:"taxId",label:eI.tax,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],readOnly:!0,values:eU.values,onChange:(e,l)=>{eU.setFieldValue("taxId",l?l.recordId:"")},error:eU.touched.taxId&&!!eU.errors.taxId,maxAccess:eE})}),(0,a.jsx)(P.ZP,{item:!0,xs:12,children:(0,a.jsx)(w.Z,{endpointId:I.P.SalesZone.qry,parameters:'_startAt=0&_pageSize=1000&_sortField="recordId"&_filter=',name:"szId",label:eI.saleZone,valueField:"recordId",displayField:"name",readOnly:!eY,values:eU.values,displayFieldWidth:1.5,onChange:(e,l)=>{eU.setFieldValue("szId",null==l?void 0:l.recordId)},error:eU.touched.szId&&!!eU.errors.szId})})]})}),(0,a.jsx)(P.ZP,{item:!0,xs:3,children:(0,a.jsxs)(P.ZP,{container:!0,spacing:2,children:[(0,a.jsx)(P.ZP,{item:!0,xs:12,children:(0,a.jsx)(w.Z,{endpointId:C.r.Currency.qry,name:"currencyId",label:eI.currency,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],required:!0,readOnly:null==eU?void 0:null===(eu=eU.values)||void 0===eu?void 0:null===(er=eu.items)||void 0===er?void 0:er.some(e=>e.itemId),values:eU.values,maxAccess:eE,onChange:(e,l)=>{eU.setFieldValue("items",[{id:1}]),eU.setFieldValue("currencyId",(null==l?void 0:l.recordId)||null)},error:eU.touched.currencyId&&!!eU.errors.currencyId})}),(0,a.jsx)(P.ZP,{item:!0,xs:12,children:(0,a.jsx)(w.Z,{endpointId:C.r.Plant.qry,name:"plantId",label:eI.plant,readOnly:!eY,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:eU.values,valueField:"recordId",displayField:["reference","name"],maxAccess:eE,onChange:(e,l)=>{eU.setFieldValue("plantId",null==l?void 0:l.recordId)},displayFieldWidth:2,error:eU.touched.plantId&&!!eU.errors.plantId})}),(0,a.jsx)(P.ZP,{item:!0,xs:12,children:(0,a.jsx)(w.Z,{endpointId:j.$.Site.qry,name:"siteId",readOnly:!eY,label:eI.site,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:eU.values,valueField:"recordId",displayField:["reference","name"],maxAccess:eE,displayFieldWidth:2,onChange:(e,l)=>{eU.setFieldValue("siteId",null==l?void 0:l.recordId),eU.setFieldValue("siteRef",l?l.reference:null),eU.setFieldValue("siteName",l?l.name:null)},error:eU.touched.siteId&&!!eU.errors.siteId})}),(0,a.jsx)(P.ZP,{item:!0,xs:12,children:(0,a.jsx)(z.Z,{name:"isVattable",value:null===(ec=eU.values)||void 0===ec?void 0:ec.isVattable,onChange:e=>eU.setFieldValue("isVattable",e.target.checked),label:eI.VAT,disabled:!0,maxAccess:eE})})]})}),(0,a.jsx)(P.ZP,{item:!0,xs:3,children:(0,a.jsxs)(P.ZP,{container:!0,spacing:2,children:[(0,a.jsx)(P.ZP,{item:!0,xs:12,children:(0,a.jsx)(V.Z,{name:"shipAddress",label:eI.shipTo,value:eU.values.shipAddress,rows:2.5,maxLength:"100",readOnly:!0,disabled:eU.values.exWorks,maxAccess:eE,viewDropDown:eU.values.clientId||eU.values.bpId,viewAdd:(eU.values.clientId||eU.values.bpId)&&!eK,onChange:e=>eU.setFieldValue("shipAddress",e.target.value),onClear:()=>eU.setFieldValue("shipAddress",null),onDropDown:()=>{var e;eg({Component:R.Z,props:{maxAccess:eE,labels:eI,shipment:!0,checkedAddressId:null===(e=eU.values)||void 0===e?void 0:e.shipToAddressId,form:eU.values,handleAddressValues:lI}})},handleAddAction:()=>void eg({Component:W.Z,props:{address:eT,setAddress:eS,datasetId:u.i.ADDSalesQuotations,isCleared:!1}})})}),(0,a.jsx)(P.ZP,{item:!0,xs:12,children:(0,a.jsx)(S.Z,{name:"validity",label:eI.validity,value:null==eU?void 0:null===(ev=eU.values)||void 0===ev?void 0:ev.validity,maxAccess:eE,readOnly:!eY,onChange:e=>{if(eU.handleChange(e),e.target.value){let l=new Date(eU.values.date);l.setDate(l.getDate()+Number(e.target.value)),eU.setFieldValue("expiryDate",l)}else eU.setFieldValue("expiryDate",null)},onClear:()=>{eU.setFieldValue("validity",0),eU.setFieldValue("expiryDate",null)},error:eU.touched.validity&&!!eU.errors.validity})}),(0,a.jsx)(P.ZP,{item:!0,xs:12,children:(0,a.jsx)(h.Z,{name:"expiryDate",label:eI.expiryDate,value:null==eU?void 0:null===(em=eU.values)||void 0===em?void 0:em.expiryDate,onChange:eU.setFieldValue,editMode:eK,readOnly:!0,maxAccess:eE,onClear:()=>eU.setFieldValue("expiryDate",null),error:eU.touched.expiryDate&&!!eU.errors.expiryDate})})]})})]})}),(0,a.jsx)(m.Q,{children:(0,a.jsx)(T._,{onChange:(e,l)=>{eU.setFieldValue("items",e),"delete"===l&&eR(!0)},onSelectionChange:(e,l,t)=>{"muRef"==t&&eH(null==e?void 0:e.itemId,null==e?void 0:e.msId)},initialValues:null==eU?void 0:null===(ex=eU.initialValues)||void 0===ex?void 0:null===(ep=ex.items)||void 0===ep?void 0:ep[0],value:eU.values.items,error:eU.errors.items,columns:eG,name:"items",maxAccess:eE,disabled:!eU.values.clientId&&!eU.values.bpId||!eY,allowDelete:eY})}),(0,a.jsx)(v.g,{children:(0,a.jsxs)(P.ZP,{container:!0,spacing:2,sx:{pt:2},children:[(0,a.jsx)(P.ZP,{item:!0,xs:6,children:(0,a.jsx)(P.ZP,{item:!0,xs:12,children:(0,a.jsx)(V.Z,{name:"description",label:eI.description,value:eU.values.description,rows:3,editMode:eK,readOnly:!eY,maxAccess:eE,onChange:e=>eU.setFieldValue("description",e.target.value),onClear:()=>eU.setFieldValue("description",null),error:eU.touched.description&&!!eU.errors.description})})}),(0,a.jsx)(P.ZP,{item:!0,xs:3,children:(0,a.jsxs)(P.ZP,{container:!0,spacing:2,children:[(0,a.jsx)(P.ZP,{item:!0,xs:12,children:(0,a.jsx)(h.Z,{name:"deliveryDate",label:eI.deliveryDate,value:null==eU?void 0:null===(ey=eU.values)||void 0===ey?void 0:ey.deliveryDate,onChange:eU.setFieldValue,editMode:eK,readOnly:!eY,maxAccess:eE,onClear:()=>eU.setFieldValue("deliveryDate",null),error:eU.touched.deliveryDate&&!!eU.errors.deliveryDate})}),(0,a.jsx)(P.ZP,{item:!0,xs:12,children:(0,a.jsx)(S.Z,{name:"totalQTY",label:eI.totQty,value:lr,readOnly:!0})}),(0,a.jsx)(P.ZP,{item:!0,xs:12,children:(0,a.jsx)(S.Z,{name:"totalVolume",maxAccess:eE,label:eI.totVolume,value:lc,readOnly:!0})}),(0,a.jsx)(P.ZP,{item:!0,xs:12,children:(0,a.jsx)(S.Z,{name:"totalWeight",maxAccess:eE,label:eI.totWeight,value:lv,readOnly:!0})})]})}),(0,a.jsx)(P.ZP,{item:!0,xs:3,children:(0,a.jsxs)(P.ZP,{container:!0,spacing:2,children:[(0,a.jsx)(P.ZP,{item:!0,xs:12,children:(0,a.jsx)(S.Z,{name:"subTotal",maxAccess:eE,label:eI.subtotal,value:lm,readOnly:!0})}),(0,a.jsx)(P.ZP,{item:!0,xs:12,children:(0,a.jsx)(S.Z,{name:"discount",maxAccess:eE,label:eI.discount,value:eU.values.currentDiscount,displayCycleButton:!0,readOnly:!eY,iconKey:ej.text,cycleButtonLabel:ej.text,decimalScale:2,handleButtonClick:()=>{let e,l,t;eR(!0),1==ej.value?(e=parseFloat(l=eU.values.currentDiscount<0||eU.values.currentDiscount>100?0:eU.values.currentDiscount)*parseFloat(lm)/100,t=l,eU.setFieldValue("tdAmount",e),eU.setFieldValue("tdPct",l),eU.setFieldValue("currentDiscount",l)):(l=parseFloat(e=eU.values.currentDiscount<0||lm<eU.values.currentDiscount?0:eU.values.currentDiscount)/parseFloat(lm)*100,t=e,eU.setFieldValue("tdPct",l),eU.setFieldValue("tdAmount",e),eU.setFieldValue("currentDiscount",e)),eZ(a=>{let n="%"===a.text?{text:"123",value:1}:{text:"%",value:2};return eU.setFieldValue("tdType",n.value),lx(n.value,l,e,t),n})},ShowDiscountIcons:!0,onChange:e=>{let l=Number(e.target.value.replace(/,/g,""));1==eU.values.tdType?((l<0||lm<l)&&(l=0),eU.setFieldValue("tdAmount",l)):((l<0||l>100)&&(l=0),eU.setFieldValue("tdPct",l)),eU.setFieldValue("currentDiscount",l)},onBlur:async e=>{eR(!0);let l=Number(e.target.value.replace(/,/g,"")),t=Number(e.target.value.replace(/,/g,"")),a=Number(e.target.value.replace(/,/g,""));1==eU.values.tdType&&(t=parseFloat(l)/parseFloat(lm)*100,eU.setFieldValue("tdPct",t)),2==eU.values.tdType&&(a=parseFloat(l)*parseFloat(lm)/100,eU.setFieldValue("tdAmount",a)),lx(eU.values.tdType,t,a,l)},onClear:()=>{eU.setFieldValue("tdAmount",0),eU.setFieldValue("tdPct",0),lx(eU.values.tdType,0,0,0)}})}),(0,a.jsx)(P.ZP,{item:!0,xs:12,children:(0,a.jsx)(S.Z,{name:"miscAmount",maxAccess:eE,label:eI.misc,value:eU.values.miscAmount||0,decimalScale:2,readOnly:!eY,onChange:e=>eU.setFieldValue("miscAmount",e.target.value),onBlur:async()=>{eR(!0)},onClear:()=>{eU.setFieldValue("miscAmount",0)}})}),(0,a.jsx)(P.ZP,{item:!0,xs:12,children:(0,a.jsx)(S.Z,{name:"vatAmount",maxAccess:eE,label:eI.VAT,value:lp,readOnly:!0})}),(0,a.jsx)(P.ZP,{item:!0,xs:12,children:(0,a.jsx)(S.Z,{name:"amount",maxAccess:eE,label:eI.net,value:lu,readOnly:!0})})]})})]})})]})})}var U=()=>{let{postRequest:e,getRequest:l}=(0,n.useContext)(i.$),{platformLabels:t,defaultsData:h}=(0,n.useContext)(p.l),{stack:b}=(0,r.zY)(),{stack:P}=(0,f.V)(),{query:{data:A},filterBy:g,refetch:D,labels:V,access:w,paginationParameters:C,invalidate:j}=(0,d.J)({queryFn:T,endpointId:I.P.SalesQuotations.page,datasetId:u.i.SalesQuotations,filter:{filterFn:S}}),Z=[{field:"reference",headerName:V.reference,flex:1},{field:"statusName",headerName:V.status,flex:1},{field:"date",headerName:V.date,flex:1,type:"date"},{field:"clientName",headerName:V.client,flex:1},{field:"leadName",headerName:V.lead,flex:1},{field:"spRef",headerName:V.salesPerson,flex:1},{field:"szName",headerName:V.saleZone,flex:1},{field:"volume",headerName:V.volume,flex:1,type:"number"},{field:"amount",headerName:V.net,flex:1,type:"number"},{field:"description",headerName:V.description,flex:2}];async function T(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{_startAt:t=0,_pageSize:a=50,params:n=[]}=e;return{...await l({extension:I.P.SalesQuotations.page,parameters:"_startAt=".concat(t,"&_pageSize=").concat(a,"&_sortBy=recordId desc&_params=").concat(n,"&filter=")}),_startAt:t}}async function S(e){let{filters:t,pagination:a}=e;return t.qry?await l({extension:I.P.SalesQuotations.snapshot,parameters:"_filter=".concat(t.qry)}):T({_startAt:a._startAt||0,params:null==t?void 0:t.params})}async function k(){var e;let l=null==h?void 0:null===(e=h.list)||void 0===e?void 0:e.find(e=>{let{key:l}=e;return"currencyId"===l});return parseInt(null==l?void 0:l.value)}let{proxyAction:N}=(0,x.G)({functionId:y.J.SalesQuotation,action:async()=>{await k()?O():P({message:V.noSelectedCurrency})}}),_=async()=>{N()};async function O(e){b({Component:X,props:{labels:V,access:w,currency:await k(),recordId:e},width:1300,height:730,title:V.salesQuotations})}let q=async l=>{await e({extension:I.P.SalesQuotations.del,record:JSON.stringify(l)}),j(),s.ZP.success(t.Deleted)};return(0,a.jsxs)(c.R,{children:[(0,a.jsx)(v.g,{children:(0,a.jsx)(F.Z,{onAdd:_,maxAccess:w,filterBy:g,reportName:"SAQT"})}),(0,a.jsx)(m.Q,{children:(0,a.jsx)(o.Z,{name:"table",columns:Z,gridData:A,rowId:["recordId"],onEdit:e=>{O(null==e?void 0:e.recordId)},refetch:D,onDelete:q,deleteConfirmationType:"strict",isLoading:!1,pageSize:50,maxAccess:w,paginationParameters:C,paginationType:"api"})})]})}},67920:function(e,l,t){"use strict";t.d(l,{m:function(){return n}});var a=t(48601);function n(e,l,t){var n;let d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"items",i={...e};return null==t||null===(n=t.record)||void 0===n||n.controls.forEach(e=>{let{controlId:l,accessLevel:t}=e,[a,n]=null==l?void 0:l.split(".");a!==d||2!==t||n in i||(i[n]=e=>(null==e?void 0:e[n])!=null),(1===t||4===t)&&n in i&&delete i[n]}),{schema:a.Ry().shape({...Object.keys(i).reduce((e,t)=>(e[t]=a.nK().nullable().test(function(e){var a;let n=this.parent,[,d]=this.path.match(/^(\w+)\[(\d+)\]/)||[],o=(null===(a=this.options.context)||void 0===a?void 0:a[d])||[];if(l||!l&&o.length>1){if(null!==n[t]&&void 0!==n[t]&&0!==n[t]&&""!==i[t]&&!i[t](n))return!1;if(!Object.entries(i).some(e=>{let[,l]=e;return!!l(n)}))return!0}return!!i[t](n)&&void 0!==e}),e),{})}),requiredFields:i}}},45937:function(e,l,t){"use strict";var a=t(52322),n=t(38449),d=t(93894),i=t(2784),o=t(65950),s=t(19473),r=t(21326);let u=e=>{let{recordId:l,editMode:t,onSubmit:u=()=>{},window:c,actions:v=[],address:m,setAddress:p,required:x=!0,...y}=e,{getRequest:I,postRequest:f}=(0,i.useContext)(o.$),{platformLabels:F}=(0,i.useContext)(s.l),[h,b]=(0,i.useState)(l||null),[P,A]=(0,i.useState)(null),g=!!m&&!!p,D=g?m:P,V=g?p:A;(0,r.Z)({title:F.Address,window:c});let w=async e=>{if(!x){V(e),u(e,c);return}let l={...e,recordId:h||(null==D?void 0:D.recordId)||null},t=await f({extension:n.r.Address.set,record:JSON.stringify(l)}),a=(null==t?void 0:t.recordId)||h||null,d={...l,recordId:a,addressId:a};b(a),V(d),u(d,c)};return(0,i.useEffect)(()=>{!g&&h&&(async()=>{let e=await I({extension:n.r.Address.get,parameters:"_filter=&_recordId=".concat(h)});A((null==e?void 0:e.record)||null)})()},[h,g]),(0,a.jsx)(d.O,{editMode:t,setAddress:V,address:D,onSubmit:w,actions:v,window:c,...y})};u.width=600,u.height=500,l.Z=u},93894:function(e,l,t){"use strict";t.d(l,{O:function(){return c}});var a=t(52322),n=t(2784),d=t(82737),i=t(13073),o=t(80983),s=t(31389),r=t(33625),u=t(48601);let c=e=>{let{setAddress:l,address:t,editMode:c,window:v,readOnly:m,allowPost:p=!0,optional:x=!1,onSubmit:y,isSavedClear:I=!0,isCleared:f=!0,changeClear:F=!1,actions:h=[],...b}=e,[P,A]=(0,n.useState)(!x),[g,D]=(0,n.useState)({}),{formik:V}=(0,o.c)({maxAccess:g.maxAccess,initialValues:{recordId:null,name:"",countryId:null,countryName:"",stateId:null,stateName:"",cityId:null,city:"",street1:"",street2:"",email1:"",email2:"",phone:"",phone2:"",phone3:"",addressId:null,postalCode:"",cityDistrictId:null,cityDistrict:"",bldgNo:"",unitNo:"",subNo:"",poBox:""},validateOnChange:!0,validateOnBlur:!0,validationSchema:u.Ry({...g.validate}),onSubmit:e=>{l(e),p?y(e,v):v.close()}});return(0,n.useEffect)(()=>{x&&(V.values.name||V.values.street1||V.values.countryId||V.values.cityId)&&A(!0),!x||V.values.name||V.values.street1||V.values.countryId||V.values.cityId||A(!1)},[V.values]),(0,a.jsx)(d.Z,{form:V,maxAccess:g.maxAccess,isInfo:!1,disabledSubmit:m,editMode:c,isSavedClear:I,isCleared:f,onClear:F?()=>{V.resetForm({values:V.initialValues})}:void 0,actions:h,...b,children:(0,a.jsx)(s.R,{children:(0,a.jsx)(r.g,{children:(0,a.jsx)(i.Z,{addressValidation:V,readOnly:m,required:P,setFormik:D,address:t,...b})})})})}}},function(e){e.O(0,[92515,2494,36908,23352,13073,53491,49774,92888,40179],function(){return e(e.s=47293)}),_N_E=e.O()}]);