(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[43399],{8971:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/pm-samples",function(){return r(9793)}])},9793:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return N}});var n=r(52322),a=r(2784),l=r(71987),i=r(65950),o=r(69387),d=r(62202),s=r(61802),c=r(26612),u=r(31389),f=r(33625),m=r(62362),v=r(19473),p=r(36908),g=r(98345),h=r(7121),x=r(63518),y=r(43933),N=()=>{let{postRequest:e,getRequest:t}=(0,a.useContext)(i.$),{platformLabels:r}=(0,a.useContext)(v.l),{stack:N}=(0,s.zY)(),{query:{data:I},filterBy:_,refetch:w,labels:S,access:b,paginationParameters:R,invalidate:A}=(0,l.J)({queryFn:j,endpointId:x.z.Samples.page,datasetId:c.i.Samples,filter:{filterFn:D}}),C=[{field:"reference",headerName:S.reference,flex:1},{field:"date",headerName:S.date,flex:1,type:"date"},{field:"siteRef",headerName:S.siteRef,flex:1},{field:"siteName",headerName:S.site,flex:1},{field:"jobRef",headerName:S.jobRef,flex:1},{field:"productionStandardRef",headerName:S.productionStandard,flex:1},{field:"productionLineRef",headerName:S.productionLine,flex:1},{field:"productionLineName",headerName:S.productionLineName,flex:1},{field:"productionClassRef",headerName:S.productionClassRef,flex:1},{field:"productionClassName",headerName:S.productionClass,flex:1},{field:"designGroupName",headerName:S.designGroup,flex:1},{field:"designFamilyName",headerName:S.familyGroup,flex:1},{field:"statusName",headerName:S.statusName,flex:1},{field:"rsName",headerName:S.rsName,flex:1},{field:"wipName",headerName:S.wip,flex:1}];async function j(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{_startAt:r=0,_pageSize:n=50,params:a=[]}=e;return{...await t({extension:x.z.Samples.page,parameters:"_startAt=".concat(r,"&_pageSize=").concat(n,"&_params=").concat(a,"&filter=")}),_startAt:r}}async function D(e){let{filters:r,pagination:n}=e;return(null==r?void 0:r.qry)?await t({extension:x.z.Samples.snapshot,parameters:"_filter=".concat(r.qry)}):j({_startAt:n._startAt||0,params:null==r?void 0:r.params})}let{proxyAction:O}=(0,g.G)({functionId:h.J.Samples,action:T}),k=async()=>{await O()};async function T(e){N({Component:y.Z,props:{recordId:e}})}let q=async t=>{await e({extension:x.z.Samples.del,record:JSON.stringify(t)}),A(),d.ZP.success(r.Deleted)};return(0,n.jsxs)(u.R,{children:[(0,n.jsx)(f.g,{children:(0,n.jsx)(p.Z,{onAdd:k,maxAccess:b,filterBy:_,reportName:"PMSPL"})}),(0,n.jsx)(m.Q,{children:(0,n.jsx)(o.Z,{name:"table",columns:C,gridData:I,rowId:["recordId"],onEdit:e=>{T(e.recordId)},refetch:w,onDelete:q,deleteConfirmationType:"strict",isLoading:!1,pageSize:50,maxAccess:b,paginationParameters:R,paginationType:"api"})})]})}},67920:function(e,t,r){"use strict";r.d(t,{m:function(){return a}});var n=r(48601);function a(e,t,r){var a;let l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"items",i={...e};return null==r||null===(a=r.record)||void 0===a||a.controls.forEach(e=>{let{controlId:t,accessLevel:r}=e,[n,a]=null==t?void 0:t.split(".");n!==l||2!==r||a in i||(i[a]=e=>(null==e?void 0:e[a])!=null),(1===r||4===r)&&a in i&&delete i[a]}),{schema:n.Ry().shape({...Object.keys(i).reduce((e,r)=>(e[r]=n.nK().nullable().test(function(e){var n;let a=this.parent,[,l]=this.path.match(/^(\w+)\[(\d+)\]/)||[],o=(null===(n=this.options.context)||void 0===n?void 0:n[l])||[];if(t||!t&&o.length>1){if(null!==a[r]&&void 0!==a[r]&&0!==a[r]&&""!==i[r]&&!i[r](a))return!1;if(!Object.entries(i).some(e=>{let[,t]=e;return!!t(a)}))return!0}return!!i[r](a)&&void 0!==e}),e),{})}),requiredFields:i}}},1685:function(e,t,r){"use strict";r.d(t,{m:function(){return n}});let n=e=>{let t=window.sessionStorage.getItem(e);return t?JSON.parse(t):null}},98345:function(e,t,r){"use strict";r.d(t,{H:function(){return p},G:function(){return v}});var n=r(45300),a=r(2784),l=r(96026),i=r(38449);r(26612);var o=r(65947),d=r(1685);let s=async(e,t,r)=>{try{let n=await e({extension:t,parameters:r});return t.includes("qry")?n:n.record}catch(e){return null}},c=(e,t,r,n)=>{let a=(e=JSON.parse(JSON.stringify(e))).record.controls,l=a.find(e=>"reference"===e.controlId);return l?l.accessLevel=(null==t?void 0:t.mandatory)?o.$7:o.rr:(null==t?void 0:t.mandatory)?a.push({sgId:0,resourceId:"",controlId:"".concat(n?n+".":"","reference"),accessLevel:(null==t?void 0:t.mandatory)?o.$7:o.rr}):(null==t?void 0:t.readOnly)?a.push({sgId:0,resourceId:"",controlId:"".concat(n?n+".":"","reference"),accessLevel:(null==t?void 0:t.readOnly)?o.rr:o.$7}):a=e.record.controls.filter(e=>"reference"!=e.controlId),r&&a.push({sgId:0,resourceId:"",controlId:"".concat(n?n+".":"","dtId"),accessLevel:o.$7}),{...e,record:{...e.record,controls:a}}},u=async(e,t,r)=>{let n,a;switch(r){case"dtId":let l=(0,d.m)("userData"),o=null==l?void 0:l.userId;a="_userId=".concat(o,"&_functionId=").concat(t),n=i.r.UserFunction.get;break;case"glbSysNumberRange":a="_recordId=".concat(t),n=i.r.SystemFunction.get;break;case"DocumentType":a="_dgId=".concat(t,"&_startAt=",0,"&_pageSize=",50),n=i.r.DocumentType.qry;break;case"DcTypNumberRange":a="_recordId=".concat(t),n=i.r.DocumentType.get;break;case"isExternal":a="_recordId=".concat(t),n=i.r.NumberRange.get;break;default:return null}return await s(e,n,a)},f=async function(e){let t,r,n,a,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,d=!(arguments.length>4)||void 0===arguments[4]||arguments[4],s=arguments.length>5?arguments[5]:void 0,f=void 0===o&&l&&await u(e,l,"dtId"),m=null==f?void 0:f.dtId,v="",p=!0;if(f&&void 0===o||"nraId"===o){if(m){let r=await u(e,m,"DcTypNumberRange");t=null==r?void 0:r.nraId,p=!((null==r?void 0:r.activeStatus)<0),t||(v="Assign the document type to a number range")}if((!m||!p)&&d&&l){var g;let t=await u(e,l,"DocumentType");a=(null==t?void 0:null===(g=t.list)||void 0===g?void 0:g.filter(e=>(null==e?void 0:e.activeStatus)===1).length)>0}}if(("nraId"===o||void 0===o)&&l){if((!m||m)&&!t||t&&!p){let r=await u(e,l,"glbSysNumberRange");(t=null==r?void 0:r.nraId)&&a&&(a=!1),p=!0}v=t||a?"":"Assign the system Function to a number range"}o>0&&!t&&(t=o),t&&p?(r={readOnly:null==(n=await u(e,t,"isExternal"))||!n.external,mandatory:null!=n&&!!n.external},i&&(i=await c(i,r,a,s))):!t&&i&&(i=await c(i,r,a,s));let h=s?"".concat(s,".reference"):"reference";return{dtId:m,resetReference:null==r?void 0:r.readOnly,dcTypeRequired:a,reference:{fieldName:h,isEmpty:(null==n?void 0:n.external)!==void 0&&(null==n||!n.external)},errorMessage:v,maxAccess:i,selectNraId:o}};var m=r(65950);function v(e){let{functionId:t,action:r,hasDT:n}=e,{getRequest:i}=(0,a.useContext)(m.$),{stack:o}=(0,l.V)();return{proxyAction:async()=>{let e=await f(i,t,"",void 0,n);(null==e?void 0:e.errorMessage)?o({message:null==e?void 0:e.errorMessage}):await r()}}}function p(e){var t;let{functionId:r,access:i,hasDT:o,enabled:d=!0,objectName:s=""}=e,{getRequest:c}=(0,a.useContext)(m.$),{stack:u}=(0,l.V)(),[v,p]=(0,a.useState)(),g=async e=>{let t=await f(c,r,i,e,o,s);if(!t.errorMessage)return t;u({message:null==t?void 0:t.errorMessage})},h=(0,n.a)({retry:!1,staleTime:0,enabled:d,queryKey:[r,v,!!i,d],queryFn:v||"nraId"===v?()=>g(v):()=>g()});return{documentType:h.data,maxAccess:(null==h?void 0:null===(t=h.data)||void 0===t?void 0:t.maxAccess)||i,changeDT(e){p((null==e?void 0:e.nraId)||"nraId")}}}},2801:function(e,t,r){"use strict";var n=r(52322),a=r(23925),l=r(2784),i=r(80983),o=r(65950),d=r(38449),s=r(19473),c=r(35656),u=r(10498),f=r.n(u),m=r(69627);let v=(0,l.forwardRef)((e,t)=>{let{resourceId:u,error:v,seqNo:p,recordId:g,width:h=140,height:x=140,customWidth:y,customHeight:N,disabled:I=!1,isAbsolutePath:_=!1,parentImage:w}=e,S=(0,l.useRef)(null),b=(0,l.useRef)(null),R=(0,l.useRef)({}),{getRequest:A,postRequest:C}=(0,l.useContext)(o.$),{platformLabels:j}=(0,l.useContext)(s.l),[D,O]=(0,l.useState)(""),k=null==w?void 0:w.recordId,T=null==w?void 0:w.resourceId,{formik:q}=(0,i.c)({initialValues:{}}),{width:F}=(0,c.d)(),E=F>=1680?1:F>=1600?.9:F<=1024?.7:.7+(F-1024)/576*.22000000000000008;(0,l.useImperativeHandle)(t,()=>({submit:J}));let J=()=>{var e,r,n,a,l,i,o,s,c,f,m,v;if(I)return;let p=(null==t?void 0:null===(e=t.current)||void 0===e?void 0:e.value)||g;if(_){if((null===(i=q.values)||void 0===i?void 0:null===(l=i.file)||void 0===l?void 0:l.name)||q.values.url){let e={...q.values,fileName:(null===(c=q.values.file)||void 0===c?void 0:c.name)||q.values.url,resourceId:u,recordId:p};return C({extension:d.r.Attachment.set2,record:JSON.stringify(e),file:null===(f=q.values)||void 0===f?void 0:f.file}).then(()=>z(p))}return D||null===(o=R.current)||void 0===o||!o.fileName||(null===(s=q.values)||void 0===s?void 0:s.fileName)?void 0:C({extension:d.r.Attachment.del,record:JSON.stringify(R.current)}).then(()=>z(p))}if(null===(r=q.values)||void 0===r?void 0:r.file){let e={...q.values,recordId:p};return C({extension:d.r.Attachment.set,record:JSON.stringify(e),file:null===(m=q.values)||void 0===m?void 0:m.file}).then(()=>z(p))}if(!D&&(null===(n=R.current)||void 0===n?void 0:n.url)&&!(null===(a=q.values)||void 0===a?void 0:a.url))return C({extension:d.r.Attachment.del,record:JSON.stringify(R.current),file:null===(v=R.current)||void 0===v?void 0:v.url}).then(()=>z(p))},L=()=>{O(""),q.setValues({})},z=async e=>{let t=e||g;if(!u)return;if(_&&t){let e=await A({extension:d.r.Attachment.get2,parameters:"_resourceId=".concat(u,"&_seqNo=").concat(p,"&_recordId=").concat(t)}),r=(null==e?void 0:e.record)||{};q.setValues({...r,resourceId:u}),R.current={...r,resourceId:u},O((null==r?void 0:r.fileName)?"".concat(r.fileName,"?t=").concat(Date.now()):"");return}let r=T||u,n=k||t;if(!n)return;let a=await A({extension:d.r.Attachment.get,parameters:"_resourceId=".concat(r,"&_seqNo=").concat(p,"&_recordId=").concat(n)}),l=(null==a?void 0:a.record)||{};q.setValues({...l,resourceId:r}),R.current={...l,resourceId:r},O((null==l?void 0:l.url)?"".concat(l.url,"?t=").concat(Date.now()):"")};return(0,l.useEffect)(()=>{k||g?z():L()},[k,g]),(0,n.jsxs)(a.Z,{className:f().container,children:[(0,n.jsx)(a.Z,{className:f().previewBox,style:{width:"100%",maxWidth:(y||h)*E,height:(N||x)*E},onClick:()=>{I||S.current.click()},children:(0,n.jsx)("img",{src:D||r(68802).default.src,alt:"",className:f().previewImage,style:{border:v?"2px solid #F44336":"none"},onError:e=>{e.currentTarget.src=r(68802).default.src}})}),(0,n.jsxs)(a.Z,{className:f().bottomSection,children:[(0,n.jsx)("input",{hidden:!0,type:"file",accept:"image/png, image/jpeg, image/jpg",ref:S,onChange:e=>{var t,r;let n=null==e?void 0:null===(r=e.target)||void 0===r?void 0:null===(t=r.files)||void 0===t?void 0:t[0];if(!n)return;if(Math.round(n.size/1024)>500){alert(j.MaxFileSize);return}let a=new Date(n.lastModifiedDate),l="".concat(a.getDate(),"/").concat(a.getMonth()+1,"/").concat(a.getFullYear());q.setValues({resourceId:u,recordId:g,seqNo:0,fileName:n.name,folderId:null,folderName:null,date:l,url:null,file:n});let i=new FileReader;b.current=i,i.onloadend=e=>O(e.target.result),i.readAsDataURL(n)},disabled:I}),(0,n.jsx)(m.Z,{onClick:L,image:"clear.png",tooltipText:j.Clear,color:"#F44336",border:"none",disabled:I})]})]})});t.Z=v},10498:function(e){e.exports={container:"ImageUpload_container__I2BWx",previewBox:"ImageUpload_previewBox__JogCN",previewImage:"ImageUpload_previewImage___eqQX",bottomSection:"ImageUpload_bottomSection__jpph8"}}},function(e){e.O(0,[92515,2494,36908,43933,49774,92888,40179],function(){return e(e.s=8971)}),_N_E=e.O()}]);