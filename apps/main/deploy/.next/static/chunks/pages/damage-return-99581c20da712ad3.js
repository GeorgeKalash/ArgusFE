(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[82148],{2827:function(e,n,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/damage-return",function(){return a(28134)}])},28134:function(e,n,a){"use strict";a.r(n),a.d(n,{default:function(){return O}});var r=a(52322),l=a(2784),d=a(71987),t=a(65950),o=a(69387),s=a(62202),i=a(61802),u=a(26612),c=a(31389),m=a(33625),v=a(62362),x=a(19473),f=a(90587),g=a(89330),p=a(39812),y=a(60218),I=a(48601),h=a(82737),j=a(5088),b=a(21581),R=a(8661),N=a(38449),w=a(7121),k=a(27423),Z=a(91406),_=a(80983),P=a(98345),C=a(84100);function D(e){var n,a,o,i,m,D,F,O,A,q,S;let{labels:T,access:V,recordId:J}=e,{getRequest:E,postRequest:M}=(0,l.useContext)(t.$),{platformLabels:$}=(0,l.useContext)(x.l),{documentType:L,maxAccess:z,changeDT:U}=(0,P.H)({functionId:w.J.DamageReturn,access:V,enabled:!J}),G=(0,d.E)({endpointId:f.u.DamageReturn.page}),{formik:H}=(0,_.c)({maxAccess:z,documentType:{key:"dtId",value:null==L?void 0:L.dtId},initialValues:{recordId:J,dtId:null,reference:"",date:new Date,plantId:null,notes:"",status:1,jobId:null,seqNo:0,pcs:0,workCenterId:null,maxPcs:null,type:null,damageId:null},validateOnChange:!0,validationSchema:I.Ry({plantId:I.Z_().required(),jobId:I.Z_().required(),date:I.Z_().required(),type:I.Z_().required(),pcs:I.Vo((e,n)=>{let{parent:a}=n;return null!==a.maxPcs?I.Rx().min(1).max(a.maxPcs,e=>{let{max:n}=e;return T.max+" ".concat(n)}).required():I.Rx().min(1).required()}),damageId:I.Z_().nullable().test(function(e){let{type:n}=this.parent;return"1"!==n||null!=e&&""!==e.trim()})}),onSubmit:async e=>{M({extension:f.u.DamageReturn.set,record:JSON.stringify({...e,date:(0,p.ku)(e.date)})}).then(async e=>{s.ZP.success(J?$.Edited:$.Added),await Q(e.recordId),G()})}});async function Q(e){await E({extension:f.u.DamageReturn.get,parameters:"_recordId=".concat(e)}).then(async e=>{var n;await E({extension:f.u.MFJobOrder.get,parameters:"_recordId=".concat(null==e?void 0:null===(n=e.record)||void 0===n?void 0:n.jobId)}).then(n=>{var a,r,l,d,t,o;H.setValues({...null==e?void 0:e.record,date:(0,p.a1)(null==e?void 0:null===(a=e.record)||void 0===a?void 0:a.date),sku:null==n?void 0:null===(r=n.record)||void 0===r?void 0:r.sku,itemName:null==n?void 0:null===(l=n.record)||void 0===l?void 0:l.itemName,designName:null==n?void 0:null===(d=n.record)||void 0===d?void 0:d.designName,designRef:null==n?void 0:null===(t=n.record)||void 0===t?void 0:t.designRef,maxPcs:null==e?void 0:null===(o=e.record)||void 0===o?void 0:o.pcs})})})}let W=!!H.values.recordId,X=3===H.values.status,Y=(null==H?void 0:null===(n=H.values)||void 0===n?void 0:n.type)==="1",B=[{key:"Locked",condition:X,disabled:!W||X},{key:"Unlocked",condition:!X,onClick:async()=>{await M({extension:f.u.DamageReturn.post,record:JSON.stringify(H.values)}),s.ZP.success($.Posted),G(),await Q(H.values.recordId)},disabled:!W||X}];return(0,l.useEffect)(()=>{J&&Q(J)},[]),(0,r.jsx)(h.Z,{resourceId:u.i.DamageReturn,functionId:w.J.DamageReturn,form:H,maxAccess:z,previewReport:W,actions:B,editMode:W,disabledSubmit:X,children:(0,r.jsx)(c.R,{children:(0,r.jsx)(v.Q,{children:(0,r.jsxs)(y.ZP,{container:!0,spacing:2,children:[(0,r.jsx)(y.ZP,{item:!0,xs:5,children:(0,r.jsx)(R.Z,{endpointId:N.r.DocumentType.qry,parameters:"_startAt=0&_pageSize=1000&_dgId=".concat(w.J.DamageReturn),name:"dtId",label:T.documentType,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],readOnly:W,valueField:"recordId",displayField:["reference","name"],values:H.values,maxAccess:z,onChange:(e,n)=>{H.setFieldValue("dtId",null==n?void 0:n.recordId),U(n)},error:H.touched.dtId&&!!H.errors.dtId})}),(0,r.jsx)(y.ZP,{item:!0,xs:7}),(0,r.jsx)(y.ZP,{item:!0,xs:5,children:(0,r.jsx)(j.Z,{name:"reference",label:T.reference,value:null==H?void 0:null===(a=H.values)||void 0===a?void 0:a.reference,maxAccess:!W&&z,readOnly:W,onChange:H.handleChange,onClear:()=>H.setFieldValue("reference",""),error:H.touched.reference&&!!H.errors.reference})}),(0,r.jsx)(y.ZP,{item:!0,xs:7}),(0,r.jsx)(y.ZP,{item:!0,xs:5,children:(0,r.jsx)(R.Z,{datasetId:C.v.DAM_RETURN_TYPE,name:"type",required:!0,readOnly:(null==H?void 0:null===(o=H.values)||void 0===o?void 0:o.damageId)||(null==H?void 0:null===(i=H.values)||void 0===i?void 0:i.jobId)||W,label:T.type,values:H.values,valueField:"key",displayField:"value",maxAccess:z,onChange:(e,n)=>{H.setFieldValue("type",null==n?void 0:n.key),H.setFieldValue("maxPcs",null)},error:H.touched.type&&!!H.errors.type})}),(0,r.jsx)(y.ZP,{item:!0,xs:7}),(0,r.jsx)(y.ZP,{item:!0,xs:5,children:(0,r.jsx)(k.U,{endpointId:f.u.Damage.snapshot,parameters:{_jobId:0},valueField:"reference",displayField:"reference",secondDisplayField:!1,name:"damageId",label:T.damage,form:H,required:Y,readOnly:!Y||W,displayFieldWidth:1,valueShow:"damageRef",maxAccess:z,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"jobRef",value:"Job Order Ref"}],onChange:async(e,n)=>{n?await E({extension:f.u.MFJobOrder.get,parameters:"_recordId=".concat(null==n?void 0:n.jobId)}).then(e=>{var a,r,l,d;H.setValues({...H.values,sku:(null==e?void 0:null===(a=e.record)||void 0===a?void 0:a.sku)||"",itemName:(null==e?void 0:null===(r=e.record)||void 0===r?void 0:r.itemName)||"",designName:(null==e?void 0:null===(l=e.record)||void 0===l?void 0:l.designName)||"",designRef:(null==e?void 0:null===(d=e.record)||void 0===d?void 0:d.designRef)||"",damageId:(null==n?void 0:n.recordId)||null,damageRef:(null==n?void 0:n.reference)||"",jobId:(null==n?void 0:n.jobId)||null,jobRef:(null==n?void 0:n.jobRef)||"",workCenterName:(null==n?void 0:n.wcName)||"",workCenterId:(null==n?void 0:n.workCenterId)||null,plantId:(null==n?void 0:n.plantId)||null,pcs:(null==n?void 0:n.pcs)||0,maxPcs:(null==n?void 0:n.pcs)||0})}):H.setValues({...H.values,sku:"",itemName:"",designName:"",designRef:"",damageId:null,damageRef:"",jobId:null,jobRef:"",workCenterName:"",workCenterId:null,pcs:0,maxPcs:null})},errorCheck:"damageId"})}),(0,r.jsx)(y.ZP,{item:!0,xs:7}),(0,r.jsx)(y.ZP,{item:!0,xs:5,children:(0,r.jsx)(k.U,{endpointId:f.u.MFJobOrder.snapshot,filter:{status:4},valueField:"reference",displayField:"reference",secondDisplayField:!1,name:"jobId",label:T.jobOrder,form:H,required:!0,readOnly:Y||W,displayFieldWidth:2,valueShow:"jobRef",maxAccess:z,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"itemName",value:"Item Name"},{key:"description",value:"Description"}],onChange:(e,n)=>{H.setValues({...H.values,jobId:(null==n?void 0:n.recordId)||null,jobRef:(null==n?void 0:n.reference)||"",sku:(null==n?void 0:n.sku)||"",designRef:(null==n?void 0:n.designRef)||"",designName:(null==n?void 0:n.designName)||"",itemName:(null==n?void 0:n.itemName)||"",workCenterName:(null==n?void 0:n.wcName)||"",workCenterId:(null==n?void 0:n.workCenterId)||null,plantId:(null==n?void 0:n.plantId)||null,maxPcs:32767})},errorCheck:"jobId"})}),(0,r.jsx)(y.ZP,{item:!0,xs:7}),(0,r.jsx)(y.ZP,{item:!0,xs:5,children:(0,r.jsx)(j.Z,{name:"sku",label:T.item,value:null==H?void 0:null===(m=H.values)||void 0===m?void 0:m.sku,maxAccess:z,readOnly:!0})}),(0,r.jsx)(y.ZP,{item:!0,xs:5,children:(0,r.jsx)(j.Z,{name:"itemName",value:null==H?void 0:null===(D=H.values)||void 0===D?void 0:D.itemName,maxAccess:z,readOnly:!0})}),(0,r.jsx)(y.ZP,{item:!0,xs:5,children:(0,r.jsx)(j.Z,{name:"designRef",label:T.designRef,value:null==H?void 0:null===(F=H.values)||void 0===F?void 0:F.designRef,maxAccess:z,readOnly:!0})}),(0,r.jsx)(y.ZP,{item:!0,xs:5,children:(0,r.jsx)(j.Z,{name:"designName",value:null==H?void 0:null===(O=H.values)||void 0===O?void 0:O.designName,maxAccess:z,readOnly:!0})}),(0,r.jsx)(y.ZP,{item:!0,xs:5,children:(0,r.jsx)(R.Z,{endpointId:N.r.Plant.qry,name:"plantId",required:!0,readOnly:X,label:T.plant,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:H.values,valueField:"recordId",displayField:["reference","name"],maxAccess:z,onChange:(e,n)=>{H.setFieldValue("plantId",null==n?void 0:n.recordId)},error:H.touched.plantId&&!!H.errors.plantId})}),(0,r.jsx)(y.ZP,{item:!0,xs:12}),(0,r.jsx)(y.ZP,{item:!0,xs:12}),(0,r.jsx)(y.ZP,{item:!0,xs:5,children:(0,r.jsx)(g.Z,{name:"date",required:!0,label:T.date,value:null==H?void 0:null===(A=H.values)||void 0===A?void 0:A.date,onChange:H.setFieldValue,readOnly:W,maxAccess:z,onClear:()=>H.setFieldValue("date",null),error:H.touched.date&&!!H.errors.date})}),(0,r.jsx)(y.ZP,{item:!0,xs:7}),(0,r.jsx)(y.ZP,{item:!0,xs:5,children:(0,r.jsx)(j.Z,{name:"workCenterName",label:T.workCenter,value:null==H?void 0:null===(q=H.values)||void 0===q?void 0:q.workCenterName,maxAccess:z,readOnly:!0})}),(0,r.jsx)(y.ZP,{item:!0,xs:7}),(0,r.jsx)(y.ZP,{item:!0,xs:5,children:(0,r.jsx)(Z.Z,{name:"pcs",required:!0,readOnly:W,label:T.pcs,value:null===(S=H.values)||void 0===S?void 0:S.pcs,onChange:H.handleChange,onClear:()=>H.setFieldValue("pcs",0),maxAccess:z,error:H.touched.pcs&&!!H.errors.pcs,helperText:H.touched.pcs&&H.errors.pcs})}),(0,r.jsx)(y.ZP,{item:!0,xs:7}),(0,r.jsx)(y.ZP,{item:!0,xs:8,children:(0,r.jsx)(b.Z,{name:"notes",label:T.remarks,value:H.values.notes,rows:2.5,readOnly:X,maxAccess:z,onChange:e=>H.setFieldValue("notes",e.target.value),onClear:()=>H.setFieldValue("notes",""),error:H.touched.notes&&!!H.errors.notes})})]})})})})}var F=a(36908),O=()=>{let{postRequest:e,getRequest:n}=(0,l.useContext)(t.$),{platformLabels:a}=(0,l.useContext)(x.l),{stack:g}=(0,i.zY)(),{query:{data:p},filterBy:y,refetch:I,labels:h,access:j,paginationParameters:b,invalidate:R}=(0,d.J)({queryFn:k,endpointId:f.u.DamageReturn.page,datasetId:u.i.DamageReturn,filter:{filterFn:Z}}),N=[{field:"reference",headerName:h.reference,flex:1},{field:"date",headerName:h.date,flex:1,type:"date"},{field:"typeName",headerName:h.type,flex:1},{field:"damageRef",headerName:h.damage,flex:1},{field:"jobRef",headerName:h.jobRef,flex:1},{field:"statusName",headerName:h.status,flex:1},{field:"notes",headerName:h.remarks,flex:1}];async function k(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{_startAt:a=0,_pageSize:r=50,params:l=[]}=e;return{...await n({extension:f.u.DamageReturn.page,parameters:"_startAt=".concat(a,"&_pageSize=").concat(r,"&_params=").concat(l,"&_jobId=0&filter=")}),_startAt:a}}async function Z(e){let{filters:a,pagination:r}=e;return(null==a?void 0:a.qry)?await n({extension:f.u.DamageReturn.snapshot,parameters:"_filter=".concat(a.qry,"&_jobId=0")}):k({_startAt:r._startAt||0,params:null==a?void 0:a.params})}let{proxyAction:_}=(0,P.G)({functionId:w.J.DamageReturn,action:O}),C=async()=>{await _()};async function O(e){g({Component:D,props:{labels:h,access:j,recordId:e},width:850,height:680,title:h.damageReturn})}let A=async n=>{await e({extension:f.u.DamageReturn.del,record:JSON.stringify(n)}),R(),s.ZP.success(a.Deleted)};return(0,r.jsxs)(c.R,{children:[(0,r.jsx)(m.g,{children:(0,r.jsx)(F.Z,{onAdd:C,maxAccess:j,filterBy:y,reportName:"MFDMR"})}),(0,r.jsx)(v.Q,{children:(0,r.jsx)(o.Z,{name:"damageRetTable",columns:N,gridData:p,rowId:["recordId"],onEdit:e=>{O(e.recordId)},refetch:I,onDelete:A,deleteConfirmationType:"strict",isLoading:!1,pageSize:50,maxAccess:j,paginationParameters:b,paginationType:"api"})})]})}},1685:function(e,n,a){"use strict";a.d(n,{m:function(){return r}});let r=e=>{let n=window.sessionStorage.getItem(e);return n?JSON.parse(n):null}},98345:function(e,n,a){"use strict";a.d(n,{H:function(){return f},G:function(){return x}});var r=a(45300),l=a(2784),d=a(96026),t=a(38449);a(26612);var o=a(65947),s=a(1685);let i=async(e,n,a)=>{try{let r=await e({extension:n,parameters:a});return n.includes("qry")?r:r.record}catch(e){return null}},u=(e,n,a,r)=>{let l=(e=JSON.parse(JSON.stringify(e))).record.controls,d=l.find(e=>"reference"===e.controlId);return d?d.accessLevel=(null==n?void 0:n.mandatory)?o.$7:o.rr:(null==n?void 0:n.mandatory)?l.push({sgId:0,resourceId:"",controlId:"".concat(r?r+".":"","reference"),accessLevel:(null==n?void 0:n.mandatory)?o.$7:o.rr}):(null==n?void 0:n.readOnly)?l.push({sgId:0,resourceId:"",controlId:"".concat(r?r+".":"","reference"),accessLevel:(null==n?void 0:n.readOnly)?o.rr:o.$7}):l=e.record.controls.filter(e=>"reference"!=e.controlId),a&&l.push({sgId:0,resourceId:"",controlId:"".concat(r?r+".":"","dtId"),accessLevel:o.$7}),{...e,record:{...e.record,controls:l}}},c=async(e,n,a)=>{let r,l;switch(a){case"dtId":let d=(0,s.m)("userData"),o=null==d?void 0:d.userId;l="_userId=".concat(o,"&_functionId=").concat(n),r=t.r.UserFunction.get;break;case"glbSysNumberRange":l="_recordId=".concat(n),r=t.r.SystemFunction.get;break;case"DocumentType":l="_dgId=".concat(n,"&_startAt=",0,"&_pageSize=",50),r=t.r.DocumentType.qry;break;case"DcTypNumberRange":l="_recordId=".concat(n),r=t.r.DocumentType.get;break;case"isExternal":l="_recordId=".concat(n),r=t.r.NumberRange.get;break;default:return null}return await i(e,r,l)},m=async function(e){let n,a,r,l,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,t=arguments.length>2?arguments[2]:void 0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,s=!(arguments.length>4)||void 0===arguments[4]||arguments[4],i=arguments.length>5?arguments[5]:void 0,m=void 0===o&&d&&await c(e,d,"dtId"),v=null==m?void 0:m.dtId,x="",f=!0;if(m&&void 0===o||"nraId"===o){if(v){let a=await c(e,v,"DcTypNumberRange");n=null==a?void 0:a.nraId,f=!((null==a?void 0:a.activeStatus)<0),n||(x="Assign the document type to a number range")}if((!v||!f)&&s&&d){var g;let n=await c(e,d,"DocumentType");l=(null==n?void 0:null===(g=n.list)||void 0===g?void 0:g.filter(e=>(null==e?void 0:e.activeStatus)===1).length)>0}}if(("nraId"===o||void 0===o)&&d){if((!v||v)&&!n||n&&!f){let a=await c(e,d,"glbSysNumberRange");(n=null==a?void 0:a.nraId)&&l&&(l=!1),f=!0}x=n||l?"":"Assign the system Function to a number range"}o>0&&!n&&(n=o),n&&f?(a={readOnly:null==(r=await c(e,n,"isExternal"))||!r.external,mandatory:null!=r&&!!r.external},t&&(t=await u(t,a,l,i))):!n&&t&&(t=await u(t,a,l,i));let p=i?"".concat(i,".reference"):"reference";return{dtId:v,resetReference:null==a?void 0:a.readOnly,dcTypeRequired:l,reference:{fieldName:p,isEmpty:(null==r?void 0:r.external)!==void 0&&(null==r||!r.external)},errorMessage:x,maxAccess:t,selectNraId:o}};var v=a(65950);function x(e){let{functionId:n,action:a,hasDT:r}=e,{getRequest:t}=(0,l.useContext)(v.$),{stack:o}=(0,d.V)();return{proxyAction:async()=>{let e=await m(t,n,"",void 0,r);(null==e?void 0:e.errorMessage)?o({message:null==e?void 0:e.errorMessage}):await a()}}}function f(e){var n;let{functionId:a,access:t,hasDT:o,enabled:s=!0,objectName:i=""}=e,{getRequest:u}=(0,l.useContext)(v.$),{stack:c}=(0,d.V)(),[x,f]=(0,l.useState)(),g=async e=>{let n=await m(u,a,t,e,o,i);if(!n.errorMessage)return n;c({message:null==n?void 0:n.errorMessage})},p=(0,r.a)({retry:!1,staleTime:0,enabled:s,queryKey:[a,x,!!t,s],queryFn:x||"nraId"===x?()=>g(x):()=>g()});return{documentType:p.data,maxAccess:(null==p?void 0:null===(n=p.data)||void 0===n?void 0:n.maxAccess)||t,changeDT(e){f((null==e?void 0:e.nraId)||"nraId")}}}}},function(e){e.O(0,[92515,2494,36908,49774,92888,40179],function(){return e(e.s=2827)}),_N_E=e.O()}]);