(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[41777],{61303:function(e,l,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/plant-supervisors",function(){return n(55843)}])},55843:function(e,l,n){"use strict";n.r(l),n.d(l,{default:function(){return x}});var a=n(52322),r=n(61802),s=n(26612),t=n(60218),i=n(2784),o=n(48601),d=n(62202),u=n(65950),p=n(80983),c=n(19473),m=n(31389),v=n(62362),I=n(8661),f=n(38449),w=n(95982),_=n(76399),y=n(54074);function h(e){let{_labels:l,maxAccess:n}=e,{getRequest:r,postRequest:s}=(0,i.useContext)(u.$),{platformLabels:h}=(0,i.useContext)(c.l),{formik:x}=(0,p.c)({initialValues:{recordId:null,plantId:"",rows:[]},maxAccess:n,validateOnChange:!0,validationSchema:o.Ry({plantId:o.Z_().required(),rows:o.IX().of(o.Ry({username:o.Z_().required()}))}),onSubmit:async e=>{let l={plantId:e.plantId,supervisors:e.rows.map(l=>({supervisorId:l.supervisorId,plantId:e.plantId}))};await s({extension:w.y.PlantSupervisors.set2,record:JSON.stringify(l)}),d.ZP.success(h.Updated),b()}}),b=async()=>{if(!x.values.plantId){x.setFieldValue("rows",[]);return}if(x.values.plantId){var e,l;let n=await r({extension:w.y.PlantSupervisors.qry,parameters:"_plantId=".concat(x.values.plantId)});if((null==n?void 0:null===(e=n.list)||void 0===e?void 0:e.length)>0){let e=null==n?void 0:null===(l=n.list)||void 0===l?void 0:l.map((e,l)=>({...e,id:l+1}));x.setFieldValue("rows",e)}else x.setFieldValue("rows",[{id:1,supervisorId:""}])}};(0,i.useEffect)(()=>{b()},[x.values.plantId]);let F=[{component:"resourcecombobox",name:"username",label:l.user,props:{endpointId:f.r.Users.qry,parameters:"_startAt=0&_pageSize=100&_size=50&_sortBy=fullName&_filter=",valueField:"recordId",displayField:"username",mapping:[{from:"recordId",to:"supervisorId"},{from:"email",to:"email"},{from:"username",to:"username"}],columnsInDropDown:[{key:"email",value:"Email"},{key:"username",value:"Name"}],displayFieldWidth:2}},{component:"textfield",label:null==l?void 0:l.email,name:"email",props:{readOnly:!0}}];return(0,a.jsx)(y.Z,{onSave:x.handleSubmit,maxAccess:n,children:(0,a.jsx)(m.R,{children:(0,a.jsxs)(v.Q,{children:[(0,a.jsx)(t.ZP,{container:!0,spacing:2,children:(0,a.jsx)(t.ZP,{item:!0,xs:12,children:(0,a.jsx)(I.Z,{endpointId:f.r.Plant.qry,name:"plantId",label:l.plant,valueField:"recordId",displayField:"name",columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],required:!0,values:x.values,maxAccess:n,onChange:(e,l)=>{x.setFieldValue("plantId",l?null==l?void 0:l.recordId:"")},error:x.touched.plantId&&!!x.errors.plantId})})}),(0,a.jsx)(_._,{onChange:e=>{x.setFieldValue("rows",x.values.plantId?e:[])},value:x.values.rows,error:x.errors.rows,columns:F,allowDelete:!0,allowAddNewLine:!0})]})})})}var x=()=>(0,a.jsx)(r.ut,{datasetId:s.i.PlantSupervisors,labelKey:"plantSupervisors",Component:h})}},function(e){e.O(0,[49774,92888,40179],function(){return e(e.s=61303)}),_N_E=e.O()}]);