(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[70375],{16311:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/iv-item-parts",function(){return a(89259)}])},89259:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return w}});var r=a(52322),i=a(2784),n=a(69387),s=a(27723),l=a(65950),d=a(71987),o=a(26612),m=a(33625),c=a(62362),u=a(31389),p=a(61802),f=a(65215),h=a(76399),x=a(82737),I=a(48601),v=a(62202),N=a(19473),y=a(80983),g=a(5088),_=a(60218),j=e=>{let{labels:t,maxAccess:a,obj:n}=e,{getRequest:s,postRequest:d}=(0,i.useContext)(l.$),{platformLabels:m}=(0,i.useContext)(N.l),p=e=>!e.partId,{formik:j}=(0,y.c)({validateOnChange:!0,validationSchema:I.Ry({items:I.IX().of(I.Ry().shape({partRef:I.Z_().test(function(e){var t,a,r;return!((null===(r=this.options.from[1])||void 0===r?void 0:null===(a=r.value)||void 0===a?void 0:null===(t=a.items)||void 0===t?void 0:t.length)>1)||!!e}),qty:I.Rx().test(function(e){return p(this.parent)||e>0})})).required()}),initialValues:{itemId:n.recordId,items:[{id:1,partRef:"",partname:"",partId:"",qty:""}]},onSubmit:e=>{let{items:t}=e;1===t.length&&p(t[0])?w({itemId:e.itemId,items:[]}):w(e)}}),w=async e=>{var t;let a=null==e?void 0:null===(t=e.items)||void 0===t?void 0:t.filter(e=>e.partId&&e.partRef).map((t,a)=>({...t,itemId:e.itemId,seqNo:a+1})),r={itemId:e.itemId,items:a||[]};await d({extension:f.$.ItemParts.set2,record:JSON.stringify(r)}),v.ZP.success(m.Updated)},P=[{component:"resourcelookup",label:t.part,name:"partRef",props:{valueField:"reference",displayField:"reference",displayFieldWidth:2,endpointId:f.$.Parts.snapshot,mapping:[{from:"recordId",to:"partId"},{from:"name",to:"partName"},{from:"reference",to:"partRef"}],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}]}},{component:"textfield",label:t.partName,name:"partName",props:{readOnly:!0}},{component:"numberfield",label:t.qty,name:"qty",props:{allowNegative:!1,decimalScale:0}}];return(0,i.useEffect)(()=>{s({extension:f.$.ItemParts.qry,parameters:"_itemId=".concat(n.recordId)}).then(e=>{var t;let a=null===(t=e.list)||void 0===t?void 0:t.map((e,t)=>({...e,id:t+1}));j.setValues({...j.values,items:a})})},[n.recordId]),(0,r.jsx)(x.Z,{form:j,resourceId:o.i.IVMDParts,isCleared:!1,maxAccess:a,isInfo:!1,children:(0,r.jsx)(u.R,{children:(0,r.jsxs)(c.Q,{children:[(0,r.jsxs)(_.ZP,{container:!0,spacing:1,children:[(0,r.jsx)(_.ZP,{item:!0,xs:12,children:(0,r.jsx)(g.Z,{label:t.name,value:n.name,readOnly:!0})}),(0,r.jsx)(_.ZP,{item:!0,xs:12,children:(0,r.jsx)(g.Z,{label:t.sku,value:n.sku,readOnly:!0})})]}),(0,r.jsx)(h._,{onChange:e=>j.setFieldValue("items",e),value:j.values.items,error:j.errors.items,allowDelete:!0,columns:P})]})})})},w=()=>{let{getRequest:e}=(0,i.useContext)(l.$),{stack:t}=(0,p.zY)();async function a(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{_startAt:a=0,_pageSize:r=50}=t;return{...await e({extension:f.$.IVMDParts.qry,parameters:"_startAt=".concat(a,"&_pageSize=").concat(r,"&_params=&_sortField=recordId desc")}),_startAt:a}}let{query:{data:h},labels:x,refetch:I,paginationParameters:v,access:N}=(0,d.J)({queryFn:a,endpointId:f.$.IVMDParts.qry,datasetId:o.i.IVMDParts}),y=[{field:"sku",headerName:x.sku,flex:1},{field:"name",headerName:x.name,flex:1},{field:"flName",headerName:x.flName,flex:1},{field:"shortName",headerName:x.shortName,flex:1},{field:"description",headerName:x.description,flex:1},{field:"categoryName",headerName:x.categories,flex:1},{field:"msName",headerName:x.measurement,flex:1},{field:"ptName",headerName:x.priceType,flex:1},{field:"volume",headerName:x.volume,flex:1},{field:"weight",headerName:x.weight,flex:1}];return(0,r.jsxs)(u.R,{children:[(0,r.jsx)(m.g,{children:(0,r.jsx)(s.Z,{maxAccess:N})}),(0,r.jsx)(c.Q,{children:(0,r.jsx)(n.Z,{columns:y,gridData:h,rowId:["recordId"],onEdit:e=>{t({Component:j,props:{labels:x,obj:e,maxAccess:N},width:700,height:470,title:x.itemParts})},isLoading:!1,pageSize:50,refetch:I,paginationParameters:v,paginationType:"api",maxAccess:N})})]})}}},function(e){e.O(0,[49774,92888,40179],function(){return e(e.s=16311)}),_N_E=e.O()}]);