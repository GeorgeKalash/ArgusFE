(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[61837],{8678:function(e,n,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/em-job-info",function(){return r(14956)}])},14956:function(e,n,r){"use strict";r.r(n),r.d(n,{default:function(){return b}});var a=r(52322),t=r(2784),o=r(62202),l=r(69387),d=r(65950),s=r(61802),i=r(71987),c=r(26612),u=r(31389),m=r(33625),f=r(62362),p=r(19473),y=r(92407),I=r(36908),v=r(7121),h=r(98345),x=r(27603),b=()=>{let{getRequest:e,postRequest:n}=(0,t.useContext)(d.$),{platformLabels:r}=(0,t.useContext)(p.l),{stack:b}=(0,s.zY)(),{query:{data:g},labels:N,paginationParameters:w,invalidate:_,filterBy:F,refetch:k,access:C}=(0,i.J)({queryFn:j,endpointId:y.y.JobInfo.page,datasetId:c.i.JobInfos,filter:{endpointId:y.y.JobInfo.snapshot,filterFn:R}});async function R(n){let{filters:r,pagination:a}=n;return r.qry?await e({extension:y.y.JobInfo.snapshot,parameters:"_filter=".concat(r.qry)}):j({_startAt:a._startAt||0,params:null==r?void 0:r.params})}async function j(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{_startAt:r=0,_pageSize:a=50,params:t=[]}=n;return{...await e({extension:y.y.JobInfo.page,parameters:"_startAt=".concat(r,"&_pageSize=").concat(a,"&_params=").concat(t,"&_size=50&_sortBy=")}),_startAt:r}}let A=[{field:"reference",headerName:N.ref,flex:1},{field:"employeeName",headerName:N.employeeName,flex:1},{field:"date",headerName:N.date,flex:1,type:"date"},{field:"departmentName",headerName:N.department,flex:1},{field:"branchName",headerName:N.branch,flex:1},{field:"positionName",headerName:N.position,flex:1},{field:"reportToName",headerName:N.reportsTo,flex:1},{field:"statusName",headerName:N.status,flex:1},{field:"rsName",headerName:N.releaseStatus,flex:1},{field:"wipName",headerName:N.wip,flex:1}],{proxyAction:D}=(0,h.G)({functionId:v.J.JobInfo,action:async()=>{T()},hasDT:!1}),J=async()=>{await D()},Z=async e=>{await n({extension:y.y.JobInfo.del,record:JSON.stringify(e)}),_(),o.ZP.success(r.Deleted)};function T(e){b({Component:x.Z,props:{recordId:e}})}return(0,a.jsxs)(u.R,{children:[(0,a.jsx)(m.g,{children:(0,a.jsx)(I.Z,{filterBy:F,onAdd:J,maxAccess:C,reportName:"EPJI"})}),(0,a.jsx)(f.Q,{children:(0,a.jsx)(l.Z,{name:"table",columns:A,gridData:g,rowId:["recordId"],onEdit:e=>{T(null==e?void 0:e.recordId)},onDelete:Z,pageSize:50,refetch:k,paginationParameters:w,paginationType:"api",maxAccess:C})})]})}},1685:function(e,n,r){"use strict";r.d(n,{m:function(){return a}});let a=e=>{let n=window.sessionStorage.getItem(e);return n?JSON.parse(n):null}},98345:function(e,n,r){"use strict";r.d(n,{H:function(){return y},G:function(){return p}});var a=r(45300),t=r(2784),o=r(96026),l=r(38449);r(26612);var d=r(65947),s=r(1685);let i=async(e,n,r)=>{try{let a=await e({extension:n,parameters:r});return n.includes("qry")?a:a.record}catch(e){return null}},c=(e,n,r,a)=>{let t=(e=JSON.parse(JSON.stringify(e))).record.controls,o=t.find(e=>"reference"===e.controlId);return o?o.accessLevel=(null==n?void 0:n.mandatory)?d.$7:d.rr:(null==n?void 0:n.mandatory)?t.push({sgId:0,resourceId:"",controlId:"".concat(a?a+".":"","reference"),accessLevel:(null==n?void 0:n.mandatory)?d.$7:d.rr}):(null==n?void 0:n.readOnly)?t.push({sgId:0,resourceId:"",controlId:"".concat(a?a+".":"","reference"),accessLevel:(null==n?void 0:n.readOnly)?d.rr:d.$7}):t=e.record.controls.filter(e=>"reference"!=e.controlId),r&&t.push({sgId:0,resourceId:"",controlId:"".concat(a?a+".":"","dtId"),accessLevel:d.$7}),{...e,record:{...e.record,controls:t}}},u=async(e,n,r)=>{let a,t;switch(r){case"dtId":let o=(0,s.m)("userData"),d=null==o?void 0:o.userId;t="_userId=".concat(d,"&_functionId=").concat(n),a=l.r.UserFunction.get;break;case"glbSysNumberRange":t="_recordId=".concat(n),a=l.r.SystemFunction.get;break;case"DocumentType":t="_dgId=".concat(n,"&_startAt=",0,"&_pageSize=",50),a=l.r.DocumentType.qry;break;case"DcTypNumberRange":t="_recordId=".concat(n),a=l.r.DocumentType.get;break;case"isExternal":t="_recordId=".concat(n),a=l.r.NumberRange.get;break;default:return null}return await i(e,a,t)},m=async function(e){let n,r,a,t,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,l=arguments.length>2?arguments[2]:void 0,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,s=!(arguments.length>4)||void 0===arguments[4]||arguments[4],i=arguments.length>5?arguments[5]:void 0,m=void 0===d&&o&&await u(e,o,"dtId"),f=null==m?void 0:m.dtId,p="",y=!0;if(m&&void 0===d||"nraId"===d){if(f){let r=await u(e,f,"DcTypNumberRange");n=null==r?void 0:r.nraId,y=!((null==r?void 0:r.activeStatus)<0),n||(p="Assign the document type to a number range")}if((!f||!y)&&s&&o){var I;let n=await u(e,o,"DocumentType");t=(null==n?void 0:null===(I=n.list)||void 0===I?void 0:I.filter(e=>(null==e?void 0:e.activeStatus)===1).length)>0}}if(("nraId"===d||void 0===d)&&o){if((!f||f)&&!n||n&&!y){let r=await u(e,o,"glbSysNumberRange");(n=null==r?void 0:r.nraId)&&t&&(t=!1),y=!0}p=n||t?"":"Assign the system Function to a number range"}d>0&&!n&&(n=d),n&&y?(r={readOnly:null==(a=await u(e,n,"isExternal"))||!a.external,mandatory:null!=a&&!!a.external},l&&(l=await c(l,r,t,i))):!n&&l&&(l=await c(l,r,t,i));let v=i?"".concat(i,".reference"):"reference";return{dtId:f,resetReference:null==r?void 0:r.readOnly,dcTypeRequired:t,reference:{fieldName:v,isEmpty:(null==a?void 0:a.external)!==void 0&&(null==a||!a.external)},errorMessage:p,maxAccess:l,selectNraId:d}};var f=r(65950);function p(e){let{functionId:n,action:r,hasDT:a}=e,{getRequest:l}=(0,t.useContext)(f.$),{stack:d}=(0,o.V)();return{proxyAction:async()=>{let e=await m(l,n,"",void 0,a);(null==e?void 0:e.errorMessage)?d({message:null==e?void 0:e.errorMessage}):await r()}}}function y(e){var n;let{functionId:r,access:l,hasDT:d,enabled:s=!0,objectName:i=""}=e,{getRequest:c}=(0,t.useContext)(f.$),{stack:u}=(0,o.V)(),[p,y]=(0,t.useState)(),I=async e=>{let n=await m(c,r,l,e,d,i);if(!n.errorMessage)return n;u({message:null==n?void 0:n.errorMessage})},v=(0,a.a)({retry:!1,staleTime:0,enabled:s,queryKey:[r,p,!!l,s],queryFn:p||"nraId"===p?()=>I(p):()=>I()});return{documentType:v.data,maxAccess:(null==v?void 0:null===(n=v.data)||void 0===n?void 0:n.maxAccess)||l,changeDT(e){y((null==e?void 0:e.nraId)||"nraId")}}}},27603:function(e,n,r){"use strict";r.d(n,{Z:function(){return R}});var a=r(52322),t=r(60218),o=r(2784),l=r(48601),d=r(82737),s=r(62202),i=r(65950),c=r(71987),u=r(26612),m=r(5088),f=r(80983),p=r(62362),y=r(31389),I=r(19473),v=r(8661),h=r(92407),x=r(27423),b=r(70104),g=r(21581),N=r(89330),w=r(39812),_=r(98345),F=r(7121),k=r(21326),C=r(50023);function R(e){var n;let{recordId:r,window:R}=e,{getRequest:j,postRequest:A}=(0,o.useContext)(i.$),{platformLabels:D}=(0,o.useContext)(I.l),{labels:J,access:Z}=(0,C.Z)({datasetId:u.i.JobInfos,editMode:!!r});(0,k.Z)({title:J.jobInfo,window:R});let{maxAccess:T}=(0,_.H)({functionId:F.J.JobInfo,access:Z,enabled:!r}),S=(0,c.E)({endpointId:h.y.JobInfo.page}),{formik:O}=(0,f.c)({initialValues:{recordId:null,reference:"",employeeId:null,employeeName:"",employeeRef:"",date:new Date,departmentId:null,branchId:null,divisionId:null,positionId:null,reportToId:null,reportToName:"",reportToRef:"",notes:"",status:1,wip:1},validateOnChange:!0,validationSchema:l.Ry({employeeId:l.Rx().required(),date:l.hT().max(new Date,"Date cannot be in the future").required(),departmentId:l.Rx().required(),branchId:l.Rx().required(),positionId:l.Rx().required()}),onSubmit:async e=>{await A({extension:h.y.JobInfo.set,record:JSON.stringify({...e,date:(0,w.ku)(e.date)})}),s.ZP.success(e.recordId?D.Edited:D.Added),R.close(),S()}}),q=!!O.values.recordId,P=2==O.values.wip;async function V(e){if(e){let n=await j({extension:h.y.JobInfo.get,parameters:"_recordId=".concat(e)});O.setValues({...n.record,date:(0,w.a1)(n.record.date)})}}(0,o.useEffect)(()=>{V(r)},[]);let E=[{key:"Close",condition:!P,onClick:async()=>{await A({extension:h.y.JobInfo.close,record:JSON.stringify({...O.values,date:(0,w.ku)(O.values.date)})}),s.ZP.success(D.Closed),V(r),S()},disabled:P||!q},{key:"Reopen",condition:P,onClick:async()=>{await A({extension:h.y.JobInfo.reopen,record:JSON.stringify({...O.values,date:(0,w.ku)(O.values.date)})}),s.ZP.success(D.Reopened),V(r),S()},disabled:!P},{key:"Approval",condition:!0,onClick:"onApproval",disabled:!P}];return(0,a.jsx)(d.Z,{resourceId:u.i.JobInfos,functionId:F.J.JobInfo,form:O,maxAccess:T,editMode:q,actions:E,disabledSubmit:P,children:(0,a.jsx)(y.R,{children:(0,a.jsx)(p.Q,{children:(0,a.jsxs)(t.ZP,{container:!0,spacing:2,children:[(0,a.jsx)(t.ZP,{item:!0,xs:12,children:(0,a.jsx)(m.Z,{name:"reference",label:J.ref,value:O.values.reference,maxAccess:T,readOnly:q,maxLength:"30",onChange:O.handleChange,onClear:()=>O.setFieldValue("reference",""),error:O.touched.reference&&!!O.errors.reference})}),(0,a.jsx)(t.ZP,{item:!0,xs:12,children:(0,a.jsx)(x.U,{endpointId:h.y.Employee.snapshot,parameters:{_branchId:0},valueField:"reference",displayField:"fullName",name:"employeeId",required:!0,displayFieldWidth:2,readOnly:P,label:J.employee,secondFieldLabel:J.employee,form:O,valueShow:"employeeRef",secondValueShow:"employeeName",columnsInDropDown:[{key:"reference",value:"Reference"},{key:"fullName",value:"Name"}],maxAccess:T,onChange:(e,n)=>{O.setFieldValue("employeeName",(null==n?void 0:n.fullName)||""),O.setFieldValue("employeeId",(null==n?void 0:n.recordId)||null)},errorCheck:"employeeId"})}),(0,a.jsx)(t.ZP,{item:!0,xs:12,children:(0,a.jsx)(N.Z,{name:"date",label:J.date,value:null===(n=O.values)||void 0===n?void 0:n.date,readOnly:P,required:!0,max:new Date,onChange:O.setFieldValue,onClear:()=>O.setFieldValue("date",null),error:O.touched.date&&!!O.errors.date,maxAccess:T})}),(0,a.jsx)(t.ZP,{item:!0,xs:12,children:(0,a.jsx)(v.Z,{endpointId:b.K.DepartmentFilters.qry,parameters:"_filter=&_size=1000&_startAt=0&_type=0&_activeStatus=0&_sortBy=recordId",name:"departmentId",label:J.department,values:O.values,columnsInDropDown:[{key:"departmentRef",value:"Reference"},{key:"name",value:"Name"}],required:!0,readOnly:P,displayField:["departmentRef","name"],maxAccess:T,onChange:(e,n)=>{O.setFieldValue("departmentId",(null==n?void 0:n.recordId)||null)},error:O.touched.departmentId&&!!O.errors.departmentId})}),(0,a.jsx)(t.ZP,{item:!0,xs:12,children:(0,a.jsx)(v.Z,{endpointId:b.K.BranchFilters.qry,name:"branchId",label:J.branch,columnsInDropDown:[{key:"branchRef",value:"Reference"},{key:"name",value:"Name"}],valueField:"recordId",displayField:["branchRef","name"],values:O.values,maxAccess:T,onChange:(e,n)=>{O.setFieldValue("branchId",(null==n?void 0:n.recordId)||null)},required:!0,readOnly:P,error:O.touched.branchId&&!!O.errors.branchId})}),(0,a.jsx)(t.ZP,{item:!0,xs:12,children:(0,a.jsx)(v.Z,{endpointId:b.K.DivisionFilters.qry,name:"divisionId",label:J.division,valueField:"recordId",displayField:"name",maxAccess:T,readOnly:P,values:O.values,onChange:(e,n)=>{O.setFieldValue("divisionId",(null==n?void 0:n.recordId)||null)},error:O.touched.divisionId&&!!O.errors.divisionId})}),(0,a.jsx)(t.ZP,{item:!0,xs:12,children:(0,a.jsx)(v.Z,{endpointId:b.K.CompanyPositions.qry,parameters:"_filter=&_size=1000&_startAt=0&_sortBy=recordId",name:"positionId",label:J.position,required:!0,valueField:"recordId",displayField:["positionRef","name"],columnsInDropDown:[{key:"positionRef",value:"Reference"},{key:"name",value:"Name"}],maxAccess:T,readOnly:P,values:O.values,onChange:(e,n)=>{O.setFieldValue("positionId",(null==n?void 0:n.recordId)||null)},error:O.touched.positionId&&!!O.errors.positionId})}),(0,a.jsx)(t.ZP,{item:!0,xs:12,children:(0,a.jsx)(x.U,{endpointId:h.y.Employee.snapshot,parameters:{_branchId:0},secondFieldLabel:J.reportsTo,valueField:"reference",displayField:"fullName",name:"reportToId",displayFieldWidth:2,label:J.reportsTo,form:O,readOnly:P,valueShow:"reportToRef",secondValueShow:"reportToName",maxAccess:T,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"fullName",value:"Name"}],onChange:(e,n)=>{O.setFieldValue("reportToName",(null==n?void 0:n.fullName)||""),O.setFieldValue("reportToId",(null==n?void 0:n.recordId)||null)},errorCheck:"reportToId"})}),(0,a.jsx)(t.ZP,{item:!0,xs:12,children:(0,a.jsx)(g.Z,{name:"notes",label:J.notes,value:O.values.notes,rows:2,readOnly:P,maxAccess:T,onChange:O.handleChange,onClear:()=>O.setFieldValue("notes",""),error:O.touched.notes&&!!O.errors.notes})})]})})})})}R.width=600,R.height=520}},function(e){e.O(0,[92515,2494,36908,49774,92888,40179],function(){return e(e.s=8678)}),_N_E=e.O()}]);