(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[65848],{25111:function(e,l,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/ct-exchange-rates",function(){return a(13124)}])},13124:function(e,l,a){"use strict";a.r(l),a.d(l,{default:function(){return M}});var r=a(52322),n=a(2784),u=a(60218),s=a(48601),d=a(65950),t=a(38449),i=a(76399),o=a(1251),c=a(24074),v=a(26612),p=a(62202),x=a(36367),y=a(8661),m=a(71987),I=a(75991),h=a(84100),R=a(31389),C=a(62362),f=a(33625),T=a(19473),g=a(80983),j=a(61802),w=a(23361),Z=a(21326);let b=e=>{let{window:l,onConfirm:a,fullScreen:u,open:s}=e,{platformLabels:d}=(0,n.useContext)(T.l);return(0,Z.Z)({title:d.Clear,window:l}),(0,r.jsx)(w.Z,{open:!!s[0]&&s[0],DialogText:d.ClearConf,okButtonAction:()=>{a(s[1]),l.close()},fullScreen:u,cancelButtonAction:()=>l.close()})};b.width=450,b.height=170;var F=a(69627),A=a(54074),M=()=>{var e,l,a,w,Z,M,q,N,_,k,P,E,S,V,D,O,X,z,J,L,Q,B,H,K,W,G,Y,$,U,ee,el,ea,er,en,eu,es,ed,et,ei;let{getRequest:eo,postRequest:ec}=(0,n.useContext)(d.$),{platformLabels:ev,defaultsData:ep}=(0,n.useContext)(T.l),[ex,ey]=(0,n.useState)([]),em=(null===(e=(0,x.h)(ev))||void 0===e?void 0:e.find(e=>{let{key:l}=e;return"Clear"===l}))||null,{stack:eI}=(0,j.zY)(),eh=parseInt(null==ep?void 0:null===(a=ep.list)||void 0===a?void 0:null===(l=a.find(e=>{let{key:l}=e;return"baseCurrencyId"===l}))||void 0===l?void 0:l.value)||null,{labels:eR,access:eC}=(0,m.J)({datasetId:v.i.CtExchangeRates}),ef=s.Ry({minRate:s.Rx().required().test(function(e){let{rate:l}=this.parent;return null==e||null==l||e<=l}),maxRate:s.Rx().required().test(function(e){let{rate:l}=this.parent;return null==e||null==l||e>=l}),rate:s.Rx().required().test(function(e){let{minRate:l,maxRate:a}=this.parent;return null==e||null==l||null==a||e>=l&&e<=a}),rateCalcMethodName:s.Z_().required()}),{formik:eT}=(0,g.c)({maxAccess:eC,validationSchema:s.Ry({currencyId:s.Rx().required(),rateAgainst:s.Rx().required(),raCurrencyId:s.Rx().required(),purchases:s.nK().when(["currencyId","puRateTypeId"],(e,l)=>{let[a,r]=e;return a&&r?s.IX().of(ef).min(1).required():l.notRequired()}),sales:s.nK().when(["currencyId","saRateTypeId"],(e,l)=>{let[a,r]=e;return a&&r?s.IX().of(ef).min(1).required():l.notRequired()})}),initialValues:{currencyId:null,rateAgainst:1,raCurrencyId:eh,puRateTypeId:null,saRateTypeId:null,purchases:[{id:1,currencyId:null,raCurrencyId:null,rateTypeId:null,plantId:null,rateCalcMethod:null,minRate:null,maxRate:null,rate:null}],sales:[{id:1,currencyId:null,raCurrencyId:null,rateTypeId:null,plantId:null,rateCalcMethod:null,minRate:null,maxRate:null,rate:null}]},onSubmit:async e=>{e.puRateTypeId&&await ej(e.purchases,e.currencyId,e.raCurrencyId,e.puRateTypeId),e.saRateTypeId&&await ej(e.sales,e.currencyId,e.raCurrencyId,e.saRateTypeId),p.ZP.success(ev.Saved)}});console.log(eT.values,eh);let eg=[{component:"textfield",label:eR.plant,name:"plantName",props:{readOnly:!0}},{component:"resourcecombobox",label:eR.rcm,name:"rateCalcMethodName",props:{datasetId:h.v.MC_RATE_CALC_METHOD,displayField:"value",refresh:!1,valueField:"key",mapping:[{from:"key",to:"rateCalcMethod"},{from:"value",to:"rateCalcMethodName"}]}},{component:"textfield",label:eR.min,name:"minRate"},{component:"textfield",label:eR.rate,name:"rate"},{component:"textfield",label:eR.max,name:"maxRate"}],ej=async(e,l,a,r)=>{await ec({extension:c.u.ExchangeMap.set2,record:JSON.stringify({currencyId:l,rateTypeId:r,raCurrencyId:a,exchangeMaps:e})})};(0,n.useEffect)(()=>{eT.values.currencyId&&eT.values.puRateTypeId&&eT.values.raCurrencyId&&ew(eT.values.currencyId,eT.values.puRateTypeId,eT.values.raCurrencyId,"purchases")},[eT.values.currencyId,eT.values.raCurrencyId,eT.values.puRateTypeId]),(0,n.useEffect)(()=>{eT.values.currencyId&&eT.values.saRateTypeId&&eT.values.raCurrencyId&&ew(eT.values.currencyId,eT.values.saRateTypeId,eT.values.raCurrencyId,"sales")},[eT.values.currencyId,eT.values.raCurrencyId,eT.values.saRateTypeId]),(0,n.useEffect)(()=>{eo({extension:t.r.Plant.qry,parameters:""}).then(e=>{ey(e.list||[])})},[]),(0,n.useEffect)(()=>{eT.setFieldValue("raCurrencyId",eh)},[eh]);let ew=async(e,l,a,r)=>{if(eT.setFieldValue(r,[]),e&&a&&l){var n;let u=null===(n=(await eo({extension:c.u.ExchangeMap.qry,parameters:"_currencyId=".concat(e,"&_rateTypeId=").concat(l,"&_raCurrencyId=").concat(a)})).list)||void 0===n?void 0:n.reduce((e,l)=>(e[l.plantId]=l,e),{}),s=ex.map((r,n)=>{let s=(null==u?void 0:u[r.recordId])||0;return{id:n,currencyId:e,raCurrencyId:a,rateTypeId:l,plantId:r.recordId,plantName:r.name,rateCalcMethod:s.rateCalcMethod,rateCalcMethodName:s.rateCalcMethodName,rate:s.rate,minRate:s.minRate,maxRate:s.maxRate}});eT.setFieldValue(r,s)}},eZ=e=>{var l,a;let r=null===(l=eT.values)||void 0===l?void 0:l[e][0],n=null===(a=eT.values)||void 0===a?void 0:a[e].map(e=>({...e,minRate:r.minRate,maxRate:r.maxRate,rate:r.rate,rateCalcMethod:r.rateCalcMethod,rateCalcMethodName:r.rateCalcMethodName}));eT.setFieldValue(e,n)},eb=async(e,l)=>{let a={currencyId:eT.values.currencyId,rateTypeId:l,raCurrencyId:eT.values.raCurrencyId,exchangeMaps:[]};await ec({extension:c.u.ExchangeMap.set2,record:JSON.stringify(a)}).then(a=>{ew(eT.values.currencyId,l,eT.values.raCurrencyId,e),p.ZP.success(ev.Saved)})};function eF(e,l){eI({Component:b,props:{open:[!0,{}],fullScreen:!1,onConfirm:()=>eb(e,l)}})}return(0,r.jsx)(A.Z,{onSave:eT.handleSubmit,maxAccess:eC,fullSize:!0,children:(0,r.jsx)(R.R,{children:(0,r.jsx)(C.Q,{children:(0,r.jsxs)(u.ZP,{container:!0,xs:12,sx:{flexDirection:"column"},p:2,children:[(0,r.jsx)(f.g,{children:(0,r.jsxs)(u.ZP,{container:!0,spacing:2,children:[(0,r.jsx)(u.ZP,{item:!0,xs:6,children:(0,r.jsx)(y.Z,{endpointId:t.r.Currency.qry,name:"currencyId",label:eR.currency,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Currency Ref"},{key:"name",value:"Name"}],values:eT.values,required:!0,maxAccess:eC,onChange:(e,l)=>{eT.setFieldValue("currencyId",(null==l?void 0:l.recordId)||null)},error:eT.touched.currencyId&&!!eT.errors.currencyId})}),(0,r.jsx)(u.ZP,{item:!0,xs:3,children:(0,r.jsx)(y.Z,{name:"rateAgainst",label:eR.rateAgainst,datasetId:h.v.MC_RATE_AGAINST,values:eT.values,valueField:"key",displayField:"value",refresh:!1,required:!0,onChange:(e,l)=>{var a;let r=null!==(a=null==l?void 0:l.key)&&void 0!==a?a:null;eT.setFieldValue("rateAgainst",r),r?"1"===r&&eh&&eT.setFieldValue("raCurrencyId",parseInt(eh)):eT.setFieldValue("raCurrencyId",null)},error:eT.touched.rateAgainst&&!!eT.errors.rateAgainst})}),(0,r.jsx)(u.ZP,{item:!0,xs:3,children:(0,r.jsx)(y.Z,{endpointId:t.r.Currency.qry,name:"raCurrencyId",label:eR.currency,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Currency Ref"},{key:"name",value:"Name"}],values:eT.values,required:!0,readOnly:!eT.values.rateAgainst||"1"===eT.values.rateAgainst,maxAccess:eC,onChange:(e,l)=>{eT.setFieldValue("raCurrencyId",(null==l?void 0:l.recordId)||null)},error:eT.touched.raCurrencyId&&!!eT.errors.raCurrencyId})})]})}),(0,r.jsxs)(u.ZP,{container:!0,sx:{flex:1},children:[(0,r.jsx)(u.ZP,{item:!0,xs:6,sx:{display:"flex",flex:1},children:(0,r.jsx)(I.Z,{sx:{flex:1},children:(0,r.jsxs)(R.R,{children:[(0,r.jsx)(f.g,{children:(0,r.jsxs)(u.ZP,{container:!0,xs:12,spacing:2,sx:{mb:2},children:[(0,r.jsx)(u.ZP,{item:!0,xs:8,children:(0,r.jsx)(y.Z,{endpointId:o.q.RateType.qry,name:"puRateTypeId",label:eR.rateType,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Ref"},{key:"name",value:"Name"}],values:eT.values,required:!0,maxAccess:eC,onChange:(e,l)=>{eT.setFieldValue("puRateTypeId",(null==l?void 0:l.recordId)||null)},error:eT.touched.puRateTypeId&&!!eT.errors.puRateTypeId})}),(0,r.jsxs)(u.ZP,{item:!0,xs:4,children:[(0,r.jsx)(F.Z,{onClick:()=>eZ("purchases"),label:eR.copy,disabled:!(null==eT?void 0:null===(w=eT.values)||void 0===w?void 0:w.purchases)||!eT.values.puRateTypeId||!(null==eT?void 0:null===(M=eT.values)||void 0===M?void 0:null===(Z=M.purchases[0])||void 0===Z?void 0:Z.rateCalcMethod)||!(null==eT?void 0:null===(N=eT.values)||void 0===N?void 0:null===(q=N.purchases[0])||void 0===q?void 0:q.rate)||!(null==eT?void 0:null===(k=eT.values)||void 0===k?void 0:null===(_=k.purchases[0])||void 0===_?void 0:_.minRate)||!(null==eT?void 0:null===(E=eT.values)||void 0===E?void 0:null===(P=E.purchases[0])||void 0===P?void 0:P.maxRate)}),(0,r.jsx)(F.Z,{onClick:()=>eF("purchases",eT.values.puRateTypeId),image:"".concat(em.image),color:em.color,disabled:!(null==eT?void 0:null===(S=eT.values)||void 0===S?void 0:S.purchases)||!eT.values.puRateTypeId||!(null==eT?void 0:null===(D=eT.values)||void 0===D?void 0:null===(V=D.purchases[0])||void 0===V?void 0:V.rateCalcMethod)||!(null==eT?void 0:null===(X=eT.values)||void 0===X?void 0:null===(O=X.purchases[0])||void 0===O?void 0:O.rate)||!(null==eT?void 0:null===(J=eT.values)||void 0===J?void 0:null===(z=J.purchases[0])||void 0===z?void 0:z.minRate)||!(null==eT?void 0:null===(Q=eT.values)||void 0===Q?void 0:null===(L=Q.purchases[0])||void 0===L?void 0:L.maxRate)})]})]})}),(0,r.jsx)(C.Q,{children:eT.values.currencyId&&eT.values.raCurrencyId&&eT.values.puRateTypeId&&(0,r.jsx)(i._,{name:"purchases",onChange:e=>eT.setFieldValue("purchases",e),value:eT.values.purchases,error:eT.errors.purchases,columns:eg,allowDelete:!1,allowAddNewLine:!1,maxAccess:eC})})]})})}),(0,r.jsx)(u.ZP,{item:!0,xs:6,sx:{display:"flex",flex:1},children:(0,r.jsx)(I.Z,{sx:{flex:1},children:(0,r.jsxs)(R.R,{children:[(0,r.jsx)(f.g,{children:(0,r.jsxs)(u.ZP,{container:!0,xs:12,spacing:2,sx:{mb:2},children:[(0,r.jsx)(u.ZP,{item:!0,xs:8,children:(0,r.jsx)(y.Z,{endpointId:o.q.RateType.qry,name:"saRateTypeId",label:eR.rateType,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Ref"},{key:"name",value:"Name"}],values:eT.values,required:!0,maxAccess:eC,onChange:(e,l)=>{eT.setFieldValue("saRateTypeId",(null==l?void 0:l.recordId)||null)},error:eT.touched.saRateTypeId&&!!eT.errors.saRateTypeId})}),(0,r.jsxs)(u.ZP,{item:!0,xs:4,children:[(0,r.jsx)(F.Z,{label:eR.copy,onClick:()=>eZ("sales"),disabled:!(null==eT?void 0:null===(B=eT.values)||void 0===B?void 0:B.sales)||!eT.values.saRateTypeId||!(null==eT?void 0:null===(K=eT.values)||void 0===K?void 0:null===(H=K.sales[0])||void 0===H?void 0:H.rateCalcMethod)||!(null==eT?void 0:null===(G=eT.values)||void 0===G?void 0:null===(W=G.sales[0])||void 0===W?void 0:W.rate)||!(null==eT?void 0:null===($=eT.values)||void 0===$?void 0:null===(Y=$.sales[0])||void 0===Y?void 0:Y.minRate)||!(null==eT?void 0:null===(ee=eT.values)||void 0===ee?void 0:null===(U=ee.sales[0])||void 0===U?void 0:U.maxRate)}),(0,r.jsx)(F.Z,{onClick:()=>eF("sales",eT.values.saRateTypeId),image:"".concat(em.image),color:em.color,disabled:!(null==eT?void 0:null===(el=eT.values)||void 0===el?void 0:el.sales)||!eT.values.saRateTypeId||!(null==eT?void 0:null===(er=eT.values)||void 0===er?void 0:null===(ea=er.sales[0])||void 0===ea?void 0:ea.rateCalcMethod)||!(null==eT?void 0:null===(eu=eT.values)||void 0===eu?void 0:null===(en=eu.sales[0])||void 0===en?void 0:en.rate)||!(null==eT?void 0:null===(ed=eT.values)||void 0===ed?void 0:null===(es=ed.sales[0])||void 0===es?void 0:es.minRate)||!(null==eT?void 0:null===(ei=eT.values)||void 0===ei?void 0:null===(et=ei.sales[0])||void 0===et?void 0:et.maxRate)})]})]})}),(0,r.jsx)(C.Q,{children:eT.values.currencyId&&eT.values.raCurrencyId&&eT.values.saRateTypeId&&(0,r.jsx)(i._,{name:"sales",onChange:e=>eT.setFieldValue("sales",e),value:eT.values.sales,error:eT.errors.sales,columns:eg,allowDelete:!1,allowAddNewLine:!1,maxAccess:eC})})]})})})]})]})})})})}},75991:function(e,l,a){"use strict";var r=a(52322),n=a(60218),u=a(76385);l.Z=e=>{let{children:l,title:a,form:s=!1,...d}=e;return(0,r.jsxs)(n.ZP,{container:!0,spacing:{xs:1,sm:1.25,md:1.5},sx:{border:"1px solid",borderColor:"#cdd3d4",position:"relative",ml:0,my:a?{xs:.75,sm:1,md:1.25}:0,p:s?0:"clamp(8px, 0.8vw, 14px)",pt:s?0:a?"clamp(14px, 1.2vw, 22px)":"clamp(8px, 0.8vw, 14px)",...d.sx},children:[!!a&&(0,r.jsx)(u.Z,{variant:"h6",sx:{position:"absolute",top:"clamp(-12px, -0.9vw, -8px)",left:"clamp(10px, 1vw, 14px)",bgcolor:"#F4F5FA",px:"clamp(6px, 0.7vw, 12px)",py:"clamp(1px, 0.2vw, 3px)",fontSize:"clamp(10px, 0.75vw, 14px)",lineHeight:1.2,fontWeight:600,whiteSpace:"nowrap",maxWidth:"calc(100% - 20px)",overflow:"hidden",textOverflow:"ellipsis"},children:a}),l]})}}},function(e){e.O(0,[49774,92888,40179],function(){return e(e.s=25111)}),_N_E=e.O()}]);