(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[76145],{39332:function(e,d,l){(window.__NEXT_P=window.__NEXT_P||[]).push(["/pm-casting",function(){return l(84377)}])},84377:function(e,d,l){"use strict";l.r(d),l.d(d,{default:function(){return q}});var n=l(52322),a=l(2784),r=l(62202),i=l(69387),t=l(65950),o=l(71987),s=l(26612),u=l(31389),c=l(33625),m=l(62362),v=l(61802),p=l(19473),I=l(63518),h=l(7121),x=l(98345),g=l(36908),y=l(60218),f=l(48601),F=l(82737),C=l(5088),P=l(80983),j=l(89330),w=l(8661),Z=l(38449),b=l(39812),_=l(90587),D=l(27423),A=l(91406),V=l(21581),N=l(53164);l(93432);var S=l(84100),k=l(65215);function O(e){var d,l,i,m,g,O,q,G;let{labels:z,maxAccess:L,recordId:T}=e,{getRequest:R,postRequest:E}=(0,a.useContext)(t.$),{platformLabels:J}=(0,a.useContext)(p.l),{stack:M}=(0,v.zY)(),$=h.J.ModellingCasting,{documentType:Y,maxAccess:W,changeDT:X}=(0,x.H)({functionId:$,access:L,enabled:!T}),B=(0,o.E)({endpointId:I.z.Casting.page}),{formik:H}=(0,P.c)({documentType:{key:"dtId",value:null==Y?void 0:Y.dtId},initialValues:{recordId:null,reference:"",dtId:null,date:new Date,threeDPId:null,productionLineId:null,castingType:null,designGroupId:null,designFamilyId:null,metalId:null,itemGroupId:null,productionStandardId:null,laborId:null,mould:"",setPcs:null,weight:null,notes:"",status:1},maxAccess:W,validateOnChange:!0,validationSchema:f.Ry({date:f.hT().required(),threeDPId:f.Rx().required(),laborId:f.Rx().required(),castingType:f.Rx().required(),productionLineId:f.Rx().required(),setPcs:f.Rx().nullable().min(0).max(1e3)}),onSubmit:async e=>{let d={...e,date:(0,b.ku)(null==e?void 0:e.date)},l=await E({extension:I.z.Casting.set,record:JSON.stringify(d)});await K(l.recordId),B(),r.ZP.success(e.recordId?J.Edited:J.Added)}}),Q=3===H.values.status,U=!!H.values.recordId;async function K(e){var d;let l=await R({extension:I.z.Casting.get,parameters:"_recordId=".concat(e)});H.setValues({...l.record,date:(0,b.a1)(null==l?void 0:null===(d=l.record)||void 0===d?void 0:d.date)})}let ee=[{key:"Locked",condition:!0,onClick:async()=>{var e;let d={...H.values,date:(0,b.ku)(null===(e=H.values)||void 0===e?void 0:e.date)};await E({extension:I.z.Casting.post,record:JSON.stringify(d)}),await K(H.values.recordId),r.ZP.success(J.Posted),B()},disabled:!U||Q},{key:"threeDPrinting",condition:!0,onClick:async()=>{var e;M({Component:N.Z,props:{recordId:null===(e=H.values)||void 0===e?void 0:e.threeDPId}})},disabled:!H.values.threeDPId}];(0,a.useEffect)(()=>{!async function(){T&&await K(T)}()},[]);let ed=async e=>await R({extension:I.z.Printing.get,parameters:"_recordId=".concat(e)}),el=async e=>await R({extension:I.z.ThreeDDesign.get,parameters:"_recordId=".concat(e)});return(0,n.jsx)(F.Z,{resourceId:s.i.Casting,form:H,maxAccess:W,editMode:U,actions:ee,functionId:$,disabledSubmit:Q,children:(0,n.jsx)(u.R,{children:(0,n.jsx)(c.g,{children:(0,n.jsxs)(y.ZP,{container:!0,spacing:2,children:[(0,n.jsx)(y.ZP,{item:!0,xs:12,children:(0,n.jsx)(w.Z,{endpointId:Z.r.DocumentType.qry,parameters:"_dgId=".concat($,"&_startAt=0&_pageSize=50"),filter:U?void 0:e=>1===e.activeStatus,name:"dtId",label:z.documentType,readOnly:U,valueField:"recordId",displayField:"name",values:null==H?void 0:H.values,onChange:async(e,d)=>{if(H.setFieldValue("dtId",(null==d?void 0:d.recordId)||null),X(d),H.setFieldValue("productionLineId",null),null==d?void 0:d.recordId){let{record:e}=await R({extension:I.z.DocumentTypeDefault.get,parameters:"_dtId=".concat(null==d?void 0:d.recordId)});H.setFieldValue("productionLineId",null==e?void 0:e.productionLineId)}else H.setFieldValue("productionLineId",null)},error:H.touched.dtId&&!!H.errors.dtId,maxAccess:W})}),(0,n.jsx)(y.ZP,{item:!0,xs:12,children:(0,n.jsx)(C.Z,{name:"reference",label:z.reference,value:null==H?void 0:null===(d=H.values)||void 0===d?void 0:d.reference,readOnly:U,maxAccess:!U&&W,onChange:H.handleChange,onClear:()=>H.setFieldValue("reference",""),error:H.touched.reference&&!!H.errors.reference})}),(0,n.jsx)(y.ZP,{item:!0,xs:12,children:(0,n.jsx)(w.Z,{endpointId:_.u.ProductionLine.qry,parameters:"_startAt=0&_pageSize=1000&_dtId=".concat(H.values.dtId),values:H.values,name:"productionLineId",label:z.productionLine,valueField:"recordId",displayField:["reference","name"],displayFieldWidth:1,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],required:!0,readOnly:!0,maxAccess:W,onChange:(e,d)=>{H.setFieldValue("productionLineId",(null==d?void 0:d.recordId)||null)},error:H.touched.productionLineId&&H.errors.productionLineId})}),(0,n.jsx)(y.ZP,{item:!0,xs:12,children:(0,n.jsx)(D.U,{endpointId:I.z.Printing.snapshot2,parameters:{_productionLineId:H.values.productionLineId||0},valueField:"reference",name:"threeDPId",label:z.threeDP,form:H,secondDisplayField:!1,valueShow:"threeDPRef",formObject:H.values,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"date",value:"date",type:"date"},{key:"designerRef",value:"designer Ref"},{key:"designerName",value:"designer Name"}],readOnly:Q,required:!0,maxAccess:W,onChange:async(e,d)=>{if(null==d?void 0:d.recordId){var l,n,a,r,i;let e=await ed(null==d?void 0:d.recordId),t=await el(null==d?void 0:d.threeDDId);H.setFieldValue("designFamilyId",(null==e?void 0:null===(l=e.record)||void 0===l?void 0:l.designFamilyId)||null),H.setFieldValue("designGroupId",(null==e?void 0:null===(n=e.record)||void 0===n?void 0:n.designGroupId)||null),H.setFieldValue("productionStandardId",(null==t?void 0:null===(a=t.record)||void 0===a?void 0:a.productionStandardId)||null),H.setFieldValue("itemGroupId",(null==t?void 0:null===(r=t.record)||void 0===r?void 0:r.itemGroupId)||null),H.setFieldValue("metalId",(null==t?void 0:null===(i=t.record)||void 0===i?void 0:i.metalId)||null)}H.setFieldValue("threeDPRef",(null==d?void 0:d.reference)||""),H.setFieldValue("threeDPId",(null==d?void 0:d.recordId)||null)},errorCheck:"threeDPId"})}),(0,n.jsx)(y.ZP,{item:!0,xs:12,children:(0,n.jsx)(w.Z,{endpointId:_.u.DesignFamily.qry,name:"designFamilyId",label:z.familyGroup,valueField:"recordId",displayField:"name",values:H.values,readOnly:!0,onChange:(e,d)=>H.setFieldValue("designFamilyId",(null==d?void 0:d.recordId)||null),error:(null==H?void 0:null===(l=H.touched)||void 0===l?void 0:l.designFamilyId)&&!!(null==H?void 0:null===(i=H.errors)||void 0===i?void 0:i.designFamilyId),maxAccess:W})}),(0,n.jsx)(y.ZP,{item:!0,xs:12,children:(0,n.jsx)(w.Z,{endpointId:_.u.DesignGroup.qry,name:"designGroupId",label:z.designGroup,valueField:"recordId",displayField:"name",values:H.values,readOnly:!0,onChange:(e,d)=>H.setFieldValue("designGroupId",(null==d?void 0:d.recordId)||null),error:(null==H?void 0:null===(m=H.touched)||void 0===m?void 0:m.designGroupId)&&!!(null==H?void 0:null===(g=H.errors)||void 0===g?void 0:g.designGroupId),maxAccess:W})}),(0,n.jsx)(y.ZP,{item:!0,xs:12,children:(0,n.jsx)(w.Z,{endpointId:_.u.ProductionStandard.qry,values:H.values,name:"productionStandardId",label:z.productionStandard,valueField:"recordId",displayField:"reference",maxAccess:W,readOnly:!0,onChange:(e,d)=>H.setFieldValue("productionStandardId",(null==d?void 0:d.recordId)||null),error:(null==H?void 0:null===(O=H.touched)||void 0===O?void 0:O.productionStandardId)&&!!(null==H?void 0:null===(q=H.errors)||void 0===q?void 0:q.productionStandardId)})}),(0,n.jsx)(y.ZP,{item:!0,xs:12,children:(0,n.jsx)(w.Z,{endpointId:k.$.Metals.qry,name:"metalId",label:z.metal,valueField:"recordId",displayField:"reference",values:H.values,readOnly:!0,onChange:(e,d)=>H.setFieldValue("metalId",(null==d?void 0:d.recordId)||null),error:H.touched.metalId&&!!H.errors.metalId,maxAccess:W})}),(0,n.jsx)(y.ZP,{item:!0,xs:12,children:(0,n.jsx)(w.Z,{endpointId:k.$.Group.qry,parameters:"_startAt=0&_pageSize=1000",values:H.values,name:"itemGroupId",label:z.itemGroup,valueField:"recordId",displayField:["reference","name"],displayFieldWidth:1,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],readOnly:!0,maxAccess:W,onChange:(e,d)=>H.setFieldValue("itemGroupId",(null==d?void 0:d.recordId)||null),error:H.touched.itemGroupId&&H.errors.itemGroupId})}),(0,n.jsx)(y.ZP,{item:!0,xs:12,children:(0,n.jsx)(j.Z,{name:"date",label:z.date,value:null==H?void 0:null===(G=H.values)||void 0===G?void 0:G.date,required:!0,onChange:H.setFieldValue,onClear:()=>H.setFieldValue("date",null),readOnly:Q,error:H.touched.date&&!!H.errors.date,maxAccess:W})}),(0,n.jsx)(y.ZP,{item:!0,xs:12,children:(0,n.jsx)(w.Z,{endpointId:_.u.Labor.qry,parameters:"_startAt=0&_pageSize=200&_params=",name:"laborId",required:!0,readOnly:Q,label:z.labor,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],valueField:"recordId",displayField:["reference","name"],values:H.values,onChange:(e,d)=>{H.setFieldValue("laborId",(null==d?void 0:d.recordId)||null)},error:H.touched.laborId&&!!H.errors.laborId})}),(0,n.jsx)(y.ZP,{item:!0,xs:12,children:(0,n.jsx)(w.Z,{datasetId:S.v.CASTING_TYPE,name:"castingType",required:!0,label:z.castingType,valueField:"key",readOnly:Q,displayField:"value",values:H.values,maxAccess:W,onChange:(e,d)=>{H.setFieldValue("castingType",(null==d?void 0:d.key)||null)},error:H.touched.castingType&&!!H.errors.castingType})}),(0,n.jsx)(y.ZP,{item:!0,xs:12,children:(0,n.jsx)(C.Z,{name:"mould",label:z.mould,value:H.values.mould,maxAccess:W,onChange:H.handleChange,readOnly:Q,onClear:()=>H.setFieldValue("mould",""),error:H.touched.mould&&!!H.errors.mould})}),(0,n.jsx)(y.ZP,{item:!0,xs:12,children:(0,n.jsx)(A.Z,{name:"setPcs",label:z.pieces,value:H.values.setPcs,maxAccess:W,readOnly:Q,onChange:H.handleChange,onClear:()=>H.setFieldValue("setPcs",null),error:H.touched.setPcs&&!!H.errors.setPcs})}),(0,n.jsx)(y.ZP,{item:!0,xs:12,children:(0,n.jsx)(A.Z,{name:"weight",label:z.weight,value:H.values.weight,maxAccess:W,readOnly:Q,onChange:H.handleChange,maxLength:8,decimalScale:2,onClear:()=>H.setFieldValue("weight",null),error:H.touched.weight&&!!H.errors.weight})}),(0,n.jsx)(y.ZP,{item:!0,xs:12,children:(0,n.jsx)(V.Z,{name:"notes",type:"text",label:z.notes,value:H.values.notes,readOnly:Q,rows:3,maxAccess:W,onChange:e=>H.setFieldValue("notes",e.target.value||null),onClear:()=>H.setFieldValue("notes",""),error:H.touched.notes&&!!H.errors.notes})})]})})})})}var q=()=>{let{getRequest:e,postRequest:d}=(0,a.useContext)(t.$),{platformLabels:l}=(0,a.useContext)(p.l),{stack:y}=(0,v.zY)();async function f(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{_startAt:l=0,_pageSize:n=50,params:a}=d;return{...await e({extension:I.z.Casting.page,parameters:"_startAt=".concat(l,"&_pageSize=").concat(n,"&_params=").concat(a||"")}),_startAt:l}}let{query:{data:F},labels:C,paginationParameters:P,refetch:j,access:w,invalidate:Z,filterBy:b}=(0,o.J)({queryFn:f,endpointId:I.z.Casting.page,datasetId:s.i.Casting,filter:{filterFn:_}});async function _(d){let{filters:l,pagination:n}=d;return l.qry?await e({extension:I.z.Casting.snapshot,parameters:"_filter=".concat(l.qry)}):f({_startAt:n._startAt||0,params:null==l?void 0:l.params})}let D=[{field:"reference",headerName:C.reference,flex:1},{field:"date",headerName:C.date,flex:1,type:"date"},{field:"threeDPRef",headerName:C.threeDP,flex:1},{field:"setPcs",headerName:C.pieces,flex:1},{field:"weight",headerName:C.weight,flex:1},{field:"laborName",headerName:C.labor,flex:1},{field:"productionLineName",headerName:C.productionLine,flex:1},{field:"statusName",headerName:C.status,flex:1}],{proxyAction:A}=(0,x.G)({functionId:h.J.Casting,action:N}),V=async()=>{await A()};function N(e){y({Component:O,props:{recordId:e,labels:C,maxAccess:w},width:700,height:630,title:C.Casting})}let S=async e=>{await d({extension:I.z.Casting.del,record:JSON.stringify(e)}),Z(),r.ZP.success(l.Deleted)};return(0,n.jsxs)(u.R,{children:[(0,n.jsx)(c.g,{children:(0,n.jsx)(g.Z,{labels:C,maxAccess:w,filterBy:b,onAdd:V,reportName:"PMCAS"})}),(0,n.jsx)(m.Q,{children:(0,n.jsx)(i.Z,{columns:D,gridData:F,rowId:["recordId"],onEdit:e=>{N(null==e?void 0:e.recordId)},onDelete:S,isLoading:!1,pageSize:50,paginationType:"api",deleteConfirmationType:"strict",paginationParameters:P,refetch:j,maxAccess:w})})]})}}},function(e){e.O(0,[92515,2494,36908,44129,38096,53164,49774,92888,40179],function(){return e(e.s=39332)}),_N_E=e.O()}]);