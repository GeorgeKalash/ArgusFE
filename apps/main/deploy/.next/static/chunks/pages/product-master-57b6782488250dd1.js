(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[86751],{68734:function(e,r,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/product-master",function(){return a(40916)}])},40916:function(e,r,a){"use strict";a.r(r),a.d(r,{default:function(){return z}});var n=a(52322),s=a(2784),l=a(62202),t=a(69387),d=a(65950),o=a(26612),c=a(53621),i=a(71987),u=a(61802),m=a(29326),p=a(9522),y=a(48601),v=a(78711),f=a(76399),I=a(8661),h=a(31389),x=a(62362),g=a(19473),b=a(54074),N=e=>{let{store:r,labels:a,editMode:t,maxAccess:o}=e,{getRequest:i,postRequest:u}=(0,s.useContext)(d.$),{recordId:m,dispersals:p}=r,[N,_]=(0,s.useState)({}),{platformLabels:R}=(0,s.useContext)(g.l),j=[{component:"resourcecombobox",label:a.agents,name:"agentId",props:{endpointId:c.d.CorrespondentAgents.qry,valueField:"recordId",displayField:"name",mapping:[{from:"recordId",to:"agentId"},{from:"name",to:"agentName"}],columnsInDropDown:[{key:"name",value:"name"}]}}],Z=(0,v.TA)({validateOnChange:!0,validationSchema:y.Ry({agents:y.IX().of(y.Ry().shape({agentId:y.Z_().required("agent recordId is required")})).required("agents array is required")}),initialValues:{agents:[{id:1,dispersalId:"",agentId:"",agentName:""}]},onSubmit:async e=>{await T(e.agents)}}),T=async e=>{let r={dispersalId:m,productDispersalAgents:e.map((e,r)=>{let{dispersalId:a,...n}=e;return{id:r+1,dispersalId:N.dispersalId,...n}})};await u({extension:c.d.ProductDispersalAgents.set2,record:JSON.stringify(r)}).then(e=>{e&&l.ZP.success(R.Edited)})},q=e=>{Z.setValues({agents:[{id:1,dispersalId:"",agentId:"",agentName:""}]}),e&&i({extension:c.d.ProductDispersalAgents.qry,parameters:"_dispersalId=".concat(e)}).then(e=>{e.list.length>0&&Z.setValues({agents:e.list.map((e,r)=>{let{...a}=e;return{id:r+1,...a}})})}).catch(e=>{setErrorMessage(e)})};return(0,n.jsx)(b.Z,{fonSave:Z.handleSubmit,maxAccess:o,editMode:t,children:(0,n.jsx)(h.R,{children:(0,n.jsxs)(x.Q,{children:[(0,n.jsx)(I.Z,{name:"dispersalId",label:a.dispersal,store:p,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:N,onChange:(e,r)=>{_({dispersalId:null==r?void 0:r.recordId}),q(null==r?void 0:r.recordId)},error:!!Z.errors.dispersalId}),(0,n.jsx)(f._,{onChange:e=>Z.setFieldValue("agents",e),value:N.dispersalId?Z.values.agents:[],error:Z.errors.agents,columns:j})]})})})},_=a(60218),R=a(82737),j=a(38449),Z=a(33625),T=a(24074),q=a(80983),C=e=>{let{store:r,labels:a,editMode:t,maxAccess:i,active:u}=e,{recordId:m,countries:p,_seqNo:v,rowSelectionSaved:b}=r,{getRequest:N,postRequest:C}=(0,s.useContext)(d.$),{platformLabels:F}=(0,s.useContext)(g.l),[S,P]=(0,s.useState)([]),[w,D]=(0,s.useState)([]),A=e=>!isNaN(e)&&!isNaN(parseFloat(e)),k=e=>{let r={productId:m,seqNo:v,productScheduleRanges:e.map((e,r)=>{let{id:a,fromAmount:n,toAmount:s}=e;return{seqNo:v,rangeSeqNo:a,productId:m,fromAmount:n,toAmount:s}}),productScheduleFees:e.flatMap((e,r)=>{let{id:a,seqNo:n,rangeSeqNo:s,saved:l,productId:t,...d}=e,o=[];for(let[e,r]of Object.entries(d))A(e)&&o.push({seqNo:v,rangeSeqNo:a,productId:m,commissionId:parseInt(e),commission:r||0});return o})};C({extension:c.d.ProductScheduleRanges.set2,record:JSON.stringify(r)}).then(e=>{e&&l.ZP.success(F.Edited),O()}).catch(e=>{})},{formik:M}=(0,q.c)({initialValues:{seqNo:"",productRanges:[{id:1,seqNo:"",rangeSeqNo:1,fromAmount:"",toAmount:""}]},maxAccess:i,validateOnChange:!0,validationSchema:y.Ry({productRanges:y.IX().of(y.Ry().shape({fromAmount:y.Z_().required(),toAmount:y.Z_().required()})).required()}),onSubmit:e=>{k(e.productRanges)}}),V=async()=>{let e=await N({extension:T.u.CommissionType.qry,parameters:"_filter="}),r=await e.list.map(e=>({component:"numberfield",label:e.name,name:e.recordId.toString()})),n=[{component:"numberfield",label:a.fromAmount,name:"fromAmount"},{component:"numberfield",label:a.toAmount,name:"toAmount"}];return D(r),P([...n,...r]),1};(0,s.useEffect)(()=>{(async()=>{(null==S?void 0:S.length)<1&&await V(),v&&u&&b&&O(v)})()},[v,u,b]);let O=async()=>{if(v!==M.values.seqNo){var e;M.setFieldValue("seqNo",v);let r="_productId=".concat(m,"&_seqNo=").concat(v),a=await N({extension:c.d.ProductScheduleFees.qry,parameters:"_productId=".concat(m,"&_seqNo=").concat(v,"&_rangeSeqNo=",0)}),n=await N({extension:c.d.ProductScheduleRanges.qry,parameters:r}),s=null==n?void 0:null===(e=n.list)||void 0===e?void 0:e.map(async(e,r)=>{var n;let s=await (null==a?void 0:null===(n=a.list)||void 0===n?void 0:n.filter(r=>r.rangeSeqNo===e.rangeSeqNo));try{let a=s.reduce((e,r)=>(e[null==r?void 0:r.commissionId]=null==r?void 0:r.commission,e),{}),n=w.map(e=>({[null==e?void 0:e.name]:a[null==e?void 0:e.name]||""}));return{id:r+1,saved:!0,...e,...Object.assign({},...n)}}catch(e){return}}),l=await Promise.all(s);M.setFieldValue("productRanges",l)}};return(0,n.jsx)(R.Z,{form:M,resourceId:o.i.ProductMaster,maxAccess:i,editMode:t,isCleared:!1,isSaved:!!b,isInfo:!!b,children:b&&u&&(0,n.jsxs)(h.R,{children:[(0,n.jsx)(Z.g,{children:(0,n.jsxs)(_.ZP,{container:!0,xs:12,spacing:2,children:[(0,n.jsx)(_.ZP,{item:!0,xs:3,children:(0,n.jsx)(I.Z,{endpointId:j.r.Plant.qry,name:"plantId",label:a.plant,valueField:"recordId",values:r,readOnly:!0,displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}]})}),(0,n.jsx)(_.ZP,{item:!0,xs:3,children:(0,n.jsx)(I.Z,{store:p,name:"countryId",label:a.country,readOnly:!0,valueField:"countryId",displayField:["countryRef","countryName"],columnsInDropDown:[{key:"countryRef",value:"Reference"},{key:"countryName",value:"Name"}],values:r})}),(0,n.jsx)(_.ZP,{item:!0,xs:3,children:(0,n.jsx)(I.Z,{name:"currencyId",label:a.currency,endpointId:j.r.Currency.qry,valueField:"recordId",values:r,displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],readOnly:!0})}),(0,n.jsx)(_.ZP,{item:!0,xs:3,children:(0,n.jsx)(I.Z,{store:null==r?void 0:r.dispersals,name:"dispersalId",label:a.dispersal,valueField:"recordId",values:r,displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],readOnly:!0})})]})}),u&&b&&S.length>0&&(0,n.jsx)(x.Q,{children:(0,n.jsx)(f._,{onChange:e=>M.setFieldValue("productRanges",e),value:M.values.productRanges,error:M.errors.productRanges,columns:S,name:"productRanges",maxAccess:i})},u)]})})},F=a(84100),S=e=>{var r,a;let{store:t,labels:o,setStore:i,editMode:u,maxAccess:m}=e,{getRequest:p,postRequest:I}=(0,s.useContext)(d.$),{recordId:N,countries:_,currencies:R}=t,[Z,T]=(0,s.useState)([]),{platformLabels:q}=(0,s.useContext)(g.l),C=(0,s.useRef)(),S=(0,v.TA)({validateOnChange:!0,validationSchema:y.Ry({schedules:y.IX().of(y.Ry().shape({countryId:y.Z_().required("currency  is required"),currencyId:y.Z_().required("Country  is required"),dispersalId:y.Z_().required("Dispersal Type  is required")})).required("schedules array is required")}),initialValues:{schedules:[{id:1,productId:N,seqNo:1,plantId:null,plantRef:"",plantName:"",countryId:"",countryRef:"",countryName:"",currencyId:"",currencyRef:"",currencyName:"",dispersalId:"",dispersalName:"",dispersalRef:"",dispersalType:"",dispersalTypeName:"",isInactive:!1,saved:!1,select:!1}]},onSubmit:async e=>{await P(e.schedules)}}),P=async e=>{let r={productId:N,productSchedules:e.map((e,r)=>{let{id:a,seqNo:n,productId:s,plantId:l,saved:t,...d}=e;return{seqNo:n,plantId:l||null,productId:N,...d}})};await I({extension:c.d.ProductSchedules.set2,record:JSON.stringify(r)}).then(e=>{e&&l.ZP.success(q.Edited),A(N)})},w=Math.max(...S.values.schedules.map(e=>e.seqNo).filter(e=>null!=e)),D=[{component:"resourcecombobox",label:o.country,name:"countryId",props:{store:_,valueField:"countryId",displayField:"countryRef",displayFieldWidth:4,mapping:[{from:"countryId",to:"countryId"},{from:"countryName",to:"countryName"},{from:"countryRef",to:"countryRef"}],columnsInDropDown:[{key:"countryRef",value:"Reference"},{key:"countryName",value:"Name"}]},async onChange(e){let{row:{update:r,newRow:a}}=e;C.current=R.filter(e=>(null==e?void 0:e.countryId)===(null==a?void 0:a.countryId));let n=(null==a?void 0:a.seqNo)||w+1;a.seqNo||r({seqNo:n})}},{component:"textfield",label:o.name,name:"countryName",props:{readOnly:!0}},{component:"resourcecombobox",label:o.plant,name:"plantId",props:{endpointId:j.r.Plant.qry,valueField:"recordId",displayField:"reference",displayFieldWidth:3,mapping:[{from:"recordId",to:"plantId"},{from:"name",to:"plantName"},{from:"reference",to:"plantRef"}],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}]}},{component:"textfield",label:o.name,name:"plantName",props:{readOnly:!0}},{component:"resourcecombobox",label:o.currency,name:"currencyId",props:{store:null==C?void 0:C.current,valueField:"currencyId",displayField:"currencyRef",displayFieldWidth:4,mapping:[{from:"currencyId",to:"currencyId"},{from:"currencyName",to:"currencyName"},{from:"currencyRef",to:"currencyRef"}],columnsInDropDown:[{key:"currencyRef",value:"Reference"},{key:"currencyName",value:"Name"}]},propsReducer(e){let{props:r}=e;return{...r,store:C.current}}},{component:"textfield",label:o.name,name:"currencyName",props:{readOnly:!0}},{component:"resourcecombobox",label:o.dispersal,name:"dispersalId",props:{endpointId:N&&c.d.ProductDispersal.qry,parameters:"_productId=".concat(N),valueField:"recordId",displayField:"reference",displayFieldWidth:3,mapping:[{from:"recordId",to:"dispersalId"},{from:"name",to:"dispersalName"},{from:"reference",to:"dispersalRef"},{from:"dispersalType",to:"dispersalType"},{from:"dispersalTypeName",to:"dispersalTypeName"}],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}]}},{component:"textfield",label:o.name,name:"dispersalName",props:{readOnly:!0}},{component:"resourcecombobox",label:o.dispersalType,name:"dispersalType",props:{datasetId:F.v.RT_Dispersal_Type,valueField:"key",displayField:"value",displayFieldWidth:2,readOnly:!0,refresh:!1,mapping:[{from:"key",to:"dispersalType"},{from:"value",to:"dispersalTypeName"},{from:"reference",to:"currencyRef"}]}},{component:"checkbox",label:o.isInactive,name:"isInactive"}];(0,s.useEffect)(()=>{N&&A(N)},[N]);let A=e=>{p({extension:c.d.ProductSchedules.qry,parameters:"_productId=".concat(e)}).then(e=>{e.list.length>0&&S.setValues({schedules:e.list.map((e,r)=>{let{...a}=e;return{id:r+1,saved:!0,...a}})});let r=e.list.find(e=>(null==e?void 0:e.seqNo)===Z);r&&i(e=>({...e,plantId:r.plantId,currencyId:r.currencyId,countryId:r.countryId,dispersalId:r.dispersalId,_seqNo:r.seqNo,rowSelectionSaved:!0}))})};return(0,n.jsx)(b.Z,{onSave:S.handleSubmit,maxAccess:m,editMode:u,isParentWindow:!1,children:(0,n.jsx)(h.R,{children:(0,n.jsx)(x.Q,{children:(0,n.jsx)(f._,{name:"rows",onChange:(e,r,a)=>{S.setFieldValue("schedules",e),"delete"===r&&(null==a?void 0:a.seqNo)===(null==t?void 0:t._seqNo)&&i(e=>({...e,plantId:"",currencyId:"",countryId:"",dispersalId:"",_seqNo:null,rowSelectionSaved:!1}))},value:S.values.schedules,error:S.errors.schedules,columns:D,rowSelectionModel:null===(a=S.values.schedules)||void 0===a?void 0:null===(r=a.find(e=>(null==e?void 0:e.seqNo)===Z))||void 0===r?void 0:r.id,onSelectionChange:e=>{e&&(i(r=>({...r,plantId:e.plantId,currencyId:e.currencyId,countryId:e.countryId,dispersalId:e.dispersalId,_seqNo:e.seqNo,rowSelectionSaved:(null==e?void 0:e.saved)||!1})),T(e.seqNo),C.current=R.filter(r=>r.countryId===e.countryId))}})})})})},P=e=>{let{store:r,setStore:a,labels:t,editMode:o,maxAccess:i}=e,{recordId:u,countries:m}=r,{getRequest:p,postRequest:I}=(0,s.useContext)(d.$),{platformLabels:N}=(0,s.useContext)(g.l),_=(0,v.TA)({validationSchema:y.Ry({currencies:y.IX().of(y.Ry().shape({countryId:y.Z_().required(),countryId:y.Z_().required(),dispersalType:y.Z_().required()})).required()}),initialValues:{currencies:[{id:1,productId:u,countryId:"",countryRef:"",countryName:"",currencyId:"",currencyRef:"",currencyName:"",dispersalType:"",dispersalTypeName:"",isInactive:!1}]},validateOnChange:!0,onSubmit:async e=>{await R(e.currencies)}}),R=async e=>{let r={productId:u,productMonetaries:e.map(e=>{let{id:r,productId:a,...n}=e;return{productId:u,...n}})};await I({extension:c.d.ProductMonetaries.set2,record:JSON.stringify(r)}).then(e=>{e&&l.ZP.success(N.Edited),T(u)})},Z=[{component:"resourcecombobox",label:t.country,name:"countryId",props:{store:m,valueField:"countryId",displayField:"countryRef",displayFieldWidth:2,mapping:[{from:"countryId",to:"countryId"},{from:"countryName",to:"countryName"},{from:"countryRef",to:"countryRef"}],columnsInDropDown:[{key:"countryRef",value:"Reference"},{key:"countryName",value:"Name"}]}},{component:"textfield",label:t.name,name:"countryName",props:{readOnly:!0}},{component:"resourcecombobox",label:t.currency,name:"currencyId",props:{endpointId:j.r.Currency.qry,valueField:"recordId",displayField:"reference",displayFieldWidth:3,mapping:[{from:"recordId",to:"currencyId"},{from:"reference",to:"currencyRef"},{from:"name",to:"currencyName"}],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"},{key:"flName",value:"FlName"}]}},{component:"textfield",label:t.name,name:"currencyName",props:{readOnly:!0}},{component:"resourcecombobox",label:t.dispersalType,name:"dispersalType",props:{datasetId:F.v.RT_Dispersal_Type,valueField:"key",displayField:"value",displayFieldWidth:1,refresh:!1,mapping:[{from:"key",to:"dispersalType"},{from:"value",to:"dispersalTypeName"}]}},{component:"checkbox",label:t.isInactive,name:"isInactive"}];(0,s.useEffect)(()=>{u&&T(u)},[u]);let T=e=>{p({extension:c.d.ProductMonetaries.qry,parameters:"_productId=".concat(e)}).then(e=>{(null==e?void 0:e.list.length)>0&&_.setValues({currencies:e.list.map((e,r)=>{let{...a}=e;return{id:r,...a}})});let r=e.list.filter((e,r,a)=>r===a.findIndex(r=>r.currencyId===e.currencyId&&r.countryId===e.countryId));a(e=>({...e,currencies:r}))})};return(0,n.jsx)(b.Z,{onSave:_.handleSubmit,maxAccess:i,editMode:o,isParentWindow:!1,children:(0,n.jsx)(h.R,{children:(0,n.jsx)(x.Q,{children:(0,n.jsx)(f._,{name:"rows",onChange:e=>_.setFieldValue("currencies",e),value:_.values.currencies,error:_.errors.currencies,columns:Z})})})})},w=a(1251),D=e=>{let{store:r,setStore:a,labels:t,editMode:o,height:i,expanded:u,maxAccess:m}=e,{getRequest:p,postRequest:I}=(0,s.useContext)(d.$),{recordId:N}=r,{platformLabels:_}=(0,s.useContext)(g.l),R=(0,v.TA)({validateOnChange:!0,validationSchema:y.Ry({countries:y.IX().of(y.Ry().shape({countryId:y.Z_().required(" ")})).required("Operations array is required")}),initialValues:{countries:[{id:1,productId:N,countryId:"",countryRef:"",countryName:"",purcRateTypeId:null,saleRateTypeId:null,isInactive:!1}]},onSubmit:async e=>{let r={...e,countries:e.countries.map(e=>({...e,purcRateTypeId:""===e.purcRateTypeId?null:e.purcRateTypeId,saleRateTypeId:""===e.saleRateTypeId?null:e.saleRateTypeId}))};await Z(r.countries)}}),Z=async e=>{let r={productId:N,productCountries:e.map(e=>{let{productId:r,...a}=e;return{productId:N,...a}})};await I({extension:c.d.ProductCountries.set2,record:JSON.stringify(r)}).then(e=>{e&&l.ZP.success(_.Edited),q(N)})},T=[{component:"resourcecombobox",label:t.country,name:"countryId",props:{endpointId:j.r.Country.qry,valueField:"recordId",displayField:"reference",displayFieldWidth:2,mapping:[{from:"name",to:"countryName"},{from:"reference",to:"countryRef"},{from:"recordId",to:"countryId"}],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"},{key:"flName",value:"FlName"}]}},{component:"textfield",label:t.name,name:"countryName",props:{readOnly:!0}},{component:"resourcecombobox",label:t.saleRateType,name:"saleRateTypeId",props:{endpointId:w.q.RateType.qry,valueField:"recordId",displayField:"name",displayFieldWidth:1.5,mapping:[{from:"name",to:"saleRateTypeName"},{from:"reference",to:"saleRateTypeRef"},{from:"recordId",to:"saleRateTypeId"}],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}]}},{component:"resourcecombobox",label:t.purcRateType,name:"purcRateTypeId",props:{endpointId:w.q.RateType.qry,valueField:"recordId",displayField:"name",displayFieldWidth:1.5,mapping:[{from:"name",to:"purcRateTypeName"},{from:"reference",to:"purcRateTypeRef"},{from:"recordId",to:"purcRateTypeId"}],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}]}},{component:"checkbox",label:t.isInactive,name:"isInactive"}];(0,s.useEffect)(()=>{N&&q(N)},[N]);let q=e=>{p({extension:c.d.ProductCountries.qry,parameters:"_productId=".concat(e)}).then(e=>{if(e.list.length>0){let r=e.list.map((e,r)=>{let{countryId:a,countryRef:n,countryName:s,...l}=e;return{id:r,countryId:a,countryRef:n,countryName:s,...l}});R.setValues({countries:r}),a(e=>({...e,countries:r}))}})};return(0,n.jsx)(b.Z,{onSave:R.handleSubmit,maxAccess:m,editMode:o,isParentWindow:!1,children:(0,n.jsx)(h.R,{children:(0,n.jsx)(x.Q,{children:(0,n.jsx)(f._,{name:"rows",onChange:e=>R.setFieldValue("countries",e),value:R.values.countries,error:R.errors.countries,columns:T})})})})},A=a(5088),k=a(27423),M=a(91406),V=a(98345),O=a(19689),E=e=>{var r,a;let{store:t,setStore:u,labels:m,editMode:p,setEditMode:v,maxAccess:f}=e,{getRequest:b,postRequest:N}=(0,s.useContext)(d.$),{recordId:Z}=t,{platformLabels:T}=(0,s.useContext)(g.l),{maxAccess:C,changeDT:S}=(0,V.H)({access:f,enabled:!Z}),P=(0,i.E)({endpointId:c.d.ProductMaster.qry}),{formik:w}=(0,q.c)({maxAccess:C,initialValues:{recordId:null,name:null,reference:null,corId:null,corName:null,corRef:null,languages:null,valueDays:null,commissionBase:null,accessLevel:null,interfaceId:null,posMsg:null,posMsgIsActive:!1,isInactive:!1},validateOnChange:!0,validationSchema:y.Ry({name:y.Z_().required(),commissionBase:y.Z_().required(),isInactive:y.Z_().required(),accessLevel:y.Z_().required()}),onSubmit:async e=>{await D(e)}}),D=async e=>{await N({extension:c.d.ProductMaster.set,record:JSON.stringify(e)}).then(r=>{e.recordId,u(e=>({...e,recordId:r.recordId})),l.ZP.success(e.recordId?T.Edited:T.Added),P()})};(0,s.useEffect)(()=>{Z&&L(Z),E()},[Z]);let E=()=>{b({extension:j.r.Defaults.get,parameters:"_key=rt-nra-product"}).then(e=>{var r;(null==e?void 0:null===(r=e.record)||void 0===r?void 0:r.value)&&S({nraId:e.record.value})})},L=e=>{b({extension:c.d.ProductMaster.get,parameters:"_recordId=".concat(e)}).then(e=>{w.setValues(e.record),v(!0)})};return(0,n.jsx)(R.Z,{form:w,resourceId:o.i.ProductMaster,maxAccess:C,editMode:p,children:(0,n.jsx)(h.R,{children:(0,n.jsx)(x.Q,{children:(0,n.jsxs)(_.ZP,{container:!0,children:[(0,n.jsxs)(_.ZP,{container:!0,rowGap:2,xs:6,sx:{px:2},children:[(0,n.jsx)(_.ZP,{item:!0,xs:12,children:(0,n.jsx)(A.Z,{name:"reference",label:m.reference,value:w.values.reference,readOnly:p,maxAccess:!p&&C,onChange:w.handleChange,onClear:()=>w.setFieldValue("reference",""),error:w.touched.reference&&!!w.errors.reference})}),(0,n.jsx)(_.ZP,{item:!0,xs:12,children:(0,n.jsx)(A.Z,{name:"name",label:m.name,value:w.values.name,required:!0,onChange:w.handleChange,onClear:()=>w.setFieldValue("name",""),error:w.touched.name&&!!w.errors.name})}),(0,n.jsx)(_.ZP,{item:!0,xs:12,children:(0,n.jsx)(M.Z,{name:"valueDays",label:m.valueDays,value:w.values.valueDays,maxLength:1,decimalScale:0,onChange:w.handleChange,onClear:()=>w.setFieldValue("valueDays",""),error:w.touched.valueDays&&!!w.errors.valueDays})}),(0,n.jsx)(_.ZP,{item:!0,xs:12,children:(0,n.jsx)(k.U,{name:"corId",endpointId:c.d.Correspondent.snapshot,label:m.correspondent,form:w,valueField:"reference",displayField:"name",firstValue:w.values.corRef,secondValue:w.values.corName,displayFieldWidth:2,onChange:(e,r)=>{r?(w.setFieldValue("corId",null==r?void 0:r.recordId),w.setFieldValue("corRef",null==r?void 0:r.reference),w.setFieldValue("corName",null==r?void 0:r.name)):(w.setFieldValue("corId",null),w.setFieldValue("corRef",null),w.setFieldValue("corName",null))},error:w.touched.corId&&!!w.errors.corId,maxAccess:C})}),(0,n.jsx)(_.ZP,{item:!0,xs:12,children:(0,n.jsx)(I.Z,{datasetId:F.v.RT_Language,name:"languages",label:m.languages,valueField:"key",displayField:"value",values:w.values,onChange:(e,r)=>w.setFieldValue("languages",null==r?void 0:r.key),error:w.touched.languages&&!!w.errors.languages})})]}),(0,n.jsxs)(_.ZP,{container:!0,rowGap:2,xs:6,sx:{px:2},children:[(0,n.jsx)(_.ZP,{item:!0,xs:12,children:(0,n.jsx)(I.Z,{endpointId:c.d.Interface.qry,name:"interfaceId",label:m.interface,valueField:"recordId",displayField:"name",values:w.values,onChange:(e,r)=>w.setFieldValue("interfaceId",null==r?void 0:r.recordId),error:w.touched.interfaceId&&!!w.errors.interfaceId})}),(0,n.jsx)(_.ZP,{item:!0,xs:12,children:(0,n.jsx)(I.Z,{datasetId:F.v.RT_Commission_Base,name:"commissionBase",label:m.commissionBase,valueField:"key",displayField:"value",values:w.values,required:!0,onChange:(e,r)=>w.setFieldValue("commissionBase",null==r?void 0:r.key),error:w.touched.commissionBase&&!!w.errors.commissionBase})}),(0,n.jsx)(_.ZP,{item:!0,xs:12,children:(0,n.jsx)(A.Z,{name:"posMsg",label:m.messageToOperator,value:w.values.posMsg,readOnly:!1,onChange:w.handleChange,onClear:()=>w.setFieldValue("posMsg",""),error:w.errors&&!!w.errors.posMsg})}),(0,n.jsx)(_.ZP,{item:!0,xs:12,children:(0,n.jsx)(I.Z,{datasetId:F.v.RT_PROD_ACCESS_LEVEL,name:"accessLevel",label:m.accessLevel,required:!0,valueField:"key",displayField:"value",values:w.values,onChange:(e,r)=>w.setFieldValue("accessLevel",null==r?void 0:r.key),error:w.touched.accessLevel&&!!w.errors.accessLevel})}),(0,n.jsx)(_.ZP,{item:!0,xs:12,children:(0,n.jsx)(O.Z,{name:"posMsgIsActive",value:null===(r=w.values)||void 0===r?void 0:r.posMsgIsActive,onChange:e=>w.setFieldValue("posMsgIsActive",e.target.checked),label:m.activateCounterMessage,maxAccess:C})})]}),(0,n.jsx)(_.ZP,{item:!0,xs:6}),(0,n.jsx)(_.ZP,{item:!0,xs:6,sx:{px:2},children:(0,n.jsx)(O.Z,{name:"isInactive",value:null===(a=w.values)||void 0===a?void 0:a.isInactive,onChange:e=>w.setFieldValue("isInactive",e.target.checked),label:m.isInactive,maxAccess:C})})]})})})})},L=a(27723),W=e=>{var r,a;let{pId:t,labels:i,recordId:u,getGridData:m,maxAccess:p,window:f}=e,{getRequest:b,postRequest:N}=(0,s.useContext)(d.$),{platformLabels:j}=(0,s.useContext)(g.l),Z=(0,v.TA)({initialValues:{recordId:null,productId:t,reference:null,name:null,dispersalType:null,isDefault:!1,isInactive:!1},validationSchema:y.Ry({productId:y.Z_().required(),reference:y.Z_().required(),name:y.Z_().required(),dispersalType:y.Z_().required(),isDefault:y.Z_().required(),isInactive:y.Z_().required()}),onSubmit:async e=>{await T(e)}}),T=async e=>{await N({extension:c.d.ProductDispersal.set,record:JSON.stringify(e)}).then(r=>{l.ZP.success(e.recordId?l.ZP.success(j.Edited):l.ZP.success(j.Added)),f.close(),m(t)})},q=e=>{b({extension:c.d.ProductDispersal.get,parameters:"_recordId=".concat(e)}).then(e=>{Z.setValues(e.record)})};return(0,s.useEffect)(()=>{u&&q(u)},[u]),(0,n.jsx)(R.Z,{form:Z,resourceId:o.i.Dispersal,editMode:u,maxAccess:p,children:(0,n.jsx)(h.R,{children:(0,n.jsx)(x.Q,{children:(0,n.jsx)(_.ZP,{container:!0,gap:2,children:(0,n.jsxs)(_.ZP,{container:!0,xs:12,spacing:2,children:[(0,n.jsx)(_.ZP,{item:!0,xs:12,children:(0,n.jsx)(A.Z,{name:"reference",label:i.reference,value:Z.values.reference,required:!0,readOnly:!1,onChange:Z.handleChange,onClear:()=>Z.setFieldValue("reference",""),error:Z.touched.reference&&!!Z.errors.reference,helperText:Z.touched.reference&&Z.errors.reference,maxAccess:p})}),(0,n.jsx)(_.ZP,{item:!0,xs:12,children:(0,n.jsx)(A.Z,{name:"name",label:i.name,value:Z.values.name,required:!0,readOnly:!1,onChange:Z.handleChange,onClear:()=>Z.setFieldValue("name",""),error:Z.touched.name&&!!Z.errors.name,helperText:Z.touched.name&&Z.errors.name,maxAccess:p})}),(0,n.jsx)(_.ZP,{item:!0,xs:12,children:(0,n.jsx)(I.Z,{name:"dispersalType",label:i.dispersalType,datasetId:F.v.RT_Dispersal_Type,valueField:"key",displayField:"value",values:Z.values,required:!0,onChange:(e,r)=>{Z.setFieldValue("dispersalType",null==r?void 0:r.key)},error:Z.touched.dispersalType&&!!Z.errors.dispersalType,helperText:Z.touched.dispersalType&&Z.errors.dispersalType})}),(0,n.jsx)(_.ZP,{item:!0,xs:12,children:(0,n.jsx)(O.Z,{name:"isDefault",value:null===(r=Z.values)||void 0===r?void 0:r.isDefault,onChange:e=>Z.setFieldValue("isDefault",e.target.checked),label:i.isDefault,maxAccess:p})}),(0,n.jsx)(_.ZP,{item:!0,xs:12,children:(0,n.jsx)(O.Z,{name:"isInactive",value:null===(a=Z.values)||void 0===a?void 0:a.isInactive,onChange:e=>Z.setFieldValue("isInactive",e.target.checked),label:i.isInactive,required:!0,maxAccess:p})})]})})})})})},B=e=>{let{store:r,setStore:a,labels:o,maxAccess:i}=e,{recordId:m}=r,{getRequest:p,postRequest:y}=(0,s.useContext)(d.$),[v,f]=(0,s.useState)(),{stack:I}=(0,u.zY)(),{platformLabels:b}=(0,s.useContext)(g.l),N=e=>{f([]),p({extension:c.d.ProductDispersal.qry,parameters:"_productId=".concat(e)}).then(e=>{f(e),a(r=>({...r,dispersals:e.list}))}).catch(e=>{setErrorMessage(e)})},_=[{field:"reference",headerName:o.reference,flex:1},{field:"name",headerName:o.name,flex:1},{field:"dispersalTypeName",headerName:o.dispersalType,flex:1},{field:"isInactive",headerName:o.isInactive,type:"checkbox"},{field:"isDefault",headerName:o.isDefault,type:"checkbox"}];(0,s.useEffect)(()=>{m&&N(m)},[m]);let R=async e=>{await y({extension:c.d.ProductDispersal.del,record:JSON.stringify(e)}),await N(m),l.ZP.success(b.Deleted)};function j(e){I({Component:W,props:{labels:o,recordId:e,pId:m,maxAccess:i,getGridData:N},width:500,title:null==o?void 0:o.dispersal})}return(0,n.jsxs)(h.R,{children:[(0,n.jsx)(Z.g,{children:(0,n.jsx)(L.Z,{onAdd:()=>{j("")},maxAccess:i})}),(0,n.jsx)(x.Q,{children:(0,n.jsx)(t.Z,{columns:_,gridData:v,rowId:["recordId"],api:N,onEdit:e=>{j(e.recordId)},onDelete:R,isLoading:!1,maxAccess:i,pagination:!1})})]})},$=e=>{let{labels:r,recordId:a,maxAccess:l,height:t,expanded:d}=e,[o,c]=(0,s.useState)(a),[i,u]=(0,s.useState)(0),[y,v]=(0,s.useState)({recordId:a||null,countries:null,dispersals:null,_seqNo:null,plantId:null,currencyId:null,countryId:null,dispersalId:null,rowSelectionSaved:!1}),f=[{label:r.main},{label:r.countries,disabled:!o},{label:r.monetary,disabled:!o},{label:r.dispersal,disabled:!o},{label:r.schedules,disabled:!o},{label:r.amountRange,disabled:!o},{label:r.agent,disabled:!o}];return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(p.Y,{tabs:f,activeTab:i,setActiveTab:u,maxAccess:l}),(0,n.jsx)(m.Z,{height:t,index:0,value:i,maxAccess:l,children:(0,n.jsx)(E,{store:y,setStore:v,labels:r,setEditMode:c,maxAccess:l,editMode:o})}),(0,n.jsx)(m.Z,{height:t,index:1,value:i,maxAccess:l,children:(0,n.jsx)(D,{store:y,setStore:v,labels:r,maxAccess:l,height:t,expanded:d,editMode:o})}),(0,n.jsx)(m.Z,{height:t,index:2,value:i,maxAccess:l,children:(0,n.jsx)(P,{store:y,setStore:v,labels:r,maxAccess:l,expanded:d,height:t,editMode:o})}),(0,n.jsx)(m.Z,{height:t,index:3,value:i,maxAccess:l,children:(0,n.jsx)(B,{store:y,setStore:v,labels:r,maxAccess:l,expanded:d,height:t,editMode:o})}),(0,n.jsx)(m.Z,{height:t,index:4,value:i,maxAccess:l,children:(0,n.jsx)(S,{store:y,setStore:v,labels:r,maxAccess:l,expanded:d,height:t,editMode:o})}),(0,n.jsx)(m.Z,{height:t,index:5,value:i,maxAccess:l,children:(0,n.jsx)(C,{store:y,setStore:v,labels:r,maxAccess:l,active:5===i,expanded:d,height:t,editMode:o})}),(0,n.jsx)(m.Z,{height:t,index:6,value:i,maxAccess:l,children:(0,n.jsx)(N,{store:y,labels:r,maxAccess:l,expanded:d,height:t})})]})},J=a(36908),z=()=>{let{getRequest:e,postRequest:r}=(0,s.useContext)(d.$),{stack:a}=(0,u.zY)(),{platformLabels:m}=(0,s.useContext)(g.l),{query:{data:p},labels:y,paginationParameters:v,invalidate:f,filterBy:I,refetch:b,access:N}=(0,i.J)({queryFn:R,endpointId:c.d.ProductMaster.qry,datasetId:o.i.ProductMaster,filter:{endpointId:c.d.ProductMaster.snapshot,filterFn:_}});async function _(r){let{filters:a,pagination:n}=r;return a.qry?await e({extension:c.d.ProductMaster.snapshot,parameters:"_filter=".concat(a.qry)}):await R({_startAt:n._startAt||0,params:null==a?void 0:a.params})}async function R(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{_startAt:a=0,_pageSize:n=50,params:s}=r,l="_startAt=".concat(a,"&_pageSize=").concat(n,"&_params=").concat(s||"");return{...await e({extension:c.d.ProductMaster.page,parameters:l}),_startAt:a}}let j=[{field:"reference",headerName:y.reference,flex:1},{field:"name",headerName:y.name,flex:1},{field:"commissionBaseName",headerName:y.commissionBase,flex:1},{field:"accessLevelName",headerName:y.accessLevel,flex:1},{field:"corName",headerName:y.correspondent,flex:1},{field:"isInactive",headerName:y.isInactive,type:"checkbox"}];function T(e){a({Component:$,props:{labels:y,recordId:e||null,maxAccess:N},width:1e3,title:null==y?void 0:y.productMaster})}return(0,n.jsxs)(h.R,{children:[(0,n.jsx)(Z.g,{children:(0,n.jsx)(J.Z,{labels:y,onAdd:()=>{T("")},maxAccess:N,reportName:"RTPRO",filterBy:I})}),(0,n.jsx)(x.Q,{children:(0,n.jsx)(t.Z,{name:"table",columns:j,gridData:p,rowId:["recordId"],paginationParameters:v,paginationType:"api",refetch:b,onEdit:e=>{T(null==e?void 0:e.recordId)},onDelete:e=>{r({extension:c.d.ProductMaster.del,record:JSON.stringify(e)}).then(e=>{l.ZP.success(m.Deleted),f()})},isLoading:!1,pageSize:50,maxAccess:N})})]})}},1685:function(e,r,a){"use strict";a.d(r,{m:function(){return n}});let n=e=>{let r=window.sessionStorage.getItem(e);return r?JSON.parse(r):null}},98345:function(e,r,a){"use strict";a.d(r,{H:function(){return v},G:function(){return y}});var n=a(45300),s=a(2784),l=a(96026),t=a(38449);a(26612);var d=a(65947),o=a(1685);let c=async(e,r,a)=>{try{let n=await e({extension:r,parameters:a});return r.includes("qry")?n:n.record}catch(e){return null}},i=(e,r,a,n)=>{let s=(e=JSON.parse(JSON.stringify(e))).record.controls,l=s.find(e=>"reference"===e.controlId);return l?l.accessLevel=(null==r?void 0:r.mandatory)?d.$7:d.rr:(null==r?void 0:r.mandatory)?s.push({sgId:0,resourceId:"",controlId:"".concat(n?n+".":"","reference"),accessLevel:(null==r?void 0:r.mandatory)?d.$7:d.rr}):(null==r?void 0:r.readOnly)?s.push({sgId:0,resourceId:"",controlId:"".concat(n?n+".":"","reference"),accessLevel:(null==r?void 0:r.readOnly)?d.rr:d.$7}):s=e.record.controls.filter(e=>"reference"!=e.controlId),a&&s.push({sgId:0,resourceId:"",controlId:"".concat(n?n+".":"","dtId"),accessLevel:d.$7}),{...e,record:{...e.record,controls:s}}},u=async(e,r,a)=>{let n,s;switch(a){case"dtId":let l=(0,o.m)("userData"),d=null==l?void 0:l.userId;s="_userId=".concat(d,"&_functionId=").concat(r),n=t.r.UserFunction.get;break;case"glbSysNumberRange":s="_recordId=".concat(r),n=t.r.SystemFunction.get;break;case"DocumentType":s="_dgId=".concat(r,"&_startAt=",0,"&_pageSize=",50),n=t.r.DocumentType.qry;break;case"DcTypNumberRange":s="_recordId=".concat(r),n=t.r.DocumentType.get;break;case"isExternal":s="_recordId=".concat(r),n=t.r.NumberRange.get;break;default:return null}return await c(e,n,s)},m=async function(e){let r,a,n,s,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,t=arguments.length>2?arguments[2]:void 0,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,o=!(arguments.length>4)||void 0===arguments[4]||arguments[4],c=arguments.length>5?arguments[5]:void 0,m=void 0===d&&l&&await u(e,l,"dtId"),p=null==m?void 0:m.dtId,y="",v=!0;if(m&&void 0===d||"nraId"===d){if(p){let a=await u(e,p,"DcTypNumberRange");r=null==a?void 0:a.nraId,v=!((null==a?void 0:a.activeStatus)<0),r||(y="Assign the document type to a number range")}if((!p||!v)&&o&&l){var f;let r=await u(e,l,"DocumentType");s=(null==r?void 0:null===(f=r.list)||void 0===f?void 0:f.filter(e=>(null==e?void 0:e.activeStatus)===1).length)>0}}if(("nraId"===d||void 0===d)&&l){if((!p||p)&&!r||r&&!v){let a=await u(e,l,"glbSysNumberRange");(r=null==a?void 0:a.nraId)&&s&&(s=!1),v=!0}y=r||s?"":"Assign the system Function to a number range"}d>0&&!r&&(r=d),r&&v?(a={readOnly:null==(n=await u(e,r,"isExternal"))||!n.external,mandatory:null!=n&&!!n.external},t&&(t=await i(t,a,s,c))):!r&&t&&(t=await i(t,a,s,c));let I=c?"".concat(c,".reference"):"reference";return{dtId:p,resetReference:null==a?void 0:a.readOnly,dcTypeRequired:s,reference:{fieldName:I,isEmpty:(null==n?void 0:n.external)!==void 0&&(null==n||!n.external)},errorMessage:y,maxAccess:t,selectNraId:d}};var p=a(65950);function y(e){let{functionId:r,action:a,hasDT:n}=e,{getRequest:t}=(0,s.useContext)(p.$),{stack:d}=(0,l.V)();return{proxyAction:async()=>{let e=await m(t,r,"",void 0,n);(null==e?void 0:e.errorMessage)?d({message:null==e?void 0:e.errorMessage}):await a()}}}function v(e){var r;let{functionId:a,access:t,hasDT:d,enabled:o=!0,objectName:c=""}=e,{getRequest:i}=(0,s.useContext)(p.$),{stack:u}=(0,l.V)(),[y,v]=(0,s.useState)(),f=async e=>{let r=await m(i,a,t,e,d,c);if(!r.errorMessage)return r;u({message:null==r?void 0:r.errorMessage})},I=(0,n.a)({retry:!1,staleTime:0,enabled:o,queryKey:[a,y,!!t,o],queryFn:y||"nraId"===y?()=>f(y):()=>f()});return{documentType:I.data,maxAccess:(null==I?void 0:null===(r=I.data)||void 0===r?void 0:r.maxAccess)||t,changeDT(e){v((null==e?void 0:e.nraId)||"nraId")}}}},29326:function(e,r,a){"use strict";var n=a(52322);a(2784);var s=a(23925),l=a(13980),t=a.n(l),d=a(95291),o=a.n(d),c=a(65947);let i=e=>{var r,a,l;let{children:t,value:d,index:i,maxAccess:u,...m}=e,p="".concat(e.name||"tab",".").concat(i),{accessLevel:y}=null!==(l=(null!==(a=null==u?void 0:null===(r=u.record)||void 0===r?void 0:r.controls)&&void 0!==a?a:[]).find(e=>e.controlId===p))&&void 0!==l?l:{accessLevel:0};if(y===c.A1)return null;let v=d===i;return(0,n.jsx)(s.Z,{role:"tabpanel",hidden:!v,id:"simple-tabpanel-".concat(i),"aria-labelledby":"simple-tab-".concat(i),className:"".concat(o().tabPanel," ").concat(v?o().active:o().hidden),...m,children:t})};i.propTypes={children:t().node,index:t().number.isRequired,value:t().number.isRequired},r.Z=i},9522:function(e,r,a){"use strict";a.d(r,{Y:function(){return m}});var n=a(52322),s=a(23925),l=a(54582),t=a(68696),d=a(44258),o=a(2784),c=a(99266),i=a(52614),u=a.n(i);let m=e=>{var r,a,i,m,p;let{tabs:y,activeTab:v,setActiveTab:f,maxAccess:I,name:h="tab"}=e,x=(null==I?void 0:null===(a=I.record)||void 0===a?void 0:null===(r=a.controls)||void 0===r?void 0:r.filter(e=>{var r;return 4===e.accessLevel&&(null===(r=e.controlId)||void 0===r?void 0:r.startsWith("".concat(h,".")))}).map(e=>e.controlId.split(".")[1]))||[],g=null==y?void 0:null===(i=y.map((e,r)=>({...e,id:r})))||void 0===i?void 0:i.filter((e,r)=>!x.includes(String(r))),b=null===(m=g[v])||void 0===m?void 0:m.id,N=null===(p=g[v])||void 0===p?void 0:p.disabled;return(0,o.useEffect)(()=>{b>=0&&!N&&v!=b&&f(b)},[]),(0,n.jsx)(s.Z,{className:u().tabsContainer,children:(0,n.jsx)(s.Z,{className:u().tabsWrapper,children:(0,n.jsx)(l.Z,{value:v,onChange:(e,r)=>f(r),variant:"scrollable",scrollButtons:g.length>3?"auto":"off","aria-label":"scrollable tabs",classes:{indicator:u().tabsIndicator},className:u().tabs,children:null==g?void 0:g.map(e=>(0,n.jsx)(t.Z,{value:e.id,disabled:null==e?void 0:e.disabled,className:"".concat(u().tabName," ").concat(e.disabled?u().tabDisabled:""),classes:{root:u().tabRoot,selected:u().selectedTab},label:(0,n.jsxs)(s.Z,{display:"flex",alignItems:"center",children:[(0,n.jsx)("span",{children:e.label}),e.id===v&&(null==e?void 0:e.onRefetch)&&(0,n.jsx)(d.Z,{size:"small",className:u().refreshButton,onClick:r=>{r.stopPropagation(),e.onRefetch()},children:(0,n.jsx)(c.Z,{className:u().refreshIcon})})]})},e.id))})})})}},95291:function(e){e.exports={tabPanel:"CustomTabPanel_tabPanel__80Dfu",active:"CustomTabPanel_active___6Uvb",hidden:"CustomTabPanel_hidden__y9566"}},52614:function(e){e.exports={customTabPanel:"CustomTabs_customTabPanel__Ztocv",hidden:"CustomTabs_hidden__lZpM7",tabsContainer:"CustomTabs_tabsContainer__28Syi",tabsWrapper:"CustomTabs_tabsWrapper__mlxxj",tabs:"CustomTabs_tabs__25pli",tabName:"CustomTabs_tabName__XzMCn",tabRoot:"CustomTabs_tabRoot__WVR1E",tabDisabled:"CustomTabs_tabDisabled__VauYR",selectedTab:"CustomTabs_selectedTab__sZzwF",tabsIndicator:"CustomTabs_tabsIndicator__89Lek",refreshButton:"CustomTabs_refreshButton__P2mzl",refreshIcon:"CustomTabs_refreshIcon__ADVWF"}}},function(e){e.O(0,[92515,2494,36908,49774,92888,40179],function(){return e(e.s=68734)}),_N_E=e.O()}]);