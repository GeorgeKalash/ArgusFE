(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[63230],{99846:function(e,n,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/pu-open-pr",function(){return r(6695)}])},6695:function(e,n,r){"use strict";r.r(n),r.d(n,{default:function(){return b}});var t=r(52322),a=r(2784),s=r(62202),l=r(65950),d=r(71987),o=r(26612),i=r(31389),c=r(33625),p=r(62362),u=r(19473),m=r(65215),y=r(60218),I=r(27423),g=r(80983),h=r(38449),v=r(8661),P=r(76399),R=r(39812),f=r(61802),x=r(96026),D=r(2454),q=r(30481),V=r(70104),O=r(25870),C=r(68838),k=r(69952),S=r(54074),b=()=>{var e,n;let{getRequest:r,postRequest:b}=(0,a.useContext)(l.$),{platformLabels:N}=(0,a.useContext)(u.l),{stack:F}=(0,f.zY)(),{stack:w}=(0,x.V)(),{labels:E,access:_}=(0,d.J)({datasetId:o.i.OpenPRs});function j(e){return!((null==e?void 0:e.length)<1)||(w({message:E.checkItemsBeforeAppend}),!1)}function T(e){return e.filter(e=>null==e?void 0:e.isChecked).map(e=>{let{scheduledDate:n,functionId:r,id:t,isChecked:a,...s}=e;return s})}let{formik:Q}=(0,g.c)({maxAccess:_,initialValues:{recordId:null,groupId:0,departmentId:0,categoryId:0,vendorId:0,clientRef:"",clientName:"",itemId:0,prId:0,items:[]},validateOnChange:!0,onSubmit:async e=>{let{vendorId:n,currencyId:r,items:t,taxId:a}=e,l=T(t);if(!j(l))return;let d=await b({extension:D.y.GeneratePOPRPack.gen,record:JSON.stringify({vendorId:n,currencyId:r,taxId:a,items:l})});d.recordId&&(F({Component:k.Z,props:{recordId:d.recordId}}),s.ZP.success(N.Generated),z())}}),{groupId:Z,departmentId:A,categoryId:G,vendorId:H,currencyId:U,itemId:L,prId:M}=Q.values;async function z(){var e;let n=await r({extension:q.g.OpenPurchaseRequisition.open,parameters:"_categoryId=".concat(G,"&_groupId=").concat(Z,"&_itemId=").concat(L,"&_departmentId=").concat(A,"&_prId=").concat(M)}),t=null==n?void 0:null===(e=n.list)||void 0===e?void 0:e.map((e,n)=>({...e,id:n+1,date:(0,R.a1)(e.date),balance:e.qty-e.orderedQty}));Q.setFieldValue("items",t||[])}(0,a.useEffect)(()=>{z()},[G,Z,M,L,A]);let B=[{component:"checkbox",name:"isChecked",flex:.3,checkAll:{value:(null===(e=Q.values.items)||void 0===e?void 0:e.length)>0&&(null===(n=Q.values.items)||void 0===n?void 0:n.every(e=>null==e?void 0:e.isChecked)),visible:!0,onChange(e){let{checked:n}=e,r=Q.values.items.map(e=>{let{isChecked:r,...t}=e;return{...t,isChecked:n,orderNow:n?t.balance:0}});Q.setFieldValue("items",r)}},async onChange(e){let{row:{update:n,newRow:r}}=e;n({orderNow:r.isChecked?r.balance:0})}},{component:"textfield",label:E.reference,name:"reference",props:{readOnly:!0}},{component:"date",label:E.date,name:"date",props:{readOnly:!0}},{component:"textfield",label:E.sku,name:"sku",props:{readOnly:!0}},{component:"textfield",label:E.name,name:"itemName",props:{readOnly:!0}},{component:"textfield",label:E.department,name:"departmentName",props:{readOnly:!0}},{component:"textfield",label:E.mu,name:"muRef",props:{readOnly:!0}},{component:"numberfield",label:E.qty,name:"qty",props:{readOnly:!0}},{component:"numberfield",label:E.ordered,name:"orderedQty",props:{readOnly:!0}},{component:"numberfield",label:E.balance,name:"balance",props:{readOnly:!0}},{component:"numberfield",label:E.genQty,name:"orderNow",updateOn:"blur",props:{allowNegative:!1},propsReducer(e){let{row:n,props:r}=e;return{...r,readOnly:!n.isChecked}},async onChange(e){let{row:{update:n,newRow:r}}=e,{orderNow:t,balance:a}=r;n({orderNow:(t<=a?t:a)||0})}}],$=[{key:"generateQTN",condition:!0,onClick:async()=>{let{vendorId:e,currencyId:n,items:r,taxId:t}=Q.values,a=T(r);if(!j(a))return;let l=await b({extension:D.y.GenerateQTNPRPack.gen,record:JSON.stringify({vendorId:e,currencyId:n,taxId:t,items:a})});s.ZP.success(N.Generated),l.recordId&&F({Component:C.Z,props:{recordId:l.recordId}}),z()},disabled:!H||!U},{key:"generatePO",condition:!0,onClick:()=>Q.handleSubmit(),disabled:!H||!U}];return(0,t.jsx)(S.Z,{actions:$,onSave:Q.handleSubmit,disabledSubmit:!H||!U,fullSize:!0,maxAccess:_,children:(0,t.jsxs)(i.R,{children:[(0,t.jsx)(c.g,{children:(0,t.jsxs)(y.ZP,{container:!0,spacing:2,p:2,children:[(0,t.jsx)(y.ZP,{item:!0,xs:4,children:(0,t.jsxs)(y.ZP,{container:!0,spacing:2,children:[(0,t.jsx)(y.ZP,{item:!0,xs:12,children:(0,t.jsx)(v.Z,{endpointId:m.$.Category.qry,parameters:"_pagesize=30&_startAt=0&_name=",name:"categoryId",label:E.category,valueField:"recordId",displayField:"name",values:null==Q?void 0:Q.values,maxAccess:_,onChange:(e,n)=>{Q.setFieldValue("categoryId",(null==n?void 0:n.recordId)||0)},error:Q.touched.categoryId&&!!Q.errors.categoryId})}),(0,t.jsx)(y.ZP,{item:!0,xs:12,children:(0,t.jsx)(v.Z,{endpointId:m.$.Group.qry,parameters:"_startAt=0&_pageSize=1000",name:"groupId",label:E.group,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:Q.values,onChange:(e,n)=>{Q.setFieldValue("groupId",(null==n?void 0:n.recordId)||0)},error:Q.touched.groupId&&!!Q.errors.groupId,maxAccess:_})})]})}),(0,t.jsx)(y.ZP,{item:!0,xs:4,children:(0,t.jsxs)(y.ZP,{container:!0,spacing:2,children:[(0,t.jsx)(y.ZP,{item:!0,xs:12,children:(0,t.jsx)(I.U,{endpointId:D.y.Vendor.snapshot,filter:e=>!e.isInactive,valueField:"reference",displayField:"name",name:"vendorId",label:E.vendor,form:Q,displayFieldWidth:2,valueShow:"vendorRef",secondValueShow:"vendorName",maxAccess:_,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"},{key:"flName",value:"Foreign Language"}],onChange:async(e,n)=>{Q.setFieldValue("vendorName",(null==n?void 0:n.name)||""),Q.setFieldValue("vendorRef",(null==n?void 0:n.reference)||""),Q.setFieldValue("vendorId",(null==n?void 0:n.recordId)||0)},errorCheck:"vendorId"})}),(0,t.jsx)(y.ZP,{item:!0,xs:12,children:(0,t.jsx)(v.Z,{endpointId:h.r.Currency.qry,name:"currencyId",label:E.currency,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:Q.values,maxAccess:_,onChange:(e,n)=>{Q.setFieldValue("currencyId",(null==n?void 0:n.recordId)||0)},error:Q.touched.currencyId&&!!Q.errors.currencyId})}),(0,t.jsx)(y.ZP,{item:!0,xs:12,children:(0,t.jsx)(I.U,{endpointId:D.y.PurchaseRequisition.snapshot,valueField:"reference",name:"prId",label:E.ref,form:Q,secondDisplayField:!1,valueShow:"poRef",maxAccess:_,onChange:async(e,n)=>{Q.setFieldValue("poRef",(null==n?void 0:n.reference)||""),Q.setFieldValue("prId",(null==n?void 0:n.recordId)||0)},errorCheck:"prId"})})]})}),(0,t.jsx)(y.ZP,{item:!0,xs:4,children:(0,t.jsxs)(y.ZP,{container:!0,spacing:2,children:[(0,t.jsx)(y.ZP,{item:!0,xs:12,children:(0,t.jsx)(v.Z,{endpointId:V.K.DepartmentFilters.qry,parameters:"_filter=&_size=1000&_startAt=0&_type=0&_activeStatus=0&_sortBy=recordId",name:"departmentId",label:E.department,values:Q.values,displayField:["departmentRef","name"],columnsInDropDown:[{key:"departmentRef",value:"Reference"},{key:"name",value:"Name"}],maxAccess:_,onChange:(e,n)=>{Q.setFieldValue("departmentId",(null==n?void 0:n.recordId)||0)},error:Q.touched.departmentId&&!!Q.errors.departmentId})}),(0,t.jsx)(y.ZP,{item:!0,xs:12,children:(0,t.jsx)(v.Z,{endpointId:O.H.TaxSchedules.qry,name:"taxId",label:E.tax,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:Q.values,onChange:(e,n)=>{Q.setFieldValue("taxId",n.recordId||null)},error:Q.touched.taxId&&!!Q.errors.taxId,maxAccess:_})}),(0,t.jsx)(y.ZP,{item:!0,xs:12,children:(0,t.jsx)(I.U,{endpointId:m.$.Item.snapshot,name:"itemId",label:E.sku,valueField:"sku",displayField:"name",valueShow:"sku",secondValueShow:"itemName",form:Q,columnsInDropDown:[{key:"sku",value:"SKU"},{key:"name",value:"Name"}],onChange:(e,n)=>{Q.setFieldValue("itemName",(null==n?void 0:n.name)||""),Q.setFieldValue("sku",(null==n?void 0:n.sku)||""),Q.setFieldValue("itemId",(null==n?void 0:n.recordId)||0)},displayFieldWidth:2,maxAccess:_})})]})})]})}),(0,t.jsx)(p.Q,{children:(0,t.jsx)(P._,{onChange:e=>Q.setFieldValue("items",e),value:Q.values.items,error:Q.errors.items,columns:B,name:"items",allowDelete:!1,allowAddNewLine:!1,maxAccess:_})})]})})}},2454:function(e,n,r){"use strict";r.d(n,{y:function(){return a}});let t="PU.asmx/",a={VendorGroups:{qry:t+"qryGRP",page:t+"pageGRP",get:t+"getGRP",set:t+"setGRP",del:t+"delGRP"},PriceList:{qry:t+"qryPRI",del:t+"delPRI",get:t+"getPRI",set:t+"setPRI"},PUOrderStatus:{qry:t+"qryPOS",page:t+"pagePOS",get:t+"getPOS",set:t+"setPOS",del:t+"delPOS"},DeliveryMethods:{qry:t+"qryDM",page:t+"pageDM",get:t+"getDM",set:t+"setDM",del:t+"delDM"},PaymentTerms:{qry:t+"qryPT",page:t+"pagePT",get:t+"getPT",set:t+"setPT",del:t+"delPT"},Vendor:{snapshot:t+"snapshotVEN",qry:t+"qryVEN",page:t+"pageVEN",get:t+"getVEN",set:t+"setVEN",del:t+"delVEN"},Address:{qry:t+"qryAD",page:t+"pageAD",get:t+"getAD",set:t+"setAD",del:t+"delAD"},DocumentTypeDefault:{qry:t+"qryDTD",get:t+"getDTD",set:t+"setDTD",del:t+"delDTD",page:t+"pageDTD"},PurchaseInvoiceHeader:{qry:t+"qryIVC",get:t+"getIVC",get2:t+"get2IVC",level2_PU:t+"level2_PU",set:t+"setIVC",del:t+"delIVC",snapshot:t+"snapshotIVC",set2:t+"set2IVC",post:t+"postIVC",unpost:t+"unpostIVC",generate:t+"generateIVC",preview:t+"previewIVC",sync:t+"syncIVC",verify:t+"verifyIVC"},Invoice:{snapshot:t+"snapshotINV"},PurchaseReturnHeader:{set2:t+"set2IVR",post:t+"postIVR",unpost:t+"unpostIVR",del:t+"delIVR",qry:t+"qryIVR",snapshot:t+"snapshotIVR"},VendorPrice:{get:t+"getPRI2"},ItemCostHistory:{qry:t+"qryIPH"},ItemPromotion:{qry:t+"qryIVIM"},Serials:{qry:t+"qrySRL",import:t+"importSRL",last:t+"lastSRL",sync:t+"syncSRL"},Shipment:{get:t+"getSHP",set2:t+"set2SHP",del:t+"delSHP",page:t+"pageSHP",snapshot:t+"snapshotSHP",post:t+"postSHP",unpost:t+"unpostSHP",gen:t+"genSHP"},ShipmentItem:{qry:t+"qrySHI"},UnpostedOrderPack:{get:t+"openORD",snapshot:t+"snapshotORD"},PurchaseOrder:{page:t+"pageORD",snapshot:t+"snapshotORD",del:t+"delORD",set2:t+"set2ORD",get2:t+"get2ORD",close:t+"closeORD",reopen:t+"reopenORD",terminate:t+"terminateORD",transfer:t+"transfer1ORD"},PurchaseRequisition:{snapshot:t+"snapshotREQ",page:t+"pageREQ",get:t+"getREQ",set:t+"setREQ",del:t+"delREQ",cancel:t+"cancelREQ",reopen:t+"reopenREQ",close:t+"closeREQ"},RequisitionDetail:{qry:t+"qryREI",set:t+"setREI",get:t+"getREI",del:t+"delREI"},QuotationItem:{preview:t+"previewQTI",qry:t+"qryQTI"},OrderItem:{qry:t+"qryORI",set2:t+"set2ORI"},PUDraftReturn:{set2:t+"set2DRE",get:t+"getDRE",page:t+"pageDRE",snapshot:t+"snapshotDRE",del:t+"delDRE",post:t+"postDRE"},PUDraftReturnSerial:{get2:t+"get2DRS",qry:t+"qryDRS",del:t+"delDRS",append:t+"appendDRS",batch:t+"batchDRS"},FinancialGroup:{qry:t+"qryFII",set2:t+"set2FII"},PUInvoiceRetBalance:{balance:t+"balanceRET"},ItemLastPurchaseInfo:{last:t+"lastIVI"},PurchaseQuotation:{page:t+"pageQTN",set2:t+"set2QTN",get:t+"getQTN",del:t+"delQTN",snapshot:t+"snapshotQTN"},GenerateQTNPRPack:{gen:t+"genQTN"},GeneratePOPRPack:{gen:t+"genPO",gen2:t+"gen2PO"}}},30481:function(e,n,r){"use strict";r.d(n,{g:function(){return a}});let t="RG.PU.asmx/",a={OpenPurchaseOrder:{open:t+"openPO"},OpenPurchaseRequisition:{open:t+"openPR"}}},70104:function(e,n,r){"use strict";r.d(n,{K:function(){return a}});let t="CS.asmx/",a={DivisionFilters:{qry:t+"qryDI"},BranchFilters:{qry:t+"qryBR"},CompanyPositions:{qry:t+"qryPO"},DepartmentFilters:{qry:t+"qryDE"}}}},function(e){e.O(0,[23352,69952,68838,49774,92888,40179],function(){return e(e.s=99846)}),_N_E=e.O()}]);