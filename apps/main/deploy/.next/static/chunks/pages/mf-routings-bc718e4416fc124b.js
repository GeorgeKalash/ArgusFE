(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3868],{98728:function(e,n,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/mf-routings",function(){return a(787)}])},787:function(e,n,a){"use strict";a.r(n),a.d(n,{default:function(){return P}});var t=a(52322),r=a(2784),o=a(62202),l=a(69387),i=a(65950),s=a(90587),d=a(71987),c=a(26612),u=a(29326),m=a(60218),v=a(78711),f=a(48601),b=a(82737),p=a(19689),h=a(5088),x=a(19473),_=a(8661),g=a(31389),I=a(62362);function C(e){var n;let{labels:a,maxAccess:l,setStore:u,store:C}=e,{getRequest:y,postRequest:j}=(0,r.useContext)(i.$),{platformLabels:w}=(0,r.useContext)(x.l),{recordId:N}=C,R=(0,d.E)({endpointId:s.u.Routing.page}),Z=(0,v.TA)({initialValues:{recordId:null,reference:"",name:"",isInactive:!1},validateOnChange:!0,validationSchema:f.Ry({reference:f.Z_().required(),name:f.Z_().required()}),onSubmit:async e=>{let n=await j({extension:s.u.Routing.set,record:JSON.stringify(e)});Z.setFieldValue("recordId",n.recordId),u(e=>({...e,recordId:n.recordId})),o.ZP.success(N?w.Edited:w.Added),R()}});return(0,r.useEffect)(()=>{!async function(){if(N){let e=await y({extension:s.u.Routing.get,parameters:"_recordId=".concat(N)});Z.setValues({...e.record})}}()},[]),(0,t.jsx)(b.Z,{resourceId:c.i.Routings,form:Z,maxAccess:l,editMode:!!N,children:(0,t.jsx)(g.R,{children:(0,t.jsx)(I.Q,{children:(0,t.jsxs)(m.ZP,{container:!0,spacing:2,children:[(0,t.jsx)(m.ZP,{item:!0,xs:12,children:(0,t.jsx)(h.Z,{name:"reference",label:a.reference,value:Z.values.reference,required:!0,rows:2,maxLength:"10",maxAccess:l,onChange:Z.handleChange,onClear:()=>Z.setFieldValue("reference",""),error:Z.touched.reference&&!!Z.errors.reference})}),(0,t.jsx)(m.ZP,{item:!0,xs:12,children:(0,t.jsx)(h.Z,{name:"name",label:a.name,value:Z.values.name,maxLength:"50",required:!0,maxAccess:l,onChange:Z.handleChange,onClear:()=>Z.setFieldValue("name",""),error:Z.touched.name&&!!Z.errors.name})}),(0,t.jsx)(m.ZP,{item:!0,xs:12,children:(0,t.jsx)(_.Z,{endpointId:s.u.ProductionLine.qry,name:"lineId",label:a.lineId,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],valueField:"recordId",displayField:["reference","name"],values:Z.values,onChange:(e,n)=>{Z.setFieldValue("lineId",(null==n?void 0:n.recordId)||null)},maxAccess:l,error:Z.touched.lineId&&!!Z.errors.lineId})}),(0,t.jsx)(m.ZP,{item:!0,xs:12,children:(0,t.jsx)(p.Z,{name:"isInactive",value:null===(n=Z.values)||void 0===n?void 0:n.isInactive,onChange:e=>Z.setFieldValue("isInactive",e.target.checked),label:a.isInactive,maxAccess:l})})]})})})})}var y=a(76399),j=a(80983),w=a(67920),N=a(54074),R=e=>{var n,a;let{store:l,labels:d,maxAccess:c}=e,{getRequest:u,postRequest:m}=(0,r.useContext)(i.$),{platformLabels:v}=(0,r.useContext)(x.l),{recordId:b}=l,[p,h]=(0,r.useState)([]),_=(0,r.useRef)([]),{schema:C,requiredFields:R}=(0,w.m)({seqNo:e=>e.seqNo,name:e=>e.name,workCenterId:e=>e.workCenterId,operationId:e=>e.operationId},!0,c,"data"),{formik:Z}=(0,j.c)({maxAccess:c,validateOnChange:!0,conditionSchema:["data"],validationSchema:f.Ry({data:f.IX().of(C)}),initialValues:{data:[{id:1,seqNo:0}]},onSubmit:async e=>{let n=null==e?void 0:e.data.filter(e=>{var n;return null===(n=Object.values(R))||void 0===n?void 0:n.every(n=>n(e))}).map(e=>({...e,routingId:b}));await m({extension:s.u.RoutingSequence.set2,record:JSON.stringify({routingId:b,data:n})}),o.ZP.success(v.Edited)}});async function T(e){let n=(null==p?void 0:p.filter(n=>(null==n?void 0:n.workCenterId)==e))||[];_.current=n}let k=async()=>await u({extension:s.u.Operation.qry,parameters:"_filter=&_workCenterId=0"}),A=[{component:"numberfield",label:d.seqNo,name:"seqNo",props:{maxLength:5,decimalScale:0}},{component:"textfield",label:d.name,name:"name"},{component:"resourcecombobox",label:d.workCenter,name:"workCenterId",props:{endpointId:s.u.WorkCenter.qry,displayField:"name",valueField:"recordId",mapping:[{from:"recordId",to:"workCenterId"},{from:"name",to:"workCenterName"},{from:"reference",to:"workCenterRef"}],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}]},async onChange(e){let{row:{update:n,newRow:a}}=e;T(null==a?void 0:a.workCenterId)}},{component:"resourcecombobox",label:d.operation,name:"operationId",props:{store:null==_?void 0:_.current,displayField:"name",valueField:"recordId",mapping:[{from:"recordId",to:"operationId"},{from:"name",to:"operationName"},{from:"reference",to:"operationRef"}],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}]},propsReducer(e){let{row:n,props:a}=e;return{...a,store:null==_?void 0:_.current}}}];return(0,r.useEffect)(()=>{!async function(){let e=await k();if(h(null==e?void 0:e.list),b){var n,a;let e=await u({extension:s.u.RoutingSequence.qry,parameters:"_routingId=".concat(b)}),t=(null==e?void 0:null===(n=e.list)||void 0===n?void 0:n.length)!=0?await Promise.all(null==e?void 0:null===(a=e.list)||void 0===a?void 0:a.map(async(e,n)=>({...e,id:n+1}))):[{id:1}];Z.setFieldValue("data",t)}}()},[]),(0,t.jsx)(t.Fragment,{children:(0,t.jsx)(N.Z,{onSave:Z.handleSubmit,editMode:!!b,maxAccess:c,isParentWindow:!1,children:(0,t.jsx)(g.R,{children:(0,t.jsx)(I.Q,{children:(0,t.jsx)(y._,{name:"routingSequence",maxAccess:c,onChange:e=>Z.setFieldValue("data",e),onSelectionChange:(e,n,a)=>{"operationId"==a&&T(null==e?void 0:e.workCenterId)},value:null===(n=Z.values)||void 0===n?void 0:n.data,error:null===(a=Z.errors)||void 0===a?void 0:a.data,columns:A})})})})})},Z=a(9522),T=e=>{let{labels:n,maxAccess:a,recordId:o}=e,[l,i]=(0,r.useState)(0),[s,d]=(0,r.useState)({recordId:o}),c=[{label:n.routing},{label:n.routingSeq,disabled:!s.recordId}];return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(Z.Y,{tabs:c,activeTab:l,setActiveTab:i,maxAccess:a}),(0,t.jsx)(u.Z,{index:0,value:l,maxAccess:a,children:(0,t.jsx)(C,{labels:n,maxAccess:a,setStore:d,store:s})}),(0,t.jsx)(u.Z,{index:1,value:l,maxAccess:a,children:(0,t.jsx)(R,{maxAccess:a,labels:n,store:s})})]})},k=a(33625),A=a(61802),q=a(36908),P=()=>{let{getRequest:e,postRequest:n}=(0,r.useContext)(i.$),{platformLabels:a}=(0,r.useContext)(x.l),{stack:u}=(0,A.zY)(),{query:{data:m},filterBy:v,refetch:f,labels:b,access:p,paginationParameters:h,invalidate:_}=(0,d.J)({queryFn:y,endpointId:s.u.Routing.page,datasetId:c.i.Routings,filter:{filterFn:j}}),C=[{field:"reference",headerName:b.reference,flex:1},{field:"name",headerName:b.name,flex:1},{field:"lineRef",headerName:b.lineId,flex:1},{field:"lineName",headerName:b.lineName,flex:1}];async function y(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{_startAt:a=0,_pageSize:t=50,params:r=[]}=n;return{...await e({extension:s.u.Routing.page,parameters:"_startAt=".concat(a,"&_pageSize=").concat(t,"&_params=").concat(r,"&filter=")}),_startAt:a}}async function j(n){let{filters:a,pagination:t}=n;return a.qry?await e({extension:s.u.Routing.snapshot,parameters:"_filter=".concat(a.qry)}):y({_startAt:t._startAt||0,params:null==a?void 0:a.params})}let w=async e=>{await n({extension:s.u.Routing.del,record:JSON.stringify(e)}),_(),o.ZP.success(a.Deleted)};async function N(e){u({Component:T,props:{labels:b,maxAccess:p,recordId:e},width:800,height:630,title:b.routing})}return(0,t.jsxs)(g.R,{children:[(0,t.jsx)(k.g,{children:(0,t.jsx)(q.Z,{onAdd:()=>{N()},maxAccess:p,filterBy:v,reportName:"MFRTN"})}),(0,t.jsx)(I.Q,{children:(0,t.jsx)(l.Z,{columns:C,gridData:m,rowId:["recordId"],onEdit:e=>{N(null==e?void 0:e.recordId)},onDelete:w,refetch:f,isLoading:!1,pageSize:50,paginationType:"api",maxAccess:p,paginationParameters:h})})]})}},67920:function(e,n,a){"use strict";a.d(n,{m:function(){return r}});var t=a(48601);function r(e,n,a){var r;let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"items",l={...e};return null==a||null===(r=a.record)||void 0===r||r.controls.forEach(e=>{let{controlId:n,accessLevel:a}=e,[t,r]=null==n?void 0:n.split(".");t!==o||2!==a||r in l||(l[r]=e=>(null==e?void 0:e[r])!=null),(1===a||4===a)&&r in l&&delete l[r]}),{schema:t.Ry().shape({...Object.keys(l).reduce((e,a)=>(e[a]=t.nK().nullable().test(function(e){var t;let r=this.parent,[,o]=this.path.match(/^(\w+)\[(\d+)\]/)||[],i=(null===(t=this.options.context)||void 0===t?void 0:t[o])||[];if(n||!n&&i.length>1){if(null!==r[a]&&void 0!==r[a]&&0!==r[a]&&""!==l[a]&&!l[a](r))return!1;if(!Object.entries(l).some(e=>{let[,n]=e;return!!n(r)}))return!0}return!!l[a](r)&&void 0!==e}),e),{})}),requiredFields:l}}},29326:function(e,n,a){"use strict";var t=a(52322);a(2784);var r=a(23925),o=a(13980),l=a.n(o),i=a(95291),s=a.n(i),d=a(65947);let c=e=>{var n,a,o;let{children:l,value:i,index:c,maxAccess:u,...m}=e,v="".concat(e.name||"tab",".").concat(c),{accessLevel:f}=null!==(o=(null!==(a=null==u?void 0:null===(n=u.record)||void 0===n?void 0:n.controls)&&void 0!==a?a:[]).find(e=>e.controlId===v))&&void 0!==o?o:{accessLevel:0};if(f===d.A1)return null;let b=i===c;return(0,t.jsx)(r.Z,{role:"tabpanel",hidden:!b,id:"simple-tabpanel-".concat(c),"aria-labelledby":"simple-tab-".concat(c),className:"".concat(s().tabPanel," ").concat(b?s().active:s().hidden),...m,children:l})};c.propTypes={children:l().node,index:l().number.isRequired,value:l().number.isRequired},n.Z=c},9522:function(e,n,a){"use strict";a.d(n,{Y:function(){return m}});var t=a(52322),r=a(23925),o=a(54582),l=a(68696),i=a(44258),s=a(2784),d=a(99266),c=a(52614),u=a.n(c);let m=e=>{var n,a,c,m,v;let{tabs:f,activeTab:b,setActiveTab:p,maxAccess:h,name:x="tab"}=e,_=(null==h?void 0:null===(a=h.record)||void 0===a?void 0:null===(n=a.controls)||void 0===n?void 0:n.filter(e=>{var n;return 4===e.accessLevel&&(null===(n=e.controlId)||void 0===n?void 0:n.startsWith("".concat(x,".")))}).map(e=>e.controlId.split(".")[1]))||[],g=null==f?void 0:null===(c=f.map((e,n)=>({...e,id:n})))||void 0===c?void 0:c.filter((e,n)=>!_.includes(String(n))),I=null===(m=g[b])||void 0===m?void 0:m.id,C=null===(v=g[b])||void 0===v?void 0:v.disabled;return(0,s.useEffect)(()=>{I>=0&&!C&&b!=I&&p(I)},[]),(0,t.jsx)(r.Z,{className:u().tabsContainer,children:(0,t.jsx)(r.Z,{className:u().tabsWrapper,children:(0,t.jsx)(o.Z,{value:b,onChange:(e,n)=>p(n),variant:"scrollable",scrollButtons:g.length>3?"auto":"off","aria-label":"scrollable tabs",classes:{indicator:u().tabsIndicator},className:u().tabs,children:null==g?void 0:g.map(e=>(0,t.jsx)(l.Z,{value:e.id,disabled:null==e?void 0:e.disabled,className:"".concat(u().tabName," ").concat(e.disabled?u().tabDisabled:""),classes:{root:u().tabRoot,selected:u().selectedTab},label:(0,t.jsxs)(r.Z,{display:"flex",alignItems:"center",children:[(0,t.jsx)("span",{children:e.label}),e.id===b&&(null==e?void 0:e.onRefetch)&&(0,t.jsx)(i.Z,{size:"small",className:u().refreshButton,onClick:n=>{n.stopPropagation(),e.onRefetch()},children:(0,t.jsx)(d.Z,{className:u().refreshIcon})})]})},e.id))})})})}},95291:function(e){e.exports={tabPanel:"CustomTabPanel_tabPanel__80Dfu",active:"CustomTabPanel_active___6Uvb",hidden:"CustomTabPanel_hidden__y9566"}},52614:function(e){e.exports={customTabPanel:"CustomTabs_customTabPanel__Ztocv",hidden:"CustomTabs_hidden__lZpM7",tabsContainer:"CustomTabs_tabsContainer__28Syi",tabsWrapper:"CustomTabs_tabsWrapper__mlxxj",tabs:"CustomTabs_tabs__25pli",tabName:"CustomTabs_tabName__XzMCn",tabRoot:"CustomTabs_tabRoot__WVR1E",tabDisabled:"CustomTabs_tabDisabled__VauYR",selectedTab:"CustomTabs_selectedTab__sZzwF",tabsIndicator:"CustomTabs_tabsIndicator__89Lek",refreshButton:"CustomTabs_refreshButton__P2mzl",refreshIcon:"CustomTabs_refreshIcon__ADVWF"}}},function(e){e.O(0,[92515,2494,36908,49774,92888,40179],function(){return e(e.s=98728)}),_N_E=e.O()}]);