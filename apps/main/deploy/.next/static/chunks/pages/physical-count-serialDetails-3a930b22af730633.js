(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[62099],{56671:function(e,l,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/physical-count-serialDetails",function(){return t(56576)}])},56576:function(e,l,t){"use strict";t.r(l),t.d(l,{default:function(){return j}});var o=t(52322),s=t(31389),n=t(62362),i=t(2784),d=t(65950),a=t(26612),r=t(33625),u=t(60218),c=t(19473),v=t(71987),I=t(8661),C=t(76426),m=t(82737),x=t(80983),h=t(48601),S=t(76399),p=t(65215),f=t(51235),g=t(62202),k=t(5088),y=t(25506),w=t(89330),D=t(32025),N=t(61802),b=t(81330),Z=t(39812),j=()=>{var e,l,t,j,T,R,q,P,F,_,V,L,O,A,H,E,B,Y,J,W,U,M,z,G,X,$,Q,K,ee,el,et,eo,es,en;let{stack:ei}=(0,N.zY)(),{getRequest:ed,postRequest:ea}=(0,i.useContext)(d.$),{platformLabels:er,systemChecks:eu}=(0,i.useContext)(c.l),[ec,ev]=(0,i.useState)(!1),[eI,eC]=(0,i.useState)(!1),{labels:em,access:ex}=(0,v.J)({datasetId:a.i.PhysicalCountSerialDetail}),{formik:eh}=(0,x.c)({maxAccess:ex,initialValues:{stockCountId:null,siteId:null,controllerId:null,status:1,SCStatus:null,SCWIP:null,EndofSiteStatus:null,search:"",scRef:null,scDate:null,rows:[{id:1,seqNo:1,srlNo:"",weight:0,sku:"",itemId:null,itemName:""}]},validationSchema:h.Ry({stockCountId:h.Rx().required(),scDate:h.hT().required(),scRef:h.Z_().required(),siteId:h.Rx().required(),controllerId:h.Rx().required(),rows:h.IX().of(h.Ry().shape({srlNo:h.Z_().test({name:"srlNo-first-row-check",test(e,l){var t;let{parent:o,options:s}=l,n=null==s?void 0:null===(t=s.context)||void 0===t?void 0:t.rows;return(null==n?void 0:n.findIndex(e=>e.id===o.id))===(null==n?void 0:n.length)-1||!!e}})})).required()}),onSubmit:async e=>{var l;let t=null==e?void 0:null===(l=e.rows)||void 0===l?void 0:l.filter(e=>e.srlNo).map((l,t)=>({...l,seqNo:t+1,siteId:e.siteId,stockCountId:e.stockCountId,controllerId:e.controllerId})),o={siteId:e.siteId,controllerId:e.controllerId,stockCountId:e.stockCountId,stockCountSerials:t};await ea({extension:C.x.StockCountSerialDetail.set2,record:JSON.stringify(o)}),g.ZP.success(er.Saved),ev(t.length>0),ep(e.controllerId)}});async function eS(e){var l;await ed({extension:C.x.StockCountSerialDetail.qry,parameters:"_stockCountId=".concat(eh.values.stockCountId,"&_siteId=").concat(eh.values.siteId,"&_controllerId=").concat(e||(null==eh?void 0:null===(l=eh.values)||void 0===l?void 0:l.controllerId))}).then(e=>{if(e.list){var l;let t=null===(l=e.list)||void 0===l?void 0:l.map((e,l)=>({...e,id:l+1}));t.length>0&&eh.setFieldValue("rows",t)}ev(e.list.length>0)})}let ep=async e=>{var l;let t=await ed({extension:C.x.StockCountControllerTab.get,parameters:"_stockCountId=".concat(eh.values.stockCountId,"&_siteId=").concat(eh.values.siteId,"&_controllerId=").concat(e)});eh.setFieldValue("status",null==t?void 0:null===(l=t.record)||void 0===l?void 0:l.status)};async function ef(e){if((null==e?void 0:e.srlNo)&&(null==e?void 0:e.itemId)){var l,t,o;e.controllerId=null==eh?void 0:null===(l=eh.values)||void 0===l?void 0:l.controllerId,e.siteId=null==eh?void 0:null===(t=eh.values)||void 0===t?void 0:t.siteId,e.stockCountId=null==eh?void 0:null===(o=eh.values)||void 0===o?void 0:o.stockCountId,await ea({extension:C.x.StockCountSerialDetail.append,record:JSON.stringify(e)}),g.ZP.success(er.Saved)}}let eg=async e=>{var l,t,o;return null==e||!e.srlNo||null==e||!e.itemId||(e.controllerId=null==eh?void 0:null===(l=eh.values)||void 0===l?void 0:l.controllerId,e.siteId=null==eh?void 0:null===(t=eh.values)||void 0===t?void 0:t.siteId,e.stockCountId=null==eh?void 0:null===(o=eh.values)||void 0===o?void 0:o.stockCountId,await ea({extension:C.x.StockCountSerialDetail.del,record:JSON.stringify(e)}),g.ZP.success(er.Deleted),!0)},ek=(e,l,t)=>{if("delete"===l){let e=eh.values.rows;e=e.filter(e=>e.srlNo!==t.srlNo),eh.setFieldValue("rows",e)}else eh.setFieldValue("rows",e)},ey=null==eu?void 0:null===(e=eu.find(e=>e.checkId===f.F.POS_JUMP_TO_NEXT_LINE))||void 0===e?void 0:e.value,ew=null==eu?void 0:null===(l=eu.find(e=>e.checkId===f.F.AUTO_SAVE_CYCLE_COUNT))||void 0===l?void 0:l.value,eD=[{component:"textfield",name:"srlNo",label:em.srlNo,updateOn:"blur",props:{clearable:!0},jumpToNextLine:ey,async onChange(e){let{row:{update:l,newRow:t,oldRow:o,addRow:s}}=e;if(t.srlNo!==(null==o?void 0:o.srlNo)){var n;let e=await ed({extension:p.$.Serial.get2,parameters:"_srlNo=".concat(null==t?void 0:t.srlNo,"&_siteId=").concat(null==eh?void 0:null===(n=eh.values)||void 0===n?void 0:n.siteId)}),l=null==e?void 0:e.record;if(l){let e={fieldName:"srlNo",changes:{id:t.id,seqNo:t.id,srlNo:l.srlNo,sku:l.sku,itemId:l.itemId,itemName:null==l?void 0:l.itemName,weight:(null==l?void 0:l.weight)||0}};ew&&await ef(e.changes),await s(e)}}else l({...o,srlNo:o.srlNo})}},{component:"numberfield",label:em.weight,name:"weight",props:{readOnly:!0}},{component:"textfield",name:"sku",label:em.sku,props:{readOnly:!0}},{component:"textfield",name:"itemName",label:em.name,props:{readOnly:!0}}],eN=3===eh.values.status,eb=(null==eh?void 0:null===(T=eh.values)||void 0===T?void 0:null===(j=T.rows)||void 0===j?void 0:null===(t=j.filter(e=>null==e?void 0:e.srlNo))||void 0===t?void 0:t.length)===0,eZ=null!=eh.values.controllerId&&3!=eh.values.SCStatus&&2!=eh.values.SCWIP&&3!=eh.values.EndofSiteStatus,ej=null!=eh.values.controllerId&&3!=eh.values.status&&3!=eh.values.SCStatus&&2!=eh.values.SCWIP&&3!=eh.values.EndofSiteStatus,eT=async()=>{let e=1==eh.values.status?3:1;eh.setFieldValue("status",e);let l={siteId:eh.values.siteId,controllerId:eh.values.controllerId,stockCountId:eh.values.stockCountId,status:e};await ea({extension:C.x.StockCountControllerTab.set,record:JSON.stringify(l)}),g.ZP.success(eN?er.Posted:er.Unposted)},eR=async e=>{ei({Component:D.Z,props:{open:{flag:!0},fullScreen:!1,onConfirm:()=>{"clearAll"===e?eh.resetForm():eh.setFieldValue("rows",eh.initialValues.rows),eC(!1),ev(!1)},dialogText:"clearAll"===e?er.ClearFormGrid:er.DeleteGridConf}})},eq=[{key:"Locked",condition:eN,onClick:"onUnpostConfirmation",onSuccess:eT,disabled:!eZ},{key:"Unlocked",condition:!eN,onClick:eT,disabled:!eZ},{key:"ClearGrid",condition:!0,onClick:()=>eR(),disabled:!ej||eb},{key:"ClearHG",condition:!0,onClick:()=>eR("clearAll"),disabled:!(eh.values.controllerId||eh.values.siteId||eh.values.stockCountId)},{key:"Import",condition:!0,onClick:e_,disabled:!ej}],eP=eh.values.rows.filter(e=>e.srlNo).length,eF=eh.values.rows.reduce((e,l)=>{var t;return e+(parseFloat(null===(t=l.weight)||void 0===t?void 0:t.toString().replace(/,/g,""))||0)},0);async function e_(){var e,l,t;ei({Component:b.Z,props:{endPoint:C.x.StockCountSerialDetail.batch,header:{siteId:null==eh?void 0:null===(e=eh.values)||void 0===e?void 0:e.siteId,controllerId:null==eh?void 0:null===(l=eh.values)||void 0===l?void 0:l.controllerId,stockCountId:null==eh?void 0:null===(t=eh.values)||void 0===t?void 0:t.stockCountId},onCloseimport:eS,maxAccess:ex}})}let eV=eh.values.search?eh.values.rows.filter(e=>{var l,t,o,s,n,i,d,a,r;return e.sku&&(null===(o=e.sku)||void 0===o?void 0:null===(t=o.toLowerCase().toString())||void 0===t?void 0:t.includes(null===(l=eh.values.search)||void 0===l?void 0:l.toLowerCase()))||e.srlNo&&(null===(i=e.srlNo)||void 0===i?void 0:null===(n=i.toString())||void 0===n?void 0:n.includes(null===(s=eh.values.search)||void 0===s?void 0:s.toLowerCase()))||e.weight&&(null===(r=e.weight)||void 0===r?void 0:null===(a=r.toString())||void 0===a?void 0:a.includes(null===(d=eh.values.search)||void 0===d?void 0:d.toLowerCase()))}):eh.values.rows;return(0,o.jsx)(m.Z,{form:eh,isInfo:!1,isCleared:!1,disabledSubmit:!ej,actions:eq,maxAccess:ex,resourceId:a.i.PhysicalCountSerialDetail,previewReport:ec,fullSize:!0,children:(0,o.jsxs)(s.R,{children:[(0,o.jsx)(r.g,{children:(0,o.jsxs)(u.ZP,{container:!0,spacing:2,p:2,children:[(0,o.jsx)(u.ZP,{item:!0,xs:3,children:(0,o.jsx)(I.Z,{endpointId:C.x.StockCount.qry,parameters:"_startAt=0&_pageSize=1000&_params=",name:"stockCountId",label:em.stockCount,valueField:"recordId",displayField:"reference",values:eh.values,required:!0,readOnly:eI,maxAccess:ex,onChange:(e,l)=>{eh.setFieldValue("stockCountId",(null==l?void 0:l.recordId)||null),eh.setFieldValue("siteId",null),eh.setFieldValue("controllerId",null),ev(!1),eh.setFieldValue("SCStatus",(null==l?void 0:l.status)||null),eh.setFieldValue("SCWIP",(null==l?void 0:l.wip)||null),eh.setFieldValue("scDate",(0,Z.a1)(null==l?void 0:l.date)||null),eh.setFieldValue("scRef",(null==l?void 0:l.reference)||null)},error:eh.touched.stockCountId&&!!eh.errors.stockCountId})}),(0,o.jsx)(u.ZP,{item:!0,xs:3,children:(0,o.jsx)(w.Z,{name:"scDate",label:em.stockCountDate,value:null==eh?void 0:null===(R=eh.values)||void 0===R?void 0:R.scDate,readOnly:!0,required:!0,error:eh.touched.scDate&&!!eh.errors.scDate})}),(0,o.jsx)(u.ZP,{item:!0,xs:3,children:(0,o.jsx)(k.Z,{name:"scRef",label:em.stockCountRef,value:null==eh?void 0:null===(q=eh.values)||void 0===q?void 0:q.scRef,readOnly:!0,required:!0,error:eh.touched.scRef&&!!eh.errors.scRef})}),(0,o.jsx)(u.ZP,{item:!0,xs:3}),(0,o.jsx)(u.ZP,{item:!0,xs:3,children:(0,o.jsx)(I.Z,{endpointId:(null==eh?void 0:null===(P=eh.values)||void 0===P?void 0:P.stockCountId)&&C.x.Sites.qry,parameters:"_stockCountId=".concat(null==eh?void 0:null===(F=eh.values)||void 0===F?void 0:F.stockCountId),filter:e=>e.isChecked,name:"siteId",label:em.site,valueField:"siteId",displayField:["siteRef","siteName"],columnsInDropDown:[{key:"siteRef",value:"Reference"},{key:"siteName",value:"Name"}],values:eh.values,required:!0,readOnly:eI,onChange:(e,l)=>{eh.setFieldValue("siteId",(null==l?void 0:l.siteId)||null),eh.setFieldValue("controllerId",null),eh.setFieldValue("EndofSiteStatus",(null==l?void 0:l.status)||null)},error:eh.touched.siteId&&!!eh.errors.siteId,maxAccess:ex},eh.values.stockCountId)}),(0,o.jsx)(u.ZP,{item:!0,xs:9}),(0,o.jsx)(u.ZP,{item:!0,xs:3,children:(0,o.jsx)(I.Z,{endpointId:(null==eh?void 0:null===(_=eh.values)||void 0===_?void 0:_.siteId)&&C.x.StockCountControllerTab.qry,parameters:"_stockCountId=".concat(null==eh?void 0:null===(V=eh.values)||void 0===V?void 0:V.stockCountId,"&_siteId=").concat(null==eh?void 0:null===(L=eh.values)||void 0===L?void 0:L.siteId),name:"controllerId",label:em.controller,valueField:"controllerId",displayField:"controllerName",values:eh.values,required:!0,readOnly:eI,onChange:(e,l)=>{eh.setFieldValue("controllerId",(null==l?void 0:l.controllerId)||null),eC(!0),(null==l?void 0:l.controllerId)&&ep(null==l?void 0:l.controllerId),(null==l?void 0:l.controllerId)&&eS(null==l?void 0:l.controllerId)},error:eh.touched.controllerId&&!!eh.errors.controllerId,maxAccess:ex},eh.values.siteId)}),(0,o.jsx)(u.ZP,{item:!0,xs:3,children:(0,o.jsx)(k.Z,{name:"search",value:eh.values.search,label:em.search,onClear:()=>{eh.setFieldValue("search","")},onChange:e=>{eh.setFieldValue("search",e.target.value)},onSearch:e=>eh.setFieldValue("search",e),search:!0,readOnly:(null==eh?void 0:null===(A=eh.values)||void 0===A?void 0:null===(O=A.rows)||void 0===O?void 0:O.length)===0})})]})}),(0,o.jsx)(n.Q,{children:(0,o.jsx)(S._,{onChange:(e,l,t)=>ek(e,l,t),value:eh.values.controllerId?eV:[],error:null===(H=eh.errors)||void 0===H?void 0:H.rows,initialValues:null==eh?void 0:null===(B=eh.initialValues)||void 0===B?void 0:null===(E=B.rows)||void 0===E?void 0:E[0],columns:eD,disabled:(null===(Y=eh.values)||void 0===Y?void 0:Y.SCStatus)==3||(null===(J=eh.values)||void 0===J?void 0:J.EndofSiteStatus)==3||(null===(W=eh.values)||void 0===W?void 0:W.status)==3,allowDelete:(null===(U=eh.values)||void 0===U?void 0:U.SCStatus)!=3&&(null===(M=eh.values)||void 0===M?void 0:M.SCWIP)!=2&&(null===(z=eh.values)||void 0===z?void 0:z.status)!=3,allowAddNewLine:!(null==eh?void 0:null===(G=eh.values)||void 0===G?void 0:G.search)&&eh.values.controllerId&&(null===(X=eh.values)||void 0===X?void 0:X.SCStatus)!=3&&(null===($=eh.values)||void 0===$?void 0:$.EndofSiteStatus)!=3&&!!(!(null==eh?void 0:null===(K=eh.values)||void 0===K?void 0:null===(Q=K.rows)||void 0===Q?void 0:Q.length)||(null===(es=eh.values)||void 0===es?void 0:null===(eo=es.rows)||void 0===eo?void 0:null===(ee=eo[(null===(et=eh.values)||void 0===et?void 0:null===(el=et.rows)||void 0===el?void 0:el.length)-1])||void 0===ee?void 0:ee.sku)),maxAccess:ex,autoDelete:ew?eg:null,name:"rows"})},null==eh?void 0:null===(en=eh.values)||void 0===en?void 0:en.controllerId),(0,o.jsx)(r.g,{children:(0,o.jsxs)(u.ZP,{container:!0,justifyContent:"flex-end",spacing:2,sx:{pt:5},children:[(0,o.jsx)(u.ZP,{item:!0,xs:2,children:(0,o.jsx)(k.Z,{name:"totalCount",label:em.totalCount,value:eP,readOnly:!0,hidden:!eh.values.controllerId,numberField:!0})}),(0,o.jsx)(u.ZP,{item:!0,xs:2,children:(0,o.jsx)(k.Z,{name:"totalWeight",label:em.totalWeight,value:(0,y.bj)(eF.toFixed(2)),readOnly:!0,hidden:!eh.values.controllerId,numberField:!0})})]})})]})})}},76426:function(e,l,t){"use strict";t.d(l,{x:function(){return s}});let o="SC.asmx/",s={LabelTemplate:{qry:o+"qryLBT",set:o+"setLBT",get:o+"getLBT",del:o+"delLBT"},Item:{qry:o+"qryLBI",set:o+"setLBI",get:o+"getLBI",del:o+"delLBI"},Sites:{qry:o+"qrySIT",set:o+"setSIT",set2:o+"set2SIT",get:o+"getSIT",del:o+"delSIT",reopen:o+"reopenSIT",end:o+"endSIT"},Controller:{qry:o+"qryCRL"},StockCountControllerTab:{qry:o+"qryPHY",set2:o+"set2PHY",set:o+"setPHY",get:o+"getPHY",del:o+"delPHY"},StockCount:{page:o+"pageHDR",post:o+"postHDR",unpost:o+"unpostHDR",qry:o+"qryHDR",get:o+"getHDR",set:o+"setHDR",del:o+"delHDR",close:o+"closeHDR",reopen:o+"reopenHDR",snapshot:o+"snapshotHDR"},StockCountController:{page:o+"pageCRL",set:o+"setCRL",get:o+"getCRL",del:o+"delCRL"},DocumentTypeDefaults:{qry:o+"qryDTD",set:o+"setDTD",get:o+"getDTD",del:o+"delDTD"},StockCountItem:{qry:o+"qryITM",set:o+"setITM",get:o+"getITM",del:o+"delITM"},StockCountSerialSum:{qry:o+"qrySRS"},StockCountItemDetail:{qry:o+"qryITD",set:o+"setITD",get:o+"getITD",del:o+"delITD",set2:o+"set2ITD"},StockCountSerialDetail:{set2:o+"set2SRL",qry:o+"qrySRL",append:o+"appendSRL",del:o+"delSRL",batch:o+"batchSRL"}}},32025:function(e,l,t){"use strict";var o=t(52322),s=t(2784),n=t(23361),i=t(19473),d=t(21326);let a=e=>{let{window:l,onConfirm:t,fullScreen:a,open:r,dialogText:u}=e,{platformLabels:c}=(0,s.useContext)(i.l);return(0,d.Z)({title:c.Clear,window:l}),(0,o.jsx)(n.Z,{open:null!=r&&!!r.flag&&(null==r?void 0:r.flag),DialogText:u,okButtonAction:()=>{"function"==typeof t&&t(),l.close()},fullScreen:a,cancelButtonAction:()=>l.close(),height:"140px"})};a.width=570,a.height=170,l.Z=a},81330:function(e,l,t){"use strict";t.d(l,{Z:function(){return g}});var o=t(52322),s=t(2784),n=t(60218),i=t(31389),d=t(5088),a=t(21581),r=t(78711),u=t(19473),c=t(23361),v=t(21326);let I=e=>{let{window:l,onConfirm:t,fullScreen:n,open:i,dialogText:d}=e,{platformLabels:a}=(0,s.useContext)(u.l);return(0,v.Z)({title:a.import,window:l}),(0,o.jsx)(c.Z,{open:(null==i?void 0:i.flag)||!1,DialogText:d,okButtonAction:()=>{"function"==typeof t&&t(),l.close()},fullScreen:n,cancelButtonAction:()=>l.close(),height:"140px"})};I.width=470,I.height=170;var C=t(61802),m=t(65950),x=t(62202),h=t(62362),S=t(69627),p=t(54074);let f=e=>{var l,t;let{endPoint:c,header:f,onCloseimport:g,maxAccess:k,window:y}=e,{stack:w}=(0,C.zY)(),{platformLabels:D}=(0,s.useContext)(u.l),N=(0,s.useRef)(null),[b,Z]=(0,s.useState)(null),[j,T]=(0,s.useState)([]),{postRequest:R}=(0,s.useContext)(m.$);(0,v.Z)({title:D.importSerials,window:y});let q=(0,r.TA)({initialValues:{serials:"",serialCount:0}}),P=e=>{let l=e.split("\n").filter(e=>""!==e.trim()).length;q.setFieldValue("serialCount",l)},F=async()=>{w({Component:I,props:{open:{flag:!0},fullScreen:!1,onConfirm:_,dialogText:D.importConfirmation}})},_=async()=>{var e;let l=null===(e=q.values.serials)||void 0===e?void 0:e.replace(/\n/g,",\r\n"),t={...f,serials:l||j};await R({extension:c,record:JSON.stringify(t)}),x.ZP.success(D.Imported),g(),y.close()},V=[{key:"Import",condition:!0,onClick:F,disabled:!(null==b?void 0:b.name)&&!(null==q?void 0:null===(l=q.values)||void 0===l?void 0:l.serials)}];return(0,o.jsx)(p.Z,{actions:V,onSave:()=>F(),disabledSubmit:!(null==b?void 0:b.name)&&!(null==q?void 0:null===(t=q.values)||void 0===t?void 0:t.serials),isSaved:!1,children:(0,o.jsxs)(i.R,{children:[(0,o.jsx)(h.Q,{children:(0,o.jsxs)(n.ZP,{container:!0,spacing:2,children:[(0,o.jsx)(n.ZP,{item:!0,xs:7,children:(0,o.jsx)(d.Z,{name:"name",label:D.SelectCSV,value:null==b?void 0:b.name,disabled:q.values.serials||!!(null==b?void 0:b.name),readOnly:!0,maxAccess:k})}),(0,o.jsx)(n.ZP,{item:!0,xs:3,children:(0,o.jsx)(S.Z,{onClick:()=>{N.current.click()},label:"".concat(D.Browse,"..."),color:"primary",disabled:!!(null==b?void 0:b.name)||q.values.serials})}),(0,o.jsx)(n.ZP,{item:!0,xs:2,children:(0,o.jsx)(S.Z,{image:"clear.png",onClick:()=>{Z(null),T([]),N.current.value=null},label:D.Clear,color:"#f44336"})}),(0,o.jsxs)(n.ZP,{item:!0,xs:12,children:[q.values.serialCount>0&&(0,o.jsxs)("label",{style:{marginBottom:"8px",display:"block"},maxAccess:k,children:[D.serials," ( ",q.values.serialCount," )"]}),(0,o.jsx)(a.Z,{name:"serials",label:D.serials,value:q.values.serials,rows:3,readOnly:null==b?void 0:b.name,onChange:e=>{q.setFieldValue("serials",e.target.value),P(e.target.value)},onClear:()=>{q.setFieldValue("serials",""),q.setFieldValue("serialCount",0)},error:q.touched.serials&&!!q.errors.serials,maxAccess:k})]})]})}),(0,o.jsx)("input",{type:"file",accept:".csv",ref:N,style:{display:"none"},onChange:e=>{let l=e.target.files[0];if(Z(l),l){let e=new FileReader;e.onload=e=>{T(e.target.result)},e.readAsText(l)}}})]})})};f.width=550,f.height=270;var g=f}},function(e){e.O(0,[49774,92888,40179],function(){return e(e.s=56671)}),_N_E=e.O()}]);