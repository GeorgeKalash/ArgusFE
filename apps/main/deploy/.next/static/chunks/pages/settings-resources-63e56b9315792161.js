(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[99876],{97836:function(e,s,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/settings-resources",function(){return t(40565)}])},40565:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return E}});var l=t(52322),r=t(60218),a=t(23925),i=t(44258),o=t(9737),n=t(2784),d=t(71987),c=t(65950),u=t(69387),m=t(26612),x=t(61802),p=t(8661),v=t(84100),h=t(27723),f=t(31389),I=t(33625),y=t(76385),N=t(62202),j=t(62362),g=t(19473),b=t(80983),Z=t(5088),C=t(38449),S=t(93432),w=t(54074),_=e=>{let{labels:s,maxAccess:t,row:i,window:o}=e,{getRequest:d,postRequest:m}=(0,n.useContext)(c.$),{platformLabels:x}=(0,n.useContext)(g.l),[p,v]=(0,n.useState)([]),h=async()=>{let e=await d({extension:C.r.ReportLayout.get,parameters:"_resourceId=".concat(i.resourceId)}),s=(null==e?void 0:e.record)||{},t=new Map(((null==s?void 0:s.reportLayoutOverrides)||[]).map(e=>[e.id,e.isInactive])),l=((null==s?void 0:s.layouts)||[]).map(e=>({...e,isInactive:!!t.has(e.id)&&t.get(e.id)}));v({count:l.length||0,list:l||[],statusId:1,message:""})},{formik:_}=(0,b.c)({validateOnChange:!0,initialValues:{resourceId:i.resourceId,resourceName:i.resourceName},onSubmit:async e=>{let s=p.list.filter(e=>e.isInactive).map(e=>({resourceId:i.resourceId,id:e.id,isInactive:e.isInactive})),t={resourceId:i.resourceId,items:s};await m({extension:C.r.ReportLayoutObject.set2,record:JSON.stringify(t)}),N.ZP.success(x.Updated),o.close()}}),A=async e=>(await d({extension:S.C.getAttachement,parameters:"_resourceId=".concat(_.values.resourceId,"&_layoutId=").concat(e.id)})).record.url;(0,n.useEffect)(()=>{h()},[]);let k=[{field:"api",headerName:s.api,flex:1},{field:"instanceName",headerName:s.instanceName,flex:2},{field:"parameters",headerName:s.params,flex:1},{field:"layoutName",headerName:s.layoutName,flex:1},{flex:.5,field:"post",cellRenderer:e=>(0,l.jsx)(a.Z,{sx:{display:"flex",width:"100%",justifyContent:"center"},children:(0,l.jsx)(y.Z,{variant:"body2",component:"a",onClick:async()=>{let s=await A(e.data);window.open(s,"_blank")},target:"_blank",rel:"noopener noreferrer",sx:{color:"blue",textDecoration:"underline",cursor:"pointer",fontSize:"14px"},children:"preview"})})},{field:"isInactive",headerName:s.isInactive,type:"checkbox",editable:!0}];return(0,l.jsx)(w.Z,{onSave:_.handleSubmit,maxAccess:t,children:(0,l.jsxs)(f.R,{children:[(0,l.jsx)(I.g,{children:(0,l.jsxs)(r.ZP,{container:!0,spacing:2,children:[(0,l.jsx)(r.ZP,{item:!0,xs:4,children:(0,l.jsx)(Z.Z,{name:"resourceId",label:s.resourceId,value:_.values.resourceId,readOnly:!0,maxAccess:t})}),(0,l.jsx)(r.ZP,{xs:5}),(0,l.jsx)(r.ZP,{item:!0,xs:4,children:(0,l.jsx)(Z.Z,{name:"resourceName",label:s.resourceName,value:_.values.resourceName,readOnly:!0,maxAccess:t})})]})}),(0,l.jsx)(j.Q,{children:(0,l.jsx)(u.Z,{columns:k,gridData:p,rowId:["id"],pagination:!1})})]})})},A=t(48601);t(82737);var k=t(76399),R=e=>{let{labels:s,maxAccess:t,row:a,window:i}=e,{getRequest:o,postRequest:d}=(0,n.useContext)(c.$),{platformLabels:u}=(0,n.useContext)(g.l),m=e=>!e.reportName&&!e.caption&&!e.assembly&&!e.wsName,{formik:x}=(0,b.c)({validateOnChange:!0,validationSchema:A.Ry({items:A.IX().of(A.Ry().shape({reportName:A.Z_().test(function(e){var s,t,l;let r=this.parent,a=r.reportName||r.caption||r.assembly||r.wsName;return(null===(l=this.options.from[1])||void 0===l?void 0:null===(t=l.value)||void 0===t?void 0:null===(s=t.items)||void 0===s?void 0:s.length)===1&&!a||!!e}),wsName:A.Z_().test(function(e){var s,t,l;let r=this.parent,a=r.reportName||r.caption||r.assembly||r.wsName;return(null===(l=this.options.from[1])||void 0===l?void 0:null===(t=l.value)||void 0===t?void 0:null===(s=t.items)||void 0===s?void 0:s.length)===1&&!a||!!e}),caption:A.Z_().test(function(e){var s,t,l;let r=this.parent,a=r.reportName||r.caption||r.assembly||r.wsName;return(null===(l=this.options.from[1])||void 0===l?void 0:null===(t=l.value)||void 0===t?void 0:null===(s=t.items)||void 0===s?void 0:s.length)===1&&!a||!!e}),assembly:A.Z_().test(function(e){var s,t,l;let r=this.parent,a=r.reportName||r.caption||r.assembly||r.wsName;return(null===(l=this.options.from[1])||void 0===l?void 0:null===(t=l.value)||void 0===t?void 0:null===(s=t.items)||void 0===s?void 0:s.length)===1&&!a||!!e})})).required()}),initialValues:{resourceId:a.resourceId,resourceName:a.resourceName,items:[{id:1,seqNo:"",resourceId:"",wsName:"",reportName:"",assembly:"",parameters:"",caption:"",isInactive:!1}]},onSubmit:e=>{let{items:s}=e;1===s.length&&m(s[0])?p({resourceId:a.resourceId,items:[]}):p(e)}}),p=async e=>{var s;let t=(null==e?void 0:null===(s=e.items)||void 0===s?void 0:s.map((e,s)=>({...e,resourceId:a.resourceId,seqNo:s+1})))||[],l={resourceId:a.resourceId,data:t||[]};await d({extension:C.r.ReportTemplate.set2,record:JSON.stringify(l)}),N.ZP.success(u.Updated),i.close()},v=[{component:"textfield",label:s.api,name:"wsName"},{component:"textfield",label:s.reportName,name:"reportName"},{component:"textfield",label:s.assembly,name:"assembly"},{component:"textfield",label:s.params,name:"parameters"},{component:"textfield",label:s.caption,name:"caption"},{component:"checkbox",label:s.isInactive,name:"isInactive"}];return(0,n.useEffect)(()=>{o({extension:C.r.ReportTemplate.qry,parameters:"_resourceId=".concat(a.resourceId)}).then(e=>{var s;let t=null===(s=e.list)||void 0===s?void 0:s.map((e,s)=>({...e,id:s+1}));x.setValues({...x.values,items:t})})},[]),(0,l.jsx)(w.Z,{onSave:x.handleSubmit,maxAccess:t,children:(0,l.jsxs)(f.R,{children:[(0,l.jsx)(I.g,{children:(0,l.jsxs)(r.ZP,{container:!0,spacing:2,children:[(0,l.jsx)(r.ZP,{item:!0,xs:4,children:(0,l.jsx)(Z.Z,{name:"resourceId",label:s.resourceId,value:x.values.resourceId,readOnly:!0,maxAccess:t})}),(0,l.jsx)(r.ZP,{xs:5}),(0,l.jsx)(r.ZP,{item:!0,xs:4,children:(0,l.jsx)(Z.Z,{name:"resourceName",label:s.resourceName,value:x.values.resourceName,readOnly:!0,maxAccess:t})})]})}),(0,l.jsx)(j.Q,{children:(0,l.jsx)(k._,{onChange:e=>x.setFieldValue("items",e),value:x.values.items,error:x.errors.items,allowDelete:!0,name:"items",columns:v,maxAccess:t})})]})})},P=e=>{let{labels:s,maxAccess:t,row:a,window:i}=e,{getRequest:o,postRequest:d}=(0,n.useContext)(c.$),{platformLabels:u}=(0,n.useContext)(g.l),m=e=>!e.seqNo&&!e.description&&!e.name,{formik:x}=(0,b.c)({validateOnChange:!0,validationSchema:A.Ry({items:A.IX().of(A.Ry().shape({seqNo:A.Z_().test(function(e){var s,t,l;let r=this.parent,a=r.seqNo||r.description||r.name;return(null===(l=this.options.from[1])||void 0===l?void 0:null===(t=l.value)||void 0===t?void 0:null===(s=t.items)||void 0===s?void 0:s.length)===1&&!a||!!e}),name:A.Z_().test(function(e){var s,t,l;let r=this.parent,a=r.seqNo||r.description||r.name;return(null===(l=this.options.from[1])||void 0===l?void 0:null===(t=l.value)||void 0===t?void 0:null===(s=t.items)||void 0===s?void 0:s.length)===1&&!a||!!e}),description:A.Z_().test(function(e){var s,t,l;let r=this.parent,a=r.seqNo||r.description||r.name;return(null===(l=this.options.from[1])||void 0===l?void 0:null===(t=l.value)||void 0===t?void 0:null===(s=t.items)||void 0===s?void 0:s.length)===1&&!a||!!e})})).required()}),initialValues:{resourceId:a.resourceId,resourceName:a.resourceName,items:[{id:1,resourceId:"",seqNo:"",name:"",description:""}]},onSubmit:e=>{let{items:s}=e;1===s.length&&m(s[0])?p({resourceId:a.resourceId,items:[]}):p(e)}}),p=async e=>{var s;let t=(null==e?void 0:null===(s=e.items)||void 0===s?void 0:s.map((e,s)=>({...e,resourceId:a.resourceId,moduleId:0})))||[],l={resourceId:a.resourceId,data:t||[]};await d({extension:C.r.Rules.set2,record:JSON.stringify(l)}),N.ZP.success(u.Updated),i.close()},v=[{component:"numberfield",label:s.ruleId,name:"seqNo"},{component:"textfield",label:s.name,name:"name"},{component:"textfield",label:s.description,name:"description"}];return(0,n.useEffect)(()=>{o({extension:C.r.Rules.qry,parameters:"_resourceId=".concat(a.resourceId)}).then(e=>{var s;let t=null===(s=e.list)||void 0===s?void 0:s.map((e,s)=>({...e,id:s+1}));x.setValues({...x.values,items:t})})},[]),(0,l.jsx)(w.Z,{onSave:x.handleSubmit,maxAccess:t,children:(0,l.jsxs)(f.R,{children:[(0,l.jsx)(I.g,{children:(0,l.jsxs)(r.ZP,{container:!0,spacing:2,children:[(0,l.jsx)(r.ZP,{item:!0,xs:4,children:(0,l.jsx)(Z.Z,{name:"resourceId",label:s.resourceId,value:x.values.resourceId,readOnly:!0,maxAccess:t})}),(0,l.jsx)(r.ZP,{xs:5}),(0,l.jsx)(r.ZP,{item:!0,xs:4,children:(0,l.jsx)(Z.Z,{name:"resourceName",label:s.resourceName,value:x.values.resourceName,readOnly:!0,maxAccess:t})})]})}),(0,l.jsx)(j.Q,{children:(0,l.jsx)(k._,{onChange:e=>x.setFieldValue("items",e),value:x.values.items,error:x.errors.items,allowDelete:!0,name:"items",columns:v,maxAccess:t})})]})})},q=t(95982);let O={ALL:"2",NO_ACCESS:"1",HAS_ACCESS:"3"};var L=e=>{let{labels:s,maxAccess:t,row:a,window:i}=e,{getRequest:o,postRequest:x}=(0,n.useContext)(c.$),{platformLabels:h}=(0,n.useContext)(g.l),[y,b]=(0,n.useState)(),[C,S]=(0,n.useState)(""),{query:{data:_}}=(0,d.J)({queryFn:A,datasetId:m.i.SettingsResources});async function A(){let[e,s]=await Promise.all([o({extension:q.y.SecurityGroup.qry,parameters:"_startAt=0&_pageSize=1000"}),o({extension:q.y.ModuleClass.qry0,parameters:"_resourceId=".concat(a.resourceId)})]);return{list:null==e?void 0:e.list.map(e=>{let t=null==s?void 0:s.list.find(s=>s.sgId===e.recordId);return t?{...e,sgId:e.recordId,...t,...t.accessFlags}:{...e,sgId:e.recordId,get:!1,add:!1,edit:!1,del:!1,close:!1,post:!1,unpost:!1,reopen:!1}})}}async function k(){let e={resourceId:a.resourceId,data:((null==_?void 0:_.list)||[]).map(e=>{var s;return{sgId:null!==(s=null==e?void 0:e.sgId)&&void 0!==s?s:null,resourceId:null==a?void 0:a.resourceId,moduleId:null==a?void 0:a.moduleId,accessFlags:{get:(null==e?void 0:e.get)||!1,add:(null==e?void 0:e.add)||!1,edit:(null==e?void 0:e.edit)||!1,del:(null==e?void 0:e.del)||!1,close:(null==e?void 0:e.close)||!1,post:(null==e?void 0:e.post)||!1,unpost:(null==e?void 0:e.unpost)||!1,reopen:(null==e?void 0:e.reopen)||!1}}})};await x({extension:q.y.ModuleClass.set2,record:JSON.stringify(e)}),N.ZP.success(h.Updated),i.close()}let R=[{headerName:s.name,field:"name",flex:2},{headerName:s.description,field:"description",flex:3},{field:"get",type:"checkbox",headerName:s.get,flex:1,editable:!0},{field:"add",type:"checkbox",headerName:s.add,flex:1,editable:!0},{field:"edit",type:"checkbox",headerName:s.edit,flex:1,editable:!0},{field:"del",type:"checkbox",headerName:s.del,flex:1,editable:!0},{field:"close",type:"checkbox",headerName:s.close,flex:1,editable:!0},{field:"reopen",type:"checkbox",headerName:s.reopen,flex:1,editable:!0},{field:"post",type:"checkbox",headerName:s.post,flex:1,editable:!0},{field:"unpost",type:"checkbox",headerName:s.unpost,flex:1,editable:!0}],P=e=>Object.values(e).some(e=>!0===e),L=(0,n.useMemo)(()=>{if(!(null==_?void 0:_.list))return _;let e=_.list;if(e=e.filter(e=>y===O.NO_ACCESS?!P(e):y!==O.HAS_ACCESS||P(e)),C){let s=C.toLowerCase();e=e.filter(e=>{var t,l;return(null===(t=e.name)||void 0===t?void 0:t.toLowerCase().includes(s))||(null===(l=e.description)||void 0===l?void 0:l.toLowerCase().includes(s))})}return{..._,list:e}},[_,y,C]);return(0,l.jsx)(w.Z,{onSave:k,maxAccess:t,children:(0,l.jsxs)(f.R,{children:[(0,l.jsx)(I.g,{children:(0,l.jsxs)(r.ZP,{container:!0,spacing:2,xs:4,children:[(0,l.jsx)(r.ZP,{item:!0,xs:12,children:(0,l.jsx)(Z.Z,{name:"resourceId",label:s.resourceId,value:a.resourceId,readOnly:!0,maxAccess:t})}),(0,l.jsx)(r.ZP,{item:!0,xs:12,children:(0,l.jsx)(Z.Z,{name:"resourceName",label:s.resourceName,value:a.resourceName,readOnly:!0,maxAccess:t})}),(0,l.jsx)(r.ZP,{item:!0,xs:12,children:(0,l.jsx)(p.Z,{datasetId:v.v.ASSIGNMENT_LEVEL,name:"filter",label:s.filter,value:y,valueField:"key",displayField:"value",defaultIndex:1,maxAccess:t,onChange:(e,s)=>{var t;b(null!==(t=null==s?void 0:s.key)&&void 0!==t?t:O.ALL)},onClear:()=>b(O.ALL)})}),(0,l.jsx)(r.ZP,{item:!0,xs:12,children:(0,l.jsx)(Z.Z,{name:"search",value:C,label:h.Search,onClear:()=>S(""),onKeyDown:e=>{"Enter"===e.key&&e.stopPropagation()},onChange:e=>S(e.target.value)})})]})}),(0,l.jsx)(j.Q,{children:(0,l.jsx)(u.Z,{name:"items",columns:R,gridData:L,rowId:["sgId"],maxAccess:t,pagination:!1})})]})})},E=()=>{let{getRequest:e}=(0,n.useContext)(c.$),{stack:s}=(0,x.zY)();async function t(s){var t;let{filters:l}=s;if(l.moduleId)return await e({extension:C.r.ModuleClassRES.qry,parameters:"_filter=".concat(null!==(t=l.qry)&&void 0!==t?t:"","&_moduleId=").concat(l.moduleId)})}let{query:{data:y},refetch:N,labels:j,filterBy:g,clearFilter:b,access:Z,filters:S,invalidate:w}=(0,d.J)({queryFn:t,endpointId:C.r.ModuleClassRES.qry,datasetId:m.i.SettingsResources,filter:{filterFn:t,default:{moduleId:10}}}),A=e=>{e?g("moduleId",e):b("moduleId")};return(0,n.useEffect)(()=>{S.moduleId=10},[]),(0,l.jsxs)(f.R,{children:[(0,l.jsx)(I.g,{children:(0,l.jsx)(h.Z,{maxAccess:Z,onSearch:e=>{S.moduleId&&g("qry",e)},onSearchClear:()=>{b("qry")},labels:j,inputSearch:!0,leftSection:(0,l.jsx)(r.ZP,{item:!0,xs:2.5,children:(0,l.jsx)(p.Z,{datasetId:v.v.MODULE,label:j.module,name:"moduleId",values:{moduleId:S.moduleId},valueField:"key",displayField:"value",onChange:(e,s)=>{A(null==s?void 0:s.key)},error:!S.moduleId})})})}),(0,l.jsx)(u.Z,{columns:[{field:"key",headerName:j.resourceId,flex:1},{field:"value",headerName:j.resourceName,flex:4},{field:"Report Layout",headerName:j.reportLayout,flex:1,cellRenderer:e=>(0,l.jsx)(a.Z,{sx:{display:"flex",width:"100%",justifyContent:"center"},children:(0,l.jsx)(i.Z,{size:"small",onClick:()=>{s({Component:_,props:{labels:j,maxAccess:Z,row:{resourceId:e.data.key,resourceName:e.data.value,moduleId:S.moduleId},invalidate:w,resourceId:m.i.SettingsResources},width:1200,height:600,title:j.reportLayout})},children:(0,l.jsx)(o.Z,{icon:"mdi:application-edit-outline",fontSize:18})})})},{field:"Custom Layout",headerName:j.customLayout,flex:1,cellRenderer:e=>(0,l.jsx)(a.Z,{sx:{display:"flex",width:"100%",justifyContent:"center"},children:(0,l.jsx)(i.Z,{size:"small",onClick:()=>{s({Component:R,props:{labels:j,maxAccess:Z,row:{resourceId:e.data.key,resourceName:e.data.value},invalidate:w,resourceId:m.i.SettingsResources},width:800,height:480,title:j.printTemplates})},children:(0,l.jsx)(o.Z,{icon:"mdi:application-edit-outline",fontSize:18})})})},{field:"Custom Rules",headerName:j.customRules,flex:1,cellRenderer:e=>(0,l.jsx)(a.Z,{sx:{display:"flex",width:"100%",justifyContent:"center"},children:(0,l.jsx)(i.Z,{size:"small",onClick:()=>{s({Component:P,props:{labels:j,maxAccess:Z,row:{resourceId:e.data.key,resourceName:e.data.value},invalidate:w,resourceId:m.i.SettingsResources},width:800,height:480,title:j.customRules})},children:(0,l.jsx)(o.Z,{icon:"mdi:application-edit-outline",fontSize:18})})})},{field:"Security Groups",headerName:j.securityGroup,flex:1,cellRenderer:e=>(0,l.jsx)(a.Z,{sx:{display:"flex",width:"100%",justifyContent:"center"},children:(0,l.jsx)(i.Z,{size:"small",onClick:()=>{s({Component:L,props:{labels:j,maxAccess:Z,row:{resourceId:e.data.key,resourceName:e.data.value,moduleId:S.moduleId},invalidate:w,resourceId:m.i.SettingsResources},width:1200,height:600,title:j.securityGroup})},children:(0,l.jsx)(o.Z,{icon:"mdi:application-edit-outline",fontSize:18})})})}],gridData:null!=y?y:{list:[]},rowId:["key"],isLoading:!1,pageSize:50,maxAccess:Z,refetch:N,paginationType:"client"})]})}}},function(e){e.O(0,[49774,92888,40179],function(){return e(e.s=97836)}),_N_E=e.O()}]);