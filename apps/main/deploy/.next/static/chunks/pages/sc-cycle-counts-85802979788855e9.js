(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[21639],{77287:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/sc-cycle-counts",function(){return a(71443)}])},71443:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return b}});var n=a(52322),s=a(2784),l=a(62202),r=a(69387),o=a(65950),d=a(71987),i=a(33625),c=a(62362),u=a(31389),m=a(26612),v=a(19473),p=a(61802),f=a(76426),x=a(98345),h=a(7121),y=a(36908),I=a(23476),b=()=>{let{getRequest:e,postRequest:t}=(0,s.useContext)(o.$),{platformLabels:a,userDefaultsData:b}=(0,s.useContext)(v.l),{stack:C}=(0,p.zY)();async function g(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{_startAt:a=0,_pageSize:n=50,params:s}=t;return{...await e({extension:f.x.StockCount.qry,parameters:"_startAt=".concat(a,"&_pageSize=").concat(n,"&filter=&_params=").concat(s||"")}),_startAt:a}}async function w(t){let{filters:a,pagination:n}=t;return(null==a?void 0:a.qry)?await e({extension:f.x.StockCount.snapshot,parameters:"_filter=".concat(a.qry)}):g({_startAt:n._startAt||0,params:null==a?void 0:a.params})}let{query:{data:_},labels:k,access:S,invalidate:N,refetch:j,filterBy:Z,paginationParameters:F}=(0,d.J)({queryFn:g,endpointId:f.x.StockCount.qry,datasetId:m.i.StockCounts,filter:{filterFn:w}}),V=[{field:"reference",headerName:k.reference,flex:1},{field:"statusName",headerName:k.status,flex:1},{field:"wipName",headerName:k.workInProgress,flex:1},{field:"date",headerName:k.date,flex:1,type:"date"},{field:"plantName",headerName:k.plant,flex:1},{field:"notes",headerName:k.notes,flex:1},{field:"clientName",headerName:k.client,flex:1}],A=async e=>{await t({extension:f.x.StockCount.del,record:JSON.stringify(e)}),N(),l.ZP.success(a.Deleted)},{proxyAction:T}=(0,x.G)({functionId:h.J.StockCount,action:R}),P=async()=>{await T()};async function O(e,t){C({Component:I.Z,props:{recordId:t,plantId:e}})}async function R(e){var t,a;O(parseInt(null==b?void 0:null===(a=b.list)||void 0===a?void 0:null===(t=a.find(e=>"plantId"===e.key))||void 0===t?void 0:t.value),e)}return(0,n.jsxs)(u.R,{children:[(0,n.jsx)(i.g,{children:(0,n.jsx)(y.Z,{labels:k,onAdd:P,maxAccess:S,reportName:"SCHDR",filterBy:Z})}),(0,n.jsx)(c.Q,{children:(0,n.jsx)(r.Z,{name:"table",columns:V,gridData:_,rowId:["recordId"],onEdit:e=>{R(null==e?void 0:e.recordId)},onDelete:A,deleteConfirmationType:"strict",isLoading:!1,pageSize:50,paginationType:"api",paginationParameters:F,refetch:j,maxAccess:S})})]})}},1685:function(e,t,a){"use strict";a.d(t,{m:function(){return n}});let n=e=>{let t=window.sessionStorage.getItem(e);return t?JSON.parse(t):null}},98345:function(e,t,a){"use strict";a.d(t,{H:function(){return f},G:function(){return p}});var n=a(45300),s=a(2784),l=a(96026),r=a(38449);a(26612);var o=a(65947),d=a(1685);let i=async(e,t,a)=>{try{let n=await e({extension:t,parameters:a});return t.includes("qry")?n:n.record}catch(e){return null}},c=(e,t,a,n)=>{let s=(e=JSON.parse(JSON.stringify(e))).record.controls,l=s.find(e=>"reference"===e.controlId);return l?l.accessLevel=(null==t?void 0:t.mandatory)?o.$7:o.rr:(null==t?void 0:t.mandatory)?s.push({sgId:0,resourceId:"",controlId:"".concat(n?n+".":"","reference"),accessLevel:(null==t?void 0:t.mandatory)?o.$7:o.rr}):(null==t?void 0:t.readOnly)?s.push({sgId:0,resourceId:"",controlId:"".concat(n?n+".":"","reference"),accessLevel:(null==t?void 0:t.readOnly)?o.rr:o.$7}):s=e.record.controls.filter(e=>"reference"!=e.controlId),a&&s.push({sgId:0,resourceId:"",controlId:"".concat(n?n+".":"","dtId"),accessLevel:o.$7}),{...e,record:{...e.record,controls:s}}},u=async(e,t,a)=>{let n,s;switch(a){case"dtId":let l=(0,d.m)("userData"),o=null==l?void 0:l.userId;s="_userId=".concat(o,"&_functionId=").concat(t),n=r.r.UserFunction.get;break;case"glbSysNumberRange":s="_recordId=".concat(t),n=r.r.SystemFunction.get;break;case"DocumentType":s="_dgId=".concat(t,"&_startAt=",0,"&_pageSize=",50),n=r.r.DocumentType.qry;break;case"DcTypNumberRange":s="_recordId=".concat(t),n=r.r.DocumentType.get;break;case"isExternal":s="_recordId=".concat(t),n=r.r.NumberRange.get;break;default:return null}return await i(e,n,s)},m=async function(e){let t,a,n,s,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,d=!(arguments.length>4)||void 0===arguments[4]||arguments[4],i=arguments.length>5?arguments[5]:void 0,m=void 0===o&&l&&await u(e,l,"dtId"),v=null==m?void 0:m.dtId,p="",f=!0;if(m&&void 0===o||"nraId"===o){if(v){let a=await u(e,v,"DcTypNumberRange");t=null==a?void 0:a.nraId,f=!((null==a?void 0:a.activeStatus)<0),t||(p="Assign the document type to a number range")}if((!v||!f)&&d&&l){var x;let t=await u(e,l,"DocumentType");s=(null==t?void 0:null===(x=t.list)||void 0===x?void 0:x.filter(e=>(null==e?void 0:e.activeStatus)===1).length)>0}}if(("nraId"===o||void 0===o)&&l){if((!v||v)&&!t||t&&!f){let a=await u(e,l,"glbSysNumberRange");(t=null==a?void 0:a.nraId)&&s&&(s=!1),f=!0}p=t||s?"":"Assign the system Function to a number range"}o>0&&!t&&(t=o),t&&f?(a={readOnly:null==(n=await u(e,t,"isExternal"))||!n.external,mandatory:null!=n&&!!n.external},r&&(r=await c(r,a,s,i))):!t&&r&&(r=await c(r,a,s,i));let h=i?"".concat(i,".reference"):"reference";return{dtId:v,resetReference:null==a?void 0:a.readOnly,dcTypeRequired:s,reference:{fieldName:h,isEmpty:(null==n?void 0:n.external)!==void 0&&(null==n||!n.external)},errorMessage:p,maxAccess:r,selectNraId:o}};var v=a(65950);function p(e){let{functionId:t,action:a,hasDT:n}=e,{getRequest:r}=(0,s.useContext)(v.$),{stack:o}=(0,l.V)();return{proxyAction:async()=>{let e=await m(r,t,"",void 0,n);(null==e?void 0:e.errorMessage)?o({message:null==e?void 0:e.errorMessage}):await a()}}}function f(e){var t;let{functionId:a,access:r,hasDT:o,enabled:d=!0,objectName:i=""}=e,{getRequest:c}=(0,s.useContext)(v.$),{stack:u}=(0,l.V)(),[p,f]=(0,s.useState)(),x=async e=>{let t=await m(c,a,r,e,o,i);if(!t.errorMessage)return t;u({message:null==t?void 0:t.errorMessage})},h=(0,n.a)({retry:!1,staleTime:0,enabled:d,queryKey:[a,p,!!r,d],queryFn:p||"nraId"===p?()=>x(p):()=>x()});return{documentType:h.data,maxAccess:(null==h?void 0:null===(t=h.data)||void 0===t?void 0:t.maxAccess)||r,changeDT(e){f((null==e?void 0:e.nraId)||"nraId")}}}},29326:function(e,t,a){"use strict";var n=a(52322);a(2784);var s=a(23925),l=a(13980),r=a.n(l),o=a(95291),d=a.n(o),i=a(65947);let c=e=>{var t,a,l;let{children:r,value:o,index:c,maxAccess:u,...m}=e,v="".concat(e.name||"tab",".").concat(c),{accessLevel:p}=null!==(l=(null!==(a=null==u?void 0:null===(t=u.record)||void 0===t?void 0:t.controls)&&void 0!==a?a:[]).find(e=>e.controlId===v))&&void 0!==l?l:{accessLevel:0};if(p===i.A1)return null;let f=o===c;return(0,n.jsx)(s.Z,{role:"tabpanel",hidden:!f,id:"simple-tabpanel-".concat(c),"aria-labelledby":"simple-tab-".concat(c),className:"".concat(d().tabPanel," ").concat(f?d().active:d().hidden),...m,children:r})};c.propTypes={children:r().node,index:r().number.isRequired,value:r().number.isRequired},t.Z=c},9522:function(e,t,a){"use strict";a.d(t,{Y:function(){return m}});var n=a(52322),s=a(23925),l=a(54582),r=a(68696),o=a(44258),d=a(2784),i=a(99266),c=a(52614),u=a.n(c);let m=e=>{var t,a,c,m,v;let{tabs:p,activeTab:f,setActiveTab:x,maxAccess:h,name:y="tab"}=e,I=(null==h?void 0:null===(a=h.record)||void 0===a?void 0:null===(t=a.controls)||void 0===t?void 0:t.filter(e=>{var t;return 4===e.accessLevel&&(null===(t=e.controlId)||void 0===t?void 0:t.startsWith("".concat(y,".")))}).map(e=>e.controlId.split(".")[1]))||[],b=null==p?void 0:null===(c=p.map((e,t)=>({...e,id:t})))||void 0===c?void 0:c.filter((e,t)=>!I.includes(String(t))),C=null===(m=b[f])||void 0===m?void 0:m.id,g=null===(v=b[f])||void 0===v?void 0:v.disabled;return(0,d.useEffect)(()=>{C>=0&&!g&&f!=C&&x(C)},[]),(0,n.jsx)(s.Z,{className:u().tabsContainer,children:(0,n.jsx)(s.Z,{className:u().tabsWrapper,children:(0,n.jsx)(l.Z,{value:f,onChange:(e,t)=>x(t),variant:"scrollable",scrollButtons:b.length>3?"auto":"off","aria-label":"scrollable tabs",classes:{indicator:u().tabsIndicator},className:u().tabs,children:null==b?void 0:b.map(e=>(0,n.jsx)(r.Z,{value:e.id,disabled:null==e?void 0:e.disabled,className:"".concat(u().tabName," ").concat(e.disabled?u().tabDisabled:""),classes:{root:u().tabRoot,selected:u().selectedTab},label:(0,n.jsxs)(s.Z,{display:"flex",alignItems:"center",children:[(0,n.jsx)("span",{children:e.label}),e.id===f&&(null==e?void 0:e.onRefetch)&&(0,n.jsx)(o.Z,{size:"small",className:u().refreshButton,onClick:t=>{t.stopPropagation(),e.onRefetch()},children:(0,n.jsx)(i.Z,{className:u().refreshIcon})})]})},e.id))})})})}},23476:function(e,t,a){"use strict";a.d(t,{Z:function(){return W}});var n=a(52322),s=a(29326),l=a(9522),r=a(2784),o=a(60218),d=a(48601),i=a(82737),c=a(62202),u=a(65950),m=a(26612),v=a(80983),p=a(62362),f=a(31389),x=a(19473),h=a(71987),y=a(76426),I=a(8661),b=a(38449),C=a(21581),g=a(84100),w=a(27423),_=a(22341),k=a(89330),S=a(98345),N=a(7121),j=a(5088),Z=a(39704),F=a(39812),V=a(61802),A=a(19689);function T(e){var t,a,s,l;let{labels:T,maxAccess:P,setStore:O,store:R,plantId:D}=e,{recordId:q}=R,{getRequest:E,postRequest:L}=(0,r.useContext)(u.$),{platformLabels:J}=(0,r.useContext)(x.l),{stack:W}=(0,V.zY)(),z=!!R.recordId,$=(0,h.E)({endpointId:y.x.StockCount.qry}),{documentType:M,maxAccess:U,changeDT:Y}=(0,S.H)({functionId:N.J.StockCount,access:P}),{formik:B}=(0,v.c)({documentType:{key:"dtId",value:null==M?void 0:M.dtId},initialValues:{recordId:q||null,reference:null,dtId:null,date:new Date,plantId:parseInt(D),notes:"",type:1,clientId:null,currencyId:null,genVar:1,wip:1,status:1,disableItemDuplicate:!1},maxAccess:U,validateOnChange:!0,validationSchema:d.Ry({genVar:d.Z_().required(),plantId:d.Rx().required(),clientId:d.Z_().nullable().test("",function(e){let{type:t}=this.parent;return 2!==t&&"2"!==t||!!e}),currencyId:d.Z_().nullable().test("",function(e){let{type:t}=this.parent;return 2!==t&&"2"!==t||!!e})}),onSubmit:async e=>{let t=await L({extension:y.x.StockCount.set,record:JSON.stringify(e)});if(e.recordId)c.ZP.success(J.Edited);else{O(e=>({...e,recordId:t.recordId})),c.ZP.success(J.Added),B.setFieldValue("recordId",t.recordId);let e=await H(t.recordId);B.setValues({...e.record,date:(0,F.a1)(e.record.date)})}$()}}),Q=async()=>{W({Component:Z.Z,props:{functionId:N.J.StockCount,recordId:B.values.recordId}})};async function H(e){return await E({extension:y.x.StockCount.get,parameters:"_recordId=".concat(e)})}async function X(e){let t=await H(e);return t.record.date=(0,F.a1)(t.record.date),t}let G=2===B.values.wip,K=3===B.values.status,ee=async e=>{let t=await L({extension:y.x.StockCount.close,record:JSON.stringify({recordId:e})});c.ZP.success(J.Closed),$();let a=await X(t.recordId);B.setValues(a.record),O(e=>({...e,isClosed:2===a.record.wip}))},et=[{key:"WorkFlow",condition:!0,onClick:Q,disabled:!z},{key:"Close",condition:!G,onClick:()=>ee(B.values.recordId),disabled:K||G||!z},{key:"Reopen",condition:G,onClick:async function(){let e=await L({extension:y.x.StockCount.reopen,record:JSON.stringify(B.values)});c.ZP.success(J.Reopened),$();let t=await X(e.recordId);B.setValues(t.record),O(e=>({...e,isClosed:2===t.record.wip}))},disabled:!G||K},{key:"Unlocked",condition:!K,onClick:async()=>{let e={...B.values};e.date=(0,F.ku)(e.date);let t=await L({extension:y.x.StockCount.post,record:JSON.stringify(e)});c.ZP.success(J.Posted),$();let a=await X(t.recordId);B.setValues(a.record),O(e=>({...e,isPosted:3===a.record.status}))},disabled:!z||!G},{key:"Locked",condition:K,onClick:"onUnpostConfirmation",onSuccess:async()=>{let e={...B.values};e.date=(0,F.ku)(e.date);let t=await L({extension:y.x.StockCount.unpost,record:JSON.stringify(e)});c.ZP.success(J.Unposted),$();let a=await X(t.recordId);B.setValues(a.record),O(e=>({...e,isPosted:3!==a.record.status}))},disabled:!z||!G}];return(0,r.useEffect)(()=>{!async function(){if(q){let e=await H(q);O(t=>({...t,isPosted:3===e.record.status,isClosed:2===e.record.wip})),B.setValues({...e.record,date:(0,F.a1)(e.record.date)})}}()},[]),(0,n.jsx)(i.Z,{resourceId:m.i.StockCounts,form:B,maxAccess:U,editMode:z,actions:et,disabledSubmit:K||G,disableSubmitAndClear:K||G,children:(0,n.jsx)(f.R,{children:(0,n.jsx)(p.Q,{children:(0,n.jsxs)(o.ZP,{container:!0,spacing:2,children:[(0,n.jsx)(o.ZP,{item:!0,xs:12,children:(0,n.jsx)(I.Z,{endpointId:b.r.DocumentType.qry,parameters:"_startAt=0&_pageSize=1000&_dgId=".concat(N.J.StockCount),name:"dtId",readOnly:z||K||G,label:T.documentType,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],valueField:"recordId",displayField:["reference","name"],values:B.values,maxAccess:U,onChange:(e,t)=>{Y(t),B&&B.setFieldValue("dtId",null==t?void 0:t.recordId)},error:B.touched.dtId&&!!B.errors.dtId})}),(0,n.jsx)(o.ZP,{item:!0,xs:12,children:(0,n.jsx)(j.Z,{name:"reference",label:T.reference,value:null==B?void 0:null===(t=B.values)||void 0===t?void 0:t.reference,maxAccess:!z&&U,maxLength:"30",readOnly:z||K||G,onChange:B.handleChange,error:B.touched.reference&&!!B.errors.reference})}),(0,n.jsx)(o.ZP,{item:!0,xs:12,children:(0,n.jsx)(k.Z,{name:"date",label:T.date,value:null===(a=B.values)||void 0===a?void 0:a.date,onChange:B.setFieldValue,onClear:()=>B.setFieldValue("date",""),readOnly:z||K||G,error:B.touched.date&&!!B.errors.date,maxAccess:U})}),(0,n.jsx)(o.ZP,{item:!0,xs:12,children:(0,n.jsx)(I.Z,{endpointId:b.r.Plant.qry,name:"plantId",label:T.plant,required:!0,valueField:"recordId",readOnly:z||K||G,displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:B.values,onChange:(e,t)=>{B.setFieldValue("plantId",t?null==t?void 0:t.recordId:null)},error:B.touched.plantId&&!!B.errors.plantId})}),(0,n.jsx)(o.ZP,{item:!0,xs:12,children:(0,n.jsx)(C.Z,{name:"notes",type:"text",label:T.notes,value:null===(s=B.values)||void 0===s?void 0:s.notes,rows:3,readOnly:K||G,maxAccess:U,onChange:e=>B.setFieldValue("notes",e.target.value),onClear:()=>B.setFieldValue("notes",""),error:B.touched.notes&&!!B.errors.notes})}),(0,n.jsx)(o.ZP,{item:!0,xs:12,children:(0,n.jsx)(I.Z,{datasetId:g.v.SC_TYPE,name:"type",label:T.type,values:B.values,valueField:"key",displayField:"value",readOnly:z||K||G,maxAccess:U,onChange:(e,t)=>{B&&B.setFieldValue("type",t?t.key:"")},error:B.touched.type&&!!B.errors.type})}),(0,n.jsx)(o.ZP,{item:!0,xs:12,children:(0,n.jsx)(w.U,{endpointId:_.P.Client.snapshot,parameters:{_category:0},valueField:"reference",displayField:"name",name:"clientId",label:T.client,form:B,readOnly:z||K||G||"1"===B.values.type||1===B.values.type,required:"2"===B.values.type||2===B.values.type,displayFieldWidth:2,valueShow:"clientRef",secondValueShow:"clientName",maxAccess:U,columnsInDropDown:[{key:"reference",value:"Ref."},{key:"name",value:"Name"}],onChange:async(e,t)=>{B.setFieldValue("clientId",t?t.recordId:""),B.setFieldValue("clientName",t?t.name:""),B.setFieldValue("clientRef",t?t.reference:"")},errorCheck:"clientId"})}),(0,n.jsx)(o.ZP,{item:!0,xs:12,children:(0,n.jsx)(I.Z,{endpointId:b.r.Currency.qry,name:"currencyId",label:T.currency,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:B.values,readOnly:z||K||G||"1"===B.values.type||1===B.values.type,required:"2"===B.values.type||2===B.values.type,maxAccess:U,onChange:(e,t)=>{B.setFieldValue("currencyId",(null==t?void 0:t.recordId)||0)},error:B.touched.currencyId&&!!B.errors.currencyId})}),(0,n.jsx)(o.ZP,{item:!0,xs:12,children:(0,n.jsx)(I.Z,{datasetId:g.v.GENERATE_VARIATIONS,name:"genVar",label:T.generateVariations,values:B.values,valueField:"key",displayField:"value",readOnly:z||K||G,maxAccess:U,onChange:(e,t)=>{B&&B.setFieldValue("genVar",t?t.key:"")},required:!0,error:B.touched.genVar&&!!B.errors.genVar})}),(0,n.jsx)(o.ZP,{item:!0,xs:12,children:(0,n.jsx)(A.Z,{name:"disableItemDuplicate",value:null===(l=B.values)||void 0===l?void 0:l.disableItemDuplicate,onChange:e=>B.setFieldValue("disableItemDuplicate",e.target.checked),label:T.disableItemDuplicate,maxAccess:U})})]})})})})}var P=a(33625),O=a(76399),R=a(54074),D=e=>{let{store:t,maxAccess:a,labels:s,setRefreshController:l,refreshController:o}=e,{recordId:d,isPosted:i,isClosed:m}=t,{getRequest:h,postRequest:I}=(0,r.useContext)(u.$),{platformLabels:b}=(0,r.useContext)(x.l),{formik:C}=(0,v.c)({maxAccess:a,validateOnChange:!0,initialValues:{search:"",rows:[]},onSubmit:async()=>{let e=C.values.rows.map((e,t)=>({...e,id:t+1,status:e.status||1})).filter(e=>e.isChecked);await I({extension:y.x.Sites.set2,record:JSON.stringify({stockCountId:d,sites:e})}),await g(d),l(!o),c.ZP.success(b.Updated),C.setFieldValue("search","")}}),g=async e=>{if(e){let t=(await h({extension:y.x.Sites.qry,parameters:"_stockCountId=".concat(e)})).list.map((e,t)=>({...e,id:t+1}));C.setValues({rows:t})}},w=C.values.search?C.values.rows.filter(e=>e.siteRef&&e.siteRef.toString().includes(C.values.search.toLowerCase())||e.siteName&&e.siteName.toLowerCase().includes(C.values.search.toLowerCase())):C.values.rows,_=[{component:"checkbox",label:" ",name:"isChecked",flex:1,props:{disabled:i||m}},{component:"textfield",name:"siteRef",label:s.siteRef,flex:1,props:{readOnly:!0}},{component:"textfield",name:"siteName",label:s.name,flex:1,props:{readOnly:!0}},{component:"textfield",name:"statusName",label:s.statusName,flex:1,props:{readOnly:!0}},{component:"textfield",name:"notes",label:s.notes,flex:2,props:{readOnly:!1},propsReducer(e){let{row:t,props:a}=e;return{...a,readOnly:"Processed"===t.statusName||i||m}}}];return(0,r.useEffect)(()=>{!async function(){d&&await g(d)}()},[d]),(0,n.jsx)(R.Z,{onSave:C.handleSubmit,maxAccess:a,disabledSubmit:m,children:(0,n.jsx)(f.R,{children:(0,n.jsxs)(p.Q,{children:[(0,n.jsx)(P.g,{children:(0,n.jsx)(j.Z,{name:"search",value:C.values.search,label:s.search,readOnly:i||m,onClear:()=>{C.setFieldValue("search",""),g()},sx:{width:"30%"},onChange:e=>{let{value:t}=e.target;C.setFieldValue("search",t)}})}),(0,n.jsx)(p.Q,{children:(0,n.jsx)(O._,{onChange:e=>(function(e){let t=C.values.rows.map(t=>e.find(e=>e.id===t.id)||t);C.setFieldValue("rows",t)})(e),value:w,error:C.errors.rows,columns:_,allowAddNewLine:!1,allowDelete:!1})})]})})})},q=e=>{let{store:t,maxAccess:a,labels:s}=e,{recordId:l,isPosted:o,isClosed:i}=t,{getRequest:m,postRequest:h}=(0,r.useContext)(u.$),{platformLabels:b}=(0,r.useContext)(x.l),{formik:C}=(0,v.c)({maxAccess:a,validateOnChange:!0,initialValues:{stockCountId:"",siteId:null,rows:[]},validationSchema:d.Ry({siteId:d.Rx().required()}),onSubmit:async()=>{let e=C.values.rows.map((e,t)=>({...e,id:t+1,status:e.status||1,controllerId:e.recordId,siteId:C.values.siteId,stockCountId:l})).filter(e=>e.isChecked),t={stockCountId:l,siteId:C.values.siteId,items:e};if(await h({extension:y.x.StockCountControllerTab.set2,record:JSON.stringify(t)}),c.ZP.success(b.Updated),C.values.siteId){let e=await g(l,C.values.siteId);C.setValues({rows:e.list})}}}),g=async(e,t)=>{var a;let n=await m({extension:y.x.Controller.qry,parameters:"_siteId=".concat(t)}),s=await m({extension:y.x.StockCountControllerTab.qry,parameters:"_siteId=".concat(t,"&_stockCountId=").concat(e)});n.list.map((e,t)=>{let a=s.list.find(t=>t.controllerId===e.recordId);return a&&(e.isChecked=!0,e.statusName=a.statusName,e.status=a.status),{...e,id:t+1}}),n.list=null==n?void 0:null===(a=n.list)||void 0===a?void 0:a.map((e,t)=>({...e,id:t,isChecked:(null==e?void 0:e.isChecked)!==void 0&&(null==e?void 0:e.isChecked)})),C.setFieldValue("stockCountId",e),C.setValues({rows:n.list}),C.setFieldValue("siteId",t)},w=[{component:"checkbox",label:" ",name:"isChecked",flex:.2,props:{disabled:o||i}},{component:"textfield",name:"name",label:s.name,flex:1,props:{readOnly:!0}},{component:"textfield",name:"statusName",label:s.statusName,flex:1,props:{readOnly:!0}}];return(0,n.jsx)(R.Z,{onSave:C.handleSubmit,maxAccess:a,disabledSubmit:o||i,children:(0,n.jsx)(f.R,{children:(0,n.jsxs)(p.Q,{children:[(0,n.jsx)(P.g,{children:(0,n.jsx)(I.Z,{name:"siteId",endpointId:y.x.Sites.qry,parameters:l?"_stockCountId=".concat(l):"",label:s.sites,filter:e=>e.isChecked,valueField:"siteId",required:!0,displayField:"siteName",values:C.values,onChange:async(e,t)=>{(null==t?void 0:t.siteId)&&(C.setFieldValue("siteId",t?null==t?void 0:t.siteId:null),await g(l,null==t?void 0:t.siteId))},error:C.touched.siteId&&!!C.errors.siteId,maxAccess:a})}),(0,n.jsx)(O._,{onChange:e=>(function(e){let t=C.values.rows.map(t=>e.find(e=>e.id===t.id)||t);C.setFieldValue("rows",t)})(e),value:C.values.rows,error:C.errors.rows,columns:w,allowAddNewLine:!1,allowDelete:!1})]})})})},E=a(50023),L=a(21326);let J=e=>{let{recordId:t,plantId:a,window:o}=e,[d,i]=(0,r.useState)(0),[c,u]=(0,r.useState)({recordId:t||null,isPosted:!1,isClosed:!1}),{labels:v,access:p}=(0,E.Z)({datasetId:m.i.StockCounts,editMode:!!t});(0,L.Z)({title:v.cycleCounts,window:o});let[f,x]=(0,r.useState)(!1),h=!!c.recordId,y=[{label:v.cycleCounts},{label:v.sites,disabled:!h},{label:v.controller,disabled:!h}];return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(l.Y,{tabs:y,activeTab:d,setActiveTab:i,maxAccess:p}),(0,n.jsx)(s.Z,{index:0,value:d,maxAccess:p,children:(0,n.jsx)(T,{labels:v,setStore:u,store:c,maxAccess:p,plantId:a})}),(0,n.jsx)(s.Z,{index:1,value:d,maxAccess:p,children:(0,n.jsx)(D,{labels:v,maxAccess:p,store:c,setRefreshController:x,refreshController:f})}),(0,n.jsx)(s.Z,{index:2,value:d,maxAccess:p,children:(0,n.jsx)(q,{labels:v,maxAccess:p,store:c},f)})]})};J.width=650,J.height=750;var W=J},39704:function(e,t,a){"use strict";var n=a(52322),s=a(2784),l=a(22341),r=a(65950),o=a(85325),d=a(21326),i=a(19473),c=a(35656),u=a(24868),m=a.n(u);let v=e=>{let{functionId:t,recordId:a,window:u}=e,{getRequest:v}=(0,s.useContext)(r.$),{languageId:p}=(0,s.useContext)(o.V),{platformLabels:f}=(0,s.useContext)(i.l),x=a+"-"+t;(0,d.Z)({title:f.WorkFlow,window:u});let{width:h}=(0,c.d)(),y=h<=1024,I=h>1024&&h<=1280,b=y?10:I?12:14,C=y?75:I?85:95,g=y?15:I?20:25,w=async()=>{var e="_functionId=".concat(t,"&_recordId=").concat(a);let n=await v({extension:l.P.WorkFlow.graph,parameters:e});return null==n?void 0:n.record},_=e=>{let t=[],a=[],n="",s="";return e.objects.forEach(e=>{t.push({functionName:e.functionName,reference:e.reference,date:e.date})}),e.workflow.forEach(t=>{e.objects.forEach(e=>{let a=e.functionName.split(" ").join("\r\n");t.parentId===e.recordId&&t.parentFunctionId===e.functionId&&(n=e.reference+"\r\n"+e.date+"\r\n"+a,t.parentId),t.childId===e.recordId&&t.childFunctionId===e.functionId&&(s=e.reference+"\r\n"+e.date+"\r\n"+a,t.childId)}),""===n||""===s||a.push({from:n,to:s,value:1,labelText:""}),n="",s=""}),a};return(0,s.useEffect)(()=>{!async function(){var e=await w();if(e){let t=(e,t)=>{let a=document.createElement("script");a.type="text/javascript",a.src=e,a.async=!0,a.onload=t,document.head.appendChild(a)};t("https://cdn.amcharts.com/lib/4/core.js",()=>{t("https://cdn.amcharts.com/lib/4/charts.js",()=>{t("https://cdn.amcharts.com/lib/4/themes/animated.js",()=>{am4core.ready(()=>{let t=am4core.create(x,am4charts.SankeyDiagram),a=_(e);t.data=a,t.dataFields.fromName="from",t.dataFields.toName="to",t.dataFields.value="value",t.paddingRight=2===p?0:40,t.paddingLeft=2===p?40:0,t.tooltip.label.fontSize=b;let n=t.nodes.template;n.draggable=!1,n.inert=!0,n.clickable=!1,n.width=C,n.height=g,n.nameLabel.label.fontSize=b,n.nameLabel.locationX=2===p?.85:0,n.nameLabel.height=void 0,n.nameLabel.label.fontWeight="bold";let s=t.links.template;s.middleLine.strokeOpacity=.3,s.middleLine.stroke=am4core.color("#555"),s.middleLine.strokeWidth=5,s.middleLine.hoverable=!1,s.fillOpacity=0,s.hoverable=!0,s.hoverOnFocus=!0,s.fill=am4core.color("#A8C686"),s.isHover=!0,t.appear(1e3,100)})})})})}}()},[]),(0,n.jsx)("div",{id:x,className:m().root})};v.width=950,t.Z=v},95291:function(e){e.exports={tabPanel:"CustomTabPanel_tabPanel__80Dfu",active:"CustomTabPanel_active___6Uvb",hidden:"CustomTabPanel_hidden__y9566"}},52614:function(e){e.exports={customTabPanel:"CustomTabs_customTabPanel__Ztocv",hidden:"CustomTabs_hidden__lZpM7",tabsContainer:"CustomTabs_tabsContainer__28Syi",tabsWrapper:"CustomTabs_tabsWrapper__mlxxj",tabs:"CustomTabs_tabs__25pli",tabName:"CustomTabs_tabName__XzMCn",tabRoot:"CustomTabs_tabRoot__WVR1E",tabDisabled:"CustomTabs_tabDisabled__VauYR",selectedTab:"CustomTabs_selectedTab__sZzwF",tabsIndicator:"CustomTabs_tabsIndicator__89Lek",refreshButton:"CustomTabs_refreshButton__P2mzl",refreshIcon:"CustomTabs_refreshIcon__ADVWF"}},24868:function(e){e.exports={root:"WorkFlow_root__EINm1"}}},function(e){e.O(0,[92515,2494,36908,49774,92888,40179],function(){return e(e.s=77287)}),_N_E=e.O()}]);