(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[46458],{63983:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/iv-item-replacement",function(){return n(23467)}])},23467:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return R}});var i=n(52322),a=n(2784),l=n(69387),r=n(65950),d=n(61802),s=n(71987),o=n(26612),m=n(31389),c=n(33625),u=n(62362),p=n(65215),v=n(60218),I=n(48601),f=n(62202),h=n(82737),x=n(80983),y=n(19473),k=n(76399),N=n(27423),g=n(67920);function _(e){let{labels:t,maxAccess:n,recordId:l}=e,{platformLabels:d}=(0,a.useContext)(y.l),{getRequest:c,postRequest:_}=(0,a.useContext)(r.$),w=(0,s.E)({endpointId:p.$.Replacement.page}),{schema:R,requiredFields:j}=(0,g.m)({replacementId:e=>(null==e?void 0:e.replacementId)>0},!0,n,"items"),{formik:S}=(0,x.c)({initialValues:{recordId:l,itemId:null,sku:"",itemName:"",items:[]},maxAccess:n,validateOnChange:!0,validationSchema:I.Ry({itemId:I.Z_().required(),items:I.IX().of(R)}),onSubmit:async e=>{let t={itemId:e.itemId,items:e.items.filter(e=>{var t;return null===(t=Object.values(j))||void 0===t?void 0:t.every(t=>t(e))})},n=await _({extension:p.$.Replacement.set2,record:JSON.stringify(t)});f.ZP.success(d.Updated),await b(null==n?void 0:n.recordId),S.setFieldValue("recordId",null==n?void 0:n.recordId),w()}}),C=!!S.values.recordId;async function b(e){if(e){var t,n,i,a;let l=await c({extension:p.$.Item.get,parameters:"_recordId=".concat(e)}),r=await c({extension:p.$.Replacement.qry,parameters:"_itemId=".concat(e)});S.setValues({sku:null==l?void 0:null===(t=l.record)||void 0===t?void 0:t.sku,itemId:e,itemName:null==l?void 0:null===(n=l.record)||void 0===n?void 0:n.name,items:(null==r?void 0:null===(i=r.list)||void 0===i?void 0:i.length)>0?null==r?void 0:null===(a=r.list)||void 0===a?void 0:a.map((e,t)=>({...e,id:t+1})):[{id:1}]})}}(0,a.useEffect)(()=>{!async function(){l&&(await b(l),S.setFieldValue("recordId",l))}()},[l]);let F=[{component:"resourcelookup",label:t.replacementSKU,name:"replacementSKU",props:{endpointId:p.$.Item.snapshot,parameters:{_categoryId:0,_msId:0,_startAt:0,_size:1e3},displayField:"sku",valueField:"sku",mapping:[{from:"recordId",to:"replacementId"},{from:"sku",to:"replacementSKU"},{from:"name",to:"replacementItemName"}],columnsInDropDown:[{key:"sku",value:"SKU"},{key:"name",value:"Item Name"}],displayFieldWidth:3,minChars:2}},{component:"textfield",label:t.replacementItemName,flex:2,name:"replacementItemName",props:{readOnly:!0}}],A=[{key:"RecordRemarks",condition:!0,onClick:"onRecordRemarks",disabled:!C}];return(0,i.jsx)(h.Z,{resourceId:o.i.ItemReplacement,form:S,maxAccess:n,actions:A,editMode:C,children:(0,i.jsx)(m.R,{children:(0,i.jsxs)(u.Q,{children:[(0,i.jsx)(v.ZP,{container:!0,children:(0,i.jsx)(v.ZP,{item:!0,xs:12,children:(0,i.jsx)(N.U,{endpointId:p.$.Item.snapshot,name:"itemId",label:t.sku,valueField:"reference",displayField:"name",valueShow:"sku",required:!0,secondValueShow:"itemName",formObject:S.values,form:S,columnsInDropDown:[{key:"sku",value:"SKU"},{key:"name",value:"Name",grid:6}],onChange:(e,t)=>{b((null==t?void 0:t.recordId)||null)},secondFieldName:"itemName",onSecondValueChange:e=>{S.setFieldValue("itemName",e)},errorCheck:"itemId",maxAccess:n,readOnly:C,displayFieldWidth:3,firstFieldWidth:4})})}),(0,i.jsx)(k._,{onChange:e=>S.setFieldValue("items",e),value:S.values.items,error:S.errors.items,columns:F,name:"items",initialValues:S.initialValues.items[0],maxAccess:n,disabled:!S.values.itemId,allowAddNewLine:!!S.values.itemId,allowDelete:!!S.values.itemId})]})})})}var w=n(27723),R=()=>{let{getRequest:e,postRequest:t}=(0,a.useContext)(r.$),{platformLabels:n}=(0,a.useContext)(y.l),{stack:v}=(0,d.zY)();async function I(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{_startAt:n=0,_pageSize:i=50}=t;return{...await e({extension:p.$.Replacement.page,parameters:"_startAt=".concat(n,"&_pageSize=").concat(i,"&_itemId=0")}),_startAt:n}}let{query:{data:h},labels:x,paginationParameters:k,refetch:N,access:g,invalidate:R}=(0,s.J)({queryFn:I,endpointId:p.$.Replacement.page,datasetId:o.i.ItemReplacement}),j=[{field:"replacementSKU",headerName:x.replacementSKU,flex:1},{field:"replacementItemName",headerName:x.replacementItemName,flex:1},{field:"sku",headerName:x.sku,flex:1},{field:"itemName",headerName:x.itemName,flex:1}];function S(e){v({Component:_,props:{labels:x,recordId:null==e?void 0:e.itemId,maxAccess:g},width:800,height:600,title:x.ItemReplacement})}let C=async()=>{S()},b=async e=>{await t({extension:p.$.Replacement.del,record:JSON.stringify(e)}),R(),f.ZP.success(n.Deleted)};return(0,i.jsxs)(m.R,{children:[(0,i.jsx)(c.g,{children:(0,i.jsx)(w.Z,{onAdd:C,labels:x,maxAccess:g})}),(0,i.jsx)(u.Q,{children:(0,i.jsx)(l.Z,{columns:j,gridData:h,rowId:["itemId","replacementId"],onEdit:e=>{S(e)},onDelete:b,deleteConfirmationType:"strict",pageSize:50,refetch:N,paginationType:"api",paginationParameters:k,maxAccess:g})})]})}},67920:function(e,t,n){"use strict";n.d(t,{m:function(){return a}});var i=n(48601);function a(e,t,n){var a;let l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"items",r={...e};return null==n||null===(a=n.record)||void 0===a||a.controls.forEach(e=>{let{controlId:t,accessLevel:n}=e,[i,a]=null==t?void 0:t.split(".");i!==l||2!==n||a in r||(r[a]=e=>(null==e?void 0:e[a])!=null),(1===n||4===n)&&a in r&&delete r[a]}),{schema:i.Ry().shape({...Object.keys(r).reduce((e,n)=>(e[n]=i.nK().nullable().test(function(e){var i;let a=this.parent,[,l]=this.path.match(/^(\w+)\[(\d+)\]/)||[],d=(null===(i=this.options.context)||void 0===i?void 0:i[l])||[];if(t||!t&&d.length>1){if(null!==a[n]&&void 0!==a[n]&&0!==a[n]&&""!==r[n]&&!r[n](a))return!1;if(!Object.entries(r).some(e=>{let[,t]=e;return!!t(a)}))return!0}return!!r[n](a)&&void 0!==e}),e),{})}),requiredFields:r}}}},function(e){e.O(0,[49774,92888,40179],function(){return e(e.s=63983)}),_N_E=e.O()}]);