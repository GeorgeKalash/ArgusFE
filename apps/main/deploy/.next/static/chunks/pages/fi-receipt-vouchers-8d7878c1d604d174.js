(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[27510],{72496:function(e,a,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/fi-receipt-vouchers",function(){return n(99323)}])},99323:function(e,a,n){"use strict";n.r(a),n.d(a,{default:function(){return T}});var l=n(52322),t=n(2784),r=n(71987),d=n(65950),c=n(61802),o=n(69387),i=n(31389),u=n(33625),s=n(62362),v=n(25870),m=n(60218),h=n(48601),p=n(82737),I=n(62202),y=n(26612),x=n(8661),f=n(27423),g=n(80983),F=n(91406),A=n(5088),V=n(89330),N=n(7121),C=n(21581),b=n(98345),R=n(39812),k=n(19473),Z=n(1251),j=n(26553),w=n(77595),_=n(30657),P=n(16463),O=n(69627),M=n(2119);function S(e){var a,n,o,u,S,D,T,q,H;let{labels:E,maxAccess:L,recordId:J,window:G}=e,{getRequest:B,postRequest:U}=(0,t.useContext)(d.$),{platformLabels:$,defaultsData:z,userDefaultsData:K}=(0,t.useContext)(k.l),{stack:Q}=(0,c.zY)(),{documentType:W,maxAccess:X,changeDT:Y}=(0,b.H)({functionId:N.J.ReceiptVoucher,access:L,enabled:!J}),ee=(0,r.E)({endpointId:v.H.ReceiptVouchers.page}),ea=parseInt(null==K?void 0:null===(n=K.list)||void 0===n?void 0:null===(a=n.find(e=>"plantId"===e.key))||void 0===a?void 0:a.value),en=parseInt(null==z?void 0:null===(u=z.list)||void 0===u?void 0:null===(o=u.find(e=>"currencyId"===e.key))||void 0===o?void 0:o.value),el=parseInt(null==K?void 0:null===(D=K.list)||void 0===D?void 0:null===(S=D.find(e=>"cashAccountId"===e.key))||void 0===S?void 0:S.value),{formik:et}=(0,g.c)({maxAccess:X,validateOnChange:!0,documentType:{key:"dtId",value:null==W?void 0:W.dtId,reference:null==W?void 0:W.reference},initialValues:{recordId:J,reference:"",accountId:null,date:new Date,currencyId:en,currencyName:"",dtId:null,sptId:null,dgId:"",amount:"",baseAmount:"",checkNo:null,notes:"",oDocId:"",printStatus:"",status:1,paymentMethod:"1",cashAccountId:null,plantId:ea,exRate:1,rateCalcMethod:1,contactId:null,collectorId:null,isVerified:!1,template:1,sourceReference:""},validationSchema:h.Ry({accountId:h.Z_().required(),currencyId:h.Z_().required(),cashAccountId:h.Z_().required(),date:h.hT().required(),amount:h.Z_().required(),paymentMethod:h.Z_().required(),checkNo:h.Z_().nullable().test("check-no-required-if-payment-method-3","Check number is required when payment method is 3.",function(e){let{paymentMethod:a}=this.parent;return 3!=a||e&&""!==e.trim()})}),onSubmit:async e=>{let a=await U({extension:v.H.ReceiptVouchers.set,record:JSON.stringify({...e,date:(0,R.ku)(e.date)})});e.recordId?I.ZP.success($.Edited):(I.ZP.success($.Added),et.setFieldValue("recordId",a.recordId)),await em(a.recordId),ee()}});async function er(e,a,n,l){if(e&&a&&n){var t,r,d,c;let o=await B({extension:Z.q.Currency.get,parameters:"_currencyId=".concat(e,"&_date=").concat((0,R.Uf)(a),"&_rateDivision=").concat(n)}),i=(0,_.fB)({amount:0===l?0:null!=l?l:et.values.amount,exRate:null===(t=o.record)||void 0===t?void 0:t.exRate,baseAmount:0,rateCalcMethod:null===(r=o.record)||void 0===r?void 0:r.rateCalcMethod,dirtyField:_.ss});et.setFieldValue("baseAmount",parseFloat(null==i?void 0:i.baseAmount).toFixed(2)||0),et.setFieldValue("exRate",null===(d=o.record)||void 0===d?void 0:d.exRate),et.setFieldValue("rateCalcMethod",null===(c=o.record)||void 0===c?void 0:c.rateCalcMethod)}}async function ed(e){if(e){let{record:a}=await B({extension:v.H.FIDocTypeDefaults.get,parameters:"_dtId=".concat(e)});et.setFieldValue("plantId",(null==a?void 0:a.plantId)||ea),ev((null==a?void 0:a.cashAccountId)||el)}}async function ec(e){Q({Component:w.Z,props:{DatasetIdAccess:y.i.MCRFIReceiptVoucher,data:e,onOk:e=>{et.setValues(a=>({...a,...e}))}}})}(0,t.useEffect)(()=>{var e;et.values.dtId&&!J&&ed(null==et?void 0:null===(e=et.values)||void 0===e?void 0:e.dtId)},[et.values.dtId]);let eo=!!et.values.recordId,ei=-1===et.values.status,eu=3===et.values.status,es=et.values.isVerified,ev=async e=>{if(!e){et.setFieldValue("cashAccountId",null),et.setFieldValue("cashAccountRef",""),et.setFieldValue("cashAccountName","");return}let{record:a}=await B({extension:M.G.CbBankAccounts.get,parameters:"_recordId=".concat(e)});et.setFieldValue("cashAccountId",(null==a?void 0:a.recordId)||null),et.setFieldValue("cashAccountRef",(null==a?void 0:a.reference)||""),et.setFieldValue("cashAccountName",(null==a?void 0:a.name)||"")};async function em(e){if(e){let a=await B({extension:v.H.ReceiptVouchers.get,parameters:"_recordId=".concat(e)});et.setValues({...a.record,date:(0,R.a1)(a.record.date)})}}(0,t.useEffect)(()=>{!async function(){J?await em(J):ev(el)}()},[]);let eh=async()=>{let e=et.values,a=await U({extension:v.H.ReceiptVouchers.cancel,record:JSON.stringify({...e,date:(0,R.ku)(e.date)})});(null==a?void 0:a.recordId)&&(await em(null==a?void 0:a.recordId),I.ZP.success($.Cancelled),ee())},ep=async()=>{await U({extension:v.H.ReceiptVouchers.unpost,record:JSON.stringify(et.values)})&&(I.ZP.success($.Unposted),ee(),await em(et.values.recordId))},eI=async()=>{await U({extension:v.H.ReceiptVouchers.post,record:JSON.stringify(et.values)})&&(I.ZP.success($.Posted),ee(),await em(et.values.recordId),G.close())},ey=async()=>{await U({extension:v.H.ReceiptVouchers.verify,record:JSON.stringify(et.values)})&&(I.ZP.success(es?$.Unverfied:$.Verified),ee(),G.close())},ex=async()=>{await U({extension:v.H.ResetGL_RV.reset,record:JSON.stringify({...et.values,date:(0,R.ku)(et.values.date)})})},ef=[{key:"GL",condition:!0,onClick:"onClickGL",datasetId:y.i.GLReceiptVoucher,onReset:ex,disabled:!eo},{key:"Cancel",condition:!0,onClick:eh,disabled:!eo||eu||ei},{key:"FI Trx",condition:!0,onClick:"onClickIT",disabled:!eo},{key:"Aging",condition:!0,onClick:"onClickAging",disabled:!eo},{key:"RecordRemarks",condition:!0,onClick:"onRecordRemarks",disabled:!eo},{key:"Locked",condition:eu,onClick:"onUnpostConfirmation",onSuccess:ep,disabled:!eo||ei||es},{key:"Unlocked",condition:!eu,onClick:eI,disabled:!eo||ei},{key:"Verify",condition:!es,onClick:ey,disabled:!eu},{key:"Unverify",condition:es,onClick:ey,disabled:!eu},{key:"AccountSummary",condition:!0,onClick:()=>{Q({Component:P.Z,props:{accountId:parseInt(et.values.accountId),moduleId:1}})},disabled:!et.values.accountId}];return(0,l.jsx)(p.Z,{resourceId:y.i.ReceiptVoucher,functionId:N.J.ReceiptVoucher,form:et,actions:ef,maxAccess:X,editMode:eo,disabledSubmit:eu||ei,previewReport:eo,children:(0,l.jsx)(i.R,{children:(0,l.jsx)(s.Q,{children:(0,l.jsxs)(m.ZP,{container:!0,spacing:2,children:[(0,l.jsx)(m.ZP,{item:!0,xs:12,children:(0,l.jsx)(x.Z,{endpointId:v.H.ReceiptVouchers.pack,reducer:e=>{var a;return null==e?void 0:null===(a=e.record)||void 0===a?void 0:a.documentTypes},filter:eo?void 0:e=>1===e.activeStatus,name:"dtId",label:E.documentType,readOnly:eo,valueField:"recordId",displayField:"name",values:et.values,onChange:async(e,a)=>{et.setFieldValue("dtId",null==a?void 0:a.recordId),Y(a)},error:et.touched.dtId&&!!et.errors.dtId,maxAccess:X})}),(0,l.jsx)(m.ZP,{item:!0,xs:6,children:(0,l.jsx)(V.Z,{name:"date",label:E.date,onChange:async(e,a)=>{et.setFieldValue("date",a),await er(et.values.currencyId,a,j.B.FINANCIALS)},autoFocus:!eo,readOnly:ei||eu,value:et.values.date,maxAccess:X,required:!0,error:et.touched.date&&!!et.errors.date})}),(0,l.jsx)(m.ZP,{item:!0,xs:6,children:(0,l.jsx)(A.Z,{name:"reference",label:E.reference,value:et.values.reference,readOnly:eo,maxAccess:!eo&&X,maxLength:"30",onChange:et.handleChange,onClear:()=>et.setFieldValue("reference",""),error:et.touched.reference&&!!et.errors.reference})}),(0,l.jsx)(m.ZP,{item:!0,xs:12,children:(0,l.jsx)(x.Z,{endpointId:v.H.ReceiptVouchers.pack,reducer:e=>{var a;return null==e?void 0:null===(a=e.record)||void 0===a?void 0:a.plants},name:"plantId",readOnly:ei||eu,label:E.plant,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:et.values,maxAccess:X,onChange:(e,a)=>{et.setFieldValue("plantId",(null==a?void 0:a.recordId)||null)},error:et.touched.plantId&&!!et.errors.plantId})}),(0,l.jsx)(m.ZP,{item:!0,xs:6,children:(0,l.jsx)(f.U,{endpointId:v.H.Account.snapshot,required:!0,name:"accountId",firstFieldWidth:4,readOnly:ei||eu,label:E.accountReference,valueField:"reference",displayField:"name",valueShow:"accountRef",secondValueShow:"accountName",form:et,columnsInDropDown:[{key:"reference",value:"Account Ref"},{key:"name",value:"Name",grid:4},{key:"keywords",value:"Keywords"}],displayFieldWidth:4,filter:{isInactive:e=>!0!==e},onChange:(e,a)=>{et.setFieldValue("accountId",a?a.recordId:null),et.setFieldValue("accountRef",(null==a?void 0:a.reference)||""),et.setFieldValue("accountName",(null==a?void 0:a.name)||""),et.setFieldValue("spId",(null==a?void 0:a.spId)||""),et.setFieldValue("sptId",(null==a?void 0:a.sptId)||""),et.setFieldValue("accountGroupName",(null==a?void 0:a.groupName)||"")},error:et.touched.accountId&&!!et.errors.accountId,maxAccess:X})}),(0,l.jsx)(m.ZP,{item:!0,xs:6,children:(0,l.jsx)(A.Z,{name:"accountGroupName",label:E.accountGroup,value:et.values.accountGroupName,readOnly:!0})}),(0,l.jsx)(m.ZP,{item:!0,xs:6,children:(0,l.jsx)(x.Z,{endpointId:v.H.ReceiptVouchers.pack,reducer:e=>{var a;return null==e?void 0:null===(a=e.record)||void 0===a?void 0:a.salesPeople},name:"spId",readOnly:!et.values.accountId||ei||eu,label:E.salePerson,valueField:"recordId",displayField:["spRef","name"],columnsInDropDown:[{key:"spRef",value:"Reference"},{key:"name",value:"Name"}],values:et.values,onChange:(e,a)=>{et.setFieldValue("spId",null==a?void 0:a.recordId)},error:et.touched.spId&&!!et.errors.spId,maxAccess:X})}),(0,l.jsx)(m.ZP,{item:!0,xs:6}),(0,l.jsx)(m.ZP,{item:!0,xs:6,children:(0,l.jsx)(x.Z,{endpointId:v.H.ReceiptVouchers.pack,reducer:e=>{var a;return null==e?void 0:null===(a=e.record)||void 0===a?void 0:a.paymentMethods},name:"paymentMethod",readOnly:ei||eu,label:E.receiptMethod,valueField:"key",displayField:"value",required:!0,values:et.values,onChange:async(e,a)=>{et.setFieldValue("cashAccountId",null),et.setFieldValue("cashAccountRef",null),et.setFieldValue("cashAccountName",null),et.setFieldValue("checkNo",null),et.setFieldValue("paymentMethod",(null==a?void 0:a.key)||null)},error:et.touched.paymentMethod&&!!et.errors.paymentMethod,maxAccess:X})}),(0,l.jsx)(m.ZP,{item:!0,xs:6,children:(0,l.jsx)(A.Z,{name:"checkNo",label:E.checkNo,value:et.values.checkNo,maxAccess:X,maxLength:30,onChange:et.handleChange,onClear:()=>et.setFieldValue("checkNo",null),error:et.touched.checkNo&&!!et.errors.checkNo,readOnly:3!=et.values.paymentMethod,required:3==et.values.paymentMethod})}),(0,l.jsx)(m.ZP,{item:!0,xs:6,children:(0,l.jsx)(x.Z,{endpointId:v.H.ReceiptVouchers.pack,reducer:e=>{var a;return null==e?void 0:null===(a=e.record)||void 0===a?void 0:a.cashAccounts},filter:e=>2!=et.values.paymentMethod||1==Number(e.type),name:"cashAccountId",readOnly:ei||eu,required:!0,label:E.cashAccount,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:et.values,maxAccess:X,onChange:async(e,a)=>{et.setFieldValue("cashAccountId",(null==a?void 0:a.recordId)||null)},error:et.touched.cashAccountId&&!!et.errors.cashAccountId})}),(0,l.jsx)(m.ZP,{item:!0,xs:6,children:(0,l.jsx)(x.Z,{endpointId:(null===(T=et.values)||void 0===T?void 0:T.accountId)&&v.H.Contact.qry,parameters:(null===(q=et.values)||void 0===q?void 0:q.accountId)&&"_accountId=".concat(null===(H=et.values)||void 0===H?void 0:H.accountId),name:"contactId",readOnly:ei||eu,label:E.contact,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:et.values,maxAccess:X,onChange:(e,a)=>{et.setFieldValue("contactId",(null==a?void 0:a.recordId)||null)},error:et.touched.contactId&&!!et.errors.contactId})}),(0,l.jsx)(m.ZP,{item:!0,xs:6,children:(0,l.jsxs)(m.ZP,{container:!0,spacing:1,alignItems:"center",children:[(0,l.jsx)(m.ZP,{item:!0,xs:8,children:(0,l.jsx)(x.Z,{endpointId:v.H.ReceiptVouchers.pack,reducer:e=>{var a;return null==e?void 0:null===(a=e.record)||void 0===a?void 0:a.currencies},name:"currencyId",readOnly:ei||eu,required:!0,filter:e=>1===e.currencyType,label:E.currency,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:et.values,maxAccess:X,onChange:async(e,a)=>{await er(null==a?void 0:a.recordId,et.values.date,j.B.FINANCIALS),et.setFieldValue("currencyId",null==a?void 0:a.recordId),et.setFieldValue("currencyName",null==a?void 0:a.name)},error:et.touched.currencyId&&!!et.errors.currencyId})}),(0,l.jsx)(m.ZP,{item:!0,xs:4,children:(0,l.jsx)(O.Z,{onClick:()=>ec(et.values),image:"popup.png",tooltipText:$.add,disabled:!et.values.currencyId||et.values.currencyId===en})})]})}),(0,l.jsx)(m.ZP,{item:!0,xs:6,children:(0,l.jsx)(A.Z,{name:"sourceReference",label:E.sourceReference,value:et.values.sourceReference,readOnly:ei||eu,onChange:et.handleChange,onClear:()=>et.setFieldValue("sourceReference",""),maxLength:"20",maxAccess:X,error:et.touched.sourceReference&&!!et.errors.sourceReference})}),(0,l.jsx)(m.ZP,{item:!0,xs:6,children:(0,l.jsx)(x.Z,{endpointId:v.H.ReceiptVouchers.pack,reducer:e=>{var a;return null==e?void 0:null===(a=e.record)||void 0===a?void 0:a.collectors},name:"collectorId",readOnly:ei||eu,label:E.collector,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:et.values,onChange:async(e,a)=>{et.setFieldValue("collectorId",(null==a?void 0:a.recordId)||"")},error:et.touched.collectorId&&!!et.errors.collectorId,maxAccess:X})}),(0,l.jsx)(m.ZP,{item:!0,xs:6}),(0,l.jsx)(m.ZP,{item:!0,xs:6,children:(0,l.jsx)(F.Z,{name:"amount",required:!0,label:E.amount,value:et.values.amount,readOnly:ei||eu,maxAccess:X,maxLength:"10",decimalScale:2,onChange:async e=>{var a,n,l;et.setFieldValue("amount",e.target.value);let t=(0,_.fB)({amount:null!==(l=e.target.value)&&void 0!==l?l:0,exRate:null===(a=et.values)||void 0===a?void 0:a.exRate,baseAmount:0,rateCalcMethod:null===(n=et.values)||void 0===n?void 0:n.rateCalcMethod,dirtyField:_.ss});et.setFieldValue("baseAmount",parseFloat(null==t?void 0:t.baseAmount).toFixed(2)||0)},onClear:async()=>{et.setFieldValue("amount",0)},error:et.touched.amount&&!!et.errors.amount})}),(0,l.jsx)(m.ZP,{item:!0,xs:6}),(0,l.jsx)(m.ZP,{item:!0,xs:6,children:(0,l.jsx)(x.Z,{neverPopulate:!0,endpointId:v.H.ReceiptVouchers.pack,reducer:e=>{var a;return null==e?void 0:null===(a=e.record)||void 0===a?void 0:a.descriptionTemplates},name:"templateId",label:E.descriptionTemplate,readOnly:ei||eu,valueField:"recordId",displayField:"name",values:et.values,onChange:(e,a)=>{let n=et.values.notes||"";(null==a?void 0:a.name)&&et.setFieldValue("notes",""===n?a.name:"".concat(n,"\n").concat(a.name)),et.setFieldValue("templateId",(null==a?void 0:a.recordId)||null)},error:et.touched.templateId&&!!et.errors.templateId,maxAccess:X})}),(0,l.jsx)(m.ZP,{item:!0,xs:12,children:(0,l.jsx)(C.Z,{name:"notes",type:"text",label:E.notes,value:et.values.notes,readOnly:ei||eu,rows:3,maxAccess:X,onChange:e=>et.setFieldValue("notes",e.target.value),onClear:()=>et.setFieldValue("notes",""),error:et.touched.notes&&!!et.errors.notes})})]})})})})}var D=n(36908);function T(){let{getRequest:e,postRequest:a}=(0,t.useContext)(d.$),{platformLabels:n}=(0,t.useContext)(k.l),{stack:m}=(0,c.zY)();function h(e){m({Component:S,props:{labels:f,maxAccess:g,recordId:e||null},width:1100,height:700,title:f.receiptVoucher})}let{query:{data:p},filterBy:x,labels:f,access:g,paginationParameters:F,refetch:A,invalidate:V}=(0,r.J)({queryFn:R,endpointId:v.H.ReceiptVouchers.page,datasetId:y.i.ReceiptVoucher,filter:{filterFn:C}});async function C(a){let{filters:n,pagination:l}=a;return(null==n?void 0:n.qry)?await e({extension:v.H.ReceiptVouchers.snapshot,parameters:"_filter=".concat(n.qry)}):R({_startAt:l._startAt||0,params:null==n?void 0:n.params})}async function R(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{_startAt:n=0,_pageSize:l=50,params:t}=a;return{...await e({extension:v.H.ReceiptVouchers.page,parameters:"_startAt=".concat(n,"&_pageSize=").concat(l,"&_params=").concat(t||"","&_sortBy=recordId desc")}),_startAt:n}}let{proxyAction:Z}=(0,b.G)({functionId:N.J.ReceiptVoucher,action:h}),j=async()=>{await Z()},w=async e=>{await a({extension:v.H.ReceiptVouchers.del,record:JSON.stringify(e)}),V(),I.ZP.success(n.Deleted)},_=[{field:"plantName",headerName:f.plant,flex:1},{field:"reference",headerName:f.reference,flex:1},{field:"date",headerName:f.date,flex:1,type:"date"},{field:"accountRef",headerName:f.accountReference,flex:1},{field:"accountName",headerName:f.accountName,flex:1},{field:"currencyName",headerName:f.currency,flex:1},{field:"paymentMethodName",headerName:f.receiptMethod,flex:1},{field:"amount",headerName:f.amount,flex:1,type:"number"},{field:"cashAccountName",headerName:f.CashAccount,flex:1},{field:"notes",headerName:f.description,flex:1},{field:"isVerified",headerName:f.isVerified,type:"checkbox"},{field:"statusName",headerName:f.status,flex:1}];return(0,l.jsxs)(i.R,{children:[(0,l.jsx)(u.g,{children:(0,l.jsx)(D.Z,{onAdd:j,maxAccess:g,reportName:"FIRV",filterBy:x})}),(0,l.jsx)(s.Q,{children:(0,l.jsx)(o.Z,{name:"table",columns:_,onEdit:e=>{h(e.recordId)},onDelete:w,gridData:p||{list:[]},rowId:["recordId"],isLoading:!1,refetch:A,deleteConfirmationType:"strict",paginationParameters:F,pageSize:50,paginationType:"api",maxAccess:g})})]})}},93736:function(e,a,n){"use strict";n.d(a,{K:function(){return t}});let l="RG.FI.asmx/",t={FiOpeningBalance:{gen:l+"genOBA"},FiAging:{qry:l+"FI404"},AccountSummary:{AccFI405b:l+"FI405b"},DocumentAging:{AgingFI406a:l+"FI406a",AgingFI406b:l+"FI406b"},TrialBalance:{FI402View:l+"FI402o",FI401o2:l+"FI401o2"}}},1685:function(e,a,n){"use strict";n.d(a,{m:function(){return l}});let l=e=>{let a=window.sessionStorage.getItem(e);return a?JSON.parse(a):null}},98345:function(e,a,n){"use strict";n.d(a,{H:function(){return p},G:function(){return h}});var l=n(45300),t=n(2784),r=n(96026),d=n(38449);n(26612);var c=n(65947),o=n(1685);let i=async(e,a,n)=>{try{let l=await e({extension:a,parameters:n});return a.includes("qry")?l:l.record}catch(e){return null}},u=(e,a,n,l)=>{let t=(e=JSON.parse(JSON.stringify(e))).record.controls,r=t.find(e=>"reference"===e.controlId);return r?r.accessLevel=(null==a?void 0:a.mandatory)?c.$7:c.rr:(null==a?void 0:a.mandatory)?t.push({sgId:0,resourceId:"",controlId:"".concat(l?l+".":"","reference"),accessLevel:(null==a?void 0:a.mandatory)?c.$7:c.rr}):(null==a?void 0:a.readOnly)?t.push({sgId:0,resourceId:"",controlId:"".concat(l?l+".":"","reference"),accessLevel:(null==a?void 0:a.readOnly)?c.rr:c.$7}):t=e.record.controls.filter(e=>"reference"!=e.controlId),n&&t.push({sgId:0,resourceId:"",controlId:"".concat(l?l+".":"","dtId"),accessLevel:c.$7}),{...e,record:{...e.record,controls:t}}},s=async(e,a,n)=>{let l,t;switch(n){case"dtId":let r=(0,o.m)("userData"),c=null==r?void 0:r.userId;t="_userId=".concat(c,"&_functionId=").concat(a),l=d.r.UserFunction.get;break;case"glbSysNumberRange":t="_recordId=".concat(a),l=d.r.SystemFunction.get;break;case"DocumentType":t="_dgId=".concat(a,"&_startAt=",0,"&_pageSize=",50),l=d.r.DocumentType.qry;break;case"DcTypNumberRange":t="_recordId=".concat(a),l=d.r.DocumentType.get;break;case"isExternal":t="_recordId=".concat(a),l=d.r.NumberRange.get;break;default:return null}return await i(e,l,t)},v=async function(e){let a,n,l,t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,d=arguments.length>2?arguments[2]:void 0,c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,o=!(arguments.length>4)||void 0===arguments[4]||arguments[4],i=arguments.length>5?arguments[5]:void 0,v=void 0===c&&r&&await s(e,r,"dtId"),m=null==v?void 0:v.dtId,h="",p=!0;if(v&&void 0===c||"nraId"===c){if(m){let n=await s(e,m,"DcTypNumberRange");a=null==n?void 0:n.nraId,p=!((null==n?void 0:n.activeStatus)<0),a||(h="Assign the document type to a number range")}if((!m||!p)&&o&&r){var I;let a=await s(e,r,"DocumentType");t=(null==a?void 0:null===(I=a.list)||void 0===I?void 0:I.filter(e=>(null==e?void 0:e.activeStatus)===1).length)>0}}if(("nraId"===c||void 0===c)&&r){if((!m||m)&&!a||a&&!p){let n=await s(e,r,"glbSysNumberRange");(a=null==n?void 0:n.nraId)&&t&&(t=!1),p=!0}h=a||t?"":"Assign the system Function to a number range"}c>0&&!a&&(a=c),a&&p?(n={readOnly:null==(l=await s(e,a,"isExternal"))||!l.external,mandatory:null!=l&&!!l.external},d&&(d=await u(d,n,t,i))):!a&&d&&(d=await u(d,n,t,i));let y=i?"".concat(i,".reference"):"reference";return{dtId:m,resetReference:null==n?void 0:n.readOnly,dcTypeRequired:t,reference:{fieldName:y,isEmpty:(null==l?void 0:l.external)!==void 0&&(null==l||!l.external)},errorMessage:h,maxAccess:d,selectNraId:c}};var m=n(65950);function h(e){let{functionId:a,action:n,hasDT:l}=e,{getRequest:d}=(0,t.useContext)(m.$),{stack:c}=(0,r.V)();return{proxyAction:async()=>{let e=await v(d,a,"",void 0,l);(null==e?void 0:e.errorMessage)?c({message:null==e?void 0:e.errorMessage}):await n()}}}function p(e){var a;let{functionId:n,access:d,hasDT:c,enabled:o=!0,objectName:i=""}=e,{getRequest:u}=(0,t.useContext)(m.$),{stack:s}=(0,r.V)(),[h,p]=(0,t.useState)(),I=async e=>{let a=await v(u,n,d,e,c,i);if(!a.errorMessage)return a;s({message:null==a?void 0:a.errorMessage})},y=(0,l.a)({retry:!1,staleTime:0,enabled:o,queryKey:[n,h,!!d,o],queryFn:h||"nraId"===h?()=>I(h):()=>I()});return{documentType:y.data,maxAccess:(null==y?void 0:null===(a=y.data)||void 0===a?void 0:a.maxAccess)||d,changeDT(e){p((null==e?void 0:e.nraId)||"nraId")}}}},16463:function(e,a,n){"use strict";n.d(a,{Z:function(){return V}});var l=n(52322),t=n(2784),r=n(49864),d=n(65950),c=n(27423),o=n(26612),i=n(71987),u=n(33625),s=n(62362),v=n(31389),m=n(8661),h=n(25870),p=n(69627),I=n(84100),y=n(19473),x=n(80983),f=n(38449),g=n(69387),F=n(93736),A=n(21326);function V(e){let{accountId:a,moduleId:n,window:V}=e,{getRequest:N}=(0,t.useContext)(d.$),{platformLabels:C}=(0,t.useContext)(y.l),[b,R]=(0,t.useState)([]);(0,A.Z)({title:C.AccountSummary,window:V});let{labels:k,access:Z}=(0,i.J)({datasetId:o.i.AccountSummary}),j=[{field:"days",headerName:k.days,flex:1,type:"number"}],[w,_]=(0,t.useState)(j),{formik:P}=(0,x.c)({maxAccess:Z,initialValues:{accountId:null,accountRef:"",accountName:"",agpId:null,moduleId:n}});async function O(){var e,a,l,t;let r;let d=2,c=[...j],o=await N({extension:f.r.Currency.qry,parameters:"_filter="});if(1==n?r=null==o?void 0:null===(e=o.list)||void 0===e?void 0:e.filter(e=>e.sale):2==n&&(r=null==o?void 0:null===(a=o.list)||void 0===a?void 0:a.filter(e=>e.purchase)),0==r.length)return;null==r||r.forEach((e,a)=>{c.push({field:"column".concat(a+1),headerName:e.reference,flex:1,type:"number"})}),_(c);let i=await N({extension:h.H.AgingLeg.qry,parameters:"_agpId=".concat(P.values.agpId)}),u=null==i?void 0:null===(l=i.list)||void 0===l?void 0:l.map(e=>{let a=Array(r.length+2).fill(0);return a[0]=null,a[1]=e.days,a}),s=(r||[]).map(e=>N({extension:F.K.AccountSummary.AccFI405b,parameters:"_agpId=".concat(P.values.agpId,"&_currencyId=").concat(e.recordId,"&_accountId=").concat(P.values.accountId)}).then(e=>({summaryRes:e})));(await Promise.all(s)).forEach(e=>{var a;let{summaryRes:n}=e;null==n||null===(a=n.list)||void 0===a||a.forEach(e=>{null==u||u.forEach(a=>{a[1]==e.seqDays&&(a[d]=e.amount)})}),d++});let v=Array(r.length+2).fill(null);for(let e=2;e<r.length+2;e++){let a=0;null==u||u.map(n=>{a+=Number(n[e]||0)}),v[e]=a}let m=u.filter(e=>null!==e[1]).map(e=>{let[a,n,...l]=e,t={days:n};return l.forEach((e,a)=>{t["column".concat(a+1)]=e.toFixed(2)}),t}),p={};for(let e=0;e<r.length;e++)p["column".concat(e+1)]=null!==(t=v[e+2].toFixed(2))&&void 0!==t?t:0;m.push(p),R({list:m})}return(0,t.useEffect)(()=>{!async function(){if(a&&n){var e,l,t;let n=await N({extension:h.H.Account.get,parameters:"_recordId=".concat(a)});P.setFieldValue("accountId",null==n?void 0:null===(e=n.record)||void 0===e?void 0:e.recordId),P.setFieldValue("accountRef",null==n?void 0:null===(l=n.record)||void 0===l?void 0:l.reference),P.setFieldValue("accountName",null==n?void 0:null===(t=n.record)||void 0===t?void 0:t.name)}}()},[]),(0,l.jsxs)(v.R,{children:[(0,l.jsx)(u.g,{children:(0,l.jsxs)(r.Z,{container:!0,spacing:2,p:2,children:[(0,l.jsx)(r.Z,{item:!0,xs:12,children:(0,l.jsx)(c.U,{endpointId:h.H.Account.snapshot,name:"accountId",label:k.account,valueField:"reference",displayField:"name",valueShow:"accountRef",secondValueShow:"accountName",form:P,readOnly:P.values.accountId&&P.values.moduleId,required:!0,maxAccess:Z,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],onChange:async(e,a)=>{P.setFieldValue("accountId",(null==a?void 0:a.recordId)||null),P.setFieldValue("accountName",(null==a?void 0:a.name)||""),P.setFieldValue("accountRef",(null==a?void 0:a.reference)||"")}})}),(0,l.jsx)(r.Z,{item:!0,xs:6,children:(0,l.jsx)(m.Z,{endpointId:h.H.AgingProfile.qry,parameters:"_startAt=0&_pageSize=1000&filter=",name:"agpId",label:k.agingProfile,values:P.values,valueField:"recordId",displayField:"name",maxAccess:Z,required:!0,onChange:(e,a)=>{P.setFieldValue("agpId",(null==a?void 0:a.recordId)||null),(null==a?void 0:a.recordId)||R({list:[]})}})}),(0,l.jsx)(r.Z,{item:!0,xs:5,children:(0,l.jsx)(m.Z,{datasetId:I.v.FI_AGING_MODULE,label:k.module,name:"moduleId",values:P.values,valueField:"key",displayField:"value",maxAccess:Z,required:!0,readOnly:P.values.moduleId,onChange:(e,a)=>{P.setFieldValue("moduleId",(null==a?void 0:a.key)||null)}})}),(0,l.jsx)(r.Z,{item:!0,xs:1,children:(0,l.jsx)(p.Z,{onClick:O,image:"preview.png",disabled:!P.values.agpId||!P.values.moduleId||!P.values.accountId,tooltipText:C.Preview})})]})}),(0,l.jsx)(s.Q,{children:(0,l.jsx)(g.Z,{columns:w,gridData:b,isLoading:!1,pagination:!1})})]})}V.width=1e3,V.height=500},77595:function(e,a,n){"use strict";n.d(a,{Z:function(){return F}});var l=n(52322),t=n(60218),r=n(2784),d=n(26612),c=n(5088),o=n(80983),i=n(31389),u=n(62362),s=n(91406),v=n(30657),m=n(65950),h=n(1251),p=n(39812),I=n(26553),y=n(71987),x=n(21326),f=n(19473),g=n(54074);function F(e){var a,n,F,A,V,N,C,b,R;let{data:k,onOk:Z,DatasetIdAccess:j,window:w}=e,{getRequest:_}=(0,r.useContext)(m.$),{platformLabels:P}=(0,r.useContext)(f.l);(0,x.Z)({title:P.MultiCurrencyRate,window:w});let{labels:O,access:M}=(0,y.J)({endpointId:h.q.Currency.get,DatasetIdAccess:j,datasetId:d.i.MultiCurrencyRate}),{formik:S}=(0,o.c)({initialValues:{currencyId:null==k?void 0:k.currencyId,currencyName:null==k?void 0:k.currencyName,exchangeId:null==k?void 0:k.exchangeId,exchangeName:null==k?void 0:k.exchangeName,rateCalcMethod:null==k?void 0:k.rateCalcMethod,rateCalcMethodName:null==k?void 0:k.rateCalcMethodName,rateTypeId:null==k?void 0:k.rateTypeId,exRate:(null==k?void 0:k.exRate)||null,amount:(null==k?void 0:k.amount)||0,baseAmount:null==k?void 0:k.baseAmount,rateTypeName:null==k?void 0:k.rateTypeName},maxAccess:M,validateOnChange:!0});async function D(){if((null==k?void 0:k.currencyId)&&(null==k?void 0:k.date)){var e,a,n,l,t;let r=await _({extension:h.q.Currency.get,parameters:"_currencyId=".concat(null==k?void 0:k.currencyId,"&_date=").concat((0,p.Uf)(null==k?void 0:k.date),"&_rateDivision=").concat(I.B.FINANCIALS)});S.setFieldValue("rateCalcMethod",null===(e=r.record)||void 0===e?void 0:e.rateCalcMethod),S.setFieldValue("rateCalcMethodName",null===(a=r.record)||void 0===a?void 0:a.rateCalcMethodName),S.setFieldValue("exchangeId",null===(n=r.record)||void 0===n?void 0:n.exchangeId),S.setFieldValue("exchangeName",null===(l=r.record)||void 0===l?void 0:l.exchangeName),S.setFieldValue("rateTypeName",null===(t=r.record)||void 0===t?void 0:t.rateTypeName)}}(0,r.useEffect)(()=>{!async function(){await D()}()},[]);let T=()=>{Z&&(Z({...S.values,exRate:S.values.exRate,baseAmount:S.values.baseAmount,amount:S.values.amount}),w.close())},q=[{key:"Ok",condition:!0,onClick:T,disabled:!1}];return(0,l.jsx)(g.Z,{onSave:T,actions:q,maxAccess:M,editMode:!1,isSaved:!1,children:(0,l.jsx)(i.R,{children:(0,l.jsx)(u.Q,{children:(0,l.jsxs)(t.ZP,{container:!0,spacing:2,children:[(0,l.jsx)(t.ZP,{item:!0,xs:12,children:(0,l.jsx)(c.Z,{name:"currencyName",value:null==S?void 0:null===(a=S.values)||void 0===a?void 0:a.currencyName,label:O.currency,readOnly:!0})}),(0,l.jsx)(t.ZP,{item:!0,xs:12,children:(0,l.jsx)(c.Z,{name:"rateTypeName",value:null==S?void 0:null===(n=S.values)||void 0===n?void 0:n.rateTypeName,label:O.rateType,readOnly:!0})}),(0,l.jsx)(t.ZP,{item:!0,xs:12,children:(0,l.jsx)(c.Z,{name:"exchangeName",value:null==S?void 0:null===(F=S.values)||void 0===F?void 0:F.exchangeName,label:O.exchangeTable,readOnly:!0})}),(0,l.jsx)(t.ZP,{item:!0,xs:12,children:(0,l.jsx)(c.Z,{name:"rateCalcMethodName",value:null==S?void 0:null===(A=S.values)||void 0===A?void 0:A.rateCalcMethodName,label:O.rateCalcMethod,readOnly:!0})}),(0,l.jsx)(t.ZP,{item:!0,xs:12,children:(0,l.jsx)(s.Z,{name:"exRate",value:null==S?void 0:null===(V=S.values)||void 0===V?void 0:V.exRate,label:O.rate,readOnly:(null==S?void 0:null===(N=S.values)||void 0===N?void 0:N.amount)==0,maxAccess:M,onClear:()=>{S.setFieldValue("baseAmount",""),S.setFieldValue("exRate","")},decimalScale:7,onChange:e=>{var a,n;let l=e.target.value;if(!l){S.setFieldValue("exRate",""),S.setFieldValue("baseAmount","");return}S.setFieldValue("exRate",l);let t=(0,v.fB)({amount:(null==k?void 0:k.amount)||0,exRate:l,baseAmount:parseFloat((null==S?void 0:null===(a=S.values)||void 0===a?void 0:a.baseAmount)||0).toFixed(2),rateCalcMethod:null==S?void 0:null===(n=S.values)||void 0===n?void 0:n.rateCalcMethod,dirtyField:v.ss});S.setValues({...S.values,...t,baseAmount:parseFloat(t.baseAmount).toFixed(2)})}})}),(0,l.jsx)(t.ZP,{item:!0,xs:12,children:(0,l.jsx)(s.Z,{name:"amount",value:null==S?void 0:null===(C=S.values)||void 0===C?void 0:C.amount,label:O.amount,readOnly:!0})}),(0,l.jsx)(t.ZP,{item:!0,xs:12,children:(0,l.jsx)(s.Z,{name:"baseAmount",value:null==S?void 0:null===(b=S.values)||void 0===b?void 0:b.baseAmount,label:O.baseAmount,readOnly:(null==S?void 0:null===(R=S.values)||void 0===R?void 0:R.amount)==0,onClear:()=>{S.setFieldValue("baseAmount",""),S.setFieldValue("exRate","")},maxAccess:M,onChange:e=>{var a,n;let l=e.target.value;if(!l){S.setFieldValue("baseAmount",""),S.setFieldValue("exRate","");return}S.setFieldValue("baseAmount",l);let t=(0,v.fB)({amount:(null==k?void 0:k.amount)||0,exRate:null==S?void 0:null===(a=S.values)||void 0===a?void 0:a.exRate,baseAmount:parseFloat(l||0).toFixed(2),rateCalcMethod:null==S?void 0:null===(n=S.values)||void 0===n?void 0:n.rateCalcMethod,dirtyField:v.i5});S.setValues({...S.values,...t})}})})]})})})})}F.width=500,F.height=500}},function(e){e.O(0,[92515,2494,36908,49774,92888,40179],function(){return e(e.s=72496)}),_N_E=e.O()}]);