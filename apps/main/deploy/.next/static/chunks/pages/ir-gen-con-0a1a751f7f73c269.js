(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[78615],{83517:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/ir-gen-con",function(){return r(76011)}])},76011:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return A}});var n=r(52322),s=r(31389),a=r(62362),l=r(2784),o=r(65950),d=r(26612),i=r(33625),c=r(60218),u=r(19473),p=r(71987),g=r(8661),y=r(82737),m=r(80983),f=r(48601),h=r(76399),S=r(62202),q=r(61802),v=r(38449),I=r(7121),C=r(89330),R=r(65215),D=r(5088),T=r(58912),O=r(39812),M=r(96026),P=r(27423),x=r(90587),b=r(84622),w=r(67920);function A(){var e,t,r,A,F,J;let{stack:k}=(0,q.zY)(),{getRequest:L,postRequest:N}=(0,l.useContext)(o.$),{stack:B}=(0,M.V)(),{platformLabels:G,userDefaultsData:W}=(0,l.useContext)(u.l),{labels:E,access:j}=(0,p.J)({datasetId:d.i.GenerateConsumption}),Z=parseInt(null==W?void 0:null===(t=W.list)||void 0===t?void 0:null===(e=t.find(e=>"siteId"===e.key))||void 0===e?void 0:e.value),{schema:_}=(0,w.m)({transferNow:e=>(null==e?void 0:e.transferNow)>0,isChecked:e=>null==e?void 0:e.isChecked},!0,j,"items"),{formik:V}=(0,m.c)({maxAccess:j,conditionSchema:["items"],initialValues:{dtId:null,fromSiteId:null,workCenterId:null,date:new Date,reference:"",wcRef:"",wcName:"",items:[]},validateOnChange:!0,validationSchema:f.Ry({fromSiteId:f.Z_().required(),workCenterId:f.Z_().required(),date:f.hT().required(),items:f.IX().of(_)}),onSubmit:async e=>{var t;if(!(!(V.values.items.filter(e=>e.isChecked).length<1)||(B({message:E.checkItemsBeforeAppend}),0)))return;let r=null===(t=e.items.filter(e=>e.isChecked))||void 0===t?void 0:t.map(e=>({requestId:e.requestId,requestSeqNo:e.seqNo,itemId:e.itemId,qty:e.transferNow,muId:(null==e?void 0:e.muId)||null})),n={dtId:(null==e?void 0:e.dtId)||null,fromSiteId:null==e?void 0:e.fromSiteId,date:(0,O.ku)(null==e?void 0:e.date),workCenterId:(null==e?void 0:e.workCenterId)||null,items:r},s=await N({extension:T.I.ConsumptionOfTools.generate,record:JSON.stringify(n)});S.ZP.success(G.Generated),k({Component:b.Z,props:{recordId:s.recordId}}),Q()}}),H=[{component:"checkbox",name:"isChecked",label:" ",flex:.3,checkAll:{visible:!1,onChange(e){let{checked:t}=e,r=V.values.items.map(e=>{let{isChecked:r,...n}=e;return{...n,isChecked:t,transferNow:t?n.qty:0}});V.setFieldValue("items",r)}},async onChange(e){let{row:{update:t,newRow:r}}=e;t({transferNow:(null==r?void 0:r.isChecked)?null==r?void 0:r.qty:0})}},{component:"textfield",label:E.requestRef,name:"requestRef",flex:1,props:{readOnly:!0}},{component:"textfield",label:E.siteRef,name:"siteRef",flex:1,props:{readOnly:!0}},{component:"textfield",label:E.site,name:"siteName",flex:1,props:{readOnly:!0}},{component:"date",name:"requestDate",flex:1,label:null==E?void 0:E.date,props:{readOnly:!0}},{component:"textfield",label:E.sku,name:"sku",flex:1,props:{readOnly:!0}},{component:"textfield",label:E.itemName,name:"itemName",flex:1,props:{readOnly:!0}},{component:"numberfield",name:"onHandGlobal",label:E.onHandGlobal,flex:1,props:{readOnly:!0}},{component:"numberfield",name:"onHandSite",label:E.onHandSite,flex:1,props:{readOnly:!0}},{component:"numberfield",name:"qty",label:E.qty,flex:1,props:{readOnly:!0}},{component:"numberfield",name:"deliveredQty",label:E.delivered,flex:1,props:{readOnly:!0}},{component:"numberfield",name:"balance",label:E.balance,flex:1,props:{readOnly:!0}},{component:"numberfield",name:"transferNow",label:E.transferNow,flex:1,propsReducer(e){let{row:t,props:r}=e;return{...r,readOnly:!(null==t?void 0:t.isChecked)}},updateOn:"blur",async onChange(e){let{row:{update:t,newRow:r}}=e,n=null==r?void 0:r.transferNow;t({transferNow:n>=0&&n<(null==r?void 0:r.qty)?n:null==r?void 0:r.qty})}}];async function Q(e){var t;if(!Z)return;let r=await L({extension:T.I.OrderItem.open,parameters:"_reference=".concat(e||"","&_siteId=0&_fromSiteId=").concat(V.values.fromSiteId||0,"&_workCenterId=").concat(V.values.workCenterId||0)});r.list=null==r?void 0:null===(t=r.list)||void 0===t?void 0:t.map((e,t)=>({...e,id:t+1,requestDate:e.requestDate?(0,O.a1)(e.requestDate):null,balance:e.qty||0-e.deliveredQty||0,onHandGlobal:parseFloat(null==e?void 0:e.onhandGlobal).toFixed(2)||0,onHandSite:parseFloat(null==e?void 0:e.onhandSite).toFixed(2)||0,qty:parseFloat(null==e?void 0:e.qty).toFixed(2),transferNow:0})),V.setFieldValue("items",r.list)}return(0,l.useEffect)(()=>{Z&&V.setFieldValue("fromSiteId",Z)},[Z]),(0,l.useEffect)(()=>{Q()},[V.values.fromSiteId,V.values.workCenterId]),(0,n.jsx)(y.Z,{onSave:V.handleSubmit,isSaved:!1,actions:[{key:"GenerateJob",condition:!0,onClick:()=>{V.handleSubmit()}}],maxAccess:j,fullSize:!0,children:(0,n.jsxs)(s.R,{children:[(0,n.jsx)(i.g,{children:(0,n.jsxs)(c.ZP,{container:!0,spacing:2,p:2,children:[(0,n.jsx)(c.ZP,{item:!0,xs:2,children:(0,n.jsx)(g.Z,{endpointId:v.r.DocumentType.qry,parameters:"_startAt=0&_pageSize=1000&_dgId=".concat(I.J.WorkCenterConsumption),name:"dtId",label:E.documentType,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],valueField:"recordId",displayField:["reference","name"],values:V.values,displayFieldWidth:1.5,maxAccess:j,onChange:async(e,t)=>{V.setFieldValue("dtId",(null==t?void 0:t.recordId)||null)},error:V.touched.dtId&&!!V.errors.dtId})}),(0,n.jsx)(c.ZP,{item:!0,xs:2,children:(0,n.jsx)(C.Z,{name:"date",label:E.date,value:null==V?void 0:null===(r=V.values)||void 0===r?void 0:r.date,onChange:V.setFieldValue,readOnly:!0,required:!0,maxAccess:j,onClear:()=>V.setFieldValue("date",null),error:V.touched.date&&!!V.errors.date})}),(0,n.jsx)(c.ZP,{item:!0,xs:2,children:(0,n.jsx)(g.Z,{endpointId:R.$.Site.qry,name:"fromSiteId",readOnly:!0,required:!0,label:E.fromSite,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:V.values,valueField:"recordId",displayField:["reference","name"],maxAccess:j,onChange:(e,t)=>{V.setFieldValue("fromSiteId",(null==t?void 0:t.recordId)||null)},error:V.touched.fromSiteId&&!!V.errors.fromSiteId})}),(0,n.jsx)(c.ZP,{item:!0,xs:3,children:(0,n.jsx)(P.U,{endpointId:x.u.WorkCenter.snapshot,valueField:"reference",displayField:"name",name:"workCenterId",label:E.workCenter,form:V,firstValue:V.values.wcRef,secondValue:V.values.wcName,errorCheck:"workCenterId",required:!0,maxAccess:j,displayFieldWidth:2,onChange:(e,t)=>{if(!Z){B({message:E.selectFromSite});return}V.setFieldValue("wcRef",(null==t?void 0:t.reference)||""),V.setFieldValue("wcName",(null==t?void 0:t.name)||""),V.setFieldValue("workCenterId",(null==t?void 0:t.recordId)||null)}})}),(0,n.jsx)(c.ZP,{item:!0,xs:2,children:(0,n.jsx)(D.Z,{name:"reference",label:E.reference,value:null==V?void 0:null===(A=V.values)||void 0===A?void 0:A.reference,maxAccess:j,onBlur:e=>{if(!Z){B({message:E.selectFromSite});return}let t=e.target.value;Q(t),V.setFieldValue("reference",t)},onClear:()=>V.setFieldValue("reference",""),onChange:V.handleChange,error:V.touched.reference&&!!V.errors.reference})})]})}),(0,n.jsx)(a.Q,{children:(0,n.jsx)(h._,{onChange:e=>V.setFieldValue("items",e),value:null===(F=V.values)||void 0===F?void 0:F.items,error:null===(J=V.errors)||void 0===J?void 0:J.items,columns:H,disabled:!1,allowDelete:!1,allowAddNewLine:!1,maxAccess:j,name:"items"})})]})})}},58912:function(e,t,r){"use strict";r.d(t,{I:function(){return s}});let n="IR.asmx/",s={ReplenishmentGroups:{qry:n+"qryGRP",page:n+"pageGRP",get:n+"getGRP",set:n+"setGRP",del:n+"delGRP"},IvReplenishements:{qry:n+"qryHDR",page:n+"pageHDR",get:n+"getHDR",set:n+"setHDR"},IvReplenishementsList:{qry:n+"qryTRX"},GenerateIvReplenishements:{generate:n+"generateTFR"},MaterialReplenishment:{page:n+"pageREQ",del:n+"delREQ",get:n+"getREQ",set2:n+"set2REQ",snapshot:n+"snapshotREQ",close:n+"closeREQ",reopen:n+"reopenREQ",cancel:n+"cancelREQ",print:n+"printREQ"},OrderItem:{qry:n+"qryREI",open:n+"openREI"},MatPlanning:{page:n+"pageMPL",del:n+"delMPL",get:n+"getMPL",set2:n+"set2MPL",reopen:n+"reopenMPL",close:n+"closeMPL",qry:n+"qryMPL",snapshot:n+"snapshotMPL"},MatPlanningItem:{qry:n+"qryMPI",append:n+"appendMPI"},PurchaseRequest:{generate:n+"generatePR"},PlantSettings:{get:n+"getPLT",set:n+"setPLT",del:n+"delPLT"},DocumentTypeDefault:{get:n+"getDTD",set:n+"setDTD",del:n+"delDTD",page:n+"pageDTD"},materialPlaning:{preview:n+"previewMRP"},Transfer:{generate2:n+"generate2TFR"},ConsumptionOfTools:{generate:n+"generateMFCON"}}},90587:function(e,t,r){"use strict";r.d(t,{u:function(){return s}});let n="MF.asmx/",s={DesignRawMaterial:{qry2:n+"qryDRM2",qry:n+"qryDRM",set2:n+"set2DRM"},JobOrdersItem:{qry:n+"qryJIT",set2:n+"set2JIT"},IssueOfMaterialsItems:{qry:n+"qryIMI",qry2:n+"qryIMI2"},LaborGroup:{snapshot:n+"snapshotLBG",page:n+"pageLBG",qry:n+"qryLBG",set:n+"setLBG",get:n+"getLBG",del:n+"delLBG"},ProductionLine:{page:n+"pageLIN",qry:n+"qryLIN",qry2:n+"qry2LIN",qry3:n+"qry3LIN",set:n+"setLIN",get:n+"getLIN",del:n+"delLIN"},CostGroup:{page:n+"pageCG",set:n+"setCG",get:n+"getCG",del:n+"delCG",qry:n+"qryCG"},WorkCenter:{page:n+"pageWCT",qry:n+"qryWCT",qry3:n+"qryWCT3",set:n+"setWCT",get:n+"getWCT",del:n+"delWCT",snapshot:n+"snapshotWCT"},Routing:{page:n+"pageRTN",qry:n+"qryRTN",set:n+"setRTN",get:n+"getRTN",del:n+"delRTN",snapshot2:n+"snapshot2RTN",snapshot:n+"snapshotRTN"},Operation:{snapshot:n+"snapshotOPR",qry:n+"qryOPR",page:n+"pageOPR",set:n+"setOPR",get:n+"getOPR",del:n+"delOPR"},Labor:{page:n+"pageLBR",qry:n+"qryLBR",qry2:n+"qry2LBR",set:n+"setLBR",get:n+"getLBR",del:n+"delLBR",snapshot:n+"snapshotLBR"},Machine:{page:n+"pageMAC",qry:n+"qryMAC",set:n+"setMAC",get:n+"getMAC",del:n+"delMAC",snapshot:n+"snapshotMAC"},MachineSpecification:{page:n+"pageMAS",qry:n+"qryMAS",set:n+"setMAS",get:n+"getMAS",del:n+"delMAS"},LeanProductionPlanning:{preview:n+"previewPQ",update:n+"updatePQ",snapshot:n+"snapshotPQ",del:n+"delPQ",cancel:n+"cancelPQ"},MaterialsAdjustment:{generate:n+"generateADJ"},ProductionClass:{page:n+"pageCLS",qry:n+"qryCLS",set:n+"setCLS",get:n+"getCLS",del:n+"delCLS",snapshot:n+"qryCLS"},ProductionStandard:{qry:n+"qrySTD",page:n+"pageSTD",set:n+"setSTD",get:n+"getSTD",del:n+"delSTD"},ProductionClassSemiFinished:{qry:n+"qryCSF",set:n+"setCSF",get:n+"getCSF",del:n+"delCSF",set2:n+"set2CSF"},RoutingSequence:{set2:n+"set2RTS",qry:n+"qryRTS"},Overhead:{qry:n+"qryOVH",set:n+"setOVH",get:n+"getOVH",del:n+"delOVH",page:n+"pageOVH",snapshot:n+"snapshotOVH"},Design:{qry:n+"qryDES",set:n+"setDES",get:n+"getDES",del:n+"delDES",snapshot:n+"snapshotDES",page:n+"pageDES"},MFJobOrder:{pack:n+"packJOB",qry:n+"qryJOB",qry2:n+"qryJOB2",set:n+"setJOB",get:n+"getJOB",get2:n+"get2JOB",del:n+"delJOB",snapshot:n+"snapshotJOB",snapshot2:n+"snapshotJOB2",snapshot3:n+"snapshotJOB3",cancel:n+"cancelJOB",post:n+"postJOB",start:n+"startJOB",stop:n+"stopJOB",wip:n+"wipJOB",sync:n+"syncJOB"},ProductionSheet:{page:n+"pagePST",qry:n+"qryPST",get:n+"getPST",set2:n+"set2PST",get2:n+"get2PST",del:n+"delPST",post:n+"postPST",unpost:n+"unpostPST",snapshot:n+"snapshotPST"},ProductionSheetItem:{qry:n+"qryPSI",set:n+"setPSI",get:n+"getPSI",del:n+"delPSI"},DocumentTypeDefault:{qry:n+"qryDTD",get:n+"getDTD",set:n+"setDTD",del:n+"delDTD",page:n+"pageDTD"},RawMaterialCategory:{qry:n+"qryRMC",get:n+"getRMC",set:n+"setRMC",del:n+"delRMC",page:n+"pageRMC"},WorksheetMaterials:{qry:n+"qryIMA",get:n+"getIMA",pack:n+"get2IMA",set:n+"setIMA",set2:n+"set2IMA",del:n+"delIMA",post:n+"postIMA"},ProductionSheetQueue:{qry:n+"qryPSQ"},Damage:{qry:n+"qryDMG",get:n+"getDMG",set:n+"setDMG",del:n+"delDMG",page:n+"pageDMG",snapshot:n+"snapshotDMG",post:n+"postDMG",get2:n+"get2DMG",set2:n+"set2DMG",preview:n+"previewDMG"},JobCategory:{qry:n+"qryJCA"},JobRouting:{qry:n+"qryJRO",get:n+"getJRO",set:n+"setJRO",set2:n+"set2JRO",del:n+"delJRO",sync:n+"syncJRO",close:n+"closeJRO",reopen:n+"reopenJRO"},Worksheet:{snapshot:n+"snapshotWST",get:n+"getWST",pack:n+"getPackWST",set:n+"setWST",del:n+"delWST",page:n+"pageWST",summary:n+"summaryWST",post:n+"postWST",qry2:n+"qryWST2",draft:n+"draftWST"},JobOverhead:{qry:n+"qryJOH",set2:n+"set2JOH",generate:n+"generateJOH"},JobMaterial:{qry:n+"qryJMA"},JobItemSize:{qry:n+"qryJSZ",set2:n+"set2JSZ"},MFSerial:{qry:n+"qrySRL",qry2:n+"qrySRL2",set2:n+"set2SRL",generate:n+"generateSRL"},SamplePack:{qry:n+"qrySPL",set2:n+"set2SPL"},DamageReturn:{get:n+"getDMR",set:n+"setDMR",del:n+"delDMR",page:n+"pageDMR",snapshot:n+"snapshotDMR",post:n+"postDMR"},ProductionOrder:{get2:n+"get2PO",set2:n+"set2PO",del:n+"delPO",page:n+"pagePO",snapshot:n+"snapshotPO",post:n+"postPO",gen:n+"genPO",close:n+"closePO"},BillOfMaterials:{get:n+"getBMA",qry2:n+"qry2BMA",set:n+"setBMA",del:n+"delBMA",page:n+"pageBMA",snapshot:n+"snapshotBMA"},Component:{get:n+"getBMI",qry:n+"qryBMI",del:n+"delBMI",set:n+"setBMI",set2:n+"set2BMI"},Assembly:{get:n+"getASM",set2:n+"set2ASM",del:n+"delASM",page:n+"pageASM",snapshot:n+"snapshotASM",post:n+"postASM",unpost:n+"unpostASM",generate:n+"genASM"},AssemblyItems:{qry:n+"qryASC"},AssemblyLot:{get:n+"getASL",set:n+"setASL"},AssemblyOverhead:{qry:n+"qryAOH",set2:n+"set2AOH"},MeasurementScheduleMap:{qry:n+"qryMSM",set:n+"setMSM",set2:n+"set2MSM",del:n+"delMSM"},JobCategory:{set:n+"setJCA",get:n+"getJCA",del:n+"delJCA",page:n+"pageJCA",qry:n+"qryJCA"},DesignGroup:{qry:n+"qryDEG",set:n+"setDEG",get:n+"getDEG",del:n+"delDEG",page:n+"pageDEG"},Components:{qry:n+"qryDEM",set2:n+"set2DEM"},DesignFamily:{qry:n+"qryDEF",set:n+"setDEF",get:n+"getDEF",del:n+"delDEF",page:n+"pageDEF"},ProductionShifts:{qry:n+"qrySHI",set:n+"setSHI",get:n+"getSHI",del:n+"delSHI",page:n+"pageSHI"},JobOrderWizard:{set2:n+"set2JOZ",get2:n+"get2JOZ",del:n+"delJOZ",page:n+"pageJOZ",snapshot:n+"snapshotJOZ",post:n+"postJOZ"},JobTransfer:{get2:n+"get2TFR",set2:n+"set2TFR",del:n+"delTFR",page:n+"pageTFR",snapshot:n+"snapshotTFR",post:n+"postTFR",close:n+"closeTFR",reopen:n+"reopenTFR",qry:n+"qryTFR"},JobWorkCenter:{qry:n+"qryJWC",close:n+"closeJWC",reopen:n+"reopenJWC",get:n+"getJWC",snapshot:n+"snapshotJWC",verify:n+"verifyJWC"},WorkCenterConsumption:{page:n+"pageCON",snapshot:n+"snapshotCON",del:n+"delCON",set2:n+"set2CON",get:n+"getCON",post:n+"postCON",unpost:n+"unpostCON",close:n+"closeCON",reopen:n+"reopenCON"},ConsumptionItemView:{qry:n+"qryCOI"},LineItemCapacity:{set2:n+"set2LIT",del:n+"delLIT",qry:n+"qryLIT",page:n+"pageLIT"},CostGroupOverhead:{set2:n+"set2CGV",qry:n+"qryCGV"},IssueOfMaterialDimension:{set:n+"setIMD",qry:n+"qryIMD"},JobOrder:{gen:n+"genORD"},RefreshPoItem:{refresh:n+"refreshPOI"},WorkCenterTransferMap:{qry:n+"qryWCTM",set2:n+"set2WCTM"},BatchWorksheet:{get2:n+"get2BWST",set2:n+"set2BWST",del:n+"delBWST",page:n+"pageBWST",snapshot:n+"snapshotBWST",post:n+"postBWST",gen:n+"genBWST",close:n+"closeBWST",reopen:n+"reopenBWST"},ProductionOrderFromSaleOrder:{gen:n+"generatePOFromSO"},BatchTransfer:{page:n+"pageBTFR",set2:n+"set2BTFR",del:n+"delBTFR",snapshot:n+"snapshotBTFR",get:n+"getBTFR",post:n+"postBTFR",unpost:n+"unpostBTFR"},BatchTransferJob:{qry:n+"qryBTFJ"},Disposal:{page:n+"pageDIS",snapshot:n+"snapshotDIS",get:n+"getDIS",set2:n+"set2DIS",del:n+"delDIS"},DisposalItem:{qry:n+"qryDII"},DisposalSerial:{qry:n+"qryDISRL"},MetalSetting:{page:n+"pageMTS",set:n+"setMTS",get:n+"getMTS",del:n+"delMTS"},DamageReason:{qry:n+"qryDRS",page:n+"pageDRS",set:n+"setDRS",get:n+"getDRS",del:n+"delDRS",snapshot:n+"snapshotDRS"},DamageCategory:{qry:n+"qryDCA",page:n+"pageDCA",set:n+"setDCA",get:n+"getDCA",del:n+"delDCA",snapshot:n+"snapshotDCA"}}},67920:function(e,t,r){"use strict";r.d(t,{m:function(){return s}});var n=r(48601);function s(e,t,r){var s;let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"items",l={...e};return null==r||null===(s=r.record)||void 0===s||s.controls.forEach(e=>{let{controlId:t,accessLevel:r}=e,[n,s]=null==t?void 0:t.split(".");n!==a||2!==r||s in l||(l[s]=e=>(null==e?void 0:e[s])!=null),(1===r||4===r)&&s in l&&delete l[s]}),{schema:n.Ry().shape({...Object.keys(l).reduce((e,r)=>(e[r]=n.nK().nullable().test(function(e){var n;let s=this.parent,[,a]=this.path.match(/^(\w+)\[(\d+)\]/)||[],o=(null===(n=this.options.context)||void 0===n?void 0:n[a])||[];if(t||!t&&o.length>1){if(null!==s[r]&&void 0!==s[r]&&0!==s[r]&&""!==l[r]&&!l[r](s))return!1;if(!Object.entries(l).some(e=>{let[,t]=e;return!!t(s)}))return!0}return!!l[r](s)&&void 0!==e}),e),{})}),requiredFields:l}}},1685:function(e,t,r){"use strict";r.d(t,{m:function(){return n}});let n=e=>{let t=window.sessionStorage.getItem(e);return t?JSON.parse(t):null}},98345:function(e,t,r){"use strict";r.d(t,{H:function(){return m},G:function(){return y}});var n=r(45300),s=r(2784),a=r(96026),l=r(38449);r(26612);var o=r(65947),d=r(1685);let i=async(e,t,r)=>{try{let n=await e({extension:t,parameters:r});return t.includes("qry")?n:n.record}catch(e){return null}},c=(e,t,r,n)=>{let s=(e=JSON.parse(JSON.stringify(e))).record.controls,a=s.find(e=>"reference"===e.controlId);return a?a.accessLevel=(null==t?void 0:t.mandatory)?o.$7:o.rr:(null==t?void 0:t.mandatory)?s.push({sgId:0,resourceId:"",controlId:"".concat(n?n+".":"","reference"),accessLevel:(null==t?void 0:t.mandatory)?o.$7:o.rr}):(null==t?void 0:t.readOnly)?s.push({sgId:0,resourceId:"",controlId:"".concat(n?n+".":"","reference"),accessLevel:(null==t?void 0:t.readOnly)?o.rr:o.$7}):s=e.record.controls.filter(e=>"reference"!=e.controlId),r&&s.push({sgId:0,resourceId:"",controlId:"".concat(n?n+".":"","dtId"),accessLevel:o.$7}),{...e,record:{...e.record,controls:s}}},u=async(e,t,r)=>{let n,s;switch(r){case"dtId":let a=(0,d.m)("userData"),o=null==a?void 0:a.userId;s="_userId=".concat(o,"&_functionId=").concat(t),n=l.r.UserFunction.get;break;case"glbSysNumberRange":s="_recordId=".concat(t),n=l.r.SystemFunction.get;break;case"DocumentType":s="_dgId=".concat(t,"&_startAt=",0,"&_pageSize=",50),n=l.r.DocumentType.qry;break;case"DcTypNumberRange":s="_recordId=".concat(t),n=l.r.DocumentType.get;break;case"isExternal":s="_recordId=".concat(t),n=l.r.NumberRange.get;break;default:return null}return await i(e,n,s)},p=async function(e){let t,r,n,s,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,l=arguments.length>2?arguments[2]:void 0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,d=!(arguments.length>4)||void 0===arguments[4]||arguments[4],i=arguments.length>5?arguments[5]:void 0,p=void 0===o&&a&&await u(e,a,"dtId"),g=null==p?void 0:p.dtId,y="",m=!0;if(p&&void 0===o||"nraId"===o){if(g){let r=await u(e,g,"DcTypNumberRange");t=null==r?void 0:r.nraId,m=!((null==r?void 0:r.activeStatus)<0),t||(y="Assign the document type to a number range")}if((!g||!m)&&d&&a){var f;let t=await u(e,a,"DocumentType");s=(null==t?void 0:null===(f=t.list)||void 0===f?void 0:f.filter(e=>(null==e?void 0:e.activeStatus)===1).length)>0}}if(("nraId"===o||void 0===o)&&a){if((!g||g)&&!t||t&&!m){let r=await u(e,a,"glbSysNumberRange");(t=null==r?void 0:r.nraId)&&s&&(s=!1),m=!0}y=t||s?"":"Assign the system Function to a number range"}o>0&&!t&&(t=o),t&&m?(r={readOnly:null==(n=await u(e,t,"isExternal"))||!n.external,mandatory:null!=n&&!!n.external},l&&(l=await c(l,r,s,i))):!t&&l&&(l=await c(l,r,s,i));let h=i?"".concat(i,".reference"):"reference";return{dtId:g,resetReference:null==r?void 0:r.readOnly,dcTypeRequired:s,reference:{fieldName:h,isEmpty:(null==n?void 0:n.external)!==void 0&&(null==n||!n.external)},errorMessage:y,maxAccess:l,selectNraId:o}};var g=r(65950);function y(e){let{functionId:t,action:r,hasDT:n}=e,{getRequest:l}=(0,s.useContext)(g.$),{stack:o}=(0,a.V)();return{proxyAction:async()=>{let e=await p(l,t,"",void 0,n);(null==e?void 0:e.errorMessage)?o({message:null==e?void 0:e.errorMessage}):await r()}}}function m(e){var t;let{functionId:r,access:l,hasDT:o,enabled:d=!0,objectName:i=""}=e,{getRequest:c}=(0,s.useContext)(g.$),{stack:u}=(0,a.V)(),[y,m]=(0,s.useState)(),f=async e=>{let t=await p(c,r,l,e,o,i);if(!t.errorMessage)return t;u({message:null==t?void 0:t.errorMessage})},h=(0,n.a)({retry:!1,staleTime:0,enabled:d,queryKey:[r,y,!!l,d],queryFn:y||"nraId"===y?()=>f(y):()=>f()});return{documentType:h.data,maxAccess:(null==h?void 0:null===(t=h.data)||void 0===t?void 0:t.maxAccess)||l,changeDT(e){m((null==e?void 0:e.nraId)||"nraId")}}}},9657:function(e,t,r){"use strict";var n=r(52322),s=r(2784),a=r(60218),l=r(62202),o=r(33625),d=r(62362),i=r(31389),c=r(27723),u=r(5088),p=r(69387),g=r(39812),y=r(65950),m=r(38449),f=r(96026),h=r(21326),S=r(19473),q=r(54074),v=r(69627);let I=e=>{let[t,r,n]=e.split("/").map(e=>parseInt(e,10));return new Date(Date.UTC(n<100?2e3+n:n,r-1,t,0,0,0)).toISOString().split(".")[0]+"Z"},C=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(""===e)return e;switch(t){case 2:return parseInt(e,10);case 3:return parseFloat(e);case 5:return r?I(e):(0,g.L6)((0,g.p6)(e));default:return e}},R=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],n=e.split("\n").filter(e=>e.trim());if(!n.length)return{count:0,list:[]};let s=n[0].split(",").map(e=>e.trim()),a=t.reduce((e,t)=>(e[t.headerName]=t,e),{}),l=s.map(e=>a[e]),o=n.slice(1).map((e,t)=>{let n=e.split(",").map(e=>e.trim()),a=l.reduce((e,t,r)=>{let a=s[r];return t?e[t.field]=C(n[r],t.dataType):e[a]=n[r],e},{recordId:t+1});return r.forEach(e=>{s.includes(e.field),a[e.field]=e.value}),a.minPrice&&(a.minPrice=parseFloat(a.minPrice)||0),a});return{count:o.length,list:o}},D=(e,t,r)=>{let n=t.filter(e=>e.mandatory),s=[...new Set(e.flatMap(e=>n.filter(t=>null===e[t.field]||void 0===e[t.field]||""===e[t.field]).map(e=>e.headerName)))];return!s.length||(r({message:"".concat(s.join(", ")," ").concat(s.length>1?"are":"is"," mandatory.")}),!1)},T=(e,t,r)=>{let n=t.filter(e=>e.mandatory),s=e.list.flatMap(e=>n.filter(t=>null===e[t.field]||void 0===e[t.field]||""===e[t.field]).map(e=>e.headerName));if(s.length>0){let e=[...new Set(s)];r({message:"".concat(e.join(", ")," ").concat(e.length>1?"are":"is"," mandatory field").concat(e.length>1?"s":"",".")})}return e.list.map(e=>Object.keys(e).reduce((r,n)=>{let s=t.find(e=>e.field===n),a=e[n];return a=""===a?null:a,r[n]=s?C(a,s.dataType,!0):a,r},{}))},O=e=>{var t;let{staticColumns:r=[],onSuccess:g,resourceId:I,access:C,window:O}=e,{stack:M}=(0,f.V)(),{getRequest:P,postRequest:x}=(0,s.useContext)(y.$),{platformLabels:b}=(0,s.useContext)(S.l),[w,A]=(0,s.useState)(null),[F,J]=(0,s.useState)({count:0,list:[]}),[k,L]=(0,s.useState)(null),N=(0,s.useRef)(null);if((0,h.Z)({title:b.import,window:O}),(0,s.useEffect)(()=>{I&&P({extension:m.r.ETL.get,parameters:"_resourceId=".concat(I)}).then(e=>{e.record&&A(e)})},[I]),!(null==w?void 0:w.record))return null;let B=(null===(t=w.record.fields)||void 0===t?void 0:t.map(e=>{let{name:t,dataType:r,format:n,...s}=e;return{field:t,headerName:t,width:130,type:2===r&&"1"===n||3===r?"number":void 0,dataType:r,...s}}))||[],G=B.map(e=>e.field),W=[...r.filter(e=>!G.includes(e.field)).map(e=>({field:e.field,headerName:e.field,width:130,dataType:1,readOnly:!0})),...B],E=w.record.objectName,j=w.record.endPoint,Z=async()=>{let e=D(F.list,W,M),t=T(F,W,M);if(!e)return;let r=await x({extension:j,record:JSON.stringify({[E]:t})});null==g||g(r),l.ZP.success(b.Imported),O&&O.close()},_=[{key:"Import",condition:!0,onClick:Z,disabled:!(null==k?void 0:k.name)}];return(0,n.jsx)(q.Z,{onSave:Z,disabledSubmit:!(null==k?void 0:k.name),isSaved:!1,actions:_,maxAccess:C,isParentWindow:!1,children:(0,n.jsxs)(i.R,{children:[(0,n.jsx)(o.g,{children:(0,n.jsx)(c.Z,{leftSection:(0,n.jsx)(a.ZP,{container:!0,spacing:2,alignItems:"center",children:(0,n.jsx)(a.ZP,{item:!0,xs:4,children:(0,n.jsxs)(a.ZP,{item:!0,sx:{display:"flex",mr:2},children:[(0,n.jsx)(u.Z,{name:"name",label:null==b?void 0:b.SelectCSV,value:null==k?void 0:k.name,readOnly:!0,disabled:!!(null==k?void 0:k.name)}),(0,n.jsx)(v.Z,{label:"".concat(null==b?void 0:b.Browse,"..."),disabled:!!(null==k?void 0:k.name),onClick:()=>N.current.click(),style:{marginLeft:2}}),(0,n.jsx)("input",{type:"file",accept:".csv",ref:N,style:{display:"none"},onChange:e=>{let t=e.target.files[0];if(L(t),t){let e=new FileReader;e.onload=e=>{J(R(e.target.result,W,r))},e.readAsText(t)}}}),(0,n.jsx)(v.Z,{image:"clear.png",tooltipText:null==b?void 0:b.Clear,onClick:()=>{L(null),J({count:0,list:[]}),N.current&&(N.current.value=null)},style:{marginLeft:2,backgroundColor:"#f44336",padding:0}})]})})})})}),(0,n.jsx)(d.Q,{children:(0,n.jsx)(p.Z,{name:"import",columns:[{field:"recordId",headerName:"",width:130},...W],gridData:F,rowId:["recordId"],isLoading:!1,pageSize:50,paginationType:"api",pagination:!1,maxAccess:C,textTransform:!0})})]})})};O.width=1e3,O.height=600,t.Z=O}},function(e){e.O(0,[84622,49774,92888,40179],function(){return e(e.s=83517)}),_N_E=e.O()}]);