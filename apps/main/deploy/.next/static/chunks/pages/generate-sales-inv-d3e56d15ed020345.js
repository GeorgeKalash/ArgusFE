(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[86515],{41116:function(e,l,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/generate-sales-inv",function(){return n(6921)}])},6921:function(e,l,n){"use strict";n.r(l),n.d(l,{default:function(){return O}});var a=n(52322),t=n(2784),d=n(48601),i=n(8661),r=n(65950),s=n(69387),o=n(71987),c=n(60218),u=n(26612),v=n(80983),p=n(31389),m=n(33625),I=n(62362),g=n(19473),h=n(91406),f=n(61802),x=n(69627),y=n(7121),R=n(27423),T=n(38449),V=n(22341),P=n(30043),D=n(21581),j=n(89330),Z=n(54074);function w(e){var l;let{labels:n,access:t,values:r,setValues:s,window:o}=e,{formik:u}=(0,v.c)({initialValues:{date:(null==r?void 0:r.date)||new Date,plantId:null==r?void 0:r.plantId,description:null==r?void 0:r.description},maxAccess:t,validateOnChange:!0,validationSchema:d.Ry({date:d.Z_().required()}),onSubmit:async e=>{s({...r,date:e.date,plantId:e.plantId,description:e.description}),o.close()}});return(0,a.jsx)(Z.Z,{onSave:u.handleSubmit,maxAccess:t,children:(0,a.jsx)(p.R,{children:(0,a.jsx)(I.Q,{children:(0,a.jsxs)(c.ZP,{container:!0,spacing:2,children:[(0,a.jsx)(c.ZP,{item:!0,xs:12,children:(0,a.jsx)(j.Z,{name:"date",required:!0,label:n.date,value:null==u?void 0:null===(l=u.values)||void 0===l?void 0:l.date,onChange:u.setFieldValue,maxAccess:t,onClear:()=>u.setFieldValue("date",null),error:u.touched.date&&!!u.errors.date})}),(0,a.jsx)(c.ZP,{item:!0,xs:12,children:(0,a.jsx)(i.Z,{endpointId:T.r.Plant.qry,name:"plantId",label:n.plant,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:u.values,valueField:"recordId",displayField:["reference","name"],maxAccess:t,onChange:(e,l)=>{u.setFieldValue("plantId",null==l?void 0:l.recordId)},error:u.touched.plantId&&!!u.errors.plantId})}),(0,a.jsx)(c.ZP,{item:!0,xs:12,children:(0,a.jsx)(D.Z,{name:"description",label:n.description,value:u.values.description,rows:2,maxAccess:t,onChange:e=>u.setFieldValue("description",e.target.value),onClear:()=>u.setFieldValue("description",""),error:u.touched.description&&!!u.errors.description})})]})})})})}var F=n(39812),b=n(62202),k=n(79590),N=n(19689),O=()=>{var e,l,n,D,j;let{getRequest:O,postRequest:q}=(0,t.useContext)(r.$),{platformLabels:C,defaultsData:A}=(0,t.useContext)(g.l),{stack:S,LockRecord:_}=(0,f.zY)(),{labels:E,access:B}=(0,o.J)({datasetId:u.i.GenerateInvoices}),{labels:L,access:H}=(0,o.J)({datasetId:u.i.SalesInvoice}),G=parseInt(null==A?void 0:null===(l=A.list)||void 0===l?void 0:null===(e=l.find(e=>{let{key:l}=e;return"currencyId"===l}))||void 0===e?void 0:e.value),J={clientId:d.Rx().required(),currencyId:d.Rx().required()},[U,W]=(0,t.useState)(J),{formik:z}=(0,v.c)({initialValues:{clientId:null,clientRef:"",clientName:"",applyVAT:!1,currencyId:G,spId:0,dtId:null,amount:0,date:null,plantId:null,description:"",data:{list:[]}},validationSchema:d.Ry(U),maxAccess:B,validateOnChange:!0,onSubmit:async e=>{var l,n;let{data:a,amount:t,clientRef:d,clientName:i,date:r,spId:s,...o}=e,c={...o,date:(0,F.ku)(r||new Date),spId:s||null,deliveryOrders:(null==a?void 0:null===(n=a.list)||void 0===n?void 0:null===(l=n.filter(e=>e.checked))||void 0===l?void 0:l.map(e=>parseInt(e.orderId)))||[]},u=await q({extension:P.U.Invoice.generateInv,record:JSON.stringify(c)});Y(),u.recordId&&(b.ZP.success(C.Generated),await M(u.recordId))}});async function M(e){S({Component:k.Z,props:{labels:L,recordId:e,access:H,functionId:y.J.SalesInvoice,getResourceId:()=>u.i.SalesInvoice,LockRecord:_},title:L.salesInvoice})}async function Q(){S({Component:w,props:{labels:E,access:B,values:null==z?void 0:z.values,setValues:null==z?void 0:z.setValues},width:500,height:300,title:E.edit})}let X=[{field:"doRef",headerName:E.doRef,flex:1},{field:"doDate",headerName:E.doDate,type:"date",flex:1},{field:"qty",headerName:E.qty,type:{field:"number",decimal:2},flex:1},{field:"soRef",headerName:E.soRef,flex:1},{field:"soDate",headerName:E.soDate,flex:1,type:"date"},{field:"amountBeforeVat",headerName:E.amountBeforeVat,type:{field:"number",decimal:2},flex:1},{field:"vatAmount",headerName:E.vatAmount,type:{field:"number",decimal:2},flex:1},{field:"amountAfterVat",headerName:E.amountAfterVat,type:{field:"number",decimal:2},flex:1}],Y=async()=>{var e,l,n;if(W(J),Object.keys(await z.validateForm()).length){let e=Object.keys(await z.validateForm()).reduce((e,l)=>(e[l]=!0,e),{});z.setTouched(e,!0);return}let a=await O({extension:P.U.Invoice.preview,parameters:"_clientId=".concat(null==z?void 0:null===(e=z.values)||void 0===e?void 0:e.clientId,"&_currencyId=").concat(null==z?void 0:null===(l=z.values)||void 0===l?void 0:l.currencyId,"&_spId=").concat(null==z?void 0:null===(n=z.values)||void 0===n?void 0:n.spId)});z.setFieldValue("data",{list:(null==a?void 0:a.list)||[]}),z.setFieldValue("amount",0)},$=async()=>{if(W({...J,dtId:d.Rx().required()}),Object.keys(await z.validateForm()).length){let e=Object.keys(await z.validateForm()).reduce((e,l)=>(e[l]=!0,e),{});z.setTouched(e,!0);return}z.handleSubmit()};async function K(e){if(e){var l;let n=await O({extension:V.P.DocumentTypeDefault.get,parameters:"_dtId=".concat(e)});z.setFieldValue("plantId",null==n?void 0:null===(l=n.record)||void 0===l?void 0:l.plantId)}}return(0,a.jsx)(Z.Z,{onSave:$,isSaved:!1,maxAccess:B,fullSize:!0,children:(0,a.jsxs)(p.R,{children:[(0,a.jsx)(m.g,{children:(0,a.jsxs)(c.ZP,{container:!0,spacing:2,p:2,children:[(0,a.jsx)(c.ZP,{item:!0,xs:5,children:(0,a.jsx)(R.U,{endpointId:V.P.Client.snapshot,valueField:"reference",displayField:"name",secondFieldLabel:E.name,name:"clientId",label:E.client,form:z,required:!0,displayFieldWidth:2,valueShow:"clientRef",secondValueShow:"clientName",maxAccess:H,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"},{key:"flName",value:"Foreign Language"}],onChange:async(e,l)=>{if(z.setFieldValue("clientName",null==l?void 0:l.name),z.setFieldValue("clientRef",null==l?void 0:l.reference),z.setFieldValue("applyVAT",(null==l?void 0:l.isSubjectToVAT)||!1),z.setFieldValue("clientId",(null==l?void 0:l.recordId)||null),!(null==l?void 0:l.recordId)){var n;z.setFieldValue("items",null==z?void 0:null===(n=z.initialValues)||void 0===n?void 0:n.items)}},errorCheck:"clientId"})}),(0,a.jsx)(c.ZP,{item:!0,xs:.75,children:(0,a.jsx)(N.Z,{name:"applyVAT",value:null===(n=z.values)||void 0===n?void 0:n.applyVAT,onChange:e=>z.setFieldValue("applyVAT",e.target.checked),label:E.applyVAT,maxAccess:H})}),(0,a.jsx)(c.ZP,{item:!0,xs:2,children:(0,a.jsx)(i.Z,{endpointId:T.r.Currency.qry,name:"currencyId",label:E.currency,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],required:!0,values:z.values,maxAccess:H,onChange:(e,l)=>{z.setFieldValue("currencyId",(null==l?void 0:l.recordId)||null)},error:z.touched.currencyId&&!!z.errors.currencyId})}),(0,a.jsx)(c.ZP,{item:!0,xs:2,children:(0,a.jsx)(i.Z,{endpointId:V.P.SalesPerson.qry,name:"spId",label:E.salesPerson,valueField:"recordId",displayField:["spRef","name"],columnsInDropDown:[{key:"spRef",value:"Reference"},{key:"name",value:"Name"}],values:z.values,onChange:(e,l)=>{z.setFieldValue("spId",(null==l?void 0:l.recordId)||0)},error:z.touched.spId&&!!z.errors.spId})}),(0,a.jsx)(c.ZP,{item:!0,xs:.5}),(0,a.jsx)(c.ZP,{item:!0,xs:1,children:(0,a.jsx)(x.Z,{onClick:Y,tooltipText:C.Preview,image:"preview.png",color:"#231f20"})})]})}),(0,a.jsx)(I.Q,{children:(0,a.jsx)(s.Z,{columns:X,gridData:null==z?void 0:null===(D=z.values)||void 0===D?void 0:D.data,rowId:["orderId"],isLoading:!1,pagination:!1,maxAccess:B,showCheckboxColumn:!0,showSelectAll:!0,handleCheckboxChange:function(){var e,l;null==z||z.setFieldValue("amount",(null==z?void 0:null===(l=z.values)||void 0===l?void 0:null===(e=l.data)||void 0===e?void 0:e.list.filter(e=>e.checked).reduce((e,l)=>{let n=0;if(l.checked){var a;n=parseFloat(null==l?void 0:null===(a=l.amountAfterVat)||void 0===a?void 0:a.toString().replace(/,/g,""))||0}return e+n},0))||0)}})}),(0,a.jsx)(m.g,{children:(0,a.jsxs)(c.ZP,{container:!0,spacing:2,p:2,children:[(0,a.jsx)(c.ZP,{item:!0,xs:3,children:(0,a.jsx)(i.Z,{endpointId:T.r.DocumentType.qry,parameters:"_startAt=0&_pageSize=1000&_dgId=".concat(y.J.SalesInvoice),name:"dtId",label:E.documentType,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],required:!0,valueField:"recordId",displayField:["reference","name"],values:z.values,maxAccess:H,onChange:async(e,l)=>{z.setFieldValue("dtId",(null==l?void 0:l.recordId)||null),await K(null==l?void 0:l.recordId)},error:z.touched.dtId&&!!z.errors.dtId})}),(0,a.jsx)(c.ZP,{item:!0,xs:2,children:(0,a.jsx)(x.Z,{onClick:Q,label:E.moreDet,tooltipText:E.moreDet,color:"#231f20",image:"notes.png"})}),(0,a.jsx)(c.ZP,{item:!0,xs:1,children:(0,a.jsx)(x.Z,{onClick:$,label:C.Generate,color:"#231f20",tooltipText:C.Generate,image:"generate.png"})}),(0,a.jsx)(c.ZP,{item:!0,xs:1}),(0,a.jsx)(c.ZP,{item:!0,xs:1.5,children:(0,a.jsx)(h.Z,{name:"amount",label:E.amount,value:null==z?void 0:null===(j=z.values)||void 0===j?void 0:j.amount,readOnly:!0,align:"right"})})]})})]})})}},30043:function(e,l,n){"use strict";n.d(l,{U:function(){return t}});let a="DE.asmx/",t={Driver:{snapshot:a+"snapshotDRV",page:a+"pageDRV",set:a+"setDRV",get:a+"getDRV",qry:a+"qryDRV",del:a+"delDRV"},Vehicle:{page:a+"pageVEH",set:a+"setVEH",get:a+"getVEH",qry:a+"qryVEH",del:a+"delVEH"},Trip:{page:a+"pageTRP",set:a+"setTRP",get:a+"getTRP",qry:a+"qryTRP",del:a+"delTRP",snapshot:a+"snapshotTRP",snapshot2:a+"snapshot2TRP",reopen:a+"reopenTRP",post:a+"postTRP",unpost:a+"unpostTRP",close:a+"closeTRP",generate:a+"generateTRP",setTRP2:a+"setTRP2",assign:a+"assignTRP",unassign:a+"unassignedTRP"},TripOrderPack2:{set2:a+"set2TRO"},TripOrder:{qry:a+"qryTRO"},Reduild:{rebuild:a+"rebuildMW"},TRP:{flag:a+"flagTRP"},ExpenseTypes:{get:a+"getET",set:a+"setET",del:a+"delET",page:a+"pageET"},DeliveriesOrders:{qry:a+"qryORD",get:a+"getORD",snapshot:a+"snapshotORD",unpost:a+"unpostORD",gen:a+"genORD",post:a+"postORD",del:a+"delORD",cancel:a+"cancelORD",flag:a+"flagORD",set2:a+"set2ORD"},Invoice:{generate:a+"generateIVC2",generateInv:a+"generateIVC",preview:a+"previewIVC"},OrderItem:{qry:a+"qryORI",get:a+"getORI"},MW:{qry:a+"qryMW2"},GenerateTrip:{root:a+"rootSZ",firstLevel:a+"firstLevelSZ",undelivered2:a+"undeliveredSO2",previewTRP:a+"previewTRP"},DeliveryLeadTime:{get:a+"getLDT",page:a+"pageLDT",set:a+"setLDT",del:a+"delLDT"},Volume:{vol:a+"volZO"},AllocatedVolume:{qry:a+"qryVEH2"},InboundTransp:{pack:a+"getPackINB",page:a+"pageINB",set2:a+"set2INB",get:a+"getINB",get2:a+"get2INB",del:a+"delINB",snapshot:a+"snapshotINB",post:a+"postINB",unpost:a+"unpostINB"},InboundOrders:{qry:a+"qryINO"}}}},function(e){e.O(0,[23352,13073,53491,79590,49774,92888,40179],function(){return e(e.s=41116)}),_N_E=e.O()}]);