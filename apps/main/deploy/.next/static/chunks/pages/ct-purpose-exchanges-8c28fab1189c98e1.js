(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[65780],{46023:function(e,a,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/ct-purpose-exchanges",function(){return r(12653)}])},12653:function(e,a,r){"use strict";r.r(a),r.d(a,{default:function(){return T}});var n=r(52322),t=r(2784),s=r(62202),c=r(69387),l=r(65950),o=r(24074),d=r(71987),i=r(26612),u=r(60218),m=r(48601),f=r(82737),p=r(5088),x=r(31389),b=r(62362),h=r(80983),v=r(8661),_=r(19473);function I(e){let{labels:a,maxAccess:r,recordId:c,setStore:I}=e,{getRequest:g,postRequest:C}=(0,t.useContext)(l.$),{platformLabels:j}=(0,t.useContext)(_.l),y=(0,d.E)({endpointId:o.u.PurposeExchange.page}),{formik:P}=(0,h.c)({initialValues:{recordId:null,name:"",reference:"",groupId:""},maxAccess:r,validateOnChange:!0,validationSchema:m.Ry({name:m.Z_().required(),reference:m.Z_().required()}),onSubmit:async e=>{let a=await C({extension:o.u.PurposeExchange.set,record:JSON.stringify(e)});e.recordId?I(a=>({...a,name:e.name})):(I({recordId:a.recordId,name:e.name}),P.setFieldValue("recordId",a.recordId)),s.ZP.success(e.recordId?j.Edited:j.Added),y()}}),Z=!!P.values.recordId;return(0,t.useEffect)(()=>{!async function(){if(c){let e=await g({extension:o.u.PurposeExchange.get,parameters:"_recordId=".concat(c)});I({recordId:e.record.recordId,name:e.record.name}),P.setValues(e.record)}}()},[]),(0,n.jsx)(f.Z,{resourceId:i.i.PurposeOfExchange,form:P,maxAccess:r,editMode:Z,children:(0,n.jsx)(x.R,{children:(0,n.jsx)(b.Q,{children:(0,n.jsxs)(u.ZP,{container:!0,spacing:2,children:[(0,n.jsx)(u.ZP,{item:!0,xs:12,children:(0,n.jsx)(p.Z,{name:"reference",label:a.reference,value:P.values.reference,required:!0,rows:2,maxAccess:r,onChange:P.handleChange,onClear:()=>P.setFieldValue("reference",""),error:P.touched.reference&&!!P.errors.reference})}),(0,n.jsx)(u.ZP,{item:!0,xs:12,children:(0,n.jsx)(p.Z,{name:"name",label:a.name,value:P.values.name,required:!0,maxAccess:r,maxLength:"30",onChange:P.handleChange,onClear:()=>P.setFieldValue("name",""),error:P.touched.name&&!!P.errors.name})}),(0,n.jsx)(u.ZP,{item:!0,xs:12,children:(0,n.jsx)(v.Z,{endpointId:o.u.PurposeExchangeGroup.qry,name:"groupId",label:a.group,valueField:"recordId",displayField:"name",values:P.values,maxAccess:r,onChange:(e,a)=>{P.setFieldValue("groupId",null==a?void 0:a.recordId)},error:P.touched.groupId&&!!P.errors.groupId})})]})})})})}var g=r(29326),C=r(9522),j=r(89119),y=e=>{let{labels:a,maxAccess:r,recordId:s}=e,[c,l]=(0,t.useState)(0),[o,d]=(0,t.useState)({recordId:s||null,name:null}),u=[{label:null==a?void 0:a.main},{label:null==a?void 0:a.interface,disabled:!o.recordId}];return(0,n.jsxs)(x.R,{children:[(0,n.jsx)(C.Y,{tabs:u,activeTab:c,setActiveTab:l,maxAccess:r}),(0,n.jsx)(g.Z,{index:0,value:c,maxAccess:r,children:(0,n.jsx)(I,{labels:a,maxAccess:r,recordId:s,setStore:d})}),(0,n.jsx)(g.Z,{index:1,value:c,maxAccess:r,children:(0,n.jsx)(j.V,{labels:a,resourceId:i.i.PurposeOfExchange,recordId:o.recordId,maxAccess:r,name:o.name})})]})},P=r(61802),Z=r(33625),E=r(36908),T=()=>{let{getRequest:e,postRequest:a}=(0,t.useContext)(l.$),{platformLabels:r}=(0,t.useContext)(_.l),{stack:u}=(0,P.zY)(),{query:{data:m},labels:f,filterBy:p,paginationParameters:h,invalidate:v,access:I,refetch:g}=(0,d.J)({queryFn:j,endpointId:o.u.PurposeExchange.page,datasetId:i.i.PurposeOfExchange,filter:{filterFn:C}});async function C(a){let{filters:r,pagination:n}=a;return(null==r?void 0:r.qry)?await e({extension:o.u.PurposeExchange.snapshot,parameters:"_filter=".concat(r.qry)}):j({_startAt:n._startAt||0,params:null==r?void 0:r.params})}async function j(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{_startAt:r=0,_pageSize:n=50,params:t}=a,s="_startAt=".concat(r,"&_pageSize=").concat(n,"&_params=").concat(t||"");return{...await e({extension:o.u.PurposeExchange.page,parameters:s}),_startAt:r}}let T=[{field:"reference",headerName:f.reference,flex:1},{field:"name",headerName:f.name,flex:1},{field:"groupName",headerName:f.group,flex:1}];function N(e){u({Component:y,props:{labels:f,recordId:e,maxAccess:I},width:600,height:400,title:f.purposeOfExchange})}let w=async e=>{await a({extension:o.u.PurposeExchange.del,record:JSON.stringify(e)}),v(),s.ZP.success(r.Deleted)};return(0,n.jsxs)(x.R,{children:[(0,n.jsx)(Z.g,{children:(0,n.jsx)(E.Z,{onAdd:()=>{N()},maxAccess:I,reportName:"CTPEX",filterBy:p})}),(0,n.jsx)(b.Q,{children:(0,n.jsx)(c.Z,{columns:T,gridData:m,rowId:["recordId"],onEdit:e=>{N(e.recordId)},onDelete:w,isLoading:!1,pageSize:50,paginationParameters:h,refetch:g,paginationType:"api",maxAccess:I})})]})}},29326:function(e,a,r){"use strict";var n=r(52322);r(2784);var t=r(23925),s=r(13980),c=r.n(s),l=r(95291),o=r.n(l),d=r(65947);let i=e=>{var a,r,s;let{children:c,value:l,index:i,maxAccess:u,...m}=e,f="".concat(e.name||"tab",".").concat(i),{accessLevel:p}=null!==(s=(null!==(r=null==u?void 0:null===(a=u.record)||void 0===a?void 0:a.controls)&&void 0!==r?r:[]).find(e=>e.controlId===f))&&void 0!==s?s:{accessLevel:0};if(p===d.A1)return null;let x=l===i;return(0,n.jsx)(t.Z,{role:"tabpanel",hidden:!x,id:"simple-tabpanel-".concat(i),"aria-labelledby":"simple-tab-".concat(i),className:"".concat(o().tabPanel," ").concat(x?o().active:o().hidden),...m,children:c})};i.propTypes={children:c().node,index:c().number.isRequired,value:c().number.isRequired},a.Z=i},9522:function(e,a,r){"use strict";r.d(a,{Y:function(){return m}});var n=r(52322),t=r(23925),s=r(54582),c=r(68696),l=r(44258),o=r(2784),d=r(99266),i=r(52614),u=r.n(i);let m=e=>{var a,r,i,m,f;let{tabs:p,activeTab:x,setActiveTab:b,maxAccess:h,name:v="tab"}=e,_=(null==h?void 0:null===(r=h.record)||void 0===r?void 0:null===(a=r.controls)||void 0===a?void 0:a.filter(e=>{var a;return 4===e.accessLevel&&(null===(a=e.controlId)||void 0===a?void 0:a.startsWith("".concat(v,".")))}).map(e=>e.controlId.split(".")[1]))||[],I=null==p?void 0:null===(i=p.map((e,a)=>({...e,id:a})))||void 0===i?void 0:i.filter((e,a)=>!_.includes(String(a))),g=null===(m=I[x])||void 0===m?void 0:m.id,C=null===(f=I[x])||void 0===f?void 0:f.disabled;return(0,o.useEffect)(()=>{g>=0&&!C&&x!=g&&b(g)},[]),(0,n.jsx)(t.Z,{className:u().tabsContainer,children:(0,n.jsx)(t.Z,{className:u().tabsWrapper,children:(0,n.jsx)(s.Z,{value:x,onChange:(e,a)=>b(a),variant:"scrollable",scrollButtons:I.length>3?"auto":"off","aria-label":"scrollable tabs",classes:{indicator:u().tabsIndicator},className:u().tabs,children:null==I?void 0:I.map(e=>(0,n.jsx)(c.Z,{value:e.id,disabled:null==e?void 0:e.disabled,className:"".concat(u().tabName," ").concat(e.disabled?u().tabDisabled:""),classes:{root:u().tabRoot,selected:u().selectedTab},label:(0,n.jsxs)(t.Z,{display:"flex",alignItems:"center",children:[(0,n.jsx)("span",{children:e.label}),e.id===x&&(null==e?void 0:e.onRefetch)&&(0,n.jsx)(l.Z,{size:"small",className:u().refreshButton,onClick:a=>{a.stopPropagation(),e.onRefetch()},children:(0,n.jsx)(d.Z,{className:u().refreshIcon})})]})},e.id))})})})}},89119:function(e,a,r){"use strict";r.d(a,{V:function(){return _}});var n=r(52322),t=r(2784),s=r(65950),c=r(49864),l=r(50023),o=r(26612),d=r(62202),i=r(76399),u=r(80983),m=r(84100),f=r(53621),p=r(80968),x=r(5088),b=r(62362),h=r(31389),v=r(54074);let _=e=>{let{recordId:a,resourceId:r,name:_}=e,{getRequest:I,postRequest:g}=(0,t.useContext)(s.$),{getAllKvsByDataset:C}=(0,t.useContext)(p.k),{labels:j,access:y}=(0,l.Z)({datasetId:o.i.InterfaceMap,editMode:!!a}),{formik:P}=(0,u.c)({initialValues:{rows:[{id:1,recordId:a,resourceId:o.i.resourceId,interfaceId:"",interfaceName:"",reference:""}]},validateOnChange:!0,onSubmit:async e=>{let n=P.values.rows.map(e=>({recordId:a,resourceId:r,...e})),t=n.every(e=>""===e.interfaceId);(await g({extension:f.d.InterfaceMaps.set2,record:JSON.stringify({recordId:a,resourceId:r,items:t?[]:n})})).recordId&&d.ZP.success("Record Successfully")}});async function Z(){return new Promise((e,a)=>{C({_dataset:m.v.ALL_INTERFACES,callback:r=>{r?e(r):a()}})})}(0,t.useEffect)(()=>{!async function(){if(a){let e=await Z(),n=await I({extension:f.d.InterfaceMaps.qry,parameters:"_recordId=".concat(a,"&_resourceId=").concat(r)}),t=e.map(e=>{let a={interfaceId:e.key,interfaceName:e.value,reference:""},r=n.list.find(e=>a.interfaceId==e.interfaceId);return r&&(a.reference=r.reference),a});P.setValues({...P.values,rows:t.map((e,a)=>({...e,id:a+1}))})}}()},[a]);let E=[{component:"resourcecombobox",label:j.interface,name:"interfaceId",props:{readOnly:!0,datasetId:m.v.ALL_INTERFACES,valueField:"key",displayField:"value",displayFieldWidth:2,mapping:[{from:"key",to:"interfaceId"},{from:"value",to:"interfaceName"}]}},{component:"textfield",label:j.reference,name:"reference"}];return(0,n.jsx)(v.Z,{onSave:P.handleSubmit,maxAccess:y,editMode:!0,children:(0,n.jsx)(h.R,{children:(0,n.jsxs)(b.Q,{children:[(0,n.jsx)(c.Z,{sx:{width:"50%"},children:(0,n.jsx)(x.Z,{label:j.name,value:_,readOnly:!0})}),(0,n.jsx)(i._,{onChange:e=>P.setFieldValue("rows",e),value:P.values.rows,error:P.errors.rows,columns:E,allowDelete:!1})]})})})}},95291:function(e){e.exports={tabPanel:"CustomTabPanel_tabPanel__80Dfu",active:"CustomTabPanel_active___6Uvb",hidden:"CustomTabPanel_hidden__y9566"}},52614:function(e){e.exports={customTabPanel:"CustomTabs_customTabPanel__Ztocv",hidden:"CustomTabs_hidden__lZpM7",tabsContainer:"CustomTabs_tabsContainer__28Syi",tabsWrapper:"CustomTabs_tabsWrapper__mlxxj",tabs:"CustomTabs_tabs__25pli",tabName:"CustomTabs_tabName__XzMCn",tabRoot:"CustomTabs_tabRoot__WVR1E",tabDisabled:"CustomTabs_tabDisabled__VauYR",selectedTab:"CustomTabs_selectedTab__sZzwF",tabsIndicator:"CustomTabs_tabsIndicator__89Lek",refreshButton:"CustomTabs_refreshButton__P2mzl",refreshIcon:"CustomTabs_refreshIcon__ADVWF"}}},function(e){e.O(0,[92515,2494,36908,49774,92888,40179],function(){return e(e.s=46023)}),_N_E=e.O()}]);