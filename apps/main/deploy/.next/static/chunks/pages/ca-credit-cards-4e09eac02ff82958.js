(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[42011],{46777:function(e,r,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/ca-credit-cards",function(){return n(13666)}])},13666:function(e,r,n){"use strict";n.r(r),n.d(r,{default:function(){return k}});var d=n(52322),a=n(2784),i=n(62202),s=n(69387),t=n(27723),c=n(65950),o=n(26612),l=n(31389),u=n(61802),m=n(71987),C=n(33625),x=n(62362),f=n(19473),h=n(2119),I=n(60218),p=n(48601),b=n(82737),v=n(5088),g=n(8661),F=n(80983),_=n(76399);function y(e){let{recordId:r,labels:n,maxAccess:s}=e,{getRequest:t,postRequest:u}=(0,a.useContext)(c.$),{platformLabels:y}=(0,a.useContext)(f.l),k=(0,m.E)({endpointId:h.G.CreditCard.qry}),{formik:q}=(0,F.c)({initialValues:{recordId:r,reference:"",name:"",bankId:"",creditCardFees:[{id:1,creditCardId:r,seqNo:1,upToAmount:0,commissionFees:0,isPct:!1}]},maxAccess:s,validateOnChange:!0,validationSchema:p.Ry({name:p.Z_().required(),reference:p.Z_().required(),bankId:p.Z_().required(),creditCardFees:p.IX().of(p.Ry().shape({upToAmount:p.Z_().required(),commissionFees:p.Z_().required()})).required()}),onSubmit:async e=>{let r=await u({extension:h.G.CreditCard.set,record:JSON.stringify({recordId:e.recordId,name:e.name,reference:e.reference,bankId:e.bankId})});await u({extension:h.G.CreditCard.set2,record:JSON.stringify({creditCardId:null==r?void 0:r.recordId,fees:e.creditCardFees.map((e,n)=>{let{...d}=e;return{seqNo:n+1,creditCardId:null==r?void 0:r.recordId,...d}})})}),e.recordId?i.ZP.success(y.Edited):(i.ZP.success(y.Added),q.setValues({...e,recordId:r.recordId})),k()}}),Z=!!q.values.recordId;(0,a.useEffect)(()=>{!async function(){if(r){var e;let n=await t({extension:h.G.CreditCard.get,parameters:"_recordId=".concat(r)}),d=await t({extension:h.G.CreditCardFees.qry,parameters:"_creditCardId=".concat(r)});q.setValues({...n.record,creditCardFees:null===(e=d.list)||void 0===e?void 0:e.map((e,r)=>{let{...n}=e;return{id:r+1,...n}})})}}()},[]);let j=[{component:"numberfield",label:null==n?void 0:n.upToAmount,name:"upToAmount",props:{maxLength:12,decimalScale:0}},{component:"numberfield",label:null==n?void 0:n.commissionFees,name:"commissionFees",props:{maxLength:15,decimalScale:3}},{component:"checkbox",label:null==n?void 0:n.isPct,name:"isPct",flex:.4}];return(0,d.jsx)(b.Z,{resourceId:o.i.CreditCard,form:q,maxAccess:s,editMode:Z,isCleared:!1,children:(0,d.jsxs)(l.R,{children:[(0,d.jsx)(C.g,{children:(0,d.jsxs)(I.ZP,{container:!0,spacing:2,children:[(0,d.jsx)(I.ZP,{item:!0,xs:12,children:(0,d.jsx)(v.Z,{name:"reference",label:n.reference,value:q.values.reference,required:!0,maxAccess:s,maxLength:"10",onChange:q.handleChange,onClear:()=>q.setFieldValue("reference",""),error:q.touched.reference&&!!q.errors.reference})}),(0,d.jsx)(I.ZP,{item:!0,xs:12,children:(0,d.jsx)(v.Z,{name:"name",label:n.name,value:q.values.name,required:!0,maxAccess:s,onChange:q.handleChange,onClear:()=>q.setFieldValue("name",""),error:q.touched.name&&!!q.errors.name})}),(0,d.jsx)(I.ZP,{item:!0,xs:12,children:(0,d.jsx)(g.Z,{endpointId:h.G.CbBank.qry,name:"bankId",required:!0,label:n.bank,valueField:"recordId",displayField:"name",columnsInDropDown:[{key:"name",value:"name"}],values:q.values,maxAccess:s,onChange:(e,r)=>{q.setFieldValue("bankId",(null==r?void 0:r.recordId)||null)},error:q.touched.bankId&&!!q.errors.bankId})})]})}),(0,d.jsx)(x.Q,{children:(0,d.jsx)(_._,{onChange:e=>{q.setFieldValue("creditCardFees",e)},name:"creditCardFees",value:q.values.creditCardFees,error:q.errors.creditCardFees,columns:j,maxAccess:s})})]})})}var k=()=>{let{getRequest:e,postRequest:r}=(0,a.useContext)(c.$),{platformLabels:n}=(0,a.useContext)(f.l),{stack:I}=(0,u.zY)();async function p(){return await e({extension:h.G.CreditCard.qry,parameters:""})}let{query:{data:b},labels:v,access:g,refetch:F,invalidate:_}=(0,m.J)({queryFn:p,endpointId:h.G.CreditCard.qry,datasetId:o.i.CreditCard}),k=[{field:"reference",headerName:v.reference,flex:1},{field:"name",headerName:v.name,flex:1},{field:"bankName",headerName:v.bank,flex:1}],q=async e=>{await r({extension:h.G.CreditCard.del,record:JSON.stringify(e)}),_(),i.ZP.success(n.Deleted)};function Z(e){I({Component:y,props:{labels:v,recordId:e,maxAccess:g},width:800,height:600,title:v.creditCard})}return(0,d.jsxs)(l.R,{children:[(0,d.jsx)(C.g,{children:(0,d.jsx)(t.Z,{onAdd:()=>{Z()},maxAccess:g})}),(0,d.jsx)(x.Q,{children:(0,d.jsx)(s.Z,{columns:k,gridData:b,rowId:["recordId"],onEdit:e=>{Z(null==e?void 0:e.recordId)},onDelete:q,maxAccess:g,pageSize:50,refetch:F,paginationType:"client"})})]})}}},function(e){e.O(0,[49774,92888,40179],function(){return e(e.s=46777)}),_N_E=e.O()}]);