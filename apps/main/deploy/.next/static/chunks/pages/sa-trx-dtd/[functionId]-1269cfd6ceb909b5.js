(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8160],{65997:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/sa-trx-dtd/[functionId]",function(){return a(92087)}])},92087:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return N}});var n=a(52322),l=a(2784),r=a(62202),d=a(69387),s=a(27723),o=a(65950),c=a(71987),i=a(26612),u=a(31389),m=a(33625),v=a(62362),I=a(61802),y=a(98345),f=a(22341),p=a(60218),x=a(48601),h=a(82737),g=a(80983),D=a(38449),b=a(8661),w=a(19473),F=a(65215),_=a(84100),T=a(19689);function k(e){var t,a,d;let{labels:s,maxAccess:m,recordId:I,functionId:y}=e,{platformLabels:k}=(0,l.useContext)(w.l),{getRequest:S,postRequest:N}=(0,l.useContext)(o.$),j=(0,c.E)({endpointId:f.P.DocumentTypeDefault.qry}),{formik:Z}=(0,g.c)({initialValues:{dtId:"",recordId:I||null,commitItems:!1,plantId:"",spId:"",allocateBy:null,postMetalToFinancials:!1,siteId:"",disableSKULookup:!1},maxAccess:m,validationSchema:x.Ry({dtId:x.Z_().required(),allocateBy:x.Z_().transform(e=>null===e?"":e).test("required-allocateBy"," ",function(e){let{commitItems:t}=this.parent;return!t||!!e})}),onSubmit:async e=>{try{let t={...e,allocateBy:null===e.allocateBy?"":e.allocateBy};await N({extension:f.P.DocumentTypeDefault.set,record:JSON.stringify(t)}),Z.values.recordId?r.ZP.success(k.Edited):(Z.setFieldValue("recordId",Z.values.dtId),r.ZP.success(k.Added)),j()}catch(e){}}}),A=!!Z.values.recordId;return(0,l.useEffect)(()=>{!async function(){try{if(I){let e=await S({extension:f.P.DocumentTypeDefault.get,parameters:"_dtId=".concat(I)});Z.setValues({...e.record,recordId:e.record.dtId,allocateBy:e.record.allocateBy||"",disableSKULookup:!!e.record.disableSKULookup})}}catch(e){}}()},[]),(0,n.jsx)(h.Z,{resourceId:i.i.DocumentTypeDefault,form:Z,maxAccess:m,editMode:A,functionId:y,children:(0,n.jsx)(u.R,{children:(0,n.jsx)(v.Q,{children:(0,n.jsxs)(p.ZP,{container:!0,spacing:2,children:[(0,n.jsx)(p.ZP,{item:!0,xs:12,children:(0,n.jsx)(b.Z,{endpointId:D.r.DocumentType.qry,parameters:"_startAt=0&_pageSize=1000&_dgId=".concat(y),name:"dtId",required:!0,label:s.documentType,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],valueField:"recordId",displayField:["reference","name"],readOnly:A,values:Z.values,maxAccess:m,onChange:(e,t)=>{Z&&Z.setFieldValue("dtId",(null==t?void 0:t.recordId)||"")},error:Z.touched.dtId&&!!Z.errors.dtId})}),(0,n.jsx)(p.ZP,{item:!0,xs:12,children:(0,n.jsx)(b.Z,{endpointId:f.P.SalesPerson.qry,name:"spId",label:s.salesPerson,columnsInDropDown:[{key:"name",value:"Name"}],valueField:"recordId",displayField:"name",values:Z.values,onChange:(e,t)=>{t?Z.setFieldValue("spId",null==t?void 0:t.recordId):Z.setFieldValue("spId","")},error:Z.touched.spId&&!!Z.errors.spId})}),(0,n.jsx)(p.ZP,{item:!0,xs:12,children:(0,n.jsx)(b.Z,{endpointId:D.r.Plant.qry,name:"plantId",label:s.plant,readOnly:"3"==Z.values.status,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"plant Ref"},{key:"name",value:"Name"}],values:Z.values,maxAccess:m,onChange:(e,t)=>{let a=(null==t?void 0:t.recordId)||"";Z.setFieldValue("plantId",a)},error:Z.touched.plantId&&!!Z.errors.plantId})}),(0,n.jsx)(p.ZP,{item:!0,xs:12,children:(0,n.jsx)(b.Z,{endpointId:F.$.Site.qry,name:"siteId",label:s.site,values:Z.values,displayField:"name",maxAccess:m,onChange:(e,t)=>{Z.setFieldValue("siteId",null==t?void 0:t.recordId)},error:Z.touched.siteId&&!!Z.errors.siteId})}),(0,n.jsx)(p.ZP,{item:!0,xs:12,children:(0,n.jsx)(T.Z,{name:"commitItems",value:null===(t=Z.values)||void 0===t?void 0:t.commitItems,onChange:e=>{Z.handleChange(e),e.target.checked||Z.setFieldValue("allocateBy","")},label:s.commitItems,maxAccess:m})}),(0,n.jsx)(p.ZP,{item:!0,xs:12,children:(0,n.jsx)(b.Z,{datasetId:_.v.SA_ALLOCATE_BY,name:"allocateBy",required:!!Z.values.commitItems,readOnly:!Z.values.commitItems,label:s.allocateBy,valueField:"key",displayField:"value",values:Z.values,maxAccess:m,onChange:(e,t)=>{Z.setFieldValue("allocateBy",(null==t?void 0:t.key)||"")},error:Z.touched.allocateBy&&Z.values.commitItems&&!!Z.errors.allocateBy})}),(0,n.jsx)(p.ZP,{item:!0,xs:12,children:(0,n.jsx)(T.Z,{name:"postMetalToFinancials",value:null===(a=Z.values)||void 0===a?void 0:a.postMetalToFinancials,onChange:e=>Z.setFieldValue("postMetalToFinancials",e.target.checked),label:s.postMetalToFinancials,maxAccess:m})}),(0,n.jsx)(p.ZP,{item:!0,xs:12,children:(0,n.jsx)(T.Z,{name:"disableSKULookup",value:null===(d=Z.values)||void 0===d?void 0:d.disableSKULookup,onChange:e=>Z.setFieldValue("disableSKULookup",e.target.checked),label:s.dsl,maxAccess:m})})]})})})})}var S=a(63165),N=()=>{let{getRequest:e,postRequest:t}=(0,l.useContext)(o.$),{platformLabels:a}=(0,l.useContext)(w.l),{stack:p}=(0,I.zY)(),{functionId:x}=(0,S.F)();async function h(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{pagination:{_startAt:a=0}}=t;return{...await e({extension:f.P.DocumentTypeDefault.qry,parameters:"_sortBy=reference&_functionId=".concat(x)}),_startAt:a}}let{query:{data:g},labels:D,access:b,invalidate:F,refetch:_}=(0,c.J)({endpointId:f.P.DocumentTypeDefault.qry,datasetId:i.i.DocumentTypeDefault,filter:{filterFn:h,default:{functionId:x}}}),T=[{field:"commitItems",headerName:D.commitItems,flex:1},{field:"dtName",headerName:D.documentType,flex:1},{field:"plantName",headerName:D.plant,flex:1},{field:"siteRef",headerName:D.siteRef,flex:1},{field:"siteName",headerName:D.site,flex:1}];function N(e){p({Component:k,props:{labels:D,recordId:null==e?void 0:e.dtId,maxAccess:b,functionId:x},width:800,height:600,title:D.dtDefault})}let{proxyAction:j}=(0,y.G)({functionId:x,action:N}),Z=async()=>{await j()},A=async e=>{await t({extension:f.P.DocumentTypeDefault.del,record:JSON.stringify(e)}),F(),r.ZP.success(a.Deleted)};return(0,n.jsxs)(u.R,{children:[(0,n.jsx)(m.g,{children:(0,n.jsx)(s.Z,{onAdd:Z,maxAccess:b})}),(0,n.jsx)(v.Q,{children:(0,n.jsx)(d.Z,{columns:T,gridData:g,rowId:["dtId"],onEdit:e=>{N(e)},onDelete:A,isLoading:!1,pageSize:50,refetch:_,paginationType:"client",maxAccess:b})})]})}},63165:function(e,t,a){"use strict";a.d(t,{F:function(){return r}});var n=a(5632),l=a(2784);let r=()=>{let e=(0,n.useRouter)(),[t,a]=(0,l.useState)(e.query);return t}},1685:function(e,t,a){"use strict";a.d(t,{m:function(){return n}});let n=e=>{let t=window.sessionStorage.getItem(e);return t?JSON.parse(t):null}},98345:function(e,t,a){"use strict";a.d(t,{H:function(){return y},G:function(){return I}});var n=a(45300),l=a(2784),r=a(96026),d=a(38449);a(26612);var s=a(65947),o=a(1685);let c=async(e,t,a)=>{try{let n=await e({extension:t,parameters:a});return t.includes("qry")?n:n.record}catch(e){return null}},i=(e,t,a,n)=>{let l=(e=JSON.parse(JSON.stringify(e))).record.controls,r=l.find(e=>"reference"===e.controlId);return r?r.accessLevel=(null==t?void 0:t.mandatory)?s.$7:s.rr:(null==t?void 0:t.mandatory)?l.push({sgId:0,resourceId:"",controlId:"".concat(n?n+".":"","reference"),accessLevel:(null==t?void 0:t.mandatory)?s.$7:s.rr}):(null==t?void 0:t.readOnly)?l.push({sgId:0,resourceId:"",controlId:"".concat(n?n+".":"","reference"),accessLevel:(null==t?void 0:t.readOnly)?s.rr:s.$7}):l=e.record.controls.filter(e=>"reference"!=e.controlId),a&&l.push({sgId:0,resourceId:"",controlId:"".concat(n?n+".":"","dtId"),accessLevel:s.$7}),{...e,record:{...e.record,controls:l}}},u=async(e,t,a)=>{let n,l;switch(a){case"dtId":let r=(0,o.m)("userData"),s=null==r?void 0:r.userId;l="_userId=".concat(s,"&_functionId=").concat(t),n=d.r.UserFunction.get;break;case"glbSysNumberRange":l="_recordId=".concat(t),n=d.r.SystemFunction.get;break;case"DocumentType":l="_dgId=".concat(t,"&_startAt=",0,"&_pageSize=",50),n=d.r.DocumentType.qry;break;case"DcTypNumberRange":l="_recordId=".concat(t),n=d.r.DocumentType.get;break;case"isExternal":l="_recordId=".concat(t),n=d.r.NumberRange.get;break;default:return null}return await c(e,n,l)},m=async function(e){let t,a,n,l,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,d=arguments.length>2?arguments[2]:void 0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,o=!(arguments.length>4)||void 0===arguments[4]||arguments[4],c=arguments.length>5?arguments[5]:void 0,m=void 0===s&&r&&await u(e,r,"dtId"),v=null==m?void 0:m.dtId,I="",y=!0;if(m&&void 0===s||"nraId"===s){if(v){let a=await u(e,v,"DcTypNumberRange");t=null==a?void 0:a.nraId,y=!((null==a?void 0:a.activeStatus)<0),t||(I="Assign the document type to a number range")}if((!v||!y)&&o&&r){var f;let t=await u(e,r,"DocumentType");l=(null==t?void 0:null===(f=t.list)||void 0===f?void 0:f.filter(e=>(null==e?void 0:e.activeStatus)===1).length)>0}}if(("nraId"===s||void 0===s)&&r){if((!v||v)&&!t||t&&!y){let a=await u(e,r,"glbSysNumberRange");(t=null==a?void 0:a.nraId)&&l&&(l=!1),y=!0}I=t||l?"":"Assign the system Function to a number range"}s>0&&!t&&(t=s),t&&y?(a={readOnly:null==(n=await u(e,t,"isExternal"))||!n.external,mandatory:null!=n&&!!n.external},d&&(d=await i(d,a,l,c))):!t&&d&&(d=await i(d,a,l,c));let p=c?"".concat(c,".reference"):"reference";return{dtId:v,resetReference:null==a?void 0:a.readOnly,dcTypeRequired:l,reference:{fieldName:p,isEmpty:(null==n?void 0:n.external)!==void 0&&(null==n||!n.external)},errorMessage:I,maxAccess:d,selectNraId:s}};var v=a(65950);function I(e){let{functionId:t,action:a,hasDT:n}=e,{getRequest:d}=(0,l.useContext)(v.$),{stack:s}=(0,r.V)();return{proxyAction:async()=>{let e=await m(d,t,"",void 0,n);(null==e?void 0:e.errorMessage)?s({message:null==e?void 0:e.errorMessage}):await a()}}}function y(e){var t;let{functionId:a,access:d,hasDT:s,enabled:o=!0,objectName:c=""}=e,{getRequest:i}=(0,l.useContext)(v.$),{stack:u}=(0,r.V)(),[I,y]=(0,l.useState)(),f=async e=>{let t=await m(i,a,d,e,s,c);if(!t.errorMessage)return t;u({message:null==t?void 0:t.errorMessage})},p=(0,n.a)({retry:!1,staleTime:0,enabled:o,queryKey:[a,I,!!d,o],queryFn:I||"nraId"===I?()=>f(I):()=>f()});return{documentType:p.data,maxAccess:(null==p?void 0:null===(t=p.data)||void 0===t?void 0:t.maxAccess)||d,changeDT(e){y((null==e?void 0:e.nraId)||"nraId")}}}}},function(e){e.O(0,[49774,92888,40179],function(){return e(e.s=65997)}),_N_E=e.O()}]);