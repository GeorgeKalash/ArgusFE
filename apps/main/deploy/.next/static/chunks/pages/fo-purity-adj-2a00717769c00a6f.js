(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[97119],{26331:function(e,l,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/fo-purity-adj",function(){return t(55274)}])},55274:function(e,l,t){"use strict";t.r(l),t.d(l,{default:function(){return M}});var d=t(52322),n=t(36773),a=t(26612),i=t(19473),r=t(65950),o=t(61802),u=t(2784),s=t(62202),c=t(60218),v=t(48601),m=t(7121),y=t(98345),h=t(71987),p=t(67920),f=t(80983),x=t(65215),I=t(82737),g=t(31389),b=t(33625),P=t(8661),w=t(5088),j=t(89330),S=t(76399),k=t(62362),F=t(21581),N=t(91406),R=t(39812);function A(e){var l,t,o,A,C,Z,M,O,_,q,D,Q,V,T,B,E,J,L,$,G,U,z,X,K,H,W,Y,ee,el,et,ed,en,ea,ei,er,eo,eu,es,ec,ev,em,ey,eh,ep,ef,ex,eI,eg,eb,eP,ew,ej,eS,ek;let{labels:eF,access:eN,recordId:eR,window:eA}=e,{getRequest:eC,postRequest:eZ}=(0,u.useContext)(r.$),{platformLabels:eM,userDefaultsData:eO,defaultsData:e_}=(0,u.useContext)(i.l),[eq,eD]=(0,u.useState)([]),[eQ,eV]=(0,u.useState)(!1),eT=(0,u.useRef)(),eB=m.J.PurityAdjustment,{documentType:eE,maxAccess:eJ,changeDT:eL}=(0,y.H)({functionId:eB,access:eN,enabled:!eR,objectName:"header"}),e$=(0,h.E)({endpointId:n.B.PurityAdjustment.page}),eG=parseInt(null==eO?void 0:null===(t=eO.list)||void 0===t?void 0:null===(l=t.find(e=>"plantId"===e.key))||void 0===l?void 0:l.value)||null,eU=parseInt(null==eO?void 0:null===(A=eO.list)||void 0===A?void 0:null===(o=A.find(e=>"siteId"===e.key))||void 0===o?void 0:o.value)||null,ez=parseInt(null==e_?void 0:null===(Z=e_.list)||void 0===Z?void 0:null===(C=Z.find(e=>"baseSalesMetalId"===e.key))||void 0===C?void 0:C.value)||null,{schema:eX,requiredFields:eK}=(0,p.m)({sku:e=>null==e?void 0:e.sku,itemName:e=>null==e?void 0:e.itemName,qty:e=>null==e?void 0:e.qty,purity:e=>null==e?void 0:e.purity,metalId:e=>null==e?void 0:e.metalId},!0,eJ,"items"),{formik:eH}=(0,f.c)({documentType:{key:"header.dtId",value:null==eE?void 0:eE.dtId,reference:null==eE?void 0:eE.reference},initialValues:{recordId:eR||null,header:{recordId:eR,functionId:m.J.PurityAdjustment,date:new Date,dtId:null,plantId:eG,reference:"",siteId:eU,status:1,workCenterId:null,qty:0,baseSalesMetalPurity:0,baseSalesMetalRef:"",notes:""},items:[{id:1,trxId:eR||0,seqNo:1,itemId:null,sku:"",itemName:"",metalId:null,purity:null,stdPurity:null,qty:0}]},maxAccess:eJ,validationSchema:v.Ry({header:v.Ry({date:v.hT().required(),siteId:v.Rx().required(),plantId:v.Rx().required(),workCenterId:v.Rx().required()}),items:v.IX().of(eX)}),conditionSchema:["items"],onSubmit:async e=>{let l=eW(e),t=await eZ({extension:n.B.PurityAdjustment.set2,record:JSON.stringify(l)});s.ZP.success(e.recordId?eM.Edited:eM.Added),ln(null==t?void 0:t.recordId),e$()}}),eW=e=>({header:{...e.header,date:(0,R.ku)(e.header.date),sumQty:e1,sumDeltaPurity:e7,sumDeltaRMQty:e5,sumNewRMQty:e6,sumRMQty:e3,avgPurity:e8,avgNewPuirty:e9},items:((null==e?void 0:e.items)||[]).filter(e=>{var l;return null===(l=Object.values(eK))||void 0===l?void 0:l.every(l=>l(e))}).map((l,t)=>({...l,type:1,trxId:(null==e?void 0:e.recordId)||0,seqNo:t+1,purity:l.purity/1e3}))}),eY=!!(null===(M=eH.values)||void 0===M?void 0:M.header.recordId),e0=3===eH.values.header.status,e2=e=>eH.values.items.reduce((l,t)=>l+(parseFloat(t[e])||0),0).toFixed(2),e1=eQ?e2("qty"):null===(_=eH.values)||void 0===_?void 0:null===(O=_.header)||void 0===O?void 0:O.sumQty,e3=eQ?e2("rmQty"):null===(D=eH.values)||void 0===D?void 0:null===(q=D.header)||void 0===q?void 0:q.sumRMQty,e6=eQ?e2("newRmQty"):null===(V=eH.values)||void 0===V?void 0:null===(Q=V.header)||void 0===Q?void 0:Q.sumNewRMQty,e5=eQ?e2("deltaRMQty"):null===(B=eH.values)||void 0===B?void 0:null===(T=B.header)||void 0===T?void 0:T.sumDeltaRMQty,e8=eQ?((e3||0)*((null===(J=eH.values)||void 0===J?void 0:null===(E=J.header)||void 0===E?void 0:E.baseSalesMetalPurity)||0)/(e1||0)).toFixed(2):null===($=eH.values)||void 0===$?void 0:null===(L=$.header)||void 0===L?void 0:L.avgPurity,e9=eQ?((e6||0)*((null===(U=eH.values)||void 0===U?void 0:null===(G=U.header)||void 0===G?void 0:G.baseSalesMetalPurity)||0)/(e1||0)).toFixed(2):null===(X=eH.values)||void 0===X?void 0:null===(z=X.header)||void 0===z?void 0:z.avgNewPuirty,e7=eQ?((e9||0)-(e8||0)).toFixed(2):null===(H=eH.values)||void 0===H?void 0:null===(K=H.header)||void 0===K?void 0:K.sumDeltaPurity,e4=async()=>{var e;await eZ({extension:n.B.PurityAdjustment.post,record:JSON.stringify({...null===(e=eH.values)||void 0===e?void 0:e.header,date:(0,R.ku)(eH.values.header.date)})}),s.ZP.success(eM.Posted),e$(),eA.close()},le=async()=>{var e;let l=await eZ({extension:n.B.PurityAdjustment.unpost,record:JSON.stringify({...null===(e=eH.values)||void 0===e?void 0:e.header,date:(0,R.ku)(eH.values.header.date)})});s.ZP.success(eM.Unposted),ln(null==l?void 0:l.recordId),e$()};async function ll(e){eT.current=e?eq.filter(l=>l.metalId===e):[]}async function lt(){let e=await eC({extension:x.$.Scrap.qry,parameters:"_metalId=0"});eD(null==e?void 0:e.list)}let ld=async e=>{var l;let t=await eC({extension:x.$.Physical.get,parameters:"_itemId=".concat(e)});return(null==t?void 0:null===(l=t.record)||void 0===l?void 0:l.isOpenMetalPurity)||!1};async function ln(e){var l,t;let{record:d}=await eC({extension:n.B.PurityAdjustment.get2,parameters:"_recordId=".concat(e)});if(!d){eH.setValues({...eH.initialValues});return}let a=await Promise.all(((null==d?void 0:d.items)||[]).map(async(e,l)=>{let t=await ld(e.itemId);return{...e,id:l+1,purity:1e3*e.purity,isOpenMetalPurity:t}})),i=await lo();eH.setValues({recordId:null==d?void 0:null===(l=d.header)||void 0===l?void 0:l.recordId,header:{...(null==d?void 0:d.header)||{},date:(0,R.a1)(null==d?void 0:null===(t=d.header)||void 0===t?void 0:t.date),baseSalesMetalPurity:(null==i?void 0:i.purity)*1e3||0,baseSalesMetalRef:(null==i?void 0:i.reference)||0},items:(null==a?void 0:a.length)?a:eH.initialValues.items}),eV(!1)}let la=[{component:"numberfield",name:"id",label:eF.count,props:{readOnly:!0}},{component:"textfield",label:eF.batchRef,name:"batchRef",props:{maxLength:10}},{component:"resourcecombobox",label:eF.metal,name:"metalId",props:{endpointId:n.B.PurityAdjustment.combos,reducer:e=>{var l;return null==e?void 0:null===(l=e.record)||void 0===l?void 0:l.metals},valueField:"recordId",displayField:"reference",displayFieldWidth:1.5,mapping:[{from:"reference",to:"metalRef"},{from:"recordId",to:"metalId"},{from:"purity",to:"purity"}]},propsReducer(e){let{row:l,props:t}=e;return{...t,readOnly:!!l.itemId}},onChange:async e=>{let{row:{update:l,newRow:t}}=e;eV(!0),ll(null==t?void 0:t.metalId),l({purity:((null==t?void 0:t.purity)*1e3||0).toFixed(2),deltaPurity:(((null==t?void 0:t.stdPurity)||0)-1e3*((null==t?void 0:t.purity)||0)).toFixed(2)})}},{component:"resourcecombobox",label:eF.sku,name:"sku",props:{store:null==eT?void 0:eT.current,valueField:"itemId",displayField:"sku",refresh:!1,mapping:[{from:"itemName",to:"itemName"},{from:"itemId",to:"itemId"},{from:"sku",to:"sku"}],columnsInDropDown:[{key:"sku",value:"SKU"},{key:"itemName",value:"Item Name"}],displayFieldWidth:3.5},onChange:async e=>{var l,t,d,n;let{row:{update:a,newRow:i}}=e;eV(!0);let r=await ld(null==i?void 0:i.itemId),o=(null===(t=eH.values)||void 0===t?void 0:null===(l=t.header)||void 0===l?void 0:l.baseSalesMetalPurity)?(0*((null==i?void 0:i.qty)||0)/(null===(n=eH.values)||void 0===n?void 0:null===(d=n.header)||void 0===d?void 0:d.baseSalesMetalPurity)).toFixed(2):0;a({stdPurity:0,deltaPurity:(0-((null==i?void 0:i.purity)||0)).toFixed(2),newRmQty:o,deltaRMQty:(o-((null==i?void 0:i.rmQty)||0)).toFixed(2),isOpenMetalPurity:r})},propsReducer(e){let{row:l,props:t}=e;return{...t,store:null==eT?void 0:eT.current}},flex:1.5},{component:"textfield",label:eF.itemName,name:"itemName",props:{readOnly:!0},flex:2},{component:"numberfield",name:"qty",label:eF.qty,props:{allowNegative:!1,maxLength:11,decimalScale:2},async onChange(e){var l,t,d,n,a,i,r,o;let{row:{update:u,newRow:s}}=e;eV(!0);let c=(null===(t=eH.values)||void 0===t?void 0:null===(l=t.header)||void 0===l?void 0:l.baseSalesMetalPurity)?(((null==s?void 0:s.qty)||0)*((null==s?void 0:s.purity)||0)/(null===(n=eH.values)||void 0===n?void 0:null===(d=n.header)||void 0===d?void 0:d.baseSalesMetalPurity)).toFixed(2):0,v=(null===(i=eH.values)||void 0===i?void 0:null===(a=i.header)||void 0===a?void 0:a.baseSalesMetalPurity)?(((null==s?void 0:s.qty)||0)*((null==s?void 0:s.stdPurity)||0)/(null===(o=eH.values)||void 0===o?void 0:null===(r=o.header)||void 0===r?void 0:r.baseSalesMetalPurity)).toFixed(2):0;u({rmQty:c,newRmQty:v,deltaRMQty:(v-c).toFixed(2)})}},{component:"numberfield",name:"purity",label:eF.purity,props:{decimalScale:2},async onChange(e){var l,t,d,n;let{row:{update:a,newRow:i}}=e;eV(!0);let r=(null===(t=eH.values)||void 0===t?void 0:null===(l=t.header)||void 0===l?void 0:l.baseSalesMetalPurity)?(((null==i?void 0:i.qty)||0)*((null==i?void 0:i.purity)||0)/(null===(n=eH.values)||void 0===n?void 0:null===(d=n.header)||void 0===d?void 0:d.baseSalesMetalPurity)).toFixed(2):0;a({deltaPurity:(((null==i?void 0:i.stdPurity)||0)-((null==i?void 0:i.purity)||0)).toFixed(2),rmQty:r,deltaRMQty:(((null==i?void 0:i.newRmQty)||0)-r).toFixed(2)})},propsReducer(e){let{row:l,props:t}=e;return{...t,readOnly:!l.isOpenMetalPurity}}},{component:"numberfield",name:"rmQty",label:"".concat(eF.qty," ").concat((null===(Y=eH.values)||void 0===Y?void 0:null===(W=Y.header)||void 0===W?void 0:W.baseSalesMetalRef)||""),props:{decimalScale:2,readOnly:!0}},{component:"numberfield",name:"stdPurity",label:eF.newPurity,updateOn:"blur",props:{decimalScale:2,maxLength:11,allowNegative:!1},async onChange(e){var l,t,d,n;let{row:{update:a,newRow:i}}=e;eV(!0);let r=(null===(t=eH.values)||void 0===t?void 0:null===(l=t.header)||void 0===l?void 0:l.baseSalesMetalPurity)?(((null==i?void 0:i.qty)||0)*((null==i?void 0:i.stdPurity)||0)/(null===(n=eH.values)||void 0===n?void 0:null===(d=n.header)||void 0===d?void 0:d.baseSalesMetalPurity)).toFixed(2):0;a({stdPurity:(null==i?void 0:i.stdPurity)||0,deltaPurity:(((null==i?void 0:i.stdPurity)||0)-((null==i?void 0:i.purity)||0)).toFixed(2),newRmQty:r,deltaRMQty:(r-((null==i?void 0:i.rmQty)||0)).toFixed(2)})}},{component:"numberfield",name:"newRmQty",label:"".concat(eF.newRmQty," ").concat((null===(el=eH.values)||void 0===el?void 0:null===(ee=el.header)||void 0===ee?void 0:ee.baseSalesMetalRef)||""),props:{decimalScale:2,readOnly:!0}},{component:"numberfield",name:"deltaRMQty",label:eF.diffQty,props:{decimalScale:2,readOnly:!0}},{component:"numberfield",name:"deltaPurity",label:eF.diffPurity,props:{readOnly:!0,decimalScale:2}}],li=[{key:"Locked",condition:e0,onClick:"onUnpostConfirmation",onSuccess:le,disabled:!eY},{key:"Unlocked",condition:!e0,onClick:e4,disabled:!eY},{key:"IV",condition:!0,onClick:"onInventoryTransaction",disabled:!eY||!e0},{key:"GL",condition:!0,onClick:"onClickGL",datasetId:a.i.GLTransactionItem,valuesPath:eH.values.header,disabled:!eY}];async function lr(e){if(!e)return;let l=await eC({extension:n.B.DocumentTypeDefault.get,parameters:"_dtId=".concat(e)});return(null==l?void 0:l.record)||{}}async function lo(){if(!ez)return;let e=await eC({extension:x.$.Metals.get,parameters:"_recordId=".concat(ez)});return(null==e?void 0:e.record)||{}}return(0,u.useEffect)(()=>{!async function(){if(!eR){var e,l;let t=await lr(null==eH?void 0:null===(l=eH.values)||void 0===l?void 0:null===(e=l.header)||void 0===e?void 0:e.dtId);eH.setFieldValue("header.siteId",(null==t?void 0:t.siteId)||null),eH.setFieldValue("header.workCenterId",(null==t?void 0:t.workCenterId)||null)}}()},[null===(ed=eH.values)||void 0===ed?void 0:null===(et=ed.header)||void 0===et?void 0:et.dtId]),(0,u.useEffect)(()=>{!async function(){if(ez&&!eR){let e=await lo();eH.setFieldValue("header.baseSalesMetalPurity",(null==e?void 0:e.purity)*1e3||0),eH.setFieldValue("header.baseSalesMetalRef",(null==e?void 0:e.reference)||"")}}()},[ez]),(0,u.useEffect)(()=>{!async function(){await lt(),eR&&ln(eR)}()},[]),(0,d.jsx)(I.Z,{resourceId:a.i.PurityAdjustment,form:eH,maxAccess:eJ,actions:li,previewReport:eY,editMode:eY,functionId:eB,disabledSubmit:e0,children:(0,d.jsxs)(g.R,{children:[(0,d.jsx)(b.g,{children:(0,d.jsxs)(c.ZP,{container:!0,spacing:2,children:[(0,d.jsx)(c.ZP,{item:!0,xs:6,children:(0,d.jsxs)(c.ZP,{container:!0,spacing:2,children:[(0,d.jsx)(c.ZP,{item:!0,xs:12,children:(0,d.jsx)(P.Z,{endpointId:n.B.PurityAdjustment.combos,reducer:e=>{var l;return null==e?void 0:null===(l=e.record)||void 0===l?void 0:l.documentTypes},filter:eY?void 0:e=>1===e.activeStatus,name:"header.dtId",label:eF.docType,readOnly:eY,valueField:"recordId",displayField:"name",values:eH.values.header,onChange:(e,l)=>{eL(l),eH.setFieldValue("header.dtId",(null==l?void 0:l.recordId)||null)},error:(null===(en=eH.touched.header)||void 0===en?void 0:en.dtId)&&!!(null===(ea=eH.errors.header)||void 0===ea?void 0:ea.dtId),maxAccess:eJ})}),(0,d.jsx)(c.ZP,{item:!0,xs:12,children:(0,d.jsx)(w.Z,{name:"header.reference",label:eF.reference,value:eH.values.header.reference,readOnly:eY,maxAccess:!eY&&eJ,maxLength:"15",onChange:eH.handleChange,onClear:()=>eH.setFieldValue("header.reference",""),error:(null===(ei=eH.touched.header)||void 0===ei?void 0:ei.reference)&&!!(null===(er=eH.errors.header)||void 0===er?void 0:er.reference)})}),(0,d.jsx)(c.ZP,{item:!0,xs:12,children:(0,d.jsx)(j.Z,{name:"header.date",required:!0,readOnly:e0,label:eF.date,value:eH.values.header.date,onChange:eH.setFieldValue,maxAccess:eJ,onClear:()=>eH.setFieldValue("header.date",null),error:(null===(eo=eH.touched.header)||void 0===eo?void 0:eo.date)&&!!(null===(eu=eH.errors.header)||void 0===eu?void 0:eu.date)})})]})}),(0,d.jsx)(c.ZP,{item:!0,xs:6,children:(0,d.jsxs)(c.ZP,{container:!0,spacing:2,children:[(0,d.jsx)(c.ZP,{item:!0,xs:12,children:(0,d.jsx)(P.Z,{endpointId:n.B.PurityAdjustment.combos,reducer:e=>{var l;return null==e?void 0:null===(l=e.record)||void 0===l?void 0:l.plants},name:"header.plantId",readOnly:eY,required:!0,label:eF.plant,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:eH.values.header,maxAccess:eJ,onChange:(e,l)=>{eH.setFieldValue("header.plantId",(null==l?void 0:l.recordId)||null)},error:(null===(es=eH.touched.header)||void 0===es?void 0:es.plantId)&&!!(null===(ec=eH.errors.header)||void 0===ec?void 0:ec.plantId)})}),(0,d.jsx)(c.ZP,{item:!0,xs:12,children:(0,d.jsx)(P.Z,{endpointId:n.B.PurityAdjustment.combos,reducer:e=>{var l;return null==e?void 0:null===(l=e.record)||void 0===l?void 0:l.sites},name:"header.siteId",label:eF.site,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],valueField:"recordId",displayField:["reference","name"],values:eH.values.header,maxAccess:eJ,readOnly:e0,onChange:(e,l)=>eH.setFieldValue("header.siteId",(null==l?void 0:l.recordId)||null),required:!0,error:(null===(ev=eH.touched.header)||void 0===ev?void 0:ev.siteId)&&!!(null===(em=eH.errors.header)||void 0===em?void 0:em.siteId)})}),(0,d.jsx)(c.ZP,{item:!0,xs:12,children:(0,d.jsx)(P.Z,{endpointId:n.B.PurityAdjustment.combos,reducer:e=>{var l;return null==e?void 0:null===(l=e.record)||void 0===l?void 0:l.workCenters},name:"header.workCenterId",label:eF.workCenter,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:eH.values.header,required:!0,readOnly:e0,maxAccess:eJ,onChange:(e,l)=>eH.setFieldValue("header.workCenterId",(null==l?void 0:l.recordId)||null),error:(null===(ey=eH.touched.header)||void 0===ey?void 0:ey.workCenterId)&&(null===(eh=eH.errors.header)||void 0===eh?void 0:eh.workCenterId)})})]})})]})}),(0,d.jsx)(k.Q,{children:(0,d.jsx)(S._,{onChange:(e,l)=>{eH.setFieldValue("items",e),"delete"===l&&eV(!0)},value:null===(ep=eH.values)||void 0===ep?void 0:ep.items,error:null===(ef=eH.errors)||void 0===ef?void 0:ef.items,name:"items",columns:la,initialValues:null==eH?void 0:null===(eI=eH.initialValues)||void 0===eI?void 0:null===(ex=eI.items)||void 0===ex?void 0:ex[0],maxAccess:eJ,disabled:e0,allowDelete:!e0,onSelectionChange:(e,l,t)=>{"sku"==t&&ll(null==e?void 0:e.metalId)}})}),(0,d.jsx)(b.g,{children:(0,d.jsxs)(c.ZP,{container:!0,xs:12,children:[(0,d.jsx)(c.ZP,{item:!0,xs:6,children:(0,d.jsx)(F.Z,{name:"header.notes",label:eF.notes,value:null===(eg=eH.values.header)||void 0===eg?void 0:eg.notes,rows:4,maxLength:"200",readOnly:e0,maxAccess:eJ,onChange:e=>eH.setFieldValue("header.notes",e.target.value),onClear:()=>eH.setFieldValue("header.notes",""),error:(null===(eb=eH.touched.header)||void 0===eb?void 0:eb.notes)&&!!(null===(eP=eH.errors.header)||void 0===eP?void 0:eP.notes)})}),(0,d.jsxs)(c.ZP,{container:!0,xs:6,justifyContent:"flex-end",children:[(0,d.jsxs)(c.ZP,{container:!0,xs:4,spacing:2,children:[(0,d.jsx)(c.ZP,{item:!0,xs:12,children:(0,d.jsx)(N.Z,{label:eF.totalQty,value:e1,decimalScale:2,readOnly:!0,align:"right"})}),(0,d.jsx)(c.ZP,{item:!0,xs:12,children:(0,d.jsx)(N.Z,{label:"".concat(eF.totalQty," ").concat((null===(ej=eH.values)||void 0===ej?void 0:null===(ew=ej.header)||void 0===ew?void 0:ew.baseSalesMetalRef)||""),value:e3,decimalScale:2,readOnly:!0,align:"right"})}),(0,d.jsx)(c.ZP,{item:!0,xs:12,children:(0,d.jsx)(N.Z,{label:"".concat(eF.totalNewRmQty," ").concat((null===(ek=eH.values)||void 0===ek?void 0:null===(eS=ek.header)||void 0===eS?void 0:eS.baseSalesMetalRef)||""),value:e6,decimalScale:2,readOnly:!0,align:"right"})}),(0,d.jsx)(c.ZP,{item:!0,xs:12,children:(0,d.jsx)(N.Z,{label:eF.totalDiffQty,value:e5,decimalScale:2,readOnly:!0,align:"right"})})]}),(0,d.jsxs)(c.ZP,{container:!0,xs:4,spacing:2,sx:{pl:1,height:"70%"},children:[(0,d.jsx)(c.ZP,{item:!0,xs:12,children:(0,d.jsx)(N.Z,{label:eF.avgPurity,value:e8,decimalScale:2,readOnly:!0,align:"right"})}),(0,d.jsx)(c.ZP,{item:!0,xs:12,children:(0,d.jsx)(N.Z,{label:eF.avgStdPurity,value:e9,decimalScale:2,readOnly:!0,align:"right"})}),(0,d.jsx)(c.ZP,{item:!0,xs:12,children:(0,d.jsx)(N.Z,{label:eF.totalDiffPurity,value:e7,decimalScale:2,readOnly:!0,align:"right"})})]})]})]})})]})})}var C=t(36908),Z=t(69387);function M(){let{getRequest:e,postRequest:l}=(0,u.useContext)(r.$),{platformLabels:t}=(0,u.useContext)(i.l),{stack:c}=(0,o.zY)();async function v(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{_startAt:t=0,_pageSize:d=50,params:a=[]}=l;return{...await e({extension:n.B.PurityAdjustment.page,parameters:"_startAt=".concat(t,"&_params=").concat(a,"&_pageSize=").concat(d,"&_functionId=").concat(m.J.PurityAdjustment)}),_startAt:t}}let{query:{data:p},refetch:f,labels:x,filterBy:I,paginationParameters:P,access:w,invalidate:j}=(0,h.J)({queryFn:v,endpointId:n.B.PurityAdjustment.page,datasetId:a.i.PurityAdjustment,filter:{filterFn:S}});async function S(l){let{filters:t,pagination:d}=l;return(null==t?void 0:t.qry)?await e({extension:n.B.PurityAdjustment.snapshot,parameters:"_filter=".concat(t.qry,"&_functionId=").concat(m.J.PurityAdjustment)}):v({_startAt:d._startAt||0,params:null==t?void 0:t.params})}let F=[{field:"reference",headerName:x.reference,flex:1},{field:"dtName",headerName:x.docType,flex:1},{field:"date",headerName:x.date,flex:1,type:"date"},{field:"plantName",headerName:x.plant,flex:1},{field:"siteRef",headerName:x.siteRef,flex:1},{field:"siteName",headerName:x.siteName,flex:1},{field:"statusName",headerName:x.status,flex:1}];function N(e){c({Component:A,props:{labels:x,recordId:e,access:w},width:1050,height:750,title:x.purityAdjustment})}let{proxyAction:R}=(0,y.G)({functionId:m.J.PurityAdjustment,action:N}),M=async()=>{await R()},O=async e=>{await l({extension:n.B.PurityAdjustment.del,record:JSON.stringify(e)}),j(),s.ZP.success(t.Deleted)};return(0,d.jsxs)(g.R,{children:[(0,d.jsx)(b.g,{children:(0,d.jsx)(C.Z,{onAdd:M,maxAccess:w,reportName:"FOTRX",filterBy:I})}),(0,d.jsx)(k.Q,{children:(0,d.jsx)(Z.Z,{name:"table",columns:F,gridData:p,rowId:["recordId"],onEdit:e=>{N(null==e?void 0:e.recordId)},onDelete:O,deleteConfirmationType:"strict",pageSize:50,paginationParameters:P,refetch:f,paginationType:"api",maxAccess:w})})]})}},67920:function(e,l,t){"use strict";t.d(l,{m:function(){return n}});var d=t(48601);function n(e,l,t){var n;let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"items",i={...e};return null==t||null===(n=t.record)||void 0===n||n.controls.forEach(e=>{let{controlId:l,accessLevel:t}=e,[d,n]=null==l?void 0:l.split(".");d!==a||2!==t||n in i||(i[n]=e=>(null==e?void 0:e[n])!=null),(1===t||4===t)&&n in i&&delete i[n]}),{schema:d.Ry().shape({...Object.keys(i).reduce((e,t)=>(e[t]=d.nK().nullable().test(function(e){var d;let n=this.parent,[,a]=this.path.match(/^(\w+)\[(\d+)\]/)||[],r=(null===(d=this.options.context)||void 0===d?void 0:d[a])||[];if(l||!l&&r.length>1){if(null!==n[t]&&void 0!==n[t]&&0!==n[t]&&""!==i[t]&&!i[t](n))return!1;if(!Object.entries(i).some(e=>{let[,l]=e;return!!l(n)}))return!0}return!!i[t](n)&&void 0!==e}),e),{})}),requiredFields:i}}},1685:function(e,l,t){"use strict";t.d(l,{m:function(){return d}});let d=e=>{let l=window.sessionStorage.getItem(e);return l?JSON.parse(l):null}},98345:function(e,l,t){"use strict";t.d(l,{H:function(){return h},G:function(){return y}});var d=t(45300),n=t(2784),a=t(96026),i=t(38449);t(26612);var r=t(65947),o=t(1685);let u=async(e,l,t)=>{try{let d=await e({extension:l,parameters:t});return l.includes("qry")?d:d.record}catch(e){return null}},s=(e,l,t,d)=>{let n=(e=JSON.parse(JSON.stringify(e))).record.controls,a=n.find(e=>"reference"===e.controlId);return a?a.accessLevel=(null==l?void 0:l.mandatory)?r.$7:r.rr:(null==l?void 0:l.mandatory)?n.push({sgId:0,resourceId:"",controlId:"".concat(d?d+".":"","reference"),accessLevel:(null==l?void 0:l.mandatory)?r.$7:r.rr}):(null==l?void 0:l.readOnly)?n.push({sgId:0,resourceId:"",controlId:"".concat(d?d+".":"","reference"),accessLevel:(null==l?void 0:l.readOnly)?r.rr:r.$7}):n=e.record.controls.filter(e=>"reference"!=e.controlId),t&&n.push({sgId:0,resourceId:"",controlId:"".concat(d?d+".":"","dtId"),accessLevel:r.$7}),{...e,record:{...e.record,controls:n}}},c=async(e,l,t)=>{let d,n;switch(t){case"dtId":let a=(0,o.m)("userData"),r=null==a?void 0:a.userId;n="_userId=".concat(r,"&_functionId=").concat(l),d=i.r.UserFunction.get;break;case"glbSysNumberRange":n="_recordId=".concat(l),d=i.r.SystemFunction.get;break;case"DocumentType":n="_dgId=".concat(l,"&_startAt=",0,"&_pageSize=",50),d=i.r.DocumentType.qry;break;case"DcTypNumberRange":n="_recordId=".concat(l),d=i.r.DocumentType.get;break;case"isExternal":n="_recordId=".concat(l),d=i.r.NumberRange.get;break;default:return null}return await u(e,d,n)},v=async function(e){let l,t,d,n,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,o=!(arguments.length>4)||void 0===arguments[4]||arguments[4],u=arguments.length>5?arguments[5]:void 0,v=void 0===r&&a&&await c(e,a,"dtId"),m=null==v?void 0:v.dtId,y="",h=!0;if(v&&void 0===r||"nraId"===r){if(m){let t=await c(e,m,"DcTypNumberRange");l=null==t?void 0:t.nraId,h=!((null==t?void 0:t.activeStatus)<0),l||(y="Assign the document type to a number range")}if((!m||!h)&&o&&a){var p;let l=await c(e,a,"DocumentType");n=(null==l?void 0:null===(p=l.list)||void 0===p?void 0:p.filter(e=>(null==e?void 0:e.activeStatus)===1).length)>0}}if(("nraId"===r||void 0===r)&&a){if((!m||m)&&!l||l&&!h){let t=await c(e,a,"glbSysNumberRange");(l=null==t?void 0:t.nraId)&&n&&(n=!1),h=!0}y=l||n?"":"Assign the system Function to a number range"}r>0&&!l&&(l=r),l&&h?(t={readOnly:null==(d=await c(e,l,"isExternal"))||!d.external,mandatory:null!=d&&!!d.external},i&&(i=await s(i,t,n,u))):!l&&i&&(i=await s(i,t,n,u));let f=u?"".concat(u,".reference"):"reference";return{dtId:m,resetReference:null==t?void 0:t.readOnly,dcTypeRequired:n,reference:{fieldName:f,isEmpty:(null==d?void 0:d.external)!==void 0&&(null==d||!d.external)},errorMessage:y,maxAccess:i,selectNraId:r}};var m=t(65950);function y(e){let{functionId:l,action:t,hasDT:d}=e,{getRequest:i}=(0,n.useContext)(m.$),{stack:r}=(0,a.V)();return{proxyAction:async()=>{let e=await v(i,l,"",void 0,d);(null==e?void 0:e.errorMessage)?r({message:null==e?void 0:e.errorMessage}):await t()}}}function h(e){var l;let{functionId:t,access:i,hasDT:r,enabled:o=!0,objectName:u=""}=e,{getRequest:s}=(0,n.useContext)(m.$),{stack:c}=(0,a.V)(),[y,h]=(0,n.useState)(),p=async e=>{let l=await v(s,t,i,e,r,u);if(!l.errorMessage)return l;c({message:null==l?void 0:l.errorMessage})},f=(0,d.a)({retry:!1,staleTime:0,enabled:o,queryKey:[t,y,!!i,o],queryFn:y||"nraId"===y?()=>p(y):()=>p()});return{documentType:f.data,maxAccess:(null==f?void 0:null===(l=f.data)||void 0===l?void 0:l.maxAccess)||i,changeDT(e){h((null==e?void 0:e.nraId)||"nraId")}}}}},function(e){e.O(0,[92515,2494,36908,49774,92888,40179],function(){return e(e.s=26331)}),_N_E=e.O()}]);