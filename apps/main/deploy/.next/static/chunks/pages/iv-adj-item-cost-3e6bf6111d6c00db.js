(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[67359],{14924:function(e,n,d){(window.__NEXT_P=window.__NEXT_P||[]).push(["/iv-adj-item-cost",function(){return d(13919)}])},13919:function(e,n,d){"use strict";d.r(n),d.d(n,{default:function(){return S}});var t=d(52322),r=d(2784),a=d(71987),o=d(65950),l=d(69387),i=d(62202),s=d(61802),u=d(26612),c=d(31389),v=d(33625),m=d(62362),h=d(19473),I=d(36908),f=d(98345),p=d(7121),y=d(65215),x=d(89330),g=d(39812),C=d(60218),w=d(48601),j=d(82737),k=d(5088),A=d(21581),b=d(8661),N=d(38449),_=d(76399),Z=d(80983);function F(e){var n,d,l,s,I,F,S,D,O,P,T,$,q,V,R,E,J,L,z,G;let{labels:M,access:U,recordId:X}=e,{getRequest:H,postRequest:K}=(0,r.useContext)(o.$),{platformLabels:Q}=(0,r.useContext)(h.l),{documentType:B,maxAccess:W,changeDT:Y}=(0,f.H)({functionId:p.J.AdjustmentCost,access:U,enabled:!X}),ee=(0,a.E)({endpointId:y.$.AdjustItemCost.page}),{formik:en}=(0,Z.c)({maxAccess:W,documentType:{key:"header.dtId",value:null==B?void 0:B.dtId},initialValues:{recordId:X,header:{recordId:null,dtId:null,reference:"",plantId:null,notes:"",date:new Date,status:1},rows:[{id:1,acoId:X,sku:"",itemName:"",unitCost:0,notes:"",seqNo:""}]},validateOnChange:!0,validationSchema:w.Ry({header:w.Ry({date:w.hT().required()}),rows:w.IX().of(w.Ry().shape({sku:w.Z_().required(),itemName:w.Z_().required(),unitCost:w.Rx().required()})).required()}),onSubmit:async e=>{let n={header:{...e.header,date:(0,g.ku)(e.header.date)},items:en.values.rows.map((n,d)=>{var t;return{...n,acoId:null!==(t=e.recordId)&&void 0!==t?t:0,seqNo:d+1}})},d=await K({extension:y.$.AdjustItemCost.set2,record:JSON.stringify(n)});en.setFieldValue("recordId",d.recordId),en.setFieldValue("header.recordId",d.recordId),i.ZP.success(e.recordId?Q.Edited:Q.Added),ee(),es(null==d?void 0:d.recordId)}}),ed=!!en.values.recordId,et=3===en.values.header.status;async function er(){let e=await K({extension:y.$.AdjustItemCost.post,record:JSON.stringify({...en.values.header,date:(0,g.ku)(en.values.header.date)})});(null==e?void 0:e.recordId)&&(i.ZP.success(Q.Posted),ee(),es(null==e?void 0:e.recordId))}async function ea(e){if(e){var n,d,t,r;let a=await H({extension:y.$.DocumentTypeDefaults.get,parameters:"_dtId=".concat(e)});return en.setFieldValue("header.plantId",(null==a?void 0:null===(n=a.record)||void 0===n?void 0:n.plantId)?null==a?void 0:null===(d=a.record)||void 0===d?void 0:d.plantId:null==en?void 0:null===(r=en.values)||void 0===r?void 0:null===(t=r.header)||void 0===t?void 0:t.plantId),a}}(0,r.useEffect)(()=>{var e,n;ea(null==en?void 0:null===(n=en.values)||void 0===n?void 0:null===(e=n.header)||void 0===e?void 0:e.dtId)},[null===(d=en.values)||void 0===d?void 0:null===(n=d.header)||void 0===n?void 0:n.dtId]);let eo=async e=>{var n;let d=await H({extension:y.$.CurrentCost.get,parameters:"_itemId="+e});return null==d?void 0:null===(n=d.record)||void 0===n?void 0:n.currentCost},el=[{component:"resourcelookup",label:M.sku,name:"sku",props:{endpointId:y.$.Item.snapshot,valueField:"sku",displayField:"sku",mapping:[{from:"recordId",to:"itemId"},{from:"sku",to:"sku"},{from:"name",to:"itemName"}],columnsInDropDown:[{key:"sku",value:"SKU"},{key:"name",value:"Name"}],displayFieldWidth:3},async onChange(e){var n;let{row:{update:d,newRow:t}}=e;(null==t?void 0:t.itemId)&&d({unitCost:null!==(n=await eo(null==t?void 0:t.itemId))&&void 0!==n?n:0})}},{component:"textfield",label:M.itemName,name:"itemName",props:{readOnly:!0}},{component:"numberfield",name:"unitCost",label:M.unitCost},{component:"textfield",label:M.notes,name:"notes"}],ei=async()=>{let e=await K({extension:y.$.AdjustItemCost.unpost,record:JSON.stringify(en.values.header)});(null==e?void 0:e.recordId)&&(i.ZP.success(Q.Unposted),ee(),es(null==e?void 0:e.recordId))};async function es(e){var n,d,t,r,a;let o=await H({extension:y.$.AdjustItemCost.get2,parameters:"_recordId=".concat(e)});if(null==o?void 0:null===(n=o.record)||void 0===n?void 0:n.header){let e=null==o?void 0:null===(t=o.record)||void 0===t?void 0:null===(d=t.items)||void 0===d?void 0:d.map((e,n)=>({...e,id:n+1}));return en.setValues({recordId:o.record.header.recordId,header:{...o.record.header,date:(0,g.a1)(null==o?void 0:null===(a=o.record)||void 0===a?void 0:null===(r=a.header)||void 0===r?void 0:r.date)},rows:e}),null==o?void 0:o.record}}(0,r.useEffect)(()=>{X&&es(X)},[]);let eu=[{key:"GL",condition:!0,onClick:"onClickGL",datasetId:u.i.GLAdjustItemCost,valuesPath:en.values.header,disabled:!ed},{key:"Locked",condition:et,onClick:"onUnpostConfirmation",onSuccess:ei,disabled:!ed},{key:"Unlocked",condition:!et,onClick:er,disabled:!ed},{key:"IV",condition:!0,onClick:"onInventoryTransaction",disabled:!ed||!et}];return(0,t.jsx)(j.Z,{resourceId:u.i.AdjustItemCost,functionId:p.J.AdjustmentCost,form:en,maxAccess:W,actions:eu,editMode:ed,previewReport:ed,disabledSubmit:et,children:(0,t.jsxs)(c.R,{children:[(0,t.jsx)(v.g,{children:(0,t.jsxs)(C.ZP,{container:!0,spacing:2,children:[(0,t.jsx)(C.ZP,{item:!0,xs:6,children:(0,t.jsxs)(C.ZP,{container:!0,spacing:2,children:[(0,t.jsx)(C.ZP,{item:!0,xs:12,children:(0,t.jsx)(b.Z,{endpointId:N.r.DocumentType.qry,parameters:"_startAt=0&_pageSize=1000&_dgId=".concat(p.J.AdjustmentCost),name:"header.dtId",label:M.documentType,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],readOnly:ed,valueField:"recordId",displayField:["reference","name"],values:en.values.header,maxAccess:W,onChange:(e,n)=>{en.setFieldValue("header.dtId",(null==n?void 0:n.recordId)||null),Y(n)},error:(null===(l=en.touched.header)||void 0===l?void 0:l.dtId)&&!!(null===(s=en.errors.header)||void 0===s?void 0:s.dtId)})}),(0,t.jsx)(C.ZP,{item:!0,xs:12,children:(0,t.jsx)(k.Z,{name:"header.reference",label:M.reference,value:null==en?void 0:null===(F=en.values)||void 0===F?void 0:null===(I=F.header)||void 0===I?void 0:I.reference,maxAccess:!ed&&W,maxLength:"30",readOnly:et,onChange:en.handleChange,onClear:()=>en.setFieldValue("header.reference",""),error:(null===(S=en.touched.header)||void 0===S?void 0:S.reference)&&!!(null===(D=en.errors.header)||void 0===D?void 0:D.reference)})}),(0,t.jsx)(C.ZP,{item:!0,xs:12,children:(0,t.jsx)(x.Z,{name:"header.date",label:M.date,readOnly:et,value:null==en?void 0:null===(O=en.values)||void 0===O?void 0:O.header.date,onChange:en.setFieldValue,required:!0,maxAccess:W,onClear:()=>en.setFieldValue("header.date",null),error:(null==en?void 0:null===(T=en.touched)||void 0===T?void 0:null===(P=T.header)||void 0===P?void 0:P.date)&&!!(null==en?void 0:null===(q=en.errors)||void 0===q?void 0:null===($=q.header)||void 0===$?void 0:$.date)})})]})}),(0,t.jsx)(C.ZP,{item:!0,xs:6,children:(0,t.jsxs)(C.ZP,{container:!0,spacing:2,children:[(0,t.jsx)(C.ZP,{item:!0,xs:12,children:(0,t.jsx)(b.Z,{endpointId:N.r.Plant.qry,name:"header.plantId",label:M.plant,readOnly:et,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:en.values.header,valueField:"recordId",displayField:["reference","name"],maxAccess:W,onChange:(e,n)=>{en.setFieldValue("header.plantId",(null==n?void 0:n.recordId)||null)},error:(null==en?void 0:null===(R=en.touched)||void 0===R?void 0:null===(V=R.header)||void 0===V?void 0:V.plantId)&&!!(null==en?void 0:null===(J=en.errors)||void 0===J?void 0:null===(E=J.header)||void 0===E?void 0:E.plantId)})}),(0,t.jsx)(C.ZP,{item:!0,xs:12,children:(0,t.jsx)(A.Z,{name:"header.notes",label:M.description,value:null===(L=en.values.header)||void 0===L?void 0:L.notes,readOnly:et,maxAccess:W,onChange:en.handleChange,onClear:()=>en.setFieldValue("header.notes",""),error:(null===(z=en.touched.header)||void 0===z?void 0:z.notes)&&!!(null===(G=en.errors.header)||void 0===G?void 0:G.notes)})})]})})]})}),(0,t.jsx)(m.Q,{children:(0,t.jsx)(_._,{onChange:e=>en.setFieldValue("rows",e),value:en.values.rows,error:en.errors.rows,name:"rows",maxAccess:W,columns:el,allowAddNewLine:!et,allowDelete:!et,disabled:et})})]})})}var S=()=>{let{postRequest:e,getRequest:n}=(0,r.useContext)(o.$),{platformLabels:d}=(0,r.useContext)(h.l),{stack:x}=(0,s.zY)(),{query:{data:g},filterBy:C,refetch:w,labels:j,access:k,paginationParameters:A,invalidate:b}=(0,a.J)({queryFn:_,endpointId:y.$.AdjustItemCost.page,datasetId:u.i.AdjustItemCost,filter:{filterFn:Z}}),N=[{field:"reference",headerName:j.reference,flex:1},{field:"dtName",headerName:j.documentType,flex:1},{field:"date",headerName:j.date,flex:1,type:"date"},{field:"notes",headerName:j.notes,flex:2},{field:"statusName",headerName:j.status,flex:1}];async function _(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{_startAt:d=0,_pageSize:t=50,params:r=[]}=e;return{...await n({extension:y.$.AdjustItemCost.page,parameters:"_startAt=".concat(d,"&_pageSize=").concat(t,"&_params=").concat(r,"&filter=")}),_startAt:d}}async function Z(e){let{filters:d,pagination:t}=e;return(null==d?void 0:d.qry)?await n({extension:y.$.AdjustItemCost.snapshot,parameters:"_filter=".concat(d.qry)}):_({_startAt:t._startAt||0,params:null==d?void 0:d.params})}let{proxyAction:S}=(0,f.G)({functionId:p.J.AdjustmentCost,action:O}),D=async()=>{await S()};async function O(e){x({Component:F,props:{labels:j,access:k,recordId:e},width:850,height:680,title:j.AdjustItemCost})}let P=async n=>{await e({extension:y.$.AdjustItemCost.del,record:JSON.stringify(n)}),b(),i.ZP.success(d.Deleted)};return(0,t.jsxs)(c.R,{children:[(0,t.jsx)(v.g,{children:(0,t.jsx)(I.Z,{onAdd:D,maxAccess:k,filterBy:C,reportName:"IVACO"})}),(0,t.jsx)(m.Q,{children:(0,t.jsx)(l.Z,{columns:N,gridData:g,rowId:["recordId"],onEdit:e=>{O(e.recordId)},refetch:w,onDelete:P,deleteConfirmationType:"strict",isLoading:!1,pageSize:50,maxAccess:k,paginationParameters:A,paginationType:"api"})})]})}},1685:function(e,n,d){"use strict";d.d(n,{m:function(){return t}});let t=e=>{let n=window.sessionStorage.getItem(e);return n?JSON.parse(n):null}},98345:function(e,n,d){"use strict";d.d(n,{H:function(){return I},G:function(){return h}});var t=d(45300),r=d(2784),a=d(96026),o=d(38449);d(26612);var l=d(65947),i=d(1685);let s=async(e,n,d)=>{try{let t=await e({extension:n,parameters:d});return n.includes("qry")?t:t.record}catch(e){return null}},u=(e,n,d,t)=>{let r=(e=JSON.parse(JSON.stringify(e))).record.controls,a=r.find(e=>"reference"===e.controlId);return a?a.accessLevel=(null==n?void 0:n.mandatory)?l.$7:l.rr:(null==n?void 0:n.mandatory)?r.push({sgId:0,resourceId:"",controlId:"".concat(t?t+".":"","reference"),accessLevel:(null==n?void 0:n.mandatory)?l.$7:l.rr}):(null==n?void 0:n.readOnly)?r.push({sgId:0,resourceId:"",controlId:"".concat(t?t+".":"","reference"),accessLevel:(null==n?void 0:n.readOnly)?l.rr:l.$7}):r=e.record.controls.filter(e=>"reference"!=e.controlId),d&&r.push({sgId:0,resourceId:"",controlId:"".concat(t?t+".":"","dtId"),accessLevel:l.$7}),{...e,record:{...e.record,controls:r}}},c=async(e,n,d)=>{let t,r;switch(d){case"dtId":let a=(0,i.m)("userData"),l=null==a?void 0:a.userId;r="_userId=".concat(l,"&_functionId=").concat(n),t=o.r.UserFunction.get;break;case"glbSysNumberRange":r="_recordId=".concat(n),t=o.r.SystemFunction.get;break;case"DocumentType":r="_dgId=".concat(n,"&_startAt=",0,"&_pageSize=",50),t=o.r.DocumentType.qry;break;case"DcTypNumberRange":r="_recordId=".concat(n),t=o.r.DocumentType.get;break;case"isExternal":r="_recordId=".concat(n),t=o.r.NumberRange.get;break;default:return null}return await s(e,t,r)},v=async function(e){let n,d,t,r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,o=arguments.length>2?arguments[2]:void 0,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,i=!(arguments.length>4)||void 0===arguments[4]||arguments[4],s=arguments.length>5?arguments[5]:void 0,v=void 0===l&&a&&await c(e,a,"dtId"),m=null==v?void 0:v.dtId,h="",I=!0;if(v&&void 0===l||"nraId"===l){if(m){let d=await c(e,m,"DcTypNumberRange");n=null==d?void 0:d.nraId,I=!((null==d?void 0:d.activeStatus)<0),n||(h="Assign the document type to a number range")}if((!m||!I)&&i&&a){var f;let n=await c(e,a,"DocumentType");r=(null==n?void 0:null===(f=n.list)||void 0===f?void 0:f.filter(e=>(null==e?void 0:e.activeStatus)===1).length)>0}}if(("nraId"===l||void 0===l)&&a){if((!m||m)&&!n||n&&!I){let d=await c(e,a,"glbSysNumberRange");(n=null==d?void 0:d.nraId)&&r&&(r=!1),I=!0}h=n||r?"":"Assign the system Function to a number range"}l>0&&!n&&(n=l),n&&I?(d={readOnly:null==(t=await c(e,n,"isExternal"))||!t.external,mandatory:null!=t&&!!t.external},o&&(o=await u(o,d,r,s))):!n&&o&&(o=await u(o,d,r,s));let p=s?"".concat(s,".reference"):"reference";return{dtId:m,resetReference:null==d?void 0:d.readOnly,dcTypeRequired:r,reference:{fieldName:p,isEmpty:(null==t?void 0:t.external)!==void 0&&(null==t||!t.external)},errorMessage:h,maxAccess:o,selectNraId:l}};var m=d(65950);function h(e){let{functionId:n,action:d,hasDT:t}=e,{getRequest:o}=(0,r.useContext)(m.$),{stack:l}=(0,a.V)();return{proxyAction:async()=>{let e=await v(o,n,"",void 0,t);(null==e?void 0:e.errorMessage)?l({message:null==e?void 0:e.errorMessage}):await d()}}}function I(e){var n;let{functionId:d,access:o,hasDT:l,enabled:i=!0,objectName:s=""}=e,{getRequest:u}=(0,r.useContext)(m.$),{stack:c}=(0,a.V)(),[h,I]=(0,r.useState)(),f=async e=>{let n=await v(u,d,o,e,l,s);if(!n.errorMessage)return n;c({message:null==n?void 0:n.errorMessage})},p=(0,t.a)({retry:!1,staleTime:0,enabled:i,queryKey:[d,h,!!o,i],queryFn:h||"nraId"===h?()=>f(h):()=>f()});return{documentType:p.data,maxAccess:(null==p?void 0:null===(n=p.data)||void 0===n?void 0:n.maxAccess)||o,changeDT(e){I((null==e?void 0:e.nraId)||"nraId")}}}}},function(e){e.O(0,[92515,2494,36908,49774,92888,40179],function(){return e(e.s=14924)}),_N_E=e.O()}]);