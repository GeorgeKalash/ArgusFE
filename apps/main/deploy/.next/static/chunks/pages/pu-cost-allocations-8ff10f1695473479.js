(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[60201],{382:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/pu-cost-allocations",function(){return n(60203)}])},60203:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return _}});var r=n(52322),a=n(2784),o=n(71987),l=n(65950),i=n(69387),c=n(62202),s=n(61802),d=n(26612),u=n(31389),f=n(33625),v=n(62362),m=n(19473),y=n(98345),p=n(7121),g=n(36908),h=n(98891),I=n(41451),_=()=>{let{postRequest:e,getRequest:t}=(0,a.useContext)(l.$),{platformLabels:n}=(0,a.useContext)(m.l),{stack:_}=(0,s.zY)();async function x(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{_startAt:n=0,_pageSize:r=50,params:a=[]}=e;return{...await t({extension:h.J.PuCostAllocations.page,parameters:"_startAt=".concat(n,"&_pageSize=").concat(r,"&_filter=&_sortField=&_params=").concat(a,"&_sortBy=recordId")}),_startAt:n}}async function w(e){let{filters:n,pagination:r}=e;return(null==n?void 0:n.qry)?await t({extension:h.J.PuCostAllocations.snapshot,parameters:"_filter=".concat(n.qry,"&_startAt=").concat(r._startAt||0,"&_size=").concat(r._size||50)}):x({_startAt:r._startAt||0,params:null==n?void 0:n.params})}let{query:{data:b},filterBy:N,refetch:A,labels:C,access:T,paginationParameters:S,invalidate:O}=(0,o.J)({queryFn:x,endpointId:h.J.PuCostAllocations.page,datasetId:d.i.PuCostAllocation,filter:{filterFn:w}}),k=[{field:"reference",headerName:C.reference,flex:1},{field:"baseAmount",headerName:C.amount,flex:1,type:"number"},{field:"date",headerName:C.date,flex:1,type:"date"},{field:"statusName",headerName:C.status,flex:1},{field:"wipName",headerName:C.wipName,flex:1}],{proxyAction:D}=(0,y.G)({functionId:p.J.CostAllocation,action:E});async function E(e){_({Component:I.Z,props:{recordId:null==e?void 0:e.recordId}})}let J=async t=>{await e({extension:h.J.PuCostAllocations.del,record:JSON.stringify(t)}),O(),c.ZP.success(n.Deleted)};return(0,r.jsxs)(u.R,{children:[(0,r.jsx)(f.g,{children:(0,r.jsx)(g.Z,{onAdd:()=>{D()},maxAccess:T,reportName:"COTRX",filterBy:N})}),(0,r.jsx)(v.Q,{children:(0,r.jsx)(i.Z,{name:"allocationsTable",columns:k,gridData:b,rowId:["recordId"],onEdit:e=>{E(e)},refetch:A,onDelete:J,deleteConfirmationType:"strict",isLoading:!1,pageSize:50,maxAccess:T,paginationParameters:S,paginationType:"api"})})]})}},67920:function(e,t,n){"use strict";n.d(t,{m:function(){return a}});var r=n(48601);function a(e,t,n){var a;let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"items",l={...e};return null==n||null===(a=n.record)||void 0===a||a.controls.forEach(e=>{let{controlId:t,accessLevel:n}=e,[r,a]=null==t?void 0:t.split(".");r!==o||2!==n||a in l||(l[a]=e=>(null==e?void 0:e[a])!=null),(1===n||4===n)&&a in l&&delete l[a]}),{schema:r.Ry().shape({...Object.keys(l).reduce((e,n)=>(e[n]=r.nK().nullable().test(function(e){var r;let a=this.parent,[,o]=this.path.match(/^(\w+)\[(\d+)\]/)||[],i=(null===(r=this.options.context)||void 0===r?void 0:r[o])||[];if(t||!t&&i.length>1){if(null!==a[n]&&void 0!==a[n]&&0!==a[n]&&""!==l[n]&&!l[n](a))return!1;if(!Object.entries(l).some(e=>{let[,t]=e;return!!t(a)}))return!0}return!!l[n](a)&&void 0!==e}),e),{})}),requiredFields:l}}},1685:function(e,t,n){"use strict";n.d(t,{m:function(){return r}});let r=e=>{let t=window.sessionStorage.getItem(e);return t?JSON.parse(t):null}},98345:function(e,t,n){"use strict";n.d(t,{H:function(){return y},G:function(){return m}});var r=n(45300),a=n(2784),o=n(96026),l=n(38449);n(26612);var i=n(65947),c=n(1685);let s=async(e,t,n)=>{try{let r=await e({extension:t,parameters:n});return t.includes("qry")?r:r.record}catch(e){return null}},d=(e,t,n,r)=>{let a=(e=JSON.parse(JSON.stringify(e))).record.controls,o=a.find(e=>"reference"===e.controlId);return o?o.accessLevel=(null==t?void 0:t.mandatory)?i.$7:i.rr:(null==t?void 0:t.mandatory)?a.push({sgId:0,resourceId:"",controlId:"".concat(r?r+".":"","reference"),accessLevel:(null==t?void 0:t.mandatory)?i.$7:i.rr}):(null==t?void 0:t.readOnly)?a.push({sgId:0,resourceId:"",controlId:"".concat(r?r+".":"","reference"),accessLevel:(null==t?void 0:t.readOnly)?i.rr:i.$7}):a=e.record.controls.filter(e=>"reference"!=e.controlId),n&&a.push({sgId:0,resourceId:"",controlId:"".concat(r?r+".":"","dtId"),accessLevel:i.$7}),{...e,record:{...e.record,controls:a}}},u=async(e,t,n)=>{let r,a;switch(n){case"dtId":let o=(0,c.m)("userData"),i=null==o?void 0:o.userId;a="_userId=".concat(i,"&_functionId=").concat(t),r=l.r.UserFunction.get;break;case"glbSysNumberRange":a="_recordId=".concat(t),r=l.r.SystemFunction.get;break;case"DocumentType":a="_dgId=".concat(t,"&_startAt=",0,"&_pageSize=",50),r=l.r.DocumentType.qry;break;case"DcTypNumberRange":a="_recordId=".concat(t),r=l.r.DocumentType.get;break;case"isExternal":a="_recordId=".concat(t),r=l.r.NumberRange.get;break;default:return null}return await s(e,r,a)},f=async function(e){let t,n,r,a,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,l=arguments.length>2?arguments[2]:void 0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,c=!(arguments.length>4)||void 0===arguments[4]||arguments[4],s=arguments.length>5?arguments[5]:void 0,f=void 0===i&&o&&await u(e,o,"dtId"),v=null==f?void 0:f.dtId,m="",y=!0;if(f&&void 0===i||"nraId"===i){if(v){let n=await u(e,v,"DcTypNumberRange");t=null==n?void 0:n.nraId,y=!((null==n?void 0:n.activeStatus)<0),t||(m="Assign the document type to a number range")}if((!v||!y)&&c&&o){var p;let t=await u(e,o,"DocumentType");a=(null==t?void 0:null===(p=t.list)||void 0===p?void 0:p.filter(e=>(null==e?void 0:e.activeStatus)===1).length)>0}}if(("nraId"===i||void 0===i)&&o){if((!v||v)&&!t||t&&!y){let n=await u(e,o,"glbSysNumberRange");(t=null==n?void 0:n.nraId)&&a&&(a=!1),y=!0}m=t||a?"":"Assign the system Function to a number range"}i>0&&!t&&(t=i),t&&y?(n={readOnly:null==(r=await u(e,t,"isExternal"))||!r.external,mandatory:null!=r&&!!r.external},l&&(l=await d(l,n,a,s))):!t&&l&&(l=await d(l,n,a,s));let g=s?"".concat(s,".reference"):"reference";return{dtId:v,resetReference:null==n?void 0:n.readOnly,dcTypeRequired:a,reference:{fieldName:g,isEmpty:(null==r?void 0:r.external)!==void 0&&(null==r||!r.external)},errorMessage:m,maxAccess:l,selectNraId:i}};var v=n(65950);function m(e){let{functionId:t,action:n,hasDT:r}=e,{getRequest:l}=(0,a.useContext)(v.$),{stack:i}=(0,o.V)();return{proxyAction:async()=>{let e=await f(l,t,"",void 0,r);(null==e?void 0:e.errorMessage)?i({message:null==e?void 0:e.errorMessage}):await n()}}}function y(e){var t;let{functionId:n,access:l,hasDT:i,enabled:c=!0,objectName:s=""}=e,{getRequest:d}=(0,a.useContext)(v.$),{stack:u}=(0,o.V)(),[m,y]=(0,a.useState)(),p=async e=>{let t=await f(d,n,l,e,i,s);if(!t.errorMessage)return t;u({message:null==t?void 0:t.errorMessage})},g=(0,r.a)({retry:!1,staleTime:0,enabled:c,queryKey:[n,m,!!l,c],queryFn:m||"nraId"===m?()=>p(m):()=>p()});return{documentType:g.data,maxAccess:(null==g?void 0:null===(t=g.data)||void 0===t?void 0:t.maxAccess)||l,changeDT(e){y((null==e?void 0:e.nraId)||"nraId")}}}}},function(e){e.O(0,[92515,2494,36908,41451,49774,92888,40179],function(){return e(e.s=382)}),_N_E=e.O()}]);