(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[14056],{27848:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/commission-schedule",function(){return t(2266)}])},2266:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return E}});var s=t(52322),a=t(2784),l=t(62202),o=t(69387),i=t(27723),r=t(65950),c=t(26612),d=t(29326),u=t(9522),m=t(60218),b=t(78711),h=t(48601),v=t(82737),p=t(71987),x=t(5088),_=t(22341),f=t(8661),C=t(84100),j=t(31389),y=t(62362),g=t(19473);function I(e){let{labels:n,maxAccess:t,store:o,setStore:i}=e,{recordId:d}=o,{platformLabels:u}=(0,a.useContext)(g.l),{getRequest:I,postRequest:S}=(0,a.useContext)(r.$),A=(0,p.E)({endpointId:_.P.CommissionSchedule.page}),w=(0,b.TA)({initialValues:{recordId:null,name:"",type:null},validationSchema:h.Ry({name:h.Z_().required(),type:h.Rx().required()}),onSubmit:async e=>{let n=await S({extension:_.P.CommissionSchedule.set,record:JSON.stringify(e)});e.recordId||(i({recordId:n.recordId}),w.setFieldValue("recordId",n.recordId)),l.ZP.success(e.recordId?u.Edited:u.Added),A()}}),P=!!w.values.recordId;return(0,a.useEffect)(()=>{!async function(){if(d){let e=await I({extension:_.P.CommissionSchedule.get,parameters:"_recordId=".concat(d)});w.setValues({...e.record})}}()},[]),(0,s.jsx)(v.Z,{resourceId:c.i.CommissionSchedule,form:w,maxAccess:t,editMode:P,children:(0,s.jsx)(j.R,{children:(0,s.jsx)(y.Q,{children:(0,s.jsxs)(m.ZP,{container:!0,spacing:2,children:[(0,s.jsx)(m.ZP,{item:!0,xs:12,children:(0,s.jsx)(x.Z,{name:"name",label:n.name,value:w.values.name,required:!0,maxLength:"30",maxAccess:t,onChange:w.handleChange,onClear:()=>w.setFieldValue("name",""),error:w.touched.name&&!!w.errors.name})}),(0,s.jsx)(m.ZP,{item:!0,xs:12,children:(0,s.jsx)(f.Z,{datasetId:C.v.TYPE,name:"type",label:n.type,required:!0,readOnly:P,maxAccess:t,valueField:"key",displayField:"value",values:w.values,onClear:()=>w.setFieldValue("type",null),onChange:(e,n)=>{w.setFieldValue("type",(null==n?void 0:n.key)||null)},error:w.touched.type&&!!w.errors.type})})]})})})})}var S=t(80983),A=t(76399),w=t(67920),P=t(54074),T=e=>{var n;let{labels:t,maxAccess:o,store:i}=e,{getRequest:c,postRequest:d}=(0,a.useContext)(r.$),{platformLabels:u}=(0,a.useContext)(g.l),{recordId:m}=i,b=(0,p.E)({endpointId:_.P.CommissionScheduleBracket.page}),{schema:v,requiredFields:x}=(0,w.m)({minAmount:e=>(null==e?void 0:e.minAmount)!=null&&e.minAmount<=e.maxAmount,maxAmount:e=>(null==e?void 0:e.maxAmount)!=null&&e.minAmount<=e.maxAmount,pct:e=>(null==e?void 0:e.pct)!=null&&e.pct>=0&&e.pct<=100},!0,o,"rows"),{formik:f}=(0,S.c)({maxAccess:o,initialValues:{rows:[]},conditionSchema:["rows"],validationSchema:h.Ry({rows:h.IX().of(v)}),onSubmit:async e=>{let n=e.rows.filter(e=>{var n;return null===(n=Object.values(x))||void 0===n?void 0:n.some(n=>n(e))}).map((e,n)=>({...e,commissionScheduleId:m,seqNo:n+1}));await d({extension:_.P.CommissionSchedule.set2,record:JSON.stringify({commissionScheduleId:m,items:n})}),l.ZP.success(u.Updated),b()}}),C=async()=>{let e=await c({extension:_.P.CommissionScheduleBracket.qry,parameters:"_commissionScheduleId=".concat(m)});if(e.list.length>0){let n=e.list.map((e,n)=>({id:n+1,...e}));f.setValues({rows:n})}};(0,a.useEffect)(()=>{m&&C()},[m]);let I=[{component:"numberfield",label:t.min,name:"minAmount",props:{allowNegative:!1}},{component:"numberfield",label:t.max,name:"maxAmount",props:{allowNegative:!1}},{component:"numberfield",label:t.pct,name:"pct",props:{allowNegative:!1,maxLength:5,decimalScale:2}}];return(0,s.jsx)(P.Z,{onSave:f.handleSubmit,maxAccess:o,isParentWindow:!1,children:(0,s.jsx)(j.R,{children:(0,s.jsx)(y.Q,{children:(0,s.jsx)(A._,{name:"rows",maxAccess:o,value:f.values.rows,error:null===(n=f.errors)||void 0===n?void 0:n.rows,columns:I,onChange:e=>f.setFieldValue("rows",e)})})})})},Z=e=>{let{recordId:n,labels:t,maxAccess:l}=e,[o,i]=(0,a.useState)(0),[r,c]=(0,a.useState)({recordId:n||null}),m=[{label:t.schedule},{label:t.brackets,disabled:!r.recordId}];return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(u.Y,{tabs:m,activeTab:o,setActiveTab:i,maxAccess:l}),(0,s.jsx)(d.Z,{index:0,value:o,maxAccess:l,children:(0,s.jsx)(I,{labels:t,setStore:c,store:r,maxAccess:l})}),(0,s.jsx)(d.Z,{index:1,value:o,maxAccess:l,children:(0,s.jsx)(T,{labels:t,maxAccess:l,store:r})})]})},N=t(61802),R=t(33625),E=()=>{let{getRequest:e,postRequest:n}=(0,a.useContext)(r.$),{platformLabels:t}=(0,a.useContext)(g.l),{stack:d}=(0,N.zY)(),{query:{data:u},labels:m,paginationParameters:b,invalidate:h,refetch:v,access:x}=(0,p.J)({queryFn:f,endpointId:_.P.CommissionSchedule.page,datasetId:c.i.CommissionSchedule});async function f(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{_startAt:t=0,_pageSize:s=50}=n;return{...await e({extension:_.P.CommissionSchedule.page,parameters:"_startAt=".concat(t,"&_pageSize=").concat(s)}),_startAt:t}}let C=[{field:"name",headerName:m.name,flex:1},{field:"typeName",headerName:m.type,flex:1}],I=async e=>{await n({extension:_.P.CommissionSchedule.del,record:JSON.stringify(e)}),l.ZP.success(t.Deleted),h()};function S(e){d({Component:Z,props:{labels:m,recordId:e,maxAccess:x},width:600,title:m.CommissionSchedule})}return(0,s.jsxs)(j.R,{children:[(0,s.jsx)(R.g,{children:(0,s.jsx)(i.Z,{onAdd:()=>{S()},maxAccess:x})}),(0,s.jsx)(y.Q,{children:(0,s.jsx)(o.Z,{columns:C,gridData:u,rowId:["recordId"],paginationParameters:b,paginationType:"api",refetch:v,onEdit:e=>{S(null==e?void 0:e.recordId)},onDelete:I,pageSize:50,maxAccess:x})})]})}},67920:function(e,n,t){"use strict";t.d(n,{m:function(){return a}});var s=t(48601);function a(e,n,t){var a;let l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"items",o={...e};return null==t||null===(a=t.record)||void 0===a||a.controls.forEach(e=>{let{controlId:n,accessLevel:t}=e,[s,a]=null==n?void 0:n.split(".");s!==l||2!==t||a in o||(o[a]=e=>(null==e?void 0:e[a])!=null),(1===t||4===t)&&a in o&&delete o[a]}),{schema:s.Ry().shape({...Object.keys(o).reduce((e,t)=>(e[t]=s.nK().nullable().test(function(e){var s;let a=this.parent,[,l]=this.path.match(/^(\w+)\[(\d+)\]/)||[],i=(null===(s=this.options.context)||void 0===s?void 0:s[l])||[];if(n||!n&&i.length>1){if(null!==a[t]&&void 0!==a[t]&&0!==a[t]&&""!==o[t]&&!o[t](a))return!1;if(!Object.entries(o).some(e=>{let[,n]=e;return!!n(a)}))return!0}return!!o[t](a)&&void 0!==e}),e),{})}),requiredFields:o}}},29326:function(e,n,t){"use strict";var s=t(52322);t(2784);var a=t(23925),l=t(13980),o=t.n(l),i=t(95291),r=t.n(i),c=t(65947);let d=e=>{var n,t,l;let{children:o,value:i,index:d,maxAccess:u,...m}=e,b="".concat(e.name||"tab",".").concat(d),{accessLevel:h}=null!==(l=(null!==(t=null==u?void 0:null===(n=u.record)||void 0===n?void 0:n.controls)&&void 0!==t?t:[]).find(e=>e.controlId===b))&&void 0!==l?l:{accessLevel:0};if(h===c.A1)return null;let v=i===d;return(0,s.jsx)(a.Z,{role:"tabpanel",hidden:!v,id:"simple-tabpanel-".concat(d),"aria-labelledby":"simple-tab-".concat(d),className:"".concat(r().tabPanel," ").concat(v?r().active:r().hidden),...m,children:o})};d.propTypes={children:o().node,index:o().number.isRequired,value:o().number.isRequired},n.Z=d},9522:function(e,n,t){"use strict";t.d(n,{Y:function(){return m}});var s=t(52322),a=t(23925),l=t(54582),o=t(68696),i=t(44258),r=t(2784),c=t(99266),d=t(52614),u=t.n(d);let m=e=>{var n,t,d,m,b;let{tabs:h,activeTab:v,setActiveTab:p,maxAccess:x,name:_="tab"}=e,f=(null==x?void 0:null===(t=x.record)||void 0===t?void 0:null===(n=t.controls)||void 0===n?void 0:n.filter(e=>{var n;return 4===e.accessLevel&&(null===(n=e.controlId)||void 0===n?void 0:n.startsWith("".concat(_,".")))}).map(e=>e.controlId.split(".")[1]))||[],C=null==h?void 0:null===(d=h.map((e,n)=>({...e,id:n})))||void 0===d?void 0:d.filter((e,n)=>!f.includes(String(n))),j=null===(m=C[v])||void 0===m?void 0:m.id,y=null===(b=C[v])||void 0===b?void 0:b.disabled;return(0,r.useEffect)(()=>{j>=0&&!y&&v!=j&&p(j)},[]),(0,s.jsx)(a.Z,{className:u().tabsContainer,children:(0,s.jsx)(a.Z,{className:u().tabsWrapper,children:(0,s.jsx)(l.Z,{value:v,onChange:(e,n)=>p(n),variant:"scrollable",scrollButtons:C.length>3?"auto":"off","aria-label":"scrollable tabs",classes:{indicator:u().tabsIndicator},className:u().tabs,children:null==C?void 0:C.map(e=>(0,s.jsx)(o.Z,{value:e.id,disabled:null==e?void 0:e.disabled,className:"".concat(u().tabName," ").concat(e.disabled?u().tabDisabled:""),classes:{root:u().tabRoot,selected:u().selectedTab},label:(0,s.jsxs)(a.Z,{display:"flex",alignItems:"center",children:[(0,s.jsx)("span",{children:e.label}),e.id===v&&(null==e?void 0:e.onRefetch)&&(0,s.jsx)(i.Z,{size:"small",className:u().refreshButton,onClick:n=>{n.stopPropagation(),e.onRefetch()},children:(0,s.jsx)(c.Z,{className:u().refreshIcon})})]})},e.id))})})})}},95291:function(e){e.exports={tabPanel:"CustomTabPanel_tabPanel__80Dfu",active:"CustomTabPanel_active___6Uvb",hidden:"CustomTabPanel_hidden__y9566"}},52614:function(e){e.exports={customTabPanel:"CustomTabs_customTabPanel__Ztocv",hidden:"CustomTabs_hidden__lZpM7",tabsContainer:"CustomTabs_tabsContainer__28Syi",tabsWrapper:"CustomTabs_tabsWrapper__mlxxj",tabs:"CustomTabs_tabs__25pli",tabName:"CustomTabs_tabName__XzMCn",tabRoot:"CustomTabs_tabRoot__WVR1E",tabDisabled:"CustomTabs_tabDisabled__VauYR",selectedTab:"CustomTabs_selectedTab__sZzwF",tabsIndicator:"CustomTabs_tabsIndicator__89Lek",refreshButton:"CustomTabs_refreshButton__P2mzl",refreshIcon:"CustomTabs_refreshIcon__ADVWF"}}},function(e){e.O(0,[49774,92888,40179],function(){return e(e.s=27848)}),_N_E=e.O()}]);