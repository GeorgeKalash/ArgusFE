(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[59077],{40783:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/retail-comp-figures",function(){return a(201)}])},201:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return P}});var l=a(52322),r=a(2784),i=a(48601),s=a(65950),n=a(69387),o=a(71987),d=a(60218),u=a(23925),c=a(26612),f=a(80983),p=a(31389),v=a(33625),m=a(62362),h=a(19473),x=a(38449);let y="RG.PS.asmx/PS302";var Z=a(69627),N=a(84100),g=a(80968),j=a(8661),w=a(23654),C=a(98401),b=a(44258),k=a(11096),R=a(54280),S=a(13781),P=()=>{var e;let{getRequest:t}=(0,r.useContext)(s.$),{platformLabels:a}=(0,r.useContext)(h.l),{getAllKvsByDataset:P}=(0,r.useContext)(g.k),[A,_]=(0,r.useState)([]),[Y,E]=(0,r.useState)(!1),[F,M]=(0,r.useState)(""),[O,I]=(0,r.useState)(""),[q,G]=(0,r.useState)([]),[L,T]=(0,r.useState)([]),{query:{data:V},labels:z,access:D,refetch:K}=(0,o.J)({queryFn:B,endpointId:y,datasetId:c.i.POSComparativeFigures}),{formik:X}=(0,f.c)({initialValues:{fiscalYear:new Date().getFullYear(),posAnalysis:null},validationSchema:i.Ry({fiscalYear:i.Rx().required(),posAnalysis:i.Rx().required()}),maxAccess:D,validateOnChange:!0});async function B(){var e,a,l;let r=null==X?void 0:null===(e=X.values)||void 0===e?void 0:e.fiscalYear,i=await new Promise((e,t)=>{P({_dataset:N.v.MONTHS,callback:a=>{a?e(a):t()}})});H(i);let s=await t({extension:y,parameters:"_year=".concat(r)});if(!(null==s?void 0:s.list))return;let n=i.map(()=>0),o=[],d={posRef:null,plantName:null,total:0};i.forEach(e=>{d[e.key]=0}),null==s||s.list.forEach(e=>{let t={posRef:e.posRef,plantName:e.plantName,total:0},a=0;i.forEach((l,r)=>{let i=e.amounts.find(e=>e.monthId===Number(l.key)),s=i?i.amount:0;t[l.key]=s,a+=s,n[r]+=s}),t.total=a,d.total+=a,o.push(t)}),i.forEach((e,t)=>{d[e.key]=n[t]});let u=o.sort((e,t)=>t.total-e.total);u.unshift(d);let c=null===(a=[...i].sort((e,t)=>Number(e.key)-Number(t.key)))||void 0===a?void 0:a.map(e=>e.value);if(G(c),(null==X?void 0:null===(l=X.values)||void 0===l?void 0:l.posAnalysis)==2){let e=null==u?void 0:u.filter((e,t)=>0!==t).map(e=>e.total),t=null==u?void 0:u.filter((e,t)=>0!==t).map(e=>e.posRef);T(a=>({...a,categories:t,displayedGraph:Object.entries(e).filter(e=>{let[t]=e;return!isNaN(t)}).map(e=>{let[,t]=e;return t}).sort((e,t)=>t-e)}))}else T(e=>({...e,categories:c,displayedGraph:Object.entries(d).filter(e=>{let[t]=e;return!isNaN(t)}).map(e=>{let[,t]=e;return t})}));return{count:(null==u?void 0:u.length)||0,list:(null==u?void 0:u.length)?u:[]}}let H=e=>{let t=[...e].sort((e,t)=>Number(e.key)-Number(t.key)),a=[{field:"posRef",headerName:z.POS,width:200,pinned:"left"},{field:"plantName",headerName:z.plant,width:300,pinned:"left"},{field:"total",headerName:z.total,type:"number",width:180}];t.forEach(t=>{a.push({field:t.key,headerName:t.value,width:e.length<=8?null:130,flex:e.length<=8?1:null,type:"number"})}),_(a)};return(0,l.jsxs)(p.R,{children:[(0,l.jsx)(v.g,{children:(0,l.jsxs)(d.ZP,{container:!0,spacing:2,p:2,children:[(0,l.jsx)(d.ZP,{item:!0,xs:2,children:(0,l.jsx)(j.Z,{endpointId:x.r.FiscalYears.qry,name:"fiscalYear",label:z.year,valueField:"fiscalYear",displayField:"fiscalYear",values:X.values,onChange:(e,t)=>{(null==t?void 0:t.fiscalYear)&&X.setFieldValue("fiscalYear",null==t?void 0:t.fiscalYear)},required:!0,error:X.touched.fiscalYear&&!!X.errors.fiscalYear,maxAccess:D})}),(0,l.jsx)(d.ZP,{item:!0,xs:1,children:(0,l.jsx)(Z.Z,{onClick:()=>K(),label:a.Preview,image:"preview.png",color:"#231f20"})}),(0,l.jsx)(d.ZP,{item:!0,xs:2,children:(0,l.jsx)(j.Z,{datasetId:N.v.POS_ANALYSIS_SORT_LEVEL,name:"posAnalysis",label:" ",valueField:"key",displayField:"value",values:X.values,defaultIndex:0,required:!0,onChange:(e,t)=>{(null==t?void 0:t.key)&&X.setFieldValue("posAnalysis",null==t?void 0:t.key)},error:X.touched.posAnalysis&&!!X.errors.posAnalysis,maxAccess:D})}),(0,l.jsx)(d.ZP,{item:!0,xs:7})]})}),(0,l.jsx)(m.Q,{children:(0,l.jsx)(n.Z,{columns:A,gridData:V,rowId:["posRef"],maxAccess:D,pagination:!1,name:"compFigTable",selectionMode:(null==X?void 0:null===(e=X.values)||void 0===e?void 0:e.posAnalysis)==1?"row":"column",onSelectionChange:(e,t)=>{if(e){var a,l;if((null==X?void 0:null===(a=X.values)||void 0===a?void 0:a.posAnalysis)==2){if("plantName"===t||"posRef"===t||t===O)return;let a=null==V?void 0:null===(l=V.list)||void 0===l?void 0:l.filter((e,t)=>0!==t).map(e=>e.posRef);T(t=>({...t,categories:a,displayedGraph:Object.entries(null==e?void 0:e.filter((e,t)=>0!==t)).filter(e=>{let[t]=e;return!isNaN(t)}).map(e=>{let[,t]=e;return t}).sort((e,t)=>t-e)})),I(t)}else{if(t===F)return;T(t=>({...t,categories:q,displayedGraph:Object.entries(e).filter(e=>{let[t]=e;return!isNaN(t)}).map(e=>{let[,t]=e;return t})})),M(t)}}}})}),(0,l.jsx)(v.g,{children:(0,l.jsxs)(w.Z,{sx:{my:2,width:"100%",transition:"all 0.4s ease"},children:[(0,l.jsx)(u.Z,{sx:{display:"flex",justifyContent:"flex-end"},children:(0,l.jsx)(b.Z,{onClick:()=>E(!Y),sx:{display:"flex",margin:2,color:"black",backgroundColor:"#f0f0f0",borderRadius:"30%",padding:1,"&:hover":{backgroundColor:"#d9d9d9"}},size:"small",children:Y?(0,l.jsx)(k.Z,{}):(0,l.jsx)(R.Z,{})})}),!Y&&(0,l.jsx)(C.Z,{sx:{p:"8px !important"},children:(0,l.jsx)(S.Nw,{id:"compFigChart",labels:L.categories,datasets:L.displayedGraph,collapsed:Y})})]})})]})}},11096:function(e,t,a){"use strict";var l=a(71600);t.Z=void 0;var r=l(a(94834)),i=a(52322);t.Z=(0,r.default)((0,i.jsx)("path",{d:"M7.41 8.59 12 13.17l4.59-4.58L18 10l-6 6-6-6z"}),"KeyboardArrowDown")},54280:function(e,t,a){"use strict";var l=a(71600);t.Z=void 0;var r=l(a(94834)),i=a(52322);t.Z=(0,r.default)((0,i.jsx)("path",{d:"M7.41 15.41 12 10.83l4.59 4.58L18 14l-6-6-6 6z"}),"KeyboardArrowUp")},23654:function(e,t,a){"use strict";a.d(t,{Z:function(){return y}});var l=a(7896),r=a(31461),i=a(2784),s=a(83214),n=a(69075),o=a(44781),d=a(75596),u=a(34758),c=a(69222),f=a(15672);function p(e){return(0,f.ZP)("MuiCard",e)}(0,c.Z)("MuiCard",["root"]);var v=a(52322);let m=["className","raised"],h=e=>{let{classes:t}=e;return(0,n.Z)({root:["root"]},p,t)},x=(0,o.ZP)(u.Z,{name:"MuiCard",slot:"Root",overridesResolver:(e,t)=>t.root})(()=>({overflow:"hidden"}));var y=i.forwardRef(function(e,t){let a=(0,d.i)({props:e,name:"MuiCard"}),{className:i,raised:n=!1}=a,o=(0,r.Z)(a,m),u=(0,l.Z)({},a,{raised:n}),c=h(u);return(0,v.jsx)(x,(0,l.Z)({className:(0,s.Z)(c.root,i),elevation:n?8:void 0,ref:t,ownerState:u},o))})},98401:function(e,t,a){"use strict";a.d(t,{Z:function(){return x}});var l=a(7896),r=a(31461),i=a(2784),s=a(83214),n=a(69075),o=a(44781),d=a(75596),u=a(69222),c=a(15672);function f(e){return(0,c.ZP)("MuiCardContent",e)}(0,u.Z)("MuiCardContent",["root"]);var p=a(52322);let v=["className","component"],m=e=>{let{classes:t}=e;return(0,n.Z)({root:["root"]},f,t)},h=(0,o.ZP)("div",{name:"MuiCardContent",slot:"Root",overridesResolver:(e,t)=>t.root})(()=>({padding:16,"&:last-child":{paddingBottom:24}}));var x=i.forwardRef(function(e,t){let a=(0,d.i)({props:e,name:"MuiCardContent"}),{className:i,component:n="div"}=a,o=(0,r.Z)(a,v),u=(0,l.Z)({},a,{component:n}),c=m(u);return(0,p.jsx)(h,(0,l.Z)({as:n,className:(0,s.Z)(c.root,i),ownerState:u,ref:t},o))})}},function(e){e.O(0,[96767,86558,13781,49774,92888,40179],function(){return e(e.s=40783)}),_N_E=e.O()}]);