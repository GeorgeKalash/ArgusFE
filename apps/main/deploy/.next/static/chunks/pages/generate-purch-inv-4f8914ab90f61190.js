(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[47015],{5868:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/generate-purch-inv",function(){return n(41461)}])},41461:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return O}});var a=n(52322),r=n(2784),l=n(48601),d=n(8661),s=n(65950),i=n(69387),o=n(71987),c=n(60218),u=n(26612),p=n(80983),v=n(31389),m=n(33625),I=n(62362),h=n(19473),g=n(91406),y=n(4447),f=n(61802),R=n(69627),x=n(7121),P=n(27423),D=n(2454),V=n(38449),q=n(21581),S=n(89330),j=n(54074);function C(e){var t,n,r;let{labels:d,access:s,form:i,window:o}=e,{formik:u}=(0,p.c)({initialValues:{date:(null==i?void 0:null===(t=i.values)||void 0===t?void 0:t.date)||new Date,description:(null==i?void 0:null===(n=i.values)||void 0===n?void 0:n.description)||""},maxAccess:s,validateOnChange:!0,validationSchema:l.Ry({date:l.Z_().required()}),onSubmit:async e=>{i.setValues({...i.values,date:e.date,description:e.description}),o.close()}});return(0,a.jsx)(j.Z,{onSave:u.handleSubmit,maxAccess:s,children:(0,a.jsx)(v.R,{children:(0,a.jsx)(I.Q,{children:(0,a.jsxs)(c.ZP,{container:!0,spacing:2,children:[(0,a.jsx)(c.ZP,{item:!0,xs:12,children:(0,a.jsx)(S.Z,{name:"date",required:!0,label:d.date,value:null==u?void 0:null===(r=u.values)||void 0===r?void 0:r.date,onChange:u.setFieldValue,maxAccess:s,onClear:()=>u.setFieldValue("date",null),error:u.touched.date&&!!u.errors.date})}),(0,a.jsx)(c.ZP,{item:!0,xs:12,children:(0,a.jsx)(q.Z,{name:"description",label:d.description,value:u.values.description,rows:2,maxAccess:s,onChange:e=>u.setFieldValue("description",e.target.value),onClear:()=>u.setFieldValue("description",""),error:u.touched.description&&!!u.errors.description})})]})})})})}var N=n(39812),w=n(62202),O=()=>{var e,t,n,q;let{getRequest:S,postRequest:O}=(0,r.useContext)(s.$),{platformLabels:F,defaultsData:b}=(0,r.useContext)(h.l),{stack:Z}=(0,f.zY)(),{labels:T,access:E}=(0,o.J)({datasetId:u.i.GeneratePUInvoices}),{labels:k,access:A}=(0,o.J)({datasetId:u.i.PurchaseInvoice}),Q=parseInt(null==b?void 0:null===(t=b.list)||void 0===t?void 0:null===(e=t.find(e=>{let{key:t}=e;return"PUCurrencyId"===t}))||void 0===e?void 0:e.value),_=l.Ry({vendorId:l.Rx().required(),currencyId:l.Rx().required()}),H=l.Ry({vendorId:l.Rx().required(),currencyId:l.Rx().required(),dtId:l.Rx().required(),plantId:l.Rx().required()}),[G,U]=(0,r.useState)(_),{formik:L}=(0,p.c)({initialValues:{vendorId:null,vendorRef:"",vendorName:"",currencyId:Q,dtId:null,plantId:null,amount:0,date:null,description:"",data:{list:[]}},validationSchema:G,maxAccess:E,validateOnChange:!0,onSubmit:async e=>{var t,n;let{data:a,amount:r,vendorRef:l,vendorName:d,date:s,...i}=e,o={...i,date:(0,N.ku)(s||new Date),shipments:(null==a?void 0:null===(n=a.list)||void 0===n?void 0:null===(t=n.filter(e=>e.checked))||void 0===t?void 0:t.map(e=>parseInt(e.shipmentId)))||[]},c=await O({extension:D.y.PurchaseInvoiceHeader.generate,record:JSON.stringify(o)});z(),c.recordId&&(w.ZP.success(F.Generated),await M(c.recordId))}});async function M(e){Z({Component:y.Z,props:{labels:k,recordId:e,maxAccess:A,functionId:x.J.PurchaseInvoice},width:1330,height:720,title:k.purchaseInvoice})}async function J(){Z({Component:C,props:{labels:T,access:E,form:L},width:500,height:300,title:T.edit})}let B=[{field:"shipmentRef",headerName:T.shipmentRef,flex:1},{field:"shipmentDate",headerName:T.shipmentDate,type:"date",flex:1},{field:"qty",headerName:T.qty,type:{field:"number",decimal:2},flex:1},{field:"poRef",headerName:T.poRef,flex:1},{field:"poDate",headerName:T.poDate,flex:1,type:"date"},{field:"amountBeforeVat",headerName:T.amountBeforeVat,type:{field:"number",decimal:2},flex:1},{field:"vatAmount",headerName:T.vatAmount,type:{field:"number",decimal:2},flex:1},{field:"amountAfterVat",headerName:T.amountAfterVat,type:{field:"number",decimal:2},flex:1}],z=async()=>{var e,t;if(U(_),Object.keys(await L.validateForm()).length){let e=Object.keys(await L.validateForm()).reduce((e,t)=>(e[t]=!0,e),{});L.setTouched(e,!0);return}let n=await S({extension:D.y.PurchaseInvoiceHeader.preview,parameters:"_vendorId=".concat(null==L?void 0:null===(e=L.values)||void 0===e?void 0:e.vendorId,"&_currencyId=").concat(null==L?void 0:null===(t=L.values)||void 0===t?void 0:t.currencyId)});L.setFieldValue("data",{list:(null==n?void 0:n.list)||[]}),L.setFieldValue("amount",0)},X=async()=>{if(U(H),Object.keys(await L.validateForm()).length){let e=Object.keys(await L.validateForm()).reduce((e,t)=>(e[t]=!0,e),{});L.setTouched(e,!0);return}L.handleSubmit()};async function W(e){if(e){var t;let n=await S({extension:D.y.DocumentTypeDefault.get,parameters:"_dtId=".concat(e)});L.setFieldValue("plantId",(null==n?void 0:null===(t=n.record)||void 0===t?void 0:t.plantId)||null)}}return(0,a.jsx)(j.Z,{onSave:X,maxAccess:E,isSaved:!1,children:(0,a.jsxs)(v.R,{children:[(0,a.jsx)(m.g,{children:(0,a.jsxs)(c.ZP,{container:!0,spacing:2,children:[(0,a.jsx)(c.ZP,{item:!0,xs:5,children:(0,a.jsx)(P.U,{endpointId:D.y.Vendor.snapshot,valueField:"reference",displayField:"name",secondFieldLabel:T.name,name:"vendorId",label:T.vendor,form:L,required:!0,displayFieldWidth:2,valueShow:"vendorRef",secondValueShow:"vendorName",maxAccess:A,secondFieldName:"vendorName",columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"},{key:"flName",value:"Foreign Language"}],onChange:async(e,t)=>{if(L.setFieldValue("vendorName",(null==t?void 0:t.name)||""),L.setFieldValue("vendorRef",(null==t?void 0:t.reference)||""),!(null==t?void 0:t.recordId)){var n;L.setFieldValue("items",null==L?void 0:null===(n=L.initialValues)||void 0===n?void 0:n.items)}L.setFieldValue("vendorId",(null==t?void 0:t.recordId)||null)},error:L.touched.vendorId&&!!L.errors.vendorId})}),(0,a.jsx)(c.ZP,{item:!0,xs:2,children:(0,a.jsx)(d.Z,{endpointId:V.r.Currency.qry,name:"currencyId",label:T.currency,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],required:!0,values:L.values,maxAccess:A,onChange:(e,t)=>{L.setFieldValue("currencyId",(null==t?void 0:t.recordId)||null)},error:L.touched.currencyId&&!!L.errors.currencyId})}),(0,a.jsx)(c.ZP,{item:!0,xs:.5}),(0,a.jsx)(c.ZP,{item:!0,xs:1,children:(0,a.jsx)(R.Z,{onClick:z,tooltipText:F.Preview,image:"preview.png",color:"#231f20"})})]})}),(0,a.jsx)(I.Q,{children:(0,a.jsx)(c.ZP,{item:!0,xs:3,sx:{display:"flex",flex:1},children:(0,a.jsx)(i.Z,{columns:B,gridData:null==L?void 0:null===(n=L.values)||void 0===n?void 0:n.data,rowId:["shipmentId"],isLoading:!1,pagination:!1,maxAccess:E,showCheckboxColumn:!0,showSelectAll:!0,handleCheckboxChange:function(){var e,t;null==L||L.setFieldValue("amount",(null==L?void 0:null===(t=L.values)||void 0===t?void 0:null===(e=t.data)||void 0===e?void 0:e.list.filter(e=>e.checked).reduce((e,t)=>{let n=0;if(t.checked){var a;n=parseFloat(null==t?void 0:null===(a=t.amountAfterVat)||void 0===a?void 0:a.toString().replace(/,/g,""))||0}return e+n},0))||0)}})})}),(0,a.jsx)(m.g,{children:(0,a.jsxs)(c.ZP,{container:!0,spacing:2,children:[(0,a.jsx)(c.ZP,{item:!0,xs:3,children:(0,a.jsx)(d.Z,{endpointId:V.r.DocumentType.qry,parameters:"_startAt=0&_pageSize=1000&_dgId=".concat(x.J.PurchaseInvoice),name:"dtId",label:T.documentType,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],required:!0,valueField:"recordId",displayField:["reference","name"],values:L.values,maxAccess:A,onChange:async(e,t)=>{L.setFieldValue("dtId",(null==t?void 0:t.recordId)||null),await W(null==t?void 0:t.recordId)},error:L.touched.dtId&&!!L.errors.dtId})}),(0,a.jsx)(c.ZP,{item:!0,xs:2.5,children:(0,a.jsx)(d.Z,{endpointId:V.r.Plant.qry,name:"plantId",label:T.plant,readOnly:!0,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:L.values,valueField:"recordId",displayField:["reference","name"],maxAccess:A,onChange:(e,t)=>{L.setFieldValue("plantId",(null==t?void 0:t.recordId)||null)},error:L.touched.plantId&&!!L.errors.plantId})}),(0,a.jsx)(c.ZP,{item:!0,xs:.25}),(0,a.jsx)(c.ZP,{item:!0,children:(0,a.jsx)(R.Z,{onClick:J,label:T.edit,color:"#231f20",image:"notes.png"})}),(0,a.jsx)(c.ZP,{item:!0,children:(0,a.jsx)(R.Z,{onClick:X,label:F.Generate,color:"#231f20",tooltipText:F.Generate,image:"generate.png"})}),(0,a.jsx)(c.ZP,{item:!0,xs:1}),(0,a.jsx)(c.ZP,{item:!0,xs:1.5,children:(0,a.jsx)(g.Z,{name:"amount",label:"",value:null==L?void 0:null===(q=L.values)||void 0===q?void 0:q.amount,readOnly:!0,align:"right"})})]})})]})})}},2454:function(e,t,n){"use strict";n.d(t,{y:function(){return r}});let a="PU.asmx/",r={VendorGroups:{qry:a+"qryGRP",page:a+"pageGRP",get:a+"getGRP",set:a+"setGRP",del:a+"delGRP"},PriceList:{qry:a+"qryPRI",del:a+"delPRI",get:a+"getPRI",set:a+"setPRI"},PUOrderStatus:{qry:a+"qryPOS",page:a+"pagePOS",get:a+"getPOS",set:a+"setPOS",del:a+"delPOS"},DeliveryMethods:{qry:a+"qryDM",page:a+"pageDM",get:a+"getDM",set:a+"setDM",del:a+"delDM"},PaymentTerms:{qry:a+"qryPT",page:a+"pagePT",get:a+"getPT",set:a+"setPT",del:a+"delPT"},Vendor:{snapshot:a+"snapshotVEN",qry:a+"qryVEN",page:a+"pageVEN",get:a+"getVEN",set:a+"setVEN",del:a+"delVEN"},Address:{qry:a+"qryAD",page:a+"pageAD",get:a+"getAD",set:a+"setAD",del:a+"delAD"},DocumentTypeDefault:{qry:a+"qryDTD",get:a+"getDTD",set:a+"setDTD",del:a+"delDTD",page:a+"pageDTD"},PurchaseInvoiceHeader:{qry:a+"qryIVC",get:a+"getIVC",get2:a+"get2IVC",level2_PU:a+"level2_PU",set:a+"setIVC",del:a+"delIVC",snapshot:a+"snapshotIVC",set2:a+"set2IVC",post:a+"postIVC",unpost:a+"unpostIVC",generate:a+"generateIVC",preview:a+"previewIVC",sync:a+"syncIVC",verify:a+"verifyIVC"},Invoice:{snapshot:a+"snapshotINV"},PurchaseReturnHeader:{set2:a+"set2IVR",post:a+"postIVR",unpost:a+"unpostIVR",del:a+"delIVR",qry:a+"qryIVR",snapshot:a+"snapshotIVR"},VendorPrice:{get:a+"getPRI2"},ItemCostHistory:{qry:a+"qryIPH"},ItemPromotion:{qry:a+"qryIVIM"},Serials:{qry:a+"qrySRL",import:a+"importSRL",last:a+"lastSRL",sync:a+"syncSRL"},Shipment:{get:a+"getSHP",set2:a+"set2SHP",del:a+"delSHP",page:a+"pageSHP",snapshot:a+"snapshotSHP",post:a+"postSHP",unpost:a+"unpostSHP",gen:a+"genSHP"},ShipmentItem:{qry:a+"qrySHI"},UnpostedOrderPack:{get:a+"openORD",snapshot:a+"snapshotORD"},PurchaseOrder:{page:a+"pageORD",snapshot:a+"snapshotORD",del:a+"delORD",set2:a+"set2ORD",get2:a+"get2ORD",close:a+"closeORD",reopen:a+"reopenORD",terminate:a+"terminateORD",transfer:a+"transfer1ORD"},PurchaseRequisition:{snapshot:a+"snapshotREQ",page:a+"pageREQ",get:a+"getREQ",set:a+"setREQ",del:a+"delREQ",cancel:a+"cancelREQ",reopen:a+"reopenREQ",close:a+"closeREQ"},RequisitionDetail:{qry:a+"qryREI",set:a+"setREI",get:a+"getREI",del:a+"delREI"},QuotationItem:{preview:a+"previewQTI",qry:a+"qryQTI"},OrderItem:{qry:a+"qryORI",set2:a+"set2ORI"},PUDraftReturn:{set2:a+"set2DRE",get:a+"getDRE",page:a+"pageDRE",snapshot:a+"snapshotDRE",del:a+"delDRE",post:a+"postDRE"},PUDraftReturnSerial:{get2:a+"get2DRS",qry:a+"qryDRS",del:a+"delDRS",append:a+"appendDRS",batch:a+"batchDRS"},FinancialGroup:{qry:a+"qryFII",set2:a+"set2FII"},PUInvoiceRetBalance:{balance:a+"balanceRET"},ItemLastPurchaseInfo:{last:a+"lastIVI"},PurchaseQuotation:{page:a+"pageQTN",set2:a+"set2QTN",get:a+"getQTN",del:a+"delQTN",snapshot:a+"snapshotQTN"},GenerateQTNPRPack:{gen:a+"genQTN"},GeneratePOPRPack:{gen:a+"genPO",gen2:a+"gen2PO"}}}},function(e){e.O(0,[23352,4447,49774,92888,40179],function(){return e(e.s=5868)}),_N_E=e.O()}]);