(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[30832],{31183:function(e,a,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/memos/[functionId]",function(){return t(8367)}])},8367:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return $}});var n=t(52322),l=t(2784),r=t(62202),o=t(69387),d=t(65950),i=t(71987),u=t(26612),c=t(31389),s=t(33625),v=t(62362),m=t(61802),I=t(98345),f=t(25870),p=t(60218),y=t(48601),x=t(82737),h=t(5088),g=t(80983),b=t(38449),F=t(8661),A=t(89330),C=t(39812),N=t(27423),j=t(91406),R=t(21581),V=t(7121),Z=t(19473),S=t(19689),w=t(77595),_=t(1251),D=t(26553),k=t(30657),P=t(16463),M=t(50023),O=t(76399),T=t(21326),q=t(54074),J=t(67920);let H=e=>{let{recordId:a,accountId:t,currencyId:o,functionId:i,readOnly:s,window:m}=e,{getRequest:I,postRequest:p}=(0,l.useContext)(d.$),{platformLabels:x}=(0,l.useContext)(Z.l),{labels:h,access:b}=(0,M.Z)({datasetId:u.i.ApplyManual});(0,T.Z)({title:x.ApplyManual,window:m});let{schema:F,requiredFields:A}=(0,J.m)({toRecordId:e=>!!(null==e?void 0:e.toRecordId),applyAmount:e=>Number(null==e?void 0:e.applyAmount)>0&&Number(null==e?void 0:e.applyAmount)<=Number(null==e?void 0:e.amount)},!0,b,"items"),{formik:C}=(0,g.c)({initialValues:{items:[{id:1,toRecordId:null,toFunctionId:null,toCurrencyId:null,toReference:null,amount:0,applyAmount:0}]},validateOnChange:!0,validationSchema:y.Ry({items:y.IX().of(F)}),conditionSchema:["items"],onSubmit:async e=>{let n=(e.items||[]).filter(e=>Object.values(A).every(a=>a(e))).map(e=>({toReference:e.toReference,fromFunctionId:i,toFunctionId:e.toFunctionId,fromRecordId:a,toRecordId:e.toRecordId,fromCurrencyId:o,toCurrencyId:e.toCurrencyId,amount:e.amount,accountId:t,applyAmount:e.applyAmount}));await p({extension:f.H.ApplyManual.set2,record:JSON.stringify({fromRecordId:a,fromFunctionId:i,items:n})}),r.ZP.success(x.Updated)}}),N=[{component:"resourcecombobox",label:h.toReference,name:"toRecordId",props:{endpointId:f.H.AgingDoc.qry,parameters:"_accountId=".concat(t,"&_currencyId=").concat(o),displayField:"reference",valueField:"recordId",readOnly:s,mapping:[{from:"recordId",to:"toRecordId"},{from:"reference",to:"toReference"},{from:"functionId",to:"toFunctionId"},{from:"currencyId",to:"toCurrencyId"},{from:"amount",to:"amount"},{from:"amount",to:"applyAmount"}]}},{component:"numberfield",label:h.amount,name:"amount",props:{readOnly:!0}},{component:"numberfield",label:h.applyAmount,name:"applyAmount",props:{readOnly:s,decimalScale:2,maxLength:10}}],j=async()=>{if(a&&i){var e;let t=await I({extension:f.H.ApplyManual.qry,parameters:"_fromFunctionId=".concat(i,"&_fromRecordId=").concat(a)});C.setFieldValue("items",(null==t?void 0:null===(e=t.list)||void 0===e?void 0:e.map((e,a)=>({id:a+1,...e})))||[])}};return(0,l.useEffect)(()=>{j()},[]),(0,n.jsx)(q.Z,{onSave:C.handleSubmit,maxAccess:b,disabledSubmit:s,isParentWindow:!1,children:(0,n.jsx)(c.R,{children:(0,n.jsx)(v.Q,{children:(0,n.jsx)(O._,{name:"applyManual",onChange:e=>{C.setFieldValue("items",e)},value:C.values.items,error:C.errors.items,columns:N,allowAddNewLine:!s,allowDelete:!s})})})})};H.width=600,H.height=400;var E=t(69627);function B(e){var a,t,o,s,M,O,T;let{labels:q,access:J,recordId:B,functionId:L,getEndpoint:G,getGLResourceId:$}=e,{documentType:U,maxAccess:z,changeDT:K}=(0,I.H)({functionId:L,access:J,enabled:!B}),{stack:Q}=(0,m.zY)(),{platformLabels:X,defaultsData:W,userDefaultsData:Y}=(0,l.useContext)(Z.l),ee=parseInt(null==W?void 0:null===(t=W.list)||void 0===t?void 0:null===(a=t.find(e=>{let{key:a}=e;return"currencyId"===a}))||void 0===a?void 0:a.value)||null,ea=parseInt(null==W?void 0:null===(s=W.list)||void 0===s?void 0:null===(o=s.find(e=>{let{key:a}=e;return"vatPct"===a}))||void 0===o?void 0:o.value)||null,{getRequest:et,postRequest:en}=(0,l.useContext)(d.$),el=(0,i.E)({endpointId:f.H.FiMemo.page}),er=parseInt(null==Y?void 0:null===(O=Y.list)||void 0===O?void 0:null===(M=O.find(e=>"plantId"===e.key))||void 0===M?void 0:M.value),{formik:eo}=(0,g.c)({initialValues:{recordId:B||null,dtId:null,reference:"",date:new Date,plantId:er,currencyId:ee,currencyName:"",status:"",accountId:"",amount:"",baseAmount:"",functionId:L,vatPct:0,exRate:1,rateCalcMethod:1,subtotal:"",notes:"",vatAmount:"",isSubjectToVAT:!1,sourceReference:"",dueDate:new Date},maxAccess:z,documentType:{key:"dtId",value:null==U?void 0:U.dtId},validateOnChange:!0,validationSchema:y.Ry({amount:y.Rx().required(),currencyId:y.Z_().required(),accountId:y.Z_().required(),subtotal:y.Rx().required(),date:y.Z_().required(),dueDate:y.Z_().required()}),onSubmit:async e=>{e.recordId||(e.status=1,e.rateCalcMethod=1);let a=await en({extension:G(parseInt(eo.values.functionId)).set,record:JSON.stringify(e)});e.recordId?r.ZP.success(X.Edited):(r.ZP.success(X.Added),eo.setValues({...e,baseAmount:eo.values.baseAmount?eo.values.baseAmount:e.amount,recordId:a.recordId}));let t=await et({extension:f.H.FiMemo.get,parameters:"_recordId=".concat(a.recordId)});eo.setFieldValue("reference",t.record.reference),el()}}),ed=!!eo.values.recordId||!!B;function ei(e){var a,t;let n=(0,k.fB)({amount:null!=e?e:0,exRate:null===(a=eo.values)||void 0===a?void 0:a.exRate,baseAmount:0,rateCalcMethod:null===(t=eo.values)||void 0===t?void 0:t.rateCalcMethod,dirtyField:k.ss});eo.setFieldValue("baseAmount",parseFloat(null==n?void 0:n.baseAmount).toFixed(2)||0)}(0,l.useEffect)(()=>{let e=parseFloat(eo.values.subtotal);if(eo.values.isSubjectToVAT){var a,t;let n=((null==eo?void 0:null===(a=eo.values)||void 0===a?void 0:a.recordId)?null==eo?void 0:null===(t=eo.values)||void 0===t?void 0:t.vatPct:ea)||0,l=e*parseFloat(n)/100;eo.setFieldValue("vatAmount",l),eo.setFieldValue("vatPct",n),e+=l}else eo.setFieldValue("vatPct",""),eo.setFieldValue("vatAmount",0);eo.setFieldValue("amount",e),ei(e)},[eo.values.isSubjectToVAT,eo.values.subtotal]),(0,l.useEffect)(()=>{!async function(){if(B){let e=await et({extension:f.H.FiMemo.get,parameters:"_recordId=".concat(B)});eo.setValues({...e.record,dueDate:(0,C.a1)(e.record.dueDate),date:(0,C.a1)(e.record.date)})}}()},[]);let eu=async()=>{let e=await en({extension:f.H.FiMemo.post,record:JSON.stringify(eo.values)});if(null==e?void 0:e.recordId){r.ZP.success(X.Posted),el();let e=await et({extension:f.H.FiMemo.get,parameters:"_recordId=".concat(eo.values.recordId)});e.record.date=(0,C.a1)(e.record.date),e.record.dueDate=(0,C.a1)(e.record.dueDate),eo.setValues(e.record)}},ec=async()=>{let e=await en({extension:f.H.FiMemo.unpost,record:JSON.stringify(eo.values)});if(null==e?void 0:e.recordId){r.ZP.success(X.Unposted),el();let e=await et({extension:f.H.FiMemo.get,parameters:"_recordId=".concat(eo.values.recordId)});e.record.date=(0,C.a1)(e.record.date),e.record.dueDate=(0,C.a1)(e.record.dueDate),eo.setValues(e.record)}},es=async()=>{let e=await en({extension:f.H.FiMemo.cancel,record:JSON.stringify(eo.values)});if(null==e?void 0:e.recordId){r.ZP.success(X.Cancelled),el();let e=await et({extension:f.H.FiMemo.get,parameters:"_recordId=".concat(eo.values.recordId)});e.record.dueDate=(0,C.a1)(e.record.dueDate),e.record.date=(0,C.a1)(e.record.date),eo.setValues(e.record)}},ev=-1===eo.values.status||3===eo.values.status,em=3===eo.values.status,eI=-1===eo.values.status;async function ef(e,a,t,n){if(e&&a&&t){var l,r,o,d;let i=await et({extension:_.q.Currency.get,parameters:"_currencyId=".concat(e,"&_date=").concat((0,C.Uf)(a),"&_rateDivision=").concat(t)});ei(0===n?0:null!=n?n:eo.values.amount),eo.setFieldValue("exRate",null!==(o=null===(l=i.record)||void 0===l?void 0:l.exRate)&&void 0!==o?o:1),eo.setFieldValue("rateCalcMethod",null!==(d=null===(r=i.record)||void 0===r?void 0:r.rateCalcMethod)&&void 0!==d?d:1)}}let ep=async()=>{await en({extension:f.H.ResetGLMemo.reset,record:JSON.stringify(eo.values)})},ey=[{key:"RecordRemarks",condition:!0,onClick:"onRecordRemarks",disabled:!ed},{key:"GL",condition:!0,onClick:"onClickGL",datasetId:$(parseInt(eo.values.functionId)),onReset:ep,disabled:!ed},{key:"FI Trx",condition:!0,onClick:"onClickIT",disabled:!ed},{key:"Aging",condition:!0,onClick:"onClickAging",disabled:!ed},{key:"Locked",condition:em,onClick:"onUnpostConfirmation",onSuccess:ec,disabled:!ed||eI},{key:"Unlocked",condition:!em,onClick:eu,disabled:!ed||eI},{key:"Cancel",condition:!0,onClick:es,disabled:!ed||eI||em},{key:"AccountSummary",condition:!0,onClick:()=>{Q({Component:P.Z,props:{accountId:parseInt(eo.values.accountId),moduleId:1}})},disabled:!eo.values.accountId},{key:"Apply",condition:!0,onClick:()=>{Q({Component:H,props:{recordId:eo.values.recordId,accountId:eo.values.accountId,currencyId:eo.values.currencyId,functionId:L,readOnly:em||eI}})},disabled:!ed||!eo.values.accountId||!eo.values.currencyId}],ex=e=>{switch(Number(e)){case V.J.CreditNote:return u.i.MCRCreditNote;case V.J.DebitNote:return u.i.MCRDebitNote;case V.J.ServiceBill:return u.i.MCRServiceBillReceived;case V.J.ServiceInvoice:return u.i.MCRServiceInvoice;default:return null}};async function eh(e){if(e){var a,t;let n=await et({extension:f.H.FIDocTypeDefaults.get,parameters:"_dtId=".concat(e)});return eo.setFieldValue("plantId",(null==n?void 0:null===(a=n.record)||void 0===a?void 0:a.plantId)?null==n?void 0:null===(t=n.record)||void 0===t?void 0:t.plantId:er),n}}return(0,l.useEffect)(()=>{var e;eo.values.dtId&&!B&&eh(null==eo?void 0:null===(e=eo.values)||void 0===e?void 0:e.dtId)},[eo.values.dtId]),(0,n.jsx)(x.Z,{resourceId:(e=>{switch(e){case V.J.CreditNote:return u.i.CreditNote;case V.J.DebitNote:return u.i.DebitNote;case V.J.ServiceBill:return u.i.ServiceBillReceived;case V.J.ServiceInvoice:return u.i.ServiceInvoice;default:return null}})(parseInt(eo.values.functionId)),form:eo,maxAccess:z,editMode:ed,actions:ey,functionId:eo.values.functionId,previewReport:ed,disabledSubmit:eI||em,children:(0,n.jsx)(c.R,{children:(0,n.jsx)(v.Q,{children:(0,n.jsxs)(p.ZP,{container:!0,spacing:2,justifyContent:"space-between",children:[(0,n.jsx)(p.ZP,{item:!0,xs:6,children:(0,n.jsxs)(p.ZP,{container:!0,spacing:2,children:[(0,n.jsx)(p.ZP,{item:!0,xs:12,children:(0,n.jsx)(F.Z,{endpointId:b.r.DocumentType.qry,parameters:"_startAt=0&_pageSize=1000&_dgId=".concat(eo.values.functionId),name:"dtId",readOnly:ed,label:q.doctype,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],valueField:"recordId",displayField:["reference","name"],values:eo.values,maxAccess:z,onChange:(e,a)=>{K(a),eo.setFieldValue("dtId",(null==a?void 0:a.recordId)||""),eo.setFieldValue("status",null==a?void 0:a.activeStatus)},error:eo.touched.dtId&&!!eo.errors.dtId})}),(0,n.jsx)(p.ZP,{item:!0,xs:12,children:(0,n.jsx)(h.Z,{name:"reference",label:q.reference,value:eo.values.reference,readOnly:!0,rows:2,maxAccess:z,onChange:eo.handleChange,onClear:()=>eo.setFieldValue("reference",""),error:eo.touched.reference&&!!eo.errors.reference})}),(0,n.jsx)(p.ZP,{item:!0,xs:12,children:(0,n.jsx)(A.Z,{name:"date",readOnly:em||eI,label:q.date,value:eo.values.date,onChange:async(e,a)=>{eo.setFieldValue("date",a),await ef(eo.values.currencyId,a,D.B.FINANCIALS)},required:!0,maxAccess:z,onClear:()=>eo.setFieldValue("date",null),error:eo.touched.date&&!!eo.errors.date})}),(0,n.jsx)(p.ZP,{item:!0,xs:12,children:(0,n.jsx)(A.Z,{name:"dueDate",readOnly:em||eI,label:q.dueDate,value:eo.values.dueDate,required:!0,onChange:eo.setFieldValue,maxAccess:z,onClear:()=>eo.setFieldValue("dueDate",""),error:eo.touched.dueDate&&!!eo.errors.dueDate})}),(0,n.jsx)(p.ZP,{item:!0,xs:12,children:(0,n.jsx)(F.Z,{endpointId:b.r.Plant.qry,name:"plantId",readOnly:em||eI,label:q.plant,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"plant Ref"},{key:"name",value:"Name"}],values:eo.values,maxAccess:z,onChange:(e,a)=>{let t=(null==a?void 0:a.recordId)||"";eo.setFieldValue("plantId",t)},error:eo.touched.plantId&&!!eo.errors.plantId})}),(0,n.jsx)(p.ZP,{item:!0,xs:12,children:(0,n.jsxs)(p.ZP,{container:!0,spacing:1,alignItems:"center",children:[(0,n.jsx)(p.ZP,{item:!0,xs:8,children:(0,n.jsx)(F.Z,{endpointId:b.r.Currency.qry,name:"currencyId",readOnly:em||eI,label:q.currency,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:eo.values,required:!0,maxAccess:z,onChange:async(e,a)=>{await ef(null==a?void 0:a.recordId,eo.values.date,D.B.FINANCIALS),eo.setFieldValue("currencyId",null==a?void 0:a.recordId),eo.setFieldValue("currencyName",null==a?void 0:a.name)},error:eo.touched.currencyId&&!!eo.errors.currencyId})}),(0,n.jsx)(p.ZP,{item:!0,xs:4,children:(0,n.jsx)(E.Z,{onClick:()=>{var e;return e=eo.values,void Q({Component:w.Z,props:{DatasetIdAccess:ex(L),data:e,onOk:e=>{eo.setValues(a=>({...a,...e}))}}})},image:"popup.png",tooltipText:X.add,disabled:!eo.values.currencyId||eo.values.currencyId===ee})})]})})]})}),(0,n.jsx)(p.ZP,{item:!0,xs:6,children:(0,n.jsxs)(p.ZP,{container:!0,spacing:2,children:[(0,n.jsx)(p.ZP,{item:!0,xs:12,children:(0,n.jsx)(j.Z,{name:"subtotal",readOnly:em||eI,required:!0,label:q.subtotal,value:eo.values.subtotal,maxAccess:z,onChange:async e=>{eo.setFieldValue("subtotal",e.target.value),ei(e.target.value)},onClear:()=>eo.setFieldValue("subtotal",""),error:eo.touched.subtotal&&!!eo.errors.subtotal})}),(0,n.jsx)(p.ZP,{item:!0,xs:12,children:(0,n.jsx)(j.Z,{name:"vatPct",readOnly:!0,label:q.vatPct,value:eo.values.vatPct,maxAccess:z,onChange:eo.handleChange,onClear:()=>eo.setFieldValue("vatPct",""),error:eo.touched.vatPct&&!!eo.errors.vatPct})}),(0,n.jsx)(p.ZP,{item:!0,xs:12,children:(0,n.jsx)(j.Z,{name:"vatAmount",readOnly:!eo.values.isSubjectToVAT||em||eI,required:eo.values.isSubjectToVAT,label:q.vatAmount,value:eo.values.vatAmount,maxAccess:z,onChange:async e=>{let a=0!=eo.values.subtotal?100*parseFloat(e.target.value)/parseFloat(eo.values.subtotal):0;eo.setFieldValue("vatPct",parseFloat(a).toFixed(2)||0),eo.setFieldValue("vatAmount",e.target.value);let t=Number(e.target.value||0)+Number(eo.values.subtotal);eo.setFieldValue("amount",t),ei(t)},onClear:()=>{eo.setFieldValue("vatAmount",0),eo.setFieldValue("amount",Number(eo.values.subtotal||0))},error:eo.touched.vatAmount&&!!eo.errors.vatAmount})}),(0,n.jsx)(p.ZP,{item:!0,xs:12,children:(0,n.jsx)(S.Z,{name:"isSubjectToVAT",value:null===(T=eo.values)||void 0===T?void 0:T.isSubjectToVAT,onChange:e=>!(em||eI)&&eo.setFieldValue("isSubjectToVAT",e.target.checked),label:q.vat,maxAccess:z,readOnly:ev})}),(0,n.jsx)(p.ZP,{item:!0,xs:12,children:(0,n.jsx)(j.Z,{name:"amount",label:q.amount,value:eo.values.amount,required:!0,maxAccess:z,thousandSeparator:!1,readOnly:!0,error:eo.touched.amount&&!!eo.errors.amount,maxLength:10})})]})}),(0,n.jsx)(p.ZP,{item:!0,xs:12,children:(0,n.jsx)(N.U,{endpointId:f.H.Account.snapshot,parameters:{_type:2},readOnly:em||eI,valueField:"reference",displayField:"name",name:"accountId",required:!0,label:q.account,form:eo,valueShow:"accountRef",secondValueShow:"accountName",columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name",grid:4},{key:"keywords",value:"Keywords"},{key:"groupName",value:"Account Group"}],maxAccess:z,displayFieldWidth:2,onChange:(e,a)=>{eo.setFieldValue("accountId",a?a.recordId:""),eo.setFieldValue("accountRef",a?a.reference:""),eo.setFieldValue("accountName",a?a.name:"")},error:eo.touched.accountId&&!!eo.errors.accountId&&!eo.values.accountId})}),(0,n.jsx)(p.ZP,{item:!0,xs:6,children:(0,n.jsx)(F.Z,{neverPopulate:!0,endpointId:f.H.DescriptionTemplate.qry,name:"templateId",label:q.descriptionTemplate,valueField:"recordId",readOnly:em||eI,displayField:"name",values:eo.values,onChange:(e,a)=>{let t=eo.values.notes||"";(null==a?void 0:a.name)&&eo.setFieldValue("notes",""===t?a.name:"".concat(t,"\n").concat(a.name)),eo.setFieldValue("templateId",(null==a?void 0:a.recordId)||null)},error:eo.touched.templateId&&!!eo.errors.templateId,maxAccess:z})}),(0,n.jsx)(p.ZP,{item:!0,xs:6,children:(0,n.jsx)(h.Z,{name:"sourceReference",readOnly:em||eI,maxLength:"20",label:q.sourceReference,value:eo.values.sourceReference,maxAccess:z,onChange:eo.handleChange,onClear:()=>eo.setFieldValue("sourceReference","")})}),(0,n.jsx)(p.ZP,{item:!0,xs:6.01,children:(0,n.jsx)(R.Z,{name:"notes",type:"text",label:q.notes,readOnly:em||eI,value:eo.values.notes,rows:4,maxAccess:z,onChange:e=>eo.setFieldValue("notes",e.target.value),onClear:()=>eo.setFieldValue("notes",""),error:eo.touched.notes&&!!eo.errors.notes})})]})})})})}var L=t(36908),G=t(63165),$=()=>{let{getRequest:e,postRequest:a}=(0,l.useContext)(d.$),{platformLabels:t}=(0,l.useContext)(Z.l),{stack:p}=(0,m.zY)(),{functionId:y}=(0,G.F)();async function x(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{_startAt:t=0,_pageSize:n=50,params:l}=a;return{...await e({extension:f.H.FiMemo.page,parameters:"_startAt=".concat(t,"&_params=").concat(l||"","&_pageSize=").concat(n,"&_sortBy=reference&_functionId=").concat(y)}),_startAt:t}}let{query:{data:h},refetch:g,labels:b,filterBy:F,paginationParameters:A,access:C,invalidate:N}=(0,i.J)({endpointId:f.H.FiMemo.page,datasetId:u.i.CreditNote,DatasetIdAccess:(e=>{switch(e){case V.J.CreditNote:return u.i.CreditNote;case V.J.DebitNote:return u.i.DebitNote;case V.J.ServiceBill:return u.i.ServiceBillReceived;case V.J.ServiceInvoice:return u.i.ServiceInvoice;default:return null}})(parseInt(y)),queryFn:x,filter:{filterFn:j,default:{functionId:y}}});async function j(a){let{filters:t,pagination:n}=a;return(null==t?void 0:t.qry)?await e({extension:f.H.FiMemo.snapshot,parameters:"_filter=".concat(t.qry,"&_functionId=").concat(y)}):x({_startAt:n._startAt||0,params:null==t?void 0:t.params})}let R=[{field:"reference",headerName:b.reference,flex:1},{field:"date",headerName:b.date,flex:1,type:"date"},{field:"accountRef",headerName:b.accountRef,flex:1},{field:"accountName",headerName:b.accountName,flex:1},{field:"sourceReference",headerName:b.sourceReference,flex:1},{field:"amount",headerName:b.amount,flex:1,type:"number"},{field:"currencyName",headerName:b.currency,flex:1},{field:"plantName",headerName:b.plant,flex:1},{field:"statusName",headerName:b.status,flex:1},{field:"notes",headerName:b.notes,flex:1},{field:"isVerified",headerName:b.isVerified,type:"checkbox"}],S=e=>e===V.J.CreditNote?b.creditNote:e===V.J.DebitNote?b.debitNote:e===V.J.ServiceBill?b.serviceBill:e===V.J.ServiceInvoice?b.serviceInvoice:null,w=e=>{switch(e){case V.J.CreditNote:return f.H.CreditNote;case V.J.DebitNote:return f.H.DebitNote;case V.J.ServiceBill:return f.H.ServiceBillReceived;case V.J.ServiceInvoice:return f.H.ServiceInvoice;default:return null}},_=e=>{switch(Number(e)){case V.J.CreditNote:return u.i.GLCreditNote;case V.J.DebitNote:return u.i.GLDebitNote;case V.J.ServiceBill:return u.i.GLServiceBillReceived;case V.J.ServiceInvoice:return u.i.GLServiceInvoice;default:return null}};function D(e){p({Component:B,props:{labels:b,recordId:e,access:C,functionId:y,getEndpoint:w,getGLResourceId:_},width:1200,height:670,title:S(parseInt(y))})}let{proxyAction:k}=(0,I.G)({functionId:y,action:D}),P=async()=>{await k()},M=async e=>{await a({extension:w(parseInt(y)).del,record:JSON.stringify(e)}),N(),r.ZP.success(t.Deleted)};return(0,n.jsxs)(c.R,{children:[(0,n.jsx)(s.g,{children:(0,n.jsx)(L.Z,{onAdd:P,maxAccess:C,reportName:"FIMEM",filterBy:F})}),(0,n.jsx)(v.Q,{children:(0,n.jsx)(o.Z,{name:"table",columns:R,gridData:h,rowId:["recordId"],onEdit:e=>{D(null==e?void 0:e.recordId)},onDelete:M,deleteConfirmationType:"strict",isLoading:!1,pageSize:50,paginationParameters:A,refetch:g,paginationType:"api",maxAccess:C})})]})}},93736:function(e,a,t){"use strict";t.d(a,{K:function(){return l}});let n="RG.FI.asmx/",l={FiOpeningBalance:{gen:n+"genOBA"},FiAging:{qry:n+"FI404"},AccountSummary:{AccFI405b:n+"FI405b"},DocumentAging:{AgingFI406a:n+"FI406a",AgingFI406b:n+"FI406b"},TrialBalance:{FI402View:n+"FI402o",FI401o2:n+"FI401o2"}}},63165:function(e,a,t){"use strict";t.d(a,{F:function(){return r}});var n=t(5632),l=t(2784);let r=()=>{let e=(0,n.useRouter)(),[a,t]=(0,l.useState)(e.query);return a}},67920:function(e,a,t){"use strict";t.d(a,{m:function(){return l}});var n=t(48601);function l(e,a,t){var l;let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"items",o={...e};return null==t||null===(l=t.record)||void 0===l||l.controls.forEach(e=>{let{controlId:a,accessLevel:t}=e,[n,l]=null==a?void 0:a.split(".");n!==r||2!==t||l in o||(o[l]=e=>(null==e?void 0:e[l])!=null),(1===t||4===t)&&l in o&&delete o[l]}),{schema:n.Ry().shape({...Object.keys(o).reduce((e,t)=>(e[t]=n.nK().nullable().test(function(e){var n;let l=this.parent,[,r]=this.path.match(/^(\w+)\[(\d+)\]/)||[],d=(null===(n=this.options.context)||void 0===n?void 0:n[r])||[];if(a||!a&&d.length>1){if(null!==l[t]&&void 0!==l[t]&&0!==l[t]&&""!==o[t]&&!o[t](l))return!1;if(!Object.entries(o).some(e=>{let[,a]=e;return!!a(l)}))return!0}return!!o[t](l)&&void 0!==e}),e),{})}),requiredFields:o}}},1685:function(e,a,t){"use strict";t.d(a,{m:function(){return n}});let n=e=>{let a=window.sessionStorage.getItem(e);return a?JSON.parse(a):null}},98345:function(e,a,t){"use strict";t.d(a,{H:function(){return f},G:function(){return I}});var n=t(45300),l=t(2784),r=t(96026),o=t(38449);t(26612);var d=t(65947),i=t(1685);let u=async(e,a,t)=>{try{let n=await e({extension:a,parameters:t});return a.includes("qry")?n:n.record}catch(e){return null}},c=(e,a,t,n)=>{let l=(e=JSON.parse(JSON.stringify(e))).record.controls,r=l.find(e=>"reference"===e.controlId);return r?r.accessLevel=(null==a?void 0:a.mandatory)?d.$7:d.rr:(null==a?void 0:a.mandatory)?l.push({sgId:0,resourceId:"",controlId:"".concat(n?n+".":"","reference"),accessLevel:(null==a?void 0:a.mandatory)?d.$7:d.rr}):(null==a?void 0:a.readOnly)?l.push({sgId:0,resourceId:"",controlId:"".concat(n?n+".":"","reference"),accessLevel:(null==a?void 0:a.readOnly)?d.rr:d.$7}):l=e.record.controls.filter(e=>"reference"!=e.controlId),t&&l.push({sgId:0,resourceId:"",controlId:"".concat(n?n+".":"","dtId"),accessLevel:d.$7}),{...e,record:{...e.record,controls:l}}},s=async(e,a,t)=>{let n,l;switch(t){case"dtId":let r=(0,i.m)("userData"),d=null==r?void 0:r.userId;l="_userId=".concat(d,"&_functionId=").concat(a),n=o.r.UserFunction.get;break;case"glbSysNumberRange":l="_recordId=".concat(a),n=o.r.SystemFunction.get;break;case"DocumentType":l="_dgId=".concat(a,"&_startAt=",0,"&_pageSize=",50),n=o.r.DocumentType.qry;break;case"DcTypNumberRange":l="_recordId=".concat(a),n=o.r.DocumentType.get;break;case"isExternal":l="_recordId=".concat(a),n=o.r.NumberRange.get;break;default:return null}return await u(e,n,l)},v=async function(e){let a,t,n,l,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,o=arguments.length>2?arguments[2]:void 0,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,i=!(arguments.length>4)||void 0===arguments[4]||arguments[4],u=arguments.length>5?arguments[5]:void 0,v=void 0===d&&r&&await s(e,r,"dtId"),m=null==v?void 0:v.dtId,I="",f=!0;if(v&&void 0===d||"nraId"===d){if(m){let t=await s(e,m,"DcTypNumberRange");a=null==t?void 0:t.nraId,f=!((null==t?void 0:t.activeStatus)<0),a||(I="Assign the document type to a number range")}if((!m||!f)&&i&&r){var p;let a=await s(e,r,"DocumentType");l=(null==a?void 0:null===(p=a.list)||void 0===p?void 0:p.filter(e=>(null==e?void 0:e.activeStatus)===1).length)>0}}if(("nraId"===d||void 0===d)&&r){if((!m||m)&&!a||a&&!f){let t=await s(e,r,"glbSysNumberRange");(a=null==t?void 0:t.nraId)&&l&&(l=!1),f=!0}I=a||l?"":"Assign the system Function to a number range"}d>0&&!a&&(a=d),a&&f?(t={readOnly:null==(n=await s(e,a,"isExternal"))||!n.external,mandatory:null!=n&&!!n.external},o&&(o=await c(o,t,l,u))):!a&&o&&(o=await c(o,t,l,u));let y=u?"".concat(u,".reference"):"reference";return{dtId:m,resetReference:null==t?void 0:t.readOnly,dcTypeRequired:l,reference:{fieldName:y,isEmpty:(null==n?void 0:n.external)!==void 0&&(null==n||!n.external)},errorMessage:I,maxAccess:o,selectNraId:d}};var m=t(65950);function I(e){let{functionId:a,action:t,hasDT:n}=e,{getRequest:o}=(0,l.useContext)(m.$),{stack:d}=(0,r.V)();return{proxyAction:async()=>{let e=await v(o,a,"",void 0,n);(null==e?void 0:e.errorMessage)?d({message:null==e?void 0:e.errorMessage}):await t()}}}function f(e){var a;let{functionId:t,access:o,hasDT:d,enabled:i=!0,objectName:u=""}=e,{getRequest:c}=(0,l.useContext)(m.$),{stack:s}=(0,r.V)(),[I,f]=(0,l.useState)(),p=async e=>{let a=await v(c,t,o,e,d,u);if(!a.errorMessage)return a;s({message:null==a?void 0:a.errorMessage})},y=(0,n.a)({retry:!1,staleTime:0,enabled:i,queryKey:[t,I,!!o,i],queryFn:I||"nraId"===I?()=>p(I):()=>p()});return{documentType:y.data,maxAccess:(null==y?void 0:null===(a=y.data)||void 0===a?void 0:a.maxAccess)||o,changeDT(e){f((null==e?void 0:e.nraId)||"nraId")}}}},16463:function(e,a,t){"use strict";t.d(a,{Z:function(){return A}});var n=t(52322),l=t(2784),r=t(49864),o=t(65950),d=t(27423),i=t(26612),u=t(71987),c=t(33625),s=t(62362),v=t(31389),m=t(8661),I=t(25870),f=t(69627),p=t(84100),y=t(19473),x=t(80983),h=t(38449),g=t(69387),b=t(93736),F=t(21326);function A(e){let{accountId:a,moduleId:t,window:A}=e,{getRequest:C}=(0,l.useContext)(o.$),{platformLabels:N}=(0,l.useContext)(y.l),[j,R]=(0,l.useState)([]);(0,F.Z)({title:N.AccountSummary,window:A});let{labels:V,access:Z}=(0,u.J)({datasetId:i.i.AccountSummary}),S=[{field:"days",headerName:V.days,flex:1,type:"number"}],[w,_]=(0,l.useState)(S),{formik:D}=(0,x.c)({maxAccess:Z,initialValues:{accountId:null,accountRef:"",accountName:"",agpId:null,moduleId:t}});async function k(){var e,a,n,l;let r;let o=2,d=[...S],i=await C({extension:h.r.Currency.qry,parameters:"_filter="});if(1==t?r=null==i?void 0:null===(e=i.list)||void 0===e?void 0:e.filter(e=>e.sale):2==t&&(r=null==i?void 0:null===(a=i.list)||void 0===a?void 0:a.filter(e=>e.purchase)),0==r.length)return;null==r||r.forEach((e,a)=>{d.push({field:"column".concat(a+1),headerName:e.reference,flex:1,type:"number"})}),_(d);let u=await C({extension:I.H.AgingLeg.qry,parameters:"_agpId=".concat(D.values.agpId)}),c=null==u?void 0:null===(n=u.list)||void 0===n?void 0:n.map(e=>{let a=Array(r.length+2).fill(0);return a[0]=null,a[1]=e.days,a}),s=(r||[]).map(e=>C({extension:b.K.AccountSummary.AccFI405b,parameters:"_agpId=".concat(D.values.agpId,"&_currencyId=").concat(e.recordId,"&_accountId=").concat(D.values.accountId)}).then(e=>({summaryRes:e})));(await Promise.all(s)).forEach(e=>{var a;let{summaryRes:t}=e;null==t||null===(a=t.list)||void 0===a||a.forEach(e=>{null==c||c.forEach(a=>{a[1]==e.seqDays&&(a[o]=e.amount)})}),o++});let v=Array(r.length+2).fill(null);for(let e=2;e<r.length+2;e++){let a=0;null==c||c.map(t=>{a+=Number(t[e]||0)}),v[e]=a}let m=c.filter(e=>null!==e[1]).map(e=>{let[a,t,...n]=e,l={days:t};return n.forEach((e,a)=>{l["column".concat(a+1)]=e.toFixed(2)}),l}),f={};for(let e=0;e<r.length;e++)f["column".concat(e+1)]=null!==(l=v[e+2].toFixed(2))&&void 0!==l?l:0;m.push(f),R({list:m})}return(0,l.useEffect)(()=>{!async function(){if(a&&t){var e,n,l;let t=await C({extension:I.H.Account.get,parameters:"_recordId=".concat(a)});D.setFieldValue("accountId",null==t?void 0:null===(e=t.record)||void 0===e?void 0:e.recordId),D.setFieldValue("accountRef",null==t?void 0:null===(n=t.record)||void 0===n?void 0:n.reference),D.setFieldValue("accountName",null==t?void 0:null===(l=t.record)||void 0===l?void 0:l.name)}}()},[]),(0,n.jsxs)(v.R,{children:[(0,n.jsx)(c.g,{children:(0,n.jsxs)(r.Z,{container:!0,spacing:2,p:2,children:[(0,n.jsx)(r.Z,{item:!0,xs:12,children:(0,n.jsx)(d.U,{endpointId:I.H.Account.snapshot,name:"accountId",label:V.account,valueField:"reference",displayField:"name",valueShow:"accountRef",secondValueShow:"accountName",form:D,readOnly:D.values.accountId&&D.values.moduleId,required:!0,maxAccess:Z,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],onChange:async(e,a)=>{D.setFieldValue("accountId",(null==a?void 0:a.recordId)||null),D.setFieldValue("accountName",(null==a?void 0:a.name)||""),D.setFieldValue("accountRef",(null==a?void 0:a.reference)||"")}})}),(0,n.jsx)(r.Z,{item:!0,xs:6,children:(0,n.jsx)(m.Z,{endpointId:I.H.AgingProfile.qry,parameters:"_startAt=0&_pageSize=1000&filter=",name:"agpId",label:V.agingProfile,values:D.values,valueField:"recordId",displayField:"name",maxAccess:Z,required:!0,onChange:(e,a)=>{D.setFieldValue("agpId",(null==a?void 0:a.recordId)||null),(null==a?void 0:a.recordId)||R({list:[]})}})}),(0,n.jsx)(r.Z,{item:!0,xs:5,children:(0,n.jsx)(m.Z,{datasetId:p.v.FI_AGING_MODULE,label:V.module,name:"moduleId",values:D.values,valueField:"key",displayField:"value",maxAccess:Z,required:!0,readOnly:D.values.moduleId,onChange:(e,a)=>{D.setFieldValue("moduleId",(null==a?void 0:a.key)||null)}})}),(0,n.jsx)(r.Z,{item:!0,xs:1,children:(0,n.jsx)(f.Z,{onClick:k,image:"preview.png",disabled:!D.values.agpId||!D.values.moduleId||!D.values.accountId,tooltipText:N.Preview})})]})}),(0,n.jsx)(s.Q,{children:(0,n.jsx)(g.Z,{columns:w,gridData:j,isLoading:!1,pagination:!1})})]})}A.width=1e3,A.height=500},77595:function(e,a,t){"use strict";t.d(a,{Z:function(){return b}});var n=t(52322),l=t(60218),r=t(2784),o=t(26612),d=t(5088),i=t(80983),u=t(31389),c=t(62362),s=t(91406),v=t(30657),m=t(65950),I=t(1251),f=t(39812),p=t(26553),y=t(71987),x=t(21326),h=t(19473),g=t(54074);function b(e){var a,t,b,F,A,C,N,j,R;let{data:V,onOk:Z,DatasetIdAccess:S,window:w}=e,{getRequest:_}=(0,r.useContext)(m.$),{platformLabels:D}=(0,r.useContext)(h.l);(0,x.Z)({title:D.MultiCurrencyRate,window:w});let{labels:k,access:P}=(0,y.J)({endpointId:I.q.Currency.get,DatasetIdAccess:S,datasetId:o.i.MultiCurrencyRate}),{formik:M}=(0,i.c)({initialValues:{currencyId:null==V?void 0:V.currencyId,currencyName:null==V?void 0:V.currencyName,exchangeId:null==V?void 0:V.exchangeId,exchangeName:null==V?void 0:V.exchangeName,rateCalcMethod:null==V?void 0:V.rateCalcMethod,rateCalcMethodName:null==V?void 0:V.rateCalcMethodName,rateTypeId:null==V?void 0:V.rateTypeId,exRate:(null==V?void 0:V.exRate)||null,amount:(null==V?void 0:V.amount)||0,baseAmount:null==V?void 0:V.baseAmount,rateTypeName:null==V?void 0:V.rateTypeName},maxAccess:P,validateOnChange:!0});async function O(){if((null==V?void 0:V.currencyId)&&(null==V?void 0:V.date)){var e,a,t,n,l;let r=await _({extension:I.q.Currency.get,parameters:"_currencyId=".concat(null==V?void 0:V.currencyId,"&_date=").concat((0,f.Uf)(null==V?void 0:V.date),"&_rateDivision=").concat(p.B.FINANCIALS)});M.setFieldValue("rateCalcMethod",null===(e=r.record)||void 0===e?void 0:e.rateCalcMethod),M.setFieldValue("rateCalcMethodName",null===(a=r.record)||void 0===a?void 0:a.rateCalcMethodName),M.setFieldValue("exchangeId",null===(t=r.record)||void 0===t?void 0:t.exchangeId),M.setFieldValue("exchangeName",null===(n=r.record)||void 0===n?void 0:n.exchangeName),M.setFieldValue("rateTypeName",null===(l=r.record)||void 0===l?void 0:l.rateTypeName)}}(0,r.useEffect)(()=>{!async function(){await O()}()},[]);let T=()=>{Z&&(Z({...M.values,exRate:M.values.exRate,baseAmount:M.values.baseAmount,amount:M.values.amount}),w.close())},q=[{key:"Ok",condition:!0,onClick:T,disabled:!1}];return(0,n.jsx)(g.Z,{onSave:T,actions:q,maxAccess:P,editMode:!1,isSaved:!1,children:(0,n.jsx)(u.R,{children:(0,n.jsx)(c.Q,{children:(0,n.jsxs)(l.ZP,{container:!0,spacing:2,children:[(0,n.jsx)(l.ZP,{item:!0,xs:12,children:(0,n.jsx)(d.Z,{name:"currencyName",value:null==M?void 0:null===(a=M.values)||void 0===a?void 0:a.currencyName,label:k.currency,readOnly:!0})}),(0,n.jsx)(l.ZP,{item:!0,xs:12,children:(0,n.jsx)(d.Z,{name:"rateTypeName",value:null==M?void 0:null===(t=M.values)||void 0===t?void 0:t.rateTypeName,label:k.rateType,readOnly:!0})}),(0,n.jsx)(l.ZP,{item:!0,xs:12,children:(0,n.jsx)(d.Z,{name:"exchangeName",value:null==M?void 0:null===(b=M.values)||void 0===b?void 0:b.exchangeName,label:k.exchangeTable,readOnly:!0})}),(0,n.jsx)(l.ZP,{item:!0,xs:12,children:(0,n.jsx)(d.Z,{name:"rateCalcMethodName",value:null==M?void 0:null===(F=M.values)||void 0===F?void 0:F.rateCalcMethodName,label:k.rateCalcMethod,readOnly:!0})}),(0,n.jsx)(l.ZP,{item:!0,xs:12,children:(0,n.jsx)(s.Z,{name:"exRate",value:null==M?void 0:null===(A=M.values)||void 0===A?void 0:A.exRate,label:k.rate,readOnly:(null==M?void 0:null===(C=M.values)||void 0===C?void 0:C.amount)==0,maxAccess:P,onClear:()=>{M.setFieldValue("baseAmount",""),M.setFieldValue("exRate","")},decimalScale:7,onChange:e=>{var a,t;let n=e.target.value;if(!n){M.setFieldValue("exRate",""),M.setFieldValue("baseAmount","");return}M.setFieldValue("exRate",n);let l=(0,v.fB)({amount:(null==V?void 0:V.amount)||0,exRate:n,baseAmount:parseFloat((null==M?void 0:null===(a=M.values)||void 0===a?void 0:a.baseAmount)||0).toFixed(2),rateCalcMethod:null==M?void 0:null===(t=M.values)||void 0===t?void 0:t.rateCalcMethod,dirtyField:v.ss});M.setValues({...M.values,...l,baseAmount:parseFloat(l.baseAmount).toFixed(2)})}})}),(0,n.jsx)(l.ZP,{item:!0,xs:12,children:(0,n.jsx)(s.Z,{name:"amount",value:null==M?void 0:null===(N=M.values)||void 0===N?void 0:N.amount,label:k.amount,readOnly:!0})}),(0,n.jsx)(l.ZP,{item:!0,xs:12,children:(0,n.jsx)(s.Z,{name:"baseAmount",value:null==M?void 0:null===(j=M.values)||void 0===j?void 0:j.baseAmount,label:k.baseAmount,readOnly:(null==M?void 0:null===(R=M.values)||void 0===R?void 0:R.amount)==0,onClear:()=>{M.setFieldValue("baseAmount",""),M.setFieldValue("exRate","")},maxAccess:P,onChange:e=>{var a,t;let n=e.target.value;if(!n){M.setFieldValue("baseAmount",""),M.setFieldValue("exRate","");return}M.setFieldValue("baseAmount",n);let l=(0,v.fB)({amount:(null==V?void 0:V.amount)||0,exRate:null==M?void 0:null===(a=M.values)||void 0===a?void 0:a.exRate,baseAmount:parseFloat(n||0).toFixed(2),rateCalcMethod:null==M?void 0:null===(t=M.values)||void 0===t?void 0:t.rateCalcMethod,dirtyField:v.i5});M.setValues({...M.values,...l})}})})]})})})})}b.width=500,b.height=500}},function(e){e.O(0,[92515,2494,36908,49774,92888,40179],function(){return e(e.s=31183)}),_N_E=e.O()}]);