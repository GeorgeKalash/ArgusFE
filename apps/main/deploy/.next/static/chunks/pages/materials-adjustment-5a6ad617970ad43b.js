(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[44894],{34259:function(e,t,l){(window.__NEXT_P=window.__NEXT_P||[]).push(["/materials-adjustment",function(){return l(83633)}])},64581:function(e,t){"use strict";t.Z={src:"/_next/static/media/imgSerials.d1ee59bb.png",height:17,width:23,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAGCAMAAADJ2y/JAAAAIVBMVEUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABt0UjBAAAAC3RSTlMCZzsmQ6RbWbaSTwNdgTwAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAArSURBVHicY2BiZ2BgYOBiZmBmYmRjZGRhYGBg4eBkZWVDYjAzMbKDpWCKARB/AJwjPQgCAAAAAElFTkSuQmCC",blurWidth:8,blurHeight:6}},83633:function(e,t,l){"use strict";l.r(t),l.d(t,{default:function(){return T}});var i=l(52322),n=l(2784),a=l(62202),d=l(69387),r=l(65950),o=l(65215),s=l(71987),u=l(61802),c=l(26612),m=l(89330),v=l(39812),p=l(60218),y=l(48601),f=l(82737),I=l(5088),h=l(21581),g=l(8661),x=l(38449),A=l(7121),w=l(76399),b=l(31389),k=l(33625),N=l(62362),j=l(80983),C=l(19473),S=l(98345),_=l(27423),q=l(22341),F=l(85572),Z=l(25506),V=l(51235),R=l(96026);function O(e){var t,d,O,P,T,M,D,$,U,L,E,B;let{labels:J,access:Q,recordId:W,window:K}=e,{getRequest:G,postRequest:z}=(0,n.useContext)(r.$),{platformLabels:Y,userDefaultsData:X,systemChecks:H}=(0,n.useContext)(C.l),{stack:ee}=(0,u.zY)(),{stack:et}=(0,R.V)(),el=(0,n.useRef)([]),[ei,en]=(0,n.useState)([]),{documentType:ea,maxAccess:ed,changeDT:er}=(0,S.H)({functionId:A.J.MaterialAdjustment,access:Q,enabled:!W}),eo=parseInt(null==X?void 0:null===(d=X.list)||void 0===d?void 0:null===(t=d.find(e=>"plantId"===e.key))||void 0===t?void 0:t.value),es=parseInt(null==X?void 0:null===(P=X.list)||void 0===P?void 0:null===(O=P.find(e=>"siteId"===e.key))||void 0===O?void 0:O.value),eu=null==H?void 0:null===(T=H.find(e=>e.checkId===V.F.POS_JUMP_TO_NEXT_LINE))||void 0===T?void 0:T.value,ec={disableSKULookup:!1,recordId:W,dtId:null,reference:"",plantId:eo,siteId:es,description:"",date:new Date,status:1,wip:1,rsStatus:"",clientId:null,clientName:"",isVerified:!1,clientRef:"",rows:[{id:1,itemId:"",sku:"",itemName:"",qty:"",totalCost:"",totalQty:"",muQty:"",qtyInBase:"",notes:"",seqNo:""}],serials:[]},em=(0,s.E)({endpointId:o.$.MaterialsAdjustment.page}),{formik:ev}=(0,j.c)({maxAccess:ed,documentType:{key:"dtId",value:null==ea?void 0:ea.dtId},initialValues:ec,validateOnChange:!0,validationSchema:y.Ry({siteId:y.Rx().required(),date:y.hT().required(),rows:y.IX().of(y.Ry().shape({sku:y.Z_().required(),qty:y.Rx().required(),itemName:y.Z_().required()})).required()}),onSubmit:async e=>{let t={...e};delete t.rows,delete t.serials,t.date=(0,v.ku)(t.date);let l=[],i=ev.values.rows.map((e,t)=>{let{serials:i,...n}=e,a=e.muQty||1;if(i){let n=i.map((l,i)=>({...l,seqNo:t+1,srlSeqNo:0,componentSeqNo:0,itemId:null==e?void 0:e.itemId,adjustmentId:ev.values.recordId||0,id:i}));l.push(...n)}return{...n,adjustmentId:ev.values.recordId||0,qtyInBase:a*e.qty,seqNo:t+1}}),n=await z({extension:o.$.MaterialsAdjustment.set2,record:JSON.stringify({header:t,items:i,serials:l,lots:[]})}),d=ep?Y.Edited:Y.Added;(null==n?void 0:n.recordId)&&(await eR(null==n?void 0:n.recordId),a.ZP.success(d),em())}}),ep=!!ev.values.recordId,ey=3===ev.values.status,ef=(0,n.useRef)(null==ev?void 0:null===(M=ev.values)||void 0===M?void 0:M.rows),{totalQty:eI,totalCost:eh,totalWeight:eg}=null==ev?void 0:null===($=ev.values)||void 0===$?void 0:null===(D=$.rows)||void 0===D?void 0:D.reduce((e,t)=>{let l=parseFloat(null==t?void 0:t.qty)||0,i=parseFloat(null==t?void 0:t.totalCost)||0,n=parseFloat(null==t?void 0:t.weight)||0;return{totalQty:(null==e?void 0:e.totalQty)+l,totalCost:(Math.round((parseFloat(null==e?void 0:e.totalCost)+i)*100)/100).toFixed(2),totalWeight:(null==e?void 0:e.totalWeight)+n}},{totalQty:0,totalCost:0,totalWeight:0});async function ex(){await z({extension:o.$.MaterialsAdjustment.post,record:JSON.stringify({...ev.values,date:(0,v.ku)(ev.values.date)})}),K.close(),em()}let eA=async()=>{let e=await z({extension:o.$.MaterialsAdjustment.unpost,record:JSON.stringify({...ev.values,date:(0,v.ku)(ev.values.date)})});a.ZP.success(Y.Unposted),eR(null==e?void 0:e.recordId),em()};async function ew(e){if(e){var t,l,i;let n=await G({extension:o.$.DocumentTypeDefaults.get,parameters:"_dtId=".concat(e)});return ev.setFieldValue("siteId",(null==n?void 0:null===(t=n.record)||void 0===t?void 0:t.siteId)||es||null),ev.setFieldValue("plantId",(null==n?void 0:null===(l=n.record)||void 0===l?void 0:l.plantId)||eo),ev.setFieldValue("disableSKULookup",(null==n?void 0:null===(i=n.record)||void 0===i?void 0:i.disableSKULookup)||!1),n}}(0,n.useEffect)(()=>{var e,t;if(ev.values.dtId&&!W&&ew(null==ev?void 0:null===(e=ev.values)||void 0===e?void 0:e.dtId),!(null==ev?void 0:null===(t=ev.values)||void 0===t?void 0:t.dtId)){ev.setFieldValue("disableSKULookup",!1);return}},[ev.values.dtId]);let eb=e=>1===e.trackBy?{imgSrc:l(64581).Z.src,hidden:!1}:{imgSrc:"",hidden:!0},ek=async e=>{var t,l,i,n;let a=await G({extension:o.$.Physical.get,parameters:"_itemId=".concat(e)});return{weight:null!==(n=null==a?void 0:null===(t=a.record)||void 0===t?void 0:t.weight)&&void 0!==n?n:0,metalId:null==a?void 0:null===(l=a.record)||void 0===l?void 0:l.metalId,metalRef:null==a?void 0:null===(i=a.record)||void 0===i?void 0:i.metalRef}},eN=async e=>{var t;let l=await G({extension:o.$.CurrentCost.get,parameters:"_itemId="+e});return null==l?void 0:null===(t=l.record)||void 0===t?void 0:t.currentCost};async function ej(e,t){if(!e)return;let l=(null==ei?void 0:ei.filter(e=>e.msId===t))||[];el.current=l}let eC=async()=>await G({extension:o.$.MeasurementUnit.qry,parameters:"_msId=0"});function eS(e){return 1===e.priceType?(Math.round(e.qty*e.unitCost*100)/100).toFixed(2):2===e.priceType?(Math.round(e.qty*e.unitCost*e.volume*100)/100).toFixed(2):3===e.priceType?(Math.round(e.qty*e.unitCost*e.weight*100)/100).toFixed(2):0}async function e_(e){let t=await G({extension:o.$.Item.get,parameters:"_recordId=".concat(e)});return null==t?void 0:t.record}async function eq(e){let t=await G({extension:o.$.Measurement.get,parameters:"_recordId=".concat(e)});return null==t?void 0:t.record}(0,n.useEffect)(()=>{!async function(){let e=await eC();en(null==e?void 0:e.list)}()},[]);let eF=async(e,t)=>{let l=ev.values.disableSKULookup?null==e?void 0:e.recordId:null==e?void 0:e.itemId,i=ev.values.disableSKULookup?null==e?void 0:e.name:null==e?void 0:e.itemName;if(l){var n,a,d;let{weight:r,metalId:o,metalRef:s}=await ek(l),u=null!==(d=await eN(l))&&void 0!==d?d:0,c=eS(e),m=await e_(l);await ej(l,null==e?void 0:e.msId);let v=null==ei?void 0:ei.filter(e=>e.msId===(null==m?void 0:m.msId)),p=await eq(null==e?void 0:e.msId);t({qty:0,sku:e.sku,itemId:l,weight:r,unitCost:u,itemName:i,totalCost:c,details:!0,msId:null==m?void 0:m.msId,decimals:null==p?void 0:p.decimals,muRef:null==v?void 0:null===(n=v[0])||void 0===n?void 0:n.reference,muId:null==v?void 0:null===(a=v[0])||void 0===a?void 0:a.recordId,metalId:o,metalRef:s,priceType:null==e?void 0:e.priceType})}},eZ=[{component:(null==ev?void 0:null===(U=ev.values)||void 0===U?void 0:U.disableSKULookup)?"textfield":"resourcelookup",label:J.sku,name:"sku",jumpToNextLine:eu,...ev.values.disableSKULookup&&{updateOn:"blur"},props:{...!ev.values.disableSKULookup&&{endpointId:o.$.Item.snapshot,valueField:"sku",displayField:"sku",mapping:[{from:"recordId",to:"itemId"},{from:"msId",to:"msId"},{from:"trackBy",to:"trackBy"},{from:"lotCategoryId",to:"lotCategoryId"},{from:"priceType",to:"priceType"},{from:"sku",to:"sku"},{from:"name",to:"itemName"},{from:"isInactive",to:"isInactive"}],columnsInDropDown:[{key:"sku",value:"SKU"},{key:"name",value:"Name"}],displayFieldWidth:3}},propsReducer(e){let{row:t,props:l}=e;return{...l,imgSrc:eb(t)}},async onChange(e){let{row:{update:t,newRow:l}}=e;if(ev.values.disableSKULookup){if(!(null==l?void 0:l.sku)){t({...ev.initialValues.rows[0],id:l.id});return}let e=await G({extension:o.$.Items.get2,parameters:"_sku=".concat(l.sku)});if(!e.record){t({...ev.initialValues.rows[0],id:l.id}),et({message:J.invalidSKU});return}(null==l?void 0:l.sku)&&eF(e.record,t)}else{if(!(null==l?void 0:l.itemId)){t({details:!1});return}if(l.isInactive){t({...ev.initialValues.rows[0],id:l.id}),et({message:J.inactiveItem});return}(null==l?void 0:l.itemId)&&await eF(l,t)}}},{component:"textfield",label:J.itemName,name:"itemName",flex:2,props:{readOnly:!0}},{component:"textfield",label:J.metalRef,name:"metalRef",props:{readOnly:!0}},{component:"resourcecombobox",label:J.muId,name:"muRef",props:{store:null==el?void 0:el.current,displayField:"reference",valueField:"recordId",mapping:[{from:"reference",to:"muRef"},{from:"qty",to:"muQty"},{from:"recordId",to:"muId"}]},async onChange(e){var t;let{row:{update:l,newRow:i}}=e,n=null==el?void 0:el.current.filter(e=>e.recordId===(null==i?void 0:i.muId));l({qtyInBase:(null==i?void 0:i.qty)*(null==n?void 0:n.muQty),muQty:null==i?void 0:i.muQty})},propsReducer(e){let{row:t,props:l}=e;return{...l,store:null==el?void 0:el.current}}},{component:"numberfield",label:J.qty,name:"qty",props:{maxLength:11,onCondition:e=>({decimalScale:null==e?void 0:e.decimals,readOnly:!(null==e?void 0:e.itemId)})},async onChange(e){let{row:{update:t,newRow:l}}=e;if(l){var i;t({totalCost:eS(l),qtyInBase:(null==l?void 0:l.qty)*(null==l?void 0:l.muQty)})}}},{component:"numberfield",label:J.pieces,name:"pcs",props:{readOnly:!0}},{component:"numberfield",label:J.weight,name:"weight",props:{readOnly:!0}},{component:"numberfield",label:J.unitCost,name:"unitCost",async onChange(e){let{row:{update:t,newRow:l}}=e;l&&t({totalCost:eS(l)})}},{component:"numberfield",label:J.totalCost,name:"totalCost",async onChange(e){let{row:{update:t,newRow:l}}=e;l&&t({unitCost:1===l.priceType?0!=l.qty?(l.totalCost/l.qty).toFixed(2):0:2===l.priceType?0!=l.qty||0!=l.volume?(l.totalCost/(l.qty*l.volume)).toFixed(2):0:3===l.priceType&&(0!=l.qty||0!=l.weight)?(l.totalCost/(l.qty*l.weight)).toFixed(2):0})}},{component:"textfield",label:J.notes,name:"notes"},{component:"button",name:"serials",label:Y.serials,props:{onCondition:eb},onClick:(e,t,l,i)=>{if((null==t?void 0:t.trackBy)===1){var n;ee({Component:F.u,props:{labels:J,disabled:ey,row:t,siteId:t.qty>=0?null:null==ev?void 0:null===(n=ev.values)||void 0===n?void 0:n.siteId,maxAccess:ed,checkForSiteId:!(t.qty>=0),updateRow:i}})}}}];async function eV(e,t){return await G({extension:o.$.MaterialAdjustmentSerial.qry,parameters:"_adjustmentId=".concat(e,"&_seqNo=").concat(t,"&_componentSeqNo=",0)})}async function eR(e){let t=await G({extension:o.$.MaterialsAdjustment.get,parameters:"_recordId=".concat(e)}),l=await G({extension:o.$.MaterialsAdjustmentDetail.qry,parameters:"_filter=&_adjustmentId=".concat(e)}),i=await Promise.all(l.list.map(async t=>{var l;let i=await eV(e,t.seqNo);return{...t,id:t.seqNo,pcs:t.pcs||0,serials:null==i?void 0:null===(l=i.list)||void 0===l?void 0:l.map((e,t)=>({...e,id:t})),totalCost:eS(t)}}));return ev.setValues({...t.record,date:(0,v.a1)(t.record.date),rows:i}),null==t?void 0:t.record}(0,n.useEffect)(()=>{W&&eR(W)},[]);let eO=async()=>{var e;return(null==ef?void 0:null===(e=ef.current)||void 0===e?void 0:e.filter(e=>e.metalId).map(e=>({qty:e.qty,metalRef:"",metalId:e.metalId,metalPurity:e.metalPurity,weight:e.weight,priceType:e.priceType})))||[]};async function eP(){let e={...ev.values,isVerified:!ev.values.isVerified};delete e.items,await z({extension:o.$.MaterialsAdjustment.verify,record:JSON.stringify(e)}),a.ZP.success(ev.values.isVerified?Y.Unverfied:Y.Verified),eR(ev.values.recordId),em()}let eT=[{key:"Verify",condition:!ev.values.isVerified,onClick:eP,disabled:ev.values.isVerified||!ep||!ey},{key:"Unverify",condition:ev.values.isVerified,onClick:eP,disabled:!ev.values.isVerified},{key:"RecordRemarks",condition:!0,onClick:"onRecordRemarks",disabled:!ep},{key:"Locked",condition:ey,onClick:"onUnpostConfirmation",onSuccess:eA,disabled:!ep},{key:"Unlocked",condition:!ey,onClick:ex,disabled:!ep},{key:"GL",condition:!0,onClick:"onClickGL",disabled:!ep,valuesPath:{...ev.values,notes:ev.values.description},datasetId:c.i.GLMaterialAdjustment},{key:"IV",condition:!0,onClick:"onInventoryTransaction",disabled:!ep||!ey},{key:"Metals",condition:!0,onClick:"onClickMetal",handleMetalClick:eO}];return(0,i.jsx)(f.Z,{resourceId:c.i.MaterialsAdjustment,functionId:A.J.MaterialAdjustment,form:ev,maxAccess:ed,editMode:ep,isPosted:ey,postVisible:!0,actions:eT,previewReport:ep,disabledSubmit:ey,children:(0,i.jsxs)(b.R,{children:[(0,i.jsx)(k.g,{children:(0,i.jsxs)(p.ZP,{container:!0,spacing:2,children:[(0,i.jsx)(p.ZP,{item:!0,xs:6,children:(0,i.jsxs)(p.ZP,{container:!0,spacing:2,children:[(0,i.jsx)(p.ZP,{item:!0,xs:12,children:(0,i.jsx)(g.Z,{endpointId:x.r.DocumentType.qry,parameters:"_startAt=0&_pageSize=1000&_dgId=".concat(A.J.MaterialAdjustment),name:"dtId",label:J.documentType,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],readOnly:ep,valueField:"recordId",displayField:["reference","name"],values:ev.values,maxAccess:!ep&&ed,onChange:(e,t)=>{er(t),ev.setFieldValue("dtId",(null==t?void 0:t.recordId)||null)},error:ev.touched.dtId&&!!ev.errors.dtId})}),(0,i.jsx)(p.ZP,{item:!0,xs:12,children:(0,i.jsx)(I.Z,{name:"reference",label:J.reference,value:null==ev?void 0:null===(L=ev.values)||void 0===L?void 0:L.reference,maxAccess:!ep&&ed,readOnly:ep,onChange:ev.handleChange,onClear:()=>ev.setFieldValue("reference",""),error:ev.touched.reference&&!!ev.errors.reference})}),(0,i.jsx)(p.ZP,{item:!0,xs:12,children:(0,i.jsx)(m.Z,{name:"date",label:J.date,readOnly:ey,value:null==ev?void 0:null===(E=ev.values)||void 0===E?void 0:E.date,onChange:ev.setFieldValue,required:!0,maxAccess:ed,onClear:()=>ev.setFieldValue("date",null),error:ev.touched.date&&!!ev.errors.date})}),(0,i.jsx)(p.ZP,{item:!0,xs:12,children:(0,i.jsx)(_.U,{endpointId:q.P.Client.snapshot,valueField:"reference",displayField:"name",name:"clientId",label:J.client,form:ev,readOnly:ey,displayFieldWidth:3,valueShow:"clientRef",secondValueShow:"clientName",maxAccess:ed,editMode:ep,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"},{key:"szName",value:"Sales Zone"}],onChange:async(e,t)=>{ev.setFieldValue("clientId",(null==t?void 0:t.recordId)||null),ev.setFieldValue("clientName",(null==t?void 0:t.name)||""),ev.setFieldValue("clientRef",(null==t?void 0:t.reference)||"")},errorCheck:"clientId"})})]})}),(0,i.jsx)(p.ZP,{item:!0,xs:6,children:(0,i.jsxs)(p.ZP,{container:!0,spacing:2,children:[(0,i.jsx)(p.ZP,{item:!0,xs:12,children:(0,i.jsx)(g.Z,{endpointId:x.r.Plant.qry,name:"plantId",label:J.plant,readOnly:ey,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:ev.values,valueField:"recordId",displayField:["reference","name"],maxAccess:ed,onChange:(e,t)=>{ev.setFieldValue("plantId",null==t?void 0:t.recordId)},error:ev.touched.plantId&&!!ev.errors.plantId})}),(0,i.jsx)(p.ZP,{item:!0,xs:12,children:(0,i.jsx)(g.Z,{endpointId:o.$.Site.qry,name:"siteId",readOnly:ey,label:J.site,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:ev.values,valueField:"recordId",displayField:["reference","name"],required:!0,maxAccess:ed,onChange:(e,t)=>{ev.setFieldValue("plantId",(null==t?void 0:t.plantId)||null),ev.setFieldValue("siteId",(null==t?void 0:t.recordId)||null)},error:ev.touched.siteId&&!!ev.errors.siteId})}),(0,i.jsx)(p.ZP,{item:!0,xs:12,children:(0,i.jsx)(h.Z,{name:"description",label:J.description,value:null==ev?void 0:null===(B=ev.values)||void 0===B?void 0:B.description,rows:2.5,readOnly:ey,maxAccess:ed,onChange:ev.handleChange,onClear:()=>ev.setFieldValue("description",""),error:ev.touched.description&&!!ev.errors.description})})]})})]})}),(0,i.jsx)(N.Q,{children:(0,i.jsx)(w._,{onChange:e=>ev.setFieldValue("rows",e),value:ev.values.rows,error:ev.errors.rows,name:"rows",maxAccess:ed,onSelectionChange:(e,t,l)=>{"muRef"==l&&ej(null==e?void 0:e.itemId,null==e?void 0:e.msId)},columns:eZ,allowAddNewLine:!ey,allowDelete:!ey,disabled:ey||!ev.values.siteId})}),(0,i.jsx)(k.g,{children:(0,i.jsxs)(p.ZP,{container:!0,xs:3,spacing:2,children:[(0,i.jsx)(p.ZP,{item:!0,xs:12,children:(0,i.jsx)(I.Z,{name:"totalQty",maxAccess:ed,value:(0,Z.bj)(Number(eI).toFixed(2)),label:J.totalQty,readOnly:!0})}),(0,i.jsx)(p.ZP,{item:!0,xs:12,children:(0,i.jsx)(I.Z,{name:"totalCost",maxAccess:ed,value:(0,Z.bj)(Number(eh).toFixed(2)),label:J.totalCost,readOnly:!0})}),(0,i.jsx)(p.ZP,{item:!0,xs:12,children:(0,i.jsx)(I.Z,{name:"totalWeight",maxAccess:ed,value:(0,Z.bj)(eg),label:J.totalWeight,readOnly:!0})})]})})]})})}var P=l(36908),T=()=>{let{getRequest:e,postRequest:t}=(0,n.useContext)(r.$),{platformLabels:l}=(0,n.useContext)(C.l),{stack:m}=(0,u.zY)();async function v(){var t;let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{_startAt:i=0,_pageSize:n=50,params:a}=l,d=await e({extension:o.$.MaterialsAdjustment.page,parameters:"_startAt=".concat(i,"&_pageSize=").concat(n,"&filter=&_size=50&_params=").concat(a||"","&_dgId=0&_sortBy=recordId&_trxType=1")});return d.list=null==d?void 0:null===(t=d.list)||void 0===t?void 0:t.map(e=>({...e,isVerified:(null==e?void 0:e.isVerified)!==null&&(null==e?void 0:e.isVerified)})),{...d,_startAt:i}}async function p(t){let{filters:l,pagination:i}=t;return l.qry?await e({extension:o.$.MaterialsAdjustment.snapshot,parameters:"_filter=".concat(l.qry)}):v({_startAt:i._startAt||0,params:null==l?void 0:l.params})}let{query:{data:y},labels:f,paginationParameters:I,refetch:h,access:g,filterBy:x,invalidate:w}=(0,s.J)({queryFn:v,endpointId:o.$.MaterialsAdjustment.page,datasetId:c.i.MaterialsAdjustment,filter:{filterFn:p}}),j=[{field:"reference",headerName:f.refernce,flex:1},{field:"date",headerName:f.date,flex:1,type:"date"},{field:"siteRef",headerName:f.siteRef,flex:1},{field:"siteName",headerName:f.siteName,flex:1},{field:"description",headerName:f.description,flex:1},{field:"statusName",headerName:f.status,flex:1},{field:"qty",headerName:f.qty,flex:1},{field:"pcs",headerName:f.pcs,flex:1,type:"number"},{field:"isVerified",headerName:f.isVerified,type:"checkbox"}],{proxyAction:_}=(0,S.G)({functionId:A.J.MaterialAdjustment,action:F}),q=async()=>{await _()};function F(e){m({Component:O,props:{recordId:e,labels:f,access:g},width:1200,height:700,title:f.materialsAdjustment})}let Z=async e=>{await t({extension:o.$.MaterialsAdjustment.del,record:JSON.stringify(e)}),w(),a.ZP.success(l.Deleted)};return(0,i.jsxs)(b.R,{children:[(0,i.jsx)(k.g,{children:(0,i.jsx)(P.Z,{maxAccess:g,onAdd:q,filterBy:x,reportName:"IVADJ"})}),(0,i.jsx)(N.Q,{children:(0,i.jsx)(d.Z,{name:"table",columns:j,gridData:y,rowId:["recordId"],onEdit:e=>{F(null==e?void 0:e.recordId)},onDelete:Z,deleteConfirmationType:"strict",isLoading:!1,pageSize:50,refetch:h,paginationParameters:I,paginationType:"api",maxAccess:g})})]})}},1685:function(e,t,l){"use strict";l.d(t,{m:function(){return i}});let i=e=>{let t=window.sessionStorage.getItem(e);return t?JSON.parse(t):null}},98345:function(e,t,l){"use strict";l.d(t,{H:function(){return y},G:function(){return p}});var i=l(45300),n=l(2784),a=l(96026),d=l(38449);l(26612);var r=l(65947),o=l(1685);let s=async(e,t,l)=>{try{let i=await e({extension:t,parameters:l});return t.includes("qry")?i:i.record}catch(e){return null}},u=(e,t,l,i)=>{let n=(e=JSON.parse(JSON.stringify(e))).record.controls,a=n.find(e=>"reference"===e.controlId);return a?a.accessLevel=(null==t?void 0:t.mandatory)?r.$7:r.rr:(null==t?void 0:t.mandatory)?n.push({sgId:0,resourceId:"",controlId:"".concat(i?i+".":"","reference"),accessLevel:(null==t?void 0:t.mandatory)?r.$7:r.rr}):(null==t?void 0:t.readOnly)?n.push({sgId:0,resourceId:"",controlId:"".concat(i?i+".":"","reference"),accessLevel:(null==t?void 0:t.readOnly)?r.rr:r.$7}):n=e.record.controls.filter(e=>"reference"!=e.controlId),l&&n.push({sgId:0,resourceId:"",controlId:"".concat(i?i+".":"","dtId"),accessLevel:r.$7}),{...e,record:{...e.record,controls:n}}},c=async(e,t,l)=>{let i,n;switch(l){case"dtId":let a=(0,o.m)("userData"),r=null==a?void 0:a.userId;n="_userId=".concat(r,"&_functionId=").concat(t),i=d.r.UserFunction.get;break;case"glbSysNumberRange":n="_recordId=".concat(t),i=d.r.SystemFunction.get;break;case"DocumentType":n="_dgId=".concat(t,"&_startAt=",0,"&_pageSize=",50),i=d.r.DocumentType.qry;break;case"DcTypNumberRange":n="_recordId=".concat(t),i=d.r.DocumentType.get;break;case"isExternal":n="_recordId=".concat(t),i=d.r.NumberRange.get;break;default:return null}return await s(e,i,n)},m=async function(e){let t,l,i,n,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,d=arguments.length>2?arguments[2]:void 0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,o=!(arguments.length>4)||void 0===arguments[4]||arguments[4],s=arguments.length>5?arguments[5]:void 0,m=void 0===r&&a&&await c(e,a,"dtId"),v=null==m?void 0:m.dtId,p="",y=!0;if(m&&void 0===r||"nraId"===r){if(v){let l=await c(e,v,"DcTypNumberRange");t=null==l?void 0:l.nraId,y=!((null==l?void 0:l.activeStatus)<0),t||(p="Assign the document type to a number range")}if((!v||!y)&&o&&a){var f;let t=await c(e,a,"DocumentType");n=(null==t?void 0:null===(f=t.list)||void 0===f?void 0:f.filter(e=>(null==e?void 0:e.activeStatus)===1).length)>0}}if(("nraId"===r||void 0===r)&&a){if((!v||v)&&!t||t&&!y){let l=await c(e,a,"glbSysNumberRange");(t=null==l?void 0:l.nraId)&&n&&(n=!1),y=!0}p=t||n?"":"Assign the system Function to a number range"}r>0&&!t&&(t=r),t&&y?(l={readOnly:null==(i=await c(e,t,"isExternal"))||!i.external,mandatory:null!=i&&!!i.external},d&&(d=await u(d,l,n,s))):!t&&d&&(d=await u(d,l,n,s));let I=s?"".concat(s,".reference"):"reference";return{dtId:v,resetReference:null==l?void 0:l.readOnly,dcTypeRequired:n,reference:{fieldName:I,isEmpty:(null==i?void 0:i.external)!==void 0&&(null==i||!i.external)},errorMessage:p,maxAccess:d,selectNraId:r}};var v=l(65950);function p(e){let{functionId:t,action:l,hasDT:i}=e,{getRequest:d}=(0,n.useContext)(v.$),{stack:r}=(0,a.V)();return{proxyAction:async()=>{let e=await m(d,t,"",void 0,i);(null==e?void 0:e.errorMessage)?r({message:null==e?void 0:e.errorMessage}):await l()}}}function y(e){var t;let{functionId:l,access:d,hasDT:r,enabled:o=!0,objectName:s=""}=e,{getRequest:u}=(0,n.useContext)(v.$),{stack:c}=(0,a.V)(),[p,y]=(0,n.useState)(),f=async e=>{let t=await m(u,l,d,e,r,s);if(!t.errorMessage)return t;c({message:null==t?void 0:t.errorMessage})},I=(0,i.a)({retry:!1,staleTime:0,enabled:o,queryKey:[l,p,!!d,o],queryFn:p||"nraId"===p?()=>f(p):()=>f()});return{documentType:I.data,maxAccess:(null==I?void 0:null===(t=I.data)||void 0===t?void 0:t.maxAccess)||d,changeDT(e){y((null==e?void 0:e.nraId)||"nraId")}}}},85572:function(e,t,l){"use strict";l.d(t,{u:function(){return k}});var i=l(52322),n=l(31389),a=l(62362),d=l(26612),r=l(60218),o=l(8661),s=l(80983),u=l(48601),c=l(71987),m=l(2784),v=l(65950),p=l(91406),y=l(27423),f=l(65215),I=l(76399),h=l(33625),g=l(96026),x=l(19473),A=l(51235),w=l(21326),b=l(54074);let k=e=>{var t,l,k,N,j,C;let{row:S,siteId:_,checkForSiteId:q,window:F,updateRow:Z,disabled:V}=e,{getRequest:R}=(0,m.useContext)(v.$),{stack:O}=(0,g.V)(),{platformLabels:P,systemChecks:T}=(0,m.useContext)(x.l),M=T.some(e=>e.checkId===A.F.ALLOW_INVENTORY_NEGATIVE_QTY),D=(null==T?void 0:null===(t=T.find(e=>e.checkId===A.F.POS_JUMP_TO_NEXT_LINE))||void 0===t?void 0:t.value)||!1,{labels:$,maxAccess:U}=(0,c.J)({datasetId:d.i.Serial});(0,w.Z)({title:P.serials,window:F});let{formik:L}=(0,s.c)({maxAccess:U,initialValues:{sku:null==S?void 0:S.sku,itemName:null==S?void 0:S.itemName,itemId:null==S?void 0:S.itemId,siteId:_,totalWeight:(null==S?void 0:S.qty)||0,pieces:null,items:(null==S?void 0:S.serials)||[]},validateOnChange:!0,validationSchema:u.Ry({items:u.IX().of(u.Ry({srlNo:u.Z_().test(function(e){var t,l,i;return(null===(i=this.options.from[1])||void 0===i?void 0:null===(l=i.value)||void 0===l?void 0:null===(t=l.items)||void 0===t?void 0:t.length)===1||!!e})}))}),onSubmit:async e=>{let t=e.items.filter(e=>null==e?void 0:e.srlNo).map((e,t)=>({...e,id:t+1,srlSeqNo:t+1,srlNo:e.srlNo,seqNo:S.id}));Z({changes:{serials:t,...(null==S?void 0:S.hasOwnProperty("serialCount"))&&{serialCount:(null==t?void 0:t.length)||0}}}),F.close()}}),E=L.values.items.reduce((e,t)=>e+(parseFloat(t.weight)||0),0),B=L.values.totalWeight-E||0,J=[{component:"textfield",name:"srlNo",label:$.serialNo,jumpToNextLine:D,updateOn:"blur",onChange:async e=>{let{row:{update:t,newRow:l,oldRow:i,addRow:n}}=e;l.srlNo!==(null==i?void 0:i.srlNo)&&await K(l,t,n)}},{component:"numberfield",name:"weight",label:$.weight,props:{readOnly:!0}}],Q=e=>{let t=L.values.items.map(t=>t.id===e?{...t,srlNo:"",weight:""}:t);L.setFieldValue("items",t)},W=e=>{let t=L.values.items.filter(t=>t.id!==e);0===t.length&&(t=[{id:0,srlNo:"",weight:""}]),L.setFieldValue("items",t)},K=async(e,t,l)=>{let{srlNo:i,id:n}=e;if(i){var a;let d=await R({extension:f.$.Serial.get,parameters:"_srlNo=".concat(i)});d.record?(null==d?void 0:null===(a=d.record)||void 0===a?void 0:a.itemId)!==(null==S?void 0:S.itemId)?(O({message:P.serialDoesNotBelongItem}),Q(n)):q&&!M&&L.values.siteId?(await R({extension:f.$.AvailabilitySerial.get,parameters:"_srlNo=".concat(i,"&_siteId=").concat(L.values.siteId)})).record?(t({weight:d.record.weight}),l({fieldName:"srlNo",changes:{id:e.id,srlNo:e.srlNo,weight:d.record.weight}})):(O({message:$.invalidSerial}),Q(n)):(t({weight:d.record.weight}),l({fieldName:"srlNo",changes:{id:e.id,srlNo:e.srlNo,weight:d.record.weight}})):(O({message:P.unknownSerial}),W(n))}},G=[{key:"Ok",condition:!0,onClick:()=>L.handleSubmit(),disabled:V}];return(0,i.jsx)(b.Z,{onSave:L.handleSubmit,isSaved:!1,actions:G,maxAccess:U,children:(0,i.jsxs)(n.R,{children:[(0,i.jsx)(h.g,{children:(0,i.jsxs)(r.ZP,{container:!0,spacing:2,children:[(0,i.jsx)(r.ZP,{item:!0,xs:12,children:(0,i.jsx)(y.U,{endpointId:f.$.Item.snapshot,name:"itemId",label:null==$?void 0:$.sku,valueField:"recordId",displayField:"sku",valueShow:"sku",secondValueShow:"itemName",form:L,readOnly:!0})}),(0,i.jsx)(r.ZP,{item:!0,xs:12,children:(0,i.jsx)(o.Z,{endpointId:f.$.Site.qry,name:"siteId",label:$.site,values:L.values,valueField:"recordId",displayField:["reference","name"],maxAccess:U,readOnly:!0})}),(0,i.jsx)(r.ZP,{item:!0,xs:12,children:(0,i.jsx)(p.Z,{name:"totalWeight",label:$.totalWeight,maxAccess:U,value:L.values.totalWeight,readOnly:!0})}),(0,i.jsx)(r.ZP,{item:!0,xs:12,children:(0,i.jsx)(p.Z,{name:"weightAssigned",label:$.weightAssigned,maxAccess:U,value:E,readOnly:!0})}),(0,i.jsx)(r.ZP,{item:!0,xs:12,children:(0,i.jsx)(p.Z,{name:"balanceWeight",label:$.balanceWeight,maxAccess:U,value:B,readOnly:!0})}),(0,i.jsx)(r.ZP,{item:!0,xs:12,children:(0,i.jsx)(p.Z,{name:"pieces",label:$.pieces,maxAccess:U,value:null==L?void 0:null===(N=L.values)||void 0===N?void 0:null===(k=N.items)||void 0===k?void 0:null===(l=k.filter(e=>void 0!==e.srlNo))||void 0===l?void 0:l.length,readOnly:!0})})]})}),(0,i.jsx)(a.Q,{children:(0,i.jsx)(I._,{onChange:e=>L.setFieldValue("items",e),value:null===(j=L.values)||void 0===j?void 0:j.items,error:null===(C=L.errors)||void 0===C?void 0:C.items,name:"items",columns:J,maxAccess:U,disabled:V,allowDelete:!V,allowAddNewLine:!V})})]})})};k.width=500,k.height=700}},function(e){e.O(0,[92515,2494,36908,49774,92888,40179],function(){return e(e.s=34259)}),_N_E=e.O()}]);