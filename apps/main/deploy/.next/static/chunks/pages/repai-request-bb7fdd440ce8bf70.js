(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[22130],{57519:function(e,r,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/repai-request",function(){return t(95483)}])},95483:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return b}});var a=t(52322),n=t(2784),d=t(62202),l=t(69387),s=t(27723),i=t(65950),o=t(61802),u=t(71987),c=t(26612),p=t(31389),m=t(33625),y=t(62362),g=t(19473),v=t(54736),I=t(60218),f=t(48601),h=t(82737),q=t(5088),x=t(80983),T=t(98345),R=t(7121),P=t(8661),N=t(38449),S=t(27423),E=t(89330),F=t(39812),w=t(84100),O=t(21581);function D(e){var r,t,l;let{labels:s,access:o,recordId:m,window:D}=e,{getRequest:b,postRequest:k}=(0,n.useContext)(i.$),{platformLabels:C}=(0,n.useContext)(g.l),W=(0,u.E)({endpointId:v.m.RepairRequest.page}),{documentType:_,maxAccess:M,changeDT:j}=(0,T.H)({functionId:R.J.RepairRequest,access:o,enabled:!m}),{formik:A}=(0,x.c)({maxAccess:M,documentType:{key:"dtId",value:null==_?void 0:_.dtId},initialValues:{recordId:null,dtId:null,reference:"",employeeId:null,equipmentId:null,repairNameId:null,dueDate:new Date,date:new Date,repairTypeId:null,priority:null,description:"",status:1},validationSchema:f.Ry({employeeId:f.Rx().required(),equipmentId:f.Rx().required(),repairNameId:f.Rx().required(),dueDate:f.hT().required(),date:f.hT().required(),repairTypeId:f.Rx().required()}),onSubmit:async e=>{let r=await k({extension:v.m.RepairRequest.set,record:JSON.stringify({...e,date:(0,F.ku)(e.date),dueDate:(0,F.ku)(e.dueDate)})});d.ZP.success(e.recordId?C.Edited:C.Added),A.setFieldValue("recordId",r.recordId),W(),D.close()}}),V=!!A.values.recordId;return(0,n.useEffect)(()=>{!async function(){if(m){let e=await b({extension:v.m.RepairRequest.get,parameters:"_recordId=".concat(m)});A.setValues({...e.record,date:(0,F.a1)(e.record.date),dueDate:(0,F.a1)(e.record.dueDate)})}}()},[]),(0,a.jsx)(h.Z,{resourceId:c.i.RepairRequest,form:A,maxAccess:M,editMode:V,children:(0,a.jsx)(p.R,{children:(0,a.jsx)(y.Q,{children:(0,a.jsxs)(I.ZP,{container:!0,spacing:2,children:[(0,a.jsx)(I.ZP,{item:!0,xs:12,children:(0,a.jsx)(P.Z,{endpointId:N.r.DocumentType.qry,parameters:"_startAt=0&_pageSize=1000&_dgId=".concat(R.J.RepairRequest),name:"dtId",label:s.docType,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],readOnly:V,valueField:"recordId",displayField:["reference","name"],values:A.values,maxAccess:M,onChange:async(e,r)=>{await j(r),A.setFieldValue("dtId",(null==r?void 0:r.recordId)||null)},error:A.touched.dtId&&!!A.errors.dtId})}),(0,a.jsx)(I.ZP,{item:!0,xs:12,children:(0,a.jsx)(q.Z,{name:"reference",label:s.reference,value:null==A?void 0:null===(r=A.values)||void 0===r?void 0:r.reference,maxAccess:!V&&M,readOnly:V,onChange:A.handleChange,onClear:()=>A.setFieldValue("reference",""),error:A.touched.reference&&!!A.errors.reference})}),(0,a.jsx)(I.ZP,{item:!0,xs:12,children:(0,a.jsx)(S.U,{endpointId:v.m.Employee.snapshot,valueField:"reference",displayField:"name",name:"employeeId",label:s.employee,form:A,required:!0,firstFieldWidth:4,displayFieldWidth:3,valueShow:"employeeRef",secondValueShow:"employeeName",maxAccess:M,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"firstName",value:"First Name"},{key:"lastName",value:"Last Name"}],onChange:async(e,r)=>{A.setFieldValue("employeeName",r?r.firstName+" "+r.lastName:""),A.setFieldValue("employeeRef",(null==r?void 0:r.reference)||""),A.setFieldValue("employeeId",(null==r?void 0:r.recordId)||null)},errorCheck:"employeeId"})}),(0,a.jsx)(I.ZP,{item:!0,xs:12,children:(0,a.jsx)(S.U,{endpointId:v.m.Equipment.snapshot,valueField:"reference",displayField:"name",name:"equipmentId",label:s.equipment,form:A,required:!0,firstFieldWidth:4,displayFieldWidth:3,valueShow:"equipmentRef",secondValueShow:"equipmentName",maxAccess:M,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"description",value:"Description"}],onChange:async(e,r)=>{A.setFieldValue("equipmentName",(null==r?void 0:r.description)||""),A.setFieldValue("equipmentRef",(null==r?void 0:r.reference)||""),A.setFieldValue("equipmentId",(null==r?void 0:r.recordId)||null)},errorCheck:"equipmentId"})}),(0,a.jsx)(I.ZP,{item:!0,xs:12,children:(0,a.jsx)(P.Z,{endpointId:v.m.RepairName.qry,name:"repairNameId",label:s.repair,valueField:"recordId",maxAccess:M,displayField:"name",values:A.values,required:!0,onChange:(e,r)=>{A.setFieldValue("repairNameId",(null==r?void 0:r.recordId)||null)},error:A.touched.repairNameId&&!!A.errors.repairNameId})}),(0,a.jsx)(I.ZP,{item:!0,xs:12,children:(0,a.jsx)(E.Z,{name:"date",required:!0,label:s.date,value:null==A?void 0:null===(t=A.values)||void 0===t?void 0:t.date,onChange:A.setFieldValue,maxAccess:M,onClear:()=>A.setFieldValue("date",null),error:A.touched.date&&!!A.errors.date})}),(0,a.jsx)(I.ZP,{item:!0,xs:12,children:(0,a.jsx)(E.Z,{name:"dueDate",required:!0,label:s.dueBy,value:null==A?void 0:null===(l=A.values)||void 0===l?void 0:l.dueDate,onChange:A.setFieldValue,maxAccess:M,readOnly:!0,onClear:()=>A.setFieldValue("dueDate",null),error:A.touched.dueDate&&!!A.errors.dueDate})}),(0,a.jsx)(I.ZP,{item:!0,xs:12,children:(0,a.jsx)(P.Z,{endpointId:v.m.RepairType.qry,name:"repairTypeId",label:s.repairType,valueField:"recordId",maxAccess:M,displayField:"name",required:!0,values:A.values,onChange:(e,r)=>{A.setFieldValue("repairTypeId",(null==r?void 0:r.recordId)||null)},error:A.touched.repairTypeId&&!!A.errors.repairTypeId})}),(0,a.jsx)(I.ZP,{item:!0,xs:12,children:(0,a.jsx)(P.Z,{datasetId:w.v.RS_PRIORITY,name:"priority",label:s.priority,valueField:"key",displayField:"value",values:A.values,onChange:(e,r)=>{A.setFieldValue("priority",(null==r?void 0:r.key)||null)},maxAccess:M,error:A.touched.priority&&!!A.errors.priority})}),(0,a.jsx)(I.ZP,{item:!0,xs:12,children:(0,a.jsx)(O.Z,{name:"description",label:s.notes,value:A.values.description,maxAccess:M,rows:3,onChange:e=>A.setFieldValue("description",e.target.value),onClear:()=>A.setFieldValue("description",""),error:A.touched.description&&!!A.errors.description})})]})})})})}function b(){let{getRequest:e,postRequest:r}=(0,n.useContext)(i.$),{platformLabels:t}=(0,n.useContext)(g.l),{stack:I}=(0,o.zY)(),{query:{data:f},labels:h,invalidate:q,paginationParameters:x,refetch:T,access:R}=(0,u.J)({queryFn:P,endpointId:v.m.RepairRequest.page,datasetId:c.i.RepairRequest});async function P(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{_startAt:t=0,_pageSize:a=50}=r;return{...await e({extension:v.m.RepairRequest.page,parameters:"_startAt=".concat(t,"&_pageSize=").concat(a,"&_employeeId=0&_status=0&_filter=")}),_startAt:t}}let N=[{field:"employeeName",headerName:h.employee,flex:1},{field:"equipmentName",headerName:h.equipment,flex:1},{field:"repairName",headerName:h.repair,flex:1},{field:"repairType",headerName:h.repairType,flex:1},{field:"priorityName",headerName:h.priority,flex:1}],S=async e=>{await r({extension:v.m.RepairRequest.del,record:JSON.stringify(e)}),q(),d.ZP.success(t.Deleted)};function E(e){I({Component:D,props:{labels:h,recordId:e,access:R},width:600,height:600,title:h.repairRequest})}return(0,a.jsxs)(p.R,{children:[(0,a.jsx)(m.g,{children:(0,a.jsx)(s.Z,{onAdd:()=>{E()},maxAccess:R})}),(0,a.jsx)(y.Q,{children:(0,a.jsx)(l.Z,{name:"table",columns:N,gridData:f,rowId:["recordId"],maxAccess:R,onEdit:e=>{E(null==e?void 0:e.recordId)},onDelete:S,deleteConfirmationType:"strict",pageSize:50,refetch:T,paginationParameters:x,paginationType:"api"})})]})}},54736:function(e,r,t){"use strict";t.d(r,{m:function(){return n}});let a="RS.asmx/",n={RepairName:{page:a+"pageRNA",qry:a+"qryRNA",get:a+"getRNA",set:a+"setRNA",del:a+"delRNA"},WorkOrderTypes:{page:a+"pageWOT",qry:a+"qryWOT",get:a+"getWOT",set:a+"setWOT",del:a+"delWOT"},RepairType:{page:a+"pageRT",get:a+"getRT",set:a+"setRT",del:a+"delRT"},SpareParts:{snapshot:a+"snapshotSP",page:a+"pageSP",get:a+"getSP",set:a+"setSP",del:a+"delSP"},InspectionTemplate:{get2:a+"get2ITE",page:a+"pageITE",set2:a+"set2ITE",del:a+"delITE"},Department:{page:a+"pageDEP",get:a+"getDEP",set:a+"setDEP",del:a+"delDEP"},Warehouse:{page:a+"pageWH",qry:a+"qryWH",set:a+"setWH",get:a+"getWH",del:a+"delWH"},PreventiveMaintenanceTasks:{qry:a+"qryPMT",page:a+"pagePMT",qry:a+"qryPMT",get:a+"getPMT",set:a+"setPMT",del:a+"delPMT"},Equipment:{qry:a+"qryEQP",page:a+"pageEQP",get:a+"getEQP",set:a+"setEQP",del:a+"delEQP",snapshot:a+"snapshotEQP"},SpManufacturer:{page:a+"pageSPM",get:a+"getSPM",set:a+"setSPM",del:a+"delSPM",qry:a+"qrySPM"},JobPosition:{page:a+"pagePOS",qry:a+"qryPOS",get:a+"getPOS",set:a+"setPOS",del:a+"delPOS"},SpCategory:{page:a+"pageSPC",get:a+"getSPC",set:a+"setSPC",del:a+"delSPC",qry:a+"qrySPC"},MaintenanceTemplates:{page:a+"pageMTE",get:a+"getMTE",set:a+"setMTE",del:a+"delMTE",qry:a+"qryMTE"},MaintenanceTemplateTask:{qry:a+"qryMTT",get:a+"getMTT",set:a+"setMTT",del:a+"delMTT"},RsLabors:{qry:a+"qryLBR",snapshot:a+"snapshotLBR",page:a+"pageLBR",set:a+"setLBR",get:a+"getLBR",del:a+"delLBR",qry:a+"qryLBR"},WorkOrder:{page:a+"qryWO",get:a+"getWO",set:a+"setWO",del:a+"delWO",post:a+"postWO"},WorkTask:{qry:a+"qryWTK",get:a+"getWTK",set:a+"setWTK",del:a+"delWTK"},EquipmentType:{qry:a+"qryEQT",get:a+"getEQT",set:a+"setEQT",del:a+"delEQT"},WorkOrderParts:{qry:a+"qryWOP",set2:a+"set2WOP"},WorkOrderLabors:{qry:a+"qryWOL",set2:a+"set2WOL"},RepairRequest:{page:a+"pageREQ",get:a+"getREQ",set:a+"setREQ",del:a+"delREQ"},Employee:{snapshot:a+"snapshotEMP"},RepairType:{qry:a+"qryRT"}}},1685:function(e,r,t){"use strict";t.d(r,{m:function(){return a}});let a=e=>{let r=window.sessionStorage.getItem(e);return r?JSON.parse(r):null}},98345:function(e,r,t){"use strict";t.d(r,{H:function(){return g},G:function(){return y}});var a=t(45300),n=t(2784),d=t(96026),l=t(38449);t(26612);var s=t(65947),i=t(1685);let o=async(e,r,t)=>{try{let a=await e({extension:r,parameters:t});return r.includes("qry")?a:a.record}catch(e){return null}},u=(e,r,t,a)=>{let n=(e=JSON.parse(JSON.stringify(e))).record.controls,d=n.find(e=>"reference"===e.controlId);return d?d.accessLevel=(null==r?void 0:r.mandatory)?s.$7:s.rr:(null==r?void 0:r.mandatory)?n.push({sgId:0,resourceId:"",controlId:"".concat(a?a+".":"","reference"),accessLevel:(null==r?void 0:r.mandatory)?s.$7:s.rr}):(null==r?void 0:r.readOnly)?n.push({sgId:0,resourceId:"",controlId:"".concat(a?a+".":"","reference"),accessLevel:(null==r?void 0:r.readOnly)?s.rr:s.$7}):n=e.record.controls.filter(e=>"reference"!=e.controlId),t&&n.push({sgId:0,resourceId:"",controlId:"".concat(a?a+".":"","dtId"),accessLevel:s.$7}),{...e,record:{...e.record,controls:n}}},c=async(e,r,t)=>{let a,n;switch(t){case"dtId":let d=(0,i.m)("userData"),s=null==d?void 0:d.userId;n="_userId=".concat(s,"&_functionId=").concat(r),a=l.r.UserFunction.get;break;case"glbSysNumberRange":n="_recordId=".concat(r),a=l.r.SystemFunction.get;break;case"DocumentType":n="_dgId=".concat(r,"&_startAt=",0,"&_pageSize=",50),a=l.r.DocumentType.qry;break;case"DcTypNumberRange":n="_recordId=".concat(r),a=l.r.DocumentType.get;break;case"isExternal":n="_recordId=".concat(r),a=l.r.NumberRange.get;break;default:return null}return await o(e,a,n)},p=async function(e){let r,t,a,n,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,l=arguments.length>2?arguments[2]:void 0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,i=!(arguments.length>4)||void 0===arguments[4]||arguments[4],o=arguments.length>5?arguments[5]:void 0,p=void 0===s&&d&&await c(e,d,"dtId"),m=null==p?void 0:p.dtId,y="",g=!0;if(p&&void 0===s||"nraId"===s){if(m){let t=await c(e,m,"DcTypNumberRange");r=null==t?void 0:t.nraId,g=!((null==t?void 0:t.activeStatus)<0),r||(y="Assign the document type to a number range")}if((!m||!g)&&i&&d){var v;let r=await c(e,d,"DocumentType");n=(null==r?void 0:null===(v=r.list)||void 0===v?void 0:v.filter(e=>(null==e?void 0:e.activeStatus)===1).length)>0}}if(("nraId"===s||void 0===s)&&d){if((!m||m)&&!r||r&&!g){let t=await c(e,d,"glbSysNumberRange");(r=null==t?void 0:t.nraId)&&n&&(n=!1),g=!0}y=r||n?"":"Assign the system Function to a number range"}s>0&&!r&&(r=s),r&&g?(t={readOnly:null==(a=await c(e,r,"isExternal"))||!a.external,mandatory:null!=a&&!!a.external},l&&(l=await u(l,t,n,o))):!r&&l&&(l=await u(l,t,n,o));let I=o?"".concat(o,".reference"):"reference";return{dtId:m,resetReference:null==t?void 0:t.readOnly,dcTypeRequired:n,reference:{fieldName:I,isEmpty:(null==a?void 0:a.external)!==void 0&&(null==a||!a.external)},errorMessage:y,maxAccess:l,selectNraId:s}};var m=t(65950);function y(e){let{functionId:r,action:t,hasDT:a}=e,{getRequest:l}=(0,n.useContext)(m.$),{stack:s}=(0,d.V)();return{proxyAction:async()=>{let e=await p(l,r,"",void 0,a);(null==e?void 0:e.errorMessage)?s({message:null==e?void 0:e.errorMessage}):await t()}}}function g(e){var r;let{functionId:t,access:l,hasDT:s,enabled:i=!0,objectName:o=""}=e,{getRequest:u}=(0,n.useContext)(m.$),{stack:c}=(0,d.V)(),[y,g]=(0,n.useState)(),v=async e=>{let r=await p(u,t,l,e,s,o);if(!r.errorMessage)return r;c({message:null==r?void 0:r.errorMessage})},I=(0,a.a)({retry:!1,staleTime:0,enabled:i,queryKey:[t,y,!!l,i],queryFn:y||"nraId"===y?()=>v(y):()=>v()});return{documentType:I.data,maxAccess:(null==I?void 0:null===(r=I.data)||void 0===r?void 0:r.maxAccess)||l,changeDT(e){g((null==e?void 0:e.nraId)||"nraId")}}}}},function(e){e.O(0,[49774,92888,40179],function(){return e(e.s=57519)}),_N_E=e.O()}]);