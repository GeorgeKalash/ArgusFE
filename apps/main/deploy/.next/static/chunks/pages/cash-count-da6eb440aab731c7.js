(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[10375],{78147:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/cash-count",function(){return n(88978)}])},88978:function(e,t,n){"use strict";n.r(t);var a=n(52322),r=n(2784),o=n(62202),l=n(69387),c=n(27723),s=n(65950),d=n(71987),i=n(61802),u=n(26612),m=n(31389),h=n(33625),f=n(62362),y=n(93741),p=n(57393),v=n(98345),I=n(7121),C=n(19473);t.default=()=>{let{stack:e}=(0,i.zY)(),{getRequest:t,postRequest:n}=(0,r.useContext)(s.$),{platformLabels:x}=(0,r.useContext)(C.l);async function g(e){let{options:n={},filters:a}=e,{_startAt:r=0,_pageSize:o=50}=n;return await t({extension:p.s.CashCountTransaction.snapshot,parameters:"_startAt=".concat(r,"&_pageSize=").concat(o,"&_filter=").concat(a.qry)})}let{query:{data:b},filterBy:N,clearFilter:T,labels:A,refetch:w,access:q,invalidate:S}=(0,d.J)({endpointId:p.s.CashCountTransaction.snapshot,datasetId:u.i.CashCountTransaction,filter:{endpointId:p.s.CashCountTransaction.snapshot,filterFn:g}}),j=[{field:"reference",headerName:A.reference,flex:1},{field:"date",headerName:A.date,flex:1,type:"date"},{field:"plantName",headerName:A.plant,flex:1},{field:"cashAccountName",headerName:A.cashAccount,flex:1},{field:"startTime",headerName:A.startTime,flex:1,type:"timeZone"},{field:"endTime",headerName:A.endTime,flex:1,type:"timeZone"},{field:"statusName",headerName:A.status,flex:1},{field:"rsName",headerName:A.releaseStatus,flex:1},{field:"wipName",headerName:A.wip,flex:1}];function k(t){e({Component:y.Z,props:{recordId:t}})}let{proxyAction:Z}=(0,v.G)({functionId:I.J.CashCountTransaction,action:k,hasDT:!1}),F=async e=>{await n({extension:p.s.CashCountTransaction.del,record:JSON.stringify(e)}),S(),o.ZP.success(x.Deleted)};return(0,a.jsxs)(m.R,{children:[(0,a.jsx)(h.g,{children:(0,a.jsx)(c.Z,{onAdd:()=>{Z()},maxAccess:q,onSearch:e=>{N("qry",e)},onSearchClear:()=>{T("qry")},labels:A,inputSearch:!0})}),(0,a.jsx)(f.Q,{children:(0,a.jsx)(l.Z,{name:"table",columns:j,gridData:b,rowId:["recordId"],onEdit:e=>{k(e.recordId)},onDelete:F,deleteConfirmationType:"strict",isLoading:!1,refetch:w,pageSize:50,paginationType:"client",maxAccess:q})})]})}},57393:function(e,t,n){"use strict";n.d(t,{s:function(){return r}});let a="CC.asmx/",r={CashCountTransaction:{snapshot:a+"snapshotTRX",qry:a+"qryTRX",get2:a+"get2TRX",set2:a+"set2TRX",post:a+"postTRX",close:a+"closeTRX",reopen:a+"reopenTRX",del:a+"delTRX"},Generate:{generate:a+"generateTFR"},CcCashNotes:{qry:a+"qryNOT",get:a+"getNOT",set:a+"setNOT",del:a+"delNOT",page:a+"pageNOT"}}},1685:function(e,t,n){"use strict";n.d(t,{m:function(){return a}});let a=e=>{let t=window.sessionStorage.getItem(e);return t?JSON.parse(t):null}},98345:function(e,t,n){"use strict";n.d(t,{H:function(){return y},G:function(){return f}});var a=n(45300),r=n(2784),o=n(96026),l=n(38449);n(26612);var c=n(65947),s=n(1685);let d=async(e,t,n)=>{try{let a=await e({extension:t,parameters:n});return t.includes("qry")?a:a.record}catch(e){return null}},i=(e,t,n,a)=>{let r=(e=JSON.parse(JSON.stringify(e))).record.controls,o=r.find(e=>"reference"===e.controlId);return o?o.accessLevel=(null==t?void 0:t.mandatory)?c.$7:c.rr:(null==t?void 0:t.mandatory)?r.push({sgId:0,resourceId:"",controlId:"".concat(a?a+".":"","reference"),accessLevel:(null==t?void 0:t.mandatory)?c.$7:c.rr}):(null==t?void 0:t.readOnly)?r.push({sgId:0,resourceId:"",controlId:"".concat(a?a+".":"","reference"),accessLevel:(null==t?void 0:t.readOnly)?c.rr:c.$7}):r=e.record.controls.filter(e=>"reference"!=e.controlId),n&&r.push({sgId:0,resourceId:"",controlId:"".concat(a?a+".":"","dtId"),accessLevel:c.$7}),{...e,record:{...e.record,controls:r}}},u=async(e,t,n)=>{let a,r;switch(n){case"dtId":let o=(0,s.m)("userData"),c=null==o?void 0:o.userId;r="_userId=".concat(c,"&_functionId=").concat(t),a=l.r.UserFunction.get;break;case"glbSysNumberRange":r="_recordId=".concat(t),a=l.r.SystemFunction.get;break;case"DocumentType":r="_dgId=".concat(t,"&_startAt=",0,"&_pageSize=",50),a=l.r.DocumentType.qry;break;case"DcTypNumberRange":r="_recordId=".concat(t),a=l.r.DocumentType.get;break;case"isExternal":r="_recordId=".concat(t),a=l.r.NumberRange.get;break;default:return null}return await d(e,a,r)},m=async function(e){let t,n,a,r,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,l=arguments.length>2?arguments[2]:void 0,c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,s=!(arguments.length>4)||void 0===arguments[4]||arguments[4],d=arguments.length>5?arguments[5]:void 0,m=void 0===c&&o&&await u(e,o,"dtId"),h=null==m?void 0:m.dtId,f="",y=!0;if(m&&void 0===c||"nraId"===c){if(h){let n=await u(e,h,"DcTypNumberRange");t=null==n?void 0:n.nraId,y=!((null==n?void 0:n.activeStatus)<0),t||(f="Assign the document type to a number range")}if((!h||!y)&&s&&o){var p;let t=await u(e,o,"DocumentType");r=(null==t?void 0:null===(p=t.list)||void 0===p?void 0:p.filter(e=>(null==e?void 0:e.activeStatus)===1).length)>0}}if(("nraId"===c||void 0===c)&&o){if((!h||h)&&!t||t&&!y){let n=await u(e,o,"glbSysNumberRange");(t=null==n?void 0:n.nraId)&&r&&(r=!1),y=!0}f=t||r?"":"Assign the system Function to a number range"}c>0&&!t&&(t=c),t&&y?(n={readOnly:null==(a=await u(e,t,"isExternal"))||!a.external,mandatory:null!=a&&!!a.external},l&&(l=await i(l,n,r,d))):!t&&l&&(l=await i(l,n,r,d));let v=d?"".concat(d,".reference"):"reference";return{dtId:h,resetReference:null==n?void 0:n.readOnly,dcTypeRequired:r,reference:{fieldName:v,isEmpty:(null==a?void 0:a.external)!==void 0&&(null==a||!a.external)},errorMessage:f,maxAccess:l,selectNraId:c}};var h=n(65950);function f(e){let{functionId:t,action:n,hasDT:a}=e,{getRequest:l}=(0,r.useContext)(h.$),{stack:c}=(0,o.V)();return{proxyAction:async()=>{let e=await m(l,t,"",void 0,a);(null==e?void 0:e.errorMessage)?c({message:null==e?void 0:e.errorMessage}):await n()}}}function y(e){var t;let{functionId:n,access:l,hasDT:c,enabled:s=!0,objectName:d=""}=e,{getRequest:i}=(0,r.useContext)(h.$),{stack:u}=(0,o.V)(),[f,y]=(0,r.useState)(),p=async e=>{let t=await m(i,n,l,e,c,d);if(!t.errorMessage)return t;u({message:null==t?void 0:t.errorMessage})},v=(0,a.a)({retry:!1,staleTime:0,enabled:s,queryKey:[n,f,!!l,s],queryFn:f||"nraId"===f?()=>p(f):()=>p()});return{documentType:v.data,maxAccess:(null==v?void 0:null===(t=v.data)||void 0===t?void 0:t.maxAccess)||l,changeDT(e){y((null==e?void 0:e.nraId)||"nraId")}}}},93741:function(e,t,n){"use strict";n.d(t,{Z:function(){return E}});var a=n(52322),r=n(60218),o=n(2784),l=n(48601),c=n(82737),s=n(62202),d=n(65950),i=n(26612),u=n(5088),m=n(31389),h=n(80983),f=n(27423),y=n(2119),p=n(8661),v=n(38449),I=n(89330),C=n(76399),x=n(33625),g=n(62362),b=n(91406),N=n(57393),T=n(54074);function A(e){var t,n;let{labels:c,maxAccess:s,recordId:i,forceNoteCount:f,row:y,updateRow:p,readOnly:v,window:I}=e,{getRequest:A}=(0,o.useContext)(d.$),{formik:w}=(0,h.c)({maxAccess:s,initialValues:{total:0,currencyNotes:[{id:1,seqNo:"",cashCountId:0,note:"",qty:"",subTotal:""}]},validateOnChange:!0,validationSchema:l.Ry({currencyNotes:l.IX().of(l.Ry().shape({note:l.Z_().required()})).required("Operations array is required")}),onSubmit:async e=>{var t;let n=null===(t=e.currencyNotes.filter(e=>e.qty>0))||void 0===t?void 0:t.map(e=>{let{id:t,seqNo:n,cashCountId:a,qty:r,qty1:o,qty100:l,qty1000:c,...s}=e;return{seqNo:y.id,qty:r,qty1:o||0,qty100:l||0,qty1000:c||0,cashCountId:(null==y?void 0:y.cashCountId)<1?0:null==y?void 0:y.cashCountId,...s}}),a=e.currencyNotes.reduce((e,t)=>{let{subTotal:n}=t;return e+(Number(n)||0)},0);f?p({changes:{counted:a,currencyNotes:n,variation:a-(y.system||0),flag:y.system===a}}):p({changes:{currencyNotes:n}}),I.close()}});(0,o.useEffect)(()=>{(null==y?void 0:y.id)&&q()},[i]);let q=async()=>{var e;let t="_currencyId="+y.currencyId,{list:n}=await A({extension:N.s.CcCashNotes.qry,parameters:t}),a=null===(e=y.currencyNotes)||void 0===e?void 0:e.map((e,t)=>{let{id:n,qty:a,note:r,...o}=e;return{id:t+1,qty:a,note:r,subTotal:a*r,...o}}),r=(null==n?void 0:n.map((e,t)=>{let{...n}=e;return{id:t+1,...n}})).map(e=>{let t={id:e.id,note:e.note,seqNo:null,qty:"",subTotal:0},n=null==a?void 0:a.find(e=>t.note===e.note);return n&&(t.qty=n.qty,t.qty1=n.qty1||"",t.qty100=n.qty100||"",t.qty1000=n.qty1000||"",t.seqNo=n.seqNo,t.subTotal=n.subTotal),t});w.setFieldValue("currencyNotes",r)},S=null===(n=w.values)||void 0===n?void 0:null===(t=n.currencyNotes)||void 0===t?void 0:t.reduce((e,t)=>{let{subTotal:n}=t;return e+(Number(n)||0)},0);function j(e){let{update:t,newRow:n}=e,a=(null==n?void 0:n.note)||0,r=((null==n?void 0:n.qty1)||0)+100*((null==n?void 0:n.qty100)||0)+1e3*((null==n?void 0:n.qty1000)||0);t({qty:r,subTotal:r*a})}return(0,a.jsx)(T.Z,{onSave:w.handleSubmit,maxAccess:s,children:(0,a.jsxs)(m.R,{children:[(0,a.jsx)(x.g,{children:(0,a.jsx)(r.ZP,{container:!0,xs:6,children:(0,a.jsx)(u.Z,{name:"reference",label:c.currency,value:y.currencyRef,readOnly:!0})})}),(0,a.jsx)(g.Q,{children:(0,a.jsx)(C._,{onChange:e=>w.setFieldValue("currencyNotes",e),value:w.values.currencyNotes,error:w.errors.currencyNotes,columns:[{component:"numberfield",label:c.currencyNote,name:"note",props:{readOnly:!0}},{component:"numberfield",label:c.qty1,name:"qty1",props:{readOnly:v,decimalScale:0,maxLength:2,allowNegative:!1},async onChange(e){let{row:t}=e;j(t)}},{component:"numberfield",label:c.qty100,name:"qty100",props:{readOnly:v,decimalScale:0,maxLength:3,allowNegative:!1},async onChange(e){let{row:t}=e;j(t)}},{component:"numberfield",label:c.qty1000,name:"qty1000",props:{readOnly:v,decimalScale:0,allowNegative:!1},async onChange(e){let{row:t}=e;j(t)}},{component:"numberfield",label:c.qty,name:"qty",props:{readOnly:!0},async onChange(e){let{row:{update:t,newRow:n}}=e,a=(null==n?void 0:n.note)||0;t({subTotal:((null==n?void 0:n.qty)||0)*a})}},{component:"numberfield",label:c.subTotal,name:"subTotal",props:{readOnly:!0}}],allowDelete:!1,allowAddNewLine:!1})}),(0,a.jsx)(x.g,{children:(0,a.jsx)(r.ZP,{container:!0,spacing:2,sx:{mb:3,display:"flex",justifyContent:"right"},children:(0,a.jsx)(r.ZP,{item:!0,xs:4,children:(0,a.jsx)(b.Z,{name:"total",label:c.total,value:S,readOnly:!0})})})})]})})}var w=n(61802),q=n(39812),S=n(7121),j=n(1685),k=n(71987),Z=n(39704),F=n(19473);function _(e){let{cashCountId:t,fromPlantId:n,labels:c,maxAccess:i}=e,{postRequest:u}=(0,o.useContext)(d.$),{platformLabels:I}=(0,o.useContext)(F.l),{formik:C}=(0,h.c)({maxAccess:i,initialValues:{cashCountId:t,fromPlantId:n,toPlantId:"",toAccountId:""},validateOnChange:!0,validationSchema:l.Ry({toPlantId:l.Z_().required(" "),toAccountId:l.Z_().required(" ")}),onSubmit:async e=>{console.log(e);let a={cashCountId:t,fromPlantId:n,toPlantId:e.toPlantId,toAccountId:e.toAccountId};try{await u({extension:N.s.Generate.generate,record:JSON.stringify(a)}),s.ZP.success(I.Generated)}catch(e){}}});return(0,a.jsx)(T.Z,{onSave:C.handleSubmit,maxAccess:i,children:(0,a.jsx)(m.R,{children:(0,a.jsx)(x.g,{children:(0,a.jsxs)(r.ZP,{container:!0,spacing:2,children:[(0,a.jsx)(r.ZP,{item:!0,xs:12,children:(0,a.jsx)(p.Z,{endpointId:v.r.Plant.qry,name:"toPlantId",label:c.toPlant,values:C.values,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],required:!0,maxAccess:i,onChange:(e,t)=>{C&&C.setFieldValue("toPlantId",null==t?void 0:t.recordId),C.setFieldValue("toAccountId",null),C.setFieldValue("fromCARef",null),C.setFieldValue("fromCAName",null)},error:C.touched.toPlantId&&!!C.errors.toPlantId})}),(0,a.jsx)(r.ZP,{item:!0,xs:12,children:(0,a.jsx)(f.U,{endpointId:y.G.CashAccount.snapshot,parameters:{_type:0},filter:{plantId:C.values.toPlantId},firstFieldWidth:5,valueField:"accountNo",displayField:"name",name:"toAccountId",displayFieldWidth:2,required:!0,label:c.toCashAccount,form:C,valueShow:"fromCARef",secondValueShow:"fromCAName",onChange:(e,t)=>{C.setFieldValue("toAccountId",t?t.recordId:null),C.setFieldValue("fromCARef",t?t.accountNo:null),C.setFieldValue("fromCAName",t?t.name:null)},error:C.touched.toAccountId&&!!C.errors.toAccountId,maxAccess:i})})]})})})})}var O=n(98345),R=n(19689),P=n(50023),V=n(21326);let D=e=>{var t,n,b,T,D;let{recordId:E,window:L}=e,{postRequest:J,getRequest:X}=(0,o.useContext)(d.$),{platformLabels:$}=(0,o.useContext)(F.l),[G,W]=(0,o.useState)(!!E),{stack:z}=(0,w.zY)(),[M,U]=(0,o.useState)(!1),[B,H]=(0,o.useState)(!1),Q=async()=>{let e=(0,j.m)("userData").userId,t="_userId=".concat(e,"&_functionId=").concat(S.J.CashCountTransaction),{record:n}=await X({extension:v.r.UserFunction.get,parameters:t});n&&en.setFieldValue("dtId",n.dtId);let{record:a}=await X({extension:v.r.UserDefaults.get,parameters:"_userId=".concat(e,"&_key=cashAccountId")}),r=null==a?void 0:a.value;if(r){let{record:e}=await X({extension:y.G.CbBankAccounts.get,parameters:"_recordId=".concat(r)});en.setFieldValue("cashAccountId",r),en.setFieldValue("cashAccountRef",e.reference),en.setFieldValue("cashAccountName",e.name)}let{record:o}=await X({extension:v.r.UserDefaults.get,parameters:"_userId=".concat(e,"&_key=plantId")});o&&en.setFieldValue("plantId",parseInt(o.value))},Y=(0,k.E)({endpointId:N.s.CashCountTransaction.qry}),{labels:K,access:ee}=(0,P.Z)({datasetId:i.i.CashCountTransaction,editMode:!!E});(0,V.Z)({title:K.cashCount,window:L});let{maxAccess:et}=(0,O.H)({functionId:S.J.CashCountTransaction,access:ee,hasDT:!1,enabled:!G}),{formik:en}=(0,h.c)({maxAccess:et,initialValues:{recordId:null,plantId:null,reference:"",cashAccountId:"",cashAccountRef:"",cashAccountName:"",forceNoteCount:!1,wip:1,status:1,releaseStatus:"",date:new Date,startTime:"",endTime:"",items:[{id:1,cashCountId:"",seqNo:1,currencyId:"",currencyName:"",currencyRef:"",counted:"",system:"",variation:"",flag:"",currencyNotes:[]}]},validateOnChange:!0,validationSchema:l.Ry({cashAccountRef:l.Z_().required(),plantId:l.Z_().required(),items:l.IX().of(l.Ry().shape({currencyId:l.Z_().required(),counted:l.Z_().required()})).required()}),onSubmit:async e=>{let t={header:{recordId:e.recordId,dtId:e.dtId,plantId:e.plantId,shiftId:e.shiftId,currencyId:e.currencyId,cashAccountId:e.cashAccountId,forceNoteCount:e.forceNoteCount,reference:e.reference,date:(0,q.ku)(new Date),startTime:e.startTime,endTime:e.endTime,status:e.status,wip:e.wip,releaseStatus:e.releaseStatus},items:e.items.map((e,t)=>{let{id:n,flag:a,enabled:r,cashCountId:o,currencyNotes:l,...c}=e;return{seqNo:t+1,cashCountId:o||0,currencyNotes:l||[],...c}})},n=(await J({extension:N.s.CashCountTransaction.set2,record:JSON.stringify(t)})).recordId;e.recordId?s.ZP.success($.Edited):(s.ZP.success($.Added),ea(n)),W(!0),Y()}});(0,o.useEffect)(()=>{G||Q(),el()},[]),(0,o.useEffect)(()=>{ea(E)},[E]);let ea=async e=>{if(e){let{record:{header:t,items:n}}=await X({extension:N.s.CashCountTransaction.get2,parameters:"_recordId=".concat(e)});U(2===t.wip),H(3===t.status),en.setValues({recordId:t.recordId,plantId:t.plantId,reference:t.reference,cashAccountId:t.cashAccountId,cashAccountRef:t.cashAccountRef,cashAccountName:t.cashAccountName,forceNoteCount:t.forceNoteCount,wip:t.wip,status:t.status,releaseStatus:t.releaseStatus,date:(0,q.a1)(t.date),startTime:t.startTime&&(0,q.s4)(t.startTime),endTime:t.endTime&&(0,q.s4)(t.endTime),items:n.map((e,t)=>{let{seqNo:n,variation:a,...r}=e;return{id:n,seqNo:n,variation:a,flag:0===a,...r}})})}};async function er(){let e=en.values,t={recordId:e.recordId,dtId:e.dtId,plantId:e.plantId,shiftId:e.shiftId,currencyId:e.currencyId,cashAccountId:e.cashAccountId,reference:e.reference,date:e.date,startTime:e.startTime,status:e.status,wip:e.wip,releaseStatus:e.releaseStatus},n=await J({extension:N.s.CashCountTransaction.reopen,record:JSON.stringify(t)}).then(()=>{n.recordId&&(s.ZP.success($.Reopened),Y(),ea(null==e?void 0:e.recordId))})}let eo=[{key:"Bulk",condition:!0,onClick:function(){z({Component:_,props:{labels:K,cashCountId:en.values.recordId,fromPlantId:en.values.plantId,maxAccess:et},width:600,height:300,title:K.bulk})},disabled:!B},{key:"WorkFlow",condition:!0,onClick:async()=>{z({Component:Z.Z,props:{functionId:S.J.CashCountTransaction,recordId:en.values.recordId}})},disabled:!G},{key:"Locked",condition:!0,onClick:()=>{J({extension:N.s.CashCountTransaction.post,record:JSON.stringify(en.values)}).then(e=>{(null==e?void 0:e.recordId)&&(s.ZP.success($.Posted),Y(),H(!0))})},disabled:!G||4!==en.values.status||B},{key:"Close",condition:!M,onClick:()=>{J({extension:N.s.CashCountTransaction.close,record:JSON.stringify(en.values)}).then(e=>{(null==e?void 0:e.recordId)&&(s.ZP.success($.Closed),Y(),ea(null==e?void 0:e.recordId))})},disabled:M||!G},{key:"Approval",condition:!0,onClick:"onApproval",disabled:!M},{key:"Reopen",condition:M,onClick:er,disabled:!M||!G||3===en.values.releaseStatus},{key:"Account Balance",condition:!0,onClick:"onClickAC",disabled:!1}],el=async()=>{var e;let{record:t}=await X({extension:null===(e=v.r.TimeZone)||void 0===e?void 0:e.get,parameters:""});t&&(G||en.setFieldValue("startTime",(0,q.s4)(null==t?void 0:t.utcDate,"utc")))},ec=async e=>{var t,n;let a=null===(t=en.values)||void 0===t?void 0:t.cashAccountId;if(e&&a){let{record:t}=await X({extension:y.G.AccountBalance.get,parameters:"_currencyId="+e+"&_cashAccountId="+(null===(n=en.values)||void 0===n?void 0:n.cashAccountId)});if(t)return t.balance}};return(0,a.jsx)(c.Z,{actions:eo,resourceId:i.i.CashCountTransaction,form:en,maxAccess:et,editMode:G,functionId:S.J.CashCountTransaction,disabledSubmit:M,previewReport:G,children:(0,a.jsxs)(m.R,{children:[(0,a.jsx)(x.g,{children:(0,a.jsxs)(r.ZP,{container:!0,spacing:2,children:[(0,a.jsx)(r.ZP,{item:!0,xs:6,children:(0,a.jsx)(f.U,{endpointId:y.G.CashAccount.snapshot,parameters:{_type:2},name:"cashAccountRef",required:!0,label:K.cashAccount,readOnly:B||M,valueField:"reference",displayField:"name",valueShow:"cashAccountRef",secondValueShow:"cashAccountName",form:en,onChange:(e,t)=>{en.setValues({...en.values,cashAccountId:(null==t?void 0:t.recordId)||"",cashAccountRef:(null==t?void 0:t.reference)||"",cashAccountName:(null==t?void 0:t.name)||""})},maxAccess:et})}),(0,a.jsx)(r.ZP,{item:!0,xs:6,children:(0,a.jsx)(I.Z,{name:"date",label:K.date,value:en.values.date,onChange:en.setFieldValue,readOnly:!0,maxAccess:et})}),(0,a.jsx)(r.ZP,{item:!0,xs:6,children:(0,a.jsx)(p.Z,{endpointId:v.r.Plant.qry,name:"plantId",label:K.plant,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"plant Ref"},{key:"name",value:"Name"}],values:en.values,required:!0,readOnly:B||M,maxAccess:et,onChange:(e,t)=>{let n=(null==t?void 0:t.recordId)||"";en.setFieldValue("plantId",n)},error:en.touched.plantId&&!!en.errors.plantId})}),(0,a.jsx)(r.ZP,{item:!0,xs:6,children:(0,a.jsx)(u.Z,{name:"startTime",label:K.startTime,value:en.values.startTime,readOnly:!0,maxAccess:et})}),(0,a.jsx)(r.ZP,{item:!0,xs:6,children:(0,a.jsx)(u.Z,{name:"reference",label:K.reference,value:en.values.reference,readOnly:G,maxAccess:et,onChange:e=>{en.handleChange(e)},onClear:()=>en.setFieldValue("reference",""),error:en.touched.reference&&!!en.errors.reference})}),(0,a.jsx)(r.ZP,{item:!0,xs:6,children:(0,a.jsx)(u.Z,{name:"endTime",label:K.endTime,value:en.values.endTime,readOnly:!0,maxAccess:et})}),(0,a.jsx)(r.ZP,{item:!0,xs:12,children:(0,a.jsx)(R.Z,{name:"forceNoteCount",value:null===(t=en.values)||void 0===t?void 0:t.forceNoteCount,onChange:e=>en.setFieldValue("forceNoteCount",e.target.checked),label:K.forceNotesCount,maxAccess:et,disabled:en.values.items&&((null===(b=en.values)||void 0===b?void 0:null===(n=b.items[0])||void 0===n?void 0:n.currencyId)||(null===(D=en.values)||void 0===D?void 0:null===(T=D.items[0])||void 0===T?void 0:T.currencyId))})})]})}),(0,a.jsx)(g.Q,{children:(0,a.jsx)(C._,{onChange:e=>en.setFieldValue("items",e),value:en.values.items,error:en.errors.items,name:"currency",maxAccess:et,columns:[{component:"resourcecombobox",label:K.currency,name:"currencyId",props:{readOnly:B||M,endpointId:v.r.Currency.qry,valueField:"recordId",displayField:"reference",mapping:[{from:"recordId",to:"currencyId"},{from:"reference",to:"currencyRef"},{from:"name",to:"currencyName"}],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],displayFieldWidth:2},propsReducer(e){var t;let{row:n,props:a}=e;return{...a,readOnly:(null===(t=n.currencyNotes)||void 0===t?void 0:t.length)>0}},async onChange(e){let{row:{update:t,newRow:n}}=e;(null==n?void 0:n.currencyId)&&t({system:await ec(null==n?void 0:n.currencyId)})}},{component:"numberfield",name:"counted",label:K.count,props:{readOnly:en.values.forceNoteCount||B||M},async onChange(e){let{row:{update:t,newRow:n}}=e,a=n.counted||0,r=n.system||0;t({variation:a-r,flag:r===a})}},{component:"numberfield",label:K.system,name:"system",props:{readOnly:!0}},{component:"icon",label:K.flag,name:"flag"},{component:"button",name:"enabled",label:K.currencyNotes,props:{onCondition:e=>({disabled:!(null==e?void 0:e.currencyId)})},onClick:(e,t,n,a)=>{z({Component:A,props:{readOnly:B||M,labels:K,maxAccess:et,forceNoteCount:en.values.forceNoteCount,row:t,updateRow:a},width:700,title:null==K?void 0:K.currencyNotes})}}],allowDelete:!M||!B&&!M})})]})})};D.width=1100,D.height=700;var E=D},39704:function(e,t,n){"use strict";var a=n(52322),r=n(2784),o=n(22341),l=n(65950),c=n(85325),s=n(21326),d=n(19473),i=n(35656),u=n(24868),m=n.n(u);let h=e=>{let{functionId:t,recordId:n,window:u}=e,{getRequest:h}=(0,r.useContext)(l.$),{languageId:f}=(0,r.useContext)(c.V),{platformLabels:y}=(0,r.useContext)(d.l),p=n+"-"+t;(0,s.Z)({title:y.WorkFlow,window:u});let{width:v}=(0,i.d)(),I=v<=1024,C=v>1024&&v<=1280,x=I?10:C?12:14,g=I?75:C?85:95,b=I?15:C?20:25,N=async()=>{var e="_functionId=".concat(t,"&_recordId=").concat(n);let a=await h({extension:o.P.WorkFlow.graph,parameters:e});return null==a?void 0:a.record},T=e=>{let t=[],n=[],a="",r="";return e.objects.forEach(e=>{t.push({functionName:e.functionName,reference:e.reference,date:e.date})}),e.workflow.forEach(t=>{e.objects.forEach(e=>{let n=e.functionName.split(" ").join("\r\n");t.parentId===e.recordId&&t.parentFunctionId===e.functionId&&(a=e.reference+"\r\n"+e.date+"\r\n"+n,t.parentId),t.childId===e.recordId&&t.childFunctionId===e.functionId&&(r=e.reference+"\r\n"+e.date+"\r\n"+n,t.childId)}),""===a||""===r||n.push({from:a,to:r,value:1,labelText:""}),a="",r=""}),n};return(0,r.useEffect)(()=>{!async function(){var e=await N();if(e){let t=(e,t)=>{let n=document.createElement("script");n.type="text/javascript",n.src=e,n.async=!0,n.onload=t,document.head.appendChild(n)};t("https://cdn.amcharts.com/lib/4/core.js",()=>{t("https://cdn.amcharts.com/lib/4/charts.js",()=>{t("https://cdn.amcharts.com/lib/4/themes/animated.js",()=>{am4core.ready(()=>{let t=am4core.create(p,am4charts.SankeyDiagram),n=T(e);t.data=n,t.dataFields.fromName="from",t.dataFields.toName="to",t.dataFields.value="value",t.paddingRight=2===f?0:40,t.paddingLeft=2===f?40:0,t.tooltip.label.fontSize=x;let a=t.nodes.template;a.draggable=!1,a.inert=!0,a.clickable=!1,a.width=g,a.height=b,a.nameLabel.label.fontSize=x,a.nameLabel.locationX=2===f?.85:0,a.nameLabel.height=void 0,a.nameLabel.label.fontWeight="bold";let r=t.links.template;r.middleLine.strokeOpacity=.3,r.middleLine.stroke=am4core.color("#555"),r.middleLine.strokeWidth=5,r.middleLine.hoverable=!1,r.fillOpacity=0,r.hoverable=!0,r.hoverOnFocus=!0,r.fill=am4core.color("#A8C686"),r.isHover=!0,t.appear(1e3,100)})})})})}}()},[]),(0,a.jsx)("div",{id:p,className:m().root})};h.width=950,t.Z=h},24868:function(e){e.exports={root:"WorkFlow_root__EINm1"}}},function(e){e.O(0,[49774,92888,40179],function(){return e(e.s=78147)}),_N_E=e.O()}]);