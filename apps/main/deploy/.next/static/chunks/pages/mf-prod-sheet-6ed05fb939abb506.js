(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6636],{63456:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/mf-prod-sheet",function(){return n(25449)}])},25449:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return O}});var r=n(52322),d=n(2784),a=n(62202),o=n(69387),l=n(65950),i=n(71987),s=n(26612),c=n(31389),u=n(33625),m=n(1685),v=n(62362),f=n(61802),y=n(19473),p=n(60218),I=n(48601),h=n(82737),x=n(5088),g=n(80983),w=n(8661),S=n(38449),N=n(7121),b=n(65215),P=n(98345),k=n(89330),_=n(90587),q=n(76399),C=n(39812),j=n(21581);function A(e){let{recordId:t,maxAccess:n,labels:a}=e,{getRequest:u}=(0,d.useContext)(l.$),{query:{data:m}}=(0,i.J)({queryFn:y,datasetId:s.i.ProductionSheet,endpointId:_.u.ProductionSheetQueue.qry}),f=[{field:"reference",headerName:a.reference,flex:1},{field:"sku",headerName:a.sku,flex:1},{field:"itemName",headerName:a.itemName,flex:1},{field:"functionName",headerName:a.function,flex:1},{field:"qty",headerName:a.qty,flex:1,type:"number"}];async function y(){return await u({extension:_.u.ProductionSheetQueue.qry,parameters:"_psId=".concat(parseInt(t))})}return(0,r.jsx)(c.R,{children:(0,r.jsx)(v.Q,{children:(0,r.jsx)(o.Z,{columns:f,gridData:m,rowId:["itemId"],pagination:!1,maxAccess:n})})})}function F(e){var t,n,o;let{labels:m,maxAccess:F,recordId:Z,plantId:O}=e,{getRequest:D,postRequest:Q}=(0,d.useContext)(l.$),{platformLabels:T,defaultsData:V}=(0,d.useContext)(y.l),{stack:R}=(0,f.zY)(),J=(0,i.E)({endpointId:_.u.ProductionSheet.qry}),{documentType:E,maxAccess:$,changeDT:L}=(0,P.H)({functionId:N.J.ProductionSheet,access:F,enabled:!Z});(0,d.useEffect)(()=>{z()},[]);let z=()=>{var e;let t=null==V?void 0:null===(e=V.list)||void 0===e?void 0:e.find(e=>"de_siteId"===e.key);M.setFieldValue("siteId",parseInt(null==t?void 0:t.value))},{formik:M}=(0,g.c)({documentType:{key:"dtId",value:null==E?void 0:E.dtId},initialValues:{recordId:null,functionId:N.J.ProductionSheet,reference:"",dtId:null,notes:"",status:1,date:new Date,plantId:parseInt(O),notes:"",items:[{id:1,psId:Z||0,seqNo:1,sku:"",itemName:null,itemId:null,qty:null,orderedQty:0,notes:""}]},maxAccess:$,validateOnChange:!0,validationSchema:I.Ry({date:I.hT().required(),siteId:I.Rx().required(),items:I.IX().of(I.Ry().shape({sku:I.Z_().required(),qty:I.Z_().required()})).required()}),onSubmit:async e=>{var t;let n={...e};delete n.items,n.date=n.date?(0,C.ku)(n.date):null;let r=null==M?void 0:null===(t=M.values)||void 0===t?void 0:t.items.map((e,t)=>({...e,seqNo:t+1,psId:M.values.recordId||0,orderedQty:e.orderedQty||0})),d=await Q({extension:_.u.ProductionSheet.set2,record:JSON.stringify({header:n,items:r})});if(e.recordId)a.ZP.success(T.Edited);else{a.ZP.success(T.Added),M.setFieldValue("recordId",d.recordId);let e=await D({extension:_.u.ProductionSheet.get,parameters:"_recordId=".concat(d.recordId)});M.setFieldValue("reference",e.record.reference)}J()}}),U=async()=>{var e,t;let n={...M.values};delete n.items;let r=await Q({extension:_.u.ProductionSheet.post,record:JSON.stringify(n)});a.ZP.success(T.Posted),J();let d=await B(null==r?void 0:r.recordId),o=await G();M.setValues({...d.record,items:o.list.map(e=>{var t;return{...e,id:e.seqNo,orderedQty:null!==(t=e.orderedQty)&&void 0!==t?t:0}}),date:(null==d?void 0:null===(e=d.record)||void 0===e?void 0:e.date)?(0,C.a1)(null==d?void 0:null===(t=d.record)||void 0===t?void 0:t.date):null})},X=!!M.values.recordId,H=3===M.values.status,K=[{key:"Locked",condition:H,onClick:"onUnpostConfirmation",onSuccess:async()=>{var e,t;let n={...M.values};delete n.items;let r=await Q({extension:_.u.ProductionSheet.unpost,record:JSON.stringify(n)});a.ZP.success(T.Unposted),J();let d=await B(null==r?void 0:r.recordId),o=await G();M.setValues({...d.record,items:o.list.map(e=>{var t;return{...e,id:e.seqNo,orderedQty:null!==(t=e.orderedQty)&&void 0!==t?t:0}}),date:(null==d?void 0:null===(e=d.record)||void 0===e?void 0:e.date)?(0,C.a1)(null==d?void 0:null===(t=d.record)||void 0===t?void 0:t.date):null})},disabled:!X},{key:"Unlocked",condition:!H,onClick:U,disabled:!X},{key:"IV",condition:!0,onClick:"onInventoryTransaction",disabled:!X||!H},{key:"Production",condition:!0,onClick:function(){R({Component:A,props:{recordId:M.values.recordId,maxAccess:$,labels:m},width:850,height:580,title:m.productionSheetQueue})},disabled:!H}],Y=[{component:"resourcelookup",label:m.sku,name:"sku",props:{endpointId:b.$.Item.snapshot,valueField:"sku",displayField:"sku",mandatory:!0,displayFieldWidth:4,mapping:[{from:"recordId",to:"itemId"},{from:"sku",to:"sku"},{from:"name",to:"itemName"}],columnsInDropDown:[{key:"sku",value:"SKU",grid:3},{key:"name",value:"Name",grid:7}]}},{component:"textfield",label:m.itemName,name:"itemName",flex:3,props:{readOnly:!0}},{component:"numberfield",label:m.qty,name:"qty"},{component:"numberfield",label:m.orderedQty,name:"orderedQty",props:{readOnly:!0}},{component:"textfield",label:m.notes,name:"notes"}];async function B(e){return await D({extension:_.u.ProductionSheet.get,parameters:"_recordId=".concat(e)})}async function G(){var e;return await D({extension:_.u.ProductionSheetItem.qry,parameters:"_psId=".concat(null!=Z?Z:null==M?void 0:null===(e=M.values)||void 0===e?void 0:e.recordId,"&_functionId=").concat(N.J.ProductionSheet)})}return(0,d.useEffect)(()=>{!async function(){if(Z){var e,t;let n=await B(Z),r=await G();M.setValues({...n.record,items:r.list.map(e=>{var t;return{...e,id:e.seqNo,orderedQty:null!==(t=e.orderedQty)&&void 0!==t?t:0}}),date:(null==n?void 0:null===(e=n.record)||void 0===e?void 0:e.date)?(0,C.a1)(null==n?void 0:null===(t=n.record)||void 0===t?void 0:t.date):null})}}()},[]),(0,r.jsx)(h.Z,{actions:K,resourceId:s.i.ProductionSheet,form:M,maxAccess:$,editMode:X,disabledSubmit:H,functionId:N.J.ProductionSheet,children:(0,r.jsx)(c.R,{children:(0,r.jsxs)(v.Q,{children:[(0,r.jsxs)(p.ZP,{container:!0,spacing:2,children:[(0,r.jsx)(p.ZP,{item:!0,xs:6,children:(0,r.jsx)(w.Z,{endpointId:S.r.DocumentType.qry,parameters:"_dgId=".concat(N.J.ProductionSheet,"&_startAt=",0,"&_pageSize=",1e3),filter:X?void 0:e=>1===e.activeStatus,name:"dtId",label:m.documentType,readOnly:X,valueField:"recordId",displayField:"name",values:M.values,onChange:async(e,t)=>{M.setFieldValue("dtId",(null==t?void 0:t.recordId)||""),L(t)},error:M.touched.dtId&&!!M.errors.dtId,maxAccess:$})}),(0,r.jsx)(p.ZP,{item:!0,xs:6,children:(0,r.jsx)(x.Z,{name:"reference",label:m.reference,value:M.values.reference,readOnly:X||H,maxAccess:!X&&$,onChange:M.handleChange,onClear:()=>M.setFieldValue("reference",""),error:M.touched.reference&&!!M.errors.reference})}),(0,r.jsx)(p.ZP,{item:!0,xs:6,children:(0,r.jsx)(k.Z,{name:"date",label:m.date,value:null==M?void 0:null===(t=M.values)||void 0===t?void 0:t.date,required:!0,readOnly:X||H,onChange:M.setFieldValue,onClear:()=>M.setFieldValue("date",""),error:M.touched.date&&!!M.errors.date,maxAccess:$})}),(0,r.jsx)(p.ZP,{item:!0,xs:6,children:(0,r.jsx)(w.Z,{endpointId:b.$.Site.qry,name:"siteId",required:!0,readOnly:!0,refresh:X||H,label:m.site,values:M.values,displayField:"name",maxAccess:$,onChange:(e,t)=>{M.setFieldValue("siteId",(null==t?void 0:t.recordId)||null)},error:M.touched.siteId&&!!M.errors.siteId})}),(0,r.jsx)(p.ZP,{item:!0,xs:6,children:(0,r.jsx)(w.Z,{endpointId:S.r.Plant.qry,name:"plantId",label:m.plant,valueField:"recordId",displayField:"name",columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],readOnly:H,values:M.values,maxAccess:$,onChange:(e,t)=>{M.setFieldValue("plantId",t?null==t?void 0:t.recordId:"")},error:M.touched.plantId&&!!M.errors.recordId})})]}),(0,r.jsx)(q._,{onChange:e=>{let t=null==e?void 0:e.map(e=>({...e,orderedQty:0}));M.setFieldValue("items",t)},maxAccess:$,name:"items",disabled:H,value:(null==M?void 0:null===(n=M.values)||void 0===n?void 0:n.items)||[],error:null==M?void 0:null===(o=M.errors)||void 0===o?void 0:o.items,columns:Y,allowDelete:!H,allowAddNewLine:!H}),(0,r.jsx)(u.g,{children:(0,r.jsx)(p.ZP,{container:!0,spacing:2,sx:{mb:3,display:"flex",justifyContent:"left"},children:(0,r.jsx)(p.ZP,{item:!0,xs:4,children:(0,r.jsx)(j.Z,{name:"notes",label:m.notes,value:M.values.notes,maxLength:"100",readOnly:H,maxAccess:$,onChange:M.handleChange,onClear:()=>M.setFieldValue("notes",""),error:M.touched.notes&&!!M.errors.notes})})})})]})})})}var Z=n(36908),O=()=>{let{getRequest:e,postRequest:t}=(0,d.useContext)(l.$),{platformLabels:n}=(0,d.useContext)(y.l),{stack:p}=(0,f.zY)();async function I(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{_startAt:n=0,_pageSize:r=50,params:d}=t;return{...await e({extension:_.u.ProductionSheet.qry,parameters:"_startAt=".concat(n,"&_pageSize=").concat(r,"&_params=").concat(d||"")}),_startAt:n}}let{query:{data:h},labels:x,paginationParameters:g,refetch:w,access:N,invalidate:b,filterBy:P}=(0,i.J)({queryFn:I,endpointId:_.u.ProductionSheet.qry,datasetId:s.i.ProductionSheet,filter:{filterFn:C}}),k=[{field:"reference",headerName:x.reference,flex:1},{field:"date",headerName:x.date,flex:1,type:"date"},{field:"siteRef",headerName:x.siteRef,flex:1},{field:"siteName",headerName:x.site,flex:1},{field:"plantName",headerName:x.plant,flex:1},{field:"statusName",headerName:x.status,flex:1}],q=async()=>{var t;let n=(0,m.m)("userData").userId,r=await e({extension:S.r.UserDefaults.get,parameters:"_userId=".concat(n,"&_key=plantId")});return null==r?void 0:null===(t=r.record)||void 0===t?void 0:t.value};async function C(t){let{filters:n,pagination:r}=t;return n.qry?await e({extension:_.u.ProductionSheet.snapshot,parameters:"_filter=".concat(n.qry)}):I({_startAt:r._startAt||0,params:null==n?void 0:n.params})}async function j(e){p({Component:F,props:{labels:x,recordId:e,plantId:await q(),maxAccess:N},width:1e3,height:680,title:x.ProductionSheet})}let A=async e=>{await t({extension:_.u.ProductionSheet.del,record:JSON.stringify(e)}),b(),a.ZP.success(n.Deleted)};return(0,r.jsxs)(c.R,{children:[(0,r.jsx)(u.g,{children:(0,r.jsx)(Z.Z,{onAdd:()=>{j()},labels:x,maxAccess:N,reportName:"MFPST",filterBy:P})}),(0,r.jsx)(v.Q,{children:(0,r.jsx)(o.Z,{name:"table",columns:k,gridData:h,rowId:["recordId"],onEdit:e=>{j(null==e?void 0:e.recordId)},onDelete:A,isLoading:!1,pageSize:50,paginationType:"api",paginationParameters:g,refetch:w,maxAccess:N})})]})}},1685:function(e,t,n){"use strict";n.d(t,{m:function(){return r}});let r=e=>{let t=window.sessionStorage.getItem(e);return t?JSON.parse(t):null}},98345:function(e,t,n){"use strict";n.d(t,{H:function(){return y},G:function(){return f}});var r=n(45300),d=n(2784),a=n(96026),o=n(38449);n(26612);var l=n(65947),i=n(1685);let s=async(e,t,n)=>{try{let r=await e({extension:t,parameters:n});return t.includes("qry")?r:r.record}catch(e){return null}},c=(e,t,n,r)=>{let d=(e=JSON.parse(JSON.stringify(e))).record.controls,a=d.find(e=>"reference"===e.controlId);return a?a.accessLevel=(null==t?void 0:t.mandatory)?l.$7:l.rr:(null==t?void 0:t.mandatory)?d.push({sgId:0,resourceId:"",controlId:"".concat(r?r+".":"","reference"),accessLevel:(null==t?void 0:t.mandatory)?l.$7:l.rr}):(null==t?void 0:t.readOnly)?d.push({sgId:0,resourceId:"",controlId:"".concat(r?r+".":"","reference"),accessLevel:(null==t?void 0:t.readOnly)?l.rr:l.$7}):d=e.record.controls.filter(e=>"reference"!=e.controlId),n&&d.push({sgId:0,resourceId:"",controlId:"".concat(r?r+".":"","dtId"),accessLevel:l.$7}),{...e,record:{...e.record,controls:d}}},u=async(e,t,n)=>{let r,d;switch(n){case"dtId":let a=(0,i.m)("userData"),l=null==a?void 0:a.userId;d="_userId=".concat(l,"&_functionId=").concat(t),r=o.r.UserFunction.get;break;case"glbSysNumberRange":d="_recordId=".concat(t),r=o.r.SystemFunction.get;break;case"DocumentType":d="_dgId=".concat(t,"&_startAt=",0,"&_pageSize=",50),r=o.r.DocumentType.qry;break;case"DcTypNumberRange":d="_recordId=".concat(t),r=o.r.DocumentType.get;break;case"isExternal":d="_recordId=".concat(t),r=o.r.NumberRange.get;break;default:return null}return await s(e,r,d)},m=async function(e){let t,n,r,d,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,o=arguments.length>2?arguments[2]:void 0,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,i=!(arguments.length>4)||void 0===arguments[4]||arguments[4],s=arguments.length>5?arguments[5]:void 0,m=void 0===l&&a&&await u(e,a,"dtId"),v=null==m?void 0:m.dtId,f="",y=!0;if(m&&void 0===l||"nraId"===l){if(v){let n=await u(e,v,"DcTypNumberRange");t=null==n?void 0:n.nraId,y=!((null==n?void 0:n.activeStatus)<0),t||(f="Assign the document type to a number range")}if((!v||!y)&&i&&a){var p;let t=await u(e,a,"DocumentType");d=(null==t?void 0:null===(p=t.list)||void 0===p?void 0:p.filter(e=>(null==e?void 0:e.activeStatus)===1).length)>0}}if(("nraId"===l||void 0===l)&&a){if((!v||v)&&!t||t&&!y){let n=await u(e,a,"glbSysNumberRange");(t=null==n?void 0:n.nraId)&&d&&(d=!1),y=!0}f=t||d?"":"Assign the system Function to a number range"}l>0&&!t&&(t=l),t&&y?(n={readOnly:null==(r=await u(e,t,"isExternal"))||!r.external,mandatory:null!=r&&!!r.external},o&&(o=await c(o,n,d,s))):!t&&o&&(o=await c(o,n,d,s));let I=s?"".concat(s,".reference"):"reference";return{dtId:v,resetReference:null==n?void 0:n.readOnly,dcTypeRequired:d,reference:{fieldName:I,isEmpty:(null==r?void 0:r.external)!==void 0&&(null==r||!r.external)},errorMessage:f,maxAccess:o,selectNraId:l}};var v=n(65950);function f(e){let{functionId:t,action:n,hasDT:r}=e,{getRequest:o}=(0,d.useContext)(v.$),{stack:l}=(0,a.V)();return{proxyAction:async()=>{let e=await m(o,t,"",void 0,r);(null==e?void 0:e.errorMessage)?l({message:null==e?void 0:e.errorMessage}):await n()}}}function y(e){var t;let{functionId:n,access:o,hasDT:l,enabled:i=!0,objectName:s=""}=e,{getRequest:c}=(0,d.useContext)(v.$),{stack:u}=(0,a.V)(),[f,y]=(0,d.useState)(),p=async e=>{let t=await m(c,n,o,e,l,s);if(!t.errorMessage)return t;u({message:null==t?void 0:t.errorMessage})},I=(0,r.a)({retry:!1,staleTime:0,enabled:i,queryKey:[n,f,!!o,i],queryFn:f||"nraId"===f?()=>p(f):()=>p()});return{documentType:I.data,maxAccess:(null==I?void 0:null===(t=I.data)||void 0===t?void 0:t.maxAccess)||o,changeDT(e){y((null==e?void 0:e.nraId)||"nraId")}}}}},function(e){e.O(0,[92515,2494,36908,49774,92888,40179],function(){return e(e.s=63456)}),_N_E=e.O()}]);