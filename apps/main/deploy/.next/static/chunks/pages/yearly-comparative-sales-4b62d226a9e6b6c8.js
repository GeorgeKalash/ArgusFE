(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[57419],{84160:function(e,a,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/yearly-comparative-sales",function(){return t(22700)}])},22700:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return g}});var l=t(52322),r=t(2784),i=t(71987),s=t(65950),n=t(69387),d=t(26612),c=t(31389),h=t(33625),o=t(62362),u=t(36908);let m={YearlyComparativeSale:{SA503:"RG.SA.asmx/SA503"}};var y=t(84100),f=t(80968),p=t(38449),x=t(60218),b=t(13781),v=t(19473),w=t(69627),g=()=>{var e;let{getRequest:a}=(0,r.useContext)(s.$),{getAllKvsByDataset:t}=(0,r.useContext)(f.k),{platformLabels:g}=(0,r.useContext)(v.l),[N,j]=(0,r.useState)([]),[S,C]=(0,r.useState)([]),[_,k]=(0,r.useState)([]),[A,E]=(0,r.useState)(!1),{query:{data:P},filterBy:Z,labels:O,access:T,refetch:Y}=(0,i.J)({queryFn:J,endpointId:m.YearlyComparativeSale.SA503,datasetId:d.i.YearlyComparativeSales,filter:{filterFn:R}}),L=async()=>{C((await new Promise((e,a)=>{t({_dataset:y.v.MONTHS,callback:t=>{t?e(t):a()}})})).sort((e,a)=>e.key-a.key).reduce((e,a)=>{let{key:t,value:l}=a;return e[l]=l,e},{}))};async function F(){var e;let t=await a({extension:p.r.FiscalYears.qry,parameters:"_filter="});if((null==t?void 0:null===(e=t.list)||void 0===e?void 0:e.length)>0)return t.list.map((e,a,t)=>({year:e.fiscalYear,checked:1===t.length||a>=t.length-2}))}let I=[{field:"year",headerName:O.year,width:150,pinned:"left"},{field:"total",headerName:O.total,width:220,type:"number",pinned:"left"},{field:"salary1",headerName:S.JAN,type:"number",width:170},{field:"salary2",headerName:S.FEB,type:"number",width:170},{field:"salary3",headerName:S.MAR,type:"number",width:170},{field:"salary4",headerName:S.APR,type:"number",width:170},{field:"salary5",headerName:S.MAY,type:"number",width:170},{field:"salary6",headerName:S.JUN,type:"number",width:170},{field:"salary7",headerName:S.JUL,type:"number",width:170},{field:"salary8",headerName:S.AUG,type:"number",width:170},{field:"salary9",headerName:S.SEP,type:"number",width:170},{field:"salary10",headerName:S.OCT,type:"number",width:170},{field:"salary11",headerName:S.NOV,type:"number",width:170},{field:"salary12",headerName:S.DEC,type:"number",width:170}];async function J(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{params:t=[]}=e,l=N.filter(e=>e.checked).map(e=>e.year);if(k(e=>({...e,datasetLabels:l.map(String)})),l.length>0){let e=await a({extension:m.YearlyComparativeSale.SA503,parameters:"_years=".concat(l.join(","),"&_params=").concat(t)}),r=l.reduce((e,a)=>(e[a]={year:a,total:0,...Object.fromEntries(Array.from({length:12},(e,a)=>["salary".concat(a+1),0]))},e),{});return e.list.forEach(e=>{let{year:a,netSales:t=0,month:l}=e;r[a]&&(r[a].total+=t,r[a]["salary".concat(l)]+=t)}),{list:Object.values(r)}}}async function R(e){let{filters:a}=e;return J({params:null==a?void 0:a.params})}let q=e=>e.list.map((e,a)=>{let{year:t,total:l,...r}=e,i=D(Object.keys(r).sort((e,a)=>{var t,l;let r=(null===(t=e.match(/\d+/))||void 0===t?void 0:t[0])||"0",i=(null===(l=a.match(/\d+/))||void 0===l?void 0:l[0])||"0";return Number(r)-Number(i)}).map(e=>r[e]));return{["dataset".concat(a+1)]:t,values:i}}),D=e=>{let a=e.length-1;for(;a>=0&&0===e[a];)a--;return e.slice(0,a+1)};return(0,r.useEffect)(()=>{!async function(){await L(),j(await F())}()},[]),(0,r.useEffect)(()=>{N.length>0&&Y()},[N]),(0,r.useEffect)(()=>{var e;if((null==P?void 0:null===(e=P.list)||void 0===e?void 0:e.length)>0){let e=Object.values(S),a=q(P).map(e=>e.values);k(t=>({...t,labels:e,datasets:a}))}},[P,S]),(0,l.jsxs)(c.R,{children:[(0,l.jsx)(h.g,{children:(0,l.jsx)(u.Z,{maxAccess:T,reportName:"SA503",filterBy:Z,hasSearch:!1})}),(0,l.jsx)(h.g,{children:(0,l.jsx)(n.Z,{name:"yearsTable",columns:I,gridData:P,rowId:["year"],isLoading:!1,maxAccess:T,pagination:!1,height:"250px"})}),(0,l.jsx)(o.Q,{children:(0,l.jsxs)(x.ZP,{container:!0,sx:{display:"flex",flex:1},spacing:2,children:[(0,l.jsx)(x.ZP,{item:!0,xs:2,children:(0,l.jsxs)(x.ZP,{container:!0,spacing:2,children:[(0,l.jsx)(x.ZP,{item:!0,xs:12,children:(0,l.jsx)(n.Z,{name:"fiscalTable",columns:[{field:"year",headerName:O.year,flex:1}],gridData:{list:N},rowId:["year"],showCheckboxColumn:!0,isLoading:!1,maxAccess:T,pagination:!1,height:"300px",handleCheckboxChange:()=>E(0==N.filter(e=>e.checked).map(e=>e.year).length)})}),(0,l.jsx)(x.ZP,{item:!0,xs:4,children:(0,l.jsx)(w.Z,{onClick:Y,disabled:A,image:"preview.png",tooltipText:g.Preview})})]})}),(0,l.jsx)(x.ZP,{item:!0,xs:10,sx:{display:"flex",flex:1,p:2},children:(null===(e=_.labels)||void 0===e?void 0:e.length)>0&&(0,l.jsx)(b.Q5,{id:"yearly-sales-chart",labels:_.labels,datasets:_.datasets,datasetLabels:_.datasetLabels})})]})})]})}}},function(e){e.O(0,[96767,92515,2494,86558,36908,13781,49774,92888,40179],function(){return e(e.s=84160)}),_N_E=e.O()}]);