(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[49609],{13694:function(e,i,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/iv-opening-qty",function(){return a(42442)}])},42442:function(e,i,a){"use strict";a.r(i),a.d(i,{default:function(){return k}});var t=a(52322),r=a(2784),l=a(62202),n=a(61802),s=a(69387),d=a(65950),o=a(71987),c=a(26612),u=a(31389),m=a(33625),y=a(62362),h=a(65215),x=a(19473),p=a(36908),I=a(60218),g=a(48601),v=a(5088),f=a(82737),N=a(8661),j=a(80983),Z=a(38449),q=a(27423),_=a(91406),S=a(23925),w=a(96026),b=a(54074),C=a(76399);let F=e=>{var i;let{parentForm:a,window:n}=e,{postRequest:s,getRequest:p}=(0,r.useContext)(d.$),{stack:v}=(0,w.V)(),{platformLabels:f}=(0,r.useContext)(x.l),{labels:N,maxAccess:Z}=(0,o.J)({datasetId:c.i.InventoryOpeningQtys}),{formik:q}=(0,j.c)({initialValues:{year:a.year,siteId:a.siteId,itemId:a.itemId,data:[]},validationSchema:g.Ry({data:g.IX().of(g.Ry().shape({srlNo:g.Z_().trim().required()}))}),onSubmit:async e=>{let i={...e,data:e.data.map((e,i)=>({...e,id:i+1,seqNo:i+1,recordId:a.recordId,year:a.year,siteId:a.siteId,itemId:a.itemId,periodId:a.periodId}))};await s({extension:h.$.QtyOpeningSerials.set2,record:JSON.stringify(i)}),l.ZP.success(f.Updated),n.close()}});(0,r.useEffect)(()=>{!async function(){let e=await p({extension:h.$.QtyOpeningSerials.qry,parameters:"_recordId=".concat(a.recordId,"&_year=").concat(a.year,"&_periodId=").concat(a.periodId,"&_itemId=").concat(a.itemId,"&_siteId=").concat(a.siteId)});if(e.list.length>0){var i;q.setFieldValue("data",null==e?void 0:null===(i=e.list)||void 0===i?void 0:i.map((e,i)=>({...e,id:i+1,seqNo:i+1})))}}()},[]);let F=async(e,i,t)=>{let{srlNo:r,id:l}=e;if(r){let n=await p({extension:h.$.Serial.qry,parameters:"_srlNo=".concat(null==e?void 0:e.srlNo,"&_itemId=").concat(a.itemId,"&_startAt=0&_pageSize=50")});0==n.list.length?v({message:f.unknownSerial}):(i({weight:n.list[0].weight}),t({fieldName:"srlNo",changes:{id:l,srlNo:r,weight:n.list[0].weight}}))}},O=[{component:"textfield",label:N.Serials,name:"srlNo",updateOn:"blur",onChange:async e=>{let{row:{update:i,newRow:a,oldRow:t,addRow:r}}=e;a.srlNo!==(null==t?void 0:t.srlNo)&&await F(a,i,r)}},{component:"numberfield",label:N.pcs,name:"pcs",props:{allowNegative:!1}},{component:"numberfield",label:N.weight,name:"weight",props:{readOnly:!0}}],k=q.values.data.reduce((e,i)=>e+(Number(i.weight)||0),0),P=(null==a?void 0:a.qty)-k;return(0,t.jsx)(b.Z,{onSave:q.handleSubmit,editMode:!0,children:(0,t.jsx)(S.Z,{sx:{display:"flex",flexDirection:"column",flex:1,overflow:"hidden"},children:(0,t.jsxs)(u.R,{children:[(0,t.jsx)(y.Q,{children:(0,t.jsx)(C._,{name:"data",maxAccess:Z,value:q.values.data,error:null===(i=q.errors)||void 0===i?void 0:i.data,columns:O,onChange:e=>q.setFieldValue("data",e)})}),(0,t.jsx)(m.g,{children:(0,t.jsx)(I.ZP,{container:!0,children:(0,t.jsx)(I.ZP,{item:!0,xs:6,children:(0,t.jsxs)(I.ZP,{container:!0,spacing:2,children:[(0,t.jsx)(I.ZP,{item:!0,xs:12,children:(0,t.jsx)(_.Z,{name:"totalWeight",maxAccess:Z,value:k.toFixed(2),label:N.totalWeight,readOnly:!0})}),(0,t.jsx)(I.ZP,{item:!0,xs:12,children:(0,t.jsx)(_.Z,{name:"qty",maxAccess:Z,value:Number(null==a?void 0:a.qty).toFixed(2),label:N.qty,readOnly:!0})}),(0,t.jsx)(I.ZP,{item:!0,xs:12,children:(0,t.jsx)(_.Z,{name:"balanceWeight",maxAccess:Z,value:P.toFixed(2),label:N.balanceWeight,readOnly:!0})})]})})})})]})})})};var O=e=>{var i,a,s;let{labels:m,maxAccess:p,recordId:S,record:w}=e,{postRequest:b,getRequest:C}=(0,r.useContext)(d.$),{platformLabels:O}=(0,r.useContext)(x.l),{stack:k}=(0,n.zY)(),P=(0,o.E)({endpointId:h.$.InventoryOpeningQtys.qry}),{formik:A}=(0,j.c)({maxAccess:p,initialValues:{recordId:S,year:"",siteId:null,sku:"",itemId:null,itemName:"",qty:null,pieces:"",avgWeight:"",lotCategoryId:"",trackBy:"",pieces:"",periodId:null},validationSchema:g.Ry({year:g.Z_().required(),siteId:g.Z_().required(),sku:g.Z_().required(),itemId:g.Z_().required(),qty:g.Rx().required().min(.01),avgWeight:g.Z_().nullable().max(999999),periodId:g.Rx().required()}),onSubmit:async e=>{let i=A.values.year,a=A.values.itemId,t=A.values.siteId;await b({extension:h.$.InventoryOpeningQtys.set,record:JSON.stringify(e)}),i||t||a||periodId?l.ZP.success(O.Edited):l.ZP.success(O.Added),A.setFieldValue("recordId",String(100*e.year)+String(10*e.itemId)+String(e.siteId)+String(e.periodId)),P()}}),V=!!A.values.recordId;(0,r.useEffect)(()=>{!async function(){if(w&&w.year&&w.itemId&&w.siteId&&S){let e=await C({extension:h.$.InventoryOpeningQtys.get,parameters:"_fiscalYear=".concat(w.year,"&_itemId=").concat(w.itemId,"&_siteId=").concat(w.siteId,"&_periodId=").concat(w.periodId)});A.setValues({...e.record,recordId:String(100*e.record.year)+String(10*e.record.itemId)+String(e.record.siteId)+String(e.record.periodId)})}}()},[]);let Q=[{key:"Serials",condition:!0,onClick:()=>{k({Component:F,props:{parentForm:A.values},width:700,height:600,title:m.Serials})},disabled:!V||1!=A.values.trackBy}];return(0,t.jsx)(f.Z,{form:A,actions:Q,resourceId:c.i.InventoryOpeningQtys,maxAccess:p,editMode:V,children:(0,t.jsx)(u.R,{children:(0,t.jsx)(y.Q,{children:(0,t.jsxs)(I.ZP,{container:!0,spacing:2,children:[(0,t.jsx)(I.ZP,{item:!0,xs:12,children:(0,t.jsx)(N.Z,{endpointId:Z.r.FiscalYears.qry,readOnly:V,name:"year",label:m.fiscalYear,valueField:"fiscalYear",displayField:"fiscalYear",values:A.values,required:!0,refresh:V,maxAccess:p,onChange:(e,i)=>A.setFieldValue("year",null==i?void 0:i.fiscalYear),error:A.touched.year&&!!A.errors.year})}),(0,t.jsx)(I.ZP,{item:!0,xs:12,children:(0,t.jsx)(N.Z,{endpointId:Z.r.FiscalPeriod.qry,name:"periodId",label:m.fiscalPeriod,valueField:"periodId",displayField:"name",values:A.values,required:!0,readOnly:V,maxAccess:p,onChange:(e,i)=>A.setFieldValue("periodId",(null==i?void 0:i.periodId)||null),error:A.touched.periodId&&!!A.errors.periodId})}),(0,t.jsx)(I.ZP,{item:!0,xs:12,children:(0,t.jsx)(N.Z,{endpointId:h.$.Site.qry,name:"siteId",readOnly:V,required:!0,refresh:V,label:m.site,values:A.values,displayField:"name",maxAccess:p,onChange:(e,i)=>A.setFieldValue("siteId",null==i?void 0:i.recordId),error:A.touched.siteId&&!!A.errors.siteId})}),(0,t.jsx)(I.ZP,{item:!0,xs:12,children:(0,t.jsx)(q.U,{endpointId:h.$.Item.snapshot,name:"sku",refresh:V,readOnly:V,secondDisplayField:!1,label:m.sku,valueField:"sku",displayField:"sku",valueShow:"sku",required:!0,form:A,onChange:(e,i)=>{A.setFieldValue("itemName",i?i.name:""),A.setFieldValue("sku",i?i.sku:""),A.setFieldValue("trackBy",i?i.trackBy:""),A.setFieldValue("lotCategory",i?i.lotCategory:""),A.setFieldValue("itemId",null==i?void 0:i.recordId)},errorCheck:"sku",maxAccess:p})}),(0,t.jsx)(I.ZP,{item:!0,xs:12,children:(0,t.jsx)(v.Z,{endpointId:h.$.Item.snapshot,name:"itemName",value:A.values.itemName,readOnly:!0,label:m.item,maxAccess:p})}),(0,t.jsx)(I.ZP,{item:!0,xs:12,children:(0,t.jsx)(_.Z,{name:"qty",required:!0,label:m.qty,value:null==A?void 0:null===(i=A.values)||void 0===i?void 0:i.qty,maxAccess:p,onChange:A.handleChange,onClear:()=>A.setFieldValue("qty",""),error:A.touched.qty&&!!A.errors.qty,decimalScale:3,allowNegative:!1})}),(0,t.jsx)(I.ZP,{item:!0,xs:12,children:(0,t.jsx)(_.Z,{name:"pieces",label:m.pieces,readOnly:!0,value:null==A?void 0:null===(a=A.values)||void 0===a?void 0:a.pieces,maxAccess:p,onChange:A.handleChange,onClear:()=>A.setFieldValue("pieces",""),decimalScale:2,error:A.touched.pieces&&!!A.errors.pieces,allowNegative:!1})}),(0,t.jsx)(I.ZP,{item:!0,xs:12,children:(0,t.jsx)(_.Z,{name:"avgWeight",label:m.avgWeight,value:null==A?void 0:null===(s=A.values)||void 0===s?void 0:s.avgWeight,maxAccess:p,onChange:A.handleChange,onClear:()=>A.setFieldValue("avgWeight",""),decimalScale:2,error:A.touched.avgWeight&&!!A.errors.avgWeight,maxLength:8,allowNegative:!1})})]})})})})},k=()=>{let{getRequest:e,postRequest:i}=(0,r.useContext)(d.$),{platformLabels:a}=(0,r.useContext)(x.l),{stack:I}=(0,n.zY)();async function g(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{_startAt:a=0,_pageSize:t=50,params:r}=i;return await e({extension:h.$.InventoryOpeningQtys.qry,parameters:"_startAt=".concat(a,"&_pageSize=").concat(t,"&filter=&_params=").concat(r||"","&_sortBy=year desc")})}async function v(e){let{filters:i,pagination:a}=e;return g({_startAt:a._startAt||0,params:null==i?void 0:i.params})}let{query:{data:f},labels:N,paginationParameters:j,filterBy:Z,invalidate:q,refetch:_,access:S}=(0,o.J)({queryFn:g,endpointId:h.$.InventoryOpeningQtys.qry,datasetId:c.i.InventoryOpeningQtys,filter:{filterFn:v}}),w=[{field:"year",headerName:N.fiscalYear,flex:1},{field:"siteRef",headerName:N.siteRef,flex:1},{field:"siteName",headerName:N.siteName,flex:1},{field:"sku",headerName:N.sku,flex:1},{field:"itemName",headerName:N.itemName,flex:1},{field:"qty",headerName:N.qty,flex:1},{field:"periodId",headerName:N.periodId,flex:1},{field:"pieces",headerName:N.pieces,flex:1}];function b(e){I({Component:O,props:{labels:N,record:e,maxAccess:S,recordId:e?String(100*e.year)+String(10*e.itemId)+String(e.siteId):null},width:780,height:550,title:N.openingQtys})}let C=async e=>{await i({extension:h.$.InventoryOpeningQtys.del,record:JSON.stringify(e)}),q(),l.ZP.success(a.Deleted)};return(0,t.jsxs)(u.R,{children:[(0,t.jsx)(m.g,{children:(0,t.jsx)(p.Z,{onAdd:()=>{b()},maxAccess:S,filterBy:Z,reportName:"IVOQ",hasSearch:!1})}),(0,t.jsx)(y.Q,{children:(0,t.jsx)(s.Z,{name:"table",columns:w,gridData:f,rowId:["year","itemId","siteId"],onEdit:e=>{b(e)},onDelete:C,isLoading:!1,pageSize:50,refetch:_,paginationParameters:j,paginationType:"api",maxAccess:S})})]})}}},function(e){e.O(0,[92515,2494,36908,49774,92888,40179],function(){return e(e.s=13694)}),_N_E=e.O()}]);