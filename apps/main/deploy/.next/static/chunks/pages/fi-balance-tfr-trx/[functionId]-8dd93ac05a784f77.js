(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[57621],{64224:function(e,a,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/fi-balance-tfr-trx/[functionId]",function(){return n(79724)}])},79724:function(e,a,n){"use strict";n.r(a),n.d(a,{default:function(){return D}});var r=n(52322),l=n(2784),t=n(62202),o=n(69387),d=n(65950),c=n(26612),u=n(71987),s=n(31389),i=n(33625),m=n(62362),f=n(61802),v=n(19473),I=n(36908),x=n(63165),y=n(7121),p=n(25870),h=n(60218),g=n(48601),A=n(82737),F=n(27423),C=n(8661),b=n(38449),R=n(80983),N=n(22341),w=n(89330),j=n(21581),Z=n(5088),k=n(91406),P=n(39812),T=n(1251),_=n(26553),S=n(30657),B=n(98345),V=n(16463);function q(e){var a,n,o,i,I;let{labels:x,access:y,recordId:q,functionId:D,resourceId:E,getGLResourceId:O,window:H}=e,{getRequest:M,postRequest:L}=(0,l.useContext)(d.$),{platformLabels:J,defaultsData:G,userDefaultsData:$}=(0,l.useContext)(v.l),{stack:U}=(0,f.zY)(),z=(0,u.E)({endpointId:p.H.BalanceTransfer.page}),{documentType:K,maxAccess:Q,changeDT:X}=(0,B.H)({functionId:D,access:y,enabled:!q}),Y=null==G?void 0:null===(n=G.list)||void 0===n?void 0:null===(a=n.find(e=>{let{key:a}=e;return"baseCurrencyId"===a}))||void 0===a?void 0:a.value,W=null==$?void 0:null===(i=$.list)||void 0===i?void 0:null===(o=i.find(e=>{let{key:a}=e;return"plantId"===a}))||void 0===o?void 0:o.value,{formik:ee}=(0,R.c)({documentType:{key:"dtId",value:null==K?void 0:K.dtId,reference:null==K?void 0:K.reference},initialValues:{recordId:q,dtId:null,reference:"",date:new Date,plantId:parseInt(W),spId:null,fromAccountId:null,fromCurrencyId:null,toCurrencyId:parseInt(Y),fromBaseAmount:null,fromAmount:null,fromExRate:null,status:1,notes:"",toAmount:null,toExRate:null,toBaseAmount:null,fromRateCalcMethod:null,toRateCalcMethod:null,functionId:D},maxAccess:Q,validateOnChange:!0,validationSchema:g.Ry({date:g.hT().required(),fromAccountId:g.Rx().required(),fromCurrencyId:g.Rx().required(),fromAmount:g.Rx().required(),fromBaseAmount:g.Rx().required(),fromExRate:g.Rx().required()}),onSubmit:async e=>{let{fromAccountName:a,fromAccountRef:n,templateId:r,...l}=e,o=await L({extension:E===c.i.BalanceTransferPurchase?p.H.BalanceTransferPurchases.set:p.H.BalanceTransferSales.set,record:JSON.stringify({...l,date:(0,P.ku)(l.date),toAccountId:l.fromAccountId})});t.ZP.success(l.recordId?J.Edited:J.Added),er(o.recordId),z()}}),ea=!!ee.values.recordId,en=3===ee.values.status,er=async e=>{let{record:a}=await M({extension:p.H.BalanceTransfer.get,parameters:"_recordId=".concat(e)}),n=(0,S.fB)({amount:a.fromAmount,exRate:null==a?void 0:a.fromExRate,baseAmount:null==a?void 0:a.fromBaseAmount,rateCalcMethod:null==a?void 0:a.fromRateCalcMethod,dirtyField:S.ss});ee.setValues({...a,date:(0,P.a1)(a.date),fromAmount:n.amount})};(0,l.useEffect)(()=>{var e;q?er(q):ei("to",Y,null===(e=ee.values)||void 0===e?void 0:e.date)},[]);let{fromAccountName:el,fromAccountRef:et,templateId:eo,...ed}=ee.values,ec=async()=>{await L({extension:p.H.BalanceTransfer.post,record:JSON.stringify({...ed,date:(0,P.ku)(ed.date)})}),t.ZP.success(J.Posted),z(),H.close()},eu=async()=>{await L({extension:p.H.BalanceTransfer.unpost,record:JSON.stringify({...ed,date:(0,P.ku)(ed.date),toAccountId:ed.fromAccountId})}),t.ZP.success(J.Unposted),er(q),z()};async function es(e,a){if(e&&a){let{record:n}=await M({extension:T.q.Currency.get,parameters:"_currencyId=".concat(e,"&_date=").concat((0,P.Uf)(a),"&_rateDivision=").concat(_.B.FINANCIALS)});return n}}let ei=async(e,a,n,r)=>{var l;let t=await es(a,n);ee.setFieldValue("".concat(e,"ExRate"),(null==t?void 0:t.exRate)?null==t?void 0:null===(l=t.exRate)||void 0===l?void 0:l.toFixed(2):""),ee.setFieldValue("".concat(e,"RateCalcMethod"),null==t?void 0:t.rateCalcMethod);let o=(0,S.fB)({amount:r||0,exRate:null==t?void 0:t.exRate.toFixed(2),baseAmount:0,rateCalcMethod:null==t?void 0:t.rateCalcMethod,dirtyField:S.ss});ee.setFieldValue("".concat(e,"BaseAmount"),parseFloat(null==o?void 0:o.baseAmount).toFixed(2)),ee.setFieldValue("".concat(e,"Amount"),parseFloat(null==o?void 0:o.amount).toFixed(2))},em=[{key:"GL",condition:!0,onClick:"onClickGL",datasetId:O(D),disabled:!ea},{key:"Unlocked",condition:!en,onClick:ec,disabled:!ea},{key:"Locked",condition:en,onClick:"onUnpostConfirmation",onSuccess:eu,disabled:!ea},{key:"AccountSummary",condition:!0,onClick:()=>{U({Component:V.Z,props:{accountId:parseInt(ee.values.fromAccountId),moduleId:1}})},disabled:!ee.values.fromAccountId}],ef=(e,a)=>{var n,r,l,t;let o=(0,S.fB)({amount:null!=a?a:0,exRate:e,baseAmount:0,rateCalcMethod:null===(n=ee.values)||void 0===n?void 0:n.fromRateCalcMethod,dirtyField:S.ss});ee.setFieldValue("fromBaseAmount",parseFloat(null==o?void 0:o.baseAmount).toFixed(2)||0);let d=(0,S.fB)({amount:(null==o?void 0:o.baseAmount)||0,exRate:null===(r=ee.values)||void 0===r?void 0:r.toExRate,baseAmount:null===(l=ee.values)||void 0===l?void 0:l.toBaseAmount,rateCalcMethod:null===(t=ee.values)||void 0===t?void 0:t.toRateCalcMethod,dirtyField:S.ss});ee.setFieldValue("toAmount",parseFloat(null==d?void 0:d.amount).toFixed(2)||0),ee.setFieldValue("toBaseAmount",parseFloat(null==d?void 0:d.baseAmount).toFixed(2)||0)};return(0,r.jsx)(A.Z,{resourceId:E,functionId:D,form:ee,maxAccess:Q,editMode:ea,actions:em,disabledSubmit:en,previewReport:ea,children:(0,r.jsx)(s.R,{children:(0,r.jsx)(m.Q,{children:(0,r.jsxs)(h.ZP,{container:!0,spacing:2,children:[(0,r.jsx)(h.ZP,{item:!0,xs:6,children:(0,r.jsxs)(h.ZP,{container:!0,spacing:2,children:[(0,r.jsx)(h.ZP,{item:!0,xs:12,children:(0,r.jsx)(C.Z,{endpointId:b.r.DocumentType.qry,parameters:"_startAt=0&_pageSize=1000&_dgId=".concat(D),name:"dtId",label:x.docType,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],readOnly:ea,valueField:"recordId",displayField:["reference","name"],values:ee.values,maxAccess:!ea&&Q,onChange:(e,a)=>{ee.setFieldValue("dtId",null==a?void 0:a.recordId),X(a)},error:ee.touched.dtId&&!!ee.errors.dtId})}),(0,r.jsx)(h.ZP,{item:!0,xs:12,children:(0,r.jsx)(Z.Z,{name:"reference",label:x.reference,value:ee.values.reference,readOnly:ea,maxLength:"10",maxAccess:!ea&&Q,onChange:ee.handleChange,onClear:()=>ee.setFieldValue("reference",""),error:ee.touched.reference&&!!ee.errors.reference})}),(0,r.jsx)(h.ZP,{item:!0,xs:12,children:(0,r.jsx)(w.Z,{name:"date",label:x.date,value:null===(I=ee.values)||void 0===I?void 0:I.date,required:!0,onChange:(e,a)=>{ee.setFieldValue("date",a||null),ei("to",ee.values.toCurrencyId,a,ee.values.amount),ei("from",ee.values.fromCurrencyId,a,ee.values.amount)},readOnly:en,onClear:()=>ee.setFieldValue("date",null),error:ee.touched.date&&!!ee.errors.date,maxAccess:Q})})]})}),(0,r.jsx)(h.ZP,{item:!0,xs:6,children:(0,r.jsxs)(h.ZP,{container:!0,spacing:2,children:[(0,r.jsx)(h.ZP,{item:!0,xs:12,children:(0,r.jsx)(C.Z,{endpointId:b.r.Plant.qry,name:"plantId",label:J.plant,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"plant Ref"},{key:"name",value:"Name"}],values:ee.values,onChange:(e,a)=>{ee.setFieldValue("plantId",(null==a?void 0:a.recordId)||null),(null==a?void 0:a.recordId)||ee.setFieldValue("spId",null)},readOnly:en,error:ee.touched.plantId&&!!ee.errors.plantId,maxAccess:Q})}),(0,r.jsx)(h.ZP,{item:!0,xs:12,children:(0,r.jsx)(C.Z,{endpointId:N.P.SalesPerson.qry,filter:e=>e.plantId===ee.values.plantId,name:"spId",label:x.salesPerson,columnsInDropDown:[{key:"spRef",value:"Reference"},{key:"name",value:"Name"}],valueField:"recordId",displayField:"name",values:ee.values,onChange:(e,a)=>{ee.setFieldValue("spId",(null==a?void 0:a.recordId)||null)},readOnly:en||!ee.values.plantId,error:ee.touched.spId&&!!ee.errors.spId,maxAccess:Q})})]})}),(0,r.jsx)(h.ZP,{item:!0,xs:12,children:(0,r.jsx)(F.U,{endpointId:p.H.Account.snapshot,name:"fromAccountId",filter:{isInactive:e=>!0!==e},required:!0,label:x.account,valueField:"reference",displayField:"name",valueShow:"fromAccountRef",secondValueShow:"fromAccountName",displayFieldWidth:2,form:ee,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"},{key:"keywords",value:"keywords"},{key:"groupName",value:"account Group"}],onChange:(e,a)=>{ee.setValues({...ee.values,fromAccountId:(null==a?void 0:a.recordId)||null,fromAccountRef:(null==a?void 0:a.reference)||"",fromAccountName:(null==a?void 0:a.name)||""})},readOnly:en,errorCheck:"fromAccountId",maxAccess:Q})}),(0,r.jsx)(h.ZP,{item:!0,xs:6,children:(0,r.jsxs)(h.ZP,{container:!0,spacing:2,children:[(0,r.jsx)(h.ZP,{item:!0,xs:12,children:(0,r.jsx)(C.Z,{endpointId:b.r.Currency.qry,filter:e=>2===e.currencyType,name:"fromCurrencyId",label:x.fromCurrency,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Currency Ref"},{key:"name",value:"Name"}],values:ee.values,required:!0,maxAccess:Q,onChange:(e,a)=>{var n;ee.setFieldValue("fromCurrencyId",(null==a?void 0:a.recordId)||null),ei("from",null==a?void 0:a.recordId,null===(n=ee.values)||void 0===n?void 0:n.date,ee.values.fromAmount)},readOnly:en,error:ee.touched.fromCurrencyId&&!!ee.errors.fromCurrencyId})}),(0,r.jsx)(h.ZP,{item:!0,xs:12,children:(0,r.jsx)(C.Z,{endpointId:b.r.Currency.qry,filter:e=>1===e.currencyType,name:"toCurrencyId",label:x.toCurrency,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Currency Ref"},{key:"name",value:"Name"}],values:ee.values,maxAccess:Q,readOnly:!0,error:ee.touched.toCurrencyId&&!!ee.errors.toCurrencyId})})]})}),(0,r.jsx)(h.ZP,{item:!0,xs:6,children:(0,r.jsxs)(h.ZP,{container:!0,spacing:2,children:[(0,r.jsx)(h.ZP,{item:!0,xs:12,children:(0,r.jsx)(k.Z,{name:"fromAmount",label:x.amount,value:ee.values.fromAmount,maxLength:15,decimalScale:2,onChange:e=>{var a;ee.handleChange(e),ef(null===(a=ee.values)||void 0===a?void 0:a.fromExRate,e.target.value)},onClear:()=>ee.setFieldValue("fromAmount",""),required:!0,readOnly:en,error:ee.touched.fromAmount&&!!ee.errors.fromAmount,maxAccess:Q})}),(0,r.jsx)(h.ZP,{item:!0,xs:12,children:(0,r.jsx)(k.Z,{name:"fromBaseAmount",label:x.baseAmount,value:ee.values.fromBaseAmount,onChange:ee.handleChange,onClear:()=>ee.setFieldValue("fromBaseAmount",null),readOnly:!0,required:!0,error:ee.touched.fromBaseAmount&&!!ee.errors.fromBaseAmount,maxAccess:Q})})]})}),(0,r.jsx)(h.ZP,{item:!0,xs:6,children:(0,r.jsx)(k.Z,{name:"fromExRate",label:x.rate,value:ee.values.fromExRate,maxLength:14,decimalScale:2,onChange:e=>{ee.setFieldValue("fromExRate",e.target.value||null),ef(e.target.value,ee.values.fromAmount)},readOnly:en,onClear:()=>ee.setFieldValue("fromExRate",""),required:!0,error:ee.touched.fromExRate&&!!ee.errors.fromExRate,maxAccess:Q})}),(0,r.jsx)(h.ZP,{item:!0,xs:12,children:(0,r.jsx)(C.Z,{neverPopulate:!0,endpointId:p.H.DescriptionTemplate.qry,name:"templateId",label:x.descriptionTemplate,valueField:"recordId",displayField:"name",values:ee.values,onChange:(e,a)=>{let n=ee.values.notes||"";(null==a?void 0:a.name)&&ee.setFieldValue("notes",""===n?a.name:"".concat(n,"\n").concat(a.name)),ee.setFieldValue("templateId",(null==a?void 0:a.recordId)||null)},readOnly:en,error:ee.touched.templateId&&!!ee.errors.templateId,maxAccess:Q})}),(0,r.jsx)(h.ZP,{item:!0,xs:12,children:(0,r.jsx)(j.Z,{name:"notes",type:"text",label:x.notes,value:ee.values.notes,rows:3,readOnly:en,maxAccess:Q,onChange:ee.handleChange,onClear:()=>ee.setFieldValue("notes","")})})]})})})})}var D=()=>{let{getRequest:e,postRequest:a}=(0,l.useContext)(d.$),{platformLabels:n}=(0,l.useContext)(v.l),{stack:h}=(0,f.zY)(),{functionId:g}=(0,x.F)();async function A(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{_startAt:n=0,_pageSize:r=50,params:l}=a;return{...await e({extension:p.H.BalanceTransfer.page,parameters:"_startAt=".concat(n,"&_pageSize=").concat(r,"&_params=").concat(l||"","&_functionId=").concat(g)}),_startAt:n}}async function F(a){let{filters:n,pagination:r}=a;return n.qry?await e({extension:p.H.BalanceTransfer.snapshot,parameters:"_filter=".concat(n.qry,"&_functionId=").concat(g)}):A({_startAt:r._startAt||0,params:null==n?void 0:n.params})}let C=(e=>{switch(e){case y.J.BalanceTransferPurchase:return c.i.BalanceTransferPurchase;case y.J.BalanceTransferSales:return c.i.BalanceTransferSales}})(parseInt(g)),{query:{data:b},labels:R,refetch:N,filterBy:w,invalidate:j,paginationParameters:Z,access:k}=(0,u.J)({queryFn:A,endpointId:p.H.BalanceTransfer.page,datasetId:c.i.BalanceTransferPurchase,DatasetIdAccess:C,filter:{filterFn:F,default:{functionId:g}}}),P=[{field:"reference",headerName:R.reference,flex:1},{field:"dtName",headerName:R.docType,flex:1},{field:"date",headerName:R.date,type:"date",flex:1},{field:"plantName",headerName:R.plant,flex:1},{field:"fromAccountRef",headerName:R.accountRef,flex:1},{field:"fromAccountName",headerName:R.accountName,flex:1},{field:"fromCurrencyName",headerName:R.fromCurrency,flex:1},{field:"toCurrencyName",headerName:R.toCurrency,flex:1},{field:"fromAmount",headerName:R.amount,flex:1,type:{field:"number",decimal:2}},{field:"fromBaseAmount",headerName:R.baseAmount,flex:1,type:{field:"number",decimal:2}},{field:"fromExRate",headerName:R.rate,flex:1,type:"number"},{field:"notes",headerName:R.notes,flex:1.5},{field:"statusName",headerName:R.status,flex:1}],{proxyAction:T}=(0,B.G)({functionId:g,action:V}),_=async e=>{await a({extension:p.H.BalanceTransfer.del,record:JSON.stringify(e)}),j(),t.ZP.success(n.Deleted)},S=e=>{switch(Number(e)){case y.J.BalanceTransferPurchase:return c.i.GLBalanceTransferPurchase;case y.J.BalanceTransferSales:return c.i.GLBalanceTransferSales}};function V(e){h({Component:q,props:{labels:R,recordId:e,access:k,functionId:g,resourceId:C,getGLResourceId:S},width:800,height:550,title:R.balanceTransfer})}return(0,r.jsxs)(s.R,{children:[(0,r.jsx)(i.g,{children:(0,r.jsx)(I.Z,{onAdd:()=>{T()},maxAccess:k,reportName:"FITFR",filterBy:w})}),(0,r.jsx)(m.Q,{children:(0,r.jsx)(o.Z,{columns:P,gridData:b,rowId:["recordId"],onEdit:e=>{V(null==e?void 0:e.recordId)},onDelete:_,isLoading:!1,pageSize:50,maxAccess:k,deleteConfirmationType:"strict",paginationParameters:Z,refetch:N,paginationType:"api"})})]})}},93736:function(e,a,n){"use strict";n.d(a,{K:function(){return l}});let r="RG.FI.asmx/",l={FiOpeningBalance:{gen:r+"genOBA"},FiAging:{qry:r+"FI404"},AccountSummary:{AccFI405b:r+"FI405b"},DocumentAging:{AgingFI406a:r+"FI406a",AgingFI406b:r+"FI406b"},TrialBalance:{FI402View:r+"FI402o",FI401o2:r+"FI401o2"}}},63165:function(e,a,n){"use strict";n.d(a,{F:function(){return t}});var r=n(5632),l=n(2784);let t=()=>{let e=(0,r.useRouter)(),[a,n]=(0,l.useState)(e.query);return a}},1685:function(e,a,n){"use strict";n.d(a,{m:function(){return r}});let r=e=>{let a=window.sessionStorage.getItem(e);return a?JSON.parse(a):null}},98345:function(e,a,n){"use strict";n.d(a,{H:function(){return I},G:function(){return v}});var r=n(45300),l=n(2784),t=n(96026),o=n(38449);n(26612);var d=n(65947),c=n(1685);let u=async(e,a,n)=>{try{let r=await e({extension:a,parameters:n});return a.includes("qry")?r:r.record}catch(e){return null}},s=(e,a,n,r)=>{let l=(e=JSON.parse(JSON.stringify(e))).record.controls,t=l.find(e=>"reference"===e.controlId);return t?t.accessLevel=(null==a?void 0:a.mandatory)?d.$7:d.rr:(null==a?void 0:a.mandatory)?l.push({sgId:0,resourceId:"",controlId:"".concat(r?r+".":"","reference"),accessLevel:(null==a?void 0:a.mandatory)?d.$7:d.rr}):(null==a?void 0:a.readOnly)?l.push({sgId:0,resourceId:"",controlId:"".concat(r?r+".":"","reference"),accessLevel:(null==a?void 0:a.readOnly)?d.rr:d.$7}):l=e.record.controls.filter(e=>"reference"!=e.controlId),n&&l.push({sgId:0,resourceId:"",controlId:"".concat(r?r+".":"","dtId"),accessLevel:d.$7}),{...e,record:{...e.record,controls:l}}},i=async(e,a,n)=>{let r,l;switch(n){case"dtId":let t=(0,c.m)("userData"),d=null==t?void 0:t.userId;l="_userId=".concat(d,"&_functionId=").concat(a),r=o.r.UserFunction.get;break;case"glbSysNumberRange":l="_recordId=".concat(a),r=o.r.SystemFunction.get;break;case"DocumentType":l="_dgId=".concat(a,"&_startAt=",0,"&_pageSize=",50),r=o.r.DocumentType.qry;break;case"DcTypNumberRange":l="_recordId=".concat(a),r=o.r.DocumentType.get;break;case"isExternal":l="_recordId=".concat(a),r=o.r.NumberRange.get;break;default:return null}return await u(e,r,l)},m=async function(e){let a,n,r,l,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,o=arguments.length>2?arguments[2]:void 0,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,c=!(arguments.length>4)||void 0===arguments[4]||arguments[4],u=arguments.length>5?arguments[5]:void 0,m=void 0===d&&t&&await i(e,t,"dtId"),f=null==m?void 0:m.dtId,v="",I=!0;if(m&&void 0===d||"nraId"===d){if(f){let n=await i(e,f,"DcTypNumberRange");a=null==n?void 0:n.nraId,I=!((null==n?void 0:n.activeStatus)<0),a||(v="Assign the document type to a number range")}if((!f||!I)&&c&&t){var x;let a=await i(e,t,"DocumentType");l=(null==a?void 0:null===(x=a.list)||void 0===x?void 0:x.filter(e=>(null==e?void 0:e.activeStatus)===1).length)>0}}if(("nraId"===d||void 0===d)&&t){if((!f||f)&&!a||a&&!I){let n=await i(e,t,"glbSysNumberRange");(a=null==n?void 0:n.nraId)&&l&&(l=!1),I=!0}v=a||l?"":"Assign the system Function to a number range"}d>0&&!a&&(a=d),a&&I?(n={readOnly:null==(r=await i(e,a,"isExternal"))||!r.external,mandatory:null!=r&&!!r.external},o&&(o=await s(o,n,l,u))):!a&&o&&(o=await s(o,n,l,u));let y=u?"".concat(u,".reference"):"reference";return{dtId:f,resetReference:null==n?void 0:n.readOnly,dcTypeRequired:l,reference:{fieldName:y,isEmpty:(null==r?void 0:r.external)!==void 0&&(null==r||!r.external)},errorMessage:v,maxAccess:o,selectNraId:d}};var f=n(65950);function v(e){let{functionId:a,action:n,hasDT:r}=e,{getRequest:o}=(0,l.useContext)(f.$),{stack:d}=(0,t.V)();return{proxyAction:async()=>{let e=await m(o,a,"",void 0,r);(null==e?void 0:e.errorMessage)?d({message:null==e?void 0:e.errorMessage}):await n()}}}function I(e){var a;let{functionId:n,access:o,hasDT:d,enabled:c=!0,objectName:u=""}=e,{getRequest:s}=(0,l.useContext)(f.$),{stack:i}=(0,t.V)(),[v,I]=(0,l.useState)(),x=async e=>{let a=await m(s,n,o,e,d,u);if(!a.errorMessage)return a;i({message:null==a?void 0:a.errorMessage})},y=(0,r.a)({retry:!1,staleTime:0,enabled:c,queryKey:[n,v,!!o,c],queryFn:v||"nraId"===v?()=>x(v):()=>x()});return{documentType:y.data,maxAccess:(null==y?void 0:null===(a=y.data)||void 0===a?void 0:a.maxAccess)||o,changeDT(e){I((null==e?void 0:e.nraId)||"nraId")}}}},16463:function(e,a,n){"use strict";n.d(a,{Z:function(){return C}});var r=n(52322),l=n(2784),t=n(49864),o=n(65950),d=n(27423),c=n(26612),u=n(71987),s=n(33625),i=n(62362),m=n(31389),f=n(8661),v=n(25870),I=n(69627),x=n(84100),y=n(19473),p=n(80983),h=n(38449),g=n(69387),A=n(93736),F=n(21326);function C(e){let{accountId:a,moduleId:n,window:C}=e,{getRequest:b}=(0,l.useContext)(o.$),{platformLabels:R}=(0,l.useContext)(y.l),[N,w]=(0,l.useState)([]);(0,F.Z)({title:R.AccountSummary,window:C});let{labels:j,access:Z}=(0,u.J)({datasetId:c.i.AccountSummary}),k=[{field:"days",headerName:j.days,flex:1,type:"number"}],[P,T]=(0,l.useState)(k),{formik:_}=(0,p.c)({maxAccess:Z,initialValues:{accountId:null,accountRef:"",accountName:"",agpId:null,moduleId:n}});async function S(){var e,a,r,l;let t;let o=2,d=[...k],c=await b({extension:h.r.Currency.qry,parameters:"_filter="});if(1==n?t=null==c?void 0:null===(e=c.list)||void 0===e?void 0:e.filter(e=>e.sale):2==n&&(t=null==c?void 0:null===(a=c.list)||void 0===a?void 0:a.filter(e=>e.purchase)),0==t.length)return;null==t||t.forEach((e,a)=>{d.push({field:"column".concat(a+1),headerName:e.reference,flex:1,type:"number"})}),T(d);let u=await b({extension:v.H.AgingLeg.qry,parameters:"_agpId=".concat(_.values.agpId)}),s=null==u?void 0:null===(r=u.list)||void 0===r?void 0:r.map(e=>{let a=Array(t.length+2).fill(0);return a[0]=null,a[1]=e.days,a}),i=(t||[]).map(e=>b({extension:A.K.AccountSummary.AccFI405b,parameters:"_agpId=".concat(_.values.agpId,"&_currencyId=").concat(e.recordId,"&_accountId=").concat(_.values.accountId)}).then(e=>({summaryRes:e})));(await Promise.all(i)).forEach(e=>{var a;let{summaryRes:n}=e;null==n||null===(a=n.list)||void 0===a||a.forEach(e=>{null==s||s.forEach(a=>{a[1]==e.seqDays&&(a[o]=e.amount)})}),o++});let m=Array(t.length+2).fill(null);for(let e=2;e<t.length+2;e++){let a=0;null==s||s.map(n=>{a+=Number(n[e]||0)}),m[e]=a}let f=s.filter(e=>null!==e[1]).map(e=>{let[a,n,...r]=e,l={days:n};return r.forEach((e,a)=>{l["column".concat(a+1)]=e.toFixed(2)}),l}),I={};for(let e=0;e<t.length;e++)I["column".concat(e+1)]=null!==(l=m[e+2].toFixed(2))&&void 0!==l?l:0;f.push(I),w({list:f})}return(0,l.useEffect)(()=>{!async function(){if(a&&n){var e,r,l;let n=await b({extension:v.H.Account.get,parameters:"_recordId=".concat(a)});_.setFieldValue("accountId",null==n?void 0:null===(e=n.record)||void 0===e?void 0:e.recordId),_.setFieldValue("accountRef",null==n?void 0:null===(r=n.record)||void 0===r?void 0:r.reference),_.setFieldValue("accountName",null==n?void 0:null===(l=n.record)||void 0===l?void 0:l.name)}}()},[]),(0,r.jsxs)(m.R,{children:[(0,r.jsx)(s.g,{children:(0,r.jsxs)(t.Z,{container:!0,spacing:2,p:2,children:[(0,r.jsx)(t.Z,{item:!0,xs:12,children:(0,r.jsx)(d.U,{endpointId:v.H.Account.snapshot,name:"accountId",label:j.account,valueField:"reference",displayField:"name",valueShow:"accountRef",secondValueShow:"accountName",form:_,readOnly:_.values.accountId&&_.values.moduleId,required:!0,maxAccess:Z,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],onChange:async(e,a)=>{_.setFieldValue("accountId",(null==a?void 0:a.recordId)||null),_.setFieldValue("accountName",(null==a?void 0:a.name)||""),_.setFieldValue("accountRef",(null==a?void 0:a.reference)||"")}})}),(0,r.jsx)(t.Z,{item:!0,xs:6,children:(0,r.jsx)(f.Z,{endpointId:v.H.AgingProfile.qry,parameters:"_startAt=0&_pageSize=1000&filter=",name:"agpId",label:j.agingProfile,values:_.values,valueField:"recordId",displayField:"name",maxAccess:Z,required:!0,onChange:(e,a)=>{_.setFieldValue("agpId",(null==a?void 0:a.recordId)||null),(null==a?void 0:a.recordId)||w({list:[]})}})}),(0,r.jsx)(t.Z,{item:!0,xs:5,children:(0,r.jsx)(f.Z,{datasetId:x.v.FI_AGING_MODULE,label:j.module,name:"moduleId",values:_.values,valueField:"key",displayField:"value",maxAccess:Z,required:!0,readOnly:_.values.moduleId,onChange:(e,a)=>{_.setFieldValue("moduleId",(null==a?void 0:a.key)||null)}})}),(0,r.jsx)(t.Z,{item:!0,xs:1,children:(0,r.jsx)(I.Z,{onClick:S,image:"preview.png",disabled:!_.values.agpId||!_.values.moduleId||!_.values.accountId,tooltipText:R.Preview})})]})}),(0,r.jsx)(i.Q,{children:(0,r.jsx)(g.Z,{columns:P,gridData:N,isLoading:!1,pagination:!1})})]})}C.width=1e3,C.height=500}},function(e){e.O(0,[92515,2494,36908,49774,92888,40179],function(){return e(e.s=64224)}),_N_E=e.O()}]);