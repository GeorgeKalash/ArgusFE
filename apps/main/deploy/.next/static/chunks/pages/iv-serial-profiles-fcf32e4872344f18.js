(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[94010],{78314:function(e,a,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/iv-serial-profiles",function(){return n(32111)}])},32111:function(e,a,n){"use strict";n.r(a),n.d(a,{default:function(){return A}});var s=n(52322),t=n(2784),r=n(62202),o=n(69387),l=n(65950),i=n(71987),c=n(26612),d=n(31389),u=n(33625),m=n(62362),p=n(61802),b=n(19473),f=n(27723),v=n(65215),x=n(29326),h=n(9522),_=n(60218),I=n(48601),C=n(82737),g=n(5088),y=n(80983);function S(e){let{labels:a,maxAccess:n,store:o,setStore:u}=e,{recordId:p}=o,{platformLabels:f}=(0,t.useContext)(b.l),{getRequest:x,postRequest:h}=(0,t.useContext)(l.$),S=(0,i.E)({endpointId:v.$.SerialsProfile.page}),{formik:P}=(0,y.c)({maxAccess:n,initialValues:{recordId:p,name:"",reference:""},validateOnChange:!1,validationSchema:I.Ry({reference:I.Z_().required(),name:I.Z_().required()}),onSubmit:async e=>{await h({extension:v.$.SerialsProfile.set,record:JSON.stringify(e)}).then(a=>{r.ZP.success(e.recordId?f.Edited:f.Added),e.recordId||(P.setFieldValue("recordId",a.recordId),u(e=>({...e,recordId:a.recordId}))),S()})}}),T=!!P.values.recordId;return(0,t.useEffect)(()=>{!async function(){if(p){let e=await x({extension:v.$.SerialsProfile.get,parameters:"_recordId=".concat(p)});P.setValues(e.record)}}()},[]),(0,s.jsx)(C.Z,{resourceId:c.i.SerialNumber,form:P,maxAccess:n,editMode:T,children:(0,s.jsx)(d.R,{children:(0,s.jsx)(m.Q,{children:(0,s.jsxs)(_.ZP,{container:!0,spacing:2,children:[(0,s.jsx)(_.ZP,{item:!0,xs:12,children:(0,s.jsx)(g.Z,{name:"reference",label:a.reference,value:P.values.reference,required:!0,maxAccess:n,maxLength:"10",onChange:P.handleChange,onClear:()=>P.setFieldValue("reference",""),error:P.touched.reference&&!!P.errors.reference})}),(0,s.jsx)(_.ZP,{item:!0,xs:12,children:(0,s.jsx)(g.Z,{name:"name",label:a.name,value:P.values.name,required:!0,maxAccess:n,maxLength:"20",onChange:P.handleChange,onClear:()=>P.setFieldValue("name",""),error:P.touched.name&&!!P.errors.name})})]})})})})}var P=n(76399),T=n(84100),N=n(54074),j=e=>{let{store:a,maxAccess:n,labels:o}=e,{recordId:i}=a,{getRequest:c,postRequest:d}=(0,t.useContext)(l.$),{platformLabels:u}=(0,t.useContext)(b.l),m=e=>I.nK().test(function(a){let{position:n,str:s,sectionType:t,size:r,oper:o}=this.parent;return"oper"===e?1!=t||!!a:"position"===e&&n?!(Number(n)>20)&&null!==a:!(n||s||t||r||o)||null!=a}),p=I.IX().of(I.Ry({position:m("position"),str:m(),sectionType:m(),size:m(),oper:m("oper")})),{formik:f}=(0,y.c)({validateOnChange:!0,maxAccess:n,initialValues:{spfId:i,components:[{id:1,spfId:i,sectionType:null,position:null,seqNo:1}]},validationSchema:I.Ry({components:p}),onSubmit:async e=>{let a=null==e?void 0:e.components.map((e,a)=>({...e,id:a+1,seqNo:a+1,spfId:i}));await d({extension:v.$.SerialsProfile.set2,record:JSON.stringify({spfId:i,components:a})}).then(()=>{h(),r.ZP.success(u.Edited)})}}),x=!!i;async function h(){var e;let a=await c({extension:v.$.SerialsProfileSequences.qry,parameters:"_spfId=".concat(i)}),n=(null==a?void 0:null===(e=a.list)||void 0===e?void 0:e.length)!==0?await Promise.all(a.list.map(async(e,a)=>({...e,id:a+1,oper:e.oper||0}))):f.initialValues.components;f.setValues({spfId:i,components:n})}(0,t.useEffect)(()=>{!async function(){i&&await h()}()},[]);let _=[{component:"numberfield",label:o.position,name:"position",props:{decimalScale:0,allowNegative:!1}},{component:"resourcecombobox",name:"sectionType",label:o.sectionType,props:{datasetId:T.v.SERIAL_PROFILE_SECTION,valueField:"key",displayField:"value",mapping:[{from:"key",to:"sectionType"},{from:"value",to:"sectionTypeName"}]}},{component:"textfield",label:o.str,name:"str",props:{maxLength:20}},{component:"resourcecombobox",name:"oper",label:o.oper,props:{datasetId:T.v.SERIAL_PROFILE_OPERATOR,valueField:"key",displayField:"value",mapping:[{from:"key",to:"oper"},{from:"value",to:"operatorName"}]},propsReducer(e){let{row:a,props:n}=e;return{...n,readOnly:1!==Number(a.sectionType)}}},{component:"numberfield",label:o.size,name:"size",props:{maxLength:4,decimalScale:0}}];return(0,s.jsx)(N.Z,{onSave:f.handleSubmit,maxAccess:n,editMode:x,isParentWindow:!1,children:(0,s.jsx)(P._,{onChange:e=>f.setFieldValue("components",e),value:f.values.components,error:f.errors.components,columns:_,maxAccess:n,name:"components"})})};function Z(e){let{labels:a,maxAccess:n,recordId:r}=e,[o,l]=(0,t.useState)(0),[i,c]=(0,t.useState)({recordId:r||null}),d=[{label:a.SerialNumbersProfiles},{label:a.SerialProfileSequences,disabled:!i.recordId}];return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(h.Y,{tabs:d,activeTab:o,setActiveTab:l,maxAccess:n}),(0,s.jsx)(x.Z,{index:0,value:o,maxAccess:n,children:(0,s.jsx)(S,{labels:a,maxAccess:n,setStore:c,store:i})}),(0,s.jsx)(x.Z,{index:1,value:o,maxAccess:n,children:(0,s.jsx)(j,{labels:a,maxAccess:n,store:i})})]})}var A=()=>{let{getRequest:e,postRequest:a}=(0,t.useContext)(l.$),{platformLabels:n}=(0,t.useContext)(b.l),{stack:x}=(0,p.zY)();async function h(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{_startAt:n=0,_pageSize:s=50}=a;return{...await e({extension:v.$.SerialsProfile.page,parameters:"_startAt=".concat(n,"&_pageSize=").concat(s,"&_filter=")}),_startAt:n}}let{query:{data:_},refetch:I,labels:C,access:g,paginationParameters:y,invalidate:S}=(0,i.J)({queryFn:h,endpointId:v.$.SerialsProfile.page,datasetId:c.i.SerialNumber}),P=[{field:"reference",headerName:C.reference,flex:1},{field:"name",headerName:C.name,flex:1}];function T(e){x({Component:Z,props:{labels:C,recordId:e,maxAccess:g},width:700,height:500,title:C.SerialNumbersProfiles})}let N=async e=>{await a({extension:v.$.SerialsProfile.del,record:JSON.stringify(e)}),r.ZP.success(n.Deleted),S()};return(0,s.jsxs)(d.R,{children:[(0,s.jsx)(u.g,{children:(0,s.jsx)(f.Z,{onAdd:()=>{T()},maxAccess:g})}),(0,s.jsx)(m.Q,{children:(0,s.jsx)(o.Z,{name:"table",columns:P,gridData:_,rowId:["recordId"],onEdit:e=>{T(null==e?void 0:e.recordId)},onDelete:N,isLoading:!1,pageSize:50,paginationType:"api",paginationParameters:y,refetch:I,maxAccess:g})})]})}},29326:function(e,a,n){"use strict";var s=n(52322);n(2784);var t=n(23925),r=n(13980),o=n.n(r),l=n(95291),i=n.n(l),c=n(65947);let d=e=>{var a,n,r;let{children:o,value:l,index:d,maxAccess:u,...m}=e,p="".concat(e.name||"tab",".").concat(d),{accessLevel:b}=null!==(r=(null!==(n=null==u?void 0:null===(a=u.record)||void 0===a?void 0:a.controls)&&void 0!==n?n:[]).find(e=>e.controlId===p))&&void 0!==r?r:{accessLevel:0};if(b===c.A1)return null;let f=l===d;return(0,s.jsx)(t.Z,{role:"tabpanel",hidden:!f,id:"simple-tabpanel-".concat(d),"aria-labelledby":"simple-tab-".concat(d),className:"".concat(i().tabPanel," ").concat(f?i().active:i().hidden),...m,children:o})};d.propTypes={children:o().node,index:o().number.isRequired,value:o().number.isRequired},a.Z=d},9522:function(e,a,n){"use strict";n.d(a,{Y:function(){return m}});var s=n(52322),t=n(23925),r=n(54582),o=n(68696),l=n(44258),i=n(2784),c=n(99266),d=n(52614),u=n.n(d);let m=e=>{var a,n,d,m,p;let{tabs:b,activeTab:f,setActiveTab:v,maxAccess:x,name:h="tab"}=e,_=(null==x?void 0:null===(n=x.record)||void 0===n?void 0:null===(a=n.controls)||void 0===a?void 0:a.filter(e=>{var a;return 4===e.accessLevel&&(null===(a=e.controlId)||void 0===a?void 0:a.startsWith("".concat(h,".")))}).map(e=>e.controlId.split(".")[1]))||[],I=null==b?void 0:null===(d=b.map((e,a)=>({...e,id:a})))||void 0===d?void 0:d.filter((e,a)=>!_.includes(String(a))),C=null===(m=I[f])||void 0===m?void 0:m.id,g=null===(p=I[f])||void 0===p?void 0:p.disabled;return(0,i.useEffect)(()=>{C>=0&&!g&&f!=C&&v(C)},[]),(0,s.jsx)(t.Z,{className:u().tabsContainer,children:(0,s.jsx)(t.Z,{className:u().tabsWrapper,children:(0,s.jsx)(r.Z,{value:f,onChange:(e,a)=>v(a),variant:"scrollable",scrollButtons:I.length>3?"auto":"off","aria-label":"scrollable tabs",classes:{indicator:u().tabsIndicator},className:u().tabs,children:null==I?void 0:I.map(e=>(0,s.jsx)(o.Z,{value:e.id,disabled:null==e?void 0:e.disabled,className:"".concat(u().tabName," ").concat(e.disabled?u().tabDisabled:""),classes:{root:u().tabRoot,selected:u().selectedTab},label:(0,s.jsxs)(t.Z,{display:"flex",alignItems:"center",children:[(0,s.jsx)("span",{children:e.label}),e.id===f&&(null==e?void 0:e.onRefetch)&&(0,s.jsx)(l.Z,{size:"small",className:u().refreshButton,onClick:a=>{a.stopPropagation(),e.onRefetch()},children:(0,s.jsx)(c.Z,{className:u().refreshIcon})})]})},e.id))})})})}},95291:function(e){e.exports={tabPanel:"CustomTabPanel_tabPanel__80Dfu",active:"CustomTabPanel_active___6Uvb",hidden:"CustomTabPanel_hidden__y9566"}},52614:function(e){e.exports={customTabPanel:"CustomTabs_customTabPanel__Ztocv",hidden:"CustomTabs_hidden__lZpM7",tabsContainer:"CustomTabs_tabsContainer__28Syi",tabsWrapper:"CustomTabs_tabsWrapper__mlxxj",tabs:"CustomTabs_tabs__25pli",tabName:"CustomTabs_tabName__XzMCn",tabRoot:"CustomTabs_tabRoot__WVR1E",tabDisabled:"CustomTabs_tabDisabled__VauYR",selectedTab:"CustomTabs_selectedTab__sZzwF",tabsIndicator:"CustomTabs_tabsIndicator__89Lek",refreshButton:"CustomTabs_refreshButton__P2mzl",refreshIcon:"CustomTabs_refreshIcon__ADVWF"}}},function(e){e.O(0,[49774,92888,40179],function(){return e(e.s=78314)}),_N_E=e.O()}]);