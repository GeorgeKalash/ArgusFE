(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[64453],{8783:function(e,a,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/hr-earned-leaves",function(){return r(34822)}])},34822:function(e,a,r){"use strict";r.r(a),r.d(a,{default:function(){return q}});var t=r(52322),n=r(2784),d=r(62202),l=r(69387),s=r(27723),o=r(65950),i=r(71987),c=r(26612),u=r(31389),v=r(33625),m=r(62362),g=r(61802),p=r(19473),f=r(50496),y=r(60218),I=r(48601),h=r(82737),x=r(5088),L=r(80983),w=r(8661),E=r(7121),A=r(38449),R=r(98345),N=r(39812),S=r(89330),_=r(69627);function b(e){var a;let{labels:r,access:s,recordId:g}=e,{getRequest:b,postRequest:q}=(0,n.useContext)(o.$),{platformLabels:k}=(0,n.useContext)(p.l),O=(0,i.E)({endpointId:f.U.EarnedLeave.page}),{documentType:j,maxAccess:D,changeDT:C}=(0,R.H)({functionId:E.J.EarnedLeaves,access:s}),{formik:P}=(0,L.c)({documentType:{key:"dtId",value:null==j?void 0:j.dtId},initialValues:{recordId:g,dtId:null,reference:"",date:new Date,lsId:null,status:1,items:[]},maxAccess:D,validationSchema:I.Ry({date:I.hT().required(),lsId:I.Rx().required()}),onSubmit:async e=>{let a={...e,date:(0,N.ku)(e.date)};delete a.items;let r=e.items.map((e,a)=>({...e,seqNo:a+1})),t=await q({extension:f.U.EarnedLeave.set2,record:JSON.stringify({header:a,items:r})});d.ZP.success(e.recordId?k.Edited:k.Added),U(t.recordId),O()}}),F=!!P.values.recordId,T=3===P.values.status,Z=P.values.items.length>0,U=async e=>{var a,r,t,n,d,l,s,o;let i=await b({extension:f.U.EarnedLeave.get2,parameters:"_recordId=".concat(e)});P.setFieldValue("items",[]),P.setValues({recordId:null==i?void 0:null===(r=i.record)||void 0===r?void 0:null===(a=r.header)||void 0===a?void 0:a.recordId,...null==i?void 0:null===(t=i.record)||void 0===t?void 0:t.header,date:(null==i?void 0:null===(d=i.record)||void 0===d?void 0:null===(n=d.header)||void 0===n?void 0:n.date)?(0,N.a1)(null==i?void 0:null===(l=i.record)||void 0===l?void 0:l.header.date):null,items:(null==i?void 0:null===(o=i.record)||void 0===o?void 0:null===(s=o.items)||void 0===s?void 0:s.map((e,a)=>({id:a+1,...e})))||[]})};(0,n.useEffect)(()=>{g&&U(g)},[]);let B=async()=>{let e=await q({extension:f.U.EarnedLeave.post,record:JSON.stringify(P.values)});d.ZP.success(k.Posted),O(),U(null==e?void 0:e.recordId)},J=[{field:"employeeName",headerName:r.employee,flex:1},{field:"effectiveDate",headerName:r.days,type:"date",flex:1}],V=async()=>{if(!P.values.lsId&&!P.values.date)return;let e=await b({extension:f.U.EarnedLeave.preview,parameters:"_lsId=".concat(P.values.lsId||0,"&_asOfDate=").concat((0,N.Uf)(P.values.date))});P.setFieldValue("items",(null==e?void 0:e.list.map((e,a)=>({id:a+1,...e})))||[])},$=[{key:"Unlocked",condition:!T,onClick:B,disabled:!F},{key:"Locked",condition:T,onClick:"onUnpostConfirmation",disabled:!0}];return(0,t.jsx)(h.Z,{resourceId:c.i.EarnedLeave,functionId:E.J.EarnedLeaves,form:P,maxAccess:D,editMode:F,actions:$,disabledSubmit:T,children:(0,t.jsxs)(u.R,{children:[(0,t.jsx)(v.g,{children:(0,t.jsxs)(y.ZP,{container:!0,spacing:2,children:[(0,t.jsx)(y.ZP,{item:!0,xs:6,children:(0,t.jsx)(w.Z,{endpointId:A.r.DocumentType.qry,parameters:"_startAt=0&_pageSize=1000&_dgId=".concat(E.J.EarnedLeaves),name:"dtId",label:r.documentType,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],readOnly:F,valueField:"recordId",displayField:["reference","name"],values:P.values,maxAccess:D,onChange:async(e,a)=>{await C(a),P.setFieldValue("dtId",(null==a?void 0:a.recordId)||null)},error:P.touched.dtId&&!!P.errors.dtId})}),(0,t.jsx)(y.ZP,{item:!0,xs:6,children:(0,t.jsx)(S.Z,{name:"date",required:!0,label:r.date,value:P.values.date,onChange:P.setFieldValue,maxAccess:D,readOnly:T||Z,onClear:()=>P.setFieldValue("date",null),error:P.touched.date&&!!P.errors.date})}),(0,t.jsx)(y.ZP,{item:!0,xs:6,children:(0,t.jsx)(x.Z,{name:"reference",label:r.reference,value:null==P?void 0:null===(a=P.values)||void 0===a?void 0:a.reference,maxAccess:!F&&D,readOnly:F,onChange:P.handleChange,onClear:()=>P.setFieldValue("reference",""),error:P.touched.reference&&!!P.errors.reference})}),(0,t.jsx)(y.ZP,{item:!0,xs:6,children:(0,t.jsx)(w.Z,{endpointId:f.U.LeaveScheduleFilters.qry,name:"lsId",label:r.leaveSchedule,values:P.values,valueField:"recordId",displayField:["reference","name"],required:!0,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],readOnly:T||Z,maxAccess:D,onChange:(e,a)=>{P.setFieldValue("lsId",(null==a?void 0:a.recordId)||null)},error:P.touched.lsId&&!!P.errors.lsId})}),(0,t.jsx)(y.ZP,{item:!0,xs:4,children:(0,t.jsx)(_.Z,{onClick:V,image:"preview.png",tooltipText:k.Preview,disabled:T})})]})}),(0,t.jsx)(m.Q,{children:(0,t.jsx)(l.Z,{name:"earnedLeaves",columns:J,gridData:{list:P.values.items},rowId:["recordId"],pagination:!1,maxAccess:D})})]})})}var q=()=>{let{getRequest:e,postRequest:a}=(0,n.useContext)(o.$),{platformLabels:r}=(0,n.useContext)(p.l),{stack:y}=(0,g.zY)();async function I(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{_startAt:r=0,_pageSize:t=50}=a;return{...await e({extension:f.U.EarnedLeave.page,parameters:"_startAt=".concat(r,"&_pageSize=").concat(t,"&filter=")}),_startAt:r}}let{query:{data:h},labels:x,paginationParameters:L,refetch:w,access:A,invalidate:N}=(0,i.J)({queryFn:I,endpointId:f.U.EarnedLeave.page,datasetId:c.i.EarnedLeave}),S=[{field:"dtName",headerName:x.documentType,flex:1},{field:"reference",headerName:x.reference,flex:1},{field:"date",headerName:x.date,flex:1,type:"date"},{field:"lsName",headerName:x.leaveSchedule,flex:1},{field:"statusName",headerName:x.status,flex:1}],{proxyAction:_}=(0,R.G)({functionId:E.J.EarnedLeaves,action:k}),q=async()=>{_()};function k(e){y({Component:b,props:{labels:x,recordId:e,access:A},width:700,height:500,title:x.EarnedLeaves})}let O=async e=>{await a({extension:f.U.EarnedLeave.del,record:JSON.stringify(e)}),N(),d.ZP.success(r.Deleted)};return(0,t.jsxs)(u.R,{children:[(0,t.jsx)(v.g,{children:(0,t.jsx)(s.Z,{onAdd:q,maxAccess:A})}),(0,t.jsx)(m.Q,{children:(0,t.jsx)(l.Z,{name:"earnedLeaves",columns:S,gridData:h,rowId:["recordId"],onEdit:e=>{k(null==e?void 0:e.recordId)},onDelete:O,pageSize:50,paginationType:"api",paginationParameters:L,refetch:w,maxAccess:A})})]})}},50496:function(e,a,r){"use strict";r.d(a,{U:function(){return n}});let t="LM.asmx/",n={IndemnityAccuralsFilters:{qry:t+"qryLT"},LeaveScheduleFilters:{qry:t+"qryLS",page:t+"pageLS",set:t+"setLS",get:t+"getLS",del:t+"delLS"},OpeningBalances:{page:t+"pageOBA",set:t+"setOBA",get:t+"getOBA",del:t+"delOBA",qry:t+"qryOBA"},BalanceAdjustment:{page:t+"pageBA",set:t+"setBA",get:t+"getBA",del:t+"delBA",snapshot:t+"snapshotBA"},EarnedLeave:{page:t+"pageEL",set2:t+"set2EL",get2:t+"get2EL",del:t+"delEL",preview:t+"previewEL",post:t+"postEL"},LeavePeriod:{qry:t+"qryLP",del:t+"delLP",get:t+"getLP",set:t+"setLP"},LeaveRequest:{page:t+"pageLR",qry:t+"qryLR",set:t+"setLR",get:t+"getLR",del:t+"delLR",snapshot:t+"snapshotLR",close:t+"closeLR",reopen:t+"reopenLR",set2:t+"set2LR",get2:t+"get2LR"},LeaveReturn:{page:t+"pageRE",set:t+"setRE",get:t+"getRE",del:t+"delRE",snapshot:t+"snapshotRE",close:t+"closeRE",reopen:t+"reopenRE"},PreviewDays:{preview:t+"previewLD"},Leaves:{qry:t+"qryELB"}}},1685:function(e,a,r){"use strict";r.d(a,{m:function(){return t}});let t=e=>{let a=window.sessionStorage.getItem(e);return a?JSON.parse(a):null}},98345:function(e,a,r){"use strict";r.d(a,{H:function(){return p},G:function(){return g}});var t=r(45300),n=r(2784),d=r(96026),l=r(38449);r(26612);var s=r(65947),o=r(1685);let i=async(e,a,r)=>{try{let t=await e({extension:a,parameters:r});return a.includes("qry")?t:t.record}catch(e){return null}},c=(e,a,r,t)=>{let n=(e=JSON.parse(JSON.stringify(e))).record.controls,d=n.find(e=>"reference"===e.controlId);return d?d.accessLevel=(null==a?void 0:a.mandatory)?s.$7:s.rr:(null==a?void 0:a.mandatory)?n.push({sgId:0,resourceId:"",controlId:"".concat(t?t+".":"","reference"),accessLevel:(null==a?void 0:a.mandatory)?s.$7:s.rr}):(null==a?void 0:a.readOnly)?n.push({sgId:0,resourceId:"",controlId:"".concat(t?t+".":"","reference"),accessLevel:(null==a?void 0:a.readOnly)?s.rr:s.$7}):n=e.record.controls.filter(e=>"reference"!=e.controlId),r&&n.push({sgId:0,resourceId:"",controlId:"".concat(t?t+".":"","dtId"),accessLevel:s.$7}),{...e,record:{...e.record,controls:n}}},u=async(e,a,r)=>{let t,n;switch(r){case"dtId":let d=(0,o.m)("userData"),s=null==d?void 0:d.userId;n="_userId=".concat(s,"&_functionId=").concat(a),t=l.r.UserFunction.get;break;case"glbSysNumberRange":n="_recordId=".concat(a),t=l.r.SystemFunction.get;break;case"DocumentType":n="_dgId=".concat(a,"&_startAt=",0,"&_pageSize=",50),t=l.r.DocumentType.qry;break;case"DcTypNumberRange":n="_recordId=".concat(a),t=l.r.DocumentType.get;break;case"isExternal":n="_recordId=".concat(a),t=l.r.NumberRange.get;break;default:return null}return await i(e,t,n)},v=async function(e){let a,r,t,n,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,l=arguments.length>2?arguments[2]:void 0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,o=!(arguments.length>4)||void 0===arguments[4]||arguments[4],i=arguments.length>5?arguments[5]:void 0,v=void 0===s&&d&&await u(e,d,"dtId"),m=null==v?void 0:v.dtId,g="",p=!0;if(v&&void 0===s||"nraId"===s){if(m){let r=await u(e,m,"DcTypNumberRange");a=null==r?void 0:r.nraId,p=!((null==r?void 0:r.activeStatus)<0),a||(g="Assign the document type to a number range")}if((!m||!p)&&o&&d){var f;let a=await u(e,d,"DocumentType");n=(null==a?void 0:null===(f=a.list)||void 0===f?void 0:f.filter(e=>(null==e?void 0:e.activeStatus)===1).length)>0}}if(("nraId"===s||void 0===s)&&d){if((!m||m)&&!a||a&&!p){let r=await u(e,d,"glbSysNumberRange");(a=null==r?void 0:r.nraId)&&n&&(n=!1),p=!0}g=a||n?"":"Assign the system Function to a number range"}s>0&&!a&&(a=s),a&&p?(r={readOnly:null==(t=await u(e,a,"isExternal"))||!t.external,mandatory:null!=t&&!!t.external},l&&(l=await c(l,r,n,i))):!a&&l&&(l=await c(l,r,n,i));let y=i?"".concat(i,".reference"):"reference";return{dtId:m,resetReference:null==r?void 0:r.readOnly,dcTypeRequired:n,reference:{fieldName:y,isEmpty:(null==t?void 0:t.external)!==void 0&&(null==t||!t.external)},errorMessage:g,maxAccess:l,selectNraId:s}};var m=r(65950);function g(e){let{functionId:a,action:r,hasDT:t}=e,{getRequest:l}=(0,n.useContext)(m.$),{stack:s}=(0,d.V)();return{proxyAction:async()=>{let e=await v(l,a,"",void 0,t);(null==e?void 0:e.errorMessage)?s({message:null==e?void 0:e.errorMessage}):await r()}}}function p(e){var a;let{functionId:r,access:l,hasDT:s,enabled:o=!0,objectName:i=""}=e,{getRequest:c}=(0,n.useContext)(m.$),{stack:u}=(0,d.V)(),[g,p]=(0,n.useState)(),f=async e=>{let a=await v(c,r,l,e,s,i);if(!a.errorMessage)return a;u({message:null==a?void 0:a.errorMessage})},y=(0,t.a)({retry:!1,staleTime:0,enabled:o,queryKey:[r,g,!!l,o],queryFn:g||"nraId"===g?()=>f(g):()=>f()});return{documentType:y.data,maxAccess:(null==y?void 0:null===(a=y.data)||void 0===a?void 0:a.maxAccess)||l,changeDT(e){p((null==e?void 0:e.nraId)||"nraId")}}}}},function(e){e.O(0,[49774,92888,40179],function(){return e(e.s=8783)}),_N_E=e.O()}]);