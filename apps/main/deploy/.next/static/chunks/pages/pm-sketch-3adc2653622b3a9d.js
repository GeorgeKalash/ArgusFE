(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[67550],{74536:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/pm-sketch",function(){return r(3032)}])},3032:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return x}});var n=r(52322),a=r(2784),l=r(62202),d=r(69387),o=r(65950),i=r(71987),c=r(26612),s=r(31389),u=r(33625),f=r(62362),m=r(61802),p=r(19473),y=r(63518),v=r(7121),g=r(98345),h=r(44129),N=r(36908),x=()=>{let{getRequest:e,postRequest:t}=(0,a.useContext)(o.$),{platformLabels:r}=(0,a.useContext)(p.l),{stack:x}=(0,m.zY)();async function I(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{_startAt:r=0,_pageSize:n=50,params:a}=t;return{...await e({extension:y.z.Sketch.page,parameters:"_startAt=".concat(r,"&_pageSize=").concat(n,"&_params=").concat(a||"")}),_startAt:r}}let{query:{data:w},labels:_,paginationParameters:S,refetch:b,access:k,invalidate:T,filterBy:A}=(0,i.J)({queryFn:I,endpointId:y.z.Sketch.page,datasetId:c.i.Sketch,filter:{filterFn:C}});async function C(t){let{filters:r,pagination:n}=t;return r.qry?await e({extension:y.z.Sketch.snapshot,parameters:"_filter=".concat(r.qry)}):I({_startAt:n._startAt||0,params:null==r?void 0:r.params})}let D=[{field:"dtName",headerName:_.documentType,flex:1},{field:"reference",headerName:_.reference,flex:1},{field:"date",headerName:_.date,flex:1,type:"date"},{field:"sourceName",headerName:_.sketchSource,flex:1},{field:"designerName",headerName:_.designer,flex:1},{field:"itemGroupName",headerName:_.itemGroup,flex:1},{field:"collectionName",headerName:_.collection,flex:1},{field:"metalPurity",headerName:_.purity,type:"number",flex:1},{field:"productionClassName",headerName:_.productionClass,flex:1},{field:"productionStandardRef",headerName:_.standardClass,flex:1},{field:"rsName",headerName:_.releaseStatus,flex:1},{field:"wipName",headerName:_.wip,flex:1},{field:"statusName",headerName:_.status,flex:1}],{proxyAction:O}=(0,g.G)({functionId:v.J.Sketch,action:q}),E=async()=>{await O()};function q(e){x({Component:h.Z,props:{recordId:e,invalidate:T}})}let z=async e=>{await t({extension:y.z.Sketch.del,record:JSON.stringify(e)}),T(),l.ZP.success(r.Deleted)};return(0,n.jsxs)(s.R,{children:[(0,n.jsx)(u.g,{children:(0,n.jsx)(N.Z,{labels:_,maxAccess:k,filterBy:A,onAdd:E,reportName:"PMSKH"})}),(0,n.jsx)(f.Q,{children:(0,n.jsx)(d.Z,{columns:D,gridData:w,rowId:["recordId"],onEdit:e=>{q(null==e?void 0:e.recordId)},onDelete:z,isLoading:!1,deleteConfirmationType:"strict",pageSize:50,paginationType:"api",paginationParameters:S,refetch:b,maxAccess:k})})]})}},1685:function(e,t,r){"use strict";r.d(t,{m:function(){return n}});let n=e=>{let t=window.sessionStorage.getItem(e);return t?JSON.parse(t):null}},98345:function(e,t,r){"use strict";r.d(t,{H:function(){return y},G:function(){return p}});var n=r(45300),a=r(2784),l=r(96026),d=r(38449);r(26612);var o=r(65947),i=r(1685);let c=async(e,t,r)=>{try{let n=await e({extension:t,parameters:r});return t.includes("qry")?n:n.record}catch(e){return null}},s=(e,t,r,n)=>{let a=(e=JSON.parse(JSON.stringify(e))).record.controls,l=a.find(e=>"reference"===e.controlId);return l?l.accessLevel=(null==t?void 0:t.mandatory)?o.$7:o.rr:(null==t?void 0:t.mandatory)?a.push({sgId:0,resourceId:"",controlId:"".concat(n?n+".":"","reference"),accessLevel:(null==t?void 0:t.mandatory)?o.$7:o.rr}):(null==t?void 0:t.readOnly)?a.push({sgId:0,resourceId:"",controlId:"".concat(n?n+".":"","reference"),accessLevel:(null==t?void 0:t.readOnly)?o.rr:o.$7}):a=e.record.controls.filter(e=>"reference"!=e.controlId),r&&a.push({sgId:0,resourceId:"",controlId:"".concat(n?n+".":"","dtId"),accessLevel:o.$7}),{...e,record:{...e.record,controls:a}}},u=async(e,t,r)=>{let n,a;switch(r){case"dtId":let l=(0,i.m)("userData"),o=null==l?void 0:l.userId;a="_userId=".concat(o,"&_functionId=").concat(t),n=d.r.UserFunction.get;break;case"glbSysNumberRange":a="_recordId=".concat(t),n=d.r.SystemFunction.get;break;case"DocumentType":a="_dgId=".concat(t,"&_startAt=",0,"&_pageSize=",50),n=d.r.DocumentType.qry;break;case"DcTypNumberRange":a="_recordId=".concat(t),n=d.r.DocumentType.get;break;case"isExternal":a="_recordId=".concat(t),n=d.r.NumberRange.get;break;default:return null}return await c(e,n,a)},f=async function(e){let t,r,n,a,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,d=arguments.length>2?arguments[2]:void 0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,i=!(arguments.length>4)||void 0===arguments[4]||arguments[4],c=arguments.length>5?arguments[5]:void 0,f=void 0===o&&l&&await u(e,l,"dtId"),m=null==f?void 0:f.dtId,p="",y=!0;if(f&&void 0===o||"nraId"===o){if(m){let r=await u(e,m,"DcTypNumberRange");t=null==r?void 0:r.nraId,y=!((null==r?void 0:r.activeStatus)<0),t||(p="Assign the document type to a number range")}if((!m||!y)&&i&&l){var v;let t=await u(e,l,"DocumentType");a=(null==t?void 0:null===(v=t.list)||void 0===v?void 0:v.filter(e=>(null==e?void 0:e.activeStatus)===1).length)>0}}if(("nraId"===o||void 0===o)&&l){if((!m||m)&&!t||t&&!y){let r=await u(e,l,"glbSysNumberRange");(t=null==r?void 0:r.nraId)&&a&&(a=!1),y=!0}p=t||a?"":"Assign the system Function to a number range"}o>0&&!t&&(t=o),t&&y?(r={readOnly:null==(n=await u(e,t,"isExternal"))||!n.external,mandatory:null!=n&&!!n.external},d&&(d=await s(d,r,a,c))):!t&&d&&(d=await s(d,r,a,c));let g=c?"".concat(c,".reference"):"reference";return{dtId:m,resetReference:null==r?void 0:r.readOnly,dcTypeRequired:a,reference:{fieldName:g,isEmpty:(null==n?void 0:n.external)!==void 0&&(null==n||!n.external)},errorMessage:p,maxAccess:d,selectNraId:o}};var m=r(65950);function p(e){let{functionId:t,action:r,hasDT:n}=e,{getRequest:d}=(0,a.useContext)(m.$),{stack:o}=(0,l.V)();return{proxyAction:async()=>{let e=await f(d,t,"",void 0,n);(null==e?void 0:e.errorMessage)?o({message:null==e?void 0:e.errorMessage}):await r()}}}function y(e){var t;let{functionId:r,access:d,hasDT:o,enabled:i=!0,objectName:c=""}=e,{getRequest:s}=(0,a.useContext)(m.$),{stack:u}=(0,l.V)(),[p,y]=(0,a.useState)(),v=async e=>{let t=await f(s,r,d,e,o,c);if(!t.errorMessage)return t;u({message:null==t?void 0:t.errorMessage})},g=(0,n.a)({retry:!1,staleTime:0,enabled:i,queryKey:[r,p,!!d,i],queryFn:p||"nraId"===p?()=>v(p):()=>v()});return{documentType:g.data,maxAccess:(null==g?void 0:null===(t=g.data)||void 0===t?void 0:t.maxAccess)||d,changeDT(e){y((null==e?void 0:e.nraId)||"nraId")}}}}},function(e){e.O(0,[92515,2494,36908,44129,49774,92888,40179],function(){return e(e.s=74536)}),_N_E=e.O()}]);