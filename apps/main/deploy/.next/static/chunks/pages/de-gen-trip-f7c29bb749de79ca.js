(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[38320],{3004:function(e,l,i){(window.__NEXT_P=window.__NEXT_P||[]).push(["/de-gen-trip",function(){return i(33242)}])},33242:function(e,l,i){"use strict";i.r(l),i.d(l,{default:function(){return w}});var a=i(52322),d=i(2784),s=i(62202),t=i(48601),r=i(8661),n=i(65950),o=i(69387),u=i(71987),v=i(60218),c=i(26612),h=i(80983),m=i(31389),p=i(33625),x=i(62362),g=i(19473),f=i(91406),y=i(30043),I=i(13411),Z=i(61802),P=i(23361),j=i(5088),T=i(69627),O=i(54074),w=()=>{var e,l,i,w,V,R,N,b,C,D,F,k,S,q,A,E;let[_,z]=(0,d.useState)(""),[H,L]=(0,d.useState)(!1),{getRequest:B,postRequest:U}=(0,d.useContext)(n.$),{platformLabels:G,userDefaultsData:M}=(0,d.useContext)(g.l),{stack:J}=(0,Z.zY)(),{labels:W,access:Q}=(0,u.J)({datasetId:c.i.GenerateTrip}),{labels:X,access:Y}=(0,u.J)({datasetId:c.i.Trip}),$=parseInt(null==M?void 0:null===(l=M.list)||void 0===l?void 0:null===(e=l.find(e=>{let{key:l}=e;return"plantId"===l}))||void 0===e?void 0:e.value),{formik:K}=(0,h.c)({initialValues:{search:"",vehicleId:null,driverId:null,szId:null,capacity:0,balance:0,volume:0,totalAmount:0,totalVolume:0,deliveryOrders:{list:[]},data:{list:[]},salesZones:{list:[]}},validationSchema:t.Ry({vehicleId:t.Rx().required()}),maxAccess:Q,validateOnChange:!0,onSubmit:async e=>{let l={vehicleId:e.vehicleId,driverId:e.driverId,plantId:$,tripOrderIDs:e.deliveryOrders.list.map(e=>e.recordId)},i=await U({extension:y.U.Trip.generate,record:JSON.stringify(l)});i.recordId&&(await ee(i.recordId),K.setValues({...K.values,volume:0,capacity:0,amount:0,balance:0}),K.setFieldValue("deliveryOrders",{list:[]}),s.ZP.success(G.Generated))}});async function ee(e){J({Component:I.Z,props:{labels:X,recordId:e,maxAccess:Y},width:1300,height:700,title:X.outboundTransp})}let el=(e,l)=>{if(!l){var i,a,d,s,t,r,n,o,u;let l=_?_.split(","):[],v=[...(null==K?void 0:null===(d=K.values)||void 0===d?void 0:null===(a=d.data)||void 0===a?void 0:null===(i=a.list)||void 0===i?void 0:i.length)>0?K.values.data.list:[]],c=null==K?void 0:null===(r=K.values)||void 0===r?void 0:null===(t=r.deliveryOrders)||void 0===t?void 0:null===(s=t.list)||void 0===s?void 0:s.find(l=>l.recordId==e.recordId);c&&l.includes(String(c.szId))&&v.push(c),K.setFieldValue("data",{list:v});let h={...null==K?void 0:null===(n=K.values)||void 0===n?void 0:n.deliveryOrders,list:((null==K?void 0:null===(u=K.values)||void 0===u?void 0:null===(o=u.deliveryOrders)||void 0===o?void 0:o.list)||[]).filter(l=>l.recordId!==e.recordId)};K.setFieldValue("deliveryOrders",h)}},ei=(e,l)=>{L(!0),Array.isArray(e)?e.forEach(e=>{el(e,l)}):el(e,l)};(0,d.useEffect)(()=>{if(H){var e,l,i,a;let d=(null==K?void 0:null===(l=K.values)||void 0===l?void 0:null===(e=l.data)||void 0===e?void 0:e.list.reduce((e,l)=>{let i=0;if(l.checked){var a;i=parseFloat(null==l?void 0:null===(a=l.amount)||void 0===a?void 0:a.toString().replace(/,/g,""))||0}return e+i},0))||0,s=(null==K?void 0:null===(a=K.values)||void 0===a?void 0:null===(i=a.data)||void 0===i?void 0:i.list.reduce((e,l)=>{let i=0;if(l.checked){var a;i=parseFloat(null==l?void 0:null===(a=l.volume)||void 0===a?void 0:a.toString().replace(/,/g,""))||0}return e+i},0))||0;K.setFieldValue("totalAmount",d),K.setFieldValue("totalVolume",s),L(!1)}},[H]);let ea=(null==K?void 0:null===(V=K.values)||void 0===V?void 0:null===(w=V.deliveryOrders)||void 0===w?void 0:null===(i=w.list)||void 0===i?void 0:i.reduce((e,l)=>e+(l.volume||0),0))||0,ed=(null==K?void 0:null===(b=K.values)||void 0===b?void 0:null===(N=b.deliveryOrders)||void 0===N?void 0:null===(R=N.list)||void 0===R?void 0:R.reduce((e,l)=>e+(l.amount||0),0))||0,es=K.values.capacity-ea,et=[{field:"name",headerName:W.name,wrapText:!0,autoHeight:!0,flex:1}],er=[{field:"date",headerName:W.date,type:"date",width:120},{field:"reference",headerName:W.reference,width:130},{field:"spName",headerName:W.salesPerson,width:130,wrapText:!0,autoHeight:!0},{field:"szName",headerName:W.zone,width:120,wrapText:!0,autoHeight:!0},{field:"clientName",headerName:W.client,wrapText:!0,autoHeight:!0,width:130},{field:"amount",headerName:W.amount,type:"number",width:130},{field:"volume",headerName:W.volume,type:"number",width:130},{field:"notes",headerName:W.notes,flex:1}],en=[{field:"date",headerName:W.date,type:"date",width:130},{field:"reference",headerName:W.reference,width:130},{field:"spName",headerName:W.salesPerson,width:130,wrapText:!0,autoHeight:!0},{field:"szName",headerName:W.zone,width:120,wrapText:!0,autoHeight:!0},{field:"clientName",headerName:W.client,wrapText:!0,autoHeight:!0,width:130},{field:"amount",headerName:W.amount,type:"number",width:130},{field:"volume",headerName:W.volume,type:"number",width:130},{field:"notes",headerName:W.notes,flex:1}],eo=async e=>{let l=await B({extension:y.U.GenerateTrip.firstLevel,parameters:"_szId=".concat(e||0)});(null==l?void 0:l.list)&&K.setFieldValue("salesZones",{...l,list:l.list})},eu=async e=>{var l,i,a;let d=await B({extension:y.U.GenerateTrip.undelivered2,parameters:"_szIds=".concat(e||0)});if(!(null==d?void 0:d.list))return;let s=new Set(null==K?void 0:null===(a=K.values)||void 0===a?void 0:null===(i=a.deliveryOrders)||void 0===i?void 0:null===(l=i.list)||void 0===l?void 0:l.map(e=>e.recordId)),t=d.list.filter(e=>!s.has(e.recordId));K.setFieldValue("data",{list:t})},ev=()=>{z(""),K.resetForm()},ec=(0,d.useMemo)(()=>{var e,l,i;return{...null==K?void 0:null===(e=K.values)||void 0===e?void 0:e.salesZones,list:null==K?void 0:null===(i=K.values)||void 0===i?void 0:null===(l=i.salesZones)||void 0===l?void 0:l.list.filter(e=>{var l,i;return e.name.toString().toLowerCase().includes(null==K?void 0:null===(i=K.values)||void 0===i?void 0:null===(l=i.search)||void 0===l?void 0:l.toLowerCase())})}},[null==K?void 0:null===(C=K.values)||void 0===C?void 0:C.salesZones,K.values.search]),eh=(null==K?void 0:null===(F=K.values)||void 0===F?void 0:null===(D=F.salesZones)||void 0===D?void 0:D.list.length)>0?ec:null==K?void 0:null===(k=K.values)||void 0===k?void 0:k.salesZones;return(0,a.jsx)(O.Z,{onSave:K.handleSubmit,isSaved:!1,maxAccess:Q,children:(0,a.jsxs)(m.R,{children:[(0,a.jsx)(p.g,{children:(0,a.jsxs)(v.ZP,{container:!0,spacing:2,children:[(0,a.jsx)(v.ZP,{item:!0,xs:3,children:(0,a.jsxs)(v.ZP,{container:!0,spacing:2,children:[(0,a.jsx)(v.ZP,{item:!0,xs:9,children:(0,a.jsx)(r.Z,{endpointId:y.U.GenerateTrip.root,parameters:'_startAt=0&_pageSize=1000&_sortField="recordId"&_filter=',name:"szId",label:W.saleZone,valueField:"recordId",displayField:"name",values:K.values,onChange:(e,l)=>{K.setFieldValue("szId",(null==l?void 0:l.recordId)||null),eo(null==l?void 0:l.recordId),K.setFieldValue("data",{list:[]}),z("")},readOnly:(null==K?void 0:null===(q=K.values)||void 0===q?void 0:null===(S=q.deliveryOrders)||void 0===S?void 0:S.list.length)>0,error:K.touched.szId&&!!K.errors.szId,maxAccess:Q})}),(0,a.jsx)(v.ZP,{item:!0,xs:2,children:(0,a.jsx)(T.Z,{onClick:()=>ev(),label:G.Clear,image:"clear.png",color:"#f44336"})})]})}),(0,a.jsx)(v.ZP,{item:!0,xs:2,children:(0,a.jsx)(r.Z,{endpointId:y.U.Vehicle.qry,name:"vehicleId",label:W.truck,valueField:"recordId",displayField:["plateNo","name"],columnsInDropDown:[{key:"plateNo",value:"Reference"},{key:"name",value:"Name"}],values:K.values,onChange:(e,l)=>{K.setFieldValue("vehicleId",(null==l?void 0:l.recordId)||null),K.setFieldValue("capacity",(null==l?void 0:l.capacityVolume)||null)},required:!0,error:K.touched.vehicleId&&!!K.errors.vehicleId,maxAccess:Q})}),(0,a.jsx)(v.ZP,{item:!0,xs:2,children:(0,a.jsx)(f.Z,{name:"balance",label:W.balance,value:es,readOnly:!0,align:"right"})}),(0,a.jsx)(v.ZP,{item:!0,xs:5}),(0,a.jsx)(v.ZP,{item:!0,xs:3,children:(0,a.jsx)(j.Z,{name:"search",value:K.values.search,label:G.Search,onClear:()=>{K.setFieldValue("search","")},size:"small",onChange:e=>{let{value:l}=e.target;K.values.search!==l&&K.setFieldValue("search",l)},onSearch:e=>K.setFieldValue("search",e),search:!0})}),(0,a.jsx)(v.ZP,{item:!0,xs:2,children:(0,a.jsx)(r.Z,{endpointId:y.U.Driver.qry,name:"driverId",label:W.driver,valueField:"recordId",displayField:"name",values:K.values,onChange:(e,l)=>{K.setFieldValue("driverId",(null==l?void 0:l.recordId)||null)},error:K.touched.driverId&&!!K.errors.driverId,maxAccess:Q})}),(0,a.jsx)(v.ZP,{item:!0,xs:2,children:(0,a.jsx)(f.Z,{name:"capacity",label:W.capacity,value:K.values.capacity,readOnly:!0,align:"right"})}),(0,a.jsx)(v.ZP,{item:!0,xs:4}),(0,a.jsx)(v.ZP,{item:!0,xs:1,children:(0,a.jsx)(T.Z,{onClick:()=>K.handleSubmit(),label:G.Generate,color:"#231f20"})})]})}),(0,a.jsx)(x.Q,{children:(0,a.jsxs)(v.ZP,{container:!0,spacing:2,sx:{display:"flex",flex:1},children:[(0,a.jsx)(v.ZP,{item:!0,xs:3,sx:{display:"flex",flex:1},children:(0,a.jsx)(o.Z,{columns:et,gridData:eh,rowId:["recordId"],isLoading:!1,pagination:!1,maxAccess:Q,showCheckboxColumn:!0,showSelectAll:!1,handleCheckboxChange:(e,l)=>{let{recordId:i}=e;z(e=>{let a=e?e.split(","):[];return(l?[...new Set([...a,i])]:a.filter(e=>e!=i)).join(",")})}})}),(0,a.jsx)(v.ZP,{item:!0,xs:9,sx:{display:"flex",flex:1},children:(0,a.jsxs)(v.ZP,{container:!0,spacing:2,sx:{display:"flex",flex:1},children:[(0,a.jsx)(v.ZP,{item:!0,xs:12,sx:{display:"flex",height:255},children:(0,a.jsx)(o.Z,{columns:er,gridData:null==K?void 0:null===(A=K.values)||void 0===A?void 0:A.data,rowId:["recordId"],isLoading:!1,pagination:!1,maxAccess:Q,showCheckboxColumn:!0,handleCheckboxChange:ei})}),(0,a.jsx)(v.ZP,{item:!0,xs:12,sx:{display:"flex",flex:0},children:(0,a.jsxs)(v.ZP,{container:!0,spacing:2,children:[(0,a.jsx)(v.ZP,{item:!0,xs:3,children:(0,a.jsx)(T.Z,{onClick:()=>{var e,l,i;let a=null===(l=K.values.data)||void 0===l?void 0:null===(e=l.list)||void 0===e?void 0:e.filter(e=>e.checked),d={...K.values.deliveryOrders,list:[...(null===(i=K.values.deliveryOrders)||void 0===i?void 0:i.list)||[],...a]};K.setFieldValue("deliveryOrders",d),K.setFieldValue("data",{...K.values.data,list:K.values.data.list.filter(e=>!e.checked)||[]}),K.setFieldValue("totalAmount",0),K.setFieldValue("totalVolume",0)},label:G.Import,color:"#231f20",image:"import.png"})}),(0,a.jsx)(v.ZP,{item:!0,xs:5}),(0,a.jsx)(v.ZP,{item:!0,xs:2,children:(0,a.jsx)(f.Z,{name:"amount",label:W.amount,value:K.values.totalAmount,readOnly:!0,align:"right"})}),(0,a.jsx)(v.ZP,{item:!0,xs:2,children:(0,a.jsx)(f.Z,{name:"volume",label:W.volume,value:K.values.totalVolume,readOnly:!0,align:"right"})})]})}),(0,a.jsx)(v.ZP,{item:!0,xs:12,sx:{display:"flex",height:255},children:(0,a.jsx)(x.Q,{children:(0,a.jsx)(o.Z,{columns:en,gridData:null==K?void 0:null===(E=K.values)||void 0===E?void 0:E.deliveryOrders,rowId:["recordId"],isLoading:!1,pagination:!1,maxAccess:Q,showCheckboxColumn:!0,handleCheckboxChange:(e,l)=>{J({Component:P.Z,props:{DialogText:G.UncheckConf,okButtonAction:()=>ei(e,l),fullScreen:!1,close:!0},onClose:()=>{var l,i;let a=null==K?void 0:null===(i=K.values)||void 0===i?void 0:null===(l=i.deliveryOrders)||void 0===l?void 0:l.list.map(l=>l.recordId==e.recordId?{...l,checked:!0}:l),d={...K.values.deliveryOrders,list:a};K.setFieldValue("deliveryOrders",d)},width:400,height:150,title:G.Confirmation})},showSelectAll:!1})})})]})})]})}),(0,a.jsx)(p.g,{children:(0,a.jsxs)(v.ZP,{container:!0,spacing:2,children:[(0,a.jsx)(v.ZP,{item:!0,xs:2,children:(0,a.jsx)(T.Z,{onClick:()=>eu(_),label:G.Preview,color:"#231f20"})}),(0,a.jsx)(v.ZP,{item:!0,xs:7}),(0,a.jsx)(v.ZP,{item:!0,xs:1.5,children:(0,a.jsx)(f.Z,{name:"amount",label:W.amount,value:ed,readOnly:!0,align:"right"})}),(0,a.jsx)(v.ZP,{item:!0,xs:1.5,children:(0,a.jsx)(f.Z,{name:"volume",label:W.volume,value:ea,readOnly:!0,align:"right"})})]})})]})})}},30043:function(e,l,i){"use strict";i.d(l,{U:function(){return d}});let a="DE.asmx/",d={Driver:{snapshot:a+"snapshotDRV",page:a+"pageDRV",set:a+"setDRV",get:a+"getDRV",qry:a+"qryDRV",del:a+"delDRV"},Vehicle:{page:a+"pageVEH",set:a+"setVEH",get:a+"getVEH",qry:a+"qryVEH",del:a+"delVEH"},Trip:{page:a+"pageTRP",set:a+"setTRP",get:a+"getTRP",qry:a+"qryTRP",del:a+"delTRP",snapshot:a+"snapshotTRP",snapshot2:a+"snapshot2TRP",reopen:a+"reopenTRP",post:a+"postTRP",unpost:a+"unpostTRP",close:a+"closeTRP",generate:a+"generateTRP",setTRP2:a+"setTRP2",assign:a+"assignTRP",unassign:a+"unassignedTRP"},TripOrderPack2:{set2:a+"set2TRO"},TripOrder:{qry:a+"qryTRO"},Reduild:{rebuild:a+"rebuildMW"},TRP:{flag:a+"flagTRP"},ExpenseTypes:{get:a+"getET",set:a+"setET",del:a+"delET",page:a+"pageET"},DeliveriesOrders:{qry:a+"qryORD",get:a+"getORD",snapshot:a+"snapshotORD",unpost:a+"unpostORD",gen:a+"genORD",post:a+"postORD",del:a+"delORD",cancel:a+"cancelORD",flag:a+"flagORD",set2:a+"set2ORD"},Invoice:{generate:a+"generateIVC2",generateInv:a+"generateIVC",preview:a+"previewIVC"},OrderItem:{qry:a+"qryORI",get:a+"getORI"},MW:{qry:a+"qryMW2"},GenerateTrip:{root:a+"rootSZ",firstLevel:a+"firstLevelSZ",undelivered2:a+"undeliveredSO2",previewTRP:a+"previewTRP"},DeliveryLeadTime:{get:a+"getLDT",page:a+"pageLDT",set:a+"setLDT",del:a+"delLDT"},Volume:{vol:a+"volZO"},AllocatedVolume:{qry:a+"qryVEH2"},InboundTransp:{pack:a+"getPackINB",page:a+"pageINB",set2:a+"set2INB",get:a+"getINB",get2:a+"get2INB",del:a+"delINB",snapshot:a+"snapshotINB",post:a+"postINB",unpost:a+"unpostINB"},InboundOrders:{qry:a+"qryINO"}}}},function(e){e.O(0,[92515,43553,13411,49774,92888,40179],function(){return e(e.s=3004)}),_N_E=e.O()}]);