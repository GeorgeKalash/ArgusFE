(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[78064],{19431:function(e,d,l){(window.__NEXT_P=window.__NEXT_P||[]).push(["/pm-rubber",function(){return l(69751)}])},69751:function(e,d,l){"use strict";l.r(d),l.d(d,{default:function(){return O}});var r=l(52322),a=l(2784),n=l(62202),t=l(69387),o=l(65950),i=l(26612),s=l(71987),u=l(61802),c=l(31389),m=l(33625),v=l(62362),p=l(19473),I=l(36908),x=l(63518),h=l(89330),y=l(39812),f=l(60218),b=l(48601),F=l(82737),g=l(5088),D=l(21581),j=l(8661),C=l(38449),Z=l(7121),V=l(90587),P=l(80983),R=l(98345),w=l(91406),_=l(23361),N=l(53164),k=l(27423),A=l(65215);function S(e){var d,l,t,m,I,S,O,q,z;let{labels:G,access:L,recordId:T}=e,{getRequest:J,postRequest:E}=(0,a.useContext)(o.$),{platformLabels:M}=(0,a.useContext)(p.l),{stack:$}=(0,u.zY)(),{documentType:B,maxAccess:Q,changeDT:U}=(0,R.H)({functionId:Z.J.Rubber,access:L,enabled:!T}),W=(0,s.E)({endpointId:x.z.Rubber.page}),{formik:X}=(0,P.c)({maxAccess:Q,documentType:{key:"dtId",value:null==B?void 0:B.dtId},initialValues:{recordId:T,dtId:null,reference:"",date:new Date,productionLineId:null,metalId:null,modelId:null,modelRef:"",threeDPId:null,designGroupId:null,designFamilyId:null,productionClassId:null,itemGroupId:null,productionStandardId:null,laborId:null,startDate:null,endDate:null,pcs:0,jobId:null,status:1,notes:""},validateOnChange:!0,validationSchema:b.Ry({pcs:b.Rx().required().moreThan(0,"min"),laborId:b.Rx().required(),modelId:b.Rx().required(),date:b.hT().required()}),onSubmit:async e=>{E({extension:x.z.Rubber.set,record:JSON.stringify({...e,startDate:e.startDate?(0,y.ku)(e.startDate):null,endDate:e.endDate?(0,y.ku)(e.endDate):null})}).then(async d=>{let l=e.recordId?M.Edited:M.Added;n.ZP.success(l),await ee(d.recordId),W()})}}),Y=!!X.values.recordId,H=4==X.values.status,K=3==X.values.status;async function ee(e){await J({extension:x.z.Rubber.get,parameters:"_recordId=".concat(e)}).then(e=>{var d,l,r;X.setValues({...null==e?void 0:e.record,startDate:(0,y.a1)(null==e?void 0:null===(d=e.record)||void 0===d?void 0:d.startDate),endDate:(0,y.a1)(null==e?void 0:null===(l=e.record)||void 0===l?void 0:l.endDate),date:(0,y.a1)(null==e?void 0:null===(r=e.record)||void 0===r?void 0:r.date)})})}async function ed(){let e=await E({extension:x.z.Rubber.start,record:JSON.stringify(X.values)});n.ZP.success(M.Started),W(),await ee(e.recordId)}let el=[{key:"Locked",condition:K,disabled:!Y||K},{key:"Unlocked",condition:!K,onClick:async()=>{await E({extension:x.z.Rubber.post,record:JSON.stringify({...X.values,startDate:(0,y.ku)(X.values.startDate)})}),n.ZP.success(M.Posted),W(),await ee(X.values.recordId)},disabled:!Y||K||!H},{key:"Start",condition:!H,onClick:()=>{var e,d;e=M.StartRecord,d=M.Confirmation,$({Component:_.Z,props:{DialogText:e,okButtonAction:async()=>{await ed()},fullScreen:!1,close:!0},width:400,height:150,title:d})},disabled:!Y||H||K},{key:"threeDPrinting",condition:!0,onClick:()=>{var e;$({Component:N.Z,props:{recordId:null===(e=X.values)||void 0===e?void 0:e.threeDPId}})},disabled:!X.values.threeDPId}];(0,a.useEffect)(()=>{T&&ee(T)},[]);let er=async e=>await J({extension:x.z.ThreeDDesign.get,parameters:"_recordId=".concat(e)});return(0,r.jsx)(F.Z,{resourceId:i.i.Rubber,functionId:Z.J.Rubber,form:X,maxAccess:Q,actions:el,editMode:Y,disabledSubmit:H||K,children:(0,r.jsx)(c.R,{children:(0,r.jsx)(v.Q,{children:(0,r.jsxs)(f.ZP,{container:!0,spacing:2,children:[(0,r.jsx)(f.ZP,{item:!0,xs:12,children:(0,r.jsx)(j.Z,{endpointId:C.r.DocumentType.qry,parameters:"_startAt=0&_pageSize=1000&_dgId=".concat(Z.J.Rubber),name:"dtId",label:G.documentType,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],readOnly:Y,valueField:"recordId",displayField:["reference","name"],values:X.values,maxAccess:Q,onChange:async(e,d)=>{if(X.setFieldValue("dtId",null==d?void 0:d.recordId),U(d),X.setFieldValue("productionLineId",null),null==d?void 0:d.recordId){let{record:e}=await J({extension:x.z.DocumentTypeDefault.get,parameters:"_dtId=".concat(null==d?void 0:d.recordId)});(null==e?void 0:e.productionLineId)&&(X.setFieldValue("modelRef",""),X.setFieldValue("threeDPId",null),X.setFieldValue("laborId",null),X.setFieldValue("laborName",""),X.setFieldValue("modelId",null),X.setFieldValue("pcs",""),X.setFieldValue("jobId","")),X.setFieldValue("productionLineId",(null==e?void 0:e.productionLineId)||null)}},error:X.touched.dtId&&!!X.errors.dtId})}),(0,r.jsx)(f.ZP,{item:!0,xs:12,children:(0,r.jsx)(g.Z,{name:"reference",label:G.reference,value:null==X?void 0:null===(d=X.values)||void 0===d?void 0:d.reference,maxAccess:!Y&&Q,readOnly:Y,onChange:X.handleChange,onClear:()=>X.setFieldValue("reference",""),error:X.touched.reference&&!!X.errors.reference})}),(0,r.jsx)(f.ZP,{item:!0,xs:12,children:(0,r.jsx)(j.Z,{endpointId:V.u.ProductionLine.qry,values:X.values,name:"productionLineId",readOnly:!0,label:G.productionLine,valueField:"recordId",displayField:["reference","name"],displayFieldWidth:1,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],maxAccess:Q,onChange:(e,d)=>{X.setFieldValue("productionLineId",(null==d?void 0:d.recordId)||null)},error:X.touched.productionLineId&&X.errors.productionLineId})}),(0,r.jsx)(f.ZP,{item:!0,xs:12,children:(0,r.jsx)(k.U,{endpointId:x.z.ModelMaker.snapshot2,parameters:{_productionLineId:X.values.productionLineId||0},valueField:"reference",name:"modelId",label:G.model,form:X,required:!0,valueShow:"modelRef",secondDisplayField:!1,readOnly:H||K,maxAccess:L,columnsInDropDown:[{key:"reference",value:"Ref"},{key:"date",value:"Date",type:"date"}],onChange:async(e,d)=>{if(X.setFieldValue("modelRef",(null==d?void 0:d.reference)||""),X.setFieldValue("threeDPId",(null==d?void 0:d.threeDPId)||""),X.setFieldValue("laborId",(null==d?void 0:d.laborId)||null),X.setFieldValue("laborName",(null==d?void 0:d.laborName)||""),X.setFieldValue("metalId",(null==d?void 0:d.metalId)||null),null==d?void 0:d.threeDPId){var l,r,a,n,t,o,i,s,u;let e=await J({extension:x.z.Printing.get,parameters:"_recordId=".concat(null==d?void 0:d.threeDPId)}),c=await er(null===(l=e.record)||void 0===l?void 0:l.threeDDId);X.setFieldValue("productionStandardId",(null==c?void 0:null===(r=c.record)||void 0===r?void 0:r.productionStandardId)||null),X.setFieldValue("itemGroupId",(null==c?void 0:null===(a=c.record)||void 0===a?void 0:a.itemGroupId)||null),X.setFieldValue("productionClassId",(null==c?void 0:null===(n=c.record)||void 0===n?void 0:n.productionClassId)||null);let m=null==e?void 0:null===(t=e.record)||void 0===t?void 0:t.jobId;if(X.setFieldValue("jobId",m||null),X.setFieldValue("designFamilyId",(null==e?void 0:null===(o=e.record)||void 0===o?void 0:o.designFamilyId)||null),X.setFieldValue("designGroupId",(null==e?void 0:null===(i=e.record)||void 0===i?void 0:i.designGroupId)||null),m){let d=await J({extension:V.u.MFJobOrder.get,parameters:"_recordId=".concat(null==e?void 0:null===(s=e.record)||void 0===s?void 0:s.jobId)});X.setFieldValue("pcs",null==d?void 0:null===(u=d.record)||void 0===u?void 0:u.pcs)}else X.setFieldValue("pcs","")}X.setFieldValue("modelId",(null==d?void 0:d.recordId)||null)},errorCheck:"modelId"})}),(0,r.jsx)(f.ZP,{item:!0,xs:12,children:(0,r.jsx)(h.Z,{name:"date",label:G.date,value:X.values.date,onChange:X.setFieldValue,maxAccess:Q,required:!0,readOnly:H||K,onClear:()=>X.setFieldValue("date",null),error:X.touched.date&&!!X.errors.date})}),(0,r.jsx)(f.ZP,{item:!0,xs:12,children:(0,r.jsx)(j.Z,{endpointId:V.u.DesignFamily.qry,name:"designFamilyId",label:G.familyGroup,valueField:"recordId",displayField:"name",values:X.values,readOnly:!0,onChange:(e,d)=>X.setFieldValue("designFamilyId",(null==d?void 0:d.recordId)||null),error:(null==X?void 0:null===(l=X.touched)||void 0===l?void 0:l.designFamilyId)&&!!(null==X?void 0:null===(t=X.errors)||void 0===t?void 0:t.designFamilyId),maxAccess:Q})}),(0,r.jsx)(f.ZP,{item:!0,xs:12,children:(0,r.jsx)(j.Z,{endpointId:V.u.DesignGroup.qry,name:"designGroupId",label:G.designGroup,valueField:"recordId",displayField:"name",values:X.values,readOnly:!0,onChange:(e,d)=>X.setFieldValue("designGroupId",(null==d?void 0:d.recordId)||null),error:(null==X?void 0:null===(m=X.touched)||void 0===m?void 0:m.designGroupId)&&!!(null==X?void 0:null===(I=X.errors)||void 0===I?void 0:I.designGroupId),maxAccess:Q})}),(0,r.jsx)(f.ZP,{item:!0,xs:12,children:(0,r.jsx)(j.Z,{endpointId:V.u.ProductionClass.qry,values:X.values,name:"productionClassId",label:G.productionClass,valueField:"recordId",displayField:"name",maxAccess:Q,readOnly:!0,onChange:(e,d)=>{X.setFieldValue("productionClassId",(null==d?void 0:d.recordId)||null)},error:X.touched.productionClassId&&!!X.errors.productionClassId})}),(0,r.jsx)(f.ZP,{item:!0,xs:12,children:(0,r.jsx)(j.Z,{endpointId:V.u.ProductionStandard.qry,values:X.values,name:"productionStandardId",label:G.productionStandard,valueField:"recordId",displayField:"reference",maxAccess:Q,readOnly:!0,onChange:(e,d)=>X.setFieldValue("productionStandardId",(null==d?void 0:d.recordId)||""),error:X.touched.productionStandardId&&!!X.errors.productionStandardId})}),(0,r.jsx)(f.ZP,{item:!0,xs:12,children:(0,r.jsx)(j.Z,{endpointId:A.$.Group.qry,parameters:"_startAt=0&_pageSize=1000",values:X.values,name:"itemGroupId",label:G.itemGroup,valueField:"recordId",displayField:["reference","name"],displayFieldWidth:1,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],readOnly:!0,maxAccess:Q,onChange:(e,d)=>X.setFieldValue("itemGroupId",(null==d?void 0:d.recordId)||null),error:X.touched.itemGroupId&&X.errors.itemGroupId})}),(0,r.jsx)(f.ZP,{item:!0,xs:12,children:(0,r.jsx)(f.ZP,{item:!0,xs:12,children:(0,r.jsx)(j.Z,{endpointId:A.$.Metals.qry,name:"metalId",label:G.metal,valueField:"recordId",displayField:["reference"],values:X.values,onChange:(e,d)=>{X.setFieldValue("metalId",(null==d?void 0:d.recordId)||null),X.setFieldValue("metalPurity",(null==d?void 0:d.purity)||null)},readOnly:H||K,error:X.touched.metalId&&!!X.errors.metalId,maxAccess:Q})})}),(0,r.jsx)(f.ZP,{item:!0,xs:12,children:(0,r.jsx)(j.Z,{endpointId:V.u.Labor.qry,parameters:"_startAt=0&_pageSize=200&_params=",name:"laborId",required:!0,readOnly:H||K,label:G.labor,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],valueField:"recordId",displayField:["reference","name"],values:X.values,onChange:(e,d)=>{X.setFieldValue("laborId",(null==d?void 0:d.recordId)||null)},error:X.touched.laborId&&!!X.errors.laborId})}),(0,r.jsx)(f.ZP,{item:!0,xs:12,children:(0,r.jsx)(w.Z,{name:"pcs",decimalScale:0,required:!0,label:G.rubberpcs,value:null==X?void 0:null===(S=X.values)||void 0===S?void 0:S.pcs,maxAccess:Q,readOnly:H||K,onChange:X.handleChange,onClear:()=>X.setFieldValue("pcs",""),maxLength:4,error:X.touched.pcs&&!!X.errors.pcs})}),(0,r.jsx)(f.ZP,{item:!0,xs:12,children:(0,r.jsx)(h.Z,{name:"startDate",label:G.startDate,value:null==X?void 0:null===(O=X.values)||void 0===O?void 0:O.startDate,onChange:X.setFieldValue,maxAccess:Q,readOnly:!0})}),(0,r.jsx)(f.ZP,{item:!0,xs:12,children:(0,r.jsx)(h.Z,{name:"endDate",label:G.endDate,value:null==X?void 0:null===(q=X.values)||void 0===q?void 0:q.endDate,onChange:X.setFieldValue,maxAccess:Q,readOnly:!0})}),(0,r.jsx)(f.ZP,{item:!0,xs:12,children:(0,r.jsx)(g.Z,{name:"status",label:G.status,value:null==X?void 0:null===(z=X.values)||void 0===z?void 0:z.statusName,maxAccess:Q,readOnly:!0})}),(0,r.jsx)(f.ZP,{item:!0,xs:12,children:(0,r.jsx)(D.Z,{name:"notes",label:G.notes,value:X.values.notes,rows:4,readOnly:H||K,maxAccess:Q,onChange:e=>X.setFieldValue("notes",e.target.value),onClear:()=>X.setFieldValue("notes",""),error:X.touched.notes&&!!X.errors.notes})})]})})})})}var O=()=>{let{getRequest:e,postRequest:d}=(0,a.useContext)(o.$),{stack:l}=(0,u.zY)(),{platformLabels:h}=(0,a.useContext)(p.l),{query:{data:y},labels:f,filterBy:b,paginationParameters:F,invalidate:g,refetch:D,access:j}=(0,s.J)({queryFn:V,endpointId:x.z.Rubber.page,datasetId:i.i.Rubber,filter:{filterFn:C}});async function C(d){let{filters:l,pagination:r}=d;return(null==l?void 0:l.qry)?await e({extension:x.z.Rubber.snapshot,parameters:"_filter=".concat(l.qry)}):V({_startAt:r._startAt||0,params:null==l?void 0:l.params})}async function V(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{_startAt:l=0,_pageSize:r=50,params:a}=d;return{...await e({extension:x.z.Rubber.page,parameters:"_startAt=".concat(l,"&_pageSize=").concat(r,"&_params=").concat(a||"")}),_startAt:l}}let P=[{field:"dtRef",headerName:f.documentType,flex:1},{field:"reference",headerName:f.reference,flex:1},{field:"date",headerName:f.date,flex:1,type:"date"},{field:"startDate",headerName:f.startDate,flex:1,type:"date"},{field:"endDate",headerName:f.endDate,flex:1,type:"date"},{field:"modelRef",headerName:f.model,flex:1},{field:"laborName",headerName:f.labor,flex:1},{field:"pcs",headerName:f.rubberpcs,flex:1,type:"number"},{field:"productionLineName",headerName:f.productionLine,flex:1},{field:"statusName",headerName:f.status,flex:1}],w=async e=>{await d({extension:x.z.Rubber.del,record:JSON.stringify(e)}),n.ZP.success(h.Deleted),g()},{proxyAction:_}=(0,R.G)({functionId:Z.J.Rubber,action:k}),N=async()=>{await _()};function k(e){l({Component:S,props:{labels:f,recordId:e,access:j},width:550,height:690,title:null==f?void 0:f.rubber})}return(0,r.jsxs)(c.R,{children:[(0,r.jsx)(m.g,{children:(0,r.jsx)(I.Z,{onAdd:N,maxAccess:j,filterBy:b,reportName:"PMRBR"})}),(0,r.jsx)(v.Q,{children:(0,r.jsx)(t.Z,{columns:P,gridData:y,rowId:["recordId"],paginationParameters:F,deleteConfirmationType:"strict",paginationType:"api",refetch:D,onEdit:e=>{k(null==e?void 0:e.recordId)},onDelete:w,isLoading:!1,pageSize:50,maxAccess:j})})]})}}},function(e){e.O(0,[92515,2494,36908,44129,38096,53164,49774,92888,40179],function(){return e(e.s=19431)}),_N_E=e.O()}]);