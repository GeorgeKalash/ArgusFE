(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[37017],{29245:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/pu-open-po",function(){return t(84480)}])},84480:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return C}});var a=t(52322),l=t(2784),r=t(62202),s=t(48601),d=t(65950),o=t(71987),i=t(26612),c=t(31389),p=t(33625),u=t(62362),m=t(19473),I=t(65215),g=t(60218),y=t(27423),v=t(80983),h=t(38449),P=t(8661),R=t(7121),f=t(76399),x=t(39812),D=t(69627),V=t(61802),q=t(96026),O=t(2454),S=t(30481),k=t(61414),b=t(54074),C=()=>{var e,n,t;let{getRequest:C,postRequest:F}=(0,l.useContext)(d.$),{platformLabels:N,defaultsData:w}=(0,l.useContext)(m.l),{stack:E}=(0,V.zY)(),{stack:j}=(0,q.V)(),{labels:_,access:T}=(0,o.J)({datasetId:i.i.OpenPOs}),Z=null==w?void 0:null===(e=w.list)||void 0===e?void 0:e.find(e=>{let{key:n}=e;return"POSHPVarPct"===n}),{formik:A}=(0,v.c)({maxAccess:T,initialValues:{recordId:null,dtId:null,groupId:0,plantId:0,siteId:0,categoryId:0,vendorId:0,clientRef:"",clientName:"",itemId:0,poId:0,items:[],marginDefault:null==Z?void 0:Z.value},validationSchema:s.Ry({siteId:s.Rx().required()}),validateOnChange:!0,onSubmit:async e=>{let{vendorId:n,siteId:t,items:a,dtId:l,plantId:s}=e,d=a.filter(e=>e.isChecked).map(e=>{let{scheduledDate:n,functionId:t,id:a,isChecked:l,...r}=e;return r});if((null==d?void 0:d.length)<1){j({message:_.checkItemsBeforeAppend});return}let o=await F({extension:O.y.Shipment.gen,record:JSON.stringify({vendorId:n,siteId:t,dtId:l,plantId:0===s?null:s,items:d})});if(o.recordId){let n=e.items.map(e=>{let{isChecked:n,...t}=e;return{...t,isChecked:!1,receiveNow:0}});A.setFieldValue("items",n),E({Component:k.Z,props:{recordId:o.recordId}}),r.ZP.success(N.Generated),W()}}}),{groupId:Q,plantId:H,siteId:U,categoryId:G,vendorId:L,itemId:M,marginDefault:z,poId:$}=A.values;async function W(){var e;let n=await C({extension:S.g.OpenPurchaseOrder.open,parameters:"_categoryId=".concat(G,"&_siteId=").concat(U,"&_groupId=").concat(Q,"&_vendorId=").concat(L,"&_itemId=").concat(M,"&_plantId=").concat(H,"&_poId=").concat($)}),t=null==n?void 0:null===(e=n.list)||void 0===e?void 0:e.map((e,n)=>({...e,id:n+1,date:(0,x.a1)(e.date),balance:e.qty-e.receivedQty}));A.setFieldValue("items",t)}(0,l.useEffect)(()=>{W()},[L,G,Q,$,M]);let J=[{component:"checkbox",name:"isChecked",flex:.3,checkAll:{value:(null===(n=A.values.items)||void 0===n?void 0:n.length)>0&&(null===(t=A.values.items)||void 0===t?void 0:t.every(e=>null==e?void 0:e.isChecked)),visible:!0,onChange(e){let{checked:n}=e,t=A.values.items.map(e=>{let{isChecked:t,...a}=e;return{...a,isChecked:n,receiveNow:n?a.balance:0}});A.setFieldValue("items",t)}},async onChange(e){let{row:{update:n,newRow:t}}=e;n({receiveNow:t.isChecked?t.balance:0})}},{component:"textfield",label:_.reference,name:"reference",props:{readOnly:!0}},{component:"date",label:_.date,name:"date",props:{readOnly:!0}},{component:"textfield",label:_.sku,name:"sku",props:{readOnly:!0}},{component:"textfield",label:_.name,name:"itemName",props:{readOnly:!0}},{component:"textfield",label:_.vendor,name:"vendorRef",props:{readOnly:!0}},{component:"textfield",label:_.vendorName,name:"vendorName",props:{readOnly:!0}},{component:"textfield",label:_.mu,name:"muRef",props:{readOnly:!0}},{component:"numberfield",label:_.qty,name:"qty",props:{readOnly:!0}},{component:"numberfield",label:_.received,name:"receivedQty",props:{readOnly:!0}},{component:"numberfield",label:_.balance,name:"balance",props:{readOnly:!0,decimalScale:2}},{component:"numberfield",label:_.genQty,name:"receiveNow",updateOn:"blur",defaultValue:0,propsReducer(e){let{row:n,props:t}=e;return{...t,readOnly:!n.isChecked}},async onChange(e){let{row:{update:n,newRow:t}}=e,{receiveNow:a,balance:l,qty:r}=t,s=a;if(s>l){let e=100*(s-l)/r;s=0==z||null==z?l:e<z?a:l}else s=s<0?0:a;n({receiveNow:s||0})}}],B=[{key:"SHP",condition:!0,onClick:()=>A.handleSubmit(),disabled:!L||!U}];return(0,a.jsx)(b.Z,{actions:B,onSave:A.handleSubmit,disabledSubmit:!L||!U,isSaved:!1,maxAccess:T,fullSize:!0,children:(0,a.jsxs)(c.R,{children:[(0,a.jsx)(p.g,{children:(0,a.jsxs)(g.ZP,{container:!0,spacing:2,p:2,children:[(0,a.jsx)(g.ZP,{item:!0,xs:4,children:(0,a.jsxs)(g.ZP,{container:!0,spacing:2,children:[(0,a.jsx)(g.ZP,{item:!0,xs:12,children:(0,a.jsx)(P.Z,{endpointId:h.r.DocumentType.qry,parameters:"_dgId=".concat(R.J.Shipment,"&_startAt=",0,"&_pageSize=",1e3),name:"dtId",label:_.documentType,valueField:"recordId",displayField:"name",values:A.values,onChange:(e,n)=>{A.setFieldValue("dtId",(null==n?void 0:n.recordId)||null)},error:A.touched.dtId&&!!A.errors.dtId,maxAccess:T})}),(0,a.jsx)(g.ZP,{item:!0,xs:12,children:(0,a.jsx)(P.Z,{endpointId:I.$.Category.qry,parameters:"_pagesize=30&_startAt=0&_name=",name:"categoryId",label:_.category,valueField:"recordId",displayField:"name",displayFieldWidth:1,values:null==A?void 0:A.values,maxAccess:T,onChange:(e,n)=>{A.setFieldValue("categoryId",(null==n?void 0:n.recordId)||0)},error:A.touched.categoryId&&!!A.errors.categoryId})}),(0,a.jsx)(g.ZP,{item:!0,xs:12,children:(0,a.jsx)(P.Z,{endpointId:I.$.Group.qry,parameters:"_startAt=0&_pageSize=1000",name:"groupId",label:_.group,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:A.values,onChange:(e,n)=>{A.setFieldValue("groupId",(null==n?void 0:n.recordId)||0)},error:A.touched.groupId&&!!A.errors.groupId,maxAccess:T})})]})}),(0,a.jsx)(g.ZP,{item:!0,xs:4,children:(0,a.jsxs)(g.ZP,{container:!0,spacing:2,children:[(0,a.jsx)(g.ZP,{item:!0,xs:12,children:(0,a.jsx)(y.U,{endpointId:O.y.Vendor.snapshot,filter:e=>!e.isInactive,valueField:"reference",displayField:"name",name:"vendorId",label:_.vendor,form:A,displayFieldWidth:2,valueShow:"vendorRef",secondValueShow:"vendorName",maxAccess:T,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"},{key:"flName",value:"Foreign Language"}],onChange:async(e,n)=>{A.setFieldValue("vendorName",(null==n?void 0:n.name)||""),A.setFieldValue("vendorRef",(null==n?void 0:n.reference)||""),A.setFieldValue("vendorId",(null==n?void 0:n.recordId)||0)},errorCheck:"vendorId"})}),(0,a.jsx)(g.ZP,{item:!0,xs:12,children:(0,a.jsx)(P.Z,{endpointId:I.$.Site.qry,name:"siteId",label:_.site,valueField:"recordId",displayField:["reference","name"],maxAccess:T,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],required:!0,values:A.values,onChange:(e,n)=>{A.setFieldValue("siteId",(null==n?void 0:n.recordId)||0)},error:A.touched.sitId&&!!A.errors.sitId})}),(0,a.jsx)(g.ZP,{item:!0,xs:12,children:(0,a.jsx)(P.Z,{endpointId:h.r.Plant.qry,name:"plantId",label:_.plant,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:A.values,onChange:(e,n)=>{A.setFieldValue("plantId",(null==n?void 0:n.recordId)||0)},error:A.touched.plantId&&!!A.errors.plantId,maxAccess:T})})]})}),(0,a.jsx)(g.ZP,{item:!0,xs:4,children:(0,a.jsxs)(g.ZP,{container:!0,spacing:2,children:[(0,a.jsx)(g.ZP,{item:!0,xs:12,children:(0,a.jsx)(y.U,{endpointId:I.$.Item.snapshot,name:"itemId",label:_.sku,valueField:"sku",displayField:"name",valueShow:"itemRef",secondValueShow:"itemName",form:A,columnsInDropDown:[{key:"sku",value:"SKU"},{key:"name",value:"Name"}],onChange:(e,n)=>{A.setFieldValue("itemId",(null==n?void 0:n.recordId)||0),A.setFieldValue("itemName",(null==n?void 0:n.name)||""),A.setFieldValue("itemRef",(null==n?void 0:n.sku)||""),A.setFieldValue("sku",(null==n?void 0:n.sku)||"")},displayFieldWidth:2,maxAccess:T})}),(0,a.jsx)(g.ZP,{item:!0,xs:10,children:(0,a.jsx)(y.U,{endpointId:O.y.UnpostedOrderPack.snapshot,valueField:"reference",displayField:"name",name:"poId",label:_.ref,form:A,secondDisplayField:!1,displayFieldWidth:2,valueShow:"poRef",maxAccess:T,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],onChange:async(e,n)=>{A.setFieldValue("poName",(null==n?void 0:n.name)||""),A.setFieldValue("poRef",(null==n?void 0:n.reference)||""),A.setFieldValue("poId",(null==n?void 0:n.recordId)||0)},errorCheck:"poId"})}),(0,a.jsx)(g.ZP,{item:!0,xs:2,children:(0,a.jsx)(D.Z,{variant:"contained",image:"preview.png",label:N.Preview,onClick:()=>W(),color:"#231f20"})})]})})]})}),(0,a.jsx)(u.Q,{children:(0,a.jsx)(f._,{onChange:e=>A.setFieldValue("items",e),value:A.values.items,error:A.errors.items,columns:J,name:"items",allowDelete:!1,allowAddNewLine:!1,maxAccess:T})})]})})}},2454:function(e,n,t){"use strict";t.d(n,{y:function(){return l}});let a="PU.asmx/",l={VendorGroups:{qry:a+"qryGRP",page:a+"pageGRP",get:a+"getGRP",set:a+"setGRP",del:a+"delGRP"},PriceList:{qry:a+"qryPRI",del:a+"delPRI",get:a+"getPRI",set:a+"setPRI"},PUOrderStatus:{qry:a+"qryPOS",page:a+"pagePOS",get:a+"getPOS",set:a+"setPOS",del:a+"delPOS"},DeliveryMethods:{qry:a+"qryDM",page:a+"pageDM",get:a+"getDM",set:a+"setDM",del:a+"delDM"},PaymentTerms:{qry:a+"qryPT",page:a+"pagePT",get:a+"getPT",set:a+"setPT",del:a+"delPT"},Vendor:{snapshot:a+"snapshotVEN",qry:a+"qryVEN",page:a+"pageVEN",get:a+"getVEN",set:a+"setVEN",del:a+"delVEN"},Address:{qry:a+"qryAD",page:a+"pageAD",get:a+"getAD",set:a+"setAD",del:a+"delAD"},DocumentTypeDefault:{qry:a+"qryDTD",get:a+"getDTD",set:a+"setDTD",del:a+"delDTD",page:a+"pageDTD"},PurchaseInvoiceHeader:{qry:a+"qryIVC",get:a+"getIVC",get2:a+"get2IVC",level2_PU:a+"level2_PU",set:a+"setIVC",del:a+"delIVC",snapshot:a+"snapshotIVC",set2:a+"set2IVC",post:a+"postIVC",unpost:a+"unpostIVC",generate:a+"generateIVC",preview:a+"previewIVC",sync:a+"syncIVC",verify:a+"verifyIVC"},Invoice:{snapshot:a+"snapshotINV"},PurchaseReturnHeader:{set2:a+"set2IVR",post:a+"postIVR",unpost:a+"unpostIVR",del:a+"delIVR",qry:a+"qryIVR",snapshot:a+"snapshotIVR"},VendorPrice:{get:a+"getPRI2"},ItemCostHistory:{qry:a+"qryIPH"},ItemPromotion:{qry:a+"qryIVIM"},Serials:{qry:a+"qrySRL",import:a+"importSRL",last:a+"lastSRL",sync:a+"syncSRL"},Shipment:{get:a+"getSHP",set2:a+"set2SHP",del:a+"delSHP",page:a+"pageSHP",snapshot:a+"snapshotSHP",post:a+"postSHP",unpost:a+"unpostSHP",gen:a+"genSHP"},ShipmentItem:{qry:a+"qrySHI"},UnpostedOrderPack:{get:a+"openORD",snapshot:a+"snapshotORD"},PurchaseOrder:{page:a+"pageORD",snapshot:a+"snapshotORD",del:a+"delORD",set2:a+"set2ORD",get2:a+"get2ORD",close:a+"closeORD",reopen:a+"reopenORD",terminate:a+"terminateORD",transfer:a+"transfer1ORD"},PurchaseRequisition:{snapshot:a+"snapshotREQ",page:a+"pageREQ",get:a+"getREQ",set:a+"setREQ",del:a+"delREQ",cancel:a+"cancelREQ",reopen:a+"reopenREQ",close:a+"closeREQ"},RequisitionDetail:{qry:a+"qryREI",set:a+"setREI",get:a+"getREI",del:a+"delREI"},QuotationItem:{preview:a+"previewQTI",qry:a+"qryQTI"},OrderItem:{qry:a+"qryORI",set2:a+"set2ORI"},PUDraftReturn:{set2:a+"set2DRE",get:a+"getDRE",page:a+"pageDRE",snapshot:a+"snapshotDRE",del:a+"delDRE",post:a+"postDRE"},PUDraftReturnSerial:{get2:a+"get2DRS",qry:a+"qryDRS",del:a+"delDRS",append:a+"appendDRS",batch:a+"batchDRS"},FinancialGroup:{qry:a+"qryFII",set2:a+"set2FII"},PUInvoiceRetBalance:{balance:a+"balanceRET"},ItemLastPurchaseInfo:{last:a+"lastIVI"},PurchaseQuotation:{page:a+"pageQTN",set2:a+"set2QTN",get:a+"getQTN",del:a+"delQTN",snapshot:a+"snapshotQTN"},GenerateQTNPRPack:{gen:a+"genQTN"},GeneratePOPRPack:{gen:a+"genPO",gen2:a+"gen2PO"}}},30481:function(e,n,t){"use strict";t.d(n,{g:function(){return l}});let a="RG.PU.asmx/",l={OpenPurchaseOrder:{open:a+"openPO"},OpenPurchaseRequisition:{open:a+"openPR"}}}},function(e){e.O(0,[61414,49774,92888,40179],function(){return e(e.s=29245)}),_N_E=e.O()}]);