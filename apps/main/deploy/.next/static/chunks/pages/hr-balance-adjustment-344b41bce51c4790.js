(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[40303],{13863:function(e,a,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/hr-balance-adjustment",function(){return r(69098)}])},69098:function(e,a,r){"use strict";r.r(a),r.d(a,{default:function(){return S}});var n=r(52322),t=r(2784),l=r(62202),d=r(69387),s=r(65950),o=r(50496),c=r(26612),i=r(71987),u=r(31389),m=r(33625),v=r(62362),f=r(39812),h=r(60218),y=r(48601),x=r(82737),p=r(5088),I=r(21581),g=r(8661),A=r(38449),j=r(7121),_=r(91406),w=r(80983),T=r(19473),N=r(98345),D=r(27423),b=r(92407),k=r(84100),F=r(89330);function C(e){var a,r;let{labels:d,access:m,recordId:C}=e,{getRequest:q,postRequest:Z}=(0,t.useContext)(s.$),{platformLabels:S}=(0,t.useContext)(T.l),{documentType:R,maxAccess:V,changeDT:B}=(0,N.H)({functionId:j.J.BalanceAdjustment,access:m,enabled:!C}),E=(0,i.E)({endpointId:o.U.BalanceAdjustment.page}),{formik:P}=(0,w.c)({maxAccess:V,documentType:{key:"dtId",value:null==R?void 0:R.dtId},initialValues:{recordId:null,dtId:null,reference:"",employeeId:null,employeeRef:"",employeeName:"",lsId:null,leaveTrackTime:null,effectiveDate:new Date,date:new Date,hours:null,duration:null,notes:"",status:1},validateOnChange:!0,validationSchema:y.Ry({reference:y.Z_().required(),employeeId:y.Rx().required(),lsId:y.Rx().required(),leaveTrackTime:y.Rx().required(),effectiveDate:y.hT().required(),date:y.hT().required(),hours:y.Rx().required(),notes:y.Z_().required()}),onSubmit:async e=>{Z({extension:o.U.BalanceAdjustment.set,record:JSON.stringify({...e,effectiveDate:(0,f.ku)(e.effectiveDate),date:(0,f.ku)(e.date),duration:e.hours})}).then(async a=>{l.ZP.success((null==e?void 0:e.recordId)?S.Edited:S.Added),await O(a.recordId),E()})}});async function O(e){var a,r;let n=await q({extension:o.U.BalanceAdjustment.get,parameters:"_recordId=".concat(e)});P.setValues({...n.record,effectiveDate:(0,f.a1)(null==n?void 0:null===(a=n.record)||void 0===a?void 0:a.effectiveDate),date:(0,f.a1)(null==n?void 0:null===(r=n.record)||void 0===r?void 0:r.date)})}let U=!!P.values.recordId;return(0,t.useEffect)(()=>{C&&O(C)},[]),(0,n.jsx)(x.Z,{resourceId:c.i.BalanceAdjustment,functionId:j.J.BalanceAdjustment,form:P,maxAccess:V,previewReport:U,editMode:U,children:(0,n.jsx)(u.R,{children:(0,n.jsx)(v.Q,{children:(0,n.jsxs)(h.ZP,{container:!0,spacing:2,children:[(0,n.jsx)(h.ZP,{item:!0,xs:12,children:(0,n.jsx)(g.Z,{endpointId:A.r.DocumentType.qry,parameters:"_startAt=0&_pageSize=1000&_dgId=".concat(j.J.BalanceAdjustment),name:"dtId",label:d.documentType,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],readOnly:U,valueField:"recordId",displayField:["reference","name"],values:P.values,maxAccess:V,onChange:(e,a)=>{P.setFieldValue("dtId",(null==a?void 0:a.recordId)||null),B(a)},error:P.touched.dtId&&!!P.errors.dtId})}),(0,n.jsx)(h.ZP,{item:!0,xs:12,children:(0,n.jsx)(p.Z,{name:"reference",label:d.reference,value:null==P?void 0:null===(a=P.values)||void 0===a?void 0:a.reference,maxAccess:!U&&V,readOnly:U,onChange:P.handleChange,onClear:()=>P.setFieldValue("reference",""),error:P.touched.reference&&!!P.errors.reference})}),(0,n.jsx)(h.ZP,{item:!0,xs:12,children:(0,n.jsx)(F.Z,{name:"date",label:d.date,value:null===(r=P.values)||void 0===r?void 0:r.date,onChange:P.setFieldValue,disabledDate:">=",required:!0,maxAccess:V,onClear:()=>P.setFieldValue("date",null),error:P.touched.date&&!!P.errors.date})}),(0,n.jsx)(h.ZP,{item:!0,xs:12,children:(0,n.jsx)(D.U,{endpointId:b.y.Employee.snapshot,parameters:{_branchId:0},form:P,maxAccess:V,valueField:"reference",displayField:"fullName",name:"employeeRef",label:d.employee,secondDisplayField:!0,required:!0,secondValue:P.values.employeeName,onChange:(e,a)=>{P.setFieldValue("employeeRef",(null==a?void 0:a.reference)||""),P.setFieldValue("employeeName",(null==a?void 0:a.fullName)||""),P.setFieldValue("employeeId",(null==a?void 0:a.recordId)||null)},error:P.touched.employeeId&&!!P.errors.employeeId})}),(0,n.jsx)(h.ZP,{item:!0,xs:12,children:(0,n.jsx)(g.Z,{endpointId:o.U.LeaveScheduleFilters.qry,name:"lsId",label:d.leaveSchedule,values:P.values,valueField:"recordId",displayField:["reference","name"],required:!0,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],maxAccess:V,onChange:(e,a)=>{P.setFieldValue("lsId",(null==a?void 0:a.recordId)||null)},error:P.touched.lsId&&!!P.errors.lsId})}),(0,n.jsx)(h.ZP,{item:!0,xs:12,children:(0,n.jsx)(g.Z,{datasetId:k.v.LEAVE_TRACK_TIME,label:d.leaveTrackTime,name:"leaveTrackTime",values:P.values,valueField:"key",displayField:"value",maxAccess:V,required:!0,onChange:(e,a)=>{P.setFieldValue("leaveTrackTime",(null==a?void 0:a.key)||null)},error:P.touched.leaveTrackTime&&!!P.errors.leaveTrackTime})}),(0,n.jsx)(h.ZP,{item:!0,xs:12,children:(0,n.jsx)(F.Z,{name:"effectiveDate",label:d.effectiveDate,value:P.values.effectiveDate,onChange:P.setFieldValue,required:!0,maxAccess:V,onClear:()=>P.setFieldValue("effectiveDate",null),error:P.touched.effectiveDate&&!!P.errors.effectiveDate})}),(0,n.jsx)(h.ZP,{item:!0,xs:12,children:(0,n.jsx)(_.Z,{name:"hours",label:d.hours,value:P.values.hours,onChange:P.handleChange,maxLength:6,decimalScale:2,allowNegative:!1,maxAccess:V,required:!0,onClear:()=>P.setFieldValue("hours",0),error:P.touched.hours&&!!P.errors.hours})}),(0,n.jsx)(h.ZP,{item:!0,xs:12,children:(0,n.jsx)(I.Z,{name:"notes",label:d.notes,value:P.values.notes,maxLength:"200",rows:3,required:!0,maxAccess:V,onChange:P.handleChange,onClear:()=>P.setFieldValue("notes",""),error:P.touched.notes&&!!P.errors.notes})})]})})})})}var q=r(61802),Z=r(36908),S=()=>{let{getRequest:e,postRequest:a}=(0,t.useContext)(s.$),{stack:r}=(0,q.zY)(),{platformLabels:f}=(0,t.useContext)(T.l);async function h(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{_startAt:r=0,_pageSize:n=50}=a;return{...await e({extension:o.U.BalanceAdjustment.page,parameters:"_startAt=".concat(r,"&_pageSize=").concat(n,"&_params=")}),_startAt:r}}let{query:{data:y},labels:x,filterBy:p,paginationParameters:I,invalidate:g,access:A,refetch:_}=(0,i.J)({queryFn:h,endpointId:o.U.BalanceAdjustment.page,datasetId:c.i.BalanceAdjustment,filter:{filterFn:w}});async function w(a){let{filters:r,pagination:n}=a;return(null==r?void 0:r.qry)?await e({extension:o.U.BalanceAdjustment.snapshot,parameters:"_filter=".concat(r.qry)}):h({_startAt:n._startAt||0,params:null==r?void 0:r.params})}async function h(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{_startAt:r=0,_pageSize:n=50,params:t}=a,l="_startAt=".concat(r,"&_pageSize=").concat(n,"&_params=").concat(t||"");return{...await e({extension:o.U.BalanceAdjustment.page,parameters:l}),_startAt:r}}let D=[{field:"reference",headerName:x.reference,flex:1},{field:"date",headerName:x.date,flex:1,type:"date"},{field:"employeeName",headerName:x.employee,flex:1},{field:"scheduleRef",headerName:x.schedule,flex:1},{field:"leaveTrackTimeName",headerName:x.leaveTrackTime,flex:1},{field:"effectiveDate",headerName:x.effectiveDate,flex:1,type:"date"},{field:"hours",headerName:x.hours,flex:1},{field:"duration",headerName:x.duration,flex:1},{field:"notes",headerName:x.notes,flex:1}],{proxyAction:b}=(0,N.G)({functionId:j.J.BalanceAdjustment,action:F}),k=async()=>{await b()};function F(e){r({Component:C,props:{labels:x,recordId:e,access:A},width:800,height:600,title:x.BalanceAdjustment})}let S=async e=>{await a({extension:o.U.BalanceAdjustment.del,record:JSON.stringify(e)}),g(),l.ZP.success(f.Deleted)};return(0,n.jsxs)(u.R,{children:[(0,n.jsx)(m.g,{children:(0,n.jsx)(Z.Z,{onAdd:k,maxAccess:A,reportName:"LMBA",filterBy:p})}),(0,n.jsx)(v.Q,{children:(0,n.jsx)(d.Z,{columns:D,gridData:y,rowId:["recordId"],onEdit:e=>{F(e.recordId)},onDelete:S,isLoading:!1,pageSize:50,maxAccess:A,refetch:_,paginationParameters:I,paginationType:"api"})})]})}},1685:function(e,a,r){"use strict";r.d(a,{m:function(){return n}});let n=e=>{let a=window.sessionStorage.getItem(e);return a?JSON.parse(a):null}},98345:function(e,a,r){"use strict";r.d(a,{H:function(){return h},G:function(){return f}});var n=r(45300),t=r(2784),l=r(96026),d=r(38449);r(26612);var s=r(65947),o=r(1685);let c=async(e,a,r)=>{try{let n=await e({extension:a,parameters:r});return a.includes("qry")?n:n.record}catch(e){return null}},i=(e,a,r,n)=>{let t=(e=JSON.parse(JSON.stringify(e))).record.controls,l=t.find(e=>"reference"===e.controlId);return l?l.accessLevel=(null==a?void 0:a.mandatory)?s.$7:s.rr:(null==a?void 0:a.mandatory)?t.push({sgId:0,resourceId:"",controlId:"".concat(n?n+".":"","reference"),accessLevel:(null==a?void 0:a.mandatory)?s.$7:s.rr}):(null==a?void 0:a.readOnly)?t.push({sgId:0,resourceId:"",controlId:"".concat(n?n+".":"","reference"),accessLevel:(null==a?void 0:a.readOnly)?s.rr:s.$7}):t=e.record.controls.filter(e=>"reference"!=e.controlId),r&&t.push({sgId:0,resourceId:"",controlId:"".concat(n?n+".":"","dtId"),accessLevel:s.$7}),{...e,record:{...e.record,controls:t}}},u=async(e,a,r)=>{let n,t;switch(r){case"dtId":let l=(0,o.m)("userData"),s=null==l?void 0:l.userId;t="_userId=".concat(s,"&_functionId=").concat(a),n=d.r.UserFunction.get;break;case"glbSysNumberRange":t="_recordId=".concat(a),n=d.r.SystemFunction.get;break;case"DocumentType":t="_dgId=".concat(a,"&_startAt=",0,"&_pageSize=",50),n=d.r.DocumentType.qry;break;case"DcTypNumberRange":t="_recordId=".concat(a),n=d.r.DocumentType.get;break;case"isExternal":t="_recordId=".concat(a),n=d.r.NumberRange.get;break;default:return null}return await c(e,n,t)},m=async function(e){let a,r,n,t,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,d=arguments.length>2?arguments[2]:void 0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,o=!(arguments.length>4)||void 0===arguments[4]||arguments[4],c=arguments.length>5?arguments[5]:void 0,m=void 0===s&&l&&await u(e,l,"dtId"),v=null==m?void 0:m.dtId,f="",h=!0;if(m&&void 0===s||"nraId"===s){if(v){let r=await u(e,v,"DcTypNumberRange");a=null==r?void 0:r.nraId,h=!((null==r?void 0:r.activeStatus)<0),a||(f="Assign the document type to a number range")}if((!v||!h)&&o&&l){var y;let a=await u(e,l,"DocumentType");t=(null==a?void 0:null===(y=a.list)||void 0===y?void 0:y.filter(e=>(null==e?void 0:e.activeStatus)===1).length)>0}}if(("nraId"===s||void 0===s)&&l){if((!v||v)&&!a||a&&!h){let r=await u(e,l,"glbSysNumberRange");(a=null==r?void 0:r.nraId)&&t&&(t=!1),h=!0}f=a||t?"":"Assign the system Function to a number range"}s>0&&!a&&(a=s),a&&h?(r={readOnly:null==(n=await u(e,a,"isExternal"))||!n.external,mandatory:null!=n&&!!n.external},d&&(d=await i(d,r,t,c))):!a&&d&&(d=await i(d,r,t,c));let x=c?"".concat(c,".reference"):"reference";return{dtId:v,resetReference:null==r?void 0:r.readOnly,dcTypeRequired:t,reference:{fieldName:x,isEmpty:(null==n?void 0:n.external)!==void 0&&(null==n||!n.external)},errorMessage:f,maxAccess:d,selectNraId:s}};var v=r(65950);function f(e){let{functionId:a,action:r,hasDT:n}=e,{getRequest:d}=(0,t.useContext)(v.$),{stack:s}=(0,l.V)();return{proxyAction:async()=>{let e=await m(d,a,"",void 0,n);(null==e?void 0:e.errorMessage)?s({message:null==e?void 0:e.errorMessage}):await r()}}}function h(e){var a;let{functionId:r,access:d,hasDT:s,enabled:o=!0,objectName:c=""}=e,{getRequest:i}=(0,t.useContext)(v.$),{stack:u}=(0,l.V)(),[f,h]=(0,t.useState)(),y=async e=>{let a=await m(i,r,d,e,s,c);if(!a.errorMessage)return a;u({message:null==a?void 0:a.errorMessage})},x=(0,n.a)({retry:!1,staleTime:0,enabled:o,queryKey:[r,f,!!d,o],queryFn:f||"nraId"===f?()=>y(f):()=>y()});return{documentType:x.data,maxAccess:(null==x?void 0:null===(a=x.data)||void 0===a?void 0:a.maxAccess)||d,changeDT(e){h((null==e?void 0:e.nraId)||"nraId")}}}}},function(e){e.O(0,[92515,2494,36908,49774,92888,40179],function(){return e(e.s=13863)}),_N_E=e.O()}]);