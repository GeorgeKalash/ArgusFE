(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[87018],{6553:function(e,a,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/iv-metals",function(){return r(2507)}])},2507:function(e,a,r){"use strict";r.r(a),r.d(a,{default:function(){return k}});var t=r(52322),n=r(2784),s=r(62202),l=r(69387),i=r(27723),o=r(65950),c=r(71987),d=r(26612),u=r(31389),m=r(33625),p=r(62362),b=r(61802),h=r(29326),x=r(9522),v=r(60218),f=r(48601),_=r(82737),y=r(5088),I=r(80983),g=r(65215),C=r(38449),j=r(8661),P=r(91406),Z=r(19473);function N(e){let{labels:a,maxAccess:r,setStore:l,store:i}=e,{recordId:m}=i,{getRequest:b,postRequest:h}=(0,n.useContext)(o.$),{platformLabels:x}=(0,n.useContext)(Z.l),N=(0,c.E)({endpointId:g.$.Metals.page}),{formik:T}=(0,I.c)({initialValues:{recordId:i.recordId,reference:"",purity:"",reportingPurity:"",currencyId:null},maxAccess:r,validateOnChange:!0,validateOnBlur:!0,validationSchema:f.Ry({reference:f.Z_().required(),purity:f.Rx().nullable().test("is-valid-purity",function(e){return e>=.001&&e<=1}),reportingPurity:f.Rx().nullable().test("is-valid-reportingPurity",function(e){return!e&&0!==e||e>=.001&&e<=1})}),onSubmit:async e=>{let a=await h({extension:g.$.Metals.set,record:JSON.stringify(e)});e.recordId?s.ZP.success(x.Edited):(l(e=>({...e,recordId:a.recordId})),s.ZP.success(x.Added),T.setFieldValue("recordId",a.recordId)),N()}}),S=!!T.values.recordId;return(0,n.useEffect)(()=>{!async function(){if(m){let e=await b({extension:g.$.Metals.get,parameters:"_recordId=".concat(m)});T.setValues(e.record)}}()},[]),(0,t.jsx)(_.Z,{resourceId:d.i.Metals,form:T,maxAccess:r,editMode:S,children:(0,t.jsx)(u.R,{children:(0,t.jsx)(p.Q,{children:(0,t.jsxs)(v.ZP,{container:!0,spacing:2,children:[(0,t.jsx)(v.ZP,{item:!0,xs:12,children:(0,t.jsx)(y.Z,{name:"reference",label:a.reference,value:T.values.reference,maxLength:"10",required:!0,maxAccess:r,onChange:T.handleChange,onClear:()=>T.setFieldValue("reference",""),error:T.touched.reference&&!!T.errors.reference})}),(0,t.jsx)(v.ZP,{item:!0,xs:12,children:(0,t.jsx)(P.Z,{name:"purity",label:a.purity,value:T.values.purity,required:!0,maxAccess:r,readOnly:S,maxLength:6,decimalScale:5,onChange:T.handleChange,onClear:()=>T.setFieldValue("purity",""),error:T.touched.purity&&!!T.errors.purity})}),(0,t.jsx)(v.ZP,{item:!0,xs:12,children:(0,t.jsx)(j.Z,{endpointId:C.r.Currency.qry,name:"currencyId",label:a.currency,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:T.values,maxAccess:r,onChange:(e,a)=>{T.setFieldValue("currencyId",(null==a?void 0:a.recordId)||null)},error:T.touched.currencyId&&!!T.errors.currencyId})}),(0,t.jsx)(v.ZP,{item:!0,xs:12,children:(0,t.jsx)(P.Z,{name:"reportingPurity",label:a.reportingPurity,value:T.values.reportingPurity,maxAccess:r,allowNegative:!1,maxLength:6,decimalScale:5,onChange:T.handleChange,onClear:()=>T.setFieldValue("reportingPurity",""),error:T.touched.purity&&!!T.errors.reportingPurity})})]})})})})}var T=r(76399),S=r(54074),A=e=>{let{store:a,maxAccess:r,labels:l}=e,{recordId:i}=a,{getRequest:c,postRequest:m}=(0,n.useContext)(o.$),{platformLabels:b}=(0,n.useContext)(Z.l),{formik:h}=(0,I.c)({validateOnChange:!0,maxAccess:r,validationSchema:f.Ry({scrap:f.IX().of(f.Ry().shape({sku:f.Z_().required(),purity:f.Rx().nullable().test("is-valid-purity",function(e){return!e||e>=.001&&e<=1})})).required()}),initialValues:{recordId:i,scrap:[{id:1,metalId:i,seqNo:"",itemId:"",sku:"",itemName:"",laborValuePerGram:"",purity:""}]},onSubmit:e=>{x(e)}}),x=e=>{let a=null==e?void 0:e.scrap.map(e=>{let{id:a,...r}=e;return{...r,metalId:i,seqNo:a}});m({extension:g.$.Scrap.set2,record:JSON.stringify({metalId:i,items:a})}).then(e=>{s.ZP.success(b.Added)})};return(0,n.useEffect)(()=>{i&&c({extension:g.$.Scrap.qry,parameters:"_metalId=".concat(i)}).then(e=>{var a;if((null==e?void 0:null===(a=e.list)||void 0===a?void 0:a.length)>0){let a=e.list.map((e,a)=>({...e,id:a+1}));h.setValues({scrap:a})}})},[]),(0,t.jsx)(S.Z,{onSave:h.handleSubmit,resourceId:d.i.Metals,maxAccess:r,editMode:!!i,children:(0,t.jsx)(u.R,{children:(0,t.jsx)(p.Q,{children:(0,t.jsx)(T._,{onChange:e=>h.setFieldValue("scrap",e),value:h.values.scrap,error:h.errors.scrap,columns:[{component:"resourcelookup",label:l.sku,name:"sku",props:{endpointId:g.$.Item.snapshot,valueField:"recordId",displayField:"sku",mapping:[{from:"recordId",to:"itemId"},{from:"sku",to:"sku"},{from:"name",to:"itemName"}],columnsInDropDown:[{key:"sku",value:"SKU"},{key:"name",value:"Name"}],displayFieldWidth:1}},{component:"textfield",label:l.itemName,name:"itemName",props:{readOnly:!0}},{component:"numberfield",label:l.LaborValuePerGram,name:"laborValuePerGram",props:{maxLength:6,decimalScale:2}},{component:"numberfield",label:l.purity,name:"purity",props:{maxLength:6,decimalScale:5}}]})})})})},R=e=>{let{recordId:a,labels:r,maxAccess:s}=e,[l,i]=(0,n.useState)(0),[o,c]=(0,n.useState)({recordId:a||null}),d=[{label:r.metals},{label:r.scrap,disabled:!o.recordId}];return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(x.Y,{tabs:d,activeTab:l,setActiveTab:i,maxAccess:s}),(0,t.jsx)(h.Z,{index:0,value:l,maxAccess:s,children:(0,t.jsx)(N,{labels:r,setStore:c,store:o,maxAccess:s})}),(0,t.jsx)(h.Z,{index:1,value:l,maxAccess:s,children:(0,t.jsx)(A,{labels:r,maxAccess:s,store:o})})]})},k=()=>{let{getRequest:e,postRequest:a}=(0,n.useContext)(o.$),{platformLabels:r}=(0,n.useContext)(Z.l),{stack:h}=(0,b.zY)();async function x(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{_startAt:r=0,_pageSize:t=50}=a;return{...await e({extension:g.$.Metals.page,parameters:"_startAt=".concat(r,"&_pageSize=").concat(t,"&filter=")}),_startAt:r}}let{query:{data:v},labels:f,invalidate:_,refetch:y,paginationParameters:I,access:C}=(0,c.J)({queryFn:x,endpointId:g.$.Metals.page,datasetId:d.i.Metals}),j=[{field:"reference",headerName:f.reference,flex:1},{field:"purity",headerName:f.purity,flex:1},{field:"currencyRef",headerName:f.currency,flex:1}],P=async e=>{try{await a({extension:g.$.Metals.del,record:JSON.stringify(e)}),_(),s.ZP.success(r.Deleted)}catch(e){}};function N(e){h({Component:R,props:{labels:f,recordId:e,maxAccess:C},width:800,height:460,title:f.metals})}return(0,t.jsxs)(u.R,{children:[(0,t.jsx)(m.g,{children:(0,t.jsx)(i.Z,{onAdd:()=>{N()},maxAccess:C})}),(0,t.jsx)(p.Q,{children:(0,t.jsx)(l.Z,{columns:j,gridData:v,rowId:["recordId"],onEdit:e=>{N(null==e?void 0:e.recordId)},onDelete:P,isLoading:!1,pageSize:50,refetch:y,paginationParameters:I,paginationType:"api",maxAccess:C})})]})}},29326:function(e,a,r){"use strict";var t=r(52322);r(2784);var n=r(23925),s=r(13980),l=r.n(s),i=r(95291),o=r.n(i),c=r(65947);let d=e=>{var a,r,s;let{children:l,value:i,index:d,maxAccess:u,...m}=e,p="".concat(e.name||"tab",".").concat(d),{accessLevel:b}=null!==(s=(null!==(r=null==u?void 0:null===(a=u.record)||void 0===a?void 0:a.controls)&&void 0!==r?r:[]).find(e=>e.controlId===p))&&void 0!==s?s:{accessLevel:0};if(b===c.A1)return null;let h=i===d;return(0,t.jsx)(n.Z,{role:"tabpanel",hidden:!h,id:"simple-tabpanel-".concat(d),"aria-labelledby":"simple-tab-".concat(d),className:"".concat(o().tabPanel," ").concat(h?o().active:o().hidden),...m,children:l})};d.propTypes={children:l().node,index:l().number.isRequired,value:l().number.isRequired},a.Z=d},9522:function(e,a,r){"use strict";r.d(a,{Y:function(){return m}});var t=r(52322),n=r(23925),s=r(54582),l=r(68696),i=r(44258),o=r(2784),c=r(99266),d=r(52614),u=r.n(d);let m=e=>{var a,r,d,m,p;let{tabs:b,activeTab:h,setActiveTab:x,maxAccess:v,name:f="tab"}=e,_=(null==v?void 0:null===(r=v.record)||void 0===r?void 0:null===(a=r.controls)||void 0===a?void 0:a.filter(e=>{var a;return 4===e.accessLevel&&(null===(a=e.controlId)||void 0===a?void 0:a.startsWith("".concat(f,".")))}).map(e=>e.controlId.split(".")[1]))||[],y=null==b?void 0:null===(d=b.map((e,a)=>({...e,id:a})))||void 0===d?void 0:d.filter((e,a)=>!_.includes(String(a))),I=null===(m=y[h])||void 0===m?void 0:m.id,g=null===(p=y[h])||void 0===p?void 0:p.disabled;return(0,o.useEffect)(()=>{I>=0&&!g&&h!=I&&x(I)},[]),(0,t.jsx)(n.Z,{className:u().tabsContainer,children:(0,t.jsx)(n.Z,{className:u().tabsWrapper,children:(0,t.jsx)(s.Z,{value:h,onChange:(e,a)=>x(a),variant:"scrollable",scrollButtons:y.length>3?"auto":"off","aria-label":"scrollable tabs",classes:{indicator:u().tabsIndicator},className:u().tabs,children:null==y?void 0:y.map(e=>(0,t.jsx)(l.Z,{value:e.id,disabled:null==e?void 0:e.disabled,className:"".concat(u().tabName," ").concat(e.disabled?u().tabDisabled:""),classes:{root:u().tabRoot,selected:u().selectedTab},label:(0,t.jsxs)(n.Z,{display:"flex",alignItems:"center",children:[(0,t.jsx)("span",{children:e.label}),e.id===h&&(null==e?void 0:e.onRefetch)&&(0,t.jsx)(i.Z,{size:"small",className:u().refreshButton,onClick:a=>{a.stopPropagation(),e.onRefetch()},children:(0,t.jsx)(c.Z,{className:u().refreshIcon})})]})},e.id))})})})}},95291:function(e){e.exports={tabPanel:"CustomTabPanel_tabPanel__80Dfu",active:"CustomTabPanel_active___6Uvb",hidden:"CustomTabPanel_hidden__y9566"}},52614:function(e){e.exports={customTabPanel:"CustomTabs_customTabPanel__Ztocv",hidden:"CustomTabs_hidden__lZpM7",tabsContainer:"CustomTabs_tabsContainer__28Syi",tabsWrapper:"CustomTabs_tabsWrapper__mlxxj",tabs:"CustomTabs_tabs__25pli",tabName:"CustomTabs_tabName__XzMCn",tabRoot:"CustomTabs_tabRoot__WVR1E",tabDisabled:"CustomTabs_tabDisabled__VauYR",selectedTab:"CustomTabs_selectedTab__sZzwF",tabsIndicator:"CustomTabs_tabsIndicator__89Lek",refreshButton:"CustomTabs_refreshButton__P2mzl",refreshIcon:"CustomTabs_refreshIcon__ADVWF"}}},function(e){e.O(0,[49774,92888,40179],function(){return e(e.s=6553)}),_N_E=e.O()}]);