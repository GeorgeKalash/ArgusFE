(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[45700],{55196:function(e,r,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/sale-zones",function(){return n(97064)}])},97064:function(e,r,n){"use strict";n.r(r),n.d(r,{default:function(){return R}});var t=n(52322),a=n(2784),i=n(62202),l=n(69387),o=n(82235),d=n(65950),s=n(61802),c=n(71987),u=n(26612),p=n(31389),x=n(33625),m=n(62362),f=n(19473),h=n(22341),v=n(60218),I=n(48601),g=n(82737),y=n(5088),Z=n(38449),w=n(8661),S=n(80983),_=n(84100),j=n(27423);function C(e){let{labels:r,maxAccess:n,recordId:l}=e,{getRequest:o,postRequest:s}=(0,a.useContext)(d.$),{platformLabels:x}=(0,a.useContext)(f.l),C=(0,c.E)({endpointId:h.P.SalesZone.page}),{formik:b}=(0,S.c)({maxAccess:n,initialValues:{recordId:null,name:null,szRef:null,countryId:null,productionOrderLevel:null,parentId:null,parentRef:"",parentName:null},validateOnChange:!0,validationSchema:I.Ry({name:I.Z_().required(),szRef:I.Z_().required(),countryId:I.Z_().required()}),onSubmit:async e=>{let r=await s({extension:h.P.SalesZone.set,record:JSON.stringify(e)});e.recordId?i.ZP.success(x.Edited):(i.ZP.success(x.Added),b.setFieldValue("recordId",r.recordId)),C()}}),R=!!b.values.recordId;return(0,a.useEffect)(()=>{!async function(){if(l){let e=await o({extension:h.P.SalesZone.get,parameters:"_recordId=".concat(l)});b.setValues(e.record)}}()},[]),(0,t.jsx)(g.Z,{resourceId:u.i.SalesZone,form:b,maxAccess:n,editMode:R,children:(0,t.jsx)(p.R,{children:(0,t.jsx)(m.Q,{children:(0,t.jsxs)(v.ZP,{container:!0,spacing:2,children:[(0,t.jsx)(v.ZP,{item:!0,xs:12,children:(0,t.jsx)(y.Z,{name:"szRef",label:r.reference,value:b.values.szRef,required:!0,maxAccess:n,onChange:b.handleChange,onClear:()=>b.setFieldValue("szRef",""),error:b.touched.szRef&&!!b.errors.szRef})}),(0,t.jsx)(v.ZP,{item:!0,xs:12,children:(0,t.jsx)(y.Z,{name:"name",label:r.name,value:b.values.name,required:!0,maxAccess:n,maxLength:"30",onChange:b.handleChange,onClear:()=>b.setFieldValue("name",""),error:b.touched.name&&!!b.errors.name})}),(0,t.jsx)(v.ZP,{item:!0,xs:12,children:(0,t.jsx)(w.Z,{endpointId:Z.r.Country.qry,name:"countryId",required:!0,label:r.country,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:b.values,onChange:(e,r)=>{b.setFieldValue("countryId",(null==r?void 0:r.recordId)||"")},error:b.touched.countryId&&!!b.errors.countryId,maxAccess:n})}),(0,t.jsx)(v.ZP,{item:!0,xs:12,children:(0,t.jsx)(w.Z,{datasetId:_.v.PRODUCTION_ORDER_LEVEL,name:"productionOrderLevel",label:r.pol,valueField:"key",displayField:"value",values:b.values,maxAccess:n,onChange:(e,r)=>{b.setFieldValue("productionOrderLevel",null==r?void 0:r.key)}})}),(0,t.jsx)(v.ZP,{item:!0,xs:12,children:(0,t.jsx)(j.U,{endpointId:h.P.SalesZone.qry,parameters:{_startAt:0,_pageSize:3e3,_sortField:"recordId",_filter:""},valueField:"szRef",displayField:"name",name:"parentId",label:r.parent,form:b,valueShow:"parentRef",secondValueShow:"parentName",columnsInDropDown:[{key:"szRef",value:"Reference"},{key:"name",value:"Name"}],maxAccess:n,displayFieldWidth:2,onChange:async(e,r)=>{b.setFieldValue("parentId",null==r?void 0:r.recordId),b.setFieldValue("parentName",null==r?void 0:r.name),b.setFieldValue("parentRef",(null==r?void 0:r.szRef)||"")},errorCheck:"parentId"})})]})})})})}var b=n(27723),R=()=>{let{getRequest:e,postRequest:r}=(0,a.useContext)(d.$),{platformLabels:n}=(0,a.useContext)(f.l),{stack:v}=(0,s.zY)(),[I,g]=(0,a.useState)([]);async function y(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{_startAt:n=0,_pageSize:t=50}=r;return{...await e({extension:h.P.SalesZone.page,parameters:"_pageSize=".concat(t,"&_startAt=").concat(n,"&_filter=&_sortField=")}),_startAt:n}}async function Z(r){let{filters:n,pagination:t}=r;return n.qry?await e({extension:h.P.SalesZone.snapshot,parameters:"_filter=".concat(n.qry,"&_sortField=")}):y({_startAt:t._startAt||0})}let{query:{data:w},labels:S,refetch:_,invalidate:j,paginationParameters:R,access:P,filterBy:k,clearFilter:z}=(0,c.J)({queryFn:y,endpointId:h.P.SalesZone.page,datasetId:u.i.SalesZone,filter:{filterFn:Z}});(0,a.useEffect)(()=>{(async()=>{g(await e({extension:h.P.SalesZone.page,parameters:"_pageSize=1000&_startAt=0&_filter=&_sortField="}))})()},[]);let A=[{field:"szRef",headerName:S.reference,flex:1},{field:"name",headerName:S.name,flex:1},{field:"parentRef",headerName:S.parentRef,flex:1},{field:"parentName",headerName:S.parent,flex:1}],F=async e=>{await r({extension:h.P.SalesZone.del,record:JSON.stringify(e)}),j(),i.ZP.success(n.Deleted)};function T(e){v({Component:C,props:{labels:S,recordId:e,maxAccess:P},width:600,height:450,title:S.saleZones})}function N(){v({Component:o.Z,props:{data:I}})}let E=[{key:"Tree",condition:!0,onClick:N,disabled:!1}];return(0,t.jsxs)(p.R,{children:[(0,t.jsx)(x.g,{children:(0,t.jsx)(b.Z,{onAdd:()=>{T()},maxAccess:P,actions:E,onTree:N,onSearch:e=>{k("qry",e)},onSearchClear:()=>{z("qry")},previewReport:u.i.SalesZone,inputSearch:!0})}),(0,t.jsx)(m.Q,{children:(0,t.jsx)(l.Z,{columns:A,gridData:w,rowId:["recordId"],onEdit:e=>{T(null==e?void 0:e.recordId)},onDelete:F,isLoading:!1,pageSize:50,refetch:_,paginationParameters:R,paginationType:"api",maxAccess:P})})]})}},82235:function(e,r,n){"use strict";var t=n(52322),a=n(2784),i=n(7913),l=n(61676),o=n(44781),d=n(78502),s=n(94045),c=n(55182),u=n(40234),p=n(55648),x=n(27149),m=n(94668),f=n(3),h=n(19473),v=n(21326);let I=e=>{let r=[];return e.forEach(e=>{r.push(e.recordId.toString()),e.children&&(r=r.concat(I(e.children)))}),r},g=e=>{let{nodes:r}=e,n=I(r),a=e=>(0,t.jsx)(Z,{nodeId:e.recordId.toString(),label:e.name,children:Array.isArray(e.children)?e.children.map(e=>a(e)):null},e.recordId);return(0,t.jsx)(y,{"aria-label":"plant tree",expanded:n,defaultCollapseIcon:(0,t.jsx)(s.Z,{}),defaultExpandIcon:(0,t.jsx)(c.Z,{}),children:r.map(e=>a(e))})},y=(0,o.ZP)(i.Z)(e=>{let{theme:r}=e;return{width:"100%",flex:1,minHeight:0,overflowY:"auto",boxSizing:"border-box",padding:0,"--tree-font":"clamp(11px, 0.25vw + 10px, 13px)","--tree-rowH":"clamp(22px, 0.35vw + 20px, 26px)","--tree-py":"0px","--tree-px":"6px","--tree-iconBoxW":"18px","--tree-iconSize":"18px","--tree-indent":"18px","--tree-radius":"0px","& .MuiTreeItem-content":{minHeight:"var(--tree-rowH)",paddingTop:"var(--tree-py)",paddingBottom:"var(--tree-py)",paddingLeft:"var(--tree-px)",paddingRight:"var(--tree-px)",borderRadius:"var(--tree-radius)",alignItems:"center",gap:6},"& .MuiTreeItem-label":{fontSize:"var(--tree-font)",lineHeight:1.2,whiteSpace:"normal",wordBreak:"break-word"},"& .MuiTreeItem-iconContainer":{width:"var(--tree-iconBoxW)",minWidth:"var(--tree-iconBoxW)",marginRight:0,display:"flex",alignItems:"center",justifyContent:"center"},"& .MuiSvgIcon-root":{fontSize:"var(--tree-iconSize)"},"& .MuiTreeItem-group":{marginLeft:"var(--tree-indent)",paddingLeft:0},"& .MuiTreeItem-content:hover":{backgroundColor:r.palette.action.hover},"@media print":{overflowY:"visible","--tree-font":"11pt","--tree-rowH":"auto"},[r.breakpoints.down("sm")]:{"--tree-font":"clamp(10.5px, 0.4vw + 9.5px, 12px)","--tree-rowH":"clamp(20px, 0.4vw + 18px, 24px)","--tree-iconBoxW":"16px","--tree-iconSize":"16px","--tree-indent":"16px","--tree-px":"4px"}}}),Z=(0,o.ZP)(l.Z)(e=>{let{theme:r}=e;return{"&.Mui-selected > .MuiTreeItem-content":{backgroundColor:"#d9d9d9"},"&.Mui-selected > .MuiTreeItem-content:hover":{backgroundColor:"#d9d9d9"},"&.Mui-focused > .MuiTreeItem-content":{backgroundColor:"#d9d9d9"},"& .MuiTreeItem-content .MuiTreeItem-label":{fontSize:"var(--tree-font) !important",lineHeight:"1.2 !important",whiteSpace:"normal",wordBreak:"break-word"}}});function w(e){let{data:r,window:n,printable:i=!0}=e,{platformLabels:l}=(0,a.useContext)(h.l),o=(0,d.Z)();(0,x.Z)(o.breakpoints.down("sm"));let I=(0,a.useRef)();(0,v.Z)({title:l.Tree,window:n});let w=(0,u.useReactToPrint)({content:()=>I.current,documentTitle:"Tree_Structure",removeAfterPrint:!0}),S=(0,a.useMemo)(()=>{if(r){var e,n;let t=new Map(null==r?void 0:null===(e=r.list)||void 0===e?void 0:e.map(e=>[e.recordId,{...e,children:[]}]));return null==r||null===(n=r.list)||void 0===n||n.forEach(e=>{if(e.parentId){let r=t.get(e.parentId);r&&r.children.push(t.get(e.recordId))}}),[...t.values()].filter(e=>!e.parentId)}return[]},[r]),_=e=>(0,t.jsx)(Z,{nodeId:e.recordId.toString(),label:e.name,children:Array.isArray(e.children)?e.children.map(e=>_(e)):null},e.recordId);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(m.Z,{sx:{p:0,display:"flex",flexDirection:"column",width:"100%",height:"100%",minHeight:0,overflow:"hidden"},children:[(0,t.jsx)(y,{"aria-label":"plant tree",defaultCollapseIcon:(0,t.jsx)(s.Z,{}),defaultExpandIcon:(0,t.jsx)(c.Z,{}),children:S.map(e=>_(e))}),(0,t.jsx)("div",{style:{display:"none",visibility:"hidden"},children:(0,t.jsx)("div",{ref:I,children:(0,t.jsx)(g,{nodes:S})})})]}),(0,t.jsx)(f.Z,{sx:{p:0,width:"100%"},children:(0,t.jsx)(p.Z,{actions:i?[{key:"Print",condition:!0,onClick:w,disabled:!1}]:[],isCleared:!1,isSaved:!1,isInfo:!1})})]})}w.width=500,w.height=400,r.Z=w}},function(e){e.O(0,[40234,9783,49774,92888,40179],function(){return e(e.s=55196)}),_N_E=e.O()}]);