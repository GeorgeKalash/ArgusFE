(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9469],{67673:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/batchImports/[resourceId]",function(){return n(68784)}])},68784:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return o}});var r=n(52322),i=n(61802),a=n(63165),l=n(84309),s=n(9657),c=n(71987),o=()=>{let{stack:e}=(0,i.zY)(),{resourceId:t}=(0,a.F)(),{access:n}=(0,c.J)({datasetId:t});return(0,r.jsx)(s.Z,{resourceId:t,access:n,onSuccess:t=>{e({Component:l.R,props:{recordId:t.recordId,access:n},closable:!1})}})}},63165:function(e,t,n){"use strict";n.d(t,{F:function(){return a}});var r=n(5632),i=n(2784);let a=()=>{let e=(0,r.useRouter)(),[t,n]=(0,i.useState)(e.query);return t}},9657:function(e,t,n){"use strict";var r=n(52322),i=n(2784),a=n(60218),l=n(62202),s=n(33625),c=n(62362),o=n(31389),d=n(27723),u=n(5088),f=n(69387),p=n(39812),m=n(65950),h=n(38449),x=n(96026),g=n(21326),v=n(19473),w=n(54074),j=n(69627);let y=e=>{let[t,n,r]=e.split("/").map(e=>parseInt(e,10));return new Date(Date.UTC(r<100?2e3+r:r,n-1,t,0,0,0)).toISOString().split(".")[0]+"Z"},P=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(""===e)return e;switch(t){case 2:return parseInt(e,10);case 3:return parseFloat(e);case 5:return n?y(e):(0,p.L6)((0,p.p6)(e));default:return e}},b=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=e.split("\n").filter(e=>e.trim());if(!r.length)return{count:0,list:[]};let i=r[0].split(",").map(e=>e.trim()),a=t.reduce((e,t)=>(e[t.headerName]=t,e),{}),l=i.map(e=>a[e]),s=r.slice(1).map((e,t)=>{let r=e.split(",").map(e=>e.trim()),a=l.reduce((e,t,n)=>{let a=i[n];return t?e[t.field]=P(r[n],t.dataType):e[a]=r[n],e},{recordId:t+1});return n.forEach(e=>{i.includes(e.field),a[e.field]=e.value}),a.minPrice&&(a.minPrice=parseFloat(a.minPrice)||0),a});return{count:s.length,list:s}},Z=(e,t,n)=>{let r=t.filter(e=>e.mandatory),i=[...new Set(e.flatMap(e=>r.filter(t=>null===e[t.field]||void 0===e[t.field]||""===e[t.field]).map(e=>e.headerName)))];return!i.length||(n({message:"".concat(i.join(", ")," ").concat(i.length>1?"are":"is"," mandatory.")}),!1)},I=(e,t,n)=>{let r=t.filter(e=>e.mandatory),i=e.list.flatMap(e=>r.filter(t=>null===e[t.field]||void 0===e[t.field]||""===e[t.field]).map(e=>e.headerName));if(i.length>0){let e=[...new Set(i)];n({message:"".concat(e.join(", ")," ").concat(e.length>1?"are":"is"," mandatory field").concat(e.length>1?"s":"",".")})}return e.list.map(e=>Object.keys(e).reduce((n,r)=>{let i=t.find(e=>e.field===r),a=e[r];return a=""===a?null:a,n[r]=i?P(a,i.dataType,!0):a,n},{}))},S=e=>{var t;let{staticColumns:n=[],onSuccess:p,resourceId:y,access:P,window:S}=e,{stack:_}=(0,x.V)(),{getRequest:C,postRequest:k}=(0,i.useContext)(m.$),{platformLabels:N}=(0,i.useContext)(v.l),[T,E]=(0,i.useState)(null),[O,L]=(0,i.useState)({count:0,list:[]}),[z,R]=(0,i.useState)(null),A=(0,i.useRef)(null);if((0,g.Z)({title:N.import,window:S}),(0,i.useEffect)(()=>{y&&C({extension:h.r.ETL.get,parameters:"_resourceId=".concat(y)}).then(e=>{e.record&&E(e)})},[y]),!(null==T?void 0:T.record))return null;let q=(null===(t=T.record.fields)||void 0===t?void 0:t.map(e=>{let{name:t,dataType:n,format:r,...i}=e;return{field:t,headerName:t,width:130,type:2===n&&"1"===r||3===n?"number":void 0,dataType:n,...i}}))||[],F=q.map(e=>e.field),D=[...n.filter(e=>!F.includes(e.field)).map(e=>({field:e.field,headerName:e.field,width:130,dataType:1,readOnly:!0})),...q],M=T.record.objectName,J=T.record.endPoint,Q=async()=>{let e=Z(O.list,D,_),t=I(O,D,_);if(!e)return;let n=await k({extension:J,record:JSON.stringify({[M]:t})});null==p||p(n),l.ZP.success(N.Imported),S&&S.close()},V=[{key:"Import",condition:!0,onClick:Q,disabled:!(null==z?void 0:z.name)}];return(0,r.jsx)(w.Z,{onSave:Q,disabledSubmit:!(null==z?void 0:z.name),isSaved:!1,actions:V,maxAccess:P,isParentWindow:!1,children:(0,r.jsxs)(o.R,{children:[(0,r.jsx)(s.g,{children:(0,r.jsx)(d.Z,{leftSection:(0,r.jsx)(a.ZP,{container:!0,spacing:2,alignItems:"center",children:(0,r.jsx)(a.ZP,{item:!0,xs:4,children:(0,r.jsxs)(a.ZP,{item:!0,sx:{display:"flex",mr:2},children:[(0,r.jsx)(u.Z,{name:"name",label:null==N?void 0:N.SelectCSV,value:null==z?void 0:z.name,readOnly:!0,disabled:!!(null==z?void 0:z.name)}),(0,r.jsx)(j.Z,{label:"".concat(null==N?void 0:N.Browse,"..."),disabled:!!(null==z?void 0:z.name),onClick:()=>A.current.click(),style:{marginLeft:2}}),(0,r.jsx)("input",{type:"file",accept:".csv",ref:A,style:{display:"none"},onChange:e=>{let t=e.target.files[0];if(R(t),t){let e=new FileReader;e.onload=e=>{L(b(e.target.result,D,n))},e.readAsText(t)}}}),(0,r.jsx)(j.Z,{image:"clear.png",tooltipText:null==N?void 0:N.Clear,onClick:()=>{R(null),L({count:0,list:[]}),A.current&&(A.current.value=null)},style:{marginLeft:2,backgroundColor:"#f44336",padding:0}})]})})})})}),(0,r.jsx)(c.Q,{children:(0,r.jsx)(f.Z,{name:"import",columns:[{field:"recordId",headerName:"",width:130},...D],gridData:O,rowId:["recordId"],isLoading:!1,pageSize:50,paginationType:"api",pagination:!1,maxAccess:P,textTransform:!0})})]})})};S.width=1e3,S.height=600,t.Z=S},84309:function(e,t,n){"use strict";n.d(t,{R:function(){return N}});var r=n(73235),i=n(52322),a=n(3854),l=n(2784),s=n(82737),c=n(65950),o=n(62362),d=n(31389),u=n(60218),f=n(21581),p=n(38449),m=n(5088),h=n(19473),x=n(21326);function g(){let e=(0,r._)(["\n  container-type: inline-size;\n  font-size: clamp(12px, 3.2cqw, 16px);\n"]);return g=function(){return e},e}function v(){let e=(0,r._)(["\n  font-size: clamp(10px, 2.2cqw, 12px);\n  font-weight: 600;\n  color: #888888;\n  position: absolute;\n  width: 100%;\n  text-align: center;\n  top: 50%;\n  transform: translateY(-50%);\n"]);return v=function(){return e},e}function w(){let e=(0,r._)(["\n  font-size: clamp(11px, 2.4cqw, 13px);\n  font-weight: 600;\n  margin-bottom: 3px;\n  margin-top: 5px;\n  color: #000;\n"]);return w=function(){return e},e}function j(){let e=(0,r._)(["\n  width: 100%;\n  height: clamp(28px, 7cqw, 35px);\n  background-color: #f0f0f0;\n  border-radius: 5px;\n  overflow: hidden;\n  margin: 10px 0;\n  position: relative;\n"]);return j=function(){return e},e}function y(){let e=(0,r._)(["\n  container-type: inline-size;\n"]);return y=function(){return e},e}function P(){let e=(0,r._)(["\n  height: 100%;\n  background-color: #cce6ff;\n  transition: width 1.5s ease-in-out;\n"]);return P=function(){return e},e}let b=a.ZP.div(g()),Z=a.ZP.span(v()),I=a.ZP.span(w()),S=a.ZP.div(j()),_=a.ZP.div(y()),C=a.ZP.div(P());function k(e){let{label:t,topLabel:n,width:r}=e;return(0,i.jsxs)("div",{children:[(0,i.jsxs)(I,{children:[n,": "]}),(0,i.jsxs)(S,{children:[(0,i.jsx)(C,{style:{width:r}}),(0,i.jsx)(Z,{children:t})]})]})}let N=e=>{let{recordId:t,onComplete:n,access:r,window:a}=e,{getRequest:g}=(0,l.useContext)(c.$),{platformLabels:v}=(0,l.useContext)(h.l);(0,x.Z)({title:v.Progress,window:a});let[w,j]=(0,l.useState)({recordId:t,iterations:0,completed:0,phases:0,currentPhase:0,currentPhaseName:"",logInfo:"",status:0}),y=async()=>(await g({extension:p.r.THD.get,parameters:"_recordId=".concat(t)})).record,P=w.currentPhase===w.phases&&w.completed===w.iterations,Z=!!w.status&&w.status<0;(0,l.useEffect)(()=>{n&&(P||Z)&&n()},[Z,P]),(0,l.useEffect)(()=>{(async()=>{j(await y())})();let e=setInterval(async()=>{let t=await y();j(t);let n=t.currentPhase===t.phases&&t.completed===t.iterations,r=!!t.status&&t.status<0;(t.status&&t.status<0||n||r)&&clearInterval(e)},2e3);return()=>clearInterval(e)},[]);let I=w.phases?w.currentPhase/w.phases*100:0,S=w.iterations?w.completed/w.iterations*100:0;return(0,i.jsx)(s.Z,{form:w,maxAccess:r,isInfo:!1,editMode:!0,isCleared:!1,actions:[{key:"Cancel",condition:!0,onClick:()=>a.close(),disabled:!P&&!Z}],isSaved:!1,children:(0,i.jsx)(d.R,{children:(0,i.jsx)(o.Q,{children:(0,i.jsxs)(b,{children:[(0,i.jsx)(u.ZP,{item:!0,xs:12,children:(0,i.jsx)(m.Z,{name:"phase",label:v.Phase,value:w.currentPhaseName,readOnly:!0,maxAccess:r})}),(0,i.jsxs)(_,{children:[(0,i.jsx)(k,{label:"".concat(v.Step," ").concat(w.currentPhase," of ").concat(w.phases,"..."),topLabel:v.currentPhase,width:"".concat(I,"%")}),(0,i.jsx)(k,{label:"".concat(v.Step," ").concat(w.completed," of ").concat(w.iterations,"..."),topLabel:v.Completed,width:"".concat(S,"%")})]}),(0,i.jsx)(f.Z,{name:"log",label:v.Log,value:w.logInfo,rows:4,maxAccess:r,readOnly:!0})]})})})})};N.width=500,N.height=450}},function(e){e.O(0,[3854,49774,92888,40179],function(){return e(e.s=67673)}),_N_E=e.O()}]);