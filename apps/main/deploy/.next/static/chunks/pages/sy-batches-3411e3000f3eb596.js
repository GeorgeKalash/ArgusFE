(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[90066],{79362:function(e,n,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/sy-batches",function(){return a(21517)}])},21517:function(e,n,a){"use strict";a.r(n),a.d(n,{default:function(){return F}});var r=a(52322),t=a(2784),d=a(62202),c=a(69387),s=a(27723),i=a(65950),l=a(71987),o=a(26612),u=a(31389),h=a(33625),f=a(62362),x=a(61802),m=a(19473),p=a(38449),g=a(60218),v=a(48601),I=a(82737),_=a(5088),C=a(80983),y=a(8661),j=a(84100),w=a(89330),Z=a(39812);function N(e){var n;let{labels:a,maxAccess:c,recordId:s}=e,{getRequest:h,postRequest:x}=(0,t.useContext)(i.$),{platformLabels:N}=(0,t.useContext)(m.l),F=(0,l.E)({endpointId:p.r.Batch.page}),{formik:A}=(0,C.c)({initialValues:{recordId:null,reference:"",name:"",functionId:null,date:new Date},maxAccess:c,validateOnChange:!0,validationSchema:v.Ry({reference:v.Z_().required(),name:v.Z_().required(),functionId:v.Rx().required(),date:v.hT().required()}),onSubmit:async e=>{let n={...e,date:(0,Z.ku)(e.date)},a=await x({extension:p.r.Batch.set,record:JSON.stringify(n)});d.ZP.success(e.recordId?N.Edited:N.Added),await q(a.recordId),F()}}),S=!!A.values.recordId,q=async e=>{if(e){let n=await h({extension:p.r.Batch.get,parameters:"_recordId=".concat(e)});A.setValues({...n.record,date:(0,Z.a1)(n.record.date)})}};return(0,t.useEffect)(()=>{!async function(){await q(s)}()},[]),(0,r.jsx)(I.Z,{resourceId:o.i.Batches,form:A,maxAccess:c,editMode:S,children:(0,r.jsx)(u.R,{children:(0,r.jsx)(f.Q,{children:(0,r.jsxs)(g.ZP,{container:!0,spacing:2,children:[(0,r.jsx)(g.ZP,{item:!0,xs:12,children:(0,r.jsx)(_.Z,{name:"reference",label:a.reference,value:A.values.reference,required:!0,maxAccess:c,maxLength:"30",onChange:A.handleChange,onClear:()=>A.setFieldValue("reference",""),error:A.touched.reference&&!!A.errors.reference})}),(0,r.jsx)(g.ZP,{item:!0,xs:12,children:(0,r.jsx)(_.Z,{name:"name",label:a.name,value:A.values.name,required:!0,maxLength:"50",maxAccess:c,onChange:A.handleChange,onClear:()=>A.setFieldValue("name",""),error:A.touched.name&&!!A.errors.name})}),(0,r.jsx)(g.ZP,{item:!0,xs:12,children:(0,r.jsx)(y.Z,{datasetId:j.v.SYSTEM_FUNCTION,name:"functionId",label:a.systemFunction,required:!0,valueField:"key",displayField:"value",values:A.values,maxAccess:c,onClear:()=>A.setFieldValue("functionId",null),onChange:(e,n)=>{A.setFieldValue("functionId",(null==n?void 0:n.key)||null)},error:A.touched.functionId&&!!A.errors.functionId})}),(0,r.jsx)(g.ZP,{item:!0,xs:12,children:(0,r.jsx)(w.Z,{name:"date",required:!0,label:a.date,value:null==A?void 0:null===(n=A.values)||void 0===n?void 0:n.date,onChange:A.setFieldValue,maxAccess:c,onClear:()=>A.setFieldValue("date",null),error:A.touched.date&&!!A.errors.date})})]})})})})}var F=()=>{let{getRequest:e,postRequest:n}=(0,t.useContext)(i.$),{platformLabels:a}=(0,t.useContext)(m.l),{stack:g}=(0,x.zY)();async function v(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{_startAt:a=0,_pageSize:r=50}=n;return{...await e({extension:p.r.Batch.page,parameters:"_startAt=".concat(a,"&_pageSize=").concat(r,"&_filter=")}),_startAt:a}}let{query:{data:I},labels:_,paginationParameters:C,refetch:y,access:j,search:w,clear:Z,invalidate:F}=(0,l.J)({queryFn:v,endpointId:p.r.Batch.page,datasetId:o.i.Batches,search:{searchFn:A}});async function A(n){let{qry:a}=n;return await e({extension:p.r.Batch.snapshot,parameters:"_filter=".concat(a)})}let S=[{field:"date",headerName:_.date,flex:1,type:"date"},{field:"reference",headerName:_.reference,flex:1},{field:"name",headerName:_.name,flex:1},{field:"functionName",headerName:_.systemFunction,flex:1}];function q(e){g({Component:N,props:{labels:_,recordId:e,maxAccess:j},width:600,height:400,title:_.Batch})}let B=async e=>{await n({extension:p.r.Batch.del,record:JSON.stringify(e)}),F(),d.ZP.success(a.Deleted)};return(0,r.jsxs)(u.R,{children:[(0,r.jsx)(h.g,{children:(0,r.jsx)(s.Z,{onAdd:()=>{q()},maxAccess:j,onSearch:w,onSearchClear:Z,labels:_,inputSearch:!0})}),(0,r.jsx)(f.Q,{children:(0,r.jsx)(c.Z,{columns:S,gridData:I,rowId:["recordId"],onEdit:e=>{q(null==e?void 0:e.recordId)},onDelete:B,isLoading:!1,pageSize:50,refetch:y,paginationParameters:C,paginationType:"api",maxAccess:j})})]})}}},function(e){e.O(0,[49774,92888,40179],function(){return e(e.s=79362)}),_N_E=e.O()}]);