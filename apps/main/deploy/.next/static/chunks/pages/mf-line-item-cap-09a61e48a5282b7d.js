(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[65038],{44187:function(e,a,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/mf-line-item-cap",function(){return t(13590)}])},13590:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return L}});var n=t(52322),l=t(2784),i=t(62202),r=t(69387),s=t(65950),d=t(26612),o=t(61802),c=t(71987),u=t(33625),m=t(31389),p=t(62362),f=t(19473),h=t(36908),I=t(90587),y=t(60218),v=t(82737),x=t(80983),b=t(48601),g=t(27423),C=t(65215),_=t(76399),N=t(5088),k=t(67920);function F(e){let{labels:a,access:t,obj:r}=e,{getRequest:o,postRequest:h}=(0,l.useContext)(s.$),{platformLabels:F}=(0,l.useContext)(f.l),{itemId:L,itemName:j,sku:w,classRef:P,className:S}=r||{},O=(0,c.E)({endpointId:I.u.LineItemCapacity.page}),{schema:V,requiredFields:A}=(0,k.m)({lineId:e=>(null==e?void 0:e.lineId)>0,fullCapacityWgtPerHr:e=>(null==e?void 0:e.fullCapacityWgtPerHr)!=null,preparationHrs:e=>(null==e?void 0:e.preparationHrs)!=null,nbOfLabors:e=>(null==e?void 0:e.nbOfLabors)!=null},!0,t,"data"),{formik:H}=(0,x.c)({initialValues:{itemId:null,itemName:"",sku:"",class:"",data:[{id:1,lineId:null,fullCapacityWgtPerHr:null,preparationHrs:null,nbOfLabors:null}]},maxAccess:t,conditionSchema:["data"],validateOnChange:!0,validationSchema:b.Ry({itemId:b.Rx().required(),data:b.IX().of(V)}),onSubmit:async e=>{await h({extension:I.u.LineItemCapacity.set2,record:JSON.stringify({...e,data:e.data.filter(e=>{var a;return null===(a=Object.values(A))||void 0===a?void 0:a.every(a=>a(e))}).map(a=>{let{id:t,lineName:n,lineRef:l,...i}=a;return{...i,lineId:i.lineId||null,itemId:e.itemId}})})}),i.ZP.success(e.recordId?F.Edited:F.Added),O()}}),R=!!L;(0,l.useEffect)(()=>{!async function(){if(L){H.setFieldValue("itemId",L),H.setFieldValue("itemName",j),H.setFieldValue("sku",w),H.setFieldTouched("class",P?"".concat(P," ").concat(S):"");let{list:e}=await o({extension:I.u.LineItemCapacity.qry,parameters:"_params=1|".concat(L)});H.setFieldValue("data",null==e?void 0:e.map((e,a)=>({id:a+1,...e})))}}()},[]);let E=[{component:"resourcecombobox",label:a.line,name:"lineId",props:{endpointId:I.u.ProductionLine.qry,displayField:"reference",valueField:"recordId",displayFieldWidth:2,mapping:[{from:"recordId",to:"lineId"},{from:"name",to:"lineName"},{from:"reference",to:"lineRef"}],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}]}},{component:"numberfield",label:a.fullCapacity,name:"fullCapacityWgtPerHr",props:{decimalScale:2,maxLength:9}},{component:"numberfield",label:a.startStopHrs,name:"preparationHrs",props:{decimalScale:2,maxLength:5}},{component:"numberfield",label:a.nbLabors,name:"nbOfLabors",props:{decimalScale:0,maxLength:4}}];return(0,n.jsx)(v.Z,{resourceId:d.i.LineItemCapacity,form:H,maxAccess:t,editMode:R,isInfo:!1,children:(0,n.jsxs)(m.R,{children:[(0,n.jsx)(u.g,{children:(0,n.jsxs)(y.ZP,{container:!0,spacing:2,children:[(0,n.jsx)(y.ZP,{item:!0,xs:12,children:(0,n.jsx)(y.ZP,{item:!0,xs:8,children:(0,n.jsx)(g.U,{endpointId:C.$.Item.snapshot,parameters:{_size:30,_startAt:0,_categoryId:0,_msId:0},name:"itemId",label:a.sku,valueField:"sku",displayField:"name",readOnly:R,valueShow:"sku",secondValueShow:"itemName",form:H,required:!0,displayFieldWidth:2,columnsInDropDown:[{key:"sku",value:"SKU"},{key:"name",value:"Name"}],onChange:async(e,a)=>{if(H.setFieldValue("itemId",(null==a?void 0:a.recordId)||null),H.setFieldValue("itemName",(null==a?void 0:a.name)||""),H.setFieldValue("sku",(null==a?void 0:a.sku)||""),null==a?void 0:a.recordId){let{record:e}=await o({extension:C.$.ItemProduction.get,parameters:"_recordId=".concat(null==a?void 0:a.recordId)});H.setFieldValue("class",(null==e?void 0:e.classId)?"".concat(null==e?void 0:e.classRef," ").concat(null==e?void 0:e.className):"")}},errorCheck:"itemId",maxAccess:t})})}),(0,n.jsx)(y.ZP,{item:!0,xs:4,children:(0,n.jsx)(N.Z,{name:"class",label:a.prodClass,readOnly:!0,value:H.values.class})})]})}),(0,n.jsx)(p.Q,{children:(0,n.jsx)(_._,{onChange:e=>H.setFieldValue("data",e),columns:E,value:H.values.data,error:H.errors.data,name:"data",maxAccess:t,initialValues:H.initialValues.data[0]})})]})})}var L=()=>{let{getRequest:e,postRequest:a}=(0,l.useContext)(s.$),{platformLabels:t}=(0,l.useContext)(f.l),{stack:y}=(0,o.zY)();async function v(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{_startAt:t=0,_pageSize:n=50,params:l}=a;return{...await e({extension:I.u.LineItemCapacity.page,parameters:"_startAt=".concat(t,"&_pageSize=").concat(n,"&_params=").concat(l||"","&_filter=")}),_startAt:t}}async function x(e){let{filters:a,pagination:t}=e;return v({_startAt:t._startAt||0,params:null==a?void 0:a.params})}let{query:{data:b},labels:g,refetch:C,access:_,invalidate:N,paginationParameters:k,filterBy:L}=(0,c.J)({queryFn:v,endpointId:I.u.LineItemCapacity.page,datasetId:d.i.LineItemCapacity,filter:{filterFn:x}}),j=[{field:"sku",headerName:g.sku,flex:1},{field:"itemName",headerName:g.name,flex:1},{field:"classRef",headerName:g.prodClass,flex:1},{field:"lineRef",headerName:g.lineRef,flex:1},{field:"fullCapacityWgtPerHr",headerName:g.fullCapacity,flex:1,type:"number"},{field:"preparationHrs",headerName:g.startStopHrs,flex:1,type:"number"},{field:"nbOfLabors",headerName:g.nbLabors,flex:1,type:"number"}],w=async e=>{await a({extension:I.u.LineItemCapacity.del,record:JSON.stringify(e)}),N(),i.ZP.success(t.Deleted)};function P(e){y({Component:F,props:{labels:g,access:_,obj:e},width:750,height:500,title:g.lineItemCapacity})}return(0,n.jsxs)(m.R,{children:[(0,n.jsx)(u.g,{children:(0,n.jsx)(h.Z,{hasSearch:!1,onAdd:()=>{P()},maxAccess:_,filterBy:L,reportName:"MFLIT"})}),(0,n.jsx)(p.Q,{children:(0,n.jsx)(r.Z,{name:"table",columns:j,gridData:b,rowId:["itemId"],onEdit:e=>{P(e)},onDelete:w,maxAccess:_,refetch:C,paginationParameters:k,pageSize:50,paginationType:"api"})})]})}},67920:function(e,a,t){"use strict";t.d(a,{m:function(){return l}});var n=t(48601);function l(e,a,t){var l;let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"items",r={...e};return null==t||null===(l=t.record)||void 0===l||l.controls.forEach(e=>{let{controlId:a,accessLevel:t}=e,[n,l]=null==a?void 0:a.split(".");n!==i||2!==t||l in r||(r[l]=e=>(null==e?void 0:e[l])!=null),(1===t||4===t)&&l in r&&delete r[l]}),{schema:n.Ry().shape({...Object.keys(r).reduce((e,t)=>(e[t]=n.nK().nullable().test(function(e){var n;let l=this.parent,[,i]=this.path.match(/^(\w+)\[(\d+)\]/)||[],s=(null===(n=this.options.context)||void 0===n?void 0:n[i])||[];if(a||!a&&s.length>1){if(null!==l[t]&&void 0!==l[t]&&0!==l[t]&&""!==r[t]&&!r[t](l))return!1;if(!Object.entries(r).some(e=>{let[,a]=e;return!!a(l)}))return!0}return!!r[t](l)&&void 0!==e}),e),{})}),requiredFields:r}}}},function(e){e.O(0,[92515,2494,36908,49774,92888,40179],function(){return e(e.s=44187)}),_N_E=e.O()}]);