(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[317],{5573:function(e,d,l){(window.__NEXT_P=window.__NEXT_P||[]).push(["/fo-wax",function(){return l(630)}])},630:function(e,d,l){"use strict";l.r(d),l.d(d,{default:function(){return P}});var r=l(52322),a=l(2784),n=l(71987),o=l(65950),t=l(69387),i=l(62202),s=l(61802),u=l(26612),c=l(31389),v=l(33625),m=l(62362),h=l(19473),g=l(98345),I=l(7121),f=l(36908),x=l(36773),p=l(60218),y=l(48601),b=l(82737),W=l(5088),w=l(80983),j=l(38449),C=l(8661),N=l(89330),F=l(39812),k=l(91406),_=l(65215),R=l(76399),O=l(90587),q=l(67920);function Z(e){var d,l,t,s,f,Z,P,S,A,V,D,J,T,B,E,L,M,$,z,X,U,G,H,K,Q,Y,ee,ed,el,er,ea,en,eo,et,ei,es,eu,ec,ev,em,eh,eg,eI,ef,ex,ep,ey,eb,eW,ew,ej,eC,eN,eF,ek,e_,eR,eO,eq,eZ,eP,eS,eA,eV;let{labels:eD,access:eJ,recordId:eT,window:eB}=e,{platformLabels:eE}=(0,a.useContext)(h.l),{getRequest:eL,postRequest:eM}=(0,a.useContext)(o.$),[e$,ez]=(0,a.useState)(!1),{documentType:eX,maxAccess:eU,changeDT:eG}=(0,g.H)({functionId:I.J.Wax,access:eJ,enabled:!eT,objectName:"header"}),eH=(0,n.E)({endpointId:x.B.Wax.page}),{schema:eK,requiredFields:eQ}=(0,q.m)({jobId:e=>null==e?void 0:e.jobId,pieces:e=>(null==e?void 0:e.jobId)>0&&(null==e?void 0:e.pieces)<=(null==e?void 0:e.jobPcs)},!0,eU,"items"),{formik:eY}=(0,w.c)({documentType:{key:"header.dtId",value:null==eX?void 0:eX.dtId,reference:null==eX?void 0:eX.reference},conditionSchema:["items"],initialValues:{recordId:null,header:{dtId:null,reference:"",mouldId:null,date:new Date,plantId:null,lineId:null,metalId:null,metalColorId:null,workCenterId:null,factor:0,grossWgt:0,rmWgt:0,mouldWgt:0,netWgt:0,suggestedWgt:0,status:1,wip:1},items:[{id:1,jobId:null,waxId:eT||0,pieces:0,jobPcs:0,classId:null,sku:"",itemName:"",rmWgt:null,metalColorId:null,metalId:null}]},maxAccess:eU,validateOnChange:!0,validationSchema:y.Ry({header:y.Ry({date:y.Z_().required(),mouldId:y.Rx().required(),lineId:y.Rx().required(),metalId:y.Rx().required(),metalColorId:y.Rx().required(),grossWgt:y.Rx().required(),rmWgt:y.Rx().required(),mouldWgt:y.Rx().required(),netWgt:y.Rx().min(0).required(),suggestedWgt:y.Rx().required()}),items:y.IX().of(eK)}),onSubmit:async e=>{let{items:d,header:l}=e,r=await eM({extension:x.B.Wax.set2,record:JSON.stringify({header:l,items:d.filter(e=>{var d;return null===(d=Object.values(eQ))||void 0===d?void 0:d.every(d=>d(e))})})}),a=e.recordId?eE.Edited:eE.Added;i.ZP.success(a),di(r.recordId),eH()}}),e0=!!(null===(d=eY.values)||void 0===d?void 0:d.recordId),e1=(null==eY?void 0:null===(t=eY.values)||void 0===t?void 0:null===(l=t.header)||void 0===l?void 0:l.status)===3,e2=(null==eY?void 0:null===(f=eY.values)||void 0===f?void 0:null===(s=f.header)||void 0===s?void 0:s.wip)===2,e3=e$?eY.values.items.reduce((e,d)=>e+(Number(null==d?void 0:d.rmWgt)||0),0):(null===(Z=eY.values)||void 0===Z?void 0:Z.header.rmWgt)||0,e6=e$?Number((null==eY?void 0:null===(S=eY.values)||void 0===S?void 0:null===(P=S.header)||void 0===P?void 0:P.grossWgt)||0)-Number(e3||0)-Number((null==eY?void 0:null===(V=eY.values)||void 0===V?void 0:null===(A=V.header)||void 0===A?void 0:A.mouldWgt)||0):0,e8=e$?Number((e6||0)*(eY.values.header.factor||0)):Number(eY.values.header.suggestedWgt),e5=async e=>{if(!e)return;let d=await eL({extension:x.B.Wax.get,parameters:"_recordId=".concat(e)});return{...null==d?void 0:d.record,date:(0,F.a1)(null==d?void 0:d.record.date)}},e9=async e=>{var d;if(!e)return;let l=await eL({extension:x.B.WaxJob.qry,parameters:"_waxId=".concat(e)});return(null==l?void 0:null===(d=l.list)||void 0===d?void 0:d.length)>0?l.list.map((e,d)=>({...e,id:d+1})):eY.values.items},e4=async e=>{if(!e)return;let d=await eL({extension:O.u.Design.get,parameters:"_recordId=".concat(e)});return null==d?void 0:d.record},e7=async(e,d)=>{if(!e)return;let l=await eL({extension:O.u.JobRouting.get,parameters:"_jobOrderId=".concat(e,"&_seqNo=").concat(d)});return null==l?void 0:l.record},de=async e=>{var d,l,r,a;if(!e||!(null===(l=eY.values)||void 0===l?void 0:null===(d=l.header)||void 0===d?void 0:d.workCenterId))return;let n=await eL({extension:O.u.JobWorkCenter.get,parameters:"_jobId=".concat(e,"&_workCenterId=").concat(null===(a=eY.values)||void 0===a?void 0:null===(r=a.header)||void 0===r?void 0:r.workCenterId)});return null==n?void 0:n.record},dd=async(e,d)=>{if(!e||!d)return;let l=await eL({extension:x.B.MetalSettings.get,parameters:"_metalId=".concat(e,"&_metalColorId=").concat(d)});return null==l?void 0:l.record};async function dl(e){if(e){var d,l;let r=await eL({extension:O.u.DocumentTypeDefault.get,parameters:"_dtId=".concat(e)});eY.setFieldValue("header.workCenterId",null===(d=r.record)||void 0===d?void 0:d.workCenterId),eY.setFieldValue("header.lineId",null===(l=r.record)||void 0===l?void 0:l.lineId)}else eY.setFieldValue("header.workCenterId",null),eY.setFieldValue("header.lineId",null)}let dr=async()=>{await eM({extension:x.B.Wax.post,record:JSON.stringify(eY.values.header)}),i.ZP.success(eE.Posted),eH(),eB.close()},da=async()=>{await eM({extension:x.B.Wax.unpost,record:JSON.stringify(eY.values.header)}),di(eY.values.recordId),eH()},dn=async()=>{await eM({extension:x.B.Wax.close,record:JSON.stringify(eY.values.header)}),di(eY.values.recordId),eH()},dt=async()=>{await eM({extension:x.B.Wax.reopen,record:JSON.stringify(eY.values.header)}),di(eY.values.recordId),eH()};async function di(e){let d=await e5(e),l=await e9(e),r=await dd(d.metalId,d.metalColorId);eY.setValues({...eY.values,recordId:d.recordId,header:{...eY.values.header,...d,factor:null==r?void 0:r.rate},items:l})}let ds=[{component:"resourcelookup",label:eD.jobOrder,name:"jobId",flex:1,props:{endpointId:O.u.MFJobOrder.snapshot2,parameters:{_workCenterId:null===(J=eY.values)||void 0===J?void 0:null===(D=J.header)||void 0===D?void 0:D.workCenterId},displayField:"jobRef",valueField:"jobRef",mapping:[{from:"jobId",to:"jobId"},{from:"jobRef",to:"jobRef"}],displayFieldWidth:4,readOnly:e2||!(null===(B=eY.values)||void 0===B?void 0:null===(T=B.header)||void 0===T?void 0:T.workCenterId)},async onChange(e){var d,l,r,a,n,o,t,i,s,u,c,v,m;let{row:{update:h,newRow:g}}=e;if(!(null==g?void 0:g.jobId))return;let I=await eL({extension:O.u.MFJobOrder.get,parameters:"_recordId=".concat(null==g?void 0:g.jobId)});h({jobId:(null==g?void 0:g.jobId)||null,jobRef:(null==g?void 0:g.jobRef)||"",routingId:(null===(d=I.record)||void 0===d?void 0:d.routingId)||null,designId:(null===(l=I.record)||void 0===l?void 0:l.designId)||null,designRef:(null===(r=I.record)||void 0===r?void 0:r.designRef)||"",itemName:(null===(a=I.record)||void 0===a?void 0:a.itemName)||"",itemId:(null===(n=I.record)||void 0===n?void 0:n.itemId)||null,category:(null===(o=I.record)||void 0===o?void 0:o.categoryName)||"",sku:(null===(t=I.record)||void 0===t?void 0:t.sku)||"",jobPcs:(null===(i=I.record)||void 0===i?void 0:i.pcs)||0,routingSeqNo:(null===(s=I.record)||void 0===s?void 0:s.routingSeqNo)||1});let f=(null===(u=I.record)||void 0===u?void 0:u.designId)?await e4(null===(c=I.record)||void 0===c?void 0:c.designId):null,x=(null===(v=I.record)||void 0===v?void 0:v.routingSeqNo)?await e7(g.jobId,null==I?void 0:null===(m=I.record)||void 0===m?void 0:m.routingSeqNo):await de(g.jobId);h({classId:null==f?void 0:f.classId,className:null==f?void 0:f.className,classRef:null==f?void 0:f.classRef,standardId:null==f?void 0:f.standardId,standardRef:null==f?void 0:f.standardRef,pieces:parseFloat((null==x?void 0:x.pcs)||0),rmWgt:parseFloat((null==x?void 0:x.qty)||0)}),ez(!0)}},{component:"textfield",label:eD.sku,name:"sku",props:{readOnly:!0}},{component:"textfield",label:eD.itemName,name:"itemName",flex:2,props:{readOnly:!0}},{component:"textfield",label:eD.designRef,name:"designRef",props:{readOnly:!0}},{component:"textfield",label:eD.productionclass,name:"classRef",props:{readOnly:!0}},{component:"textfield",label:eD.productionStandard,name:"standardRef",props:{readOnly:!0}},{component:"numberfield",name:"rmWgt",label:eD.rmWgt,defaultValue:0,onChange:()=>{ez(!0)},props:{readOnly:e2}},{component:"numberfield",name:"pieces",label:eD.pieces,defaultValue:0,props:{allowNegative:!1,readOnly:e2}}],du=[{key:"Locked",condition:e1,onClick:"onUnpostConfirmation",onSuccess:da,disabled:!e2},{key:"Unlocked",condition:!e1,onClick:dr,disabled:!e2},{key:"Close",condition:!e2,onClick:dn,disabled:e2||!e0},{key:"Reopen",condition:e2,onClick:dt,disabled:!e2||e1},{key:"Attachment",condition:!0,onClick:"onClickAttachment",disabled:!e0}];return(0,a.useEffect)(()=>{eT&&di(eT),ez(!0)},[eT]),(0,a.useEffect)(()=>{eY.setFieldValue("header.rmWgt",parseFloat(e3).toFixed(2)),eY.setFieldValue("header.netWgt",parseFloat(e6).toFixed(2)),eY.setFieldValue("header.suggestedWgt",parseFloat(e8).toFixed(2))},[e3,e6,e8]),(0,a.useEffect)(()=>{var e,d;e0||dl(null==eY?void 0:null===(d=eY.values)||void 0===d?void 0:null===(e=d.header)||void 0===e?void 0:e.dtId)},[eY.values.header.dtId]),(0,r.jsx)(b.Z,{form:eY,resourceId:u.i.FoWaxes,maxAccess:eU,editMode:e0,previewReport:e0,actions:du,disabledSubmit:e2,children:(0,r.jsxs)(c.R,{children:[(0,r.jsx)(v.g,{children:(0,r.jsxs)(p.ZP,{container:!0,spacing:2,xs:12,children:[(0,r.jsx)(p.ZP,{item:!0,xs:4,children:(0,r.jsxs)(p.ZP,{container:!0,spacing:2,children:[(0,r.jsx)(p.ZP,{item:!0,xs:12,children:(0,r.jsx)(C.Z,{endpointId:j.r.DocumentType.qry,parameters:"_startAt=0&_pageSize=1000&_dgId=".concat(I.J.Wax),filter:e0?void 0:e=>1===e.activeStatus,name:"header.dtId",label:eD.docType,readOnly:e0||eY.values.items.some(e=>e.jobId),valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],displayFieldWidth:1.5,values:eY.values.header,onChange:async(e,d)=>{eY.setFieldValue("header.dtId",(null==d?void 0:d.recordId)||null),eG(d)},error:(null===(L=eY.touched)||void 0===L?void 0:null===(E=L.header)||void 0===E?void 0:E.dtId)&&!!(null===($=eY.errors)||void 0===$?void 0:null===(M=$.header)||void 0===M?void 0:M.dtId),maxAccess:eU})}),(0,r.jsx)(p.ZP,{item:!0,xs:12,children:(0,r.jsx)(W.Z,{name:"header.reference",label:eD.reference,value:eY.values.header.reference,readOnly:e0||!eY.values.header.dtId,maxAccess:!e0&&eU,onChange:eY.handleChange,onClear:()=>eY.setFieldValue("header.reference",""),error:(null===(z=eY.touched.header)||void 0===z?void 0:z.reference)&&!!(null===(X=eY.errors.header)||void 0===X?void 0:X.reference)})}),(0,r.jsx)(p.ZP,{item:!0,xs:12,children:(0,r.jsx)(C.Z,{endpointId:eY.values.header.lineId&&x.B.Mould.qry2,name:"header.mouldId",parameters:eY.values.header.lineId&&"_params=&_startAt=0&_pageSize=1000&_lineId=".concat(eY.values.header.lineId),label:eD.mould,required:!0,valueField:"recordId",readOnly:e2||!eY.values.header.lineId,displayField:["reference","lineName"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"lineName",value:"Production Line"}],values:eY.values.header,maxAccess:eU,onChange:(e,d)=>{eY.setFieldValue("header.mouldRef",(null==d?void 0:d.reference)||null),eY.setFieldValue("header.mouldId",(null==d?void 0:d.recordId)||null)},error:(null===(G=eY.touched)||void 0===G?void 0:null===(U=G.header)||void 0===U?void 0:U.mouldId)&&!!(null===(K=eY.errors)||void 0===K?void 0:null===(H=K.header)||void 0===H?void 0:H.mouldId)})}),(0,r.jsx)(p.ZP,{item:!0,xs:12,children:(0,r.jsx)(N.Z,{name:"header.date",required:!0,readOnly:e2,label:eD.date,value:null==eY?void 0:null===(Y=eY.values)||void 0===Y?void 0:null===(Q=Y.header)||void 0===Q?void 0:Q.date,maxAccess:eU,onChange:eY.setFieldValue,onClear:()=>eY.setFieldValue("header.date",null),error:(null===(ed=eY.touched)||void 0===ed?void 0:null===(ee=ed.header)||void 0===ee?void 0:ee.date)&&!!(null===(er=eY.errors)||void 0===er?void 0:null===(el=er.header)||void 0===el?void 0:el.date)})})]})}),(0,r.jsx)(p.ZP,{item:!0,xs:4,children:(0,r.jsxs)(p.ZP,{container:!0,spacing:2,children:[(0,r.jsx)(p.ZP,{item:!0,xs:12,children:(0,r.jsx)(C.Z,{endpointId:j.r.Plant.qry,name:"header.plantId",readOnly:e2,label:eD.plant,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:eY.values.header,maxAccess:eU,onChange:(e,d)=>{eY.setFieldValue("header.plantId",(null==d?void 0:d.recordId)||null)},error:(null===(ea=eY.touched.header)||void 0===ea?void 0:ea.plantId)&&!!(null===(en=eY.errors.header)||void 0===en?void 0:en.plantId)})}),(0,r.jsx)(p.ZP,{item:!0,xs:12,children:(0,r.jsx)(C.Z,{endpointId:O.u.ProductionLine.qry,name:"header.lineId",readOnly:e2,required:!0,label:eD.prodLine,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:eY.values.header,maxAccess:eU,onChange:async(e,d)=>{(null==d?void 0:d.recordId)||await eY.setFieldValue("header.mouldId",null),eY.setFieldValue("header.lineId",(null==d?void 0:d.recordId)||null)},error:(null===(et=eY.touched)||void 0===et?void 0:null===(eo=et.header)||void 0===eo?void 0:eo.lineId)&&!!(null===(es=eY.errors)||void 0===es?void 0:null===(ei=es.header)||void 0===ei?void 0:ei.lineId)})}),(0,r.jsx)(p.ZP,{item:!0,xs:12,children:(0,r.jsx)(C.Z,{endpointId:_.$.Metals.qry,name:"header.metalId",readOnly:e2,required:!0,label:eD.metal,valueField:"recordId",displayField:"reference",values:eY.values.header,maxAccess:eU,onChange:async(e,d)=>{var l,r;eY.setFieldValue("header.metalId",(null==d?void 0:d.recordId)||null);let a=await dd(null==d?void 0:d.recordId,null===(r=eY.values)||void 0===r?void 0:null===(l=r.header)||void 0===l?void 0:l.metalColorId);eY.setFieldValue("header.factor",(null==a?void 0:a.rate)||0)},error:(null===(ec=eY.touched)||void 0===ec?void 0:null===(eu=ec.header)||void 0===eu?void 0:eu.metalId)&&!!(null===(em=eY.errors)||void 0===em?void 0:null===(ev=em.header)||void 0===ev?void 0:ev.metalId)})}),(0,r.jsx)(p.ZP,{item:!0,xs:12,children:(0,r.jsx)(C.Z,{endpointId:_.$.MetalColor.qry,name:"header.metalColorId",readOnly:e2,required:!0,label:eD.metalColor,valueField:"recordId",displayField:"reference",values:eY.values.header,maxAccess:eU,onChange:async(e,d)=>{var l,r;eY.setFieldValue("header.metalColorId",(null==d?void 0:d.recordId)||null);let a=await dd(null===(r=eY.values)||void 0===r?void 0:null===(l=r.header)||void 0===l?void 0:l.metalId,null==d?void 0:d.recordId);eY.setFieldValue("header.factor",(null==a?void 0:a.rate)||0)},error:(null===(eg=eY.touched)||void 0===eg?void 0:null===(eh=eg.header)||void 0===eh?void 0:eh.metalColorId)&&!!(null===(ef=eY.errors)||void 0===ef?void 0:null===(eI=ef.header)||void 0===eI?void 0:eI.metalColorId)})}),(0,r.jsx)(p.ZP,{item:!0,xs:12,children:(0,r.jsx)(C.Z,{endpointId:O.u.WorkCenter.qry,name:"header.workCenterId",label:eD.workCenter,valueField:"recordId",displayField:["reference","name"],readOnly:!0,values:eY.values.header,maxAccess:eU})})]})}),(0,r.jsx)(p.ZP,{item:!0,xs:4,children:(0,r.jsxs)(p.ZP,{container:!0,spacing:2,children:[(0,r.jsx)(p.ZP,{item:!0,xs:12,children:(0,r.jsx)(k.Z,{name:"header.grossWgt",label:eD.grossWgt,required:!0,readOnly:e2,value:eY.values.header.grossWgt,maxAccess:eU,onChange:e=>eY.setFieldValue("header.grossWgt",e.target.value),onClear:()=>eY.setFieldValue("header.grossWgt",0),error:(null===(ep=eY.touched)||void 0===ep?void 0:null===(ex=ep.header)||void 0===ex?void 0:ex.grossWgt)&&!!(null===(eb=eY.errors)||void 0===eb?void 0:null===(ey=eb.header)||void 0===ey?void 0:ey.grossWgt)})}),(0,r.jsx)(p.ZP,{item:!0,xs:12,children:(0,r.jsx)(k.Z,{name:"header.rmWgt",label:eD.rmWgt,required:!0,value:e3,readOnly:!0,error:(null===(ew=eY.touched)||void 0===ew?void 0:null===(eW=ew.header)||void 0===eW?void 0:eW.rmWgt)&&!!(null===(eC=eY.errors)||void 0===eC?void 0:null===(ej=eC.header)||void 0===ej?void 0:ej.rmWgt)})}),(0,r.jsx)(p.ZP,{item:!0,xs:12,children:(0,r.jsx)(k.Z,{name:"header.mouldWgt",label:eD.mouldWgt,required:!0,value:eY.values.header.mouldWgt,maxAccess:eU,readOnly:e2,onClear:()=>eY.setFieldValue("header.mouldWgt",0),onChange:e=>eY.setFieldValue("header.mouldWgt",e.target.value),error:(null===(eF=eY.touched)||void 0===eF?void 0:null===(eN=eF.header)||void 0===eN?void 0:eN.mouldWgt)&&!!(null===(e_=eY.errors)||void 0===e_?void 0:null===(ek=e_.header)||void 0===ek?void 0:ek.mouldWgt)})}),(0,r.jsx)(p.ZP,{item:!0,xs:12,children:(0,r.jsx)(k.Z,{name:"header.netWgt",label:eD.netWgt,required:!0,value:e6,readOnly:!0,error:(null===(eO=eY.touched)||void 0===eO?void 0:null===(eR=eO.header)||void 0===eR?void 0:eR.netWgt)&&!!(null===(eZ=eY.errors)||void 0===eZ?void 0:null===(eq=eZ.header)||void 0===eq?void 0:eq.netWgt)})}),(0,r.jsx)(p.ZP,{item:!0,xs:12,children:(0,r.jsx)(k.Z,{name:"header.suggestedWgt",label:eD.suggestedWgt,required:!0,maxAccess:eU,value:e8,readOnly:!0,error:(null===(eS=eY.touched)||void 0===eS?void 0:null===(eP=eS.header)||void 0===eP?void 0:eP.suggestedWgt)&&!!(null===(eV=eY.errors)||void 0===eV?void 0:null===(eA=eV.header)||void 0===eA?void 0:eA.suggestedWgt)})})]})})]})}),(0,r.jsx)(m.Q,{children:(0,r.jsx)(R._,{onChange:e=>eY.setFieldValue("items",e),value:eY.values.items,error:eY.errors.items,allowDelete:!e2,disabled:e2,name:"items",columns:ds,maxAccess:eU})})]})})}var P=()=>{let{postRequest:e,getRequest:d}=(0,a.useContext)(o.$),{platformLabels:l}=(0,a.useContext)(h.l),{stack:p}=(0,s.zY)(),{query:{data:y},filterBy:b,refetch:W,labels:w,access:j,paginationParameters:C,invalidate:N}=(0,n.J)({queryFn:k,endpointId:x.B.Wax.page,datasetId:u.i.FoWaxes,filter:{filterFn:_}}),F=[{field:"dtName",headerName:w.docType,flex:1},{field:"date",headerName:w.date,flex:1,type:"date"},{field:"reference",headerName:w.reference,flex:1},{field:"prodLineName",headerName:w.prodLine,flex:1},{field:"metalColorRef",headerName:w.metalColor,flex:1},{field:"metalRef",headerName:w.metal,flex:1},{field:"mouldRef",headerName:w.mould,flex:1},{field:"grossWgt",headerName:w.grossWgt,flex:1,type:"number"},{field:"rmWgt",headerName:w.rmWgt,flex:1,type:"number"},{field:"mouldWgt",headerName:w.mouldWgt,flex:1,type:"number"},{field:"netWgt",headerName:w.netWgt,flex:1,type:"number"},{field:"suggestedWgt",headerName:w.suggestedWgt,flex:1,type:"number"},{field:"statusName",headerName:w.status,flex:1},{field:"wipName",headerName:w.wip,flex:1}];async function k(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{_startAt:l=0,_pageSize:r=50,params:a=[]}=e;return{...await d({extension:x.B.Wax.page,parameters:"_startAt=".concat(l,"&_pageSize=").concat(r,"&_params=").concat(a)}),_startAt:l}}async function _(e){let{filters:l,pagination:r}=e;return l.qry?await d({extension:x.B.Wax.snapshot,parameters:"_filter=".concat(l.qry)}):k({_startAt:r._startAt||0,params:null==l?void 0:l.params})}let{proxyAction:R}=(0,g.G)({functionId:I.J.Wax,action:q}),O=async()=>{R()};async function q(e){p({Component:Z,props:{labels:w,access:j,recordId:e},width:1200,height:700,title:w.wax})}let P=async d=>{await e({extension:x.B.Wax.del,record:JSON.stringify(d)}),N(),i.ZP.success(l.Deleted)};return(0,r.jsxs)(c.R,{children:[(0,r.jsx)(v.g,{children:(0,r.jsx)(f.Z,{onAdd:O,maxAccess:j,filterBy:b,reportName:"FOWAX"})}),(0,r.jsx)(m.Q,{children:(0,r.jsx)(t.Z,{name:"table",columns:F,gridData:y,rowId:["recordId"],onEdit:e=>{q(null==e?void 0:e.recordId)},refetch:W,onDelete:P,deleteConfirmationType:"strict",isLoading:!1,pageSize:50,maxAccess:j,paginationParameters:C,paginationType:"api"})})]})}},67920:function(e,d,l){"use strict";l.d(d,{m:function(){return a}});var r=l(48601);function a(e,d,l){var a;let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"items",o={...e};return null==l||null===(a=l.record)||void 0===a||a.controls.forEach(e=>{let{controlId:d,accessLevel:l}=e,[r,a]=null==d?void 0:d.split(".");r!==n||2!==l||a in o||(o[a]=e=>(null==e?void 0:e[a])!=null),(1===l||4===l)&&a in o&&delete o[a]}),{schema:r.Ry().shape({...Object.keys(o).reduce((e,l)=>(e[l]=r.nK().nullable().test(function(e){var r;let a=this.parent,[,n]=this.path.match(/^(\w+)\[(\d+)\]/)||[],t=(null===(r=this.options.context)||void 0===r?void 0:r[n])||[];if(d||!d&&t.length>1){if(null!==a[l]&&void 0!==a[l]&&0!==a[l]&&""!==o[l]&&!o[l](a))return!1;if(!Object.entries(o).some(e=>{let[,d]=e;return!!d(a)}))return!0}return!!o[l](a)&&void 0!==e}),e),{})}),requiredFields:o}}},1685:function(e,d,l){"use strict";l.d(d,{m:function(){return r}});let r=e=>{let d=window.sessionStorage.getItem(e);return d?JSON.parse(d):null}},98345:function(e,d,l){"use strict";l.d(d,{H:function(){return g},G:function(){return h}});var r=l(45300),a=l(2784),n=l(96026),o=l(38449);l(26612);var t=l(65947),i=l(1685);let s=async(e,d,l)=>{try{let r=await e({extension:d,parameters:l});return d.includes("qry")?r:r.record}catch(e){return null}},u=(e,d,l,r)=>{let a=(e=JSON.parse(JSON.stringify(e))).record.controls,n=a.find(e=>"reference"===e.controlId);return n?n.accessLevel=(null==d?void 0:d.mandatory)?t.$7:t.rr:(null==d?void 0:d.mandatory)?a.push({sgId:0,resourceId:"",controlId:"".concat(r?r+".":"","reference"),accessLevel:(null==d?void 0:d.mandatory)?t.$7:t.rr}):(null==d?void 0:d.readOnly)?a.push({sgId:0,resourceId:"",controlId:"".concat(r?r+".":"","reference"),accessLevel:(null==d?void 0:d.readOnly)?t.rr:t.$7}):a=e.record.controls.filter(e=>"reference"!=e.controlId),l&&a.push({sgId:0,resourceId:"",controlId:"".concat(r?r+".":"","dtId"),accessLevel:t.$7}),{...e,record:{...e.record,controls:a}}},c=async(e,d,l)=>{let r,a;switch(l){case"dtId":let n=(0,i.m)("userData"),t=null==n?void 0:n.userId;a="_userId=".concat(t,"&_functionId=").concat(d),r=o.r.UserFunction.get;break;case"glbSysNumberRange":a="_recordId=".concat(d),r=o.r.SystemFunction.get;break;case"DocumentType":a="_dgId=".concat(d,"&_startAt=",0,"&_pageSize=",50),r=o.r.DocumentType.qry;break;case"DcTypNumberRange":a="_recordId=".concat(d),r=o.r.DocumentType.get;break;case"isExternal":a="_recordId=".concat(d),r=o.r.NumberRange.get;break;default:return null}return await s(e,r,a)},v=async function(e){let d,l,r,a,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,o=arguments.length>2?arguments[2]:void 0,t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,i=!(arguments.length>4)||void 0===arguments[4]||arguments[4],s=arguments.length>5?arguments[5]:void 0,v=void 0===t&&n&&await c(e,n,"dtId"),m=null==v?void 0:v.dtId,h="",g=!0;if(v&&void 0===t||"nraId"===t){if(m){let l=await c(e,m,"DcTypNumberRange");d=null==l?void 0:l.nraId,g=!((null==l?void 0:l.activeStatus)<0),d||(h="Assign the document type to a number range")}if((!m||!g)&&i&&n){var I;let d=await c(e,n,"DocumentType");a=(null==d?void 0:null===(I=d.list)||void 0===I?void 0:I.filter(e=>(null==e?void 0:e.activeStatus)===1).length)>0}}if(("nraId"===t||void 0===t)&&n){if((!m||m)&&!d||d&&!g){let l=await c(e,n,"glbSysNumberRange");(d=null==l?void 0:l.nraId)&&a&&(a=!1),g=!0}h=d||a?"":"Assign the system Function to a number range"}t>0&&!d&&(d=t),d&&g?(l={readOnly:null==(r=await c(e,d,"isExternal"))||!r.external,mandatory:null!=r&&!!r.external},o&&(o=await u(o,l,a,s))):!d&&o&&(o=await u(o,l,a,s));let f=s?"".concat(s,".reference"):"reference";return{dtId:m,resetReference:null==l?void 0:l.readOnly,dcTypeRequired:a,reference:{fieldName:f,isEmpty:(null==r?void 0:r.external)!==void 0&&(null==r||!r.external)},errorMessage:h,maxAccess:o,selectNraId:t}};var m=l(65950);function h(e){let{functionId:d,action:l,hasDT:r}=e,{getRequest:o}=(0,a.useContext)(m.$),{stack:t}=(0,n.V)();return{proxyAction:async()=>{let e=await v(o,d,"",void 0,r);(null==e?void 0:e.errorMessage)?t({message:null==e?void 0:e.errorMessage}):await l()}}}function g(e){var d;let{functionId:l,access:o,hasDT:t,enabled:i=!0,objectName:s=""}=e,{getRequest:u}=(0,a.useContext)(m.$),{stack:c}=(0,n.V)(),[h,g]=(0,a.useState)(),I=async e=>{let d=await v(u,l,o,e,t,s);if(!d.errorMessage)return d;c({message:null==d?void 0:d.errorMessage})},f=(0,r.a)({retry:!1,staleTime:0,enabled:i,queryKey:[l,h,!!o,i],queryFn:h||"nraId"===h?()=>I(h):()=>I()});return{documentType:f.data,maxAccess:(null==f?void 0:null===(d=f.data)||void 0===d?void 0:d.maxAccess)||o,changeDT(e){g((null==e?void 0:e.nraId)||"nraId")}}}}},function(e){e.O(0,[92515,2494,36908,49774,92888,40179],function(){return e(e.s=5573)}),_N_E=e.O()}]);