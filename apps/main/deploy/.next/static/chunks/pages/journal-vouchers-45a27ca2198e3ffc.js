(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[43519],{28383:function(e,r,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/journal-vouchers",function(){return n(1065)}])},1065:function(e,r,n){"use strict";n.r(r),n.d(r,{default:function(){return k}});var t=n(52322),a=n(2784),d=n(62202),o=n(69387);n(27723);var c=n(65950),l=n(66361),s=n(39812),i=n(71987),u=n(26612),f=n(7121),v=n(60218),m=n(48601),h=n(82737),y=n(89330),g=n(8661),x=n(5088),I=n(21581),p=n(38449),w=n(80983),_=n(98345),b=n(31389),J=n(62362),V=n(19473);function S(e){let{labels:r,access:n,recordId:o}=e,{documentType:S,maxAccess:C,changeDT:N}=(0,_.H)({functionId:f.J.JournalVoucher,access:n,enabled:!o}),{getRequest:A,postRequest:k}=(0,a.useContext)(c.$),{platformLabels:j}=(0,a.useContext)(V.l),O=(0,i.E)({endpointId:l.x.JournalVoucher.page}),{formik:T}=(0,w.c)({documentType:{key:"dtId",value:null==S?void 0:S.dtId},maxAccess:C,initialValues:{recordId:null,reference:"",date:new Date,notes:"",dtId:null,status:1},validateOnChange:!0,validationSchema:m.Ry({date:m.Z_().required()}),onSubmit:async e=>{let r={...e,date:(0,s.ku)(e.date),recordId:o},n=await k({extension:l.x.JournalVoucher.set,record:JSON.stringify(r)});o?d.ZP.success(j.Edited):(d.ZP.success(j.Added),T.setValues({...e,recordId:n.recordId}),F(n.recordId)),O()}}),Z=1==T.values.status,D=!!T.values.recordId;(0,a.useEffect)(()=>{!async function(){await F(o)}()},[]);let F=async e=>{if(e){let r=await A({extension:l.x.JournalVoucher.get,parameters:"_recordId=".concat(e)});T.setValues({...r.record,date:(0,s.a1)(r.record.date)})}},E=async()=>{let{...e}=T.values,r={...e};r.date=(0,s.ku)(r.date),await k({extension:l.x.JournalVoucher.post,record:JSON.stringify(r)}),F(T.values.recordId),d.ZP.success(j.Added),O()},L=[{key:"GL",condition:!0,onClick:"onClickGL",datasetId:u.i.GLJournalVoucher,disabled:!D},{key:"Locked",condition:!0,onClick:E,disabled:!Z||!D}];return(0,t.jsx)(h.Z,{actions:L,resourceId:u.i.JournalVoucher,form:T,functionId:f.J.JournalVoucher,maxAccess:C,editMode:D,disabledSubmit:!Z,disabledSavedClear:!Z,children:(0,t.jsx)(b.R,{children:(0,t.jsx)(J.Q,{children:(0,t.jsxs)(v.ZP,{container:!0,spacing:2,children:[(0,t.jsx)(v.ZP,{item:!0,xs:12,children:(0,t.jsx)(g.Z,{endpointId:p.r.DocumentType.qry,parameters:"_dgId=".concat(f.J.JournalVoucher,"&_startAt=",0,"&_pageSize=",50),filter:D?void 0:e=>1===e.activeStatus,name:"dtId",label:r.documentType,readOnly:D||!Z,valueField:"recordId",displayField:"name",values:T.values,onChange:async(e,r)=>{T.setFieldValue("dtId",(null==r?void 0:r.recordId)||""),N(r)},error:T.touched.dtId&&!!T.errors.dtId,maxAccess:!D&&C})}),(0,t.jsx)(v.ZP,{item:!0,xs:12,children:(0,t.jsx)(x.Z,{name:"reference",label:r.reference,value:T.values.reference,readOnly:D||!Z,maxAccess:!D&&C,maxLength:"30",onChange:T.handleChange,onClear:()=>T.setFieldValue("reference",""),error:T.touched.reference&&!!T.errors.reference})}),(0,t.jsx)(v.ZP,{item:!0,xs:12,children:(0,t.jsx)(y.Z,{name:"date",label:r.date,readOnly:!Z,onChange:T.setFieldValue,value:T.values.date,maxAccess:C,required:!0,error:T.touched.date&&!!T.errors.date})}),(0,t.jsx)(v.ZP,{item:!0,xs:12,children:(0,t.jsx)(I.Z,{name:"notes",label:r.notes,value:T.values.notes,readOnly:!Z,maxLength:"100",rows:3,maxAccess:C,onChange:T.handleChange,onClear:()=>T.setFieldValue("notes",""),error:T.touched.notes&&!!T.errors.notes})})]})})})})}var C=n(33625),N=n(61802),A=n(36908),k=()=>{let{getRequest:e,postRequest:r}=(0,a.useContext)(c.$),{stack:n}=(0,N.zY)();async function s(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{_startAt:n=0,_pageSize:t=50,params:a}=r;return{...await e({extension:l.x.JournalVoucher.page,parameters:"_startAt=".concat(n,"&_pageSize=").concat(t,"&filter=&_params=").concat(a||"","&_sortField=")}),_startAt:n}}async function v(r){let{filters:n,pagination:t}=r;return(null==n?void 0:n.qry)?await e({extension:l.x.JournalVoucher.snapshot,parameters:"_filter=".concat(n.qry)}):s({_startAt:t._startAt||0,params:null==n?void 0:n.params})}let{query:{data:m},labels:h,filterBy:y,paginationParameters:g,invalidate:x,access:I,refetch:p}=(0,i.J)({queryFn:s,endpointId:l.x.JournalVoucher.page,datasetId:u.i.JournalVoucher,filter:{filterFn:v}}),w=[{field:"reference",headerName:h.reference,flex:1},{field:"date",headerName:h.date,flex:1,type:"date"},{field:"notes",headerName:h.description,flex:1},{field:"statusName",headerName:h.status,flex:1}],V=e=>{n({Component:S,props:{labels:h,access:I,recordId:e},width:500,height:400,title:h.generalJournal})},{proxyAction:k}=(0,_.G)({functionId:f.J.JournalVoucher,action:V}),j=async()=>{await k()},O=async e=>{await r({extension:l.x.JournalVoucher.del,record:JSON.stringify(e)}),x(),d.ZP.success("Record Deleted Successfully")};return(0,t.jsxs)(b.R,{children:[(0,t.jsx)(C.g,{children:(0,t.jsx)(A.Z,{onAdd:j,maxAccess:I,reportName:"GLTR",filterBy:y})}),(0,t.jsx)(J.Q,{children:(0,t.jsx)(o.Z,{name:"table",columns:w,gridData:m,rowId:["recordId"],onEdit:e=>{V(e.recordId)},onDelete:O,deleteConfirmationType:"strict",isLoading:!1,pageSize:50,paginationType:"api",paginationParameters:g,maxAccess:I})})]})}},1685:function(e,r,n){"use strict";n.d(r,{m:function(){return t}});let t=e=>{let r=window.sessionStorage.getItem(e);return r?JSON.parse(r):null}},98345:function(e,r,n){"use strict";n.d(r,{H:function(){return h},G:function(){return m}});var t=n(45300),a=n(2784),d=n(96026),o=n(38449);n(26612);var c=n(65947),l=n(1685);let s=async(e,r,n)=>{try{let t=await e({extension:r,parameters:n});return r.includes("qry")?t:t.record}catch(e){return null}},i=(e,r,n,t)=>{let a=(e=JSON.parse(JSON.stringify(e))).record.controls,d=a.find(e=>"reference"===e.controlId);return d?d.accessLevel=(null==r?void 0:r.mandatory)?c.$7:c.rr:(null==r?void 0:r.mandatory)?a.push({sgId:0,resourceId:"",controlId:"".concat(t?t+".":"","reference"),accessLevel:(null==r?void 0:r.mandatory)?c.$7:c.rr}):(null==r?void 0:r.readOnly)?a.push({sgId:0,resourceId:"",controlId:"".concat(t?t+".":"","reference"),accessLevel:(null==r?void 0:r.readOnly)?c.rr:c.$7}):a=e.record.controls.filter(e=>"reference"!=e.controlId),n&&a.push({sgId:0,resourceId:"",controlId:"".concat(t?t+".":"","dtId"),accessLevel:c.$7}),{...e,record:{...e.record,controls:a}}},u=async(e,r,n)=>{let t,a;switch(n){case"dtId":let d=(0,l.m)("userData"),c=null==d?void 0:d.userId;a="_userId=".concat(c,"&_functionId=").concat(r),t=o.r.UserFunction.get;break;case"glbSysNumberRange":a="_recordId=".concat(r),t=o.r.SystemFunction.get;break;case"DocumentType":a="_dgId=".concat(r,"&_startAt=",0,"&_pageSize=",50),t=o.r.DocumentType.qry;break;case"DcTypNumberRange":a="_recordId=".concat(r),t=o.r.DocumentType.get;break;case"isExternal":a="_recordId=".concat(r),t=o.r.NumberRange.get;break;default:return null}return await s(e,t,a)},f=async function(e){let r,n,t,a,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,o=arguments.length>2?arguments[2]:void 0,c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,l=!(arguments.length>4)||void 0===arguments[4]||arguments[4],s=arguments.length>5?arguments[5]:void 0,f=void 0===c&&d&&await u(e,d,"dtId"),v=null==f?void 0:f.dtId,m="",h=!0;if(f&&void 0===c||"nraId"===c){if(v){let n=await u(e,v,"DcTypNumberRange");r=null==n?void 0:n.nraId,h=!((null==n?void 0:n.activeStatus)<0),r||(m="Assign the document type to a number range")}if((!v||!h)&&l&&d){var y;let r=await u(e,d,"DocumentType");a=(null==r?void 0:null===(y=r.list)||void 0===y?void 0:y.filter(e=>(null==e?void 0:e.activeStatus)===1).length)>0}}if(("nraId"===c||void 0===c)&&d){if((!v||v)&&!r||r&&!h){let n=await u(e,d,"glbSysNumberRange");(r=null==n?void 0:n.nraId)&&a&&(a=!1),h=!0}m=r||a?"":"Assign the system Function to a number range"}c>0&&!r&&(r=c),r&&h?(n={readOnly:null==(t=await u(e,r,"isExternal"))||!t.external,mandatory:null!=t&&!!t.external},o&&(o=await i(o,n,a,s))):!r&&o&&(o=await i(o,n,a,s));let g=s?"".concat(s,".reference"):"reference";return{dtId:v,resetReference:null==n?void 0:n.readOnly,dcTypeRequired:a,reference:{fieldName:g,isEmpty:(null==t?void 0:t.external)!==void 0&&(null==t||!t.external)},errorMessage:m,maxAccess:o,selectNraId:c}};var v=n(65950);function m(e){let{functionId:r,action:n,hasDT:t}=e,{getRequest:o}=(0,a.useContext)(v.$),{stack:c}=(0,d.V)();return{proxyAction:async()=>{let e=await f(o,r,"",void 0,t);(null==e?void 0:e.errorMessage)?c({message:null==e?void 0:e.errorMessage}):await n()}}}function h(e){var r;let{functionId:n,access:o,hasDT:c,enabled:l=!0,objectName:s=""}=e,{getRequest:i}=(0,a.useContext)(v.$),{stack:u}=(0,d.V)(),[m,h]=(0,a.useState)(),y=async e=>{let r=await f(i,n,o,e,c,s);if(!r.errorMessage)return r;u({message:null==r?void 0:r.errorMessage})},g=(0,t.a)({retry:!1,staleTime:0,enabled:l,queryKey:[n,m,!!o,l],queryFn:m||"nraId"===m?()=>y(m):()=>y()});return{documentType:g.data,maxAccess:(null==g?void 0:null===(r=g.data)||void 0===r?void 0:r.maxAccess)||o,changeDT(e){h((null==e?void 0:e.nraId)||"nraId")}}}}},function(e){e.O(0,[92515,2494,36908,49774,92888,40179],function(){return e(e.s=28383)}),_N_E=e.O()}]);