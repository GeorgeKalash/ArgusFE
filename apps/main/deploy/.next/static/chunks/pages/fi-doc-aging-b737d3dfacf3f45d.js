(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[58750],{32247:function(e,n,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/fi-doc-aging",function(){return a(87277)}])},87277:function(e,n,a){"use strict";a.r(n),a.d(n,{default:function(){return A}});var l=a(52322),t=a(48601),r=a(8661),c=a(71987),i=a(60218),o=a(26612),d=a(80983),u=a(31389),s=a(33625),m=a(91406),f=a(69627),p=a(27423),x=a(25870),h=a(38449),g=a(2784),v=a(19473),I=a(69387),b=a(62362),y=a(93736),j=a(65950),Z=a(55405),w=a(61802);let F=e=>{var n;return Math.floor((new Date-new Date(parseInt((null===(n=e.match(/\d+/))||void 0===n?void 0:n[0])||"0")))/864e5)-1};var A=()=>{var e,n;let{getRequest:a}=(0,g.useContext)(j.$),{platformLabels:A}=(0,g.useContext)(v.l),C=(0,g.useRef)([]),[P,_]=(0,g.useState)(),{stack:N}=(0,w.zY)(),R=(0,g.useRef)(),{labels:S,access:D}=(0,c.J)({datasetId:o.i.DocumentsAging}),{formik:V}=(0,d.c)({initialValues:{recordId:null,accountId:null,profileId:null,amountDue:null,currencyId:null,amountApplied:null,balance:null,aging:[],agingTree:[]},maxAccess:D,validateOnChange:!0,validationSchema:t.Ry({accountId:t.Z_().required(),profileId:t.Z_().required(),currencyId:t.Z_().required()}),onSubmit:async e=>{var n,l,t,r;let c=await a({extension:y.K.FiAging.qry,parameters:"_params=1|".concat(null==e?void 0:e.profileId,"^5|").concat(null==e?void 0:e.accountId,"^6|").concat(null==e?void 0:e.currencyId)}),i=(null==c?void 0:null===(n=c.record)||void 0===n?void 0:n.legs)||[],o=(null==c?void 0:null===(r=c.record)||void 0===r?void 0:null===(t=r.agings)||void 0===t?void 0:null===(l=t[0])||void 0===l?void 0:l.amounts)||[],d=i.map(e=>{let n=o.find(n=>n.seqNo===e.seqNo);return{age:e.caption,balance:Math.round(Math.abs((null==n?void 0:n.amount)||0))}}),u=d.reduce((e,n)=>e+n.balance,0);if(V.setFieldValue("aging",d),V.setFieldValue("balance",u),(null==e?void 0:e.accountId)&&(null==e?void 0:e.currencyId)&&(null==e?void 0:e.profileId)){let n=await a({extension:y.K.DocumentAging.AgingFI406a,parameters:"_accountId=".concat(null==e?void 0:e.accountId,"&_currencyId=").concat(null==e?void 0:e.currencyId,"&_profileId=").concat(null==e?void 0:e.profileId)}),l=await a({extension:y.K.DocumentAging.AgingFI406b,parameters:"_accountId=".concat(null==e?void 0:e.accountId,"&_currencyId=").concat(null==e?void 0:e.currencyId,"&_profileId=").concat(null==e?void 0:e.profileId)}),t=await a({extension:x.H.Apply.qry,parameters:"_accountId=".concat(null==e?void 0:e.accountId,"&_currencyId=").concat(null==e?void 0:e.currencyId)}),r=((null==t?void 0:t.list)||[]).map(e=>({...e,fromId:"".concat(e.fromFunctionId,"|").concat(e.fromRecordId),toId:"".concat(e.toFunctionId,"|").concat(e.toRecordId)})),c=(null==l?void 0:l.list)||[],i=0,o=((null==n?void 0:n.list)||[]).map(e=>{let n="".concat(e.functionId,"|").concat(e.recordId),a=r.some(e=>e.toId===n);return{...e,amount:Math.round(Math.abs(e.amount||0)),balance:Math.round(Math.abs(e.balance||0)),reference:e.reference,days:F(e.date),level:0,isExpanded:a,hasChildren:a}}).flatMap(e=>{let n="".concat(e.functionId,"|").concat(e.recordId),a=r.filter(e=>e.toId===n).map(n=>{let a=c.find(e=>"".concat(e.functionId,"|").concat(e.recordId)===n.fromId);return a?(i+=a.amount||0,{...a,amount:Math.round(Math.abs(a.amount||0)),balance:Math.round(Math.abs(a.balance||0)),reference:a.reference,days:F(a.date),level:1,parent:e.reference}):null}).filter(Boolean);return[e,...e.isExpanded?a:[]]});R.current=i,C.current=o;let d=o.flatMap(e=>0===e.level?[e,...e.isExpanded?o.filter(n=>n.parent===e.reference):[]]:[]);_(d),V.setFieldValue("agingTree",d)}}}),q=[{field:"age",headerName:S.age,flex:1},{field:"balance",headerName:S.balance,flex:1,type:"number"}],T=[{field:"reference",headerName:S.documentReference,flex:1,isTree:!0},{field:"date",headerName:S.date,flex:1,type:"date"},{field:"days",headerName:S.days,flex:1,type:"number"},{field:"amount",headerName:S.amount,flex:1,type:"number",props:{decimalScale:0,allowNegative:!1}},{field:"balance",headerName:S.balance,flex:1,type:"number",props:{decimalScale:0,allowNegative:!1}}],{labels:k,access:O}=(0,c.J)({datasetId:o.i.RebuildAging}),M=null===(n=V.values)||void 0===n?void 0:null===(e=n.agingTree)||void 0===e?void 0:e.reduce((e,n)=>{var a;return e+(parseFloat(null===(a=n.amount)||void 0===a?void 0:a.toString().replace(/,/g,""))||null)},null),E=M-R.current||null;return(0,l.jsxs)(u.R,{children:[(0,l.jsx)(s.g,{children:(0,l.jsxs)(i.ZP,{container:!0,spacing:2,sx:{p:3},children:[(0,l.jsx)(i.ZP,{item:!0,xs:12,children:(0,l.jsx)(p.U,{endpointId:x.H.Account.snapshot,name:"accountId",label:S.account,valueField:"reference",displayField:"name",valueShow:"accountRef",secondValueShow:"accountName",form:V,required:!0,readOnly:V.values.aging.length>0||V.values.agingTree.length>0,maxAccess:D,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],onChange:(e,n)=>{V.setFieldValue("accountName",(null==n?void 0:n.name)||""),V.setFieldValue("accountRef",(null==n?void 0:n.reference)||""),V.setFieldValue("accountId",(null==n?void 0:n.recordId)||null)},errorCheck:"accountId"})}),(0,l.jsx)(i.ZP,{item:!0,xs:6,children:(0,l.jsx)(r.Z,{endpointId:x.H.AgingProfile.qry,parameters:"_startAt=0&_pageSize=1000&filter=",name:"profileId",label:S.profile,values:V.values,valueField:"recordId",readOnly:V.values.aging.length>0||V.values.agingTree.length>0,displayField:"name",maxAccess:D,required:!0,onChange:(e,n)=>{V.setFieldValue("profileId",(null==n?void 0:n.recordId)||null)},error:V.touched.profileId&&!!V.errors.profileId})}),(0,l.jsx)(i.ZP,{item:!0,xs:6,children:(0,l.jsx)(m.Z,{name:"amountDue",label:S.amountDue,value:M,maxAccess:D,readOnly:!0,onChange:V.handleChange,onClear:()=>V.setFieldValue("amountDue",""),error:V.touched.amountDue&&!!V.errors.amountDue})}),(0,l.jsx)(i.ZP,{item:!0,xs:6,children:(0,l.jsx)(r.Z,{endpointId:h.r.Currency.qry,name:"currencyId",label:S.currency,readOnly:V.values.aging.length>0||V.values.agingTree.length>0,valueField:"recordId",displayField:"name",values:V.values,required:!0,maxAccess:D,onChange:(e,n)=>{V.setFieldValue("currencyId",(null==n?void 0:n.recordId)||null)},error:V.touched.currencyId&&!!V.errors.currencyId})}),(0,l.jsx)(i.ZP,{item:!0,xs:6,children:(0,l.jsx)(m.Z,{name:"amountApplied",label:S.amountApplied,value:R.current,maxAccess:D,readOnly:!0})}),(0,l.jsx)(i.ZP,{item:!0,xs:.5,children:(0,l.jsx)(f.Z,{onClick:()=>{V.handleSubmit()},tooltipText:A.Preview,image:"preview.png",color:"#231f20"})}),(0,l.jsx)(i.ZP,{item:!0,xs:.5,children:(0,l.jsx)(f.Z,{onClick:async()=>{V.resetForm(),_([]),R.current=null,V.setFieldValue("balance",null),await V.validateForm(),V.setTouched({accountId:!0,profileId:!0,currencyId:!0})},label:A.Clear,tooltipText:A.Clear,image:"clear.png",color:"#f44336"})}),(0,l.jsx)(i.ZP,{item:!0,xs:.5,children:(0,l.jsx)(f.Z,{onClick:()=>{N({Component:Z.Z,props:{_labels:k,access:O,values:V.values},width:450,height:160,title:A.Confirmation})},label:A.RebuildButton,tooltipText:A.RebuildButton,image:"rebuild.png",disabled:!V.values.accountId,color:"#231f20"})}),(0,l.jsx)(i.ZP,{item:!0,xs:4.5}),(0,l.jsx)(i.ZP,{item:!0,xs:6,children:(0,l.jsx)(m.Z,{name:"balance",label:S.balance,value:E,maxAccess:D,readOnly:!0,onChange:V.handleChange,onClear:()=>V.setFieldValue("balance",null)})})]})}),(0,l.jsx)(b.Q,{children:(0,l.jsxs)(i.ZP,{container:!0,spacing:2,sx:{display:"flex",flex:1},children:[(0,l.jsx)(i.ZP,{item:!0,xs:3,sx:{display:"flex"},children:(0,l.jsx)(I.Z,{name:"aging",columns:q,gridData:{list:V.values.aging},rowId:["recordId"],pagination:!1,maxAccess:D})}),(0,l.jsx)(i.ZP,{item:!0,xs:9,sx:{display:"flex",flexDirection:"column"},children:(0,l.jsx)(I.Z,{name:"agingTree",columns:T,setRowData:_,field:"reference",fullRowData:C,gridData:{list:P},rowId:["recordId"],pagination:!1,maxAccess:D})})]})})]})}},55405:function(e,n,a){"use strict";a.d(n,{Z:function(){return y}});var l=a(52322),t=a(60218),r=a(76385),c=a(48601),i=a(2784),o=a(82737),d=a(62202),u=a(65950),s=a(26612),m=a(31389),f=a(62362),p=a(80983),x=a(27423),h=a(25870),g=a(19473),v=a(5088),I=a(61802),b=a(84309);function y(e){let{_labels:n,access:a,values:y}=e,{postRequest:j}=(0,i.useContext)(u.$),{platformLabels:Z}=(0,i.useContext)(g.l),{stack:w}=(0,I.zY)(),{formik:F}=(0,p.c)({initialValues:{rebuild:"",accountId:(null==y?void 0:y.accountId)||0,accountRef:(null==y?void 0:y.accountRef)||"",accountName:(null==y?void 0:y.accountName)||"",recordId:"N/A"},maxAccess:a,validateOnChange:!0,validationSchema:c.Ry({rebuild:c.Z_().test("is-rebuild",'Value must be "rebuild"',e=>"string"==typeof e&&"rebuild"===e.toLowerCase()).required()}),onSubmit:async e=>{let{recordId:n,...a}=e,l=await j({extension:h.H.AgingDoc.rebuild,record:JSON.stringify(a)});w({Component:b.R,props:{recordId:l.recordId},closable:!1}),d.ZP.success(Z.rebuild)}}),A=[{key:"Rebuild",condition:!0,onClick:F.handleSubmit,disabled:!1}];return(0,l.jsx)(o.Z,{resourceId:s.i.RebuildAging,form:F,actions:A,maxAccess:a,isSaved:!1,isCleared:!1,editMode:!0,children:(0,l.jsx)(m.R,{children:(0,l.jsx)(f.Q,{children:(0,l.jsxs)(t.ZP,{container:!0,spacing:2,children:[(0,l.jsx)(t.ZP,{item:!0,xs:12,children:(0,l.jsx)(r.Z,{variant:"body1",children:n.infoText})}),(0,l.jsx)(t.ZP,{item:!0,xs:12,children:(0,l.jsx)(v.Z,{name:"rebuild",required:!0,label:n.rebuild,value:F.values.rebuild,onChange:F.handleChange,onClear:()=>F.setFieldValue("rebuild",""),error:F.touched.rebuild&&!!F.errors.rebuild,maxAccess:a})}),(0,l.jsx)(t.ZP,{item:!0,xs:12,children:(0,l.jsx)(x.U,{endpointId:h.H.Account.snapshot,name:"accountId",label:n.account,valueField:"reference",displayField:"name",valueShow:"accountRef",displayFieldWidth:2,secondValueShow:"accountName",form:F,onChange:(e,n)=>{F.setFieldValue("accountId",(null==n?void 0:n.recordId)||0),F.setFieldValue("accountRef",(null==n?void 0:n.reference)||""),F.setFieldValue("accountName",(null==n?void 0:n.name)||"")},readOnly:null==y?void 0:y.accountId,error:F.touched.accountId&&!!F.errors.accountId,maxAccess:a})})]})})})})}y.height=460},93736:function(e,n,a){"use strict";a.d(n,{K:function(){return t}});let l="RG.FI.asmx/",t={FiOpeningBalance:{gen:l+"genOBA"},FiAging:{qry:l+"FI404"},AccountSummary:{AccFI405b:l+"FI405b"},DocumentAging:{AgingFI406a:l+"FI406a",AgingFI406b:l+"FI406b"},TrialBalance:{FI402View:l+"FI402o",FI401o2:l+"FI401o2"}}},84309:function(e,n,a){"use strict";a.d(n,{R:function(){return N}});var l=a(73235),t=a(52322),r=a(3854),c=a(2784),i=a(82737),o=a(65950),d=a(62362),u=a(31389),s=a(60218),m=a(21581),f=a(38449),p=a(5088),x=a(19473),h=a(21326);function g(){let e=(0,l._)(["\n  container-type: inline-size;\n  font-size: clamp(12px, 3.2cqw, 16px);\n"]);return g=function(){return e},e}function v(){let e=(0,l._)(["\n  font-size: clamp(10px, 2.2cqw, 12px);\n  font-weight: 600;\n  color: #888888;\n  position: absolute;\n  width: 100%;\n  text-align: center;\n  top: 50%;\n  transform: translateY(-50%);\n"]);return v=function(){return e},e}function I(){let e=(0,l._)(["\n  font-size: clamp(11px, 2.4cqw, 13px);\n  font-weight: 600;\n  margin-bottom: 3px;\n  margin-top: 5px;\n  color: #000;\n"]);return I=function(){return e},e}function b(){let e=(0,l._)(["\n  width: 100%;\n  height: clamp(28px, 7cqw, 35px);\n  background-color: #f0f0f0;\n  border-radius: 5px;\n  overflow: hidden;\n  margin: 10px 0;\n  position: relative;\n"]);return b=function(){return e},e}function y(){let e=(0,l._)(["\n  container-type: inline-size;\n"]);return y=function(){return e},e}function j(){let e=(0,l._)(["\n  height: 100%;\n  background-color: #cce6ff;\n  transition: width 1.5s ease-in-out;\n"]);return j=function(){return e},e}let Z=r.ZP.div(g()),w=r.ZP.span(v()),F=r.ZP.span(I()),A=r.ZP.div(b()),C=r.ZP.div(y()),P=r.ZP.div(j());function _(e){let{label:n,topLabel:a,width:l}=e;return(0,t.jsxs)("div",{children:[(0,t.jsxs)(F,{children:[a,": "]}),(0,t.jsxs)(A,{children:[(0,t.jsx)(P,{style:{width:l}}),(0,t.jsx)(w,{children:n})]})]})}let N=e=>{let{recordId:n,onComplete:a,access:l,window:r}=e,{getRequest:g}=(0,c.useContext)(o.$),{platformLabels:v}=(0,c.useContext)(x.l);(0,h.Z)({title:v.Progress,window:r});let[I,b]=(0,c.useState)({recordId:n,iterations:0,completed:0,phases:0,currentPhase:0,currentPhaseName:"",logInfo:"",status:0}),y=async()=>(await g({extension:f.r.THD.get,parameters:"_recordId=".concat(n)})).record,j=I.currentPhase===I.phases&&I.completed===I.iterations,w=!!I.status&&I.status<0;(0,c.useEffect)(()=>{a&&(j||w)&&a()},[w,j]),(0,c.useEffect)(()=>{(async()=>{b(await y())})();let e=setInterval(async()=>{let n=await y();b(n);let a=n.currentPhase===n.phases&&n.completed===n.iterations,l=!!n.status&&n.status<0;(n.status&&n.status<0||a||l)&&clearInterval(e)},2e3);return()=>clearInterval(e)},[]);let F=I.phases?I.currentPhase/I.phases*100:0,A=I.iterations?I.completed/I.iterations*100:0;return(0,t.jsx)(i.Z,{form:I,maxAccess:l,isInfo:!1,editMode:!0,isCleared:!1,actions:[{key:"Cancel",condition:!0,onClick:()=>r.close(),disabled:!j&&!w}],isSaved:!1,children:(0,t.jsx)(u.R,{children:(0,t.jsx)(d.Q,{children:(0,t.jsxs)(Z,{children:[(0,t.jsx)(s.ZP,{item:!0,xs:12,children:(0,t.jsx)(p.Z,{name:"phase",label:v.Phase,value:I.currentPhaseName,readOnly:!0,maxAccess:l})}),(0,t.jsxs)(C,{children:[(0,t.jsx)(_,{label:"".concat(v.Step," ").concat(I.currentPhase," of ").concat(I.phases,"..."),topLabel:v.currentPhase,width:"".concat(F,"%")}),(0,t.jsx)(_,{label:"".concat(v.Step," ").concat(I.completed," of ").concat(I.iterations,"..."),topLabel:v.Completed,width:"".concat(A,"%")})]}),(0,t.jsx)(m.Z,{name:"log",label:v.Log,value:I.logInfo,rows:4,maxAccess:l,readOnly:!0})]})})})})};N.width=500,N.height=450}},function(e){e.O(0,[3854,49774,92888,40179],function(){return e(e.s=32247)}),_N_E=e.O()}]);