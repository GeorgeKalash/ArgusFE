(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9098],{54064:function(e,a,l){(window.__NEXT_P=window.__NEXT_P||[]).push(["/hr-loans",function(){return l(77417)}])},77417:function(e,a,l){"use strict";l.r(a),l.d(a,{default:function(){return I}});var n=l(52322),t=l(2784),r=l(62202),d=l(69387),o=l(65950),s=l(71987),i=l(26612),u=l(31389),c=l(33625),m=l(62362),v=l(61802),p=l(19473),f=l(73581),h=l(36908),x=l(98345),y=l(7121),b=l(89764),I=()=>{let{getRequest:e,postRequest:a}=(0,t.useContext)(o.$),{platformLabels:l}=(0,t.useContext)(p.l),{stack:I}=(0,v.zY)();async function g(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{_startAt:l=0,_pageSize:n=50,params:t=[]}=a;return{...await e({extension:f.h.Loans.page,parameters:"_params=".concat(t||"","&_size=").concat(n,"&_startAt=").concat(l,"&_sortBy=recordId")}),_startAt:l}}let{query:{data:_},labels:C,paginationParameters:N,refetch:j,access:Z,invalidate:D,filterBy:A}=(0,s.J)({queryFn:g,endpointId:f.h.Loans.page,datasetId:i.i.Loans,filter:{filterFn:F}});async function F(e){let{filters:a,pagination:l}=e;return g({_startAt:l._startAt||0,params:null==a?void 0:a.params})}let L=[{field:"reference",headerName:C.reference,flex:1},{field:"employeeName",headerName:C.employeeName,flex:1},{field:"date",headerName:C.date,flex:1,type:"date"},{field:"amount",headerName:C.amount,flex:1,type:"number"},{field:"deductedAmount",headerName:C.deductedAmount,flex:1,type:"number"},{field:"balance",headerName:C.balance,flex:1,type:"number"},{field:"statusName",headerName:C.status,flex:1},{field:"ldValue",headerName:C.paymentValue,flex:1,type:"number"},{field:"rsName",headerName:C.releaseStatus,flex:1},{field:"wipName",headerName:C.wip,flex:1}],{proxyAction:V}=(0,x.G)({functionId:y.J.LoanRequest,action:T}),w=async()=>{await V()};function T(e){I({Component:b.Z,props:{recordId:e}})}let R=async e=>{await a({extension:f.h.Loans.del,record:JSON.stringify(e)}),D(),r.ZP.success(l.Deleted)};return(0,n.jsxs)(u.R,{children:[(0,n.jsx)(c.g,{children:(0,n.jsx)(h.Z,{onAdd:w,maxAccess:Z,filterBy:A,reportName:"LTLR",hasSearch:!1})}),(0,n.jsx)(m.Q,{children:(0,n.jsx)(d.Z,{name:"table",columns:L,gridData:_,rowId:["recordId"],onEdit:e=>{T(e.recordId)},onDelete:R,pageSize:50,paginationType:"api",paginationParameters:N,refetch:j,maxAccess:Z})})]})}},73581:function(e,a,l){"use strict";l.d(a,{h:function(){return t}});let n="LT.asmx/",t={LoanType:{get:n+"getLT",set:n+"setLT",del:n+"delLT",qry:n+"qryLT",page:n+"pageLT"},Loans:{get:n+"getLR",set:n+"setLR",del:n+"delLR",page:n+"pageLR",close:n+"closeLR",reopen:n+"reopenLR"},LoanDeduction:{page:n+"pageLD",get:n+"getLD",set:n+"setLD",del:n+"delLD"}}},1685:function(e,a,l){"use strict";l.d(a,{m:function(){return n}});let n=e=>{let a=window.sessionStorage.getItem(e);return a?JSON.parse(a):null}},98345:function(e,a,l){"use strict";l.d(a,{H:function(){return f},G:function(){return p}});var n=l(45300),t=l(2784),r=l(96026),d=l(38449);l(26612);var o=l(65947),s=l(1685);let i=async(e,a,l)=>{try{let n=await e({extension:a,parameters:l});return a.includes("qry")?n:n.record}catch(e){return null}},u=(e,a,l,n)=>{let t=(e=JSON.parse(JSON.stringify(e))).record.controls,r=t.find(e=>"reference"===e.controlId);return r?r.accessLevel=(null==a?void 0:a.mandatory)?o.$7:o.rr:(null==a?void 0:a.mandatory)?t.push({sgId:0,resourceId:"",controlId:"".concat(n?n+".":"","reference"),accessLevel:(null==a?void 0:a.mandatory)?o.$7:o.rr}):(null==a?void 0:a.readOnly)?t.push({sgId:0,resourceId:"",controlId:"".concat(n?n+".":"","reference"),accessLevel:(null==a?void 0:a.readOnly)?o.rr:o.$7}):t=e.record.controls.filter(e=>"reference"!=e.controlId),l&&t.push({sgId:0,resourceId:"",controlId:"".concat(n?n+".":"","dtId"),accessLevel:o.$7}),{...e,record:{...e.record,controls:t}}},c=async(e,a,l)=>{let n,t;switch(l){case"dtId":let r=(0,s.m)("userData"),o=null==r?void 0:r.userId;t="_userId=".concat(o,"&_functionId=").concat(a),n=d.r.UserFunction.get;break;case"glbSysNumberRange":t="_recordId=".concat(a),n=d.r.SystemFunction.get;break;case"DocumentType":t="_dgId=".concat(a,"&_startAt=",0,"&_pageSize=",50),n=d.r.DocumentType.qry;break;case"DcTypNumberRange":t="_recordId=".concat(a),n=d.r.DocumentType.get;break;case"isExternal":t="_recordId=".concat(a),n=d.r.NumberRange.get;break;default:return null}return await i(e,n,t)},m=async function(e){let a,l,n,t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,d=arguments.length>2?arguments[2]:void 0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,s=!(arguments.length>4)||void 0===arguments[4]||arguments[4],i=arguments.length>5?arguments[5]:void 0,m=void 0===o&&r&&await c(e,r,"dtId"),v=null==m?void 0:m.dtId,p="",f=!0;if(m&&void 0===o||"nraId"===o){if(v){let l=await c(e,v,"DcTypNumberRange");a=null==l?void 0:l.nraId,f=!((null==l?void 0:l.activeStatus)<0),a||(p="Assign the document type to a number range")}if((!v||!f)&&s&&r){var h;let a=await c(e,r,"DocumentType");t=(null==a?void 0:null===(h=a.list)||void 0===h?void 0:h.filter(e=>(null==e?void 0:e.activeStatus)===1).length)>0}}if(("nraId"===o||void 0===o)&&r){if((!v||v)&&!a||a&&!f){let l=await c(e,r,"glbSysNumberRange");(a=null==l?void 0:l.nraId)&&t&&(t=!1),f=!0}p=a||t?"":"Assign the system Function to a number range"}o>0&&!a&&(a=o),a&&f?(l={readOnly:null==(n=await c(e,a,"isExternal"))||!n.external,mandatory:null!=n&&!!n.external},d&&(d=await u(d,l,t,i))):!a&&d&&(d=await u(d,l,t,i));let x=i?"".concat(i,".reference"):"reference";return{dtId:v,resetReference:null==l?void 0:l.readOnly,dcTypeRequired:t,reference:{fieldName:x,isEmpty:(null==n?void 0:n.external)!==void 0&&(null==n||!n.external)},errorMessage:p,maxAccess:d,selectNraId:o}};var v=l(65950);function p(e){let{functionId:a,action:l,hasDT:n}=e,{getRequest:d}=(0,t.useContext)(v.$),{stack:o}=(0,r.V)();return{proxyAction:async()=>{let e=await m(d,a,"",void 0,n);(null==e?void 0:e.errorMessage)?o({message:null==e?void 0:e.errorMessage}):await l()}}}function f(e){var a;let{functionId:l,access:d,hasDT:o,enabled:s=!0,objectName:i=""}=e,{getRequest:u}=(0,t.useContext)(v.$),{stack:c}=(0,r.V)(),[p,f]=(0,t.useState)(),h=async e=>{let a=await m(u,l,d,e,o,i);if(!a.errorMessage)return a;c({message:null==a?void 0:a.errorMessage})},x=(0,n.a)({retry:!1,staleTime:0,enabled:s,queryKey:[l,p,!!d,s],queryFn:p||"nraId"===p?()=>h(p):()=>h()});return{documentType:x.data,maxAccess:(null==x?void 0:null===(a=x.data)||void 0===a?void 0:a.maxAccess)||d,changeDT(e){f((null==e?void 0:e.nraId)||"nraId")}}}},29326:function(e,a,l){"use strict";var n=l(52322);l(2784);var t=l(23925),r=l(13980),d=l.n(r),o=l(95291),s=l.n(o),i=l(65947);let u=e=>{var a,l,r;let{children:d,value:o,index:u,maxAccess:c,...m}=e,v="".concat(e.name||"tab",".").concat(u),{accessLevel:p}=null!==(r=(null!==(l=null==c?void 0:null===(a=c.record)||void 0===a?void 0:a.controls)&&void 0!==l?l:[]).find(e=>e.controlId===v))&&void 0!==r?r:{accessLevel:0};if(p===i.A1)return null;let f=o===u;return(0,n.jsx)(t.Z,{role:"tabpanel",hidden:!f,id:"simple-tabpanel-".concat(u),"aria-labelledby":"simple-tab-".concat(u),className:"".concat(s().tabPanel," ").concat(f?s().active:s().hidden),...m,children:d})};u.propTypes={children:d().node,index:d().number.isRequired,value:d().number.isRequired},a.Z=u},9522:function(e,a,l){"use strict";l.d(a,{Y:function(){return m}});var n=l(52322),t=l(23925),r=l(54582),d=l(68696),o=l(44258),s=l(2784),i=l(99266),u=l(52614),c=l.n(u);let m=e=>{var a,l,u,m,v;let{tabs:p,activeTab:f,setActiveTab:h,maxAccess:x,name:y="tab"}=e,b=(null==x?void 0:null===(l=x.record)||void 0===l?void 0:null===(a=l.controls)||void 0===a?void 0:a.filter(e=>{var a;return 4===e.accessLevel&&(null===(a=e.controlId)||void 0===a?void 0:a.startsWith("".concat(y,".")))}).map(e=>e.controlId.split(".")[1]))||[],I=null==p?void 0:null===(u=p.map((e,a)=>({...e,id:a})))||void 0===u?void 0:u.filter((e,a)=>!b.includes(String(a))),g=null===(m=I[f])||void 0===m?void 0:m.id,_=null===(v=I[f])||void 0===v?void 0:v.disabled;return(0,s.useEffect)(()=>{g>=0&&!_&&f!=g&&h(g)},[]),(0,n.jsx)(t.Z,{className:c().tabsContainer,children:(0,n.jsx)(t.Z,{className:c().tabsWrapper,children:(0,n.jsx)(r.Z,{value:f,onChange:(e,a)=>h(a),variant:"scrollable",scrollButtons:I.length>3?"auto":"off","aria-label":"scrollable tabs",classes:{indicator:c().tabsIndicator},className:c().tabs,children:null==I?void 0:I.map(e=>(0,n.jsx)(d.Z,{value:e.id,disabled:null==e?void 0:e.disabled,className:"".concat(c().tabName," ").concat(e.disabled?c().tabDisabled:""),classes:{root:c().tabRoot,selected:c().selectedTab},label:(0,n.jsxs)(t.Z,{display:"flex",alignItems:"center",children:[(0,n.jsx)("span",{children:e.label}),e.id===f&&(null==e?void 0:e.onRefetch)&&(0,n.jsx)(o.Z,{size:"small",className:c().refreshButton,onClick:a=>{a.stopPropagation(),e.onRefetch()},children:(0,n.jsx)(i.Z,{className:c().refreshIcon})})]})},e.id))})})})}},89764:function(e,a,l){"use strict";l.d(a,{Z:function(){return B}});var n=l(52322),t=l(29326),r=l(9522),d=l(2784),o=l(60218),s=l(48601),i=l(82737),u=l(62202),c=l(65950),m=l(71987),v=l(26612),p=l(5088),f=l(80983),h=l(19473),x=l(31389),y=l(33625),b=l(8661),I=l(84100),g=l(73581),_=l(91406),C=l(27423),N=l(92407),j=l(70104),Z=l(38449),D=l(89330),A=l(21581),F=l(39812),L=l(7121);function V(e){var a,l,t,r,V,w,T,R,P,q;let{labels:O,maxAccess:k,store:S,setStore:E,window:M}=e,{getRequest:B,postRequest:J}=(0,d.useContext)(c.$),{platformLabels:z,defaultsData:$}=(0,d.useContext)(h.l),{recordId:W}=S,Y=(0,m.E)({endpointId:g.h.Loans.page}),Q=null==$?void 0:null===(l=$.list)||void 0===l?void 0:null===(a=l.find(e=>{let{key:a}=e;return"currencyId"===a}))||void 0===a?void 0:a.value,U=null==$?void 0:null===(r=$.list)||void 0===r?void 0:null===(t=r.find(e=>{let{key:a}=e;return"ldMethod"===a}))||void 0===t?void 0:t.value,X=null==$?void 0:null===(w=$.list)||void 0===w?void 0:null===(V=w.find(e=>{let{key:a}=e;return"ldValue"===a}))||void 0===V?void 0:V.value,{formik:G}=(0,f.c)({initialValues:{recordId:null,status:1,releaseStatus:null,wip:1,reference:"",date:new Date,employeeId:null,branchId:null,departmentName:"",positionName:"",ltId:null,ltName:"",loanBalance:null,currencyId:parseInt(Q),amount:null,purpose:"",effectiveDate:new Date,ldMethod:parseInt(U),ldmName:"",ldValue:parseInt(X),disableEditing:!1},maxAccess:k,validationSchema:s.Ry({reference:s.Z_().required(),employeeId:s.Rx().required(),date:s.hT().required(),ltId:s.Rx().required(),currencyId:s.Rx().required(),amount:s.Rx().min(1).required(),purpose:s.Z_().required(),ldValue:s.Rx().min(1).required(),effectiveDate:s.hT().required(),ldMethod:s.Rx().required()}),onSubmit:async e=>{let a={...e,date:(0,F.ku)(e.date),effectiveDate:(0,F.ku)(e.effectiveDate)};await J({extension:g.h.Loans.set,record:JSON.stringify(a)}),u.ZP.success(e.recordId?z.Edited:z.Added),Y(),M.close()}}),H=!!(null==G?void 0:null===(T=G.values)||void 0===T?void 0:T.recordId),K=2==G.values.wip;(0,d.useEffect)(()=>{W&&ee(W)},[]);let ee=async e=>{let a=await B({extension:g.h.Loans.get,parameters:"_recordId=".concat(e)});if(null==a?void 0:a.record){let{record:e}=a;G.setValues({...e,date:(0,F.a1)(e.date),effectiveDate:(0,F.a1)(e.effectiveDate)}),E(l=>{var n;return{...l,isClosed:2===e.wip,loanAmount:null!==(n=e.amount)&&void 0!==n?n:0,effectiveDate:(0,F.a1)(a.record.effectiveDate)}}),await ea(e.employeeId)}return a},ea=async e=>{if(!e){el();return}let{record:a}=await B({extension:N.y.QuickView.get,parameters:"_recordId=".concat(e,"&_asOfDate=").concat((0,F.uQ)(new Date))});G.setValues(l=>{var n;return{...l,employeeId:e,employeeRef:(null==a?void 0:a.reference)||"",employeeName:(null==a?void 0:a.fullName)||"",positionName:(null==a?void 0:a.positionName)||"",departmentName:(null==a?void 0:a.departmentName)||"",loanBalance:null!==(n=null==a?void 0:a.loanBalance)&&void 0!==n?n:0,branchId:(null==a?void 0:a.branchId)||null}})},el=()=>{G.setValues(e=>({...e,employeeId:null,employeeRef:"",employeeName:"",positionName:"",departmentName:"",loanBalance:0,branchId:null}))},en=async e=>{let a=await ee(e);(null==a?void 0:a.record)&&(G.setValues(e=>({...e,...a.record,date:(0,F.a1)(a.record.date),effectiveDate:(0,F.a1)(a.record.effectiveDate)})),E(e=>({...e,isClosed:2===a.record.wip,effectiveDate:(0,F.a1)(a.record.effectiveDate)})))},et=[{key:"RecordRemarks",condition:!0,onClick:"onRecordRemarks",disabled:!H},{key:"Approval",condition:!0,onClick:"onApproval",disabled:!K||!H},{key:"Close",condition:!K,onClick:async()=>{let e=await J({extension:g.h.Loans.close,record:JSON.stringify(G.values)});u.ZP.success(z.Closed),Y(),en(e.recordId)},disabled:K||!H},{key:"Reopen",condition:K,onClick:async()=>{let e=await J({extension:g.h.Loans.reopen,record:JSON.stringify(G.values)});u.ZP.success(z.Reopened),Y(),en(e.recordId)},disabled:!K||!H}];return(0,n.jsx)(i.Z,{resourceId:v.i.Loans,form:G,maxAccess:k,editMode:H,actions:et,disabledSubmit:K,functionId:L.J.LoanRequest,children:(0,n.jsx)(x.R,{children:(0,n.jsx)(y.g,{children:(0,n.jsxs)(o.ZP,{container:!0,spacing:2,children:[(0,n.jsx)(o.ZP,{item:!0,xs:12,children:(0,n.jsx)(p.Z,{name:"reference",label:O.reference,value:G.values.reference,required:!0,readOnly:H,maxAccess:k,maxLength:"20",onChange:G.handleChange,onClear:()=>G.setFieldValue("reference",""),error:G.touched.reference&&!!G.errors.reference})}),(0,n.jsx)(o.ZP,{item:!0,xs:12,children:(0,n.jsx)(D.Z,{name:"date",required:!0,max:G.values.effectiveDate,readOnly:K,label:O.date,value:null==G?void 0:null===(R=G.values)||void 0===R?void 0:R.date,onChange:G.setFieldValue,maxAccess:k,onClear:()=>G.setFieldValue("date",null),error:G.touched.date&&!!G.errors.date})}),(0,n.jsx)(o.ZP,{item:!0,xs:12,children:(0,n.jsx)(C.U,{endpointId:N.y.Employee.snapshot,parameters:{_branchId:0},valueField:"reference",displayField:"fullName",name:"employeeId",required:!0,readOnly:K,displayFieldWidth:2,label:O.employeeName,form:G,valueShow:"employeeRef",secondValueShow:"employeeName",columnsInDropDown:[{key:"reference",value:"Reference"},{key:"fullName",value:"Name"}],maxAccess:k,onChange:(e,a)=>{ea((null==a?void 0:a.recordId)||null)},errorCheck:"employeeId"})}),(0,n.jsx)(o.ZP,{item:!0,xs:12,children:(0,n.jsx)(b.Z,{endpointId:j.K.BranchFilters.qry,name:"branchId",label:O.branch,readOnly:!0,valueField:"recordId",displayField:["reference","name"],values:G.values,maxAccess:k,onChange:(e,a)=>G.setFieldValue("branchId",(null==a?void 0:a.recordId)||null),error:G.touched.branchId&&!!G.errors.branchId})}),(0,n.jsx)(o.ZP,{item:!0,xs:12,children:(0,n.jsx)(p.Z,{name:"departmentName",label:O.department,value:G.values.departmentName,readOnly:!0,maxAccess:k,error:G.touched.departmentName&&!!G.errors.departmentName})}),(0,n.jsx)(o.ZP,{item:!0,xs:12,children:(0,n.jsx)(p.Z,{name:"positionName",label:O.position,value:G.values.positionName,readOnly:!0,maxAccess:k,error:G.touched.positionName&&!!G.errors.positionName})}),(0,n.jsx)(o.ZP,{item:!0,xs:12,children:(0,n.jsx)(b.Z,{endpointId:g.h.LoanType.qry,name:"ltId",label:O.ltype,required:!0,readOnly:K,valueField:"recordId",displayField:"name",values:G.values,onChange:(e,a)=>{G.setFieldValue("disableEditing",(null==a?void 0:a.disableEditing)||!1),G.setFieldValue("ldMethod",(null==a?void 0:a.ldMethod)||null),G.setFieldValue("ldValue",(null==a?void 0:a.ldValue)||0),G.setFieldValue("ltId",(null==a?void 0:a.recordId)||null)},error:G.touched.ltId&&!!G.errors.ltId})}),(0,n.jsx)(o.ZP,{item:!0,xs:12,children:(0,n.jsx)(_.Z,{name:"loanBalance",label:O.loanBalance,value:null==G?void 0:null===(P=G.values)||void 0===P?void 0:P.loanBalance,maxAccess:k,readOnly:!0})}),(0,n.jsx)(o.ZP,{item:!0,xs:12,children:(0,n.jsx)(b.Z,{endpointId:Z.r.Currency.qry,filter:e=>1===e.currencyType,name:"currencyId",label:O.currency,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:G.values,required:!0,readOnly:K,maxAccess:k,onChange:async(e,a)=>{G.setFieldValue("currencyName",(null==a?void 0:a.name)||""),G.setFieldValue("currencyRef",(null==a?void 0:a.reference)||""),G.setFieldValue("currencyId",(null==a?void 0:a.recordId)||null)},error:G.touched.currencyId&&!!G.errors.currencyId})}),(0,n.jsx)(o.ZP,{item:!0,xs:12,children:(0,n.jsx)(_.Z,{name:"amount",label:O.amount,value:G.values.amount,required:!0,readOnly:K,maxAccess:k,onChange:e=>G.setFieldValue("amount",e.target.value),onClear:async()=>{G.setFieldValue("amount",null)},error:G.touched.amount&&!!G.errors.amount,maxLength:10})}),(0,n.jsx)(o.ZP,{item:!0,xs:12,children:(0,n.jsx)(A.Z,{name:"purpose",label:O.purpose,required:!0,rows:2,readOnly:K,value:G.values.purpose,maxAccess:k,onChange:e=>G.setFieldValue("purpose",e.target.value),onClear:()=>G.setFieldValue("purpose",""),error:G.touched.purpose&&!!G.errors.purpose})}),(0,n.jsx)(o.ZP,{item:!0,xs:12,children:(0,n.jsx)(D.Z,{name:"effectiveDate",label:O.effectiveDate,value:null==G?void 0:null===(q=G.values)||void 0===q?void 0:q.effectiveDate,required:!0,min:G.values.date,readOnly:K,onChange:G.setFieldValue,maxAccess:k,onClear:()=>G.setFieldValue("effectiveDate",null),error:G.touched.effectiveDate&&!!G.errors.effectiveDate})}),(0,n.jsx)(o.ZP,{item:!0,xs:12,children:(0,n.jsx)(b.Z,{datasetId:I.v.LOAN_DEDUCTION_METHOD,name:"ldMethod",label:O.ldMethod,required:!0,readOnly:K||G.values.disableEditing,valueField:"key",displayField:"value",values:G.values,maxAccess:k,onChange:(e,a)=>G.setFieldValue("ldMethod",(null==a?void 0:a.key)||null),onClear:async()=>{G.setFieldValue("ldMethod",null),G.setFieldValue("ldValue",null)},error:G.touched.ldMethod&&!!G.errors.ldMethod})}),(0,n.jsx)(o.ZP,{item:!0,xs:12,children:(0,n.jsx)(_.Z,{name:"ldValue",label:O.ldValue,value:G.values.ldValue,required:!0,readOnly:K||G.values.disableEditing,maxAccess:k,onChange:e=>G.setFieldValue("ldValue",e.target.value),onClear:()=>G.setFieldValue("ldValue",null),error:G.touched.ldValue&&!!G.errors.ldValue,maxLength:10})})]})})})})}var w=l(69387),T=l(62362),R=l(27723),P=l(61802),q=l(19689);function O(e){var a,l;let{labels:t,recordId:r,store:p,maxAccess:y,loanAmount:C,window:N}=e,{getRequest:j,postRequest:Z}=(0,d.useContext)(c.$),{platformLabels:L}=(0,d.useContext)(h.l),V=(0,m.E)({endpointId:g.h.LoanDeduction.page}),{formik:w}=(0,f.c)({maxAccess:y,initialValues:{loanId:p.recordId,recordId:null,payrollDeduction:!1,amount:null,date:new Date,type:null,notes:""},validationSchema:s.Ry({amount:s.Rx().required().max(C),date:s.hT().required(),type:s.Z_().required()}),onSubmit:e=>{let a={...e,date:(0,F.ku)(e.date),payrollDeduction:1===e.type};Z({extension:g.h.LoanDeduction.set,record:JSON.stringify(a)}).then(a=>{u.ZP.success(e.recordId?L.Edited:L.Added),w.setFieldValue("recordId",a.recordId),V(),N.close()})}}),R=!!w.values.recordId;return(0,d.useEffect)(()=>{!async function(){if(r){var e;let a=await j({extension:g.h.LoanDeduction.get,parameters:"_recordId=".concat(r)});w.setValues({...null==a?void 0:a.record,date:(0,F.a1)(null==a?void 0:null===(e=a.record)||void 0===e?void 0:e.date)})}}()},[]),(0,n.jsx)(i.Z,{resourceId:v.i.Loans,form:w,maxAccess:y,disabledSubmit:!p.isClosed||w.values.payrollDeduction,editMode:R,isInfo:!1,isCleared:!1,children:(0,n.jsx)(x.R,{children:(0,n.jsx)(T.Q,{children:(0,n.jsxs)(o.ZP,{container:!0,spacing:2,children:[(0,n.jsx)(o.ZP,{item:!0,xs:6,children:(0,n.jsx)(q.Z,{name:"payrollDeduction",value:null===(a=w.values)||void 0===a?void 0:a.payrollDeduction,readOnly:!0,label:t.payrollDeduction,maxAccess:y})}),(0,n.jsx)(o.ZP,{item:!0,xs:12,children:(0,n.jsx)(_.Z,{name:"amount",label:t.deductionAmount,value:w.values.amount,required:!0,readOnly:!p.isClosed||w.values.payrollDeduction,maxAccess:y,onChange:async e=>{var a;w.setFieldValue("amount",(null==e?void 0:null===(a=e.target)||void 0===a?void 0:a.value)||null)},onClear:async()=>{w.setFieldValue("amount",null)},error:w.touched.amount&&!!w.errors.amount,maxLength:10})}),(0,n.jsx)(o.ZP,{item:!0,xs:12,children:(0,n.jsx)(D.Z,{name:"date",label:t.date,required:!0,min:p.effectiveDate,readOnly:!p.isClosed||w.values.payrollDeduction,value:null==w?void 0:null===(l=w.values)||void 0===l?void 0:l.date,onChange:w.setFieldValue,maxAccess:y,onClear:()=>w.setFieldValue("date",null),error:w.touched.date&&!!w.errors.date})}),(0,n.jsx)(o.ZP,{item:!0,xs:12,children:(0,n.jsx)(b.Z,{datasetId:I.v.LOAN_TYPE,name:"type",label:t.type,required:!0,readOnly:!p.isClosed||w.values.payrollDeduction,valueField:"key",displayField:"value",values:w.values,maxAccess:y,onChange:(e,a)=>{w.setFieldValue("type",(null==a?void 0:a.key)||null)},error:w.touched.type&&!!w.errors.type})}),(0,n.jsx)(o.ZP,{item:!0,xs:12,children:(0,n.jsx)(A.Z,{name:"notes",label:t.notes,readOnly:!p.isClosed||w.values.payrollDeduction,value:w.values.notes,maxLength:"100",maxAccess:y,onChange:e=>w.setFieldValue("notes",e.target.value),onClear:()=>w.setFieldValue("notes",""),error:w.touched.notes&&!!w.errors.notes})})]})})})})}var k=e=>{var a;let{store:l,labels:t}=e,{recordId:r}=l,{getRequest:s,postRequest:i}=(0,d.useContext)(c.$),{platformLabels:p}=(0,d.useContext)(h.l),{stack:f}=(0,P.zY)(),b=[{field:"payrollDeduction",headerName:t.payrollDeduction,type:"checkbox",flex:1},{field:"amount",headerName:t.amount,flex:1,type:"number"},{field:"date",headerName:t.date,flex:1,type:"date"},{field:"typeName",headerName:t.type,flex:1},{field:"notes",headerName:t.notes,flex:1}];async function I(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{_startAt:a=0,_pageSize:l=50}=e;return{...await s({extension:g.h.LoanDeduction.page,parameters:"_loanId=".concat(r,"&_pageSize=").concat(l,"&_startAt=").concat(a)}),_startAt:a}}let{query:{data:C},access:N,invalidate:j,paginationParameters:Z,refetch:D}=(0,m.J)({queryFn:I,endpointId:g.h.LoanDeduction.page,datasetId:v.i.Loans,enabled:!!r}),A=parseFloat((null==C?void 0:null===(a=C.list)||void 0===a?void 0:a.reduce((e,a)=>e+(a.amount||0),0))||0).toFixed(2),F=parseFloat((l.loanAmount||0)-A).toFixed(2);function L(e){f({Component:O,props:{labels:t,store:l,maxAccess:N,loanAmount:l.loanAmount,recordId:e},width:600,height:500,title:t.Deduction})}let V=async e=>{await i({extension:g.h.LoanDeduction.del,record:JSON.stringify(e)}),j(),u.ZP.success(p.Deleted)};return(0,n.jsxs)(x.R,{children:[(0,n.jsx)(y.g,{children:(0,n.jsx)(R.Z,{disableAdd:!l.isClosed,onAdd:()=>L(),maxAccess:N})}),(0,n.jsx)(T.Q,{children:(0,n.jsx)(w.Z,{name:"deductionTable",columns:b,gridData:C,rowId:"recordId",onEdit:e=>L(e.recordId),onDelete:l.isClosed&&V,actionCondition:(e,a)=>"delete"!==a||!1===e.payrollDeduction,pageSize:50,paginationType:"api",paginationParameters:Z,refetch:D,maxAccess:N})}),(0,n.jsx)(y.g,{children:(0,n.jsxs)(o.ZP,{container:!0,sx:{p:2},spacing:2,children:[(0,n.jsx)(o.ZP,{item:!0,xs:4,children:(0,n.jsx)(_.Z,{name:"loanAmount",label:t.loanAmount,value:parseFloat(l.loanAmount).toFixed(2),readOnly:!0})}),(0,n.jsx)(o.ZP,{item:!0,xs:4,children:(0,n.jsx)(_.Z,{name:"deductedAmount",label:t.deductedAmount,value:A,readOnly:!0})}),(0,n.jsx)(o.ZP,{item:!0,xs:4,children:(0,n.jsx)(_.Z,{name:"remainingBalance",label:t.remainingBalance,value:F,readOnly:!0})})]})})]})},S=l(21326),E=l(50023);let M=e=>{let{recordId:a,window:l}=e,[o,s]=(0,d.useState)(0),[i,u]=(0,d.useState)({recordId:a,isClosed:!1,loanAmount:0,effectiveDate:null}),{labels:c,access:m}=(0,E.Z)({datasetId:v.i.Loans,editMode:!!a});(0,S.Z)({title:c.Loans,window:l});let p=[{label:c.LoanInfo},{label:c.Deduction,disabled:!i.recordId}];return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(r.Y,{tabs:p,activeTab:o,setActiveTab:s}),(0,n.jsx)(t.Z,{index:0,value:o,children:(0,n.jsx)(V,{labels:c,setStore:u,store:i,maxAccess:m,window:l})}),(0,n.jsx)(t.Z,{index:1,value:o,children:(0,n.jsx)(k,{labels:c,store:i})})]})};M.width=800,M.height=600;var B=M},95291:function(e){e.exports={tabPanel:"CustomTabPanel_tabPanel__80Dfu",active:"CustomTabPanel_active___6Uvb",hidden:"CustomTabPanel_hidden__y9566"}},52614:function(e){e.exports={customTabPanel:"CustomTabs_customTabPanel__Ztocv",hidden:"CustomTabs_hidden__lZpM7",tabsContainer:"CustomTabs_tabsContainer__28Syi",tabsWrapper:"CustomTabs_tabsWrapper__mlxxj",tabs:"CustomTabs_tabs__25pli",tabName:"CustomTabs_tabName__XzMCn",tabRoot:"CustomTabs_tabRoot__WVR1E",tabDisabled:"CustomTabs_tabDisabled__VauYR",selectedTab:"CustomTabs_selectedTab__sZzwF",tabsIndicator:"CustomTabs_tabsIndicator__89Lek",refreshButton:"CustomTabs_refreshButton__P2mzl",refreshIcon:"CustomTabs_refreshIcon__ADVWF"}}},function(e){e.O(0,[92515,2494,36908,49774,92888,40179],function(){return e(e.s=54064)}),_N_E=e.O()}]);