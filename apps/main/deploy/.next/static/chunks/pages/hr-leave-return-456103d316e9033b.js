(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[81482],{76860:function(e,a,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/hr-leave-return",function(){return t(81160)}])},81160:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return g}});var n=t(52322),r=t(2784),l=t(69387),d=t(65950),i=t(71987),o=t(26612),s=t(31389),u=t(33625),c=t(62362),v=t(36908),m=t(50496),f=t(61802),y=t(98345),p=t(7121),x=t(62202),h=t(19473),I=t(23427),g=()=>{let{getRequest:e,postRequest:a}=(0,r.useContext)(d.$),{stack:t}=(0,f.zY)(),{platformLabels:g}=(0,r.useContext)(h.l);async function D(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{_startAt:t=0,_pageSize:n=50,params:r}=a;return{...await e({extension:m.U.LeaveReturn.page,parameters:"_startAt=".concat(t,"&_pageSize=").concat(n,"&_size=50&_params=").concat(r||"")}),_startAt:t}}let{query:{data:w},labels:N,paginationParameters:R,filterBy:_,refetch:b,access:k,invalidate:j}=(0,i.J)({queryFn:D,endpointId:m.U.LeaveReturn.page,datasetId:o.i.LeaveReturn}),{proxyAction:C}=(0,y.G)({functionId:p.J.ReturnFromLeave,action:T}),S=[{field:"reference",headerName:N.reference,flex:1},{field:"employeeRef",headerName:N.employeeRef,flex:1},{field:"employeeName",headerName:N.employeeName,flex:1},{field:"rtName",headerName:N.returnType,flex:1},{field:"date",headerName:N.date,flex:1,type:"date"},{field:"justification",headerName:N.justification,flex:1},{field:"statusName",headerName:N.status,flex:1},{field:"rsName",headerName:N.releaseStatus,flex:1},{field:"wipName",headerName:N.wip,flex:1}];function T(e){t({Component:I.Z,props:{recordId:e}})}let L=async e=>{await a({extension:m.U.LeaveReturn.del,record:JSON.stringify(e)}),j(),x.ZP.success(g.Deleted)};return(0,n.jsxs)(s.R,{children:[(0,n.jsx)(u.g,{children:(0,n.jsx)(v.Z,{hasSearch:!1,onAdd:()=>{C()},maxAccess:k,reportName:"LMRE",filterBy:_})}),(0,n.jsx)(c.Q,{children:(0,n.jsx)(l.Z,{name:"table",columns:S,gridData:w,rowId:["recordId"],onEdit:e=>{T(null==e?void 0:e.recordId)},onDelete:L,pageSize:50,refetch:b,paginationParameters:R,paginationType:"api",maxAccess:k})})]})}},1685:function(e,a,t){"use strict";t.d(a,{m:function(){return n}});let n=e=>{let a=window.sessionStorage.getItem(e);return a?JSON.parse(a):null}},98345:function(e,a,t){"use strict";t.d(a,{H:function(){return y},G:function(){return f}});var n=t(45300),r=t(2784),l=t(96026),d=t(38449);t(26612);var i=t(65947),o=t(1685);let s=async(e,a,t)=>{try{let n=await e({extension:a,parameters:t});return a.includes("qry")?n:n.record}catch(e){return null}},u=(e,a,t,n)=>{let r=(e=JSON.parse(JSON.stringify(e))).record.controls,l=r.find(e=>"reference"===e.controlId);return l?l.accessLevel=(null==a?void 0:a.mandatory)?i.$7:i.rr:(null==a?void 0:a.mandatory)?r.push({sgId:0,resourceId:"",controlId:"".concat(n?n+".":"","reference"),accessLevel:(null==a?void 0:a.mandatory)?i.$7:i.rr}):(null==a?void 0:a.readOnly)?r.push({sgId:0,resourceId:"",controlId:"".concat(n?n+".":"","reference"),accessLevel:(null==a?void 0:a.readOnly)?i.rr:i.$7}):r=e.record.controls.filter(e=>"reference"!=e.controlId),t&&r.push({sgId:0,resourceId:"",controlId:"".concat(n?n+".":"","dtId"),accessLevel:i.$7}),{...e,record:{...e.record,controls:r}}},c=async(e,a,t)=>{let n,r;switch(t){case"dtId":let l=(0,o.m)("userData"),i=null==l?void 0:l.userId;r="_userId=".concat(i,"&_functionId=").concat(a),n=d.r.UserFunction.get;break;case"glbSysNumberRange":r="_recordId=".concat(a),n=d.r.SystemFunction.get;break;case"DocumentType":r="_dgId=".concat(a,"&_startAt=",0,"&_pageSize=",50),n=d.r.DocumentType.qry;break;case"DcTypNumberRange":r="_recordId=".concat(a),n=d.r.DocumentType.get;break;case"isExternal":r="_recordId=".concat(a),n=d.r.NumberRange.get;break;default:return null}return await s(e,n,r)},v=async function(e){let a,t,n,r,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,d=arguments.length>2?arguments[2]:void 0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,o=!(arguments.length>4)||void 0===arguments[4]||arguments[4],s=arguments.length>5?arguments[5]:void 0,v=void 0===i&&l&&await c(e,l,"dtId"),m=null==v?void 0:v.dtId,f="",y=!0;if(v&&void 0===i||"nraId"===i){if(m){let t=await c(e,m,"DcTypNumberRange");a=null==t?void 0:t.nraId,y=!((null==t?void 0:t.activeStatus)<0),a||(f="Assign the document type to a number range")}if((!m||!y)&&o&&l){var p;let a=await c(e,l,"DocumentType");r=(null==a?void 0:null===(p=a.list)||void 0===p?void 0:p.filter(e=>(null==e?void 0:e.activeStatus)===1).length)>0}}if(("nraId"===i||void 0===i)&&l){if((!m||m)&&!a||a&&!y){let t=await c(e,l,"glbSysNumberRange");(a=null==t?void 0:t.nraId)&&r&&(r=!1),y=!0}f=a||r?"":"Assign the system Function to a number range"}i>0&&!a&&(a=i),a&&y?(t={readOnly:null==(n=await c(e,a,"isExternal"))||!n.external,mandatory:null!=n&&!!n.external},d&&(d=await u(d,t,r,s))):!a&&d&&(d=await u(d,t,r,s));let x=s?"".concat(s,".reference"):"reference";return{dtId:m,resetReference:null==t?void 0:t.readOnly,dcTypeRequired:r,reference:{fieldName:x,isEmpty:(null==n?void 0:n.external)!==void 0&&(null==n||!n.external)},errorMessage:f,maxAccess:d,selectNraId:i}};var m=t(65950);function f(e){let{functionId:a,action:t,hasDT:n}=e,{getRequest:d}=(0,r.useContext)(m.$),{stack:i}=(0,l.V)();return{proxyAction:async()=>{let e=await v(d,a,"",void 0,n);(null==e?void 0:e.errorMessage)?i({message:null==e?void 0:e.errorMessage}):await t()}}}function y(e){var a;let{functionId:t,access:d,hasDT:i,enabled:o=!0,objectName:s=""}=e,{getRequest:u}=(0,r.useContext)(m.$),{stack:c}=(0,l.V)(),[f,y]=(0,r.useState)(),p=async e=>{let a=await v(u,t,d,e,i,s);if(!a.errorMessage)return a;c({message:null==a?void 0:a.errorMessage})},x=(0,n.a)({retry:!1,staleTime:0,enabled:o,queryKey:[t,f,!!d,o],queryFn:f||"nraId"===f?()=>p(f):()=>p()});return{documentType:x.data,maxAccess:(null==x?void 0:null===(a=x.data)||void 0===a?void 0:a.maxAccess)||d,changeDT(e){y((null==e?void 0:e.nraId)||"nraId")}}}},23427:function(e,a,t){"use strict";t.d(a,{Z:function(){return C}});var n=t(52322),r=t(60218),l=t(2784),d=t(48601),i=t(82737),o=t(62202),s=t(65950),u=t(71987),c=t(26612),v=t(5088),m=t(80983),f=t(19473),y=t(31389),p=t(62362),x=t(50496),h=t(27423),I=t(92407),g=t(89330),D=t(21581),w=t(39812),N=t(7121),R=t(98345),_=t(8661),b=t(84100),k=t(50023),j=t(21326);function C(e){var a,t,C,S;let{recordId:T,window:L}=e,{getRequest:F,postRequest:Z}=(0,l.useContext)(s.$),{platformLabels:A}=(0,l.useContext)(f.l),E=(0,u.E)({endpointId:x.U.LeaveReturn.page}),{labels:O,access:q}=(0,k.Z)({datasetId:c.i.LeaveReturn,editMode:!!T});(0,j.Z)({title:O.title,window:L});let{maxAccess:P}=(0,R.H)({functionId:N.J.ReturnFromLeave,access:q,enabled:!T}),{formik:V}=(0,m.c)({initialValues:{recordId:null,date:null,employeeId:null,employeeRef:"",employeeName:"",justification:"",leaveId:null,status:1,reference:"",returnType:null,wip:1,minDate:null,maxDate:null},maxAccess:P,validateOnChange:!0,validationSchema:d.Ry({date:d.hT().typeError().required().test(function(e){let{minDate:a,maxDate:t}=this.parent;return!e||!(a&&e<=new Date(a)||t&&e>=new Date(t))}),leaveId:d.Rx().required(),returnType:d.Rx().required(),justification:d.Z_().required()}),onSubmit:async e=>{let{minDate:a,maxDate:t,employeeName:n,date:r,...l}=e,d=await Z({extension:x.U.LeaveReturn.set,record:JSON.stringify({...l,date:(0,w.ku)(r)})});o.ZP.success(e.recordId?A.Edited:A.Added),$(d.recordId),E()}}),U=!!V.values.recordId,J=(null==V?void 0:null===(a=V.values)||void 0===a?void 0:a.wip)===2;async function $(e){if(e){let{record:a}=await F({extension:x.U.LeaveReturn.get,parameters:"_recordId=".concat(e)}),t=await X(a.returnType,a.leaveId);V.setValues({...a,date:(0,w.a1)(a.date),minDate:t.minDate,maxDate:t.maxDate})}}(0,l.useEffect)(()=>{$(T)},[]);let{minDate:M,maxDate:z,employeeName:B,date:G,...H}=V.values,Q=[{key:"Close",condition:!J,onClick:async()=>{await Z({extension:x.U.LeaveReturn.close,record:JSON.stringify({...H,date:(0,w.ku)(G)})}),o.ZP.success(A.Closed),$(H.recordId),E()},disabled:J||!U},{key:"Reopen",condition:J,onClick:async()=>{await Z({extension:x.U.LeaveReturn.reopen,record:JSON.stringify({...H,date:(0,w.ku)(G)})}),o.ZP.success(A.Reopened),$(H.recordId),E()},disabled:!J},{key:"Approval",condition:!0,onClick:"onApproval",disabled:!J}];async function X(e,a){let t={date:null,minDate:null,maxDate:null};if(!a||!e)return;let{record:n}=await F({extension:x.U.LeaveRequest.get,parameters:"_recordId=".concat(a)});switch(e){case"1":t.date=(0,w.a1)(n.startDate);break;case"2":t.minDate=(0,w.a1)(n.startDate),t.endDate=(0,w.a1)(n.endDate),t.date=new Date;break;case"3":let r=new Date((0,w.a1)(n.endDate));r.setDate(r.getDate()+1),t.date=r;break;case"4":t.date=new Date,t.minDate=n.startDate}return t}return(0,n.jsx)(i.Z,{resourceId:c.i.LeaveReturn,functionId:N.J.ReturnFromLeave,previewReport:U,form:V,maxAccess:P,editMode:U,actions:Q,disabledSubmit:J,children:(0,n.jsx)(y.R,{children:(0,n.jsx)(p.Q,{children:(0,n.jsxs)(r.ZP,{container:!0,spacing:2,children:[(0,n.jsx)(r.ZP,{item:!0,xs:12,children:(0,n.jsx)(v.Z,{name:"reference",label:O.reference,value:V.values.reference,maxAccess:P,maxLength:"30",readOnly:J,onChange:V.handleChange,onClear:()=>V.setFieldValue("reference",""),error:V.touched.reference&&!!V.errors.reference})}),(0,n.jsx)(r.ZP,{item:!0,xs:12,children:(0,n.jsx)(h.U,{endpointId:I.y.Employee.snapshot,parameters:{_branchId:0},filter:{activeStatus:1},valueField:"reference",displayField:"fullName",name:"employeeId",label:O.employee,secondFieldLabel:O.employeeName,form:V,readOnly:J,displayFieldWidth:2,valueShow:"employeeRef",secondValueShow:"employeeName",columnsInDropDown:[{key:"reference",value:"Reference"},{key:"fullName",value:"Name"}],maxAccess:P,onChange:async(e,a)=>{V.setFieldValue("employeeRef",(null==a?void 0:a.reference)||""),V.setFieldValue("employeeName",(null==a?void 0:a.fullName)||""),V.setFieldValue("employeeId",(null==a?void 0:a.recordId)||null)},errorCheck:"employeeId"})}),(0,n.jsx)(r.ZP,{item:!0,xs:12,children:(0,n.jsx)(_.Z,{endpointId:V.values.employeeId&&x.U.LeaveRequest.qry,parameters:"_filter=&_multiDayLeave=2&_params=1|".concat(V.values.employeeId,"&_sortBy=recordId&_startAt=0&_size=100"),filter:e=>4==e.status,displayField:["reference",{name:"startDate",type:"date"},{name:"endDate",type:"date"}],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"startDate",value:"Start Date",type:"date"},{key:"endDate",value:"End date",type:"date"}],name:"leaveId",label:O.leave,valueField:"recordId",required:!0,values:V.values,onChange:(e,a)=>{V.setFieldValue("leaveId",(null==a?void 0:a.recordId)||null)},readOnly:J,maxAccess:P,error:(null==V?void 0:null===(t=V.touched)||void 0===t?void 0:t.leaveId)&&!!(null==V?void 0:null===(C=V.errors)||void 0===C?void 0:C.leaveId)})}),(0,n.jsx)(r.ZP,{item:!0,xs:12,children:(0,n.jsx)(_.Z,{datasetId:b.v.LEAVE_RETURN_TYPE,name:"returnType",label:O.returnType,valueField:"key",displayField:"value",values:V.values,required:!0,readOnly:J,maxAccess:P,onChange:async(e,a)=>{let t=await X(null==a?void 0:a.key,V.values.leaveId);V.setValues({...V.values,maxDate:(null==t?void 0:t.maxDate)||null,minDate:(null==t?void 0:t.minDate)||null,date:(null==t?void 0:t.date)||null,returnType:(null==a?void 0:a.key)||null})},error:V.touched.returnType&&!!V.errors.returnType})}),(0,n.jsx)(r.ZP,{item:!0,xs:12,children:(0,n.jsx)(g.Z,{name:"date",label:O.date,value:null===(S=V.values)||void 0===S?void 0:S.date,required:!0,readOnly:J||"1"==V.values.returnType||"3"==V.values.returnType,onChange:(e,a)=>{V.setFieldValue("date",a||null)},min:V.values.minDate,max:V.values.maxDate,onClear:()=>V.setFieldValue("date",null),error:V.touched.date&&!!V.errors.date,maxAccess:P})}),(0,n.jsx)(r.ZP,{item:!0,xs:12,children:(0,n.jsx)(D.Z,{name:"justification",label:O.justification,value:V.values.justification,rows:3,required:!0,readOnly:J,maxAccess:P,onChange:V.handleChange,onClear:()=>V.setFieldValue("justification",""),error:V.touched.justification&&!!V.errors.justification})})]})})})})}C.width=800,C.height=500}},function(e){e.O(0,[92515,2494,36908,49774,92888,40179],function(){return e(e.s=76860)}),_N_E=e.O()}]);