(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[88617],{12215:function(e,l,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/draft-serials-transfer",function(){return r(6240)}])},6240:function(e,l,r){"use strict";r.r(l),r.d(l,{default:function(){return A}});var t=r(52322),a=r(2784),n=r(71987),i=r(65950),d=r(69387),o=r(62202),s=r(61802),u=r(26612),c=r(31389),v=r(33625),f=r(62362),m=r(19473),h=r(65215),p=r(89330),I=r(39812),x=r(60218),g=r(48601),y=r(82737),N=r(5088),b=r(21581),S=r(8661);r(38449);var w=r(7121),k=r(76399),j=r(91406),Z=r(80983),D=r(39704),F=r(98345),T=r(81330),C=r(51235),O=r(96026);function _(e){var l,r,_,P,A,V,R,$,E,q,W,L,J,G,z,M,B,X,H,Q;let{labels:U,access:Y,recordId:K}=e,{getRequest:ee,postRequest:el}=(0,a.useContext)(i.$),{stack:er}=(0,s.zY)(),{stack:et}=(0,O.V)(),{platformLabels:ea,defaultsData:en,userDefaultsData:ei,systemChecks:ed}=(0,a.useContext)(m.l),[eo,es]=(0,a.useState)(!1),{documentType:eu,maxAccess:ec,changeDT:ev}=(0,F.H)({functionId:w.J.DraftTransfer,access:Y,enabled:!K}),ef=(0,n.E)({endpointId:h.$.DraftTransfer.page});(0,a.useEffect)(()=>{(null==eu?void 0:eu.dtId)&&ep.setFieldValue("dtId",eu.dtId)},[null==eu?void 0:eu.dtId]);let em=parseInt(null==ei?void 0:null===(r=ei.list)||void 0===r?void 0:null===(l=r.find(e=>"siteId"===e.key))||void 0===l?void 0:l.value),eh=parseInt(null==en?void 0:null===(P=en.list)||void 0===P?void 0:null===(_=P.find(e=>"siteId"===e.key))||void 0===_?void 0:_.value),{formik:ep}=(0,Z.c)({maxAccess:ec,documentType:{key:"dtId",value:null==eu?void 0:eu.dtId},initialValues:{recordId:K,dtId:null,reference:"",date:new Date,fromSiteId:em||eh||null,toSiteId:null,notes:"",status:1,totalWeight:0,autoSrlNo:!0,serials:[{id:1,draftTransferId:K||0,srlNo:"",metalId:null,designId:null,itemId:null,sku:"",itemName:"",seqNo:1,weight:0,metalRef:"",designRef:""}],metalGridData:[],itemGridData:[]},validateOnChange:!0,validationSchema:g.Ry({date:g.Z_().required(),fromSiteId:g.Z_().required(),toSiteId:g.Z_().required(),serials:g.IX().of(g.Ry().shape({srlNo:g.Z_().test({name:"srlNo-first-row-check",test(e,l){let{parent:r}=l;return(null==r?void 0:r.id)==1||(!((null==r?void 0:r.id)>1)||!!e)&&e}})}))}),onSubmit:async e=>{var l;let{serials:r,date:t,...a}=e,n={...a,pcs:r.length,date:(0,I.ku)(t)};if(n.fromSiteId===n.toSiteId){o.ZP.error(U.SameSiteError);return}let i=null==ep?void 0:null===(l=ep.values)||void 0===l?void 0:l.serials.filter(e=>e.srlNo).map((e,l)=>{let{recordId:r,...t}=e;return{...t,seqNo:l+1,draftTransferId:r||0}});el({extension:h.$.DraftTransfer.set2,record:JSON.stringify({header:n,items:i})}).then(async e=>{o.ZP.success(eN?ea.Edited:ea.Added),await eI(e.recordId),ef()})}});async function eI(e){let l=await ex(e);await eg(l)}async function ex(e){var l,r;if(!e)return null;let t=await ee({extension:h.$.DraftTransfer.get2,parameters:"_recordId=".concat(e)});return(null==t?void 0:null===(r=t.record)||void 0===r?void 0:null===(l=r.header)||void 0===l?void 0:l.date)&&(t.record.header.date=(0,I.a1)(t.record.header.date)),(null==t?void 0:t.record)||null}async function eg(e){if(!e)return;let{header:l,items:r}=e,t=(r||[]).map((e,l)=>({...e,id:l+1}));ep.setValues({...ep.values,...l,serials:t.length?t:ep.initialValues.serials})}let ey=(null==ed?void 0:null===(A=ed.find(e=>e.checkId===C.F.POS_JUMP_TO_NEXT_LINE))||void 0===A?void 0:A.value)||!1,eN=!!ep.values.recordId,eb=3===ep.values.status,eS=async e=>{var l;if(!(null==e?void 0:e.draftTransferId))return!0;let r={draftId:null==ep?void 0:null===(l=ep.values)||void 0===l?void 0:l.recordId,lineItem:e};return await el({extension:h.$.DraftTransferSerial.del,record:JSON.stringify(r)}),!0};async function ew(e,l){if(null==l?void 0:l.srlNo){l.draftTransferId=null==e?void 0:e.recordId;let r=await el({extension:h.$.DraftTransferSerial.append,record:JSON.stringify({header:e,lineItem:l}),noHandleError:!0});return(null==r?void 0:r.error)?(et({message:null==r?void 0:r.error}),!1):(o.ZP.success(ea.Saved),!0)}}async function ek(e){let l=eT([e]),r={header:{...null==ep?void 0:ep.values,pcs:1,...l,date:(0,I.ku)(ep.values.date)},items:[e]};delete r.header.serials;let t=await el({extension:h.$.DraftTransfer.set2,record:JSON.stringify(r)});return!!t.recordId&&(o.ZP.success(ea.Saved),await eI(t.recordId),!0)}let ej=[{component:"textfield",label:U.srlNo,name:"srlNo",flex:2,updateOn:"blur",jumpToNextLine:ey,disableDuplicate:!0,propsReducer(e){let{row:l,props:r}=e;return{...r,readOnly:null==l?void 0:l.srlNo}},async onChange(e){let{row:{update:l,newRow:r,oldRow:t,addRow:a}}=e;if((null==r?void 0:r.srlNo)&&(null==r?void 0:r.srlNo)&&r.srlNo!==(null==t?void 0:t.srlNo)){var n,i,d,o,s,u,c,v,f,m,p,I,x;let e=await ee({extension:h.$.Serial.get2,parameters:"_srlNo=".concat(null==r?void 0:r.srlNo,"&_siteId=").concat(null==ep?void 0:null===(n=ep.values)||void 0===n?void 0:n.fromSiteId)}),t={fieldName:"srlNo",changes:{id:r.id,seqNo:r.id,draftTransferId:null==ep?void 0:null===(i=ep.values)||void 0===i?void 0:i.recordId,srlNo:(null==e?void 0:null===(d=e.record)||void 0===d?void 0:d.srlNo)||"",sku:(null==e?void 0:null===(o=e.record)||void 0===o?void 0:o.sku)||"",itemName:(null==e?void 0:null===(s=e.record)||void 0===s?void 0:s.itemName)||"",weight:(null==e?void 0:null===(u=e.record)||void 0===u?void 0:u.weight)||0,itemId:(null==e?void 0:null===(c=e.record)||void 0===c?void 0:c.itemId)||null,metalId:(null==e?void 0:null===(v=e.record)||void 0===v?void 0:v.metalId)||null,metalRef:(null==e?void 0:null===(f=e.record)||void 0===f?void 0:f.metalRef)||"",designId:(null==e?void 0:null===(m=e.record)||void 0===m?void 0:m.designId)||null,designRef:(null==e?void 0:null===(p=e.record)||void 0===p?void 0:p.designRef)||""}};eo||es(!0),((null==ep?void 0:null===(I=ep.values)||void 0===I?void 0:I.recordId)?await ew(null==ep?void 0:ep.values,t.changes):await ek(t.changes))?await a(t):l({...null==ep?void 0:null===(x=ep.initialValues)||void 0===x?void 0:x.serials,id:null==r?void 0:r.id,srlNo:""})}}},{component:"numberfield",label:U.weight,name:"weight",props:{readOnly:!0}},{component:"textfield",label:U.designRef,name:"designRef",props:{readOnly:!0}},{component:"textfield",label:U.sku,name:"sku",props:{readOnly:!0}},{component:"textfield",label:U.itemName,name:"itemName",flex:2,props:{readOnly:!0}},{component:"textfield",label:U.metal,name:"metalRef",props:{readOnly:!0}}];async function eZ(e){var l;let{serials:r,date:t,...a}=e,n={...a,pcs:r.length,date:(0,I.ku)(t)};if(n.fromSiteId===n.toSiteId){o.ZP.error(U.SameSiteError);return}let i=null==ep?void 0:null===(l=ep.values)||void 0===l?void 0:l.serials.filter(e=>e.srlNo).map((e,l)=>{let{recordId:r,...t}=e;return{...t,seqNo:l+1,draftTransferId:r||0}});el({extension:h.$.DraftTransfer.clone,record:JSON.stringify({header:n,items:i})}).then(async e=>{o.ZP.success(ea.Saved),await eI(e.recordId),ef()})}let eD=[{key:"Locked",condition:eb,disabled:!eN||eb},{key:"Unlocked",condition:!eb,onClick:async function(){let{serials:e,...l}=ep.values;await el({extension:h.$.DraftTransfer.post,record:JSON.stringify({...l,date:(0,I.ku)(ep.values.date)})}).then(()=>{var e;o.ZP.success(ea.Posted),ef(),eI(null==ep?void 0:null===(e=ep.values)||void 0===e?void 0:e.recordId)})},disabled:!eN||eb},{key:"WorkFlow",condition:!0,onClick:async function(){er({Component:D.Z,props:{functionId:w.J.DraftTransfer,recordId:ep.values.recordId}})},disabled:!eN},{key:"Import",condition:!0,onClick:async function(){var e;er({Component:T.Z,props:{endPoint:h.$.BatchDraftTransferSerial.batch,header:{draftId:null==ep?void 0:null===(e=ep.values)||void 0===e?void 0:e.recordId},onCloseimport:async()=>{await eI(ep.values.recordId)},maxAccess:ec}})},disabled:!eN||eb},{key:"Copy",condition:!0,onClick:()=>eZ(null==ep?void 0:ep.values),disabled:!eb}];async function eF(e){var l,r,t,a,n;let i=await ee({extension:h.$.DocumentTypeDefaults.get,parameters:"_dtId=".concat(e)});ep.setFieldValue("carrierId",(null==i?void 0:null===(l=i.record)||void 0===l?void 0:l.carrierId)||null),ep.setFieldValue("fromSiteId",(null==i?void 0:null===(r=i.record)||void 0===r?void 0:r.siteId)||(null==ep?void 0:null===(t=ep.values)||void 0===t?void 0:t.fromSiteId)||null),ep.setFieldValue("toSiteId",(null==i?void 0:null===(a=i.record)||void 0===a?void 0:a.toSiteId)||(null==ep?void 0:null===(n=ep.values)||void 0===n?void 0:n.toSiteId)||null)}function eT(e){return e.reduce((e,l)=>{let r=parseFloat(l.weight)||0;return e.totalWeight+=r,e},{totalWeight:0})}async function eC(){if(Object.keys(await ep.validateForm()).length){let e=Object.keys(await ep.validateForm()).reduce((e,l)=>(ep.touched[l]||(e[l]=!0),e),{});Object.keys(e).length&&ep.setTouched(e,!0)}}return(0,a.useEffect)(()=>{var e,l;if(null==ep?void 0:null===(l=ep.values)||void 0===l?void 0:null===(e=l.serials)||void 0===e?void 0:e.length){let e=null==ep?void 0:null===(r=ep.values)||void 0===r?void 0:r.serials,l=e.reduce((e,l)=>{let{metalId:r,weight:t,metalRef:a}=l;return r&&(e[r]||(e[r]={metal:a,pcs:0,totalWeight:0}),e[r].pcs+=1,e[r].totalWeight+=parseFloat(t||0)),e},{});Object.keys(l).forEach(e=>{l[e].totalWeight=parseFloat(l[e].totalWeight.toFixed(2))}),ep.setFieldValue("metalGridData",Object.values(l));var r,t=0;let a=e.reduce((e,l)=>{let{sku:r,itemId:a,itemName:n,weight:i}=l;return a&&(e[a]||(t++,e[a]={sku:r,pcs:0,weight:0,itemName:n,seqNo:t}),e[a].pcs+=1,e[a].weight=parseFloat((e[a].weight+parseFloat(i||0)).toFixed(2))),e},{});ep.setFieldValue("itemGridData",Object.values(a).sort((e,l)=>e.seqNo-l.seqNo))}},[null==ep?void 0:null===(V=ep.values)||void 0===V?void 0:V.serials]),(0,a.useEffect)(()=>{var e;if(!(null===(e=ep.values.serials)||void 0===e?void 0:e.length))return;let l=eT(ep.values.serials);ep.setFieldValue("totalWeight",l.totalWeight)},[ep.values.serials]),(0,a.useEffect)(()=>{!async function(){var e,l;(null==ep?void 0:null===(e=ep.values)||void 0===e?void 0:e.recordId)?await eI(null==ep?void 0:null===(l=ep.values)||void 0===l?void 0:l.recordId):ep.setFieldValue("fromSiteId",em||eh||null)}()},[]),(0,a.useEffect)(()=>{var e,l;(null==ep?void 0:null===(e=ep.values)||void 0===e?void 0:e.dtId)&&eF(null==ep?void 0:null===(l=ep.values)||void 0===l?void 0:l.dtId)},[null==ep?void 0:null===(R=ep.values)||void 0===R?void 0:R.dtId]),(0,t.jsx)(y.Z,{resourceId:u.i.DraftTransfer,functionId:w.J.DraftTransfer,form:ep,maxAccess:ec,previewReport:eN,isPosted:eb,actions:eD,editMode:eN,disabledSubmit:eb,disabledSavedClear:eb,children:(0,t.jsxs)(c.R,{children:[(0,t.jsx)(v.g,{children:(0,t.jsxs)(x.ZP,{container:!0,spacing:2,children:[(0,t.jsx)(x.ZP,{item:!0,xs:8,children:(0,t.jsxs)(x.ZP,{container:!0,spacing:2,children:[(0,t.jsx)(x.ZP,{item:!0,xs:6,children:(0,t.jsx)(S.Z,{endpointId:h.$.DraftTransfer.pack,reducer:e=>{var l;return null==e?void 0:null===(l=e.record)||void 0===l?void 0:l.documentTypes},name:"dtId",label:U.documentType,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],readOnly:eN,valueField:"recordId",displayField:["reference","name"],values:ep.values,maxAccess:ec,onChange:(e,l)=>{ep.setFieldValue("dtId",null==l?void 0:l.recordId),ev(l)},error:ep.touched.dtId&&!!ep.errors.dtId})}),(0,t.jsx)(x.ZP,{item:!0,xs:6,children:(0,t.jsx)(S.Z,{endpointId:h.$.DraftTransfer.pack,reducer:e=>{var l;return null==e?void 0:null===(l=e.record)||void 0===l?void 0:l.sites},name:"fromSiteId",readOnly:eb||(null==ep?void 0:null===(E=ep.values)||void 0===E?void 0:null===($=E.serials)||void 0===$?void 0:$.some(e=>e.srlNo)),label:U.fromSite,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:ep.values,required:!0,valueField:"recordId",displayField:["reference","name"],maxAccess:ec,onChange:(e,l)=>{(null==l?void 0:l.isInactive)?(ep.setFieldValue("fromSiteId",null),et({message:U.inactiveSite})):ep.setFieldValue("fromSiteId",null==l?void 0:l.recordId)},error:ep.touched.fromSiteId&&!!ep.errors.fromSiteId})}),(0,t.jsx)(x.ZP,{item:!0,xs:6,children:(0,t.jsx)(N.Z,{name:"reference",label:U.reference,value:null==ep?void 0:null===(q=ep.values)||void 0===q?void 0:q.reference,maxAccess:!eN&&ec,readOnly:eN,onChange:ep.handleChange,onClear:()=>ep.setFieldValue("reference",""),error:ep.touched.reference&&!!ep.errors.reference})}),(0,t.jsx)(x.ZP,{item:!0,xs:6,children:(0,t.jsx)(S.Z,{endpointId:h.$.DraftTransfer.pack,reducer:e=>{var l;return null==e?void 0:null===(l=e.record)||void 0===l?void 0:l.sites},name:"toSiteId",readOnly:eb,label:U.toSite,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:ep.values,required:!0,valueField:"recordId",displayField:["reference","name"],maxAccess:ec,onChange:(e,l)=>{(null==l?void 0:l.isInactive)?(ep.setFieldValue("toSiteId",null),et({message:U.inactiveSite})):ep.setFieldValue("toSiteId",null==l?void 0:l.recordId)},error:ep.touched.toSiteId&&!!ep.errors.toSiteId})}),(0,t.jsx)(x.ZP,{item:!0,xs:6,children:(0,t.jsx)(p.Z,{name:"date",required:!0,label:U.postingDate,value:null==ep?void 0:null===(W=ep.values)||void 0===W?void 0:W.date,onChange:ep.setFieldValue,editMode:eN,readOnly:eb,maxAccess:ec,onClear:()=>ep.setFieldValue("date",""),error:ep.touched.date&&!!ep.errors.date})}),(0,t.jsx)(x.ZP,{item:!0,xs:6,children:(0,t.jsx)(S.Z,{endpointId:h.$.DraftTransfer.pack,reducer:e=>{var l;return null==e?void 0:null===(l=e.record)||void 0===l?void 0:l.notificationGroups},name:"notificationGroupId",label:U.notificationGroup,valueField:"recordId",displayField:"name",columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],readOnly:eb,values:ep.values,maxAccess:ec,onChange:(e,l)=>{ep.setFieldValue("notificationGroupId",null==l?void 0:l.recordId)},error:ep.touched.notificationGroupId&&!!ep.errors.notificationGroupId})}),(0,t.jsx)(x.ZP,{item:!0,xs:6,children:(0,t.jsx)(S.Z,{endpointId:h.$.DraftTransfer.pack,reducer:e=>{var l;return null==e?void 0:null===(l=e.record)||void 0===l?void 0:l.carriers},name:"carrierId",label:U.carrier,values:ep.values,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],required:!0,readOnly:eN,maxAccess:ec,onChange:(e,l)=>{ep.setFieldValue("carrierId",null==l?void 0:l.recordId)},error:ep.touched.carrierId&&!!ep.errors.carrierId})})]})}),(0,t.jsx)(x.ZP,{item:!0,xs:4,children:(0,t.jsx)(b.Z,{name:"notes",label:U.description,value:ep.values.notes,rows:4,editMode:eN,readOnly:eb,maxAccess:ec,onChange:e=>ep.setFieldValue("notes",e.target.value),onClear:()=>ep.setFieldValue("notes",""),error:ep.touched.notes&&!!ep.errors.notes})})]})}),(0,t.jsx)(f.Q,{children:(0,t.jsx)(k._,{onChange:(e,l)=>{ep.setFieldValue("serials",e),"delete"===l&&es(!0)},value:ep.values.serials||[],error:ep.errors.serials,columns:ej,name:"serials",maxAccess:ec,disabled:eb||Object.entries((null==ep?void 0:ep.errors)||{}).filter(e=>{let[l]=e;return"serials"!==l}).length>0,allowDelete:!eb,allowAddNewLine:(null===(J=ep.values)||void 0===J?void 0:null===(L=J.serials)||void 0===L?void 0:L.length)===0||!!(null===(X=ep.values)||void 0===X?void 0:null===(B=X.serials)||void 0===B?void 0:null===(G=B[(null===(M=ep.values)||void 0===M?void 0:null===(z=M.serials)||void 0===z?void 0:z.length)-1])||void 0===G?void 0:G.srlNo),autoDelete:eS,onValidationRequired:eC})}),(0,t.jsxs)(x.ZP,{container:!0,spacing:2,children:[(0,t.jsxs)(x.ZP,{item:!0,xs:8,children:[(0,t.jsx)(x.ZP,{item:!0,xs:12,height:130,sx:{display:"flex",flex:1},children:(0,t.jsx)(d.Z,{name:"metal",gridData:{count:1,list:null==ep?void 0:null===(H=ep.values)||void 0===H?void 0:H.metalGridData},maxAccess:Y,columns:[{field:"metal",headerName:U.metal,flex:1},{field:"pcs",headerName:U.pcs,type:"number",flex:1},{field:"totalWeight",headerName:U.totalWeight,type:"number",flex:1}],rowId:["metal"],pagination:!1})}),(0,t.jsx)(x.ZP,{item:!0,xs:12,height:130,sx:{display:"flex",flex:1},children:(0,t.jsx)(d.Z,{name:"item",columns:[{field:"seqNo",headerName:U.seqNo,type:"number",flex:1},{field:"sku",headerName:U.sku,flex:1},{field:"itemName",headerName:U.itemName,flex:2},{field:"pcs",headerName:U.pcs,type:"number",flex:1},{field:"weight",headerName:U.weight,type:"number",flex:1}],gridData:{count:1,list:null==ep?void 0:null===(Q=ep.values)||void 0===Q?void 0:Q.itemGridData},rowId:["sku"],maxAccess:Y,pagination:!1})})]}),(0,t.jsx)(x.ZP,{item:!0,xs:4,children:(0,t.jsxs)(x.ZP,{container:!0,spacing:2,children:[(0,t.jsx)(x.ZP,{item:!0,xs:12}),(0,t.jsx)(x.ZP,{item:!0,xs:12}),(0,t.jsx)(x.ZP,{item:!0,xs:12}),(0,t.jsx)(x.ZP,{item:!0,xs:12,children:(0,t.jsx)(j.Z,{name:"totalWeight",maxAccess:ec,label:U.totalWeight,value:ep.values.totalWeight,readOnly:!0})})]})})]})]})})}r(95982),r(51264);var P=r(36908),A=()=>{let{postRequest:e,getRequest:l}=(0,a.useContext)(i.$),{platformLabels:r}=(0,a.useContext)(m.l),{stack:p}=(0,s.zY)(),{query:{data:I},filterBy:x,refetch:g,labels:y,access:N,paginationParameters:b,invalidate:S}=(0,n.J)({queryFn:j,endpointId:h.$.DraftTransfer.page,datasetId:u.i.DraftTransfer,filter:{filterFn:Z}}),k=[{field:"reference",headerName:y.reference,flex:1},{field:"date",headerName:y.date,flex:1,type:"date"},{field:"dtId",headerName:y.documentType,flex:1},{field:"fromSiteRef",headerName:y.fromSiteRef,flex:1},{field:"fromSiteName",headerName:y.fromSiteName,flex:1},{field:"toSiteRef",headerName:y.toSiteRef,flex:1},{field:"toSiteName",headerName:y.toSiteName,flex:1},{field:"pcs",headerName:y.pcs,flex:1,type:"number"},{field:"totalWeight",headerName:y.totalWeight,flex:1,type:"number"},{field:"description",headerName:y.description,flex:2},{field:"statusName",headerName:y.status,flex:1}];async function j(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{_startAt:r=0,_pageSize:t=50,params:a=[]}=e;return{...await l({extension:h.$.DraftTransfer.page,parameters:"_startAt=".concat(r,"&_pageSize=").concat(t,"&_params=").concat(a,"&filter=")}),_startAt:r}}async function Z(e){let{filters:r,pagination:t}=e;return r.qry?await l({extension:h.$.DraftTransfer.snapshot,parameters:"_filter=".concat(r.qry,"&_status=0")}):j({_startAt:t._startAt||0,params:null==r?void 0:r.params})}let{proxyAction:D}=(0,F.G)({functionId:w.J.DraftTransfer,action:C}),T=async()=>{await D()};async function C(e){p({Component:_,props:{labels:y,access:N,recordId:e},width:1300,height:750,title:y.draftSerTransfer})}let O=async l=>{await e({extension:h.$.DraftTransfer.del,record:JSON.stringify(l)}),S(),o.ZP.success(r.Deleted)};return(0,t.jsxs)(c.R,{children:[(0,t.jsx)(v.g,{children:(0,t.jsx)(P.Z,{onAdd:T,maxAccess:N,filterBy:x,reportName:"IVDTF"})}),(0,t.jsx)(f.Q,{children:(0,t.jsx)(d.Z,{columns:k,gridData:I,rowId:["recordId"],onEdit:e=>{C(e.recordId)},refetch:g,onDelete:O,deleteConfirmationType:"strict",isLoading:!1,pageSize:50,maxAccess:N,paginationParameters:b,paginationType:"api"})})]})}},1685:function(e,l,r){"use strict";r.d(l,{m:function(){return t}});let t=e=>{let l=window.sessionStorage.getItem(e);return l?JSON.parse(l):null}},98345:function(e,l,r){"use strict";r.d(l,{H:function(){return h},G:function(){return m}});var t=r(45300),a=r(2784),n=r(96026),i=r(38449);r(26612);var d=r(65947),o=r(1685);let s=async(e,l,r)=>{try{let t=await e({extension:l,parameters:r});return l.includes("qry")?t:t.record}catch(e){return null}},u=(e,l,r,t)=>{let a=(e=JSON.parse(JSON.stringify(e))).record.controls,n=a.find(e=>"reference"===e.controlId);return n?n.accessLevel=(null==l?void 0:l.mandatory)?d.$7:d.rr:(null==l?void 0:l.mandatory)?a.push({sgId:0,resourceId:"",controlId:"".concat(t?t+".":"","reference"),accessLevel:(null==l?void 0:l.mandatory)?d.$7:d.rr}):(null==l?void 0:l.readOnly)?a.push({sgId:0,resourceId:"",controlId:"".concat(t?t+".":"","reference"),accessLevel:(null==l?void 0:l.readOnly)?d.rr:d.$7}):a=e.record.controls.filter(e=>"reference"!=e.controlId),r&&a.push({sgId:0,resourceId:"",controlId:"".concat(t?t+".":"","dtId"),accessLevel:d.$7}),{...e,record:{...e.record,controls:a}}},c=async(e,l,r)=>{let t,a;switch(r){case"dtId":let n=(0,o.m)("userData"),d=null==n?void 0:n.userId;a="_userId=".concat(d,"&_functionId=").concat(l),t=i.r.UserFunction.get;break;case"glbSysNumberRange":a="_recordId=".concat(l),t=i.r.SystemFunction.get;break;case"DocumentType":a="_dgId=".concat(l,"&_startAt=",0,"&_pageSize=",50),t=i.r.DocumentType.qry;break;case"DcTypNumberRange":a="_recordId=".concat(l),t=i.r.DocumentType.get;break;case"isExternal":a="_recordId=".concat(l),t=i.r.NumberRange.get;break;default:return null}return await s(e,t,a)},v=async function(e){let l,r,t,a,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,o=!(arguments.length>4)||void 0===arguments[4]||arguments[4],s=arguments.length>5?arguments[5]:void 0,v=void 0===d&&n&&await c(e,n,"dtId"),f=null==v?void 0:v.dtId,m="",h=!0;if(v&&void 0===d||"nraId"===d){if(f){let r=await c(e,f,"DcTypNumberRange");l=null==r?void 0:r.nraId,h=!((null==r?void 0:r.activeStatus)<0),l||(m="Assign the document type to a number range")}if((!f||!h)&&o&&n){var p;let l=await c(e,n,"DocumentType");a=(null==l?void 0:null===(p=l.list)||void 0===p?void 0:p.filter(e=>(null==e?void 0:e.activeStatus)===1).length)>0}}if(("nraId"===d||void 0===d)&&n){if((!f||f)&&!l||l&&!h){let r=await c(e,n,"glbSysNumberRange");(l=null==r?void 0:r.nraId)&&a&&(a=!1),h=!0}m=l||a?"":"Assign the system Function to a number range"}d>0&&!l&&(l=d),l&&h?(r={readOnly:null==(t=await c(e,l,"isExternal"))||!t.external,mandatory:null!=t&&!!t.external},i&&(i=await u(i,r,a,s))):!l&&i&&(i=await u(i,r,a,s));let I=s?"".concat(s,".reference"):"reference";return{dtId:f,resetReference:null==r?void 0:r.readOnly,dcTypeRequired:a,reference:{fieldName:I,isEmpty:(null==t?void 0:t.external)!==void 0&&(null==t||!t.external)},errorMessage:m,maxAccess:i,selectNraId:d}};var f=r(65950);function m(e){let{functionId:l,action:r,hasDT:t}=e,{getRequest:i}=(0,a.useContext)(f.$),{stack:d}=(0,n.V)();return{proxyAction:async()=>{let e=await v(i,l,"",void 0,t);(null==e?void 0:e.errorMessage)?d({message:null==e?void 0:e.errorMessage}):await r()}}}function h(e){var l;let{functionId:r,access:i,hasDT:d,enabled:o=!0,objectName:s=""}=e,{getRequest:u}=(0,a.useContext)(f.$),{stack:c}=(0,n.V)(),[m,h]=(0,a.useState)(),p=async e=>{let l=await v(u,r,i,e,d,s);if(!l.errorMessage)return l;c({message:null==l?void 0:l.errorMessage})},I=(0,t.a)({retry:!1,staleTime:0,enabled:o,queryKey:[r,m,!!i,o],queryFn:m||"nraId"===m?()=>p(m):()=>p()});return{documentType:I.data,maxAccess:(null==I?void 0:null===(l=I.data)||void 0===l?void 0:l.maxAccess)||i,changeDT(e){h((null==e?void 0:e.nraId)||"nraId")}}}},81330:function(e,l,r){"use strict";r.d(l,{Z:function(){return N}});var t=r(52322),a=r(2784),n=r(60218),i=r(31389),d=r(5088),o=r(21581),s=r(78711),u=r(19473),c=r(23361),v=r(21326);let f=e=>{let{window:l,onConfirm:r,fullScreen:n,open:i,dialogText:d}=e,{platformLabels:o}=(0,a.useContext)(u.l);return(0,v.Z)({title:o.import,window:l}),(0,t.jsx)(c.Z,{open:(null==i?void 0:i.flag)||!1,DialogText:d,okButtonAction:()=>{"function"==typeof r&&r(),l.close()},fullScreen:n,cancelButtonAction:()=>l.close(),height:"140px"})};f.width=470,f.height=170;var m=r(61802),h=r(65950),p=r(62202),I=r(62362),x=r(69627),g=r(54074);let y=e=>{var l,r;let{endPoint:c,header:y,onCloseimport:N,maxAccess:b,window:S}=e,{stack:w}=(0,m.zY)(),{platformLabels:k}=(0,a.useContext)(u.l),j=(0,a.useRef)(null),[Z,D]=(0,a.useState)(null),[F,T]=(0,a.useState)([]),{postRequest:C}=(0,a.useContext)(h.$);(0,v.Z)({title:k.importSerials,window:S});let O=(0,s.TA)({initialValues:{serials:"",serialCount:0}}),_=e=>{let l=e.split("\n").filter(e=>""!==e.trim()).length;O.setFieldValue("serialCount",l)},P=async()=>{w({Component:f,props:{open:{flag:!0},fullScreen:!1,onConfirm:A,dialogText:k.importConfirmation}})},A=async()=>{var e;let l=null===(e=O.values.serials)||void 0===e?void 0:e.replace(/\n/g,",\r\n"),r={...y,serials:l||F};await C({extension:c,record:JSON.stringify(r)}),p.ZP.success(k.Imported),N(),S.close()},V=[{key:"Import",condition:!0,onClick:P,disabled:!(null==Z?void 0:Z.name)&&!(null==O?void 0:null===(l=O.values)||void 0===l?void 0:l.serials)}];return(0,t.jsx)(g.Z,{actions:V,onSave:()=>P(),disabledSubmit:!(null==Z?void 0:Z.name)&&!(null==O?void 0:null===(r=O.values)||void 0===r?void 0:r.serials),isSaved:!1,children:(0,t.jsxs)(i.R,{children:[(0,t.jsx)(I.Q,{children:(0,t.jsxs)(n.ZP,{container:!0,spacing:2,children:[(0,t.jsx)(n.ZP,{item:!0,xs:7,children:(0,t.jsx)(d.Z,{name:"name",label:k.SelectCSV,value:null==Z?void 0:Z.name,disabled:O.values.serials||!!(null==Z?void 0:Z.name),readOnly:!0,maxAccess:b})}),(0,t.jsx)(n.ZP,{item:!0,xs:3,children:(0,t.jsx)(x.Z,{onClick:()=>{j.current.click()},label:"".concat(k.Browse,"..."),color:"primary",disabled:!!(null==Z?void 0:Z.name)||O.values.serials})}),(0,t.jsx)(n.ZP,{item:!0,xs:2,children:(0,t.jsx)(x.Z,{image:"clear.png",onClick:()=>{D(null),T([]),j.current.value=null},label:k.Clear,color:"#f44336"})}),(0,t.jsxs)(n.ZP,{item:!0,xs:12,children:[O.values.serialCount>0&&(0,t.jsxs)("label",{style:{marginBottom:"8px",display:"block"},maxAccess:b,children:[k.serials," ( ",O.values.serialCount," )"]}),(0,t.jsx)(o.Z,{name:"serials",label:k.serials,value:O.values.serials,rows:3,readOnly:null==Z?void 0:Z.name,onChange:e=>{O.setFieldValue("serials",e.target.value),_(e.target.value)},onClear:()=>{O.setFieldValue("serials",""),O.setFieldValue("serialCount",0)},error:O.touched.serials&&!!O.errors.serials,maxAccess:b})]})]})}),(0,t.jsx)("input",{type:"file",accept:".csv",ref:j,style:{display:"none"},onChange:e=>{let l=e.target.files[0];if(D(l),l){let e=new FileReader;e.onload=e=>{T(e.target.result)},e.readAsText(l)}}})]})})};y.width=550,y.height=270;var N=y},39704:function(e,l,r){"use strict";var t=r(52322),a=r(2784),n=r(22341),i=r(65950),d=r(85325),o=r(21326),s=r(19473),u=r(35656),c=r(24868),v=r.n(c);let f=e=>{let{functionId:l,recordId:r,window:c}=e,{getRequest:f}=(0,a.useContext)(i.$),{languageId:m}=(0,a.useContext)(d.V),{platformLabels:h}=(0,a.useContext)(s.l),p=r+"-"+l;(0,o.Z)({title:h.WorkFlow,window:c});let{width:I}=(0,u.d)(),x=I<=1024,g=I>1024&&I<=1280,y=x?10:g?12:14,N=x?75:g?85:95,b=x?15:g?20:25,S=async()=>{var e="_functionId=".concat(l,"&_recordId=").concat(r);let t=await f({extension:n.P.WorkFlow.graph,parameters:e});return null==t?void 0:t.record},w=e=>{let l=[],r=[],t="",a="";return e.objects.forEach(e=>{l.push({functionName:e.functionName,reference:e.reference,date:e.date})}),e.workflow.forEach(l=>{e.objects.forEach(e=>{let r=e.functionName.split(" ").join("\r\n");l.parentId===e.recordId&&l.parentFunctionId===e.functionId&&(t=e.reference+"\r\n"+e.date+"\r\n"+r,l.parentId),l.childId===e.recordId&&l.childFunctionId===e.functionId&&(a=e.reference+"\r\n"+e.date+"\r\n"+r,l.childId)}),""===t||""===a||r.push({from:t,to:a,value:1,labelText:""}),t="",a=""}),r};return(0,a.useEffect)(()=>{!async function(){var e=await S();if(e){let l=(e,l)=>{let r=document.createElement("script");r.type="text/javascript",r.src=e,r.async=!0,r.onload=l,document.head.appendChild(r)};l("https://cdn.amcharts.com/lib/4/core.js",()=>{l("https://cdn.amcharts.com/lib/4/charts.js",()=>{l("https://cdn.amcharts.com/lib/4/themes/animated.js",()=>{am4core.ready(()=>{let l=am4core.create(p,am4charts.SankeyDiagram),r=w(e);l.data=r,l.dataFields.fromName="from",l.dataFields.toName="to",l.dataFields.value="value",l.paddingRight=2===m?0:40,l.paddingLeft=2===m?40:0,l.tooltip.label.fontSize=y;let t=l.nodes.template;t.draggable=!1,t.inert=!0,t.clickable=!1,t.width=N,t.height=b,t.nameLabel.label.fontSize=y,t.nameLabel.locationX=2===m?.85:0,t.nameLabel.height=void 0,t.nameLabel.label.fontWeight="bold";let a=l.links.template;a.middleLine.strokeOpacity=.3,a.middleLine.stroke=am4core.color("#555"),a.middleLine.strokeWidth=5,a.middleLine.hoverable=!1,a.fillOpacity=0,a.hoverable=!0,a.hoverOnFocus=!0,a.fill=am4core.color("#A8C686"),a.isHover=!0,l.appear(1e3,100)})})})})}}()},[]),(0,t.jsx)("div",{id:p,className:v().root})};f.width=950,l.Z=f},24868:function(e){e.exports={root:"WorkFlow_root__EINm1"}}},function(e){e.O(0,[92515,2494,36908,49774,92888,40179],function(){return e(e.s=12215)}),_N_E=e.O()}]);