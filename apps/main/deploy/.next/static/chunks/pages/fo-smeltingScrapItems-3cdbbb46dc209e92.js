(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[38199],{55375:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/fo-smeltingScrapItems",function(){return s(3656)}])},3656:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return M}});var a=s(52322),n=s(2784),l=s(31389),r=s(62362),o=s(69387),i=s(65950),d=s(61802),u=s(36773),p=s(71987),m=s(26612),c=s(62202),g=s(60218),y=s(19473),f=s(80983),S=s(5088),A=s(76399),h=s(65215),v=s(82737),C=s(48601),x=s(84100),I=s(67920),q=e=>{var t;let{labels:s,maxAccess:o,recordId:d,metalRef:q}=e,{getRequest:M,postRequest:T}=(0,n.useContext)(i.$),{platformLabels:D}=(0,n.useContext)(y.l),W=(0,p.E)({endpointId:u.B.MetalSettings.page}),{schema:R,requiredFields:X}=(0,I.m)({sku:e=>null==e?void 0:e.sku,itemName:e=>null==e?void 0:e.itemName,puritySource:e=>null==e?void 0:e.puritySource},!0,o,"items"),{formik:b}=(0,f.c)({maxAccess:o,initialValues:{recordId:d,metalRef:q,items:[]},validationSchema:C.Ry({items:C.IX().of(R)}),conditionSchema:["items"],onSubmit:async e=>{let t={metalId:d,items:e.items.filter(e=>Object.values(X).every(t=>t(e))).map((e,t)=>({...e,metalId:d,seqNo:t+1}))};await T({extension:u.B.SmeltingScrapItem.set2,record:JSON.stringify(t)}),c.ZP.success(D.Updated),W()}});(0,n.useEffect)(()=>{!async function(){if(d){var e;let t=await M({extension:u.B.SmeltingScrapItem.qry,parameters:"_metalId=".concat(d)});(null===(e=t.list)||void 0===e?void 0:e.length)&&b.setValues({recordId:d,metalRef:q,items:t.list.map((e,t)=>({id:t+1,...e}))})}}()},[]);let k=!!b.values.recordId,J=[{component:"resourcelookup",label:s.sku,name:"sku",props:{endpointId:h.$.Item.snapshot,valueField:"recordId",displayField:"sku",displayFieldWidth:1.5,mapping:[{from:"recordId",to:"itemId"},{from:"sku",to:"sku"},{from:"name",to:"itemName"}],columnsInDropDown:[{key:"sku",value:"SKU"},{key:"name",value:"Name"}]}},{component:"textfield",label:s.itemName,name:"itemName",props:{readOnly:!0}},{component:"resourcecombobox",label:s.puritySource,name:"puritySource",props:{datasetId:x.v.PURITY_SOURCE,valueField:"key",displayField:"value",mapping:[{from:"key",to:"puritySource"},{from:"value",to:"puritySourceName"}]}}];return(0,a.jsx)(v.Z,{resourceId:m.i.SmeltingScrapItems,form:b,maxAccess:o,isCleared:!1,editMode:k,children:(0,a.jsxs)(l.R,{children:[(0,a.jsx)(g.ZP,{item:!0,xs:12,children:(0,a.jsx)(S.Z,{name:"metalRef",label:s.metal,value:b.values.metalRef,readOnly:!0})}),(0,a.jsx)(r.Q,{children:(0,a.jsx)(A._,{name:"items",maxAccess:o,value:b.values.items,error:null===(t=b.errors)||void 0===t?void 0:t.items,columns:J,onChange:e=>b.setFieldValue("items",e)})})]})})},M=()=>{let{getRequest:e}=(0,n.useContext)(i.$),{stack:t}=(0,d.zY)();async function s(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{_startAt:s=0,_pageSize:a=50}=t;return{...await e({extension:u.B.MetalSettings.page,parameters:"_startAt=".concat(s,"&_pageSize=").concat(a)}),_startAt:s}}let{query:{data:c},refetch:g,labels:y,access:f,paginationParameters:S}=(0,p.J)({queryFn:s,endpointId:u.B.MetalSettings.page,datasetId:m.i.SmeltingScrapItems}),A=[{field:"metalRef",headerName:y.metal,flex:1},{field:"metalColorRef",headerName:y.metalColor,flex:1},{field:"rate",headerName:y.rate,flex:1,type:"number"},{field:"stdLossRate",headerName:y.stdLossRate,flex:1,type:"number"}];async function h(e){t({Component:q,props:{labels:y,recordId:null==e?void 0:e.metalId,metalRef:null==e?void 0:e.metalRef,maxAccess:f},width:800,height:500,title:y.SmeltingScrapItems})}return(0,a.jsx)(l.R,{children:(0,a.jsx)(r.Q,{children:(0,a.jsx)(o.Z,{name:"table",columns:A,gridData:c,rowId:["metalId"],onEdit:e=>{h(e)},refetch:g,pageSize:50,maxAccess:f,paginationParameters:S,paginationType:"api"})})})}},36773:function(e,t,s){"use strict";s.d(t,{B:function(){return n}});let a="FO.asmx/",n={WorkCenter:{page:a+"pageWCT",qry:a+"qryWCT",set:a+"setWCT",get:a+"getWCT",del:a+"delWCT"},Wax:{page:a+"pageWAX",snapshot:a+"snapshotWAX",set:a+"setWAX",set2:a+"set2WAX",get:a+"getWAX",del:a+"delWAX",post:a+"postWAX",unpost:a+"unpostWAX",close:a+"closeWAX",open:a+"openWAX",reopen:a+"reopenWAX"},WaxJob:{qry:a+"qryWAJ",qry2:a+"qry2WAJ"},Mould:{qry:a+"qryMOU",qry2:a+"qry2MOU",page:a+"pageMOU",set:a+"setMOU",get:a+"getMOU",del:a+"delMOU",snapshot:a+"snapshotMOU"},MetalSettings:{page:a+"pageMTS",set:a+"setMTS",get:a+"getMTS",del:a+"delMTS"},Scrap:{qry:a+"qryMSC",set2:a+"set2MSC"},JobWaxInquiry:{qry2:a+"qry2WAJ"},Casting:{page:a+"pageCAS",get:a+"getCAS",set:a+"setCAS",del:a+"delCAS",cancel:a+"cancelCAS",post:a+"postCAS",snapshot:a+"snapshotCAS"},CastingDisassembly:{qry:a+"qryCDA",set2:a+"set2CDA"},MetalScrap:{qry:a+"qryMSC"},CastingJob:{qry:a+"qryCAJ",set2:a+"set2CAJ"},FoundaryTransaction:{get:a+"getTRX",get2:a+"get2TRX",del:a+"delTRX",set2:a+"set2TRX",page:a+"pageTRX",snapshot:a+"snapshotTRX",post:a+"postTRX",unpost:a+"unpostTRX"},AlloyMetals:{page:a+"pageALM",set:a+"setALM",get:a+"getALM",del:a+"delALM",qry:a+"qryALM"},SmeltingScrapItem:{qry:a+"qrySMSI",set2:a+"set2SMSI"},DocumentTypeDefault:{page:a+"pageDTD",set:a+"setDTD",get:a+"getDTD",del:a+"delDTD"},PurityAdjustment:{combos:a+"getPackPADJ",get2:a+"get2PADJ",del:a+"delPADJ",set2:a+"set2PADJ",page:a+"pagePADJ",snapshot:a+"snapshotPADJ",post:a+"postPADJ",unpost:a+"unpostPADJ"}}},67920:function(e,t,s){"use strict";s.d(t,{m:function(){return n}});var a=s(48601);function n(e,t,s){var n;let l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"items",r={...e};return null==s||null===(n=s.record)||void 0===n||n.controls.forEach(e=>{let{controlId:t,accessLevel:s}=e,[a,n]=null==t?void 0:t.split(".");a!==l||2!==s||n in r||(r[n]=e=>(null==e?void 0:e[n])!=null),(1===s||4===s)&&n in r&&delete r[n]}),{schema:a.Ry().shape({...Object.keys(r).reduce((e,s)=>(e[s]=a.nK().nullable().test(function(e){var a;let n=this.parent,[,l]=this.path.match(/^(\w+)\[(\d+)\]/)||[],o=(null===(a=this.options.context)||void 0===a?void 0:a[l])||[];if(t||!t&&o.length>1){if(null!==n[s]&&void 0!==n[s]&&0!==n[s]&&""!==r[s]&&!r[s](n))return!1;if(!Object.entries(r).some(e=>{let[,t]=e;return!!t(n)}))return!0}return!!r[s](n)&&void 0!==e}),e),{})}),requiredFields:r}}}},function(e){e.O(0,[49774,92888,40179],function(){return e(e.s=55375)}),_N_E=e.O()}]);