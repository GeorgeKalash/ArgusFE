(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[15818],{79257:function(e,l,i){(window.__NEXT_P=window.__NEXT_P||[]).push(["/pu-draft-serials-returns",function(){return i(84868)}])},84868:function(e,l,i){"use strict";i.r(l),i.d(l,{default:function(){return G}});var a=i(52322),d=i(2784),n=i(71987),o=i(65950),r=i(69387),t=i(62202),u=i(61802),s=i(26612),c=i(31389),v=i(33625),m=i(62362),h=i(19473),f=i(2454),p=i(89330),x=i(39812),I=i(60218),y=i(48601),g=i(82737),F=i(5088),b=i(21581),w=i(8661),P=i(38449),N=i(65215),j=i(7121),S=i(27423),V=i(76399),C=i(91406),k=i(25870),A=i(80983),D=i(39704),R=i(18996),Z=i(98345),_=i(19568),q=i(81330),O=i(86626),T=i(51235),L=i(96026),E=i(69627),U=i(16463);function W(e){var l,W,J,G,B,H,z,X,$,Q,M,Y,K,ee,el,ei,ea,ed,en,eo,er,et,eu,es,ec,ev,em,eh,ef,ep,ex,eI,ey,eg,eF,eb,ew,eP,eN,ej,eS,eV,eC,ek,eA,eD,eR,eZ,e_,eq,eO,eT,eL,eE,eU,eW,eJ,eG,eB,eH,ez,eX,e$;let{labels:eQ,access:eM,recordId:eY}=e,{getRequest:eK,postRequest:e0}=(0,d.useContext)(o.$),{stack:e2}=(0,u.zY)(),{stack:e1}=(0,L.V)(),{platformLabels:e6,defaultsData:e4,userDefaultsData:e3,systemChecks:e8}=(0,d.useContext)(h.l),[e5,e9]=(0,d.useState)(!1),{documentType:e7,maxAccess:le,changeDT:ll}=(0,Z.H)({functionId:j.J.PUDraftSerialReturn,access:eM,enabled:!eY,objectName:"header"}),li=(0,n.E)({endpointId:f.y.PUDraftReturn.page});(0,d.useEffect)(()=>{(null==e7?void 0:e7.dtId)&&lV(e7.dtId)},[null==e7?void 0:e7.dtId]);let la=parseInt(null==e4?void 0:null===(W=e4.list)||void 0===W?void 0:null===(l=W.find(e=>"currencyId"===e.key))||void 0===l?void 0:l.value),ld=parseInt(null==e3?void 0:null===(G=e3.list)||void 0===G?void 0:null===(J=G.find(e=>"siteId"===e.key))||void 0===J?void 0:J.value),{formik:ln}=(0,A.c)({maxAccess:le,documentType:{key:"dtId",value:null==e7?void 0:e7.dtId},initialValues:{recordId:eY,header:{dtId:null,reference:"",date:new Date,plantId:null,vendorId:null,currencyId:la||null,siteId:ld||null,description:"",status:1,wip:1,isVattable:!1,taxId:null,weight:0,disSkuLookup:!1,invoiceId:null,invoiceRef:"",subTotal:0,vatAmount:0,amount:0,search:""},serials:[{id:1,returnId:eY||0,srlNo:"",metalId:"",designId:"",itemId:"",sku:"",itemName:"",seqNo:1,extendedPrice:0,baseLaborPrice:0,weight:0,metalRef:"",designRef:"",vatAmount:0,vatPct:0,unitPrice:0,taxId:null,taxDetails:null,volume:0,invoiceReference:"",invoiceTrxId:null,invoiceSeqNo:1,invoiceComponentSeqNo:0}],metalGridData:[],itemGridData:[],taxDetailsStore:[]},validateOnChange:!0,validationSchema:y.Ry({header:y.Ry({dtId:y.Rx().required(),date:y.hT().required(),currencyId:y.Rx().required(),vendorId:y.Rx().required(),plantId:y.Rx().required(),siteId:y.Rx().required()}),serials:y.IX().of(y.Ry().shape({srlNo:y.Z_().test({name:"srlNo-first-row-check",test(e,l){let{parent:i}=l;return(null==i?void 0:i.id)==1||(!((null==i?void 0:i.id)>1)||!!e)&&e}})}))}),onSubmit:async e=>{var l;let{invoiceId:i,invoiceRef:a,disSkuLookup:d,search:n,date:o,...r}=e.header,u={header:{...r,pcs:null==e?void 0:e.serials.length,date:(0,x.ku)(o)},items:null==ln?void 0:null===(l=ln.values)||void 0===l?void 0:l.serials.filter(e=>e.srlNo).map((e,l)=>{let{taxDetails:i,recordId:a,...d}=e;return{...d,seqNo:l+1,returnId:a||0}})};e0({extension:f.y.PUDraftReturn.set2,record:JSON.stringify(u)}).then(async e=>{t.ZP.success(eY?e6.Edited:e6.Added),await lo(e.recordId),li()})}});async function lo(e){lP(await lr(e),await lt(e))}async function lr(e){var l,i;let a=await eK({extension:f.y.PUDraftReturn.get,parameters:"_recordId=".concat(e)}),d=await eK({extension:f.y.Vendor.get,parameters:"_recordId=".concat(null==a?void 0:null===(l=a.record)||void 0===l?void 0:l.vendorId)});return a.record.date=(0,x.a1)(null==a?void 0:null===(i=a.record)||void 0===i?void 0:i.date),a.record.accountId=d.record.accountId,a}async function lt(e){return await eK({extension:f.y.PUDraftReturnSerial.qry,parameters:"_returnId=".concat(e)})}async function lu(){let e=await eK({extension:k.H.TaxDetailPack.qry,parameters:"_taxId=0"});ln.setFieldValue("taxDetailsStore",null==e?void 0:e.list)}function ls(e,l){e5||e9(!0);let i=(0,O.Ch)({priceType:3,basePrice:0,volume:parseFloat((null==e?void 0:e.volume)||0),weight:1,unitPrice:parseFloat(null==e?void 0:e.baseLaborPrice),upo:0,qty:parseFloat(null==e?void 0:e.weight),extendedPrice:parseFloat(null==e?void 0:e.unitPrice).toFixed(2),mdAmount:0,mdType:0,baseLaborPrice:0,totalWeightPerG:0,mdValue:0,tdPct:0,dirtyField:l}),a=(0,R.VW)({basePrice:0,qty:parseFloat(null==e?void 0:e.weight),extendedPrice:parseFloat(null==i?void 0:i.extendedPrice),tdPct:0,baseLaborPrice:0,taxDetails:parseFloat(null==e?void 0:e.taxDetails)});return{unitPrice:parseFloat(null==i?void 0:i.extendedPrice).toFixed(2),baseLaborPrice:parseFloat(null==i?void 0:i.unitPrice).toFixed(2),vatAmount:parseFloat(null==a?void 0:a.vatAmount).toFixed(2)}}let lc=null==e8?void 0:null===(B=e8.find(e=>e.checkId===T.F.POS_JUMP_TO_NEXT_LINE))||void 0===B?void 0:B.value,lv=!!(null===(H=ln.values)||void 0===H?void 0:H.recordId),lm=(null===(z=ln.values.header)||void 0===z?void 0:z.status)===3,lh=e=>{if(e.length){let l=null==e?void 0:e.map(e=>{var l;return null!=e.taxId?{...e,extendedPrice:e.unitPrice,taxDetails:lf(null==ln?void 0:null===(l=ln.values)||void 0===l?void 0:l.taxDetailsStore,e.taxId)}:e});ln.setFieldValue("serials",l)}},lf=(e,l)=>{var i;return(null==e?void 0:null===(i=e.data)||void 0===i?void 0:i.items)?e.data.items.map(e=>e.data).filter(e=>e.taxId===l):[]},lp=async e=>{var l;if(!(null==e?void 0:e.returnId)||!(null==e?void 0:e.itemId))return!0;let i={returnId:null==ln?void 0:null===(l=ln.values)||void 0===l?void 0:l.recordId,lineItem:e};return await e0({extension:f.y.PUDraftReturnSerial.del,record:JSON.stringify(i)}),!0};async function lx(e,l,i){if(null==l?void 0:l.srlNo)return lI(e,l,i)}async function lI(e,l,i){l.returnId=(null==e?void 0:e.recordId)||i,e.recordId=(null==e?void 0:e.recordId)||i,delete e.serials;let a=await e0({extension:f.y.PUDraftReturnSerial.append,record:JSON.stringify({header:e,lineItem:l}),noHandleError:!0});return null==a||!a.error||(e1({message:null==a?void 0:a.error}),!1)}async function ly(e,l){if(null==l?void 0:l.srlNo)return!!lI(e,l)&&(t.ZP.success(e6.Saved),!0)}async function lg(e,l){var i,a,d;let{invoiceId:n,invoiceRef:o,disSkuLookup:r,search:u,date:s,...c}=null==ln?void 0:null===(i=ln.values)||void 0===i?void 0:i.header,v={header:{...c,pcs:0,date:(0,x.ku)(s)},items:[]},m=await e0({extension:f.y.PUDraftReturn.set2,record:JSON.stringify(v)}),h=await lr(m.recordId);if(ln.setFieldValue("header.recordId",m.recordId),ln.setFieldValue("header.reference",null==h?void 0:null===(a=h.record)||void 0===a?void 0:a.reference),ln.setFieldValue("header.date",null==h?void 0:null===(d=h.record)||void 0===d?void 0:d.date),!("import"===l?await lx(null==h?void 0:h.record,e):await ly(null==h?void 0:h.record,e)))return!1;{t.ZP.success(e6.Saved);let e=await lr(m.recordId),l=await lt(m.recordId);return await lP(e,l),li(),!0}}let lF=[{component:"textfield",label:eQ.srlNo,name:"srlNo",flex:1.2,updateOn:"blur",jumpToNextLine:lc,disableDuplicate:!0,propsReducer(e){let{row:l,props:i}=e;return{...i,readOnly:null==l?void 0:l.srlNo}},async onChange(e){let{row:{update:l,newRow:i,oldRow:a,addRow:d}}=e;if((null==i?void 0:i.srlNo)&&(null==i?void 0:i.srlNo)&&i.srlNo!==(null==a?void 0:a.srlNo)){var n,o,r,t,u,s,c,v,m,h,p,x,I,y,g,F,b,w,P,N,j,S,V,C,k,A,D,R,Z,_,q,T,L,E;let e=await eK({extension:f.y.Serials.last,parameters:"_currencyId=".concat(null==ln?void 0:null===(o=ln.values)||void 0===o?void 0:null===(n=o.header)||void 0===n?void 0:n.currencyId,"&_vendorId=").concat(null==ln?void 0:null===(t=ln.values)||void 0===t?void 0:null===(r=t.header)||void 0===r?void 0:r.vendorId,"&_srlNo=").concat(null==i?void 0:i.srlNo)}),a={fieldName:"srlNo",changes:{id:i.id,seqNo:i.id,invoiceSeqNo:i.id,invoiceComponentSeqNo:(null==e?void 0:null===(u=e.record)||void 0===u?void 0:u.invoiceComponentSeqNo)||0,returnId:null==ln?void 0:null===(s=ln.values)||void 0===s?void 0:s.recordId,srlNo:null==e?void 0:null===(c=e.record)||void 0===c?void 0:c.srlNo,sku:null==e?void 0:null===(v=e.record)||void 0===v?void 0:v.sku,itemName:null==e?void 0:null===(m=e.record)||void 0===m?void 0:m.itemName,weight:(null==e?void 0:null===(h=e.record)||void 0===h?void 0:h.weight)||0,itemId:null==e?void 0:null===(p=e.record)||void 0===p?void 0:p.itemId,metalId:null==e?void 0:null===(x=e.record)||void 0===x?void 0:x.metalId,metalRef:null==e?void 0:null===(I=e.record)||void 0===I?void 0:I.metalRef,designId:null==e?void 0:null===(y=e.record)||void 0===y?void 0:y.designId,designRef:null==e?void 0:null===(g=e.record)||void 0===g?void 0:g.designRef,invoiceReference:null==e?void 0:null===(F=e.record)||void 0===F?void 0:F.invoiceRef,volume:(null==e?void 0:null===(b=e.record)||void 0===b?void 0:b.volume)||0,baseLaborPrice:(null==e?void 0:null===(w=e.record)||void 0===w?void 0:w.laborPrice)||0,unitPrice:parseFloat(null==e?void 0:null===(P=e.record)||void 0===P?void 0:P.unitPrice).toFixed(2)||0,vatPct:(null==e?void 0:null===(N=e.record)||void 0===N?void 0:N.vatPct)||0,extendedPrice:(null==e?void 0:null===(j=e.record)||void 0===j?void 0:j.extendedPrice)||0,vatAmount:parseFloat(null==e?void 0:null===(S=e.record)||void 0===S?void 0:S.vatAmount).toFixed(2)||0,invoiceTrxId:(null==e?void 0:null===(V=e.record)||void 0===V?void 0:V.trxId)||null,...(null==e?void 0:null===(C=e.record)||void 0===C?void 0:C.taxId)&&{taxId:(null===(k=ln.values)||void 0===k?void 0:k.taxId)||(null==e?void 0:null===(A=e.record)||void 0===A?void 0:A.taxId),taxDetails:await lf(null==ln?void 0:null===(D=ln.values)||void 0===D?void 0:D.taxDetailsStore,(null===(Z=ln.values)||void 0===Z?void 0:null===(R=Z.header)||void 0===R?void 0:R.taxId)||(null==e?void 0:null===(_=e.record)||void 0===_?void 0:_.taxId))}}},{unitPrice:U,baseLaborPrice:W}=ls(a.changes,O.Xf);a.changes.unitPrice=U,a.changes.baseLaborPrice=W,null!=a.changes.taxId&&(a.changes.extendedPrice=U,a.changes.taxDetails=lf(null==ln?void 0:null===(L=ln.values)||void 0===L?void 0:L.taxDetailsStore,a.changes.taxId)),((null==ln?void 0:null===(q=ln.values)||void 0===q?void 0:q.recordId)?await ly(null==ln?void 0:null===(T=ln.values)||void 0===T?void 0:T.header,a.changes):await lg(a.changes))?await d(a):l({...null==ln?void 0:null===(E=ln.initialValues)||void 0===E?void 0:E.serials,id:null==i?void 0:i.id,srlNo:""})}}},{component:"textfield",label:eQ.itemRef,name:"sku",props:{readOnly:!0}},{component:"textfield",label:eQ.itemDesc,name:"itemName",flex:2,props:{readOnly:!0}},{component:"textfield",label:eQ.metal,name:"metalRef",flex:.6,props:{readOnly:!0}},{component:"textfield",label:eQ.invoiceNo,name:"invoiceReference",props:{readOnly:!0}},{component:"numberfield",label:eQ.weight,name:"weight",props:{readOnly:!0}},{component:"numberfield",label:eQ.vatAmount,name:"vatAmount",props:{readOnly:!0}},{component:"button",name:"taxDetailsButton",flex:.75,props:{onCondition:e=>e.itemId&&e.taxId?{imgSrc:i(54022).default.src,hidden:!1}:{imgSrc:"",hidden:!0}},label:eQ.tax,onClick:(e,l)=>{l.qty=l.weight,l.basePrice=0,e2({Component:_.Z,props:{taxId:null==l?void 0:l.taxId,obj:l}})}}],lb=[{key:"WorkFlow",condition:!0,onClick:async function(){var e;e2({Component:D.Z,props:{functionId:j.J.PUDraftSerialReturn,recordId:null===(e=ln.values)||void 0===e?void 0:e.recordId}})},disabled:!lv},{key:"Import",condition:!0,onClick:async function(){var e;e2({Component:q.Z,props:{endPoint:f.y.PUDraftReturnSerial.batch,header:{draftId:null==ln?void 0:null===(e=ln.values)||void 0===e?void 0:e.recordId},onCloseimport:lw,maxAccess:le}})},disabled:!lv||lm},{key:"AccountSummary",condition:!0,onClick:()=>{var e;e2({Component:U.Z,props:{accountId:parseInt(null===(e=ln.values.header)||void 0===e?void 0:e.accountId),moduleId:1}})}},{key:"Unlocked",condition:!lm,onClick:async()=>{var e;let{invoiceId:l,invoiceRef:i,disSkuLookup:a,search:d,date:n,...o}=null==ln?void 0:null===(e=ln.values)||void 0===e?void 0:e.header;await e0({extension:f.y.PUDraftReturn.post,record:JSON.stringify({...o,date:(0,x.ku)(n),wip:2})}).then(async()=>{var e;t.ZP.success(e6.Posted),li(),await lo(null==ln?void 0:null===(e=ln.values)||void 0===e?void 0:e.recordId)})},disabled:!lv},{key:"Locked",condition:lm,disabled:!0}];async function lw(){var e,l,i,a;let d=await lr(null==ln?void 0:null===(e=ln.values)||void 0===e?void 0:e.recordId),n=await lt(null==ln?void 0:null===(l=ln.values)||void 0===l?void 0:l.recordId),o=await Promise.all(null===(i=n.list)||void 0===i?void 0:i.map(async(e,l)=>{var i;let a=(null==d?void 0:null===(i=d.record)||void 0===i?void 0:i.isVattable)?await lN(e.taxId):null;return{...e,id:l+1,baseLaborPrice:parseFloat(e.baseLaborPrice).toFixed(2),unitPrice:parseFloat(e.unitPrice).toFixed(2),vatAmount:parseFloat(e.vatAmount).toFixed(2),amount:parseFloat(e.amount).toFixed(2),taxDetails:a}}));await ln.setValues({...ln.values,...d.record,serials:o.length?o:null==ln?void 0:null===(a=ln.initialValues)||void 0===a?void 0:a.serials}),lh(o)}async function lP(e,l){var i,a,d,n,o,r;let t=await Promise.all(null==l?void 0:null===(i=l.list)||void 0===i?void 0:i.map(async(l,i)=>{var a;let d=(null==e?void 0:null===(a=e.record)||void 0===a?void 0:a.isVattable)?await lN(l.taxId):null;return{...l,id:l.seqNo,baseLaborPrice:parseFloat(l.baseLaborPrice).toFixed(2),unitPrice:parseFloat(l.unitPrice).toFixed(2),vatAmount:parseFloat(l.vatAmount).toFixed(2),amount:parseFloat(l.amount).toFixed(2),taxDetails:d}}));await ln.setValues({...ln.values,recordId:e.record.recordId,dtId:e.record.dtId,header:{...ln.values.header,...e.record,amount:null==e?void 0:null===(a=e.record)||void 0===a?void 0:a.amount,vatAmount:null==e?void 0:null===(d=e.record)||void 0===d?void 0:d.vatAmount,subTotal:null==e?void 0:null===(n=e.record)||void 0===n?void 0:n.subTotal,weight:null==e?void 0:null===(o=e.record)||void 0===o?void 0:o.weight},serials:t.length?t:null==ln?void 0:null===(r=ln.initialValues)||void 0===r?void 0:r.serials}),lh(t)}async function lN(e){if(!e)return;let l=await eK({extension:k.H.TaxDetailPack.qry,parameters:"_taxId=".concat(e)});return null==l?void 0:l.list}let lj=(null===(X=ln.values.header)||void 0===X?void 0:X.search)?ln.values.serials.filter(e=>{var l,i,a,d,n,o,r,t,u,s,c,v,m,h;return(null===(a=e.srlNo)||void 0===a?void 0:null===(i=a.toString())||void 0===i?void 0:i.includes(null===(l=ln.values.header)||void 0===l?void 0:l.search.toLowerCase()))||(null===(r=e.sku)||void 0===r?void 0:null===(o=r.toString())||void 0===o?void 0:null===(n=o.toLowerCase())||void 0===n?void 0:n.includes(null===(d=ln.values.header)||void 0===d?void 0:d.search.toLowerCase()))||(null===(c=e.itemName)||void 0===c?void 0:null===(s=c.toString())||void 0===s?void 0:null===(u=s.toLowerCase())||void 0===u?void 0:u.includes(null===(t=ln.values.header)||void 0===t?void 0:t.search.toLowerCase()))||(null===(h=e.weight)||void 0===h?void 0:null===(m=h.toString())||void 0===m?void 0:m.includes(null===(v=ln.values.header)||void 0===v?void 0:v.search))}):ln.values.serials,lS=(e,l,i)=>{if("delete"===l){let e=ln.values.serials;e=e.filter(e=>e.id!==i.id),ln.setFieldValue("serials",e),e9(!0)}else ln.setFieldValue("serials",e)};async function lV(e){if(e){var l,i;let a=await eK({extension:f.y.DocumentTypeDefault.get,parameters:"_dtId=".concat(e)});ln.setFieldValue("header.plantId",(null==a?void 0:null===(l=a.record)||void 0===l?void 0:l.plantId)||null),ln.setFieldValue("header.siteId",(null==a?void 0:null===(i=a.record)||void 0===i?void 0:i.siteId)||ld||null)}else ln.setFieldValue("header.plantId",null),ln.setFieldValue("header.siteId",null)}(0,d.useEffect)(()=>{var e,l;if(null==ln?void 0:null===(l=ln.values)||void 0===l?void 0:null===(e=l.serials)||void 0===e?void 0:e.length){let e=null==ln?void 0:null===(i=ln.values)||void 0===i?void 0:i.serials,l=e.reduce((e,l)=>{let{metalId:i,weight:a,metalRef:d}=l;return i&&(e[i]||(e[i]={metal:d,pcs:0,totalWeight:0}),e[i].pcs+=1,e[i].totalWeight+=parseFloat(a||0)),e},{});Object.keys(l).forEach(e=>{l[e].totalWeight=parseFloat(l[e].totalWeight.toFixed(2))}),ln.setFieldValue("metalGridData",Object.values(l));var i,a=0;let d=e.reduce((e,l)=>{let{sku:i,itemId:d,itemName:n,weight:o}=l;return d&&(e[d]||(a++,e[d]={sku:i,pcs:0,weight:0,itemName:n,seqNo:a}),e[d].pcs+=1,e[d].weight=parseFloat((e[d].weight+parseFloat(o||0)).toFixed(2))),e},{});ln.setFieldValue("itemGridData",Object.values(d).sort((e,l)=>e.seqNo-l.seqNo))}},[null==ln?void 0:null===($=ln.values)||void 0===$?void 0:$.serials]);let{subTotal:lC,vatAmount:lk,weight:lA,amount:lD}=null==ln?void 0:null===(M=ln.values)||void 0===M?void 0:null===(Q=M.serials)||void 0===Q?void 0:Q.reduce((e,l)=>{var i,a,d,n,o,r,t,u;let s=parseFloat(null==l?void 0:l.unitPrice)||0,c=parseFloat(null==l?void 0:l.vatAmount)||0,v=parseFloat(null==l?void 0:l.weight)||0;return{subTotal:e5?parseFloat(((null==e?void 0:e.subTotal)+s).toFixed(2)):(null===(a=ln.values)||void 0===a?void 0:null===(i=a.header)||void 0===i?void 0:i.subTotal)||0,vatAmount:e5?parseFloat(((null==e?void 0:e.vatAmount)+c).toFixed(2)):(null===(n=ln.values)||void 0===n?void 0:null===(d=n.header)||void 0===d?void 0:d.vatAmount)||0,weight:e5?(null==e?void 0:e.weight)+v:(null===(r=ln.values)||void 0===r?void 0:null===(o=r.header)||void 0===o?void 0:o.weight)||0,amount:e5?parseFloat(((null==e?void 0:e.subTotal)+s+(null==e?void 0:e.vatAmount)+c).toFixed(2)):(null===(u=ln.values)||void 0===u?void 0:null===(t=u.header)||void 0===t?void 0:t.amount)||0}},{subTotal:0,vatAmount:0,weight:0,amount:0});async function lR(){var e,l,i,a,d,n,o,r,u,s,c;if(!await lZ())return;let v=[...ln.values.serials],m=await eK({extension:f.y.Serials.import,parameters:"_invoiceId=".concat(null==ln?void 0:null===(l=ln.values)||void 0===l?void 0:null===(e=l.header)||void 0===e?void 0:e.invoiceId)}),h=v.length?v[v.length-1].id:0;if(m.count>0){for(let e of(v=v.filter(e=>e.srlNo),m.list)){let l={srlNo:e.srlNo,itemId:e.itemId,sku:e.sku,itemName:e.itemName,invoiceReference:null==ln?void 0:null===(a=ln.values)||void 0===a?void 0:null===(i=a.header)||void 0===i?void 0:i.invoiceRef,invoiceTrxId:e.trxId,invoiceSeqNo:e.seqNo,invoiceComponentSeqNo:e.componentSeqNo,weight:e.weight,metalId:e.metalId,baseLaborPrice:e.laborPrice,unitPrice:e.unitPrice,vatAmount:e.vatAmount,metalRef:e.metalRef,seqNo:h+1,id:h+1,...(null==m?void 0:null===(d=m.record)||void 0===d?void 0:d.taxId)&&{taxId:(null===(o=ln.values)||void 0===o?void 0:null===(n=o.header)||void 0===n?void 0:n.taxId)||(null==m?void 0:null===(r=m.record)||void 0===r?void 0:r.taxId)}},{unitPrice:t,baseLaborPrice:f}=ls(l,O.Xf);l.unitPrice=t,l.baseLaborPrice=f,null!=l.taxId&&(l.extendedPrice=t),((null==ln?void 0:null===(u=ln.values)||void 0===u?void 0:u.recordId)||v.length>0?await lx(null==ln?void 0:null===(s=ln.values)||void 0===s?void 0:s.header,l,null==v?void 0:null===(c=v[0])||void 0===c?void 0:c.returnId):await lg(l,"import"))&&(h++,ln.setFieldValue("serials",[...v,l]),v.push(l))}t.ZP.success(e6.Saved)}}async function lZ(){if(Object.keys(await ln.validateForm()).length){let e=Object.keys(await ln.validateForm()).reduce((e,l)=>(ln.touched[l]||(e[l]=!0),e),{});return Object.keys(e).length&&ln.setTouched(e,!0),!1}return!0}return(0,d.useEffect)(()=>{ln.setFieldValue("header.subTotal",lC),ln.setFieldValue("header.vatAmount",lk),ln.setFieldValue("header.weight",lA),ln.setFieldValue("header.amount",lD)},[lA,lC,lk,lD]),(0,d.useEffect)(()=>{!async function(){lu(),eY&&await lo(eY)}()},[]),(0,a.jsx)(g.Z,{resourceId:s.i.PUDraftSerialReturns,functionId:j.J.DraftInvoiceReturn,form:ln,maxAccess:le,previewReport:lv,isPosted:lm,actions:lb,editMode:lv,disabledSubmit:lm&&!lv,children:(0,a.jsxs)(c.R,{children:[(0,a.jsx)(v.g,{children:(0,a.jsxs)(I.ZP,{container:!0,spacing:2,children:[(0,a.jsx)(I.ZP,{item:!0,xs:8,children:(0,a.jsxs)(I.ZP,{container:!0,spacing:2,children:[(0,a.jsx)(I.ZP,{item:!0,xs:6,children:(0,a.jsx)(w.Z,{endpointId:P.r.DocumentType.qry,parameters:"_startAt=0&_pageSize=1000&_dgId=".concat(j.J.PUDraftSerialReturn),name:"header.dtId",label:eQ.documentType,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],readOnly:lv,required:!0,valueField:"recordId",displayField:["reference","name"],values:ln.values.header,maxAccess:le,onChange:async(e,l)=>{await lV(null==l?void 0:l.recordId),ll(l),ln.setFieldValue("header.dtId",(null==l?void 0:l.recordId)||null)},error:(null===(Y=ln.touched.header)||void 0===Y?void 0:Y.dtId)&&!!(null===(K=ln.errors.header)||void 0===K?void 0:K.dtId)})}),(0,a.jsx)(I.ZP,{item:!0,xs:6,children:(0,a.jsx)(w.Z,{endpointId:N.$.Site.qry,name:"header.siteId",readOnly:lm,label:eQ.site,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:ln.values.header,required:!0,valueField:"recordId",displayField:["reference","name"],maxAccess:le,onChange:(e,l)=>{(null==l?void 0:l.isInactive)?(ln.setFieldValue("header.siteId",null),e1({message:eQ.inactiveSite})):ln.setFieldValue("header.siteId",(null==l?void 0:l.recordId)||null)},error:(null===(ee=ln.touched.header)||void 0===ee?void 0:ee.siteId)&&!!(null===(el=ln.errors.header)||void 0===el?void 0:el.siteId)})}),(0,a.jsx)(I.ZP,{item:!0,xs:6,children:(0,a.jsx)(F.Z,{name:"header.reference",label:eQ.docReference,value:null==ln?void 0:null===(ea=ln.values)||void 0===ea?void 0:null===(ei=ea.header)||void 0===ei?void 0:ei.reference,maxAccess:!lv&&le,readOnly:lv,onChange:ln.handleChange,onClear:()=>ln.setFieldValue("header.reference",""),error:(null===(ed=ln.touched.header)||void 0===ed?void 0:ed.reference)&&!!(null===(en=ln.errors.header)||void 0===en?void 0:en.reference)})}),(0,a.jsx)(I.ZP,{item:!0,xs:6,children:(0,a.jsx)(w.Z,{endpointId:P.r.Plant.qry,name:"header.plantId",label:eQ.plant,readOnly:lm,required:!0,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:ln.values.header,valueField:"recordId",displayField:["reference","name"],maxAccess:le,onChange:(e,l)=>{ln.setFieldValue("header.plantId",null==l?void 0:l.recordId)},error:(null===(eo=ln.touched.header)||void 0===eo?void 0:eo.plantId)&&!!(null===(er=ln.errors.header)||void 0===er?void 0:er.plantId)})}),(0,a.jsx)(I.ZP,{item:!0,xs:6,children:(0,a.jsx)(p.Z,{name:"header.date",required:!0,label:eQ.postingDate,value:null==ln?void 0:null===(eu=ln.values)||void 0===eu?void 0:null===(et=eu.header)||void 0===et?void 0:et.date,onChange:(e,l)=>{ln.setFieldValue("header.date",l),ln.setFieldValue("header.invoiceId",null),ln.setFieldValue("header.invoiceRef","")},readOnly:lm,maxAccess:le,onClear:()=>ln.setFieldValue("header.date",""),error:(null===(es=ln.touched.header)||void 0===es?void 0:es.date)&&!!(null===(ec=ln.errors.header)||void 0===ec?void 0:ec.date)})}),(0,a.jsx)(I.ZP,{item:!0,xs:6,children:(0,a.jsx)(w.Z,{endpointId:P.r.Currency.qry,name:"header.currencyId",filter:e=>1===e.currencyType,label:eQ.currency,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],required:!0,readOnly:lv,values:ln.values.header,maxAccess:le,onChange:(e,l)=>{ln.setFieldValue("header.invoiceId",null),ln.setFieldValue("header.invoiceRef",""),ln.setFieldValue("header.currencyId",(null==l?void 0:l.recordId)||null)},error:(null===(ev=ln.touched.header)||void 0===ev?void 0:ev.currencyId)&&!!(null===(em=ln.errors.header)||void 0===em?void 0:em.currencyId)})})]})}),(0,a.jsx)(I.ZP,{item:!0,xs:4,children:(0,a.jsx)(b.Z,{name:"header.description",label:eQ.description,value:null===(eh=ln.values.header)||void 0===eh?void 0:eh.description,rows:4.2,readOnly:lm,maxAccess:le,onChange:e=>ln.setFieldValue("header.description",e.target.value),onClear:()=>ln.setFieldValue("header.description",""),error:(null===(ef=ln.touched.header)||void 0===ef?void 0:ef.description)&&!!(null===(ep=ln.errors.header)||void 0===ep?void 0:ep.description)})}),(0,a.jsx)(I.ZP,{item:!0,xs:8,children:(0,a.jsx)(S.U,{endpointId:f.y.Vendor.snapshot,filter:{isInactive:e=>!0!==e},valueField:"reference",displayField:"name",secondFieldLabel:eQ.name,name:"header.vendorId",label:eQ.vendor,formObject:ln.values.header,form:ln,required:!0,readOnly:lm,displayFieldWidth:2,firstFieldWidth:3,secondFieldName:"header.vendorName",valueShow:"vendorRef",secondValueShow:"vendorName",maxAccess:le,onSecondValueChange:(e,l)=>{ln.setFieldValue("header.vendorName",l)},columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"},{key:"flName",value:"Foreign Language"}],onChange:async(e,l)=>{ln.setFieldValue("header.vendorName",(null==l?void 0:l.name)||""),ln.setFieldValue("header.vendorRef",(null==l?void 0:l.reference)||""),ln.setFieldValue("header.accountId",(null==l?void 0:l.accountId)||null),ln.setFieldValue("header.isVattable",(null==l?void 0:l.isTaxable)||!1),ln.setFieldValue("header.taxId",(null==l?void 0:l.taxId)||null),ln.setFieldValue("header.invoiceId",null),ln.setFieldValue("header.invoiceRef",""),ln.setFieldValue("header.vendorId",(null==l?void 0:l.recordId)||null)},errorCheck:"header.vendorId"})}),(0,a.jsx)(I.ZP,{item:!0,xs:4,children:(0,a.jsx)(w.Z,{endpointId:k.H.TaxSchedules.qry,name:"header.taxId",label:eQ.tax,valueField:"recordId",displayField:["name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],readOnly:!0,values:ln.values.header,maxAccess:le,onChange:(e,l)=>{ln.setFieldValue("header.taxId",(null==l?void 0:l.recordId)||null)},error:(null===(ex=ln.touched.header)||void 0===ex?void 0:ex.taxId)&&!!(null===(eI=ln.errors.header)||void 0===eI?void 0:eI.taxId)})}),(0,a.jsx)(I.ZP,{item:!0,xs:4,children:(0,a.jsx)(w.Z,{endpointId:(null==ln?void 0:null===(eg=ln.values)||void 0===eg?void 0:null===(ey=eg.header)||void 0===ey?void 0:ey.vendorId)&&(null==ln?void 0:null===(eb=ln.values)||void 0===eb?void 0:null===(eF=eb.header)||void 0===eF?void 0:eF.date)&&f.y.PUInvoiceRetBalance.balance,parameters:"_vendorId=".concat(null==ln?void 0:null===(eP=ln.values)||void 0===eP?void 0:null===(ew=eP.header)||void 0===ew?void 0:ew.vendorId,"&_returnDate=").concat(null==ln?void 0:null===(eS=ln.values)||void 0===eS?void 0:null===(ej=eS.header)||void 0===ej?void 0:null===(eN=ej.date)||void 0===eN?void 0:eN.toISOString()),filter:e=>{var l,i;return e.currencyId==(null==ln?void 0:null===(i=ln.values)||void 0===i?void 0:null===(l=i.header)||void 0===l?void 0:l.currencyId)},name:"header.invoiceId",label:eQ.puInv,valueField:"recordId",displayField:"reference",displayFieldWidth:1,readOnly:lm,values:ln.values.header,maxAccess:le,onChange:(e,l)=>{ln.setFieldValue("header.invoiceId",(null==l?void 0:l.recordId)||null),ln.setFieldValue("header.invoiceRef",(null==l?void 0:l.reference)||"")},error:(null===(eV=ln.touched.header)||void 0===eV?void 0:eV.invoiceId)&&!!(null===(eC=ln.errors.header)||void 0===eC?void 0:eC.invoiceId)},"".concat(null===(ek=ln.values.header)||void 0===ek?void 0:ek.vendorId,"-").concat(null===(eD=ln.values.header)||void 0===eD?void 0:null===(eA=eD.date)||void 0===eA?void 0:eA.toISOString(),"-").concat(null===(eR=ln.values.header)||void 0===eR?void 0:eR.currencyId))}),(0,a.jsx)(I.ZP,{item:!0,xs:4,children:(0,a.jsx)(E.Z,{onClick:lR,label:e6.import,image:"import.png",color:"#000",disabled:!(null==ln?void 0:null===(e_=ln.values)||void 0===e_?void 0:null===(eZ=e_.header)||void 0===eZ?void 0:eZ.invoiceId)||lm})}),(0,a.jsx)(I.ZP,{item:!0,xs:4,children:(0,a.jsx)(F.Z,{name:"header.search",value:null===(eq=ln.values.header)||void 0===eq?void 0:eq.search,label:e6.Search,onClear:()=>{ln.setFieldValue("header.search","")},onChange:e=>{let{value:l}=e.target;ln.setFieldValue("header.search",l)},onSearch:e=>ln.setFieldValue("header.search",e),search:!0})})]})}),(0,a.jsx)(m.Q,{children:(0,a.jsx)(V._,{onChange:(e,l,i)=>lS(e,l,i),value:lj||[],error:ln.errors.serials,initialValues:null==ln?void 0:null===(eT=ln.initialValues)||void 0===eT?void 0:null===(eO=eT.serials)||void 0===eO?void 0:eO[0],columns:lF,name:"serials",maxAccess:le,disabled:lm||Object.entries((null==ln?void 0:ln.errors)||{}).filter(e=>{let[l]=e;return"serials"!==l}).length>0,allowDelete:!lm,allowAddNewLine:!(null==ln?void 0:null===(eE=ln.values)||void 0===eE?void 0:null===(eL=eE.header)||void 0===eL?void 0:eL.search)&&((null===(eW=ln.values)||void 0===eW?void 0:null===(eU=eW.serials)||void 0===eU?void 0:eU.length)===0||!!(null===(ez=ln.values)||void 0===ez?void 0:null===(eH=ez.serials)||void 0===eH?void 0:null===(eJ=eH[(null===(eB=ln.values)||void 0===eB?void 0:null===(eG=eB.serials)||void 0===eG?void 0:eG.length)-1])||void 0===eJ?void 0:eJ.srlNo)),autoDelete:lp,onValidationRequired:lZ})}),(0,a.jsxs)(I.ZP,{container:!0,spacing:2,children:[(0,a.jsx)(I.ZP,{item:!0,xs:5,height:"13vh",sx:{display:"flex",flex:1},children:(0,a.jsx)(r.Z,{name:"metal",gridData:{count:1,list:null==ln?void 0:null===(eX=ln.values)||void 0===eX?void 0:eX.metalGridData},maxAccess:eM,columns:[{field:"metal",headerName:eQ.metal,flex:1},{field:"pcs",headerName:eQ.pcs,type:"number",flex:1},{field:"totalWeight",headerName:eQ.totalWeight,type:"number",flex:1}],rowId:["metal"],pagination:!1})}),(0,a.jsx)(I.ZP,{item:!0,xs:.5}),(0,a.jsx)(I.ZP,{item:!0,xs:2,children:(0,a.jsxs)(I.ZP,{container:!0,spacing:2,children:[(0,a.jsx)(I.ZP,{item:!0,xs:12,height:20}),(0,a.jsx)(I.ZP,{item:!0,xs:12,children:(0,a.jsx)(C.Z,{name:"header.weight",maxAccess:le,label:eQ.totalWeight,value:lA,readOnly:!0})})]})}),(0,a.jsx)(I.ZP,{item:!0,xs:8,height:"13vh",sx:{display:"flex",flex:1},children:(0,a.jsx)(r.Z,{name:"item",columns:[{field:"seqNo",headerName:eQ.seqNo,type:"number",flex:.75},{field:"sku",headerName:eQ.sku,flex:1},{field:"itemName",headerName:eQ.itemDesc,flex:2},{field:"pcs",headerName:eQ.pcs,type:"number",flex:1},{field:"weight",headerName:eQ.weight,type:"number",flex:1}],gridData:{count:1,list:null==ln?void 0:null===(e$=ln.values)||void 0===e$?void 0:e$.itemGridData},rowId:["sku"],maxAccess:eM,pagination:!1})})]})]})})}var J=i(36908),G=()=>{let{postRequest:e,getRequest:l}=(0,d.useContext)(o.$),{platformLabels:i}=(0,d.useContext)(h.l),{stack:p}=(0,u.zY)(),{query:{data:x},filterBy:I,refetch:y,labels:g,access:F,paginationParameters:b,invalidate:w}=(0,n.J)({queryFn:N,endpointId:f.y.PUDraftReturn.page,datasetId:s.i.PUDraftSerialReturns,filter:{filterFn:S}}),P=[{field:"reference",headerName:g.reference,flex:1},{field:"date",headerName:g.date,flex:1,type:"date"},{field:"vendorRef",headerName:g.vendorRef,flex:1},{field:"vendorName",headerName:g.vendorName,flex:1},{field:"pcs",headerName:g.pcs,flex:1,type:"number"},{field:"weight",headerName:g.totalWeight,flex:1,type:"number"},{field:"description",headerName:g.description,flex:1.25},{field:"statusName",headerName:g.status,flex:1}];async function N(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{_startAt:i=0,_pageSize:a=50,params:d=[]}=e;return{...await l({extension:f.y.PUDraftReturn.page,parameters:"_startAt=".concat(i,"&_pageSize=").concat(a,"&_params=").concat(d,"&filter=")}),_startAt:i}}async function S(e){let{filters:i,pagination:a}=e;return i.qry?await l({extension:f.y.PUDraftReturn.snapshot,parameters:"_filter=".concat(i.qry,"&_status=0")}):N({_startAt:a._startAt||0,params:null==i?void 0:i.params})}let{proxyAction:V}=(0,Z.G)({functionId:j.J.PUDraftSerialReturn,action:k}),C=async()=>{await V()};async function k(e){p({Component:W,props:{labels:g,access:F,recordId:e},width:1400,height:800,title:g.draftSerReturn})}let A=async l=>{await e({extension:f.y.PUDraftReturn.del,record:JSON.stringify(l)}),w(),t.ZP.success(i.Deleted)};return(0,a.jsxs)(c.R,{children:[(0,a.jsx)(v.g,{children:(0,a.jsx)(J.Z,{onAdd:C,maxAccess:F,filterBy:I,reportName:"PUDRE"})}),(0,a.jsx)(m.Q,{children:(0,a.jsx)(r.Z,{columns:P,gridData:x,rowId:["recordId"],onEdit:e=>{k(e.recordId)},refetch:y,onDelete:A,deleteConfirmationType:"strict",pageSize:50,maxAccess:F,paginationParameters:b,paginationType:"api"})})]})}},93736:function(e,l,i){"use strict";i.d(l,{K:function(){return d}});let a="RG.FI.asmx/",d={FiOpeningBalance:{gen:a+"genOBA"},FiAging:{qry:a+"FI404"},AccountSummary:{AccFI405b:a+"FI405b"},DocumentAging:{AgingFI406a:a+"FI406a",AgingFI406b:a+"FI406b"},TrialBalance:{FI402View:a+"FI402o",FI401o2:a+"FI401o2"}}},16463:function(e,l,i){"use strict";i.d(l,{Z:function(){return w}});var a=i(52322),d=i(2784),n=i(49864),o=i(65950),r=i(27423),t=i(26612),u=i(71987),s=i(33625),c=i(62362),v=i(31389),m=i(8661),h=i(25870),f=i(69627),p=i(84100),x=i(19473),I=i(80983),y=i(38449),g=i(69387),F=i(93736),b=i(21326);function w(e){let{accountId:l,moduleId:i,window:w}=e,{getRequest:P}=(0,d.useContext)(o.$),{platformLabels:N}=(0,d.useContext)(x.l),[j,S]=(0,d.useState)([]);(0,b.Z)({title:N.AccountSummary,window:w});let{labels:V,access:C}=(0,u.J)({datasetId:t.i.AccountSummary}),k=[{field:"days",headerName:V.days,flex:1,type:"number"}],[A,D]=(0,d.useState)(k),{formik:R}=(0,I.c)({maxAccess:C,initialValues:{accountId:null,accountRef:"",accountName:"",agpId:null,moduleId:i}});async function Z(){var e,l,a,d;let n;let o=2,r=[...k],t=await P({extension:y.r.Currency.qry,parameters:"_filter="});if(1==i?n=null==t?void 0:null===(e=t.list)||void 0===e?void 0:e.filter(e=>e.sale):2==i&&(n=null==t?void 0:null===(l=t.list)||void 0===l?void 0:l.filter(e=>e.purchase)),0==n.length)return;null==n||n.forEach((e,l)=>{r.push({field:"column".concat(l+1),headerName:e.reference,flex:1,type:"number"})}),D(r);let u=await P({extension:h.H.AgingLeg.qry,parameters:"_agpId=".concat(R.values.agpId)}),s=null==u?void 0:null===(a=u.list)||void 0===a?void 0:a.map(e=>{let l=Array(n.length+2).fill(0);return l[0]=null,l[1]=e.days,l}),c=(n||[]).map(e=>P({extension:F.K.AccountSummary.AccFI405b,parameters:"_agpId=".concat(R.values.agpId,"&_currencyId=").concat(e.recordId,"&_accountId=").concat(R.values.accountId)}).then(e=>({summaryRes:e})));(await Promise.all(c)).forEach(e=>{var l;let{summaryRes:i}=e;null==i||null===(l=i.list)||void 0===l||l.forEach(e=>{null==s||s.forEach(l=>{l[1]==e.seqDays&&(l[o]=e.amount)})}),o++});let v=Array(n.length+2).fill(null);for(let e=2;e<n.length+2;e++){let l=0;null==s||s.map(i=>{l+=Number(i[e]||0)}),v[e]=l}let m=s.filter(e=>null!==e[1]).map(e=>{let[l,i,...a]=e,d={days:i};return a.forEach((e,l)=>{d["column".concat(l+1)]=e.toFixed(2)}),d}),f={};for(let e=0;e<n.length;e++)f["column".concat(e+1)]=null!==(d=v[e+2].toFixed(2))&&void 0!==d?d:0;m.push(f),S({list:m})}return(0,d.useEffect)(()=>{!async function(){if(l&&i){var e,a,d;let i=await P({extension:h.H.Account.get,parameters:"_recordId=".concat(l)});R.setFieldValue("accountId",null==i?void 0:null===(e=i.record)||void 0===e?void 0:e.recordId),R.setFieldValue("accountRef",null==i?void 0:null===(a=i.record)||void 0===a?void 0:a.reference),R.setFieldValue("accountName",null==i?void 0:null===(d=i.record)||void 0===d?void 0:d.name)}}()},[]),(0,a.jsxs)(v.R,{children:[(0,a.jsx)(s.g,{children:(0,a.jsxs)(n.Z,{container:!0,spacing:2,p:2,children:[(0,a.jsx)(n.Z,{item:!0,xs:12,children:(0,a.jsx)(r.U,{endpointId:h.H.Account.snapshot,name:"accountId",label:V.account,valueField:"reference",displayField:"name",valueShow:"accountRef",secondValueShow:"accountName",form:R,readOnly:R.values.accountId&&R.values.moduleId,required:!0,maxAccess:C,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],onChange:async(e,l)=>{R.setFieldValue("accountId",(null==l?void 0:l.recordId)||null),R.setFieldValue("accountName",(null==l?void 0:l.name)||""),R.setFieldValue("accountRef",(null==l?void 0:l.reference)||"")}})}),(0,a.jsx)(n.Z,{item:!0,xs:6,children:(0,a.jsx)(m.Z,{endpointId:h.H.AgingProfile.qry,parameters:"_startAt=0&_pageSize=1000&filter=",name:"agpId",label:V.agingProfile,values:R.values,valueField:"recordId",displayField:"name",maxAccess:C,required:!0,onChange:(e,l)=>{R.setFieldValue("agpId",(null==l?void 0:l.recordId)||null),(null==l?void 0:l.recordId)||S({list:[]})}})}),(0,a.jsx)(n.Z,{item:!0,xs:5,children:(0,a.jsx)(m.Z,{datasetId:p.v.FI_AGING_MODULE,label:V.module,name:"moduleId",values:R.values,valueField:"key",displayField:"value",maxAccess:C,required:!0,readOnly:R.values.moduleId,onChange:(e,l)=>{R.setFieldValue("moduleId",(null==l?void 0:l.key)||null)}})}),(0,a.jsx)(n.Z,{item:!0,xs:1,children:(0,a.jsx)(f.Z,{onClick:Z,image:"preview.png",disabled:!R.values.agpId||!R.values.moduleId||!R.values.accountId,tooltipText:N.Preview})})]})}),(0,a.jsx)(c.Q,{children:(0,a.jsx)(g.Z,{columns:A,gridData:j,isLoading:!1,pagination:!1})})]})}w.width=1e3,w.height=500},81330:function(e,l,i){"use strict";i.d(l,{Z:function(){return F}});var a=i(52322),d=i(2784),n=i(60218),o=i(31389),r=i(5088),t=i(21581),u=i(78711),s=i(19473),c=i(23361),v=i(21326);let m=e=>{let{window:l,onConfirm:i,fullScreen:n,open:o,dialogText:r}=e,{platformLabels:t}=(0,d.useContext)(s.l);return(0,v.Z)({title:t.import,window:l}),(0,a.jsx)(c.Z,{open:(null==o?void 0:o.flag)||!1,DialogText:r,okButtonAction:()=>{"function"==typeof i&&i(),l.close()},fullScreen:n,cancelButtonAction:()=>l.close(),height:"140px"})};m.width=470,m.height=170;var h=i(61802),f=i(65950),p=i(62202),x=i(62362),I=i(69627),y=i(54074);let g=e=>{var l,i;let{endPoint:c,header:g,onCloseimport:F,maxAccess:b,window:w}=e,{stack:P}=(0,h.zY)(),{platformLabels:N}=(0,d.useContext)(s.l),j=(0,d.useRef)(null),[S,V]=(0,d.useState)(null),[C,k]=(0,d.useState)([]),{postRequest:A}=(0,d.useContext)(f.$);(0,v.Z)({title:N.importSerials,window:w});let D=(0,u.TA)({initialValues:{serials:"",serialCount:0}}),R=e=>{let l=e.split("\n").filter(e=>""!==e.trim()).length;D.setFieldValue("serialCount",l)},Z=async()=>{P({Component:m,props:{open:{flag:!0},fullScreen:!1,onConfirm:_,dialogText:N.importConfirmation}})},_=async()=>{var e;let l=null===(e=D.values.serials)||void 0===e?void 0:e.replace(/\n/g,",\r\n"),i={...g,serials:l||C};await A({extension:c,record:JSON.stringify(i)}),p.ZP.success(N.Imported),F(),w.close()},q=[{key:"Import",condition:!0,onClick:Z,disabled:!(null==S?void 0:S.name)&&!(null==D?void 0:null===(l=D.values)||void 0===l?void 0:l.serials)}];return(0,a.jsx)(y.Z,{actions:q,onSave:()=>Z(),disabledSubmit:!(null==S?void 0:S.name)&&!(null==D?void 0:null===(i=D.values)||void 0===i?void 0:i.serials),isSaved:!1,children:(0,a.jsxs)(o.R,{children:[(0,a.jsx)(x.Q,{children:(0,a.jsxs)(n.ZP,{container:!0,spacing:2,children:[(0,a.jsx)(n.ZP,{item:!0,xs:7,children:(0,a.jsx)(r.Z,{name:"name",label:N.SelectCSV,value:null==S?void 0:S.name,disabled:D.values.serials||!!(null==S?void 0:S.name),readOnly:!0,maxAccess:b})}),(0,a.jsx)(n.ZP,{item:!0,xs:3,children:(0,a.jsx)(I.Z,{onClick:()=>{j.current.click()},label:"".concat(N.Browse,"..."),color:"primary",disabled:!!(null==S?void 0:S.name)||D.values.serials})}),(0,a.jsx)(n.ZP,{item:!0,xs:2,children:(0,a.jsx)(I.Z,{image:"clear.png",onClick:()=>{V(null),k([]),j.current.value=null},label:N.Clear,color:"#f44336"})}),(0,a.jsxs)(n.ZP,{item:!0,xs:12,children:[D.values.serialCount>0&&(0,a.jsxs)("label",{style:{marginBottom:"8px",display:"block"},maxAccess:b,children:[N.serials," ( ",D.values.serialCount," )"]}),(0,a.jsx)(t.Z,{name:"serials",label:N.serials,value:D.values.serials,rows:3,readOnly:null==S?void 0:S.name,onChange:e=>{D.setFieldValue("serials",e.target.value),R(e.target.value)},onClear:()=>{D.setFieldValue("serials",""),D.setFieldValue("serialCount",0)},error:D.touched.serials&&!!D.errors.serials,maxAccess:b})]})]})}),(0,a.jsx)("input",{type:"file",accept:".csv",ref:j,style:{display:"none"},onChange:e=>{let l=e.target.files[0];if(V(l),l){let e=new FileReader;e.onload=e=>{k(e.target.result)},e.readAsText(l)}}})]})})};g.width=550,g.height=270;var F=g},39704:function(e,l,i){"use strict";var a=i(52322),d=i(2784),n=i(22341),o=i(65950),r=i(85325),t=i(21326),u=i(19473),s=i(35656),c=i(24868),v=i.n(c);let m=e=>{let{functionId:l,recordId:i,window:c}=e,{getRequest:m}=(0,d.useContext)(o.$),{languageId:h}=(0,d.useContext)(r.V),{platformLabels:f}=(0,d.useContext)(u.l),p=i+"-"+l;(0,t.Z)({title:f.WorkFlow,window:c});let{width:x}=(0,s.d)(),I=x<=1024,y=x>1024&&x<=1280,g=I?10:y?12:14,F=I?75:y?85:95,b=I?15:y?20:25,w=async()=>{var e="_functionId=".concat(l,"&_recordId=").concat(i);let a=await m({extension:n.P.WorkFlow.graph,parameters:e});return null==a?void 0:a.record},P=e=>{let l=[],i=[],a="",d="";return e.objects.forEach(e=>{l.push({functionName:e.functionName,reference:e.reference,date:e.date})}),e.workflow.forEach(l=>{e.objects.forEach(e=>{let i=e.functionName.split(" ").join("\r\n");l.parentId===e.recordId&&l.parentFunctionId===e.functionId&&(a=e.reference+"\r\n"+e.date+"\r\n"+i,l.parentId),l.childId===e.recordId&&l.childFunctionId===e.functionId&&(d=e.reference+"\r\n"+e.date+"\r\n"+i,l.childId)}),""===a||""===d||i.push({from:a,to:d,value:1,labelText:""}),a="",d=""}),i};return(0,d.useEffect)(()=>{!async function(){var e=await w();if(e){let l=(e,l)=>{let i=document.createElement("script");i.type="text/javascript",i.src=e,i.async=!0,i.onload=l,document.head.appendChild(i)};l("https://cdn.amcharts.com/lib/4/core.js",()=>{l("https://cdn.amcharts.com/lib/4/charts.js",()=>{l("https://cdn.amcharts.com/lib/4/themes/animated.js",()=>{am4core.ready(()=>{let l=am4core.create(p,am4charts.SankeyDiagram),i=P(e);l.data=i,l.dataFields.fromName="from",l.dataFields.toName="to",l.dataFields.value="value",l.paddingRight=2===h?0:40,l.paddingLeft=2===h?40:0,l.tooltip.label.fontSize=g;let a=l.nodes.template;a.draggable=!1,a.inert=!0,a.clickable=!1,a.width=F,a.height=b,a.nameLabel.label.fontSize=g,a.nameLabel.locationX=2===h?.85:0,a.nameLabel.height=void 0,a.nameLabel.label.fontWeight="bold";let d=l.links.template;d.middleLine.strokeOpacity=.3,d.middleLine.stroke=am4core.color("#555"),d.middleLine.strokeWidth=5,d.middleLine.hoverable=!1,d.fillOpacity=0,d.hoverable=!0,d.hoverOnFocus=!0,d.fill=am4core.color("#A8C686"),d.isHover=!0,l.appear(1e3,100)})})})})}}()},[]),(0,a.jsx)("div",{id:p,className:v().root})};m.width=950,l.Z=m},24868:function(e){e.exports={root:"WorkFlow_root__EINm1"}}},function(e){e.O(0,[92515,2494,36908,23352,49774,92888,40179],function(){return e(e.s=79257)}),_N_E=e.O()}]);