(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[22417],{4828:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/fi-metal-trx/[functionId]",function(){return n(907)}])},907:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return M}});var a=n(52322),l=n(2784),r=n(62202),i=n(69387),d=n(65950),o=n(71987),c=n(26612),u=n(31389),s=n(33625),m=n(62362),p=n(61802),v=n(98345),y=n(25870),I=n(7121),f=n(19473),x=n(36908),h=n(60218),g=n(48601),F=n(82737),b=n(5088),w=n(80983),N=n(38449),V=n(8661),A=n(89330),q=n(39812),P=n(27423),j=n(91406),Z=n(21581),k=n(65215),C=n(51264),_=n(76399),R=n(16463);function S(e){var t,n,i,x,S,O,M,D,T,H,E,J;let{labels:G,access:L,recordId:$,functionId:B,getGLResourceId:U,window:z}=e,{getRequest:Q,postRequest:X}=(0,l.useContext)(d.$),{platformLabels:K,defaultsData:W,userDefaultsData:Y}=(0,l.useContext)(f.l),[ee,et]=(0,l.useState)({}),[en,ea]=(0,l.useState)([]),el=(0,l.useRef)(),{stack:er}=(0,p.zY)(),ei={[I.J.MetalReceiptVoucher]:y.H.MetalReceiptVoucher.set2,[I.J.MetalPaymentVoucher]:y.H.MetalPaymentVoucher.set2},{documentType:ed,maxAccess:eo,changeDT:ec}=(0,v.H)({functionId:B,access:L,enabled:!$}),eu=(0,o.E)({endpointId:y.H.MetalTrx.page}),es=parseInt(null==Y?void 0:null===(n=Y.list)||void 0===n?void 0:null===(t=n.find(e=>"plantId"===e.key))||void 0===t?void 0:t.value),em=parseInt(null==Y?void 0:null===(x=Y.list)||void 0===x?void 0:null===(i=x.find(e=>"siteId"===e.key))||void 0===i?void 0:i.value),{formik:ep}=(0,w.c)({documentType:{key:"dtId",value:null==ed?void 0:ed.dtId},initialValues:{accountId:null,paymentReasonId:null,batchId:null,collectorId:null,contactId:null,creditAmount:null,date:new Date,description:"",dtId:null,functionId:B,isVerified:!1,plantId:es,qty:null,pcs:null,recordId:null,reference:"",releaseStatus:null,siteId:em||null,status:1,accountGroupName:"",items:[{id:1,baseMetalQty:null,creditAmount:0,stdPurity:null,itemId:null,sku:"",itemName:"",metalId:null,purity:0,qty:0,seqNo:1,purityFromItem:!1,metalValue:null,totalCredit:0,trackBy:null,pcs:0,trxId:$||0,qtyOnHand:0}]},maxAccess:eo,validateOnChange:!0,validationSchema:g.Ry({date:g.Z_().required(),siteId:g.Rx().required(),accountId:g.Z_().required(),items:g.IX().of(g.Ry().shape({metalId:g.Z_().required(),qty:g.Rx().required().typeError().positive(),purity:g.Rx().required().typeError().positive(),sku:g.Z_().required(),creditAmount:g.Z_().required()})).required()}),onSubmit:async e=>{let t=ev(e),n=await X({extension:ei[ep.values.functionId],record:JSON.stringify(t)}),a=ey?K.Edited:K.Added;r.ZP.success(a),ej(null==n?void 0:n.recordId),eu()}}),ev=e=>{let{items:t,...n}=e;return{header:{...n,qty:(null==t?void 0:t.reduce((e,t)=>e+(Number(t.qty)||0),0))||0,pcs:(null==t?void 0:t.reduce((e,t)=>e+(Number(t.pcs)||0),0))||0},items:null==t?void 0:t.map(t=>({trxId:(null==e?void 0:e.recordId)||0,seqNo:t.id,metalId:t.metalId,itemId:t.itemId,qty:t.qty,pcs:t.pcs,creditAmount:t.creditAmount,purity:t.purity/1e3,totalCredit:t.totalCredit,trackBy:t.trackBy||0,baseSalesMetalValue:t.baseSalesMetalValue,qtyOnHand:(null==t?void 0:t.qtyOnHand)||0}))}},ey=!!(null===(S=ep.values)||void 0===S?void 0:S.recordId),eI=3===ep.values.status,ef=ep.values.isVerified,ex=e=>ep.values.items.reduce((t,n)=>t+(parseFloat(n[e])||0),0),eh=ex("qty"),eg=ex("pcs"),eF=ex("totalCredit"),eb=ex("metalValue");async function ew(e){if(!e||!B)return;let t=await Q({extension:y.H.MetalTrx.get,parameters:"_recordId=".concat(e,"&_functionId=").concat(B)});return{...null==t?void 0:t.record,date:(0,q.a1)(null==t?void 0:t.record.date)}}let eN=async()=>{let{items:e,...t}=ep.values;await X({extension:y.H.MetalTrx.post,record:JSON.stringify({...t,qty:eh,pcs:eg,creditAmount:eF})}),r.ZP.success(K.Posted),eu(),z.close()},eV=async()=>{let{items:e,...t}=ep.values,n=await X({extension:B===I.J.MetalReceiptVoucher?y.H.MetalReceiptVoucher.unpost:y.H.MetalPaymentVoucher.unpost,record:JSON.stringify({...t,qty:eh,pcs:eg,creditAmount:eF})});r.ZP.success(K.Unposted),ej(null==n?void 0:n.recordId),eu()};async function eA(e){if(e){var t,n;let a=await Q({extension:y.H.FIDocTypeDefaults.get,parameters:"_dtId=".concat(e)}),l=null===(t=a.record)||void 0===t?void 0:t.siteId,r=null===(n=a.record)||void 0===n?void 0:n.plantId;l&&r&&(ep.setFieldValue("siteId",l),ep.setFieldValue("plantId",r))}}function eq(e){el.current=e?en.filter(t=>t.metalId===e):[]}async function eP(){let e=await Q({extension:k.$.Scrap.qry,parameters:"_metalId=0"});ea(null==e?void 0:e.list)}async function ej(e,t){var n;let a=await ew(e),l=await Q({extension:y.H.MetalReceiptVoucher.qry,parameters:"_trxId=".concat(e,"&_functionId=").concat(B)}),r=await Promise.all(null==l?void 0:null===(n=l.list)||void 0===n?void 0:n.map(async(e,n)=>{let a=await eZ(e.itemId);return{...e,purity:1e3*e.purity,stdPurity:1e3*e.stdPurity,metalValue:(null==t?void 0:t.purity)||ee.purity?(e.qty*e.purity/((null==t?void 0:t.purity)||ee.purity)).toFixed(2):null,totalCredit:(null==e?void 0:e.totalCredit)||0,creditAmount:(null==e?void 0:e.creditAmount)||0,id:n+1,seqNo:n+1,isOpenMetalPurity:a}}));ep.setValues({...a,items:(null==r?void 0:r.length)>0?r:ep.values.items})}let eZ=async e=>{var t;let n=await Q({extension:k.$.Physical.get,parameters:"_itemId=".concat(e)});return null==n?void 0:null===(t=n.record)||void 0===t?void 0:t.isOpenMetalPurity},ek=[{component:"resourcecombobox",label:G.metal,name:"metalId",props:{endpointId:k.$.Metals.qry,valueField:"recordId",displayField:"reference",displayFieldWidth:1.5,mapping:[{from:"reference",to:"metalRef"},{from:"recordId",to:"metalId"},{from:"purity",to:"purity"},{from:"purity",to:"stdPurity"}]},propsReducer(e){let{row:t,props:n}=e;return{...n,readOnly:!!t.itemId}},onChange:async e=>{let{row:{update:t,newRow:n}}=e;eq(null==n?void 0:n.metalId),n.purity&&t({purity:1e3*n.purity,stdPurity:1e3*n.stdPurity,purityFromItem:!0})}},{component:"resourcecombobox",label:G.sku,name:"sku",props:{store:null==el?void 0:el.current,valueField:"itemId",displayField:"sku",mapping:[{from:"itemName",to:"itemName"},{from:"itemId",to:"itemId"},{from:"sku",to:"sku"},{from:"laborValuePerGram",to:"creditAmount"}],displayFieldWidth:2},propsReducer(e){let{row:t,props:n}=e;return{...n,store:null==el?void 0:el.current}},onChange:async e=>{var t,n;let{row:{update:a,newRow:l}}=e,r=l.purity||l.stdPurity,i=await eZ(null==l?void 0:l.itemId);if(!(null==l?void 0:l.itemId))return;let d=await Q({extension:k.$.Items.get,parameters:"_recordId=".concat(null==l?void 0:l.itemId)}),o=await Q({extension:k.$.Availability.get,parameters:"_siteId=".concat(null===(t=ep.values)||void 0===t?void 0:t.siteId,"&_itemId=").concat(null==l?void 0:l.itemId,"&_seqNo=0")});if(!r)return;let c=l.qty*l.creditAmount*(r/l.stdPurity);a({purity:r===l.stdPurity?r:1e3*r,totalCredit:c,trackBy:d.record.trackBy,purityFromItem:!0,qtyOnHand:(null==o?void 0:null===(n=o.record)||void 0===n?void 0:n.onhand)||0,isOpenMetalPurity:i})},flex:1.5},{component:"textfield",label:G.itemName,name:"itemName",props:{readOnly:!0},flex:3.5},{component:"numberfield",name:"pcs",label:G.pcs,props:{allowNegative:!1}},{component:"numberfield",name:"purity",label:G.purity,onChange:e=>{let{row:{update:t,newRow:n}}=e,a=n.qty*n.purity/(1e3*ee.purity);t({purityFromItem:!1}),t({baseSalesMetalValue:a,totalCredit:(n.purityFromItem?n.qty*n.creditAmount:n.qty*n.creditAmount*(n.purity/n.stdPurity)).toFixed(2)}),ee&&t({metalValue:a.toFixed(2)})},propsReducer(e){let{row:t,props:n}=e;return{...n,readOnly:!t.isOpenMetalPurity}}},{component:"numberfield",name:"qty",label:G.qty,props:{allowNegative:!1},onChange:e=>{let{row:{update:t,newRow:n}}=e;t({baseSalesMetalValue:n.qty*n.purity/(1e3*ee.purity),totalCredit:(n.purityFromItem?n.qty*n.creditAmount:n.qty*n.creditAmount*(n.purity/n.stdPurity)).toFixed(2)}),ee&&t({metalValue:(n.qty*n.purity/(1e3*ee.purity)).toFixed(2)})}},{component:"numberfield",name:"creditAmount",label:G.labor,defaultValue:0,props:{allowNegative:!1},onChange:e=>{let{row:{update:t,newRow:n}}=e;t({totalCredit:(n.purityFromItem?n.qty*n.creditAmount:n.qty*n.creditAmount*(n.purity/n.stdPurity)).toFixed(2)})}},{component:"numberfield",name:"totalCredit",label:G.totalLabor,props:{allowNegative:!1,readOnly:!0}},{component:"numberfield",name:"qtyOnHand",label:G.qtyOnHand,props:{readOnly:!0}}],eC=async()=>{await X({extension:y.H.MetalTrx.verify,record:JSON.stringify(ep.values)})&&(r.ZP.success(ef?K.Unverfied:K.Verified),eu(),z.close())},e_=async()=>{let e=ev(ep.values);await X({extension:y.H.ResetGL_MTX.reset,record:JSON.stringify(e)})},eR=[{key:"Locked",condition:eI,onClick:"onUnpostConfirmation",onSuccess:eV,disabled:!ey||ef},{key:"Unlocked",condition:!eI,onClick:eN,disabled:!ey},{key:"Aging",condition:!0,onClick:"onClickAging",disabled:!ey},{key:"GL",condition:!0,onClick:"onClickGL",datasetId:U(B),valuesPath:{...ep.values,notes:ep.values.description},onReset:e_,disabled:!ey},{key:"Verify",condition:!ef,onClick:eC,disabled:!eI},{key:"Unverify",condition:ef,onClick:eC,disabled:!eI},{key:"AccountSummary",condition:!0,onClick:()=>{er({Component:R.Z,props:{accountId:parseInt(ep.values.accountId),moduleId:1}})},disabled:!ep.values.accountId},{key:"IV",condition:!0,onClick:"onInventoryTransaction",disabled:!ey||!eI}];if(ee.reference){let e=ek.findIndex(e=>"qty"===e.name);-1!==e&&ek.splice(e+1,0,{component:"numberfield",label:ee.reference,name:"metalValue",props:{decimalScale:2,readOnly:!0}})}return(0,l.useEffect)(()=>{!async function(){var e;let t;await eP();let n=null==W?void 0:null===(e=W.list)||void 0===e?void 0:e.find(e=>"baseSalesMetalId"===e.key);if(parseInt(null==n?void 0:n.value)){let e=await Q({extension:k.$.Metals.get,parameters:"_recordId=".concat(parseInt(null==n?void 0:n.value))});et(e.record),t=e.record}$&&ej($,t)}()},[]),(0,l.useEffect)(()=>{var e;eA(null==ep?void 0:null===(e=ep.values)||void 0===e?void 0:e.dtId)},[ep.values.dtId]),(0,a.jsx)(F.Z,{resourceId:(e=>{switch(e){case I.J.MetalReceiptVoucher:return c.i.MetalReceiptVoucher;case I.J.MetalPaymentVoucher:return c.i.MetalPaymentVoucher;default:return}})(parseInt(ep.values.functionId)),form:ep,maxAccess:eo,actions:eR,previewReport:ey,editMode:ey,functionId:ep.values.functionId,disabledSubmit:eI,children:(0,a.jsxs)(u.R,{children:[(0,a.jsx)(s.g,{children:(0,a.jsxs)(h.ZP,{container:!0,spacing:2,children:[(0,a.jsx)(h.ZP,{item:!0,xs:4,children:(0,a.jsx)(V.Z,{endpointId:N.r.DocumentType.qry,parameters:"_startAt=0&_pageSize=1000&_dgId=".concat(B),filter:ey?void 0:e=>1===e.activeStatus,name:"dtId",label:G.docType,readOnly:ey,valueField:"recordId",displayField:"name",values:ep.values,required:!0,onChange:async(e,t)=>{ep.setFieldValue("dtId",(null==t?void 0:t.recordId)||null),ec(t)},error:ep.touched.dtId&&!!ep.errors.dtId,maxAccess:!ey&&eo})}),(0,a.jsx)(h.ZP,{item:!0,xs:4,children:(0,a.jsx)(V.Z,{endpointId:N.r.Plant.qry,name:"plantId",readOnly:ey,label:G.plant,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:ep.values,maxAccess:eo,onChange:(e,t)=>{ep.setFieldValue("plantId",null==t?void 0:t.recordId)},error:ep.touched.plantId&&!!ep.errors.plantId})}),(0,a.jsx)(h.ZP,{item:!0,xs:4,children:(0,a.jsx)(V.Z,{endpointId:(null===(O=ep.values)||void 0===O?void 0:O.accountId)&&y.H.Contact.qry,parameters:(null===(M=ep.values)||void 0===M?void 0:M.accountId)&&"_accountId=".concat(null===(D=ep.values)||void 0===D?void 0:D.accountId),name:"contactId",readOnly:eI,label:G.contact,valueField:"recordId",displayField:"name",columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:ep.values,maxAccess:eo,onChange:(e,t)=>{ep.setFieldValue("contactId",null==t?void 0:t.recordId)},error:ep.touched.contactId&&!!ep.errors.contactId})}),(0,a.jsx)(h.ZP,{item:!0,xs:3,children:(0,a.jsx)(b.Z,{name:"reference",label:G.reference,value:ep.values.reference,readOnly:ey||!ep.values.dtId,maxAccess:!ey&&eo,onChange:ep.handleChange,onClear:()=>ep.setFieldValue("reference",""),error:ep.touched.reference&&!!ep.errors.reference})}),(0,a.jsx)(h.ZP,{item:!0,xs:3,children:(0,a.jsx)(A.Z,{name:"date",required:!0,readOnly:eI,label:G.date,value:ep.values.date,onChange:ep.setFieldValue,maxAccess:eo,onClear:()=>ep.setFieldValue("date",""),error:ep.touched.date&&!!ep.errors.date})}),(0,a.jsx)(h.ZP,{item:!0,xs:3,children:(0,a.jsx)(V.Z,{endpointId:k.$.Site.qry,name:"siteId",label:G.site,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],valueField:"recordId",displayField:["reference","name"],values:ep.values,maxAccess:eo,readOnly:eI,onChange:(e,t)=>{ep.setFieldValue("siteId",(null==t?void 0:t.recordId)||null)},required:!0,error:ep.touched.siteId&&!!ep.errors.siteId})}),(0,a.jsx)(h.ZP,{item:!0,xs:3,children:(0,a.jsx)(V.Z,{endpointId:C.p.LoCollector.qry,name:"collectorId",label:G.collector,valueField:"recordId",displayField:"reference",values:ep.values,readOnly:eI,onChange:async(e,t)=>{ep.setFieldValue("collectorId",null==t?void 0:t.recordId)},error:ep.touched.collectorId&&!!ep.errors.collectorId,maxAccess:eo})}),(0,a.jsx)(h.ZP,{item:!0,xs:9,children:(0,a.jsx)(P.U,{endpointId:y.H.Account.snapshot,name:"accountId",label:G.accountRef,valueField:"reference",displayField:"name",valueShow:"accountRef",secondValueShow:"accountName",firstFieldWidth:4,required:!0,errorCheck:"accountId",form:ep,secondDisplayField:!0,firstValue:ep.values.accountRef,secondValue:ep.values.accountName,columnsInDropDown:[{key:"reference",value:"Account Ref"},{key:"name",value:"Name"},{key:"keywords",value:"Keywords"}],displayFieldWidth:3,maxAccess:eo,filter:{isInactive:e=>!0!==e},readOnly:eI,onChange:(e,t)=>{ep.setFieldValue("accountId",null==t?void 0:t.recordId),ep.setFieldValue("accountRef",null==t?void 0:t.reference),ep.setFieldValue("accountName",null==t?void 0:t.name),ep.setFieldValue("accountGroupName",null==t?void 0:t.groupName)}})}),(0,a.jsx)(h.ZP,{item:!0,xs:3,children:(0,a.jsx)(b.Z,{name:"accountGroupName",label:G.groupName,value:ep.values.accountGroupName,readOnly:!0,error:ep.touched.accountGroupName&&!!ep.errors.accountGroupName})})]})}),(0,a.jsx)(m.Q,{children:(0,a.jsx)(_._,{onChange:e=>ep.setFieldValue("items",e),value:null===(T=ep.values)||void 0===T?void 0:T.items,error:null===(H=ep.errors)||void 0===H?void 0:H.items,name:"items",columns:ek,initialValues:null==ep?void 0:null===(J=ep.initialValues)||void 0===J?void 0:null===(E=J.items)||void 0===E?void 0:E[0],maxAccess:eo,disabled:eI,allowDelete:!eI,onSelectionChange:(e,t,n)=>{"sku"==n&&eq(null==e?void 0:e.metalId)}})}),(0,a.jsx)(s.g,{children:(0,a.jsxs)(h.ZP,{container:!0,spacing:2,children:[(0,a.jsx)(h.ZP,{item:!0,xs:4,children:(0,a.jsxs)(h.ZP,{container:!0,spacing:2,children:[(0,a.jsx)(h.ZP,{item:!0,xs:12,children:(0,a.jsx)(V.Z,{neverPopulate:!0,endpointId:y.H.DescriptionTemplate.qry,name:"templateId",label:G.descriptionTemplate,valueField:"recordId",displayField:"name",readOnly:eI,values:ep.values,onChange:(e,t)=>{let n=ep.values.description||"";(null==t?void 0:t.name)&&ep.setFieldValue("description",""===n?t.name:"".concat(n,"\n").concat(t.name)),ep.setFieldValue("templateId",(null==t?void 0:t.recordId)||null)},error:ep.touched.templateId&&!!ep.errors.templateId,maxAccess:eo})}),(0,a.jsx)(h.ZP,{item:!0,xs:12,children:(0,a.jsx)(Z.Z,{name:"description",type:"text",label:G.description,value:ep.values.description,rows:3,readOnly:eI,maxAccess:eo,onChange:e=>ep.setFieldValue("description",e.target.value),onClear:()=>ep.setFieldValue("description","")})})]})}),(0,a.jsx)(h.ZP,{item:!0,xs:4,children:(0,a.jsxs)(h.ZP,{container:!0,spacing:2,children:[(0,a.jsx)(h.ZP,{item:!0,xs:12,children:(0,a.jsx)(j.Z,{label:G.totalPcs,value:eg,decimalScale:2,readOnly:!0})}),(0,a.jsx)(h.ZP,{item:!0,xs:12}),(0,a.jsx)(h.ZP,{item:!0,xs:12}),(0,a.jsx)(h.ZP,{item:!0,xs:12}),(0,a.jsx)(h.ZP,{item:!0,xs:12}),(0,a.jsx)(h.ZP,{item:!0,xs:12}),(0,a.jsx)(h.ZP,{item:!0,xs:12,children:(0,a.jsx)(V.Z,{endpointId:y.H.PaymentReasons.qry,name:"paymentReasonId",label:G.paymentReason,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],readOnly:eI,values:ep.values,onChange:(e,t)=>{ep.setFieldValue("paymentReasonId",(null==t?void 0:t.recordId)||null)},error:ep.touched.paymentReasonId&&!!ep.errors.paymentReasonId,maxAccess:eo})})]})}),(0,a.jsx)(h.ZP,{item:!0,xs:4,children:(0,a.jsxs)(h.ZP,{container:!0,spacing:2,children:[(0,a.jsx)(h.ZP,{item:!0,xs:12,children:(0,a.jsx)(j.Z,{label:G.totalQty,value:eh,decimalScale:2,readOnly:!0})}),(0,a.jsx)(h.ZP,{item:!0,xs:12,children:(0,a.jsx)(j.Z,{label:G.totalLabor,value:eF,decimalScale:2,readOnly:!0})}),(null==ee?void 0:ee.reference)&&(0,a.jsx)(h.ZP,{item:!0,xs:12,children:(0,a.jsx)(j.Z,{label:"".concat(G.total," ").concat(ee.reference),value:eb,decimalScale:2,readOnly:!0})})]})})]})})]})})}var O=n(63165);function M(){let{getRequest:e,postRequest:t}=(0,l.useContext)(d.$),{platformLabels:n}=(0,l.useContext)(f.l),{stack:h}=(0,p.zY)(),{functionId:g}=(0,O.F)();async function F(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{_startAt:n=0,_pageSize:a=50,params:l=[]}=t;return{...await e({extension:y.H.MetalTrx.page,parameters:"_startAt=".concat(n,"&_params=").concat(l,"&_pageSize=").concat(a,"&_sortBy=reference&_functionId=").concat(g)}),_startAt:n}}let b=e=>{switch(Number(e)){case I.J.MetalReceiptVoucher:return c.i.GLMetalReceiptVoucher;case I.J.MetalPaymentVoucher:return c.i.GLMetalPaymentVoucher;default:return null}},{query:{data:w},refetch:N,labels:V,filterBy:A,paginationParameters:q,access:P,invalidate:j}=(0,o.J)({queryFn:F,endpointId:y.H.MetalTrx.page,datasetId:c.i.MetalReceiptVoucher,DatasetIdAccess:(e=>{switch(e){case I.J.MetalReceiptVoucher:return c.i.MetalReceiptVoucher;case I.J.MetalPaymentVoucher:return c.i.MetalPaymentVoucher;default:return null}})(parseInt(g)),filter:{filterFn:Z,default:{functionId:g}}});async function Z(t){let{filters:n,pagination:a}=t;return(null==n?void 0:n.qry)?await e({extension:y.H.MetalTrx.snapshot,parameters:"_filter=".concat(n.qry,"&_functionId=").concat(g)}):F({_startAt:a._startAt||0,params:null==n?void 0:n.params})}let k=[{field:"reference",headerName:V.reference,flex:1},{field:"dtName",headerName:V.docType,flex:1},{field:"date",headerName:V.date,flex:1,type:"date"},{field:"plantName",headerName:V.plant,flex:1},{field:"siteRef",headerName:V.siteRef,flex:1},{field:"siteName",headerName:V.siteName,flex:1},{field:"accountRef",headerName:V.accountRef,flex:1},{field:"accountName",headerName:V.accountName,flex:1},{field:"pcs",headerName:V.pcs,flex:1,type:"number"},{field:"qty",headerName:V.qty,flex:1,type:"number"},{field:"creditAmount",headerName:V.creditAmount,flex:1,type:"number"},{field:"isVerified",headerName:V.isVerified,type:"checkbox",flex:1},{field:"statusName",headerName:V.status,flex:1}],C=e=>e===I.J.MetalReceiptVoucher?V.metalReceipt:e===I.J.MetalPaymentVoucher?V.metalPayment:null;function _(e){h({Component:S,props:{labels:V,recordId:e,access:P,functionId:g,getGLResourceId:b},width:1100,height:670,title:C(parseInt(g))})}let{proxyAction:R}=(0,v.G)({functionId:g,action:_}),M=async()=>{await R()},D=async e=>{await t({extension:y.H.MetalTrx.del,record:JSON.stringify(e)}),j(),r.ZP.success(n.Deleted)};return(0,a.jsxs)(u.R,{children:[(0,a.jsx)(s.g,{children:(0,a.jsx)(x.Z,{onAdd:M,maxAccess:P,reportName:"FIMTX",filterBy:A})}),(0,a.jsx)(m.Q,{children:(0,a.jsx)(i.Z,{columns:k,gridData:w,rowId:["recordId"],onEdit:e=>{_(null==e?void 0:e.recordId)},onDelete:D,deleteConfirmationType:"strict",isLoading:!1,pageSize:50,paginationParameters:q,refetch:N,paginationType:"api",maxAccess:P})})]})}},93736:function(e,t,n){"use strict";n.d(t,{K:function(){return l}});let a="RG.FI.asmx/",l={FiOpeningBalance:{gen:a+"genOBA"},FiAging:{qry:a+"FI404"},AccountSummary:{AccFI405b:a+"FI405b"},DocumentAging:{AgingFI406a:a+"FI406a",AgingFI406b:a+"FI406b"},TrialBalance:{FI402View:a+"FI402o",FI401o2:a+"FI401o2"}}},63165:function(e,t,n){"use strict";n.d(t,{F:function(){return r}});var a=n(5632),l=n(2784);let r=()=>{let e=(0,a.useRouter)(),[t,n]=(0,l.useState)(e.query);return t}},1685:function(e,t,n){"use strict";n.d(t,{m:function(){return a}});let a=e=>{let t=window.sessionStorage.getItem(e);return t?JSON.parse(t):null}},98345:function(e,t,n){"use strict";n.d(t,{H:function(){return y},G:function(){return v}});var a=n(45300),l=n(2784),r=n(96026),i=n(38449);n(26612);var d=n(65947),o=n(1685);let c=async(e,t,n)=>{try{let a=await e({extension:t,parameters:n});return t.includes("qry")?a:a.record}catch(e){return null}},u=(e,t,n,a)=>{let l=(e=JSON.parse(JSON.stringify(e))).record.controls,r=l.find(e=>"reference"===e.controlId);return r?r.accessLevel=(null==t?void 0:t.mandatory)?d.$7:d.rr:(null==t?void 0:t.mandatory)?l.push({sgId:0,resourceId:"",controlId:"".concat(a?a+".":"","reference"),accessLevel:(null==t?void 0:t.mandatory)?d.$7:d.rr}):(null==t?void 0:t.readOnly)?l.push({sgId:0,resourceId:"",controlId:"".concat(a?a+".":"","reference"),accessLevel:(null==t?void 0:t.readOnly)?d.rr:d.$7}):l=e.record.controls.filter(e=>"reference"!=e.controlId),n&&l.push({sgId:0,resourceId:"",controlId:"".concat(a?a+".":"","dtId"),accessLevel:d.$7}),{...e,record:{...e.record,controls:l}}},s=async(e,t,n)=>{let a,l;switch(n){case"dtId":let r=(0,o.m)("userData"),d=null==r?void 0:r.userId;l="_userId=".concat(d,"&_functionId=").concat(t),a=i.r.UserFunction.get;break;case"glbSysNumberRange":l="_recordId=".concat(t),a=i.r.SystemFunction.get;break;case"DocumentType":l="_dgId=".concat(t,"&_startAt=",0,"&_pageSize=",50),a=i.r.DocumentType.qry;break;case"DcTypNumberRange":l="_recordId=".concat(t),a=i.r.DocumentType.get;break;case"isExternal":l="_recordId=".concat(t),a=i.r.NumberRange.get;break;default:return null}return await c(e,a,l)},m=async function(e){let t,n,a,l,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,o=!(arguments.length>4)||void 0===arguments[4]||arguments[4],c=arguments.length>5?arguments[5]:void 0,m=void 0===d&&r&&await s(e,r,"dtId"),p=null==m?void 0:m.dtId,v="",y=!0;if(m&&void 0===d||"nraId"===d){if(p){let n=await s(e,p,"DcTypNumberRange");t=null==n?void 0:n.nraId,y=!((null==n?void 0:n.activeStatus)<0),t||(v="Assign the document type to a number range")}if((!p||!y)&&o&&r){var I;let t=await s(e,r,"DocumentType");l=(null==t?void 0:null===(I=t.list)||void 0===I?void 0:I.filter(e=>(null==e?void 0:e.activeStatus)===1).length)>0}}if(("nraId"===d||void 0===d)&&r){if((!p||p)&&!t||t&&!y){let n=await s(e,r,"glbSysNumberRange");(t=null==n?void 0:n.nraId)&&l&&(l=!1),y=!0}v=t||l?"":"Assign the system Function to a number range"}d>0&&!t&&(t=d),t&&y?(n={readOnly:null==(a=await s(e,t,"isExternal"))||!a.external,mandatory:null!=a&&!!a.external},i&&(i=await u(i,n,l,c))):!t&&i&&(i=await u(i,n,l,c));let f=c?"".concat(c,".reference"):"reference";return{dtId:p,resetReference:null==n?void 0:n.readOnly,dcTypeRequired:l,reference:{fieldName:f,isEmpty:(null==a?void 0:a.external)!==void 0&&(null==a||!a.external)},errorMessage:v,maxAccess:i,selectNraId:d}};var p=n(65950);function v(e){let{functionId:t,action:n,hasDT:a}=e,{getRequest:i}=(0,l.useContext)(p.$),{stack:d}=(0,r.V)();return{proxyAction:async()=>{let e=await m(i,t,"",void 0,a);(null==e?void 0:e.errorMessage)?d({message:null==e?void 0:e.errorMessage}):await n()}}}function y(e){var t;let{functionId:n,access:i,hasDT:d,enabled:o=!0,objectName:c=""}=e,{getRequest:u}=(0,l.useContext)(p.$),{stack:s}=(0,r.V)(),[v,y]=(0,l.useState)(),I=async e=>{let t=await m(u,n,i,e,d,c);if(!t.errorMessage)return t;s({message:null==t?void 0:t.errorMessage})},f=(0,a.a)({retry:!1,staleTime:0,enabled:o,queryKey:[n,v,!!i,o],queryFn:v||"nraId"===v?()=>I(v):()=>I()});return{documentType:f.data,maxAccess:(null==f?void 0:null===(t=f.data)||void 0===t?void 0:t.maxAccess)||i,changeDT(e){y((null==e?void 0:e.nraId)||"nraId")}}}},16463:function(e,t,n){"use strict";n.d(t,{Z:function(){return w}});var a=n(52322),l=n(2784),r=n(49864),i=n(65950),d=n(27423),o=n(26612),c=n(71987),u=n(33625),s=n(62362),m=n(31389),p=n(8661),v=n(25870),y=n(69627),I=n(84100),f=n(19473),x=n(80983),h=n(38449),g=n(69387),F=n(93736),b=n(21326);function w(e){let{accountId:t,moduleId:n,window:w}=e,{getRequest:N}=(0,l.useContext)(i.$),{platformLabels:V}=(0,l.useContext)(f.l),[A,q]=(0,l.useState)([]);(0,b.Z)({title:V.AccountSummary,window:w});let{labels:P,access:j}=(0,c.J)({datasetId:o.i.AccountSummary}),Z=[{field:"days",headerName:P.days,flex:1,type:"number"}],[k,C]=(0,l.useState)(Z),{formik:_}=(0,x.c)({maxAccess:j,initialValues:{accountId:null,accountRef:"",accountName:"",agpId:null,moduleId:n}});async function R(){var e,t,a,l;let r;let i=2,d=[...Z],o=await N({extension:h.r.Currency.qry,parameters:"_filter="});if(1==n?r=null==o?void 0:null===(e=o.list)||void 0===e?void 0:e.filter(e=>e.sale):2==n&&(r=null==o?void 0:null===(t=o.list)||void 0===t?void 0:t.filter(e=>e.purchase)),0==r.length)return;null==r||r.forEach((e,t)=>{d.push({field:"column".concat(t+1),headerName:e.reference,flex:1,type:"number"})}),C(d);let c=await N({extension:v.H.AgingLeg.qry,parameters:"_agpId=".concat(_.values.agpId)}),u=null==c?void 0:null===(a=c.list)||void 0===a?void 0:a.map(e=>{let t=Array(r.length+2).fill(0);return t[0]=null,t[1]=e.days,t}),s=(r||[]).map(e=>N({extension:F.K.AccountSummary.AccFI405b,parameters:"_agpId=".concat(_.values.agpId,"&_currencyId=").concat(e.recordId,"&_accountId=").concat(_.values.accountId)}).then(e=>({summaryRes:e})));(await Promise.all(s)).forEach(e=>{var t;let{summaryRes:n}=e;null==n||null===(t=n.list)||void 0===t||t.forEach(e=>{null==u||u.forEach(t=>{t[1]==e.seqDays&&(t[i]=e.amount)})}),i++});let m=Array(r.length+2).fill(null);for(let e=2;e<r.length+2;e++){let t=0;null==u||u.map(n=>{t+=Number(n[e]||0)}),m[e]=t}let p=u.filter(e=>null!==e[1]).map(e=>{let[t,n,...a]=e,l={days:n};return a.forEach((e,t)=>{l["column".concat(t+1)]=e.toFixed(2)}),l}),y={};for(let e=0;e<r.length;e++)y["column".concat(e+1)]=null!==(l=m[e+2].toFixed(2))&&void 0!==l?l:0;p.push(y),q({list:p})}return(0,l.useEffect)(()=>{!async function(){if(t&&n){var e,a,l;let n=await N({extension:v.H.Account.get,parameters:"_recordId=".concat(t)});_.setFieldValue("accountId",null==n?void 0:null===(e=n.record)||void 0===e?void 0:e.recordId),_.setFieldValue("accountRef",null==n?void 0:null===(a=n.record)||void 0===a?void 0:a.reference),_.setFieldValue("accountName",null==n?void 0:null===(l=n.record)||void 0===l?void 0:l.name)}}()},[]),(0,a.jsxs)(m.R,{children:[(0,a.jsx)(u.g,{children:(0,a.jsxs)(r.Z,{container:!0,spacing:2,p:2,children:[(0,a.jsx)(r.Z,{item:!0,xs:12,children:(0,a.jsx)(d.U,{endpointId:v.H.Account.snapshot,name:"accountId",label:P.account,valueField:"reference",displayField:"name",valueShow:"accountRef",secondValueShow:"accountName",form:_,readOnly:_.values.accountId&&_.values.moduleId,required:!0,maxAccess:j,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],onChange:async(e,t)=>{_.setFieldValue("accountId",(null==t?void 0:t.recordId)||null),_.setFieldValue("accountName",(null==t?void 0:t.name)||""),_.setFieldValue("accountRef",(null==t?void 0:t.reference)||"")}})}),(0,a.jsx)(r.Z,{item:!0,xs:6,children:(0,a.jsx)(p.Z,{endpointId:v.H.AgingProfile.qry,parameters:"_startAt=0&_pageSize=1000&filter=",name:"agpId",label:P.agingProfile,values:_.values,valueField:"recordId",displayField:"name",maxAccess:j,required:!0,onChange:(e,t)=>{_.setFieldValue("agpId",(null==t?void 0:t.recordId)||null),(null==t?void 0:t.recordId)||q({list:[]})}})}),(0,a.jsx)(r.Z,{item:!0,xs:5,children:(0,a.jsx)(p.Z,{datasetId:I.v.FI_AGING_MODULE,label:P.module,name:"moduleId",values:_.values,valueField:"key",displayField:"value",maxAccess:j,required:!0,readOnly:_.values.moduleId,onChange:(e,t)=>{_.setFieldValue("moduleId",(null==t?void 0:t.key)||null)}})}),(0,a.jsx)(r.Z,{item:!0,xs:1,children:(0,a.jsx)(y.Z,{onClick:R,image:"preview.png",disabled:!_.values.agpId||!_.values.moduleId||!_.values.accountId,tooltipText:V.Preview})})]})}),(0,a.jsx)(s.Q,{children:(0,a.jsx)(g.Z,{columns:k,gridData:A,isLoading:!1,pagination:!1})})]})}w.width=1e3,w.height=500}},function(e){e.O(0,[92515,2494,36908,49774,92888,40179],function(){return e(e.s=4828)}),_N_E=e.O()}]);