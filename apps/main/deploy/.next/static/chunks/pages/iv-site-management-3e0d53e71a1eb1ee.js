(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[12090],{3711:function(e,a,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/iv-site-management",function(){return n(11861)}])},11861:function(e,a,n){"use strict";n.r(a),n.d(a,{default:function(){return R}});var r=n(52322),l=n(2784),t=n(69387),i=n(65950),s=n(61802),o=n(71987),m=n(26612),d=n(31389),c=n(33625),u=n(62362),h=n(65215),x=n(60218),p=n(48601),v=n(82737),f=n(62202),g=n(80983),y=n(8661),b=n(19473),N=n(19689),I=n(91406),q=n(58912),C=n(5088),j=n(76399);function _(e){var a;let{labels:n,maxAccess:t,record:s}=e,{platformLabels:c}=(0,l.useContext)(b.l),{recordId:_,name:Z,sku:R}=s,{getRequest:S,postRequest:A}=(0,l.useContext)(i.$),F=(0,o.E)({endpointId:h.$.Items.page}),{formik:k}=(0,g.c)({initialValues:{itemId:_,recordId:_,itemName:"",sku:"",min:null,purchaseRequestFactor:"",amcShortTerm:"",max:"",amcLongTerm:"",replenishmentGroupId:"",manageByWH:!1,items:[]},maxAccess:t,validateOnChange:!0,validationSchema:p.Ry({min:p.Rx().required().test(function(e){let{max:a}=this.parent;return!!(null==a||isNaN(a))||e<=a}),max:p.Rx().required().test(function(e){let{min:a}=this.parent;return!!(null==a||isNaN(a))||e>=a}),purchaseRequestFactor:p.Rx().nullable().max(99),items:p.IX().of(p.Ry().shape({siteMin:p.Rx().required().test(function(e){let{siteMax:a}=this.parent;return e<=a}),siteMax:p.Rx().required().test(function(e){let{siteMin:a}=this.parent;return e>=a})})).required()}),onSubmit:async e=>{var a;let{items:n,itemName:r,sku:l,...t}=e,i=null==k?void 0:null===(a=k.values)||void 0===a?void 0:a.items.map((e,a)=>({...e,seqNo:a+1}));w((await A({extension:h.$.Management.set2,record:JSON.stringify({header:t,items:i})})).recordId),f.ZP.success(c.Updated),F()}}),T=!!k.values.recordId;async function w(e){if(e){var a,n,r,l,t,i,s,o,m,d,c,u,x,p,v,f;let g=await S({extension:h.$.Management.get,parameters:"_itemId=".concat(e)}),y=await S({extension:h.$.SManagement.qry,parameters:"_itemId=".concat(e)});k.setValues({...g.record,recordId:null==g?void 0:null===(a=g.record)||void 0===a?void 0:a.itemId,sku:null!==(d=null==g?void 0:null===(n=g.record)||void 0===n?void 0:n.sku)&&void 0!==d?d:R,itemId:null!==(c=null==g?void 0:null===(r=g.record)||void 0===r?void 0:r.itemId)&&void 0!==c?c:e,manageByWH:null!==(u=null==g?void 0:null===(l=g.record)||void 0===l?void 0:l.manageByWH)&&void 0!==u&&u,required:null!==(x=null==g?void 0:null===(t=g.record)||void 0===t?void 0:t.required)&&void 0!==x?x:0,itemName:null!==(p=null==g?void 0:null===(i=g.record)||void 0===i?void 0:i.itemName)&&void 0!==p?p:Z,min:null!==(v=null==g?void 0:null===(s=g.record)||void 0===s?void 0:s.min)&&void 0!==v?v:null,max:null!==(f=null==g?void 0:null===(o=g.record)||void 0===o?void 0:o.max)&&void 0!==f?f:null,items:null==y?void 0:null===(m=y.list)||void 0===m?void 0:m.map((e,a)=>({...e,id:a+1}))})}}(0,l.useEffect)(()=>{w(_)},[]);let L=[{component:"textfield",label:n.reference,name:"siteRef",props:{readOnly:!0}},{component:"textfield",label:n.name,name:"siteName",props:{readOnly:!0}},{component:"checkbox",label:n.locked,name:"isLocked",props:{disabled:!k.values.manageByWH}},{component:"numberfield",name:"firstBinLocation",label:n.bin,props:{readOnly:!0}},{component:"numberfield",name:"onhand",label:n.onhand,props:{readOnly:!0}},{component:"numberfield",name:"committed",label:n.committed,props:{readOnly:!0}},{component:"numberfield",name:"ordered",label:n.ordered,props:{readOnly:!0}},{component:"numberfield",name:"siteMin",label:n.min},{component:"numberfield",name:"siteMax",label:n.max},{component:"numberfield",name:"siteRequired",label:n.required}];return(0,r.jsx)(v.Z,{resourceId:m.i.SManagement,form:k,maxAccess:t,editMode:T,isCleared:!1,actions:[{key:"RecordRemarks",condition:!0,onClick:"onRecordRemarks",disabled:!T}],children:(0,r.jsxs)(d.R,{children:[(0,r.jsxs)(x.ZP,{container:!0,spacing:2,children:[(0,r.jsx)(x.ZP,{item:!0,xs:4,children:(0,r.jsx)(C.Z,{name:"itemName",label:n.itemName,value:k.values.itemName,readOnly:!0,maxAccess:t})}),(0,r.jsx)(x.ZP,{item:!0,xs:4,children:(0,r.jsx)(I.Z,{name:"min",required:!0,label:n.min,value:k.values.min,maxAccess:t,maxLength:11,decimalScale:2,onChange:k.handleChange,onClear:()=>k.setFieldValue("min",""),error:k.touched.min&&!!k.errors.min})}),(0,r.jsx)(x.ZP,{item:!0,xs:4,children:(0,r.jsx)(I.Z,{name:"purchaseRequestFactor",label:n.purchaseRequestFactor,value:k.values.purchaseRequestFactor,maxAccess:t,maxLength:4,decimalScale:2,onChange:k.handleChange,onClear:()=>k.setFieldValue("purchaseRequestFactor",0),error:k.touched.purchaseRequestFactor&&!!k.errors.purchaseRequestFactor})}),(0,r.jsx)(x.ZP,{item:!0,xs:4,children:(0,r.jsx)(C.Z,{name:"reference",label:n.reference,value:k.values.sku,readOnly:!0,maxAccess:t})}),(0,r.jsx)(x.ZP,{item:!0,xs:4,children:(0,r.jsx)(I.Z,{name:"max",label:n.max,value:k.values.max,required:!0,maxLength:11,decimalScale:2,maxAccess:t,onChange:k.handleChange,onClear:()=>k.setFieldValue("max",""),error:k.touched.max&&!!k.errors.max})}),(0,r.jsx)(x.ZP,{item:!0,xs:4,children:(0,r.jsx)(I.Z,{name:"amcShortTerm",label:n.amcShortTerm,value:k.values.amcShortTerm,maxAccess:t,maxLength:11,decimalScale:2,onChange:k.handleChange,onClear:()=>k.setFieldValue("amcShortTerm",0),error:k.touched.amcShortTerm&&!!k.errors.amcShortTerm})}),(0,r.jsx)(x.ZP,{item:!0,xs:4,children:(0,r.jsx)(N.Z,{name:"manageByWH",value:null===(a=k.values)||void 0===a?void 0:a.manageByWH,onChange:e=>k.setFieldValue("manageByWH",e.target.checked),label:n.manageByWH,maxAccess:t})}),(0,r.jsx)(x.ZP,{item:!0,xs:4,children:(0,r.jsx)(I.Z,{name:"required",label:n.required,value:k.values.required,maxAccess:t,maxLength:11,decimalScale:2,onChange:k.handleChange,onClear:()=>k.setFieldValue("required",0),error:k.touched.required&&!!k.errors.required})}),(0,r.jsx)(x.ZP,{item:!0,xs:4,children:(0,r.jsx)(I.Z,{name:"amcLongTerm",label:n.amcLongTerm,value:k.values.amcLongTerm,maxAccess:t,maxLength:11,decimalScale:2,onChange:k.handleChange,onClear:()=>k.setFieldValue("amcLongTerm",0),error:k.touched.amcLongTerm&&!!k.errors.amcLongTerm})}),(0,r.jsx)(x.ZP,{item:!0,xs:4,children:(0,r.jsx)(y.Z,{endpointId:q.I.ReplenishmentGroups.qry,name:"replenishmentGroupId",label:n.replenishmentGroup,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Ref"},{key:"name",value:"Name"}],values:k.values,maxAccess:t,onChange:(e,a)=>{k.setFieldValue("replenishmentGroupId",null==a?void 0:a.recordId)},error:k.touched.replenishmentGroupId&&!!k.errors.replenishmentGroupId})})]}),(0,r.jsx)(u.Q,{children:(0,r.jsx)(j._,{onChange:e=>k.setFieldValue("items",e),value:k.values.items,error:k.errors.items,columns:L,name:"items",initialValues:k.initialValues.items[0],allowDelete:!1,allowAddNewLine:!1,maxAccess:t,disabled:!k.values.manageByWH})})]})})}var Z=n(36908),R=()=>{let{getRequest:e,postRequest:a}=(0,l.useContext)(i.$),{platformLabels:n}=(0,l.useContext)(b.l),{stack:x}=(0,s.zY)();async function p(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{_startAt:n=0,_pageSize:r=50,params:l=[]}=a;return{...await e({extension:h.$.Items.page,parameters:"_startAt=".concat(n,"&_pageSize=").concat(r,"&_filter=&_sortField=sku&_params=").concat(l)}),_startAt:n}}let{query:{data:v},labels:g,paginationParameters:y,filterBy:N,refetch:I,access:q}=(0,o.J)({queryFn:p,endpointId:h.$.Items.page,datasetId:m.i.SManagement,filter:{filterFn:C}});async function C(a){let{filters:n,pagination:r={}}=a,{_startAt:l=0,_size:t=50}=r;return n.qry?{...await e({extension:h.$.Items.snapshot,parameters:"_filter=".concat(n.qry,"&_startAt=").concat(l,"&_size=").concat(t)}),_startAt:l}:p({_startAt:r._startAt||0,params:null==n?void 0:n.params})}let j=[{field:"sku",headerName:g.sku,flex:1},{field:"name",headerName:g.name,flex:1},{field:"flName",headerName:g.foreignName,flex:1},{field:"description",headerName:g.description,flex:1},{field:"categoryName",headerName:g.category,flex:1},{field:"msName",headerName:g.measurement,flex:1},{field:"ptName",headerName:g.priceType,flex:1},{field:"volume",headerName:g.volume,flex:1,type:"number"}],R=async e=>{await a({extension:h.$.Management.del,record:JSON.stringify({itemId:e.recordId})}),f.ZP.success(n.Deleted)};return(0,r.jsxs)(d.R,{children:[(0,r.jsx)(c.g,{children:(0,r.jsx)(Z.Z,{labels:g,maxAccess:q,reportName:"IVIT",filterBy:N})}),(0,r.jsx)(u.Q,{children:(0,r.jsx)(t.Z,{name:"table",columns:j,gridData:v,rowId:["recordId"],onEdit:e=>{x({Component:_,props:{labels:g,record:e,maxAccess:q},width:1200,height:700,title:g.SiteManagement})},onDelete:R,pageSize:50,refetch:I,paginationType:"api",paginationParameters:y,maxAccess:q})})]})}}},function(e){e.O(0,[92515,2494,36908,49774,92888,40179],function(){return e(e.s=3711)}),_N_E=e.O()}]);