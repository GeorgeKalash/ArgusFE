(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[58597],{90895:function(e,a,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/mf-batch-worksheet",function(){return r(72391)}])},72391:function(e,a,r){"use strict";r.r(a),r.d(a,{default:function(){return A}});var t=r(52322),l=r(2784),n=r(62202),o=r(69387),d=r(65950),i=r(26612),s=r(31389),c=r(71987),u=r(61802),v=r(33625),h=r(62362),m=r(19473),b=r(36908),p=r(7121),f=r(98345),x=r(90587),y=r(29326),I=r(9522),k=r(60218),g=r(48601),w=r(82737),j=r(5088),_=r(8661),C=r(38449),W=r(76399),S=r(89330),Z=r(65215),N=r(91406),O=r(39812),R=r(67920),F=r(80983);function T(e){var a,r,o,u,b,y,I,T,P,q,A,D,J,M,B,V,E,L,z,$,Q,X,Y,K,U,G,H,ee,ea,er,et,el,en,eo;let{labels:ed,access:ei,store:es,setStore:ec,window:eu}=e,{recordId:ev}=es,{platformLabels:eh}=(0,l.useContext)(m.l),{getRequest:em,postRequest:eb}=(0,l.useContext)(d.$),ep=(0,c.E)({endpointId:x.u.BatchWorksheet.page}),{maxAccess:ef,documentType:ex,changeDT:ey}=(0,f.H)({functionId:p.J.BatchWorksheet,access:ei,enabled:!ev,objectName:"header"}),{schema:eI,requiredFields:ek}=(0,R.m)({jobId:e=>null==e?void 0:e.jobId,qtyOut:e=>(null==e?void 0:e.qtyOut)!=null},!0,ef,"batchWorksheetJobs"),{schema:eg,requiredFields:ew}=(0,R.m)({rawMaterialId:e=>null==e?void 0:e.sku,returned:e=>(null==e?void 0:e.returned)!=null,issued:e=>(null==e?void 0:e.issued)!=null},!0,ef,"batchWSRM"),{formik:ej}=(0,F.c)({maxAccess:ef,documentType:{key:"header.dtId",value:null==ex?void 0:ex.dtId},conditionSchema:["batchWorksheetJobs","batchWSRM"],initialValues:{recordId:null,header:{recordId:null,reference:"",workCenterId:null,operationId:null,laborId:null,date:new Date,dtId:null,status:1,wip:1},batchWorksheetJobs:[{id:1}],batchWSRM:[{id:1}]},validationSchema:g.Ry({header:g.Ry({date:g.hT().required(),workCenterId:g.Rx().required(),operationId:g.Rx().required(),laborId:g.Rx().required()}),batchWorksheetJobs:g.IX().of(eI),batchWSRM:g.IX().of(eg)}),onSubmit:async e=>{eS((await eb({extension:x.u.BatchWorksheet.set2,record:JSON.stringify({header:{...e.header,date:(0,O.ku)(e.header.date)},batchWorksheetJobs:e.batchWorksheetJobs.filter(e=>{var a;return null===(a=Object.values(ek))||void 0===a?void 0:a.every(a=>a(e))}).map((e,a)=>{let{id:r,...t}=e;return{...t,seqNo:a+1}}),batchWorksheetRawMaterials:e.batchWSRM.filter(e=>{var a;return null===(a=Object.values(ew))||void 0===a?void 0:a.every(a=>a(e))}).map((e,a)=>{let{id:r,...t}=e;return{...t,seqNo:a+1}})})})).recordId),n.ZP.success(e.recordId?eh.Edited:eh.Added),ep()}}),e_=!!ej.values.recordId,eC=2==ej.values.header.wip,eW=(null==ej?void 0:null===(r=ej.values)||void 0===r?void 0:null===(a=r.header)||void 0===a?void 0:a.status)===3;async function eS(e){if(e){var a,r,t,l,n,o,d,i,s,c;let u=await em({extension:x.u.BatchWorksheet.get2,parameters:"_recordId=".concat(e)});ej.setValues({recordId:u.record.header.recordId,header:{...u.record.header,date:(0,O.a1)(u.record.header.date)},batchWorksheetJobs:(null===(r=u.record)||void 0===r?void 0:null===(a=r.batchWorksheetJobs)||void 0===a?void 0:a.length)>0?null===(l=u.record)||void 0===l?void 0:null===(t=l.batchWorksheetJobs)||void 0===t?void 0:t.map((e,a)=>({...e,id:a+1})):null===(n=ej.initialValues)||void 0===n?void 0:n.batchWorksheetJobs,batchWSRM:(null===(o=u.record)||void 0===o?void 0:o.batchWorksheetRawMaterials.length)?null===(i=u.record)||void 0===i?void 0:null===(d=i.batchWorksheetRawMaterials)||void 0===d?void 0:d.map((e,a)=>({...e,id:a+1})):null===(s=ej.initialValues)||void 0===s?void 0:s.batchWSRM}),ec({recordId:u.record.header.recordId,batchWorksheetDistributions:null===(c=u.record)||void 0===c?void 0:c.batchWorksheetDistributions})}}(0,l.useEffect)(()=>{eS(ev)},[]);let eZ=[{component:"resourcelookup",label:ed.rawMaterials,name:"rawMaterialId",props:{endpointId:Z.$.RMSKU.snapshot,displayField:"sku",valueField:"sku",columnsInDropDown:[{key:"sku",value:"Sku"},{key:"name",value:"Name"}],mapping:[{from:"recordId",to:"rawMaterialId"},{from:"name",to:"itemName"},{from:"sku",to:"sku"}],displayFieldWidth:3},async onChange(e){let{row:{update:a,newRow:r}}=e;a({rate:r.rate||0})}},{component:"numberfield",label:ed.issued,name:"issued",props:{decimalScale:3},async onChange(e){let{row:{update:a,newRow:r}}=e;a({netVariation:(r.issued||0)-(r.returned||0)})}},{component:"numberfield",label:ed.returned,name:"returned",props:{decimalScale:3},async onChange(e){let{row:{update:a,newRow:r}}=e;a({netVariation:(r.issued||0)-(r.returned||0)})}},{component:"numberfield",label:ed.net,name:"netVariation",props:{decimalScale:3,readOnly:!0}}],eN=[{component:"resourcelookup",label:ed.job,name:"jobId",flex:1,props:{endpointId:x.u.MFJobOrder.snapshot2,parameters:{_workCenterId:null===(u=ej.values)||void 0===u?void 0:null===(o=u.header)||void 0===o?void 0:o.workCenterId},displayField:"jobRef",valueField:"jobRef",mapping:[{from:"jobId",to:"jobId"},{from:"jobRef",to:"jobRef"},{from:"pcs",to:"pcs"},{from:"qty",to:"qty"}],displayFieldWidth:4}},{component:"numberfield",label:ed.qty,name:"qty",props:{readOnly:!0}},{component:"numberfield",label:ed.pcs,name:"pcs",props:{readOnly:!0}},{component:"numberfield",label:ed.pctOfBatch,name:"pctOfBatch",props:{readOnly:!0,iconKey:e=>{let{data:a}=e;return(null==a?void 0:a.pctOfBatch)!=null&&"%"}}},{component:"numberfield",label:ed.qtyOut,name:"qtyOut",props:{allowNegative:!1,decimalScale:3},async onChange(e){let{row:{update:a,newRow:r}}=e;a({variation:r.qtyOut-(null==r?void 0:r.qty)})}},{component:"numberfield",label:ed.variation,name:"variation",props:{readOnly:!0}}],eO=[{key:"Locked",condition:eW,disabled:!0},{key:"Unlocked",condition:!eW,onClick:async()=>{await eb({extension:x.u.BatchWorksheet.post,record:JSON.stringify({...ej.values.header,date:(0,O.ku)(ej.values.header.date)})}),n.ZP.success(eh.Posted),eu.close(),ep()},disabled:!eC},{key:"Close",condition:!eC,onClick:async()=>{await eb({extension:x.u.BatchWorksheet.close,record:JSON.stringify({...ej.values.header,date:(0,O.ku)(ej.values.header.date)})}),n.ZP.success(eh.Closed),eS(ev),ep()},disabled:eC||!e_},{key:"Reopen",condition:eC,onClick:async()=>{await eb({extension:x.u.BatchWorksheet.reopen,record:JSON.stringify({...ej.values.header,date:(0,O.ku)(ej.values.header.date)})}),n.ZP.success(eh.Reopened),eS(ev),ep()},disabled:!e_||eW}],eR=null==ej?void 0:null===(y=ej.values)||void 0===y?void 0:null===(b=y.batchWorksheetJobs)||void 0===b?void 0:b.reduce((e,a)=>{var r;return e+(parseFloat(null==a?void 0:null===(r=a.pctOfBatch)||void 0===r?void 0:r.toString().replace(/,/g,""))||0)},0),eF=null==ej?void 0:null===(T=ej.values)||void 0===T?void 0:null===(I=T.batchWorksheetJobs)||void 0===I?void 0:I.reduce((e,a)=>{var r;return e+(parseFloat(null==a?void 0:null===(r=a.qtyOut)||void 0===r?void 0:r.toString().replace(/,/g,""))||0)},0),eT=null==ej?void 0:null===(q=ej.values)||void 0===q?void 0:null===(P=q.batchWorksheetJobs)||void 0===P?void 0:P.reduce((e,a)=>{var r;return e+(parseFloat(null==a?void 0:null===(r=a.variation)||void 0===r?void 0:r.toString().replace(/,/g,""))||0)},0);return(0,t.jsx)(w.Z,{resourceId:i.i.BatchWorksheet,actions:eO,form:ej,maxAccess:ef,editMode:e_,children:(0,t.jsxs)(s.R,{children:[(0,t.jsxs)(k.ZP,{container:!0,spacing:2,children:[(0,t.jsx)(k.ZP,{item:!0,xs:4,children:(0,t.jsxs)(k.ZP,{container:!0,spacing:2,children:[(0,t.jsx)(k.ZP,{item:!0,xs:12,children:(0,t.jsx)(_.Z,{endpointId:C.r.DocumentType.qry,parameters:"_startAt=0&_pageSize=1000&_dgId=".concat(p.J.BatchWorksheet),filter:e_?void 0:e=>1===e.activeStatus,name:"header.dtId",label:ed.docType,readOnly:e_,valueField:"recordId",displayField:"name",values:ej.values.header,onChange:(e,a)=>{ey(a),ej.setFieldValue("header.dtId",(null==a?void 0:a.recordId)||null)},error:(null===(A=ej.touched.header)||void 0===A?void 0:A.dtId)&&!!(null===(D=ej.errors.header)||void 0===D?void 0:D.dtId),maxAccess:!e_&&ef})}),(0,t.jsx)(k.ZP,{item:!0,xs:6,children:(0,t.jsx)(j.Z,{name:"header.reference",label:ed.reference,value:ej.values.header.reference,readOnly:e_||!ej.values.header.dtId,maxAccess:!e_&&ef,onChange:ej.handleChange,onClear:()=>ej.setFieldValue("header.reference",""),error:(null===(J=ej.touched.header)||void 0===J?void 0:J.reference)&&!!(null===(M=ej.errors.header)||void 0===M?void 0:M.reference)})}),(0,t.jsx)(k.ZP,{item:!0,xs:6,children:(0,t.jsx)(S.Z,{name:"header.date",label:ed.date,readOnly:eC,required:!0,value:null===(B=ej.values)||void 0===B?void 0:B.header.date,onChange:ej.setFieldValue,onClear:()=>ej.setFieldValue("header.date",null),error:(null===(V=ej.touched.header)||void 0===V?void 0:V.date)&&!!(null===(E=ej.errors.header)||void 0===E?void 0:E.date),maxAccess:ef})}),(0,t.jsx)(k.ZP,{item:!0,xs:12,children:(0,t.jsx)(_.Z,{endpointId:x.u.WorkCenter.qry,name:"header.workCenterId",label:ed.workCenter,required:!0,valueField:"recordId",readOnly:ej.values.batchWorksheetJobs.length>0&&ej.values.batchWorksheetJobs[0].jobId,displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:ej.values.header,onChange:(e,a)=>{ej.setFieldValue("header.workCenterId",(null==a?void 0:a.recordId)||null),ej.setFieldValue("header.operationId",null),ej.setFieldValue("header.laborId",null)},error:(null===(L=ej.touched.header)||void 0===L?void 0:L.workCenterId)&&(null===(z=ej.errors.header)||void 0===z?void 0:z.workCenterId),maxAccess:ef,displayFieldWidth:1.5})}),(0,t.jsx)(k.ZP,{item:!0,xs:12,children:(0,t.jsx)(_.Z,{endpointId:ej.values.header.workCenterId&&x.u.Labor.qry2,parameters:"_workCenterId=".concat(ej.values.header.workCenterId),name:"header.laborId",label:ed.labor,values:ej.values.header,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"reference",width:1},{key:"name",value:"name",width:2}],displayFieldWidth:1.5,required:!0,readOnly:!(null==ej?void 0:null===(Q=ej.values)||void 0===Q?void 0:null===($=Q.header)||void 0===$?void 0:$.workCenterId),maxAccess:ef,onChange:(e,a)=>{ej.setFieldValue("header.laborId",(null==a?void 0:a.recordId)||null),ej.setFieldValue("header.operationId",(null==a?void 0:a.operationId)||null)},error:(null==ej?void 0:null===(Y=ej.touched)||void 0===Y?void 0:null===(X=Y.header)||void 0===X?void 0:X.laborId)&&!!(null==ej?void 0:null===(U=ej.errors)||void 0===U?void 0:null===(K=U.header)||void 0===K?void 0:K.laborId)})}),(0,t.jsx)(k.ZP,{item:!0,xs:12,children:(0,t.jsx)(_.Z,{endpointId:ej.values.header.workCenterId&&x.u.Operation.qry,parameters:"_workCenterId=".concat(ej.values.header.workCenterId),name:"header.operationId",label:ed.operation,values:ej.values.header,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"reference",width:1},{key:"name",value:"name",width:2}],displayFieldWidth:1.5,required:!0,readOnly:!(null==ej?void 0:null===(H=ej.values)||void 0===H?void 0:null===(G=H.header)||void 0===G?void 0:G.workCenterId),maxAccess:ef,onChange:(e,a)=>{ej.setFieldValue("header.operationId",(null==a?void 0:a.recordId)||null)},error:(null==ej?void 0:null===(ea=ej.touched)||void 0===ea?void 0:null===(ee=ea.header)||void 0===ee?void 0:ee.operationId)&&!!(null==ej?void 0:null===(et=ej.errors)||void 0===et?void 0:null===(er=et.header)||void 0===er?void 0:er.operationId)})})]})}),(0,t.jsx)(k.ZP,{item:!0,xs:8,sx:{display:"flex",flex:1,mt:-5},children:(0,t.jsx)(h.Q,{children:(0,t.jsx)(W._,{name:"batchWSRM",maxAccess:ef,value:ej.values.batchWSRM,error:null===(el=ej.errors)||void 0===el?void 0:el.batchWSRM,columns:eZ,readOnly:eC,onChange:e=>ej.setFieldValue("batchWSRM",e),disabled:eC,allowDelete:!eC})})})]}),(0,t.jsx)(h.Q,{children:(0,t.jsx)(W._,{name:"batchWorksheetJobs",maxAccess:ef,value:ej.values.batchWorksheetJobs,error:null===(en=ej.errors)||void 0===en?void 0:en.batchWorksheetJobs,columns:eN,onChange:e=>ej.setFieldValue("batchWorksheetJobs",e),disabled:eC||!(null===(eo=ej.values.header)||void 0===eo?void 0:eo.workCenterId),allowDelete:!eC})}),(0,t.jsx)(v.g,{children:(0,t.jsxs)(k.ZP,{container:!0,spacing:2,sx:{justifyContent:"flex-end"},children:[(0,t.jsx)(k.ZP,{item:!0,xs:3,children:(0,t.jsx)(N.Z,{name:"totalPctOfBatch",label:ed.totalPctQty,value:eR,maxAccess:ei,readOnly:!0})}),(0,t.jsx)(k.ZP,{item:!0,xs:3,children:(0,t.jsx)(N.Z,{name:"owMTD",label:ed.totalQtyOut,value:eF,maxAccess:ei,readOnly:!0})}),(0,t.jsx)(k.ZP,{item:!0,xs:3,children:(0,t.jsx)(N.Z,{name:"iwYTD",label:ed.totalVariation,value:eT,maxAccess:ei,readOnly:!0})})]})})]})})}function P(e){var a,r,l;let{store:n,access:d,labels:i}=e,c=[{field:"jobRef",headerName:i.job,flex:1},{field:"rawMaterialSku",headerName:i.rmSku,flex:1},{field:"rawMaterialName",headerName:i.rmName,flex:2},{field:"variation",headerName:i.variation,flex:1,type:"number"},{field:"issued",headerName:i.issued,flex:1,type:"number"},{field:"returned",headerName:i.returned,flex:1,type:"number"},{field:"loss",headerName:i.loss,flex:1,type:"number"}],u=null===(a=n.batchWorksheetDistributions)||void 0===a?void 0:a.reduce((e,a)=>{var r;return e+(parseFloat(null==a?void 0:null===(r=a.issued)||void 0===r?void 0:r.toString().replace(/,/g,""))||0)},0),m=null===(r=n.batchWorksheetDistributions)||void 0===r?void 0:r.reduce((e,a)=>{var r;return e+(parseFloat(null==a?void 0:null===(r=a.returned)||void 0===r?void 0:r.toString().replace(/,/g,""))||0)},0),b=null===(l=n.batchWorksheetDistributions)||void 0===l?void 0:l.reduce((e,a)=>{var r;return e+(parseFloat(null==a?void 0:null===(r=a.loss)||void 0===r?void 0:r.toString().replace(/,/g,""))||0)},0);return(0,t.jsxs)(s.R,{children:[(0,t.jsx)(h.Q,{children:(0,t.jsx)(o.Z,{name:"worksheet",columns:c,gridData:{list:n.batchWorksheetDistributions},rowId:["itemId"],maxAccess:d,pagination:!1})}),(0,t.jsx)(v.g,{children:(0,t.jsxs)(k.ZP,{container:!0,spacing:1,p:3,sx:{justifyContent:"flex-end"},children:[(0,t.jsx)(k.ZP,{item:!0,xs:1.5,children:(0,t.jsx)(N.Z,{name:"totalIssued",label:i.totalIssued,value:u,maxAccess:d,readOnly:!0})}),(0,t.jsx)(k.ZP,{item:!0,xs:1.5,children:(0,t.jsx)(N.Z,{name:"totalReturned",label:i.totalReturned,value:m,maxAccess:d,readOnly:!0})}),(0,t.jsx)(k.ZP,{item:!0,xs:1.5,children:(0,t.jsx)(N.Z,{name:"totalLoss",label:i.totalLoss,value:b,maxAccess:d,readOnly:!0})})]})})]})}var q=e=>{let{recordId:a,labels:r,access:n,window:o}=e,[d,i]=(0,l.useState)(0),[s,c]=(0,l.useState)({recordId:a}),u=[{label:r.main},{label:r.jobMaterials,disabled:!s.recordId}];return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(I.Y,{tabs:u,activeTab:d,setActiveTab:i,maxAccess:n}),(0,t.jsx)(y.Z,{index:0,value:d,maxAccess:n,children:(0,t.jsx)(T,{labels:r,setStore:c,store:s,access:n,window:o})}),(0,t.jsx)(y.Z,{index:1,value:d,maxAccess:n,children:(0,t.jsx)(P,{labels:r,access:n,store:s})})]})},A=()=>{let{getRequest:e,postRequest:a}=(0,l.useContext)(d.$),{platformLabels:r}=(0,l.useContext)(m.l),{stack:y}=(0,u.zY)(),{query:{data:I},labels:k,filterBy:g,paginationParameters:w,invalidate:j,refetch:_,access:C}=(0,c.J)({queryFn:S,endpointId:x.u.BatchWorksheet.page,datasetId:i.i.BatchWorksheet,filter:{filterFn:W}});async function W(a){let{filters:r,pagination:t}=a;return r.qry?await e({extension:x.u.BatchWorksheet.snapshot,parameters:"_filter=".concat(r.qry)}):S({_startAt:t._startAt||0,params:null==r?void 0:r.params})}async function S(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{_startAt:r=0,_pageSize:t=50,params:l=[]}=a;return{...await e({extension:x.u.BatchWorksheet.page,parameters:"_startAt=".concat(r,"&_pageSize=").concat(t,"&_params=").concat(l)}),_startAt:r}}let Z=[{field:"reference",headerName:k.reference,flex:1},{field:"workCenterName",headerName:k.workCenterName,flex:1},{field:"date",headerName:k.wip,flex:1,type:"date"},{field:"wipName",headerName:k.wip,flex:1}],N=async e=>{await a({extension:x.u.BatchWorksheet.del,record:JSON.stringify(e)}),n.ZP.success(r.Deleted),j()},{proxyAction:O}=(0,f.G)({functionId:p.J.BatchWorksheet,action:F}),R=async()=>{await O()};function F(e){y({Component:q,props:{labels:k,recordId:e,access:C},width:1e3,title:k.batchWorksheet})}return(0,t.jsxs)(s.R,{children:[(0,t.jsx)(v.g,{children:(0,t.jsx)(b.Z,{onAdd:R,maxAccess:C,reportName:"MFBWST",filterBy:g})}),(0,t.jsx)(h.Q,{children:(0,t.jsx)(o.Z,{name:"table",columns:Z,gridData:I,rowId:["recordId"],paginationParameters:w,paginationType:"api",refetch:_,onEdit:e=>{F(null==e?void 0:e.recordId)},onDelete:N,deleteConfirmationType:"strict",pageSize:50,maxAccess:C})})]})}},67920:function(e,a,r){"use strict";r.d(a,{m:function(){return l}});var t=r(48601);function l(e,a,r){var l;let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"items",o={...e};return null==r||null===(l=r.record)||void 0===l||l.controls.forEach(e=>{let{controlId:a,accessLevel:r}=e,[t,l]=null==a?void 0:a.split(".");t!==n||2!==r||l in o||(o[l]=e=>(null==e?void 0:e[l])!=null),(1===r||4===r)&&l in o&&delete o[l]}),{schema:t.Ry().shape({...Object.keys(o).reduce((e,r)=>(e[r]=t.nK().nullable().test(function(e){var t;let l=this.parent,[,n]=this.path.match(/^(\w+)\[(\d+)\]/)||[],d=(null===(t=this.options.context)||void 0===t?void 0:t[n])||[];if(a||!a&&d.length>1){if(null!==l[r]&&void 0!==l[r]&&0!==l[r]&&""!==o[r]&&!o[r](l))return!1;if(!Object.entries(o).some(e=>{let[,a]=e;return!!a(l)}))return!0}return!!o[r](l)&&void 0!==e}),e),{})}),requiredFields:o}}},1685:function(e,a,r){"use strict";r.d(a,{m:function(){return t}});let t=e=>{let a=window.sessionStorage.getItem(e);return a?JSON.parse(a):null}},98345:function(e,a,r){"use strict";r.d(a,{H:function(){return b},G:function(){return m}});var t=r(45300),l=r(2784),n=r(96026),o=r(38449);r(26612);var d=r(65947),i=r(1685);let s=async(e,a,r)=>{try{let t=await e({extension:a,parameters:r});return a.includes("qry")?t:t.record}catch(e){return null}},c=(e,a,r,t)=>{let l=(e=JSON.parse(JSON.stringify(e))).record.controls,n=l.find(e=>"reference"===e.controlId);return n?n.accessLevel=(null==a?void 0:a.mandatory)?d.$7:d.rr:(null==a?void 0:a.mandatory)?l.push({sgId:0,resourceId:"",controlId:"".concat(t?t+".":"","reference"),accessLevel:(null==a?void 0:a.mandatory)?d.$7:d.rr}):(null==a?void 0:a.readOnly)?l.push({sgId:0,resourceId:"",controlId:"".concat(t?t+".":"","reference"),accessLevel:(null==a?void 0:a.readOnly)?d.rr:d.$7}):l=e.record.controls.filter(e=>"reference"!=e.controlId),r&&l.push({sgId:0,resourceId:"",controlId:"".concat(t?t+".":"","dtId"),accessLevel:d.$7}),{...e,record:{...e.record,controls:l}}},u=async(e,a,r)=>{let t,l;switch(r){case"dtId":let n=(0,i.m)("userData"),d=null==n?void 0:n.userId;l="_userId=".concat(d,"&_functionId=").concat(a),t=o.r.UserFunction.get;break;case"glbSysNumberRange":l="_recordId=".concat(a),t=o.r.SystemFunction.get;break;case"DocumentType":l="_dgId=".concat(a,"&_startAt=",0,"&_pageSize=",50),t=o.r.DocumentType.qry;break;case"DcTypNumberRange":l="_recordId=".concat(a),t=o.r.DocumentType.get;break;case"isExternal":l="_recordId=".concat(a),t=o.r.NumberRange.get;break;default:return null}return await s(e,t,l)},v=async function(e){let a,r,t,l,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,o=arguments.length>2?arguments[2]:void 0,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,i=!(arguments.length>4)||void 0===arguments[4]||arguments[4],s=arguments.length>5?arguments[5]:void 0,v=void 0===d&&n&&await u(e,n,"dtId"),h=null==v?void 0:v.dtId,m="",b=!0;if(v&&void 0===d||"nraId"===d){if(h){let r=await u(e,h,"DcTypNumberRange");a=null==r?void 0:r.nraId,b=!((null==r?void 0:r.activeStatus)<0),a||(m="Assign the document type to a number range")}if((!h||!b)&&i&&n){var p;let a=await u(e,n,"DocumentType");l=(null==a?void 0:null===(p=a.list)||void 0===p?void 0:p.filter(e=>(null==e?void 0:e.activeStatus)===1).length)>0}}if(("nraId"===d||void 0===d)&&n){if((!h||h)&&!a||a&&!b){let r=await u(e,n,"glbSysNumberRange");(a=null==r?void 0:r.nraId)&&l&&(l=!1),b=!0}m=a||l?"":"Assign the system Function to a number range"}d>0&&!a&&(a=d),a&&b?(r={readOnly:null==(t=await u(e,a,"isExternal"))||!t.external,mandatory:null!=t&&!!t.external},o&&(o=await c(o,r,l,s))):!a&&o&&(o=await c(o,r,l,s));let f=s?"".concat(s,".reference"):"reference";return{dtId:h,resetReference:null==r?void 0:r.readOnly,dcTypeRequired:l,reference:{fieldName:f,isEmpty:(null==t?void 0:t.external)!==void 0&&(null==t||!t.external)},errorMessage:m,maxAccess:o,selectNraId:d}};var h=r(65950);function m(e){let{functionId:a,action:r,hasDT:t}=e,{getRequest:o}=(0,l.useContext)(h.$),{stack:d}=(0,n.V)();return{proxyAction:async()=>{let e=await v(o,a,"",void 0,t);(null==e?void 0:e.errorMessage)?d({message:null==e?void 0:e.errorMessage}):await r()}}}function b(e){var a;let{functionId:r,access:o,hasDT:d,enabled:i=!0,objectName:s=""}=e,{getRequest:c}=(0,l.useContext)(h.$),{stack:u}=(0,n.V)(),[m,b]=(0,l.useState)(),p=async e=>{let a=await v(c,r,o,e,d,s);if(!a.errorMessage)return a;u({message:null==a?void 0:a.errorMessage})},f=(0,t.a)({retry:!1,staleTime:0,enabled:i,queryKey:[r,m,!!o,i],queryFn:m||"nraId"===m?()=>p(m):()=>p()});return{documentType:f.data,maxAccess:(null==f?void 0:null===(a=f.data)||void 0===a?void 0:a.maxAccess)||o,changeDT(e){b((null==e?void 0:e.nraId)||"nraId")}}}},29326:function(e,a,r){"use strict";var t=r(52322);r(2784);var l=r(23925),n=r(13980),o=r.n(n),d=r(95291),i=r.n(d),s=r(65947);let c=e=>{var a,r,n;let{children:o,value:d,index:c,maxAccess:u,...v}=e,h="".concat(e.name||"tab",".").concat(c),{accessLevel:m}=null!==(n=(null!==(r=null==u?void 0:null===(a=u.record)||void 0===a?void 0:a.controls)&&void 0!==r?r:[]).find(e=>e.controlId===h))&&void 0!==n?n:{accessLevel:0};if(m===s.A1)return null;let b=d===c;return(0,t.jsx)(l.Z,{role:"tabpanel",hidden:!b,id:"simple-tabpanel-".concat(c),"aria-labelledby":"simple-tab-".concat(c),className:"".concat(i().tabPanel," ").concat(b?i().active:i().hidden),...v,children:o})};c.propTypes={children:o().node,index:o().number.isRequired,value:o().number.isRequired},a.Z=c},9522:function(e,a,r){"use strict";r.d(a,{Y:function(){return v}});var t=r(52322),l=r(23925),n=r(54582),o=r(68696),d=r(44258),i=r(2784),s=r(99266),c=r(52614),u=r.n(c);let v=e=>{var a,r,c,v,h;let{tabs:m,activeTab:b,setActiveTab:p,maxAccess:f,name:x="tab"}=e,y=(null==f?void 0:null===(r=f.record)||void 0===r?void 0:null===(a=r.controls)||void 0===a?void 0:a.filter(e=>{var a;return 4===e.accessLevel&&(null===(a=e.controlId)||void 0===a?void 0:a.startsWith("".concat(x,".")))}).map(e=>e.controlId.split(".")[1]))||[],I=null==m?void 0:null===(c=m.map((e,a)=>({...e,id:a})))||void 0===c?void 0:c.filter((e,a)=>!y.includes(String(a))),k=null===(v=I[b])||void 0===v?void 0:v.id,g=null===(h=I[b])||void 0===h?void 0:h.disabled;return(0,i.useEffect)(()=>{k>=0&&!g&&b!=k&&p(k)},[]),(0,t.jsx)(l.Z,{className:u().tabsContainer,children:(0,t.jsx)(l.Z,{className:u().tabsWrapper,children:(0,t.jsx)(n.Z,{value:b,onChange:(e,a)=>p(a),variant:"scrollable",scrollButtons:I.length>3?"auto":"off","aria-label":"scrollable tabs",classes:{indicator:u().tabsIndicator},className:u().tabs,children:null==I?void 0:I.map(e=>(0,t.jsx)(o.Z,{value:e.id,disabled:null==e?void 0:e.disabled,className:"".concat(u().tabName," ").concat(e.disabled?u().tabDisabled:""),classes:{root:u().tabRoot,selected:u().selectedTab},label:(0,t.jsxs)(l.Z,{display:"flex",alignItems:"center",children:[(0,t.jsx)("span",{children:e.label}),e.id===b&&(null==e?void 0:e.onRefetch)&&(0,t.jsx)(d.Z,{size:"small",className:u().refreshButton,onClick:a=>{a.stopPropagation(),e.onRefetch()},children:(0,t.jsx)(s.Z,{className:u().refreshIcon})})]})},e.id))})})})}},95291:function(e){e.exports={tabPanel:"CustomTabPanel_tabPanel__80Dfu",active:"CustomTabPanel_active___6Uvb",hidden:"CustomTabPanel_hidden__y9566"}},52614:function(e){e.exports={customTabPanel:"CustomTabs_customTabPanel__Ztocv",hidden:"CustomTabs_hidden__lZpM7",tabsContainer:"CustomTabs_tabsContainer__28Syi",tabsWrapper:"CustomTabs_tabsWrapper__mlxxj",tabs:"CustomTabs_tabs__25pli",tabName:"CustomTabs_tabName__XzMCn",tabRoot:"CustomTabs_tabRoot__WVR1E",tabDisabled:"CustomTabs_tabDisabled__VauYR",selectedTab:"CustomTabs_selectedTab__sZzwF",tabsIndicator:"CustomTabs_tabsIndicator__89Lek",refreshButton:"CustomTabs_refreshButton__P2mzl",refreshIcon:"CustomTabs_refreshIcon__ADVWF"}}},function(e){e.O(0,[92515,2494,36908,49774,92888,40179],function(){return e(e.s=90895)}),_N_E=e.O()}]);