(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[84390],{49153:function(e,r,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/work-order",function(){return a(71643)}])},71643:function(e,r,a){"use strict";a.r(r),a.d(r,{default:function(){return Y}});var t=a(52322),l=a(2784),n=a(62202),s=a(69387),d=a(27723),o=a(65950),i=a(71987),c=a(26612),u=a(31389),m=a(33625),p=a(62362),v=a(61802),h=a(54736),x=a(19473),y=a(98345),g=a(7121),b=a(29326),f=a(9522),I=a(60218),k=a(48601),P=a(82737),j=a(5088),q=a(80983),T=a(38449),O=a(8661),N=a(91406),C=a(27423),S=a(89330),Z=a(84100),w=a(21581),_=a(39812);function R(e){var r,a,s,d,m,v,b;let{labels:f,access:R,setStore:F,store:W,window:A}=e,{recordId:D}=W,{getRequest:E,postRequest:V}=(0,l.useContext)(o.$),{platformLabels:M}=(0,l.useContext)(x.l),{maxAccess:L,documentType:Q,changeDT:J}=(0,y.H)({functionId:g.J.WorkOrder,access:R,enabled:!D}),z=(0,i.E)({endpointId:h.m.WorkOrder.page}),{formik:B}=(0,q.c)({documentType:{key:"dtId",value:null==Q?void 0:Q.dtId,reference:null==Q?void 0:Q.reference},initialValues:{recordId:W.recordId,dtId:null,reference:"",equipmentId:null,equipmentRef:"",equipmentName:"",date:new Date,dueDate:null,scheduled:new Date,priority:2,wotId:null,progress:1,description:"",status:1},maxAccess:L,validationSchema:k.Ry({equipmentId:k.Rx().required(),wotId:k.Rx().required(),progress:k.Rx().required(),priority:k.Rx().required()}),onSubmit:async e=>{K((await V({extension:h.m.WorkOrder.set,record:JSON.stringify(e)})).recordId),n.ZP.success(e.recordId?M.Edited:M.Added),z()}}),$=!!B.values.recordId,Y=1===B.values.status,H=W.isPosted,K=async e=>{if(e){var r,a,t,l;let n=await E({extension:h.m.WorkOrder.get,parameters:"_recordId=".concat(e)});B.setValues({...n.record,date:(0,_.a1)(null===(r=n.record)||void 0===r?void 0:r.date),scheduled:(null===(a=n.record)||void 0===a?void 0:a.scheduled)?(0,_.a1)(null===(t=n.record)||void 0===t?void 0:t.scheduled):null,dueDate:(null===(l=n.record)||void 0===l?void 0:l.dueDate)?(0,_.a1)(n.record.dueDate):null}),F(e=>({...e,recordId:n.record.recordId,equipmentId:n.record.equipmentId,reference:n.record.reference,isPosted:3===n.record.status}))}};(0,l.useEffect)(()=>{K(D)},[]);let U=async()=>{var e,r,a,t,l;await V({extension:h.m.WorkOrder.post,record:JSON.stringify({...null==B?void 0:B.values,date:(0,_.ku)(null==B?void 0:null===(e=B.values)||void 0===e?void 0:e.date),scheduled:(null==B?void 0:null===(r=B.values)||void 0===r?void 0:r.scheduled)?(0,_.ku)(null==B?void 0:null===(a=B.values)||void 0===a?void 0:a.scheduled):null,dueDate:(null==B?void 0:null===(t=B.values)||void 0===t?void 0:t.dueDate)?(0,_.ku)(null==B?void 0:null===(l=B.values)||void 0===l?void 0:l.dueDate):null})}),n.ZP.success(M.Posted),A.close(),z()},G=[{key:"GL",condition:!0,onClick:"onClickGL",disabled:!$,valuesPath:{...B.values,notes:B.values.description},datasetId:c.i.GLWorkOrder},{key:"Unlocked",condition:!H,onClick:U,disabled:!$||H},{key:"Locked",condition:H,disabled:!0},{key:"IV",condition:!0,onClick:"onInventoryTransaction",disabled:!$||Y}];return(0,t.jsx)(P.Z,{actions:G,functionId:g.J.WorkOrder,resourceId:c.i.WorkOrder,form:B,maxAccess:L,editMode:$,disabledSubmit:H,children:(0,t.jsx)(u.R,{children:(0,t.jsx)(p.Q,{children:(0,t.jsxs)(I.ZP,{container:!0,spacing:2,children:[(0,t.jsx)(I.ZP,{item:!0,xs:6,children:(0,t.jsxs)(I.ZP,{container:!0,spacing:2,children:[(0,t.jsx)(I.ZP,{item:!0,xs:12,children:(0,t.jsx)(O.Z,{endpointId:T.r.DocumentType.qry,parameters:"_startAt=0&_pageSize=1000&_dgId=".concat(g.J.WorkOrder),filter:$?void 0:e=>1===e.activeStatus,name:"dtId",label:f.docType,readOnly:$,valueField:"recordId",displayField:"name",values:B.values,onChange:(e,r)=>{B.setFieldValue("dtId",(null==r?void 0:r.recordId)||null),J(r)},error:B.touched.dtId&&!!B.errors.dtId,maxAccess:L})}),(0,t.jsx)(I.ZP,{item:!0,xs:12,children:(0,t.jsx)(j.Z,{name:"reference",label:f.reference,value:B.values.reference,readOnly:$,maxAccess:!$&&L,onChange:B.handleChange,onClear:()=>B.setFieldValue("reference",""),error:B.touched.reference&&!!B.errors.reference})})]})}),(0,t.jsx)(I.ZP,{item:!0,xs:12,children:(0,t.jsx)(C.U,{endpointId:h.m.Equipment.snapshot,name:"equipmentId",label:null==f?void 0:f.equipment,secondFieldLabel:null==f?void 0:f.equipmentName,valueField:"recordId",displayField:"reference",valueShow:"equipmentRef",secondValueShow:"equipmentName",readOnly:H,form:B,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"description",value:"Description"}],onChange:(e,r)=>{B.setFieldValue("equipmentName",(null==r?void 0:r.description)||""),B.setFieldValue("equipmentRef",(null==r?void 0:r.reference)||""),B.setFieldValue("equipmentId",(null==r?void 0:r.recordId)||null)},maxAccess:L,errorCheck:"equipmentId",required:!0})}),(0,t.jsx)(I.ZP,{item:!0,xs:6,children:(0,t.jsxs)(I.ZP,{container:!0,spacing:2,children:[(0,t.jsx)(I.ZP,{item:!0,xs:12,children:(0,t.jsx)(S.Z,{name:"date",label:f.date,value:null===(r=B.values)||void 0===r?void 0:r.date,required:!0,readOnly:H,onChange:B.setFieldValue,onClear:()=>B.setFieldValue("date",null),error:B.touched.date&&!!B.errors.date,maxAccess:L})}),(0,t.jsx)(I.ZP,{item:!0,xs:12,children:(0,t.jsx)(S.Z,{name:"scheduled",label:f.Scheduled,value:null===(a=B.values)||void 0===a?void 0:a.scheduled,readOnly:H,onChange:B.setFieldValue,onClear:()=>B.setFieldValue("scheduled",null),error:B.touched.scheduled&&!!B.errors.scheduled,maxAccess:L})}),(0,t.jsx)(I.ZP,{item:!0,xs:12,children:(0,t.jsx)(S.Z,{name:"dueDate",label:f.dueBy,value:null===(s=B.values)||void 0===s?void 0:s.dueDate,readOnly:H,onChange:B.setFieldValue,onClear:()=>B.setFieldValue("dueDate",null),error:B.touched.dueDate&&!!B.errors.dueDate,maxAccess:L})})]})}),(0,t.jsx)(I.ZP,{item:!0,xs:12,children:(0,t.jsx)(O.Z,{datasetId:Z.v.RS_PRIORITY,name:"priority",label:f.priority,valueField:"key",displayField:"value",readOnly:H,required:!0,values:B.values,onChange:(e,r)=>{B.setFieldValue("priority",(null==r?void 0:r.key)||null)},error:B.touched.priority&&!!B.errors.priority,maxAccess:L})}),(0,t.jsx)(I.ZP,{item:!0,xs:6,children:(0,t.jsx)(O.Z,{endpointId:h.m.WorkOrderTypes.qry,name:"wotId",label:f.type,values:B.values,valueField:"recordId",displayField:"name",readOnly:H,maxAccess:L,onChange:(e,r)=>{B.setFieldValue("wotId",(null==r?void 0:r.recordId)||null)},error:B.touched.wotId&&!!B.errors.wotId,required:!0})}),(0,t.jsx)(I.ZP,{item:!0,xs:12,children:(0,t.jsx)(w.Z,{name:"description",label:f.notes,value:B.values.description,readOnly:H,rows:2,maxAccess:L,onChange:e=>B.setFieldValue("description",e.target.value),onClear:()=>B.setFieldValue("description",""),error:B.touched.description&&!!B.errors.description})}),(0,t.jsx)(I.ZP,{item:!0,xs:6,children:(0,t.jsxs)(I.ZP,{container:!0,spacing:2,children:[(0,t.jsx)(I.ZP,{item:!0,xs:12,children:(0,t.jsx)(O.Z,{datasetId:Z.v.RS_WO_PROGRESS,name:"progress",readOnly:H,label:f.progress,valueField:"key",displayField:"value",required:!0,values:B.values,onChange:(e,r)=>{B.setFieldValue("progress",(null==r?void 0:r.key)||null)},error:B.touched.progress&&!!B.errors.progress,maxAccess:L})}),(0,t.jsx)(I.ZP,{item:!0,xs:12,children:(0,t.jsx)(N.Z,{name:"currentPM",label:f.cpm,value:null===(d=B.values)||void 0===d?void 0:d.currentPM,readOnly:!(null===(m=B.values)||void 0===m?void 0:m.equipmentId)||H,maxLength:9,decimalScale:2,onChange:B.handleChange,onClear:()=>B.setFieldValue("currentPM",""),maxAccess:L,error:B.touched.currentPM&&!!B.errors.currentPM})}),(0,t.jsx)(I.ZP,{item:!0,xs:12,children:(0,t.jsx)(N.Z,{name:"currentSM",label:f.csm,value:null===(v=B.values)||void 0===v?void 0:v.currentSM,readOnly:!(null===(b=B.values)||void 0===b?void 0:b.equipmentId)||H,maxLength:9,decimalScale:2,onChange:B.handleChange,onClear:()=>B.setFieldValue("currentSM",""),maxAccess:L,error:B.touched.currentSM&&!!B.errors.currentSM})})]})})]})})})})}var F=a(54074),W=e=>{var r,a,s;let{labels:d,access:c,store:m,seqNo:v,record:y,window:g}=e,{postRequest:b,getRequest:f}=(0,l.useContext)(o.$),{platformLabels:P}=(0,l.useContext)(x.l),[T,N]=(0,l.useState)([]),C=m.isPosted,R=(null==y?void 0:y.status)==2,W=(0,i.E)({endpointId:h.m.WorkTask.qry}),A=!!(null==y?void 0:y.seqNo),{formik:D}=(0,q.c)({maxAccess:c,initialValues:{workOrderId:m.recordId,seqNo:v,dueDate:null,taskType:null,priority:null,status:1,rnId:null,pmtId:null,notes:"",eqNotes:"",otherName:""},validationSchema:k.Ry({taskType:k.Rx().required(),priority:k.Rx().required()}),onSubmit:async e=>{let{eqNotes:r,dueDate:a,...t}=e;await b({extension:h.m.WorkTask.set,record:JSON.stringify({...t,dueDate:a?(0,_.ku)(a):null})}),n.ZP.success((null==y?void 0:y.seqNo)?P.Edited:P.Added),g.close(),W()}});(0,l.useEffect)(()=>{(async()=>{if(null==y?void 0:y.seqNo){let e=await f({extension:h.m.WorkTask.get,parameters:"_workOrderId=".concat(m.recordId,"&_seqNo=").concat(y.seqNo)});D.setValues({...e.record,dueDate:(0,_.a1)(e.record.dueDate)})}})()},[]);let E=(null==T?void 0:null===(a=T.list)||void 0===a?void 0:null===(r=a.find(e=>e.pmtId===(null==D?void 0:D.values.pmtId)))||void 0===r?void 0:r.notes)||"";return(0,t.jsx)(F.Z,{onSave:D.handleSubmit,maxAccess:c,editMode:A,disabledSubmit:m.isPosted||R,children:(0,t.jsx)(u.R,{children:(0,t.jsx)(p.Q,{children:(0,t.jsxs)(I.ZP,{container:!0,spacing:2,children:[(0,t.jsx)(I.ZP,{item:!0,xs:6,children:(0,t.jsxs)(I.ZP,{container:!0,spacing:2,children:[(0,t.jsx)(I.ZP,{item:!0,xs:12,children:(0,t.jsx)(O.Z,{datasetId:Z.v.RS_WO_TASK_TYPE,name:"taskType",label:d.type,valueField:"key",displayField:"value",values:D.values,readOnly:C||R,onChange:(e,r)=>{D.setFieldValue("taskType",(null==r?void 0:r.key)||null),D.setFieldValue("pmtId",null),D.setFieldValue("rnId",null)},error:D.touched.taskType&&!!D.errors.taskType,maxAccess:c,required:!0})}),(0,t.jsxs)(I.ZP,{item:!0,xs:12,children:[(0,t.jsx)(O.Z,{endpointId:h.m.EquipmentType.qry,parameters:"_equipmentId=".concat(null==m?void 0:m.equipmentId),setData:N,name:"pmtId",label:"".concat(d.task," / ").concat(d.repair),hidden:2==D.values.taskType||3==D.values.taskType,valueField:"pmtId",displayField:"pmtName",values:D.values,readOnly:!D.values.taskType||C||R,maxAccess:c,onChange:(e,r)=>{D.setFieldValue("pmtId",(null==r?void 0:r.pmtId)||null)},error:D.touched.pmtId&&!!D.errors.pmtId}),(0,t.jsx)(O.Z,{endpointId:h.m.RepairName.qry,name:"rnId",label:"".concat(d.task," / ").concat(d.repair),hidden:1==D.values.taskType||3==D.values.taskType||!D.values.taskType,valueField:"recordId",displayField:"name",readOnly:C||R,values:D.values,maxAccess:c,onChange:(e,r)=>{D.setFieldValue("rnId",(null==r?void 0:r.recordId)||null)},error:D.touched.rnId&&!!D.errors.rnId}),(0,t.jsx)(j.Z,{name:"otherName",label:"".concat(d.task," / ").concat(d.repair),value:D.values.otherName,maxAccess:c,readOnly:C||R,hidden:2==D.values.taskType||1==D.values.taskType||!D.values.taskType,onChange:D.handleChange,onClear:()=>D.setFieldValue("otherName",""),error:D.touched.otherName&&!!D.errors.otherName})]}),(0,t.jsx)(I.ZP,{item:!0,xs:12,children:(0,t.jsx)(S.Z,{name:"dueDate",label:d.dueBy,value:null===(s=D.values)||void 0===s?void 0:s.dueDate,readOnly:C||R,onChange:D.setFieldValue,onClear:()=>D.setFieldValue("dueDate",null),error:D.touched.dueDate&&!!D.errors.dueDate,maxAccess:c})}),(0,t.jsx)(I.ZP,{item:!0,xs:12,children:(0,t.jsx)(O.Z,{datasetId:Z.v.RS_PRIORITY,name:"priority",label:d.priority,readOnly:C||R,valueField:"key",displayField:"value",values:D.values,onChange:(e,r)=>{D.setFieldValue("priority",(null==r?void 0:r.key)||null)},error:D.touched.priority&&!!D.errors.priority,maxAccess:c,required:!0})}),(0,t.jsx)(I.ZP,{item:!0,xs:12,children:(0,t.jsx)(w.Z,{name:"notes",label:d.notes,value:D.values.notes,readOnly:C||R,rows:3,editMode:A,maxAccess:c,onChange:e=>D.setFieldValue("notes",e.target.value),onClear:()=>D.setFieldValue("notes",""),error:D.touched.notes&&!!D.errors.notes})})]})}),(0,t.jsx)(I.ZP,{item:!0,xs:6,sx:{mt:10},children:(0,t.jsx)(I.ZP,{container:!0,spacing:2,children:(0,t.jsx)(I.ZP,{item:!0,xs:12,children:(0,t.jsx)(w.Z,{name:"eqNotes",label:d.taskNotes,value:E,rows:3,hidden:1!=D.values.taskType,readOnly:!0,maxAccess:c})})})})]})})})})},A=a(23925),D=a(44258),E=a(96577),V=a.n(E),M=a(76399),L=a(67920),Q=e=>{var r;let{access:a,labels:s,store:{reference:d,isPosted:i,recordId:c},data:{seqNo:v,taskName:y,status:g}}=e,{getRequest:b,postRequest:f}=(0,l.useContext)(o.$),{platformLabels:P}=(0,l.useContext)(x.l),T=2===g,{schema:O,requiredFields:N}=(0,L.m)({sparePartId:e=>null==e?void 0:e.sparePartId,whId:e=>null==e?void 0:e.whId,qty:e=>(null==e?void 0:e.qty)!=0,unitPrice:e=>(null==e?void 0:e.unitPrice)>0},!0,a,"parts"),{formik:C}=(0,q.c)({maxAccess:a,initialValues:{parts:[{id:1,workOrderId:c,seqNo:v,unitPrice:0,qty:0,extendedPrice:0}]},validationSchema:k.Ry({parts:k.IX().of(O)}),onSubmit:async e=>{var r;let a={workOrderId:c,seqNo:v,parts:null===(r=e.parts)||void 0===r?void 0:r.filter(e=>{var r;return null===(r=Object.values(N))||void 0===r?void 0:r.every(r=>r(e))}).map((e,r)=>{let{id:a,partNo:t,partName:l,whName:n,itemId:s,...d}=e;return{wopSeqNo:r+1,...d}})};await f({extension:h.m.WorkOrderParts.set2,record:JSON.stringify(a)}),n.ZP.success(P.Updated)}}),S=[{component:"resourcelookup",label:s.partNo,name:"sparePartId",props:{endpointId:h.m.SpareParts.snapshot,displayField:"partNo",valueField:"partNo",columnsInDropDown:[{key:"partNo",value:"Part No"},{key:"name",value:"Name"}],mapping:[{from:"partNo",to:"partNo"},{from:"name",to:"partName"},{from:"recordId",to:"sparePartId"}],displayFieldWidth:3}},{component:"textfield",name:"partName",label:s.name,props:{readOnly:!0}},{component:"numberfield",name:"qty",label:s.qty,updateOn:"blur",props:{decimalScale:2},async onChange(e){let{row:{update:r,newRow:a}}=e;r({extendedPrice:a.qty*a.unitPrice})}},{component:"resourcecombobox",label:s.warehouse,name:"whId",props:{endpointId:h.m.Warehouse.qry,parameters:"_startAt=0&_pageSize=50",valueField:"recordId",displayField:"name",mapping:[{from:"name",to:"whName"},{from:"recordId",to:"whId"}],displayFieldWidth:2}},{component:"numberfield",name:"unitPrice",label:s.unitCost,updateOn:"blur",props:{decimalScale:2},async onChange(e){let{row:{update:r,newRow:a}}=e;r({extendedPrice:a.qty*a.unitPrice})}},{component:"numberfield",name:"extendedPrice",label:s.extendedCost,props:{readOnly:!0}}];return(0,l.useEffect)(()=>{!async function(){if(c){var e,r;let a=await b({extension:h.m.WorkOrderParts.qry,parameters:"_workOrderId=".concat(c,"&_seqNo=").concat(v)});if(null==a?void 0:null===(e=a.list)||void 0===e?void 0:e.length){let e=null===(r=a.list)||void 0===r?void 0:r.map((e,r)=>({...e,id:r+1}));C.setValues({parts:e})}}}()},[]),(0,t.jsx)(F.Z,{onSave:C.handleSubmit,maxAccess:a,disabledSubmit:i||T,children:(0,t.jsx)(u.R,{children:(0,t.jsxs)(p.Q,{children:[(0,t.jsx)(m.g,{children:(0,t.jsxs)(I.ZP,{container:!0,xs:4,spacing:2,children:[(0,t.jsx)(I.ZP,{item:!0,xs:12,children:(0,t.jsx)(j.Z,{name:"workOrder",label:s.workOrder,value:d,readOnly:!0})}),(0,t.jsx)(I.ZP,{item:!0,xs:12,children:(0,t.jsx)(j.Z,{name:"taskName",label:s.task,value:y,readOnly:!0})})]})}),(0,t.jsx)(p.Q,{children:(0,t.jsx)(M._,{onChange:e=>C.setFieldValue("parts",e),initialValues:null===(r=C.initialValues.parts)||void 0===r?void 0:r[0],value:C.values.parts,error:C.errors.parts,name:"parts",columns:S,maxAccess:a,disabled:i||T,allowDelete:!i&&!T})})]})})})},J=e=>{var r;let{data:{seqNo:a,taskName:s,status:d},access:i,labels:c,store:{reference:v,isPosted:y,recordId:g}}=e,{getRequest:b,postRequest:f}=(0,l.useContext)(o.$),{platformLabels:P}=(0,l.useContext)(x.l),T=2===d,{schema:O,requiredFields:N}=(0,L.m)({laborId:e=>null==e?void 0:e.laborId,hours:e=>null==e?void 0:e.hours},!0,i,"labors"),{formik:C}=(0,q.c)({maxAccess:i,initialValues:{labors:[{id:1,workOrderId:g,seqNo:a,hours:0,qty:0,rate:0}]},validationSchema:k.Ry({labors:k.IX().of(O)}),onSubmit:async e=>{var r;let t={workOrderId:g,seqNo:a,labors:null===(r=e.labors)||void 0===r?void 0:r.filter(e=>{var r;return null===(r=Object.values(N))||void 0===r?void 0:r.every(r=>r(e))}).map((e,r)=>{let{id:a,laborRef:t,firstName:l,lastName:n,rate:s,...d}=e;return{laborSeqNo:r+1,rate:s,...d}})};await f({extension:h.m.WorkOrderLabors.set2,record:JSON.stringify(t)}),n.ZP.success(P.Updated)}}),S=[{component:"resourcelookup",label:c.labor,name:"laborId",props:{endpointId:h.m.RsLabors.snapshot,displayField:"reference",valueField:"reference",columnsInDropDown:[{key:"reference",value:"Reference"},{key:"firstName",value:"First Name"},{key:"lastName",value:"Last Name"}],mapping:[{from:"firstName",to:"firstName"},{from:"reference",to:"laborRef"},{from:"lastName",to:"lastName"},{from:"rate",to:"rate"},{from:"recordId",to:"laborId"}],displayFieldWidth:5},async onChange(e){let{row:{update:r,newRow:a}}=e;r({rate:a.rate||0})}},{component:"textfield",name:"firstName",label:c.lastName,props:{readOnly:!0}},{component:"textfield",name:"lastName",label:c.lastName,props:{readOnly:!0}},{component:"numberfield",name:"hours",label:c.hours,updateOn:"blur",props:{decimalScale:2},async onChange(e){let{row:{update:r,newRow:a}}=e;r({total:a.hours*a.rate||0})}},{component:"numberfield",name:"rate",label:c.rate,props:{readOnly:!0}},{component:"numberfield",name:"total",label:c.total,props:{readOnly:!0}}];return(0,l.useEffect)(()=>{!async function(){if(g&&a){var e,r;let t=await b({extension:h.m.WorkOrderLabors.qry,parameters:"_workOrderId=".concat(g,"&_seqNo=").concat(a)});if(null==t?void 0:null===(e=t.list)||void 0===e?void 0:e.length){let e=null===(r=t.list)||void 0===r?void 0:r.map((e,r)=>({...e,id:r+1}));C.setValues({labors:e})}}}()},[]),(0,t.jsx)(F.Z,{onSave:C.handleSubmit,maxAccess:i,disabledSubmit:y||T,children:(0,t.jsx)(u.R,{children:(0,t.jsxs)(p.Q,{children:[(0,t.jsx)(m.g,{children:(0,t.jsxs)(I.ZP,{container:!0,xs:4,spacing:2,children:[(0,t.jsx)(I.ZP,{item:!0,xs:12,children:(0,t.jsx)(j.Z,{name:"workOrder",label:c.workOrder,value:v,readOnly:!0})}),(0,t.jsx)(I.ZP,{item:!0,xs:12,children:(0,t.jsx)(j.Z,{name:"taskName",label:c.task,value:s,readOnly:!0})})]})}),(0,t.jsx)(p.Q,{children:(0,t.jsx)(M._,{onChange:e=>C.setFieldValue("labors",e),initialValues:null===(r=C.initialValues.labors)||void 0===r?void 0:r[0],value:C.values.labors,error:C.errors.labors,name:"labors",columns:S,maxAccess:i,disabled:y||T,allowDelete:!y&&!T})})]})})})},z=a(26275),B=e=>{var r;let{store:y,labels:g,access:b}=e,{getRequest:f,postRequest:I}=(0,l.useContext)(o.$),{recordId:k}=y,{platformLabels:P}=(0,l.useContext)(x.l),{stack:j}=(0,v.zY)();async function q(){return await f({extension:h.m.WorkTask.qry,parameters:"_workOrderId=".concat(k)})}let{query:{data:T},refetch:O}=(0,i.J)({enabled:!!k,datasetId:c.i.WorkOrder,queryFn:q,endpointId:h.m.WorkTask.qry}),N=[{field:"typeName",headerName:g.type,flex:1},{field:"taskName",headerName:g.task,flex:1},{field:"statusName",headerName:g.status,flex:1},{field:"parts",headerName:g.parts,flex:1,cellRenderer:e=>(0,t.jsx)(A.Z,{display:"flex",justifyContent:"center",alignItems:"center",height:"100%",children:(0,t.jsx)(D.Z,{size:"small",onClick:()=>j({Component:Q,props:{labels:g,access:b,store:y,data:null==e?void 0:e.data},width:900,title:g.parts}),children:(0,t.jsx)(V(),{src:a(21613).default.src,width:18,height:18,alt:"post.png"})})})},{field:"labors",headerName:g.labors,flex:1,cellRenderer:e=>(0,t.jsx)(A.Z,{display:"flex",justifyContent:"center",alignItems:"center",height:"100%",children:(0,t.jsx)(D.Z,{size:"small",onClick:()=>j({Component:J,props:{labels:g,access:b,store:y,data:null==e?void 0:e.data},width:900,title:g.labors}),children:(0,t.jsx)(V(),{src:a(76144).default.src,width:18,height:18,alt:"post.png"})})})},{field:"mark",headerName:g.markAsComplete,flex:1,cellRenderer:e=>(0,t.jsx)(A.Z,{display:"flex",justifyContent:"center",alignItems:"center",height:"100%",children:(0,t.jsx)(z.Z,{component:"button",disabled:y.isPosted,sx:{fontSize:14,cursor:"pointer",textDecoration:"underline",textDecorationColor:"blue",color:"blue"},onClick:async()=>{await I({extension:h.m.WorkTask.set,record:JSON.stringify({...e.data,status:1===e.data.status?2:1})}),n.ZP.success(P.Updated),O()},children:2==e.data.status?g.incompleted:g.completed})})}],C=async e=>{await I({extension:h.m.WorkTask.del,record:JSON.stringify(e)}),O(),n.ZP.success(P.Deleted)},S=((null==T?void 0:null===(r=T.list)||void 0===r?void 0:r.length)?Math.max(...T.list.map(e=>e.seqNo)):0)+1;function Z(e){j({Component:W,props:{labels:g,seqNo:S,record:e,access:b,store:y},height:400,title:g.task})}return(0,t.jsxs)(u.R,{children:[(0,t.jsx)(m.g,{children:(0,t.jsx)(d.Z,{onAdd:()=>{Z()},disableAdd:y.isPosted,maxAccess:b})}),(0,t.jsx)(p.Q,{children:(0,t.jsx)(s.Z,{name:"task",columns:N,gridData:T,rowId:["recordId"],onEdit:e=>{Z(e)},pagination:!1,onDelete:!y.isPosted&&C,maxAccess:b})})]})},$=e=>{let{recordId:r,labels:a,access:n,window:s}=e,[d,o]=(0,l.useState)(0),[i,c]=(0,l.useState)({recordId:r||null,equipmentId:null,reference:null,isPosted:!1}),u=[{label:a.workOrder},{label:a.task,disabled:!i.recordId}];return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(f.Y,{tabs:u,activeTab:d,setActiveTab:o,maxAccess:n}),(0,t.jsx)(b.Z,{index:0,value:d,maxAccess:n,children:(0,t.jsx)(R,{labels:a,setStore:c,store:i,access:n,window:s})}),(0,t.jsx)(b.Z,{index:1,value:d,maxAccess:n,children:(0,t.jsx)(B,{labels:a,access:n,store:i})})]})},Y=()=>{let{getRequest:e,postRequest:r}=(0,l.useContext)(o.$),{platformLabels:a}=(0,l.useContext)(x.l),{stack:b}=(0,v.zY)();async function f(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{_startAt:a=0,_pageSize:t=50}=r;return{...await e({extension:h.m.WorkOrder.page,parameters:"_startAt=".concat(a,"&_pageSize=").concat(t,"&filter=")}),_startAt:a}}let{query:{data:I},labels:k,invalidate:P,refetch:j,paginationParameters:q,access:T}=(0,i.J)({queryFn:f,endpointId:h.m.WorkOrder.page,datasetId:c.i.WorkOrder}),O=[{field:"reference",headerName:k.reference,flex:1},{field:"equipmentName",headerName:k.equipment,flex:1},{field:"wotName",headerName:k.type,flex:1},{field:"priorityName",headerName:k.priority,flex:1},{field:"date",headerName:k.date,flex:1,type:"date"},{field:"statusName",headerName:k.status,flex:1},{field:"progressName",headerName:k.progress,flex:1}],{proxyAction:N}=(0,y.G)({functionId:g.J.WorkOrder,action:Z}),C=async()=>{N()},S=async e=>{await r({extension:h.m.WorkOrder.del,record:JSON.stringify(e)}),P(),n.ZP.success(a.Deleted)};function Z(e){b({Component:$,props:{labels:k,recordId:e,access:T},width:1e3,height:710,title:k.workOrder})}return(0,t.jsxs)(u.R,{children:[(0,t.jsx)(m.g,{children:(0,t.jsx)(d.Z,{onAdd:C,maxAccess:T})}),(0,t.jsx)(p.Q,{children:(0,t.jsx)(s.Z,{name:"table",columns:O,gridData:I,rowId:["recordId"],onEdit:e=>{Z(null==e?void 0:e.recordId)},onDelete:S,pageSize:50,refetch:j,paginationParameters:q,paginationType:"api",maxAccess:T})})]})}},54736:function(e,r,a){"use strict";a.d(r,{m:function(){return l}});let t="RS.asmx/",l={RepairName:{page:t+"pageRNA",qry:t+"qryRNA",get:t+"getRNA",set:t+"setRNA",del:t+"delRNA"},WorkOrderTypes:{page:t+"pageWOT",qry:t+"qryWOT",get:t+"getWOT",set:t+"setWOT",del:t+"delWOT"},RepairType:{page:t+"pageRT",get:t+"getRT",set:t+"setRT",del:t+"delRT"},SpareParts:{snapshot:t+"snapshotSP",page:t+"pageSP",get:t+"getSP",set:t+"setSP",del:t+"delSP"},InspectionTemplate:{get2:t+"get2ITE",page:t+"pageITE",set2:t+"set2ITE",del:t+"delITE"},Department:{page:t+"pageDEP",get:t+"getDEP",set:t+"setDEP",del:t+"delDEP"},Warehouse:{page:t+"pageWH",qry:t+"qryWH",set:t+"setWH",get:t+"getWH",del:t+"delWH"},PreventiveMaintenanceTasks:{qry:t+"qryPMT",page:t+"pagePMT",qry:t+"qryPMT",get:t+"getPMT",set:t+"setPMT",del:t+"delPMT"},Equipment:{qry:t+"qryEQP",page:t+"pageEQP",get:t+"getEQP",set:t+"setEQP",del:t+"delEQP",snapshot:t+"snapshotEQP"},SpManufacturer:{page:t+"pageSPM",get:t+"getSPM",set:t+"setSPM",del:t+"delSPM",qry:t+"qrySPM"},JobPosition:{page:t+"pagePOS",qry:t+"qryPOS",get:t+"getPOS",set:t+"setPOS",del:t+"delPOS"},SpCategory:{page:t+"pageSPC",get:t+"getSPC",set:t+"setSPC",del:t+"delSPC",qry:t+"qrySPC"},MaintenanceTemplates:{page:t+"pageMTE",get:t+"getMTE",set:t+"setMTE",del:t+"delMTE",qry:t+"qryMTE"},MaintenanceTemplateTask:{qry:t+"qryMTT",get:t+"getMTT",set:t+"setMTT",del:t+"delMTT"},RsLabors:{qry:t+"qryLBR",snapshot:t+"snapshotLBR",page:t+"pageLBR",set:t+"setLBR",get:t+"getLBR",del:t+"delLBR",qry:t+"qryLBR"},WorkOrder:{page:t+"qryWO",get:t+"getWO",set:t+"setWO",del:t+"delWO",post:t+"postWO"},WorkTask:{qry:t+"qryWTK",get:t+"getWTK",set:t+"setWTK",del:t+"delWTK"},EquipmentType:{qry:t+"qryEQT",get:t+"getEQT",set:t+"setEQT",del:t+"delEQT"},WorkOrderParts:{qry:t+"qryWOP",set2:t+"set2WOP"},WorkOrderLabors:{qry:t+"qryWOL",set2:t+"set2WOL"},RepairRequest:{page:t+"pageREQ",get:t+"getREQ",set:t+"setREQ",del:t+"delREQ"},Employee:{snapshot:t+"snapshotEMP"},RepairType:{qry:t+"qryRT"}}},67920:function(e,r,a){"use strict";a.d(r,{m:function(){return l}});var t=a(48601);function l(e,r,a){var l;let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"items",s={...e};return null==a||null===(l=a.record)||void 0===l||l.controls.forEach(e=>{let{controlId:r,accessLevel:a}=e,[t,l]=null==r?void 0:r.split(".");t!==n||2!==a||l in s||(s[l]=e=>(null==e?void 0:e[l])!=null),(1===a||4===a)&&l in s&&delete s[l]}),{schema:t.Ry().shape({...Object.keys(s).reduce((e,a)=>(e[a]=t.nK().nullable().test(function(e){var t;let l=this.parent,[,n]=this.path.match(/^(\w+)\[(\d+)\]/)||[],d=(null===(t=this.options.context)||void 0===t?void 0:t[n])||[];if(r||!r&&d.length>1){if(null!==l[a]&&void 0!==l[a]&&0!==l[a]&&""!==s[a]&&!s[a](l))return!1;if(!Object.entries(s).some(e=>{let[,r]=e;return!!r(l)}))return!0}return!!s[a](l)&&void 0!==e}),e),{})}),requiredFields:s}}},1685:function(e,r,a){"use strict";a.d(r,{m:function(){return t}});let t=e=>{let r=window.sessionStorage.getItem(e);return r?JSON.parse(r):null}},98345:function(e,r,a){"use strict";a.d(r,{H:function(){return h},G:function(){return v}});var t=a(45300),l=a(2784),n=a(96026),s=a(38449);a(26612);var d=a(65947),o=a(1685);let i=async(e,r,a)=>{try{let t=await e({extension:r,parameters:a});return r.includes("qry")?t:t.record}catch(e){return null}},c=(e,r,a,t)=>{let l=(e=JSON.parse(JSON.stringify(e))).record.controls,n=l.find(e=>"reference"===e.controlId);return n?n.accessLevel=(null==r?void 0:r.mandatory)?d.$7:d.rr:(null==r?void 0:r.mandatory)?l.push({sgId:0,resourceId:"",controlId:"".concat(t?t+".":"","reference"),accessLevel:(null==r?void 0:r.mandatory)?d.$7:d.rr}):(null==r?void 0:r.readOnly)?l.push({sgId:0,resourceId:"",controlId:"".concat(t?t+".":"","reference"),accessLevel:(null==r?void 0:r.readOnly)?d.rr:d.$7}):l=e.record.controls.filter(e=>"reference"!=e.controlId),a&&l.push({sgId:0,resourceId:"",controlId:"".concat(t?t+".":"","dtId"),accessLevel:d.$7}),{...e,record:{...e.record,controls:l}}},u=async(e,r,a)=>{let t,l;switch(a){case"dtId":let n=(0,o.m)("userData"),d=null==n?void 0:n.userId;l="_userId=".concat(d,"&_functionId=").concat(r),t=s.r.UserFunction.get;break;case"glbSysNumberRange":l="_recordId=".concat(r),t=s.r.SystemFunction.get;break;case"DocumentType":l="_dgId=".concat(r,"&_startAt=",0,"&_pageSize=",50),t=s.r.DocumentType.qry;break;case"DcTypNumberRange":l="_recordId=".concat(r),t=s.r.DocumentType.get;break;case"isExternal":l="_recordId=".concat(r),t=s.r.NumberRange.get;break;default:return null}return await i(e,t,l)},m=async function(e){let r,a,t,l,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,s=arguments.length>2?arguments[2]:void 0,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,o=!(arguments.length>4)||void 0===arguments[4]||arguments[4],i=arguments.length>5?arguments[5]:void 0,m=void 0===d&&n&&await u(e,n,"dtId"),p=null==m?void 0:m.dtId,v="",h=!0;if(m&&void 0===d||"nraId"===d){if(p){let a=await u(e,p,"DcTypNumberRange");r=null==a?void 0:a.nraId,h=!((null==a?void 0:a.activeStatus)<0),r||(v="Assign the document type to a number range")}if((!p||!h)&&o&&n){var x;let r=await u(e,n,"DocumentType");l=(null==r?void 0:null===(x=r.list)||void 0===x?void 0:x.filter(e=>(null==e?void 0:e.activeStatus)===1).length)>0}}if(("nraId"===d||void 0===d)&&n){if((!p||p)&&!r||r&&!h){let a=await u(e,n,"glbSysNumberRange");(r=null==a?void 0:a.nraId)&&l&&(l=!1),h=!0}v=r||l?"":"Assign the system Function to a number range"}d>0&&!r&&(r=d),r&&h?(a={readOnly:null==(t=await u(e,r,"isExternal"))||!t.external,mandatory:null!=t&&!!t.external},s&&(s=await c(s,a,l,i))):!r&&s&&(s=await c(s,a,l,i));let y=i?"".concat(i,".reference"):"reference";return{dtId:p,resetReference:null==a?void 0:a.readOnly,dcTypeRequired:l,reference:{fieldName:y,isEmpty:(null==t?void 0:t.external)!==void 0&&(null==t||!t.external)},errorMessage:v,maxAccess:s,selectNraId:d}};var p=a(65950);function v(e){let{functionId:r,action:a,hasDT:t}=e,{getRequest:s}=(0,l.useContext)(p.$),{stack:d}=(0,n.V)();return{proxyAction:async()=>{let e=await m(s,r,"",void 0,t);(null==e?void 0:e.errorMessage)?d({message:null==e?void 0:e.errorMessage}):await a()}}}function h(e){var r;let{functionId:a,access:s,hasDT:d,enabled:o=!0,objectName:i=""}=e,{getRequest:c}=(0,l.useContext)(p.$),{stack:u}=(0,n.V)(),[v,h]=(0,l.useState)(),x=async e=>{let r=await m(c,a,s,e,d,i);if(!r.errorMessage)return r;u({message:null==r?void 0:r.errorMessage})},y=(0,t.a)({retry:!1,staleTime:0,enabled:o,queryKey:[a,v,!!s,o],queryFn:v||"nraId"===v?()=>x(v):()=>x()});return{documentType:y.data,maxAccess:(null==y?void 0:null===(r=y.data)||void 0===r?void 0:r.maxAccess)||s,changeDT(e){h((null==e?void 0:e.nraId)||"nraId")}}}},29326:function(e,r,a){"use strict";var t=a(52322);a(2784);var l=a(23925),n=a(13980),s=a.n(n),d=a(95291),o=a.n(d),i=a(65947);let c=e=>{var r,a,n;let{children:s,value:d,index:c,maxAccess:u,...m}=e,p="".concat(e.name||"tab",".").concat(c),{accessLevel:v}=null!==(n=(null!==(a=null==u?void 0:null===(r=u.record)||void 0===r?void 0:r.controls)&&void 0!==a?a:[]).find(e=>e.controlId===p))&&void 0!==n?n:{accessLevel:0};if(v===i.A1)return null;let h=d===c;return(0,t.jsx)(l.Z,{role:"tabpanel",hidden:!h,id:"simple-tabpanel-".concat(c),"aria-labelledby":"simple-tab-".concat(c),className:"".concat(o().tabPanel," ").concat(h?o().active:o().hidden),...m,children:s})};c.propTypes={children:s().node,index:s().number.isRequired,value:s().number.isRequired},r.Z=c},9522:function(e,r,a){"use strict";a.d(r,{Y:function(){return m}});var t=a(52322),l=a(23925),n=a(54582),s=a(68696),d=a(44258),o=a(2784),i=a(99266),c=a(52614),u=a.n(c);let m=e=>{var r,a,c,m,p;let{tabs:v,activeTab:h,setActiveTab:x,maxAccess:y,name:g="tab"}=e,b=(null==y?void 0:null===(a=y.record)||void 0===a?void 0:null===(r=a.controls)||void 0===r?void 0:r.filter(e=>{var r;return 4===e.accessLevel&&(null===(r=e.controlId)||void 0===r?void 0:r.startsWith("".concat(g,".")))}).map(e=>e.controlId.split(".")[1]))||[],f=null==v?void 0:null===(c=v.map((e,r)=>({...e,id:r})))||void 0===c?void 0:c.filter((e,r)=>!b.includes(String(r))),I=null===(m=f[h])||void 0===m?void 0:m.id,k=null===(p=f[h])||void 0===p?void 0:p.disabled;return(0,o.useEffect)(()=>{I>=0&&!k&&h!=I&&x(I)},[]),(0,t.jsx)(l.Z,{className:u().tabsContainer,children:(0,t.jsx)(l.Z,{className:u().tabsWrapper,children:(0,t.jsx)(n.Z,{value:h,onChange:(e,r)=>x(r),variant:"scrollable",scrollButtons:f.length>3?"auto":"off","aria-label":"scrollable tabs",classes:{indicator:u().tabsIndicator},className:u().tabs,children:null==f?void 0:f.map(e=>(0,t.jsx)(s.Z,{value:e.id,disabled:null==e?void 0:e.disabled,className:"".concat(u().tabName," ").concat(e.disabled?u().tabDisabled:""),classes:{root:u().tabRoot,selected:u().selectedTab},label:(0,t.jsxs)(l.Z,{display:"flex",alignItems:"center",children:[(0,t.jsx)("span",{children:e.label}),e.id===h&&(null==e?void 0:e.onRefetch)&&(0,t.jsx)(d.Z,{size:"small",className:u().refreshButton,onClick:r=>{r.stopPropagation(),e.onRefetch()},children:(0,t.jsx)(i.Z,{className:u().refreshIcon})})]})},e.id))})})})}},95291:function(e){e.exports={tabPanel:"CustomTabPanel_tabPanel__80Dfu",active:"CustomTabPanel_active___6Uvb",hidden:"CustomTabPanel_hidden__y9566"}},52614:function(e){e.exports={customTabPanel:"CustomTabs_customTabPanel__Ztocv",hidden:"CustomTabs_hidden__lZpM7",tabsContainer:"CustomTabs_tabsContainer__28Syi",tabsWrapper:"CustomTabs_tabsWrapper__mlxxj",tabs:"CustomTabs_tabs__25pli",tabName:"CustomTabs_tabName__XzMCn",tabRoot:"CustomTabs_tabRoot__WVR1E",tabDisabled:"CustomTabs_tabDisabled__VauYR",selectedTab:"CustomTabs_selectedTab__sZzwF",tabsIndicator:"CustomTabs_tabsIndicator__89Lek",refreshButton:"CustomTabs_refreshButton__P2mzl",refreshIcon:"CustomTabs_refreshIcon__ADVWF"}}},function(e){e.O(0,[49774,92888,40179],function(){return e(e.s=49153)}),_N_E=e.O()}]);