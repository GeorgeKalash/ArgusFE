(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[36979],{99766:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/maint-temp",function(){return a(61625)}])},61625:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return F}});var n=a(52322),l=a(2784),r=a(62202),s=a(69387),d=a(27723),i=a(65950),o=a(71987),u=a(26612),c=a(31389),m=a(33625),v=a(62362),b=a(61802),h=a(19473),p=a(54736),x=a(29326),y=a(9522),g=a(48601),T=a(82737),q=a(5088),f=a(80983),P=a(60218),E=a(8661),_=a(84100);function R(e){let{labels:t,maxAccess:a,store:s,setStore:d}=e,{getRequest:m,postRequest:b}=(0,l.useContext)(i.$),{platformLabels:x}=(0,l.useContext)(h.l),y=null==s?void 0:s.recordId,R=(0,o.E)({endpointId:p.m.MaintenanceTemplates.page}),{formik:M}=(0,f.c)({maxAccess:a,initialValues:{recordId:null,name:"",primaryMeter:null,secondaryMeter:null},validationSchema:g.Ry({name:g.Z_().required(),primaryMeter:g.Z_().required()}),onSubmit:async e=>{let t=await b({extension:p.m.MaintenanceTemplates.set,record:JSON.stringify(e)});r.ZP.success(e.recordId?x.Edited:x.Added),e.recordId||(M.setFieldValue("recordId",t.recordId),d(e=>({...e,recordId:t.recordId}))),R()}}),C=!!M.values.recordId;return(0,l.useEffect)(()=>{!async function(){if(y){let e=await m({extension:p.m.MaintenanceTemplates.get,parameters:"_recordId=".concat(y)});M.setValues(null==e?void 0:e.record)}}()},[]),(0,n.jsx)(T.Z,{resourceId:u.i.MaintenanceTemplates,form:M,maxAccess:a,editMode:C,children:(0,n.jsx)(c.R,{children:(0,n.jsx)(v.Q,{children:(0,n.jsxs)(P.ZP,{container:!0,spacing:2,children:[(0,n.jsx)(P.ZP,{item:!0,xs:12,children:(0,n.jsx)(q.Z,{name:"name",label:t.name,value:M.values.name,required:!0,maxAccess:a,maxLength:"30",onChange:M.handleChange,onClear:()=>M.setFieldValue("name",""),error:M.touched.name&&!!M.errors.name})}),(0,n.jsx)(P.ZP,{item:!0,xs:12,children:(0,n.jsx)(E.Z,{datasetId:_.v.RS_EQUIPMENT_METER,label:t.primaryMeter,name:"primaryMeter",values:M.values,valueField:"key",displayField:"value",maxAccess:a,required:!0,onChange:(e,t)=>{M.setFieldValue("primaryMeter",(null==t?void 0:t.key)||null)},error:M.touched.primaryMeter&&!!M.errors.primaryMeter})}),(0,n.jsx)(P.ZP,{item:!0,xs:12,children:(0,n.jsx)(E.Z,{datasetId:_.v.RS_EQUIPMENT_METER,label:t.secondaryMeter,name:"secondaryMeter",values:M.values,valueField:"key",displayField:"value",maxAccess:a,onChange:(e,t)=>{M.setFieldValue("secondaryMeter",(null==t?void 0:t.key)||null)},error:M.touched.secondaryMeter&&!!M.errors.secondaryMeter})})]})})})})}var M=a(19689),C=a(91406),j=a(21581),I=a(54074);function Z(e){var t,a,s,d,u,m,b,x,y,T,q,R,Z,S,k,F,N,A,O,W;let{taskInfo:w,maxAccess:V,labels:L,window:Q}=e,{getRequest:D,postRequest:B}=(0,l.useContext)(i.$),{platformLabels:H}=(0,l.useContext)(h.l),{templateId:z,taskId:J}=w||{},Y=(0,o.E)({endpointId:p.m.MaintenanceTemplateTask.qry}),{formik:K}=(0,f.c)({maxAccess:V,initialValues:{templateId:z,taskId:J,tbd:!1,tbdEvery:null,tbdFrequency:null,tbdReminder:null,tbh:!1,tbhEvery:null,tbhReminder:null,expectedLaborHrs:null,notes:""},validationSchema:g.Ry({taskId:g.Z_().required(),tbdEvery:g.Rx().nullable().min(1).max(32767).test("required-when-tbd","tbdEvery is required",function(e){let{tbd:t}=this.parent;return!t||e}),tbdReminder:g.Rx().nullable().min(1).max(32767).test("required-when-tbd","tbdReminder is required",function(e){let{tbd:t}=this.parent;return!t||e}),tbdFrequency:g.Rx().nullable().test("required-when-tbd","tbdFrequency is required",function(e){let{tbd:t}=this.parent;return!t||null!==e}),tbhEvery:g.Rx().nullable().min(1).max(32767).test("required-when-tbh","tbhEvery is required",function(e){let{tbh:t}=this.parent;return!t||e}),tbhReminder:g.Rx().nullable().min(1).max(32767).test("required-when-tbh","tbhReminder is required",function(e){let{tbh:t}=this.parent;return!t||e}),expectedLaborHrs:g.Rx().min(1).max(32767).nullable()}),onSubmit:async e=>{await B({extension:p.m.MaintenanceTemplateTask.set,record:JSON.stringify(e)}),r.ZP.success(z&&J?H.Edited:H.Saved),Y(),Q.close()}});return(0,l.useEffect)(()=>{!async function(){if(z&&J){let e=await D({extension:p.m.MaintenanceTemplateTask.get,parameters:"_templateId=".concat(z,"&_taskId=").concat(J)});K.setValues(null==e?void 0:e.record)}}()},[]),(0,n.jsx)(I.Z,{onSave:K.handleSubmit,maxAccess:V,editMode:!0,children:(0,n.jsx)(c.R,{children:(0,n.jsx)(v.Q,{children:(0,n.jsxs)(P.ZP,{container:!0,spacing:2,children:[(0,n.jsx)(P.ZP,{item:!0,xs:12,children:(0,n.jsx)(E.Z,{endpointId:p.m.PreventiveMaintenanceTasks.qry,name:"taskId",label:L.name,values:K.values,valueField:"recordId",displayField:"name",required:!0,readOnly:J,maxAccess:V,onChange:(e,t)=>{K.setFieldValue("taskId",(null==t?void 0:t.recordId)||null)},error:K.touched.taskId&&!!K.errors.taskId})}),(0,n.jsx)(P.ZP,{item:!0,xs:12,children:(0,n.jsx)(M.Z,{name:"tbd",value:null===(t=K.values)||void 0===t?void 0:t.tbd,onChange:e=>{K.setFieldValue("tbdEvery",null),K.setFieldValue("tbdReminder",null),K.setFieldValue("tbdFrequency",null),K.setFieldValue("tbd",e.target.checked)},label:L.trackByDate,maxAccess:V})}),(0,n.jsx)(P.ZP,{item:!0,xs:6,children:(0,n.jsx)(C.Z,{name:"tbdEvery",label:L.due,value:null==K?void 0:null===(a=K.values)||void 0===a?void 0:a.tbdEvery,maxAccess:V,readOnly:!(null==K?void 0:null===(s=K.values)||void 0===s?void 0:s.tbd),required:null==K?void 0:null===(d=K.values)||void 0===d?void 0:d.tbd,onChange:K.handleChange,allowNegative:!1,onClear:()=>K.setFieldValue("tbdEvery",null),error:K.touched.tbdEvery&&!!K.errors.tbdEvery})}),(0,n.jsx)(P.ZP,{item:!0,xs:6,children:(0,n.jsx)(E.Z,{datasetId:_.v.RS_FREQUENCY,label:L.frequency,name:"tbdFrequency",values:K.values,valueField:"key",displayField:"value",maxAccess:V,readOnly:!(null==K?void 0:null===(u=K.values)||void 0===u?void 0:u.tbd),required:null==K?void 0:null===(m=K.values)||void 0===m?void 0:m.tbd,onChange:(e,t)=>{K.setFieldValue("tbdFrequency",(null==t?void 0:t.key)||null)},error:K.touched.tbdFrequency&&!!K.errors.tbdFrequency})}),(0,n.jsx)(P.ZP,{item:!0,xs:12,children:(0,n.jsx)(C.Z,{name:"tbdReminder",label:L.reminder,value:null==K?void 0:null===(b=K.values)||void 0===b?void 0:b.tbdReminder,maxAccess:V,readOnly:!(null==K?void 0:null===(x=K.values)||void 0===x?void 0:x.tbd),required:null==K?void 0:null===(y=K.values)||void 0===y?void 0:y.tbd,allowNegative:!1,onChange:K.handleChange,onClear:()=>K.setFieldValue("tbdReminder",null),error:K.touched.tbdReminder&&!!K.errors.tbdReminder})}),(0,n.jsx)(P.ZP,{item:!0,xs:12,children:(0,n.jsx)(M.Z,{name:"tbh",value:null===(T=K.values)||void 0===T?void 0:T.tbh,onChange:e=>{K.setFieldValue("tbhEvery",null),K.setFieldValue("tbhReminder",null),K.setFieldValue("tbh",e.target.checked)},label:L.trackByHours,maxAccess:V})}),(0,n.jsx)(P.ZP,{item:!0,xs:12,children:(0,n.jsx)(C.Z,{name:"tbhEvery",label:L.due,value:null==K?void 0:null===(q=K.values)||void 0===q?void 0:q.tbhEvery,maxAccess:V,readOnly:!(null==K?void 0:null===(R=K.values)||void 0===R?void 0:R.tbh),required:null==K?void 0:null===(Z=K.values)||void 0===Z?void 0:Z.tbh,onChange:K.handleChange,onClear:()=>K.setFieldValue("tbhEvery",null),error:K.touched.tbhEvery&&!!K.errors.tbhEvery})}),(0,n.jsx)(P.ZP,{item:!0,xs:12,children:(0,n.jsx)(C.Z,{name:"tbhReminder",label:L.reminder,value:null==K?void 0:null===(S=K.values)||void 0===S?void 0:S.tbhReminder,maxAccess:V,readOnly:!(null==K?void 0:null===(k=K.values)||void 0===k?void 0:k.tbh),required:null==K?void 0:null===(F=K.values)||void 0===F?void 0:F.tbh,onChange:K.handleChange,onClear:()=>K.setFieldValue("tbhReminder",null),error:K.touched.tbhReminder&&!!K.errors.tbhReminder})}),(0,n.jsx)(P.ZP,{item:!0,xs:12,children:(0,n.jsx)(C.Z,{name:"expectedLaborHrs",label:L.labor,value:null==K?void 0:null===(N=K.values)||void 0===N?void 0:N.expectedLaborHrs,maxAccess:V,allowNegative:!1,onChange:K.handleChange,onClear:()=>K.setFieldValue("expectedLaborHrs",null),error:K.touched.expectedLaborHrs&&!!K.errors.expectedLaborHrs})}),(0,n.jsx)(P.ZP,{item:!0,xs:12,children:(0,n.jsx)(j.Z,{name:"notes",label:L.notes,value:null==K?void 0:null===(A=K.values)||void 0===A?void 0:A.notes,maxAccess:V,rows:3,maxLength:"300",onChange:K.handleChange,onClear:()=>K.setFieldValue("notes",""),error:(null===(O=K.touched.header)||void 0===O?void 0:O.notes)&&!!(null===(W=K.errors.header)||void 0===W?void 0:W.notes)})})]})})})})}function S(e){let{store:t,labels:a,maxAccess:x}=e,{getRequest:y,postRequest:g}=(0,l.useContext)(i.$),{platformLabels:T}=(0,l.useContext)(h.l),{stack:q}=(0,b.zY)(),f=null==t?void 0:t.recordId;async function P(){return await y({extension:p.m.MaintenanceTemplateTask.qry,parameters:"_templateId=".concat(f)})}let{query:{data:E},invalidate:_}=(0,o.J)({queryFn:P,endpointId:p.m.MaintenanceTemplateTask.qry,datasetId:u.i.MaintenanceTemplates,enabled:!!f}),R=[{field:"taskName",headerName:a.name,flex:1},{field:"recurring",headerName:a.recurring,flex:1},{field:"reminder",headerName:a.reminder,flex:1}];function M(e){q({Component:Z,props:{taskInfo:{taskId:null==e?void 0:e.taskId,templateId:f},maxAccess:x,labels:a},width:600,height:550,title:a.maintenanceTemplateTask})}let C=async e=>{await g({extension:p.m.MaintenanceTemplateTask.del,record:JSON.stringify(e)}),r.ZP.success(T.Deleted),_()};return(0,n.jsxs)(c.R,{children:[(0,n.jsx)(m.g,{children:(0,n.jsx)(d.Z,{onAdd:()=>{M()},maxAccess:x})}),(0,n.jsx)(v.Q,{children:(0,n.jsx)(s.Z,{name:"MMTTable",columns:R,gridData:E,rowId:["templateId"],onEdit:e=>{M(e)},onDelete:C,pagination:!1,maxAccess:x})})]})}function k(e){let{labels:t,recordId:a,maxAccess:r}=e,[s,d]=(0,l.useState)(0),[i,o]=(0,l.useState)({recordId:a}),u=[{label:t.info},{label:t.tasks,disabled:!i.recordId}];return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(y.Y,{tabs:u,activeTab:s,setActiveTab:d,maxAccess:r}),(0,n.jsx)(x.Z,{index:0,value:s,maxAccess:r,children:(0,n.jsx)(R,{store:i,setStore:o,labels:t,maxAccess:r})}),(0,n.jsx)(x.Z,{index:1,value:s,maxAccess:r,children:(0,n.jsx)(S,{store:i,labels:t,maxAccess:r})})]})}function F(){let{getRequest:e,postRequest:t}=(0,l.useContext)(i.$),{platformLabels:a}=(0,l.useContext)(h.l),{stack:x}=(0,b.zY)();async function y(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{_startAt:a=0,_pageSize:n=50}=t;return{...await e({extension:p.m.MaintenanceTemplates.page,parameters:"_startAt=".concat(a,"&_pageSize=").concat(n,"&_filter=")}),_startAt:a}}let{query:{data:g},labels:T,paginationParameters:q,refetch:f,invalidate:P,access:E}=(0,o.J)({queryFn:y,endpointId:p.m.MaintenanceTemplates.page,datasetId:u.i.MaintenanceTemplates}),_=[{field:"name",headerName:T.name,flex:1},{field:"primaryMeterName",headerName:T.primaryMeter,flex:1},{field:"secondaryMeterName",headerName:T.secondaryMeter,flex:1}];function R(e){x({Component:k,props:{labels:T,recordId:e,maxAccess:E},width:800,height:600,title:T.maintenanceTemplates})}let M=async e=>{await t({extension:p.m.MaintenanceTemplates.del,record:JSON.stringify(e)}),r.ZP.success(a.Deleted),P()};return(0,n.jsxs)(c.R,{children:[(0,n.jsx)(m.g,{children:(0,n.jsx)(d.Z,{onAdd:()=>{R()},maxAccess:E})}),(0,n.jsx)(v.Q,{children:(0,n.jsx)(s.Z,{name:"table",columns:_,gridData:g,rowId:["recordId"],onEdit:e=>{R(null==e?void 0:e.recordId)},onDelete:M,pageSize:50,paginationType:"api",paginationParameters:q,refetch:f,maxAccess:E})})]})}},54736:function(e,t,a){"use strict";a.d(t,{m:function(){return l}});let n="RS.asmx/",l={RepairName:{page:n+"pageRNA",qry:n+"qryRNA",get:n+"getRNA",set:n+"setRNA",del:n+"delRNA"},WorkOrderTypes:{page:n+"pageWOT",qry:n+"qryWOT",get:n+"getWOT",set:n+"setWOT",del:n+"delWOT"},RepairType:{page:n+"pageRT",get:n+"getRT",set:n+"setRT",del:n+"delRT"},SpareParts:{snapshot:n+"snapshotSP",page:n+"pageSP",get:n+"getSP",set:n+"setSP",del:n+"delSP"},InspectionTemplate:{get2:n+"get2ITE",page:n+"pageITE",set2:n+"set2ITE",del:n+"delITE"},Department:{page:n+"pageDEP",get:n+"getDEP",set:n+"setDEP",del:n+"delDEP"},Warehouse:{page:n+"pageWH",qry:n+"qryWH",set:n+"setWH",get:n+"getWH",del:n+"delWH"},PreventiveMaintenanceTasks:{qry:n+"qryPMT",page:n+"pagePMT",qry:n+"qryPMT",get:n+"getPMT",set:n+"setPMT",del:n+"delPMT"},Equipment:{qry:n+"qryEQP",page:n+"pageEQP",get:n+"getEQP",set:n+"setEQP",del:n+"delEQP",snapshot:n+"snapshotEQP"},SpManufacturer:{page:n+"pageSPM",get:n+"getSPM",set:n+"setSPM",del:n+"delSPM",qry:n+"qrySPM"},JobPosition:{page:n+"pagePOS",qry:n+"qryPOS",get:n+"getPOS",set:n+"setPOS",del:n+"delPOS"},SpCategory:{page:n+"pageSPC",get:n+"getSPC",set:n+"setSPC",del:n+"delSPC",qry:n+"qrySPC"},MaintenanceTemplates:{page:n+"pageMTE",get:n+"getMTE",set:n+"setMTE",del:n+"delMTE",qry:n+"qryMTE"},MaintenanceTemplateTask:{qry:n+"qryMTT",get:n+"getMTT",set:n+"setMTT",del:n+"delMTT"},RsLabors:{qry:n+"qryLBR",snapshot:n+"snapshotLBR",page:n+"pageLBR",set:n+"setLBR",get:n+"getLBR",del:n+"delLBR",qry:n+"qryLBR"},WorkOrder:{page:n+"qryWO",get:n+"getWO",set:n+"setWO",del:n+"delWO",post:n+"postWO"},WorkTask:{qry:n+"qryWTK",get:n+"getWTK",set:n+"setWTK",del:n+"delWTK"},EquipmentType:{qry:n+"qryEQT",get:n+"getEQT",set:n+"setEQT",del:n+"delEQT"},WorkOrderParts:{qry:n+"qryWOP",set2:n+"set2WOP"},WorkOrderLabors:{qry:n+"qryWOL",set2:n+"set2WOL"},RepairRequest:{page:n+"pageREQ",get:n+"getREQ",set:n+"setREQ",del:n+"delREQ"},Employee:{snapshot:n+"snapshotEMP"},RepairType:{qry:n+"qryRT"}}},29326:function(e,t,a){"use strict";var n=a(52322);a(2784);var l=a(23925),r=a(13980),s=a.n(r),d=a(95291),i=a.n(d),o=a(65947);let u=e=>{var t,a,r;let{children:s,value:d,index:u,maxAccess:c,...m}=e,v="".concat(e.name||"tab",".").concat(u),{accessLevel:b}=null!==(r=(null!==(a=null==c?void 0:null===(t=c.record)||void 0===t?void 0:t.controls)&&void 0!==a?a:[]).find(e=>e.controlId===v))&&void 0!==r?r:{accessLevel:0};if(b===o.A1)return null;let h=d===u;return(0,n.jsx)(l.Z,{role:"tabpanel",hidden:!h,id:"simple-tabpanel-".concat(u),"aria-labelledby":"simple-tab-".concat(u),className:"".concat(i().tabPanel," ").concat(h?i().active:i().hidden),...m,children:s})};u.propTypes={children:s().node,index:s().number.isRequired,value:s().number.isRequired},t.Z=u},9522:function(e,t,a){"use strict";a.d(t,{Y:function(){return m}});var n=a(52322),l=a(23925),r=a(54582),s=a(68696),d=a(44258),i=a(2784),o=a(99266),u=a(52614),c=a.n(u);let m=e=>{var t,a,u,m,v;let{tabs:b,activeTab:h,setActiveTab:p,maxAccess:x,name:y="tab"}=e,g=(null==x?void 0:null===(a=x.record)||void 0===a?void 0:null===(t=a.controls)||void 0===t?void 0:t.filter(e=>{var t;return 4===e.accessLevel&&(null===(t=e.controlId)||void 0===t?void 0:t.startsWith("".concat(y,".")))}).map(e=>e.controlId.split(".")[1]))||[],T=null==b?void 0:null===(u=b.map((e,t)=>({...e,id:t})))||void 0===u?void 0:u.filter((e,t)=>!g.includes(String(t))),q=null===(m=T[h])||void 0===m?void 0:m.id,f=null===(v=T[h])||void 0===v?void 0:v.disabled;return(0,i.useEffect)(()=>{q>=0&&!f&&h!=q&&p(q)},[]),(0,n.jsx)(l.Z,{className:c().tabsContainer,children:(0,n.jsx)(l.Z,{className:c().tabsWrapper,children:(0,n.jsx)(r.Z,{value:h,onChange:(e,t)=>p(t),variant:"scrollable",scrollButtons:T.length>3?"auto":"off","aria-label":"scrollable tabs",classes:{indicator:c().tabsIndicator},className:c().tabs,children:null==T?void 0:T.map(e=>(0,n.jsx)(s.Z,{value:e.id,disabled:null==e?void 0:e.disabled,className:"".concat(c().tabName," ").concat(e.disabled?c().tabDisabled:""),classes:{root:c().tabRoot,selected:c().selectedTab},label:(0,n.jsxs)(l.Z,{display:"flex",alignItems:"center",children:[(0,n.jsx)("span",{children:e.label}),e.id===h&&(null==e?void 0:e.onRefetch)&&(0,n.jsx)(d.Z,{size:"small",className:c().refreshButton,onClick:t=>{t.stopPropagation(),e.onRefetch()},children:(0,n.jsx)(o.Z,{className:c().refreshIcon})})]})},e.id))})})})}},95291:function(e){e.exports={tabPanel:"CustomTabPanel_tabPanel__80Dfu",active:"CustomTabPanel_active___6Uvb",hidden:"CustomTabPanel_hidden__y9566"}},52614:function(e){e.exports={customTabPanel:"CustomTabs_customTabPanel__Ztocv",hidden:"CustomTabs_hidden__lZpM7",tabsContainer:"CustomTabs_tabsContainer__28Syi",tabsWrapper:"CustomTabs_tabsWrapper__mlxxj",tabs:"CustomTabs_tabs__25pli",tabName:"CustomTabs_tabName__XzMCn",tabRoot:"CustomTabs_tabRoot__WVR1E",tabDisabled:"CustomTabs_tabDisabled__VauYR",selectedTab:"CustomTabs_selectedTab__sZzwF",tabsIndicator:"CustomTabs_tabsIndicator__89Lek",refreshButton:"CustomTabs_refreshButton__P2mzl",refreshIcon:"CustomTabs_refreshIcon__ADVWF"}}},function(e){e.O(0,[49774,92888,40179],function(){return e(e.s=99766)}),_N_E=e.O()}]);