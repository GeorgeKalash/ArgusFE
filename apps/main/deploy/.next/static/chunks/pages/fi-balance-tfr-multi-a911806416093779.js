(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[37510],{18444:function(e,n,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/fi-balance-tfr-multi",function(){return a(26859)}])},26859:function(e,n,a){"use strict";a.r(n),a.d(n,{default:function(){return q}});var l=a(52322),r=a(2784),d=a(71987),o=a(65950),t=a(69387),i=a(62202),u=a(61802),c=a(26612),s=a(31389),v=a(33625),m=a(62362),h=a(19473),f=a(36908),p=a(98345),I=a(7121),y=a(89330),x=a(39812),g=a(60218),F=a(48601),A=a(82737),w=a(5088),b=a(21581),N=a(8661),j=a(38449),k=a(76399),Z=a(80983),C=a(25870),_=a(27423),T=a(91406),R=a(22341),S=a(16463);function O(e){var n,a,t,f,O,q,V,D,P,M,B,E,H,G,L,J,$,z,U,K,Q,X,W,Y,ee,en,ea,el,er,ed,eo,et,ei,eu,ec,es,ev,em,eh,ef,ep,eI,ey,ex,eg,eF,eA;let{labels:ew,access:eb,recordId:eN,window:ej}=e,{getRequest:ek,postRequest:eZ}=(0,r.useContext)(o.$),{platformLabels:eC,userDefaultsData:e_}=(0,r.useContext)(h.l),{stack:eT}=(0,u.zY)(),{documentType:eR,maxAccess:eS,changeDT:eO}=(0,p.H)({functionId:I.J.BalanceTransferMultiAccount,access:eb,enabled:!eN,objectName:"header"}),eq=(0,d.E)({endpointId:C.H.BalanceTransferMultiAccounts.page}),eV=parseInt(null==e_?void 0:null===(a=e_.list)||void 0===a?void 0:null===(n=a.find(e=>"plantId"===e.key))||void 0===n?void 0:n.value),eD=parseInt(null==e_?void 0:null===(f=e_.list)||void 0===f?void 0:null===(t=f.find(e=>"spId"===e.key))||void 0===t?void 0:t.value),{formik:eP}=(0,Z.c)({maxAccess:eS,documentType:{key:"header.dtId",value:null==eR?void 0:eR.dtId},initialValues:{recordId:eN,header:{recordId:null,reference:"",dtId:null,accountId:null,currencyId:null,amount:null,exRate:1,rateCalcMethod:1,baseAmount:0,plantId:eV,spId:eD,notes:"",date:new Date,status:1},rows:[{id:1,transferId:eN,baseAmount:0,amount:0,notes:"",seqNo:1,accountId:null}]},validateOnChange:!0,validationSchema:F.Ry({header:F.Ry({plantId:F.Rx().required(),accountId:F.Z_().required(),currencyId:F.Rx().required(),date:F.hT().required(),amount:F.Rx().required()}),rows:F.IX().of(F.Ry().shape({accountRef:F.Z_().required()})).required()}),onSubmit:async e=>{let n={header:{...e.header,date:(0,x.ku)(e.header.date)},list:eP.values.rows.map((n,a)=>{var l;return{...n,acoId:null!==(l=e.recordId)&&void 0!==l?l:0,seqNo:a+1}})},a=await eZ({extension:C.H.BalanceTransferMultiAccounts.set2,record:JSON.stringify(n)});i.ZP.success(e.recordId?eC.Edited:eC.Added),eq(),e$(null==a?void 0:a.recordId)}}),eM=!!eP.values.recordId,eB=3===eP.values.header.status;async function eE(){await eZ({extension:C.H.BalanceTransferMultiAccounts.post,record:JSON.stringify({...eP.values.header,date:(0,x.ku)(eP.values.header.date)})}),i.ZP.success(eC.Posted),ej.close(),eq()}async function eH(){let e=await eP.validateForm();if(e.header&&Object.keys(e.header).length){let n={header:{...eP.touched.header}};Object.keys(e.header).forEach(e=>{eP.touched.header&&eP.touched.header[e]||(n.header[e]=!0)}),eP.setTouched(n,!0)}}async function eG(e){if(e){let{record:n}=await ek({extension:C.H.FIDocTypeDefaults.get,parameters:"_dtId=".concat(e)});eP.setFieldValue("header.plantId",(null==n?void 0:n.plantId)||eV),eP.setFieldValue("header.spId",(null==n?void 0:n.spId)||eD)}}(0,r.useEffect)(()=>{var e,n;eP.values.header.dtId&&!eN&&eG(null==eP?void 0:null===(n=eP.values)||void 0===n?void 0:null===(e=n.header)||void 0===e?void 0:e.dtId)},[eP.values.header.dtId]);let eL=[{component:"resourcelookup",label:ew.toAccount,name:"accountRef",props:{endpointId:C.H.Account.snapshot,valueField:"recordId",displayField:"reference",displayFieldWidth:2,mapping:[{from:"name",to:"accountName"},{from:"reference",to:"accountRef"},{from:"groupName",to:"fromGroup"},{from:"recordId",to:"accountId"}],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}]}},{component:"textfield",label:ew.accountName,name:"accountName",props:{readOnly:!0}},{component:"textfield",label:ew.group,name:"fromGroup",props:{readOnly:!0}},{component:"numberfield",name:"amount",label:ew.amount,props:{maxLength:15,decimalScale:2}},{component:"textfield",label:ew.notes,name:"notes"}],eJ=async()=>{let e=await eZ({extension:C.H.BalanceTransferMultiAccounts.unpost,record:JSON.stringify(eP.values.header)});i.ZP.success(eC.Unposted),eq(),e$(null==e?void 0:e.recordId)};async function e$(e){var n,a,l,r,d,o,t;let i=await ek({extension:C.H.BalanceTransferMultiAccounts.get2,parameters:"_recordId=".concat(e)}),u=i.record.list.length>0?i.record.list.map((e,n)=>({...e,fromGroup:e.accountGroupName,id:n+1})):eP.values.rows;return eP.setValues({recordId:null==i?void 0:null===(a=i.record)||void 0===a?void 0:null===(n=a.header)||void 0===n?void 0:n.recordId,header:{...null==i?void 0:null===(l=i.record)||void 0===l?void 0:l.header,fromGroup:null==i?void 0:null===(d=i.record)||void 0===d?void 0:null===(r=d.header)||void 0===r?void 0:r.accountGroupName,date:(0,x.a1)(null==i?void 0:null===(t=i.record)||void 0===t?void 0:null===(o=t.header)||void 0===o?void 0:o.date)},rows:u}),null==i?void 0:i.record}(0,r.useEffect)(()=>{eN&&e$(eN)},[]);let ez=[{key:"GL",condition:!0,onClick:"onClickGL",valuesPath:eP.values.header,datasetId:c.i.GLBalanceTransferMultiAccounts,disabled:!eM},{key:"FI Trx",condition:!0,onClick:"onClickIT",disabled:!eM},{key:"Locked",condition:eB,onClick:"onUnpostConfirmation",onSuccess:eJ,disabled:!eM},{key:"Unlocked",condition:!eB,onClick:eE,disabled:!eM},{key:"AccountSummary",condition:!0,onClick:()=>{eT({Component:S.Z,props:{accountId:parseInt(eP.values.header.accountId),moduleId:1}})},disabled:!eP.values.header.accountId}],eU=null===(q=eP.values)||void 0===q?void 0:null===(O=q.rows)||void 0===O?void 0:O.reduce((e,n)=>{var a;return e+(parseFloat(null===(a=n.amount)||void 0===a?void 0:a.toString().replace(/,/g,""))||0)},0);return(0,l.jsx)(A.Z,{resourceId:c.i.BalanceTransferMultiAccounts,functionId:I.J.BalanceTransferMultiAccount,form:eP,maxAccess:eS,actions:ez,editMode:eM,previewReport:eM,disabledSubmit:eB,children:(0,l.jsxs)(s.R,{children:[(0,l.jsx)(v.g,{children:(0,l.jsxs)(g.ZP,{container:!0,spacing:2,children:[(0,l.jsx)(g.ZP,{item:!0,xs:6,children:(0,l.jsx)(N.Z,{endpointId:j.r.DocumentType.qry,parameters:"_startAt=0&_pageSize=1000&_dgId=".concat(I.J.BalanceTransferMultiAccount),name:"header.dtId",label:ew.documentType,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],readOnly:eM,valueField:"recordId",displayField:["reference","name"],values:eP.values.header,maxAccess:eS,onChange:(e,n)=>{eP.setFieldValue("header.dtId",(null==n?void 0:n.recordId)||null),eO(n)},error:(null===(V=eP.touched.header)||void 0===V?void 0:V.dtId)&&!!(null===(D=eP.errors.header)||void 0===D?void 0:D.dtId)})}),(0,l.jsx)(g.ZP,{item:!0,xs:6,children:(0,l.jsx)(N.Z,{endpointId:j.r.Plant.qry,name:"header.plantId",label:ew.plant,readOnly:eB,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:eP.values.header,required:!0,valueField:"recordId",displayField:["reference","name"],maxAccess:eS,onChange:(e,n)=>{eP.setFieldValue("header.plantId",(null==n?void 0:n.recordId)||null)},error:(null==eP?void 0:null===(M=eP.touched)||void 0===M?void 0:null===(P=M.header)||void 0===P?void 0:P.plantId)&&!!(null==eP?void 0:null===(E=eP.errors)||void 0===E?void 0:null===(B=E.header)||void 0===B?void 0:B.plantId)})}),(0,l.jsx)(g.ZP,{item:!0,xs:6,children:(0,l.jsx)(w.Z,{name:"header.reference",label:ew.reference,value:null==eP?void 0:null===(G=eP.values)||void 0===G?void 0:null===(H=G.header)||void 0===H?void 0:H.reference,maxAccess:!eM&&eS,maxLength:"30",readOnly:eM,onChange:eP.handleChange,onClear:()=>eP.setFieldValue("header.reference",""),error:(null===(L=eP.touched.header)||void 0===L?void 0:L.reference)&&!!(null===(J=eP.errors.header)||void 0===J?void 0:J.reference)})}),(0,l.jsx)(g.ZP,{item:!0,xs:6,children:(0,l.jsx)(N.Z,{endpointId:R.P.SalesPerson.qry,name:"header.spId",label:ew.salesPerson,filter:e=>e.plantId===eP.values.header.plantId,readOnly:!eP.values.header.plantId||eB,valueField:"recordId",columnsInDropDown:[{key:"spRef",value:"Reference"},{key:"name",value:"Name"}],displayField:["spRef","name"],values:eP.values.header,onChange:(e,n)=>{eP.setFieldValue("header.spId",(null==n?void 0:n.recordId)||null)},error:(null==eP?void 0:null===(z=eP.touched)||void 0===z?void 0:null===($=z.header)||void 0===$?void 0:$.spId)&&!!(null==eP?void 0:null===(K=eP.errors)||void 0===K?void 0:null===(U=K.header)||void 0===U?void 0:U.spId)})}),(0,l.jsx)(g.ZP,{item:!0,xs:6,children:(0,l.jsx)(y.Z,{name:"header.date",label:ew.date,readOnly:eB,value:null==eP?void 0:null===(Q=eP.values)||void 0===Q?void 0:Q.header.date,onChange:eP.setFieldValue,required:!0,maxAccess:eS,onClear:()=>eP.setFieldValue("header.date",null),error:(null==eP?void 0:null===(W=eP.touched)||void 0===W?void 0:null===(X=W.header)||void 0===X?void 0:X.date)&&!!(null==eP?void 0:null===(ee=eP.errors)||void 0===ee?void 0:null===(Y=ee.header)||void 0===Y?void 0:Y.date)})}),(0,l.jsx)(g.ZP,{item:!0,xs:6}),(0,l.jsx)(g.ZP,{item:!0,xs:6,children:(0,l.jsx)(_.U,{endpointId:C.H.Account.snapshot,name:"header.accountId",label:ew.accountName,valueField:"reference",displayField:"name",valueShow:"accountRef",secondValueShow:"accountName",formObject:eP.values.header,form:eP,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],onChange:(e,n)=>{eP.setFieldValue("header.accountRef",(null==n?void 0:n.reference)||""),eP.setFieldValue("header.accountName",(null==n?void 0:n.name)||""),eP.setFieldValue("header.fromGroup",(null==n?void 0:n.groupName)||""),eP.setFieldValue("header.accountId",(null==n?void 0:n.recordId)||null)},errorCheck:"header.accountId",secondFieldName:"header.accountName",maxAccess:eS,required:!0,readOnly:eB,displayFieldWidth:3})}),(0,l.jsx)(g.ZP,{item:!0,xs:6,children:(0,l.jsx)(w.Z,{name:"header.fromGroup",value:null==eP?void 0:null===(ea=eP.values)||void 0===ea?void 0:null===(en=ea.header)||void 0===en?void 0:en.fromGroup,label:ew.fromGroup,readOnly:!0})}),(0,l.jsx)(g.ZP,{item:!0,xs:6,children:(0,l.jsx)(N.Z,{endpointId:j.r.Currency.qry,name:"header.currencyId",label:ew.currency,valueField:"recordId",readOnly:eM,required:!0,displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:eP.values.header,maxAccess:eS,onChange:(e,n)=>{eP.setFieldValue("header.currencyId",(null==n?void 0:n.recordId)||null)},error:(null==eP?void 0:null===(er=eP.touched)||void 0===er?void 0:null===(el=er.header)||void 0===el?void 0:el.currencyId)&&!!(null==eP?void 0:null===(eo=eP.errors)||void 0===eo?void 0:null===(ed=eo.header)||void 0===ed?void 0:ed.currencyId)})}),(0,l.jsx)(g.ZP,{item:!0,xs:6}),(0,l.jsx)(g.ZP,{item:!0,xs:6,children:(0,l.jsx)(T.Z,{name:"header.amount",required:!0,label:ew.amount,value:null==eP?void 0:null===(ei=eP.values)||void 0===ei?void 0:null===(et=ei.header)||void 0===et?void 0:et.amount,maxAccess:eS,readOnly:eB,onChange:e=>eP.setFieldValue("header.amount",e.target.value),onClear:()=>eP.setFieldValue("header.amount",""),error:(null==eP?void 0:null===(ec=eP.touched)||void 0===ec?void 0:null===(eu=ec.header)||void 0===eu?void 0:eu.amount)&&!!(null==eP?void 0:null===(ev=eP.errors)||void 0===ev?void 0:null===(es=ev.header)||void 0===es?void 0:es.amount),maxLength:15,decimalScale:2})})]})}),(0,l.jsx)(m.Q,{children:(0,l.jsx)(k._,{onChange:e=>eP.setFieldValue("rows",e),value:eP.values.rows,error:eP.errors.rows,name:"rows",maxAccess:eS,columns:eL,allowAddNewLine:!eB,allowDelete:!eB,disabled:eB||Object.entries((null==eP?void 0:eP.errors)||{}).filter(e=>{let[n]=e;return"rows"!==n}).length>0,onValidationRequired:eH})}),(0,l.jsx)(v.g,{children:(0,l.jsxs)(g.ZP,{container:!0,spacing:2,children:[(0,l.jsx)(g.ZP,{item:!0,xs:6,children:(0,l.jsx)(N.Z,{endpointId:C.H.DescriptionTemplate.qry,name:"header.templateId",label:ew.descriptionTemplate,readOnly:eB,valueField:"recordId",displayField:"name",values:eP.values.header,onChange:(e,n)=>{let a=eP.values.header.notes;(a+=((null==n?void 0:n.name)&&eP.values.header.notes&&"\n")+(null==n?void 0:n.name))&&eP.setFieldValue("header.notes",a)},error:(null==eP?void 0:null===(eh=eP.touched)||void 0===eh?void 0:null===(em=eh.header)||void 0===em?void 0:em.templateId)&&!!(null==eP?void 0:null===(ep=eP.errors)||void 0===ep?void 0:null===(ef=ep.header)||void 0===ef?void 0:ef.templateId),maxAccess:eS})}),(0,l.jsx)(g.ZP,{item:!0,xs:6,children:(0,l.jsx)(w.Z,{name:"header.totalAmount",label:ew.totalAmount,value:eU.toFixed(2),maxAccess:eS,readOnly:!0})}),(0,l.jsx)(g.ZP,{item:!0,xs:6,children:(0,l.jsx)(b.Z,{name:"header.notes",label:ew.notes,value:null==eP?void 0:null===(ey=eP.values)||void 0===ey?void 0:null===(eI=ey.header)||void 0===eI?void 0:eI.notes,readOnly:eB,rows:3,maxAccess:eS,onChange:e=>eP.setFieldValue("header.notes",e.target.value),onClear:()=>eP.setFieldValue("header.notes",""),error:(null==eP?void 0:null===(eg=eP.touched)||void 0===eg?void 0:null===(ex=eg.header)||void 0===ex?void 0:ex.notes)&&!!(null==eP?void 0:null===(eA=eP.errors)||void 0===eA?void 0:null===(eF=eA.header)||void 0===eF?void 0:eF.notes)})})]})})]})})}var q=()=>{let{postRequest:e,getRequest:n}=(0,r.useContext)(o.$),{platformLabels:a}=(0,r.useContext)(h.l),{stack:y}=(0,u.zY)(),{query:{data:x},filterBy:g,refetch:F,labels:A,access:w,paginationParameters:b,invalidate:N}=(0,d.J)({queryFn:k,endpointId:C.H.BalanceTransferMultiAccounts.page,datasetId:c.i.BalanceTransferMultiAccounts,filter:{filterFn:Z}}),j=[{field:"reference",headerName:A.reference,flex:1},{field:"dtName",headerName:A.documentType,flex:1},{field:"date",headerName:A.date,flex:1,type:"date"},{field:"plantName",headerName:A.plant,flex:1},{field:"accountRef",headerName:A.fromAccountRef,flex:1},{field:"accountName",headerName:A.fromAccountName,flex:1},{field:"currencyName",headerName:A.currency,flex:1},{field:"amount",headerName:A.amount,flex:1,type:"number"},{field:"notes",headerName:A.notes,flex:2},{field:"statusName",headerName:A.status,flex:1}];async function k(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{_startAt:a=0,_pageSize:l=50,params:r=[]}=e;return{...await n({extension:C.H.BalanceTransferMultiAccounts.page,parameters:"_startAt=".concat(a,"&_pageSize=").concat(l,"&_params=").concat(r,"&filter=")}),_startAt:a}}async function Z(e){let{filters:a,pagination:l}=e;return(null==a?void 0:a.qry)?await n({extension:C.H.BalanceTransferMultiAccounts.snapshot,parameters:"_filter=".concat(a.qry)}):k({_startAt:l._startAt||0,params:null==a?void 0:a.params})}let{proxyAction:_}=(0,p.G)({functionId:I.J.BalanceTransferMultiAccount,action:R}),T=async()=>{await _()};async function R(e){y({Component:O,props:{labels:A,access:w,recordId:e},width:1050,height:680,title:A.BalanceTransfer})}let S=async n=>{await e({extension:C.H.BalanceTransferMultiAccounts.del,record:JSON.stringify(n)}),N(),i.ZP.success(a.Deleted)};return(0,l.jsxs)(s.R,{children:[(0,l.jsx)(v.g,{children:(0,l.jsx)(f.Z,{onAdd:T,maxAccess:w,filterBy:g,reportName:"FITMA"})}),(0,l.jsx)(m.Q,{children:(0,l.jsx)(t.Z,{columns:j,gridData:x,rowId:["recordId"],onEdit:e=>{R(e.recordId)},refetch:F,onDelete:S,deleteConfirmationType:"strict",isLoading:!1,pageSize:50,maxAccess:w,paginationParameters:b,paginationType:"api"})})]})}},93736:function(e,n,a){"use strict";a.d(n,{K:function(){return r}});let l="RG.FI.asmx/",r={FiOpeningBalance:{gen:l+"genOBA"},FiAging:{qry:l+"FI404"},AccountSummary:{AccFI405b:l+"FI405b"},DocumentAging:{AgingFI406a:l+"FI406a",AgingFI406b:l+"FI406b"},TrialBalance:{FI402View:l+"FI402o",FI401o2:l+"FI401o2"}}},1685:function(e,n,a){"use strict";a.d(n,{m:function(){return l}});let l=e=>{let n=window.sessionStorage.getItem(e);return n?JSON.parse(n):null}},98345:function(e,n,a){"use strict";a.d(n,{H:function(){return f},G:function(){return h}});var l=a(45300),r=a(2784),d=a(96026),o=a(38449);a(26612);var t=a(65947),i=a(1685);let u=async(e,n,a)=>{try{let l=await e({extension:n,parameters:a});return n.includes("qry")?l:l.record}catch(e){return null}},c=(e,n,a,l)=>{let r=(e=JSON.parse(JSON.stringify(e))).record.controls,d=r.find(e=>"reference"===e.controlId);return d?d.accessLevel=(null==n?void 0:n.mandatory)?t.$7:t.rr:(null==n?void 0:n.mandatory)?r.push({sgId:0,resourceId:"",controlId:"".concat(l?l+".":"","reference"),accessLevel:(null==n?void 0:n.mandatory)?t.$7:t.rr}):(null==n?void 0:n.readOnly)?r.push({sgId:0,resourceId:"",controlId:"".concat(l?l+".":"","reference"),accessLevel:(null==n?void 0:n.readOnly)?t.rr:t.$7}):r=e.record.controls.filter(e=>"reference"!=e.controlId),a&&r.push({sgId:0,resourceId:"",controlId:"".concat(l?l+".":"","dtId"),accessLevel:t.$7}),{...e,record:{...e.record,controls:r}}},s=async(e,n,a)=>{let l,r;switch(a){case"dtId":let d=(0,i.m)("userData"),t=null==d?void 0:d.userId;r="_userId=".concat(t,"&_functionId=").concat(n),l=o.r.UserFunction.get;break;case"glbSysNumberRange":r="_recordId=".concat(n),l=o.r.SystemFunction.get;break;case"DocumentType":r="_dgId=".concat(n,"&_startAt=",0,"&_pageSize=",50),l=o.r.DocumentType.qry;break;case"DcTypNumberRange":r="_recordId=".concat(n),l=o.r.DocumentType.get;break;case"isExternal":r="_recordId=".concat(n),l=o.r.NumberRange.get;break;default:return null}return await u(e,l,r)},v=async function(e){let n,a,l,r,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,o=arguments.length>2?arguments[2]:void 0,t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,i=!(arguments.length>4)||void 0===arguments[4]||arguments[4],u=arguments.length>5?arguments[5]:void 0,v=void 0===t&&d&&await s(e,d,"dtId"),m=null==v?void 0:v.dtId,h="",f=!0;if(v&&void 0===t||"nraId"===t){if(m){let a=await s(e,m,"DcTypNumberRange");n=null==a?void 0:a.nraId,f=!((null==a?void 0:a.activeStatus)<0),n||(h="Assign the document type to a number range")}if((!m||!f)&&i&&d){var p;let n=await s(e,d,"DocumentType");r=(null==n?void 0:null===(p=n.list)||void 0===p?void 0:p.filter(e=>(null==e?void 0:e.activeStatus)===1).length)>0}}if(("nraId"===t||void 0===t)&&d){if((!m||m)&&!n||n&&!f){let a=await s(e,d,"glbSysNumberRange");(n=null==a?void 0:a.nraId)&&r&&(r=!1),f=!0}h=n||r?"":"Assign the system Function to a number range"}t>0&&!n&&(n=t),n&&f?(a={readOnly:null==(l=await s(e,n,"isExternal"))||!l.external,mandatory:null!=l&&!!l.external},o&&(o=await c(o,a,r,u))):!n&&o&&(o=await c(o,a,r,u));let I=u?"".concat(u,".reference"):"reference";return{dtId:m,resetReference:null==a?void 0:a.readOnly,dcTypeRequired:r,reference:{fieldName:I,isEmpty:(null==l?void 0:l.external)!==void 0&&(null==l||!l.external)},errorMessage:h,maxAccess:o,selectNraId:t}};var m=a(65950);function h(e){let{functionId:n,action:a,hasDT:l}=e,{getRequest:o}=(0,r.useContext)(m.$),{stack:t}=(0,d.V)();return{proxyAction:async()=>{let e=await v(o,n,"",void 0,l);(null==e?void 0:e.errorMessage)?t({message:null==e?void 0:e.errorMessage}):await a()}}}function f(e){var n;let{functionId:a,access:o,hasDT:t,enabled:i=!0,objectName:u=""}=e,{getRequest:c}=(0,r.useContext)(m.$),{stack:s}=(0,d.V)(),[h,f]=(0,r.useState)(),p=async e=>{let n=await v(c,a,o,e,t,u);if(!n.errorMessage)return n;s({message:null==n?void 0:n.errorMessage})},I=(0,l.a)({retry:!1,staleTime:0,enabled:i,queryKey:[a,h,!!o,i],queryFn:h||"nraId"===h?()=>p(h):()=>p()});return{documentType:I.data,maxAccess:(null==I?void 0:null===(n=I.data)||void 0===n?void 0:n.maxAccess)||o,changeDT(e){f((null==e?void 0:e.nraId)||"nraId")}}}},16463:function(e,n,a){"use strict";a.d(n,{Z:function(){return w}});var l=a(52322),r=a(2784),d=a(49864),o=a(65950),t=a(27423),i=a(26612),u=a(71987),c=a(33625),s=a(62362),v=a(31389),m=a(8661),h=a(25870),f=a(69627),p=a(84100),I=a(19473),y=a(80983),x=a(38449),g=a(69387),F=a(93736),A=a(21326);function w(e){let{accountId:n,moduleId:a,window:w}=e,{getRequest:b}=(0,r.useContext)(o.$),{platformLabels:N}=(0,r.useContext)(I.l),[j,k]=(0,r.useState)([]);(0,A.Z)({title:N.AccountSummary,window:w});let{labels:Z,access:C}=(0,u.J)({datasetId:i.i.AccountSummary}),_=[{field:"days",headerName:Z.days,flex:1,type:"number"}],[T,R]=(0,r.useState)(_),{formik:S}=(0,y.c)({maxAccess:C,initialValues:{accountId:null,accountRef:"",accountName:"",agpId:null,moduleId:a}});async function O(){var e,n,l,r;let d;let o=2,t=[..._],i=await b({extension:x.r.Currency.qry,parameters:"_filter="});if(1==a?d=null==i?void 0:null===(e=i.list)||void 0===e?void 0:e.filter(e=>e.sale):2==a&&(d=null==i?void 0:null===(n=i.list)||void 0===n?void 0:n.filter(e=>e.purchase)),0==d.length)return;null==d||d.forEach((e,n)=>{t.push({field:"column".concat(n+1),headerName:e.reference,flex:1,type:"number"})}),R(t);let u=await b({extension:h.H.AgingLeg.qry,parameters:"_agpId=".concat(S.values.agpId)}),c=null==u?void 0:null===(l=u.list)||void 0===l?void 0:l.map(e=>{let n=Array(d.length+2).fill(0);return n[0]=null,n[1]=e.days,n}),s=(d||[]).map(e=>b({extension:F.K.AccountSummary.AccFI405b,parameters:"_agpId=".concat(S.values.agpId,"&_currencyId=").concat(e.recordId,"&_accountId=").concat(S.values.accountId)}).then(e=>({summaryRes:e})));(await Promise.all(s)).forEach(e=>{var n;let{summaryRes:a}=e;null==a||null===(n=a.list)||void 0===n||n.forEach(e=>{null==c||c.forEach(n=>{n[1]==e.seqDays&&(n[o]=e.amount)})}),o++});let v=Array(d.length+2).fill(null);for(let e=2;e<d.length+2;e++){let n=0;null==c||c.map(a=>{n+=Number(a[e]||0)}),v[e]=n}let m=c.filter(e=>null!==e[1]).map(e=>{let[n,a,...l]=e,r={days:a};return l.forEach((e,n)=>{r["column".concat(n+1)]=e.toFixed(2)}),r}),f={};for(let e=0;e<d.length;e++)f["column".concat(e+1)]=null!==(r=v[e+2].toFixed(2))&&void 0!==r?r:0;m.push(f),k({list:m})}return(0,r.useEffect)(()=>{!async function(){if(n&&a){var e,l,r;let a=await b({extension:h.H.Account.get,parameters:"_recordId=".concat(n)});S.setFieldValue("accountId",null==a?void 0:null===(e=a.record)||void 0===e?void 0:e.recordId),S.setFieldValue("accountRef",null==a?void 0:null===(l=a.record)||void 0===l?void 0:l.reference),S.setFieldValue("accountName",null==a?void 0:null===(r=a.record)||void 0===r?void 0:r.name)}}()},[]),(0,l.jsxs)(v.R,{children:[(0,l.jsx)(c.g,{children:(0,l.jsxs)(d.Z,{container:!0,spacing:2,p:2,children:[(0,l.jsx)(d.Z,{item:!0,xs:12,children:(0,l.jsx)(t.U,{endpointId:h.H.Account.snapshot,name:"accountId",label:Z.account,valueField:"reference",displayField:"name",valueShow:"accountRef",secondValueShow:"accountName",form:S,readOnly:S.values.accountId&&S.values.moduleId,required:!0,maxAccess:C,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],onChange:async(e,n)=>{S.setFieldValue("accountId",(null==n?void 0:n.recordId)||null),S.setFieldValue("accountName",(null==n?void 0:n.name)||""),S.setFieldValue("accountRef",(null==n?void 0:n.reference)||"")}})}),(0,l.jsx)(d.Z,{item:!0,xs:6,children:(0,l.jsx)(m.Z,{endpointId:h.H.AgingProfile.qry,parameters:"_startAt=0&_pageSize=1000&filter=",name:"agpId",label:Z.agingProfile,values:S.values,valueField:"recordId",displayField:"name",maxAccess:C,required:!0,onChange:(e,n)=>{S.setFieldValue("agpId",(null==n?void 0:n.recordId)||null),(null==n?void 0:n.recordId)||k({list:[]})}})}),(0,l.jsx)(d.Z,{item:!0,xs:5,children:(0,l.jsx)(m.Z,{datasetId:p.v.FI_AGING_MODULE,label:Z.module,name:"moduleId",values:S.values,valueField:"key",displayField:"value",maxAccess:C,required:!0,readOnly:S.values.moduleId,onChange:(e,n)=>{S.setFieldValue("moduleId",(null==n?void 0:n.key)||null)}})}),(0,l.jsx)(d.Z,{item:!0,xs:1,children:(0,l.jsx)(f.Z,{onClick:O,image:"preview.png",disabled:!S.values.agpId||!S.values.moduleId||!S.values.accountId,tooltipText:N.Preview})})]})}),(0,l.jsx)(s.Q,{children:(0,l.jsx)(g.Z,{columns:T,gridData:j,isLoading:!1,pagination:!1})})]})}w.width=1e3,w.height=500}},function(e){e.O(0,[92515,2494,36908,49774,92888,40179],function(){return e(e.s=18444)}),_N_E=e.O()}]);