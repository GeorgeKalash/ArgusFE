(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[96388],{63117:function(e,l,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/retail-trx/[functionId]",function(){return t(66907)}])},66907:function(e,l,t){"use strict";t.r(l),t.d(l,{default:function(){return Y}});var a=t(52322),n=t(70844),d=t(2784),i=t(33625),o=t(31389),r=t(36908),u=t(96026),s=t(98345),c=t(19473),v=t(65950),m=t(81510),h=t(26612),p=t(7121),x=t(61802),I=t(89330),y=t(39812),f=t(60218),P=t(48601),b=t(82737),F=t(62202),g=t(71987),R=t(5088),A=t(8661),C=t(38449),w=t(65215),Z=t(27423),j=t(62362),V=t(76399),k=t(91406),N=t(22341),T=t(80983),O=t(86626),_=t(18996),S=t(16096),q=t(51235);t(2119);var D=t(21581),L=t(25870),J=t(1251),G=t(26553),E=t(19689),U=t(19568),W=t(45937),K=t(69627),M=t(58276),X=t(93878);function $(e){var l,n,r,$,Q,H,B,z,Y,ee,el,et,ea,en,ed,ei,eo,er,eu,es,ec,ev,em,eh,ep,ex,eI,ey,ef,eP,eb,eF,eg,eR,eA,eC,ew,eZ,ej,eV,ek,eN,eT,eO,e_,eS,eq,eD,eL,eJ,eG,eE,eU,eW,eK,eM,eX,e$,eQ,eH,eB,ez,eY,e0,e2,e1,e3,e6,e8,e5,e9,e7,e4,le,ll,lt,la,ln,ld,li,lo,lr,lu,ls,lc,lv,lm,lh,lp,lx,lI,ly,lf,lP,lb,lF,lg,lR,lA,lC,lw,lZ,lj,lV,lk,lN;let{labels:lT,posUser:lO,access:l_,recordId:lS,functionId:lq,lockRecord:lD,getGLResource:lL,window:lJ}=e,{getRequest:lG,postRequest:lE}=(0,d.useContext)(v.$),{addLockedScreen:lU}=(0,d.useContext)(M.Z),{stack:lW}=(0,u.V)(),{stack:lK}=(0,x.zY)(),{platformLabels:lM,defaultsData:lX,systemChecks:l$}=(0,d.useContext)(c.l),[lQ,lH]=(0,d.useState)({}),[lB,lz]=(0,d.useState)(!1),[lY,l0]=(0,d.useState)({cashAccounts:[],creditCards:[],creditCardFees:[]}),[l2,l1]=(0,d.useState)(!1),l3=(0,d.useRef)([]),l6=(0,d.useRef)(null),l8=l$.some(e=>e.checkId===q.F.AUTO_POST_POS_ACTIVITY_ON_SAVE),l5=(null==l$?void 0:null===(l=l$.find(e=>e.checkId===q.F.POS_JUMP_TO_NEXT_LINE))||void 0===l?void 0:l.value)||!1,l9={[p.J.RetailInvoice]:m.A.RetailInvoice.set2,[p.J.RetailReturn]:m.A.RetailReturn.set2,[p.J.RetailPurchase]:m.A.RetailPurchase.set2,[p.J.RetailPurchaseReturn]:m.A.RetailPurchaseReturn.set2},l7={[p.J.RetailInvoice]:h.i.RetailInvoice,[p.J.RetailReturn]:h.i.RetailInvoiceReturn,[p.J.RetailPurchase]:h.i.RetailPurchase,[p.J.RetailPurchaseReturn]:h.i.RetailPurchaseReturn},{documentType:l4,maxAccess:te,changeDT:tl}=(0,s.H)({functionId:lq,access:l_,enabled:!lS,objectName:"header"}),tt={recordId:lS||null,singleCashPos:!1,defaultMCbaseCU:null,disableSKULookup:!1,header:{recordId:lS||null,date:new Date,reference:null,dtId:null,functionId:lq,posId:parseInt(null==lO?void 0:lO.posId),currencyId:null,plantId:null,siteId:null,spId:parseInt(null==lO?void 0:lO.spId),addressId:null,oDocId:null,oDocRef:"",subtotal:0,vatAmount:0,amount:0,baseAmount:0,metalPrice:0,KGmetalPrice:0,plId:null,taxId:null,isVatable:!1,clientTaxNo:"",deliveryNotes:"",name:"",street1:null,street2:null,countryId:null,cityId:null,phone:null,city:null,defPriceType:null,posFlags:!1,priceType:null,clientName:"",status:1},items:[{id:1,invoiceId:lS||0,seqNo:0,itemId:0,barcode:null,sku:null,itemName:null,priceType:null,qty:0,weight:0,volume:0,basePrice:0,baseLaborPrice:0,totPricePerG:0,unitPrice:0,priceWithVAT:0,vatPct:0,vatAmount:0,extendedPrice:0,isMetal:!1,metalId:null,metalPurity:null,mdType:O.Xo,mdAmountPct:null,mdValue:0,mdAmount:0,metalRef:null,notes:null,posFlags:null,taxId:null,taxId_base:null,taxId_amount:null}],cash:[{id:1,invoiceId:lS||0,seqNo:null,cashAccountId:null,cashAccountRef:null,type:0,typeName:null,amount:0,bankFees:0,receiptRef:null,ccId:"",ccRef:""}]},ta=(0,g.E)({endpointId:m.A.RetailInvoice.qry}),{formik:tn}=(0,T.c)({maxAccess:te,documentType:{key:"header.dtId",value:null==l4?void 0:l4.dtId},initialValues:tt,validateOnChange:!0,validationSchema:P.Ry({header:P.Ry({date:P.Z_().required(),name:P.Z_().test("Name-Required","Name is required when street1 or street2 has a value",function(){let{street1:e,street2:l,name:t,phone:a,cityId:n}=this.parent;return!e&&!l&&!n&&!a||!!t}),cityId:P.Z_().test("City-Required","City is required when street1 or street2 has a value",function(){let{street1:e,street2:l,phone:t,cityId:a}=this.parent;return!e&&!l&&!t||!!a||this.createError({message:"City is required"})}),street1:P.Z_().test("Street1-Required","Street1 is required when street2 has a value",function(){let{street1:e,street2:l,phone:t,cityId:a}=this.parent;return!l&&!t&&!a||!!e})}),items:P.IX().of(P.Ry({sku:P.Z_().required(),itemName:P.Z_().required(),qty:P.Z_().test(function(){let{qty:e}=this.parent;return e>0}),barcode:P.Z_().required()})),cash:P.IX().of(P.Ry({ccRef:P.Z_().test("Credit-Card","Credit Card is required",function(){let{type:e,ccId:l}=this.parent;return 1!==e||!!l})}))}),onSubmit:async e=>{var l;let t=lQ||{recordId:""};if((e.header.recordId&&l2||!e.header.recordId)&&(t.recordId=""),t.name&&t.street1&&t.cityId){let l=await lE({extension:C.r.Address.set,record:JSON.stringify(t)});e.header.addressId=null==l?void 0:l.recordId}let a=e=>e.map((e,l)=>({...e,seqNo:l+1}));e.header.name&&(e.header.clientName=e.header.name);let n={header:{...e.header,date:(0,y.ku)(null===(l=e.header)||void 0===l?void 0:l.date)},items:a(e.items),cash:a(e.cash)},d=await td(l9[lq],n),i=to?lM.Edited:lM.Added;F.ZP.success(i);let o=await t_(null==d?void 0:d.recordId);ta(),l8&&await tx(null==o?void 0:o.header)}});async function td(e,l){return await lE({extension:e,record:JSON.stringify(l)})}let ti=3===tn.values.header.status,to=!!tn.values.header.recordId;async function tr(e){if(!e)return;let l=await lG({extension:L.H.TaxDetailPack.qry,parameters:"_taxId=".concat(e)});return null==l?void 0:l.list}async function tu(e,l,t){let a=await ts(null==l?void 0:l.itemId),n=await tc(null==l?void 0:l.itemId),d=await tv(null==l?void 0:l.itemId),i=(tn.values.header.KGmetalPrice||0)*((null==n?void 0:n.metalPurity)||0)/1e3,o=(i||0)+((null==d?void 0:d.baseLaborPrice)||0),r=await tr(null==l?void 0:l.taxId),u={id:null==l?void 0:l.id,itemId:null==l?void 0:l.itemId,sku:null==l?void 0:l.sku,itemName:null==l?void 0:l.itemName,posFlags:null==a?void 0:a.posFlags,metalPurity:(null==n?void 0:n.metalPurity)||0,isMetal:(null==n?void 0:n.isMetal)||!1,metalId:(null==n?void 0:n.metalId)||null,weight:(null==n?void 0:n.weight)||0,volume:(null==n?void 0:n.volume)||0,baseLaborPrice:(null==d?void 0:d.baseLaborPrice)||0,basePrice:i||0,TotPricePerG:o||0,priceType:null==d?void 0:d.priceType,unitPrice:(null==d?void 0:d.priceType)==3?((null==n?void 0:n.weight)||0)*(o||0):null==d?void 0:d.unitPrice,qty:(null==l?void 0:l.qty)||1,extendedPrice:0,mdAmount:0,mdValue:0,taxId:tn.values.header.isVatable?null==l?void 0:l.taxId:null,taxDetails:r||null},s=u;return((null==u?void 0:u.basePrice)&&(s=tF(u,O.yO)),(null==u?void 0:u.unitPrice)&&(s=tF(u,O.Xf),(null==l?void 0:l.qty)>0&&(s=tF(u,O.bT))),l5)?tn.values.disableSKULookup?t({fieldName:"sku",changes:s}):void(e(s),t()):e(s)}async function ts(e){let l=await lG({extension:w.$.ItemRetail.get,parameters:"_itemId=".concat(e)});return null==l?void 0:l.record}async function tc(e){let l=await lG({extension:w.$.Physical.get,parameters:"_itemId=".concat(e)});return null==l?void 0:l.record}async function tv(e){let l=await lG({extension:N.P.ItemConvertPrice.get,parameters:"_clientId=0&_itemId=".concat(e,"&_currencyId=").concat(tn.values.header.currencyId,"&_plId=").concat(tn.values.header.plId,"&_muId=",0)});return null==l?void 0:l.record}function tm(e,l){let t=parseFloat(e)||0;return l===O.Xo?(t<0||t>100)&&(t=0):t<0&&(t=0),t}function th(e){var l,t,a;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!e||!n)return;let d=null!==(a=null==l6?void 0:null===(t=l6.current)||void 0===t?void 0:null===(l=t.creditCardFees)||void 0===l?void 0:l.filter(l=>{let{creditCardId:t}=l;return parseInt(t)===e}))&&void 0!==a?a:[];if(0===d.length)return;let i=d.find(e=>{let{upToAmount:l}=e;return l>=n});if(!i)return;let{isPct:o,commissionFees:r}=i;return o?n*r/100:r}async function tp(e){let{updateRow:l,value:t,data:a}=e,n=((null==t?void 0:t.mdType)||(null==a?void 0:a.mdType))===O.Xo?O.RD:O.Xo,d=tm(null==t?void 0:t.mdAmount,n);l({id:a.id,changes:{mdAmount:d,mdAmountPct:n,mdType:n},commitOnBlur:!0})}let tx=async e=>{await lE({extension:m.A.RetailInvoice.post,record:JSON.stringify(e)}),F.ZP.success(lM.Posted),ta(),lJ.close()},tI=async()=>{await lE({extension:m.A.RetailInvoice.unpost,record:JSON.stringify(tn.values.header)}).then(e=>{F.ZP.success(lM.Posted),lD({recordId:e.recordId,reference:tn.values.header.reference,resourceId:l7[parseInt(lq)],onSuccess:()=>{lU({resourceId:l7[parseInt(lq)],recordId:lS,reference:tn.values.header.reference}),t_(e.recordId)},isAlreadyLocked:e=>{lJ.close(),lK({Component:NormalDialog,props:{DialogText:"".concat(lM.RecordLocked," ").concat(e),title:lM.Dialog},title:lM.Dialog})}}),ta()})},ty=[{key:"RecordRemarks",condition:!0,onClick:"onRecordRemarks",disabled:!to},{key:"IV",condition:!0,onClick:"onInventoryTransaction",disabled:!to||!ti},{key:"SA Trx",condition:!0,onClick:"onClickSATRX",disabled:!to},{key:"GL",condition:!0,onClick:"onClickGL",valuesPath:{...tn.values.header,notes:tn.values.header.deliveryNotes},datasetId:lL(lq),disabled:!to},{key:"Locked",condition:ti,onClick:"onUnpostConfirmation",onSuccess:tI,disabled:!to},{key:"Unlocked",condition:!ti,onClick:()=>{tx(tn.values.header)},disabled:!to}];async function tf(e){var l,t,a,n,d,i;let o=(null==e?void 0:e.header)||{},r=(null==e?void 0:e.items)||[],u=(null==e?void 0:e.cash)||[],s=await tb((null==o?void 0:o.addressId)||null),c=await Promise.all(null==r?void 0:r.map(async(e,l)=>{let t=await tr(null==e?void 0:e.taxId);return{...e,id:l+1,qty:parseFloat(e.qty).toFixed(2),unitPrice:parseFloat(e.unitPrice).toFixed(2),extendedPrice:parseFloat(e.extendedPrice).toFixed(2),priceWithVAT:tK(e,null==t?void 0:t[0],O.yO),totPricePerG:function(e,l,t){let a=(0,O.Ch)({priceType:null==l?void 0:l.priceType,basePrice:parseFloat((null==l?void 0:l.basePrice)||0),volume:parseFloat(null==l?void 0:l.volume)||0,weight:parseFloat(null==l?void 0:l.weight),unitPrice:parseFloat((null==l?void 0:l.unitPrice)||0),upo:0,qty:parseFloat(null==l?void 0:l.qty)||0,extendedPrice:parseFloat(null==l?void 0:l.extendedPrice),mdAmount:(null==e?void 0:e.mdAmount)||0,mdType:(null==l?void 0:l.mdType)||1,baseLaborPrice:(null==l?void 0:l.baseLaborPrice)||0,totalWeightPerG:null==l?void 0:l.TotPricePerG,mdValue:parseFloat(null==l?void 0:l.mdValue),tdPct:0,dirtyField:t});return(null==a?void 0:a.totalWeightPerG)?parseFloat(a.totalWeightPerG).toFixed(2):0}(o,e,O.yO),taxDetails:t}})),v=await Promise.all(null==u?void 0:u.map(async(e,l)=>({...e,id:l+1,amount:parseFloat(e.amount).toFixed(2),ccRef:(null==e?void 0:e.ccRef)||""}))),m=null==lX?void 0:null===(l=lX.list)||void 0===l?void 0:l.find(e=>{let{key:l}=e;return"countryId"===l});tn.setValues({recordId:o.recordId||null,header:{...o,countryId:(null==o?void 0:o.countryId)||(null==m?void 0:m.value),name:(null==s?void 0:null===(t=s.record)||void 0===t?void 0:t.name)||(null==o?void 0:o.clientName),street1:null==s?void 0:null===(a=s.record)||void 0===a?void 0:a.street1,street2:null==s?void 0:null===(n=s.record)||void 0===n?void 0:n.street2,phone:null==s?void 0:null===(d=s.record)||void 0===d?void 0:d.phone,cityId:null==s?void 0:null===(i=s.record)||void 0===i?void 0:i.cityId,KGmetalPrice:(null==o?void 0:o.metalPrice)?(null==o?void 0:o.metalPrice)*1e3:0},items:c,cash:v}),lH({...(null==s?void 0:s.record)||{},countryId:(null==s?void 0:s.countryId)||(null==m?void 0:m.value)}),tn.values.recordId||lD({recordId:o.recordId,reference:o.reference,resourceId:l7[parseInt(lq)],onSuccess:()=>{lU({resourceId:l7[parseInt(lq)],recordId:o.recordId,reference:o.reference})}})}async function tP(e){var l,t,a;let n=await lG({extension:m.A.RetailInvoice.get2,parameters:"_recordId=".concat(e)});return(null==n?void 0:null===(l=n.record)||void 0===l?void 0:l.header)&&(n.record.header.date=(0,y.a1)(null==n?void 0:null===(a=n.record)||void 0===a?void 0:null===(t=a.header)||void 0===t?void 0:t.date)),(null==n?void 0:n.record)||{}}async function tb(e){return e?await lG({extension:C.r.Address.get,parameters:"_recordId=".concat(e)}):null}function tF(e,l,t){var a;lB||lz(!0);let n=tm(null==e?void 0:e.mdAmount,null==e?void 0:e.mdType),d=(0,O.Ch)({priceType:null==e?void 0:e.priceType,basePrice:parseFloat((null==e?void 0:e.basePrice)||0),volume:parseFloat(null==e?void 0:e.volume)||0,weight:parseFloat(null==e?void 0:e.weight),unitPrice:parseFloat((null==e?void 0:e.unitPrice)||0),upo:0,qty:parseFloat(null==e?void 0:e.qty)||0,extendedPrice:parseFloat(null==e?void 0:e.extendedPrice),mdAmount:n,mdType:(null==e?void 0:e.mdType)||1,baseLaborPrice:parseFloat(null==e?void 0:e.baseLaborPrice)||0,totalWeightPerG:null==e?void 0:e.totPricePerG,mdValue:parseFloat(null==e?void 0:e.mdValue),tdPct:0,dirtyField:l});(null==e?void 0:null===(a=e.taxDetails)||void 0===a?void 0:a.length)>0&&(e.taxDetails=e.taxDetails);let i=(0,_.VW)({priceType:null==d?void 0:d.priceType,basePrice:null==d?void 0:d.basePrice,qty:parseFloat(null==d?void 0:d.qty),weight:parseFloat(null==d?void 0:d.weight),extendedPrice:parseFloat(null==d?void 0:d.extendedPrice),baseLaborPrice:parseFloat(null==d?void 0:d.baseLaborPrice),vatAmount:parseFloat(null==d?void 0:d.vatAmount)||0,tdPct:0,taxDetails:tn.values.header.isVatable?e.taxDetails:null}),o={...e,id:null==e?void 0:e.id,qty:(null==d?void 0:d.qty)?parseFloat(null==d?void 0:d.qty).toFixed(2):0,volume:(null==d?void 0:d.volume)?parseFloat(d.volume).toFixed(2):0,weight:(null==d?void 0:d.weight)?parseFloat(d.weight).toFixed(2):0,basePrice:(null==d?void 0:d.basePrice)?parseFloat(d.basePrice).toFixed(5):0,baseLaborPrice:(null==d?void 0:d.baseLaborPrice)?parseFloat(d.baseLaborPrice).toFixed(5):0,unitPrice:(null==d?void 0:d.unitPrice)?parseFloat(d.unitPrice).toFixed(3):0,extendedPrice:(null==d?void 0:d.extendedPrice)?parseFloat(d.extendedPrice).toFixed(2):0,mdValue:null==d?void 0:d.mdValue,mdType:null==d?void 0:d.mdType,totPricePerG:(null==d?void 0:d.totalWeightPerG)?parseFloat(d.totalWeightPerG).toFixed(2):0,mdAmount:(null==d?void 0:d.mdAmount)?parseFloat(d.mdAmount).toFixed(2):0,vatAmount:(null==i?void 0:i.vatAmount)?parseFloat(i.vatAmount).toFixed(2):0,taxDetails:tn.values.header.isVatable?e.taxDetails:null};return t?{changes:o}:o}let tg=null===(n=tn.values.items)||void 0===n?void 0:n.filter(e=>void 0!==e.itemId).map(e=>({...e,basePrice:parseFloat(e.basePrice)||0,unitPrice:parseFloat(e.unitPrice)||0,vatAmount:parseFloat(e.vatAmount)||0,weight:parseFloat(e.weight)||0,volume:parseFloat(e.volume)||0,extendedPrice:parseFloat(e.extendedPrice)||0})),tR=lB?(0,S.Ww)(tg):(null===($=tn.values)||void 0===$?void 0:null===(r=$.header)||void 0===r?void 0:r.subtotal)||0,tA=(0,S.Ot)(tg,{totalQty:0,totalWeight:0,totalVolume:0,totalUpo:0,sumVat:0,sumExtended:parseFloat(tR),tdAmount:0,net:0,miscAmount:0}),tC=(null==tA?void 0:null===(Q=tA.totalQty)||void 0===Q?void 0:Q.toFixed(2))||0,tw=lB?null==tA?void 0:null===(H=tA.net)||void 0===H?void 0:H.toFixed(2):parseFloat(null===(z=tn.values)||void 0===z?void 0:null===(B=z.header)||void 0===B?void 0:B.amount).toFixed(2)||0,tZ=null==tA?void 0:null===(Y=tA.totalWeight)||void 0===Y?void 0:Y.toFixed(2),tj=lB?null==tR?void 0:tR.toFixed(2):parseFloat(null===(el=tn.values)||void 0===el?void 0:null===(ee=el.header)||void 0===ee?void 0:ee.subtotal).toFixed(2)||0,tV=lB?null==tA?void 0:tA.sumVat.toFixed(2):parseFloat(null===(et=tn.values)||void 0===et?void 0:et.header.vatAmount).toFixed(2)||0,tk=tn.values.cash.reduce((e,l)=>{var t;return e+(parseFloat(null===(t=l.amount)||void 0===t?void 0:t.toString().replace(/,/g,""))||0)},0),tN=(parseFloat(tj)+parseFloat(tV)-parseFloat(tk)).toFixed(2),tT=[{component:"textfield",label:lT.barcode,name:"barcode",updateOn:"blur",async onChange(e){let{row:{update:l,newRow:t,oldRow:a,addRow:n}}=e;(null==t?void 0:t.barcode)&&await tu(l,t,n)}},{component:(null==tn?void 0:null===(ea=tn.values)||void 0===ea?void 0:ea.disableSKULookup)?"textfield":"resourcelookup",label:lT.sku,name:"sku",jumpToNextLine:l5,flex:2,link:{enabled:!0,popup:e=>{var l,t;return lK({Component:X.Z,props:{itemId:(null==e?void 0:e.itemId)||null,plId:(null===(t=tn.values)||void 0===t?void 0:null===(l=t.header)||void 0===l?void 0:l.plId)||null}})}},...tn.values.disableSKULookup&&{updateOn:"blur"},props:{...!tn.values.disableSKULookup&&{endpointId:m.A.PUItems.snapshot,parameters:{_siteId:tC<0||p.J.RetailInvoice!=lq?0:(null===(ed=tn.values)||void 0===ed?void 0:null===(en=ed.header)||void 0===en?void 0:en.siteId)||0},displayField:"sku",valueField:"sku",mapping:[{from:"itemId",to:"itemId"},{from:"sku",to:"sku"},{from:"itemName",to:"itemName"},{from:"taxId",to:"taxId"}],columnsInDropDown:[{key:"sku",value:"SKU"},{key:"itemName",value:"Item Name"}],displayFieldWidth:3}},async onChange(e){var l,t;let{row:{update:a,newRow:n,oldRow:d,addRow:i}}=e,o=()=>{a({...tn.initialValues.items[0],id:n.id})};if(!tn.values.disableSKULookup)return n.itemId?await tu(a,n,i):o();if(!(null==n?void 0:n.sku))return o();let r=await lG({extension:w.$.Items.get2,parameters:"_sku=".concat(n.sku)});if(!(null==r?void 0:r.record)){o(),lW({message:lT.invalidSKU});return}let u={id:n.id,itemId:r.record.recordId,sku:r.record.sku,itemName:r.record.name,taxId:tn.values.header.taxId?(null==r?void 0:null===(l=r.record)||void 0===l?void 0:l.taxId)?tn.values.header.taxId:null:null==r?void 0:null===(t=r.record)||void 0===t?void 0:t.taxId,priceType:r.record.priceType,qty:n.qty||0};await tu(a,u,i)}},{component:"textfield",label:lT.itemName,name:"itemName",flex:3,props:{readOnly:!0}},{component:"numberfield",label:lT.qty,name:"qty",updateOn:"blur",async onChange(e){let{row:{update:l,newRow:t}}=e;l(tF(t,O.bT))}},{component:"numberfield",label:lT.weight,name:"weight",props:{readOnly:!0}},{component:"numberfield",label:lT.basePrice,name:"basePrice",updateOn:"blur",async onChange(e){let{row:{update:l,newRow:t}}=e;l(tF(t,O.yO))}},{component:"numberfield",label:lT.baseLaborPrice,name:"baseLaborPrice",updateOn:"blur",async onChange(e){let{row:{update:l,newRow:t}}=e;l(tF(t,O.tV))}},{component:"numberfield",label:lT.totalPricePerG,name:"totPricePerG",updateOn:"blur",async onChange(e){let{row:{update:l,newRow:t}}=e;l(tF(t,O.kx))}},{component:"numberfield",label:lT.unitPrice,name:"unitPrice",updateOn:"blur",async onChange(e){let{row:{update:l,newRow:t}}=e;l(tF(t,O.Xf))}},{component:"numberfield",label:lT.priceWithVat,name:"priceWithVAT"},{component:"numberfield",label:lT.vat,name:"vatAmount",props:{readOnly:!0}},{component:"button",name:"taxDetailsButton",props:{onCondition:e=>e.itemId&&e.taxId?{imgSrc:t(54022).default.src,hidden:!1}:{imgSrc:"",hidden:!0}},label:lT.tax,onClick:(e,l)=>{lK({Component:U.Z,props:{taxId:null==l?void 0:l.taxId,obj:l}})}},{component:"numberfield",label:lT.markdown,name:"mdAmount",updateOn:"blur",flex:2,props:{ShowDiscountIcons:!0,iconsClicked:tp,type:"numeric",iconKey:e=>{let{value:l,data:t}=e;return((null==l?void 0:l.mdType)||(null==t?void 0:t.mdType))===O.Xo?"%":"123"}},async onChange(e){let{row:{update:l,newRow:t}}=e;l(tF(t,O.On))}},{component:"numberfield",label:lT.extendedPrice,name:"extendedPrice",updateOn:"blur",async onChange(e){let{row:{update:l,newRow:t}}=e;l(tF(t,O.bh))}},{component:"textfield",label:lT.notes,name:"notes"}],tO=[{component:"resourcecombobox",label:lT.cashbox,name:"cashAccountId",props:{store:null==l6?void 0:null===(ei=l6.current)||void 0===ei?void 0:ei.posCashAccounts,displayField:"cashAccountRef",valueField:"cashAccountId",mapping:[{from:"cashAccountId",to:"cashAccountId"},{from:"cashAccountRef",to:"cashAccountRef"},{from:"type",to:"type"}],columnsInDropDown:[{key:"cashAccountRef",value:"Reference"},{key:"cashAccountName",value:"Name"}],displayFieldWidth:3},async onChange(e){let{row:{update:l,newRow:t}}=e;if(0==tk&&l({amount:(Number(tw)||0).toFixed(2)}),tE(null==t?void 0:t.cashAccountId),(null==t?void 0:t.type)==1){var a;l({bankFees:(null===(a=th(null==t?void 0:t.ccId,null==t?void 0:t.amount))||void 0===a?void 0:a.toFixed(2))||0})}else l({ccId:null,ccRef:"",bankFees:null})},propsReducer(e){var l;let{row:t,props:a}=e;return{...a,store:null==l6?void 0:null===(l=l6.current)||void 0===l?void 0:l.posCashAccounts}}},{component:"numberfield",label:lT.amount,name:"amount"},{component:"resourcecombobox",label:lT.creditCard,name:"ccRef",props:{store:null==l3?void 0:l3.current,displayField:"reference",valueField:"recordId",mapping:[{from:"reference",to:"ccRef"},{from:"name",to:"ccName"},{from:"recordId",to:"ccId"}]},async onChange(e){let{row:{update:l,newRow:t}}=e;if(null==t?void 0:t.ccId){var a;l({bankFees:(null===(a=th(null==t?void 0:t.ccId,null==t?void 0:t.amount))||void 0===a?void 0:a.toFixed(2))||0})}},propsReducer(e){let{row:l,props:t}=e;return{...t,store:l3.current,readOnly:2==l.type}}},{component:"numberfield",label:lT.bankFees,name:"bankFees",props:{readOnly:!0}},{component:"textfield",label:lT.reference,name:"receiptRef"}];async function t_(e){let l=await tP(e);return await tf(l),l}async function tS(){var e,l;let t=null==lX?void 0:null===(e=lX.list)||void 0===e?void 0:e.find(e=>{let{key:l}=e;return"baseMetalCuId"===l}),a=null==lX?void 0:null===(l=lX.list)||void 0===l?void 0:l.find(e=>{let{key:l}=e;return"mc_defaultRTSA"===l});if(tn.setFieldValue("baseMetalCuId",parseInt(null==t?void 0:t.value)),!(null==a?void 0:a.value)){lW({message:lT.RTSANoteDefined});return}let n=await tq(null==t?void 0:t.value);tn.setFieldValue("header.KGmetalPrice",n||0),tn.setFieldValue("header.metalPrice",n?n/1e3:0)}async function tq(e){var l;if(!e)return;let t=await lG({extension:J.q.Currency.get,parameters:"_currencyId=".concat(e,"&_date=").concat((0,y.Uf)(tn.values.header.date),"&_rateDivision=").concat(G.B.SALES)});return(null==t?void 0:null===(l=t.record)||void 0===l?void 0:l.exRate)*1e3}async function tD(){if(null==lO?void 0:lO.posId)return await lG({extension:m.A.PointOfSales.get,parameters:"_recordId=".concat(parseInt(null==lO?void 0:lO.posId))})}async function tL(){return await lG({extension:C.r.SystemChecks.get,parameters:"_checkId=".concat(q.F.SINGLE_CASH_POS,"&_scopeId=1&_masterId=0")})}async function tJ(e){var l,t,a,n;let d=!1,i=null,o=null;switch(parseInt(lq)){case p.J.RetailInvoice:d=(null==e?void 0:e.applyTaxIVC)||!1,i=(null==e?void 0:e.applyTaxIVC)?null==e?void 0:e.taxId:null,o=(null==e?void 0:e.applyTaxIVC)?null==e?void 0:e.taxRef:null;break;case p.J.RetailReturn:d=(null==e?void 0:e.applyTaxRET)||!1,i=(null==e?void 0:e.applyTaxRET)?null==e?void 0:e.taxId:null,o=(null==e?void 0:e.applyTaxRET)?null==e?void 0:e.taxRef:null;break;case p.J.RetailPurchase||p.J.RetailPurchaseReturn:d=(null==e?void 0:e.applyTaxPUR)||!1,i=(null==e?void 0:e.applyTaxPUR)?null==e?void 0:e.taxId:null,o=(null==e?void 0:e.applyTaxPUR)?null==e?void 0:e.taxRef:null}let r=null==tL?void 0:null===(l=tL.record)||void 0===l?void 0:l.value,u=null==lX?void 0:null===(t=lX.list)||void 0===t?void 0:t.find(e=>{let{key:l}=e;return"countryId"===l}),s=(null==l6?void 0:null===(n=l6.current)||void 0===n?void 0:null===(a=n.documentTypes)||void 0===a?void 0:a.some(l=>l.recordId==(null==e?void 0:e.dtId)))||!1;tn.setFieldValue("singleCashPos",r),tn.setFieldValue("header.isVatable",d),tn.setFieldValue("header.taxId",i),tn.setFieldValue("header.taxRef",o),tn.setFieldValue("header.currencyId",null==e?void 0:e.currencyId),tn.setFieldValue("header.currencyName",null==e?void 0:e.currencyName),tn.setFieldValue("header.plantId",null==e?void 0:e.plantId),tn.setFieldValue("header.plantName",null==e?void 0:e.plantName),tn.setFieldValue("header.siteId",null==e?void 0:e.siteId),tn.setFieldValue("header.siteName",null==e?void 0:e.siteName),tn.setFieldValue("header.posRef",null==e?void 0:e.reference),tn.setFieldValue("header.plId",null==e?void 0:e.plId),tn.setFieldValue("header.dtId",tn.values.header.dtId||s?null==e?void 0:e.dtId:null),tn.setFieldValue("header.countryId",null==u?void 0:u.value),lH(e=>({...e,countryId:null==u?void 0:u.value}))}async function tG(){let e=await lG({extension:m.A.RetailInvoice.level,parameters:"_posId=".concat(parseInt(null==lO?void 0:lO.posId),"&_functionId=").concat(lq)});l6.current=(null==e?void 0:e.record)||null}async function tE(e){var l,t,a,n,d;if(!e)return;let i=null==l6?void 0:null===(a=l6.current)||void 0===a?void 0:null===(t=a.cashAccounts)||void 0===t?void 0:null===(l=t.find(l=>parseInt(l.recordId)===e))||void 0===l?void 0:l.bankId,o=(null==l6?void 0:null===(d=l6.current)||void 0===d?void 0:null===(n=d.creditCards)||void 0===n?void 0:n.filter(e=>e.bankId==i))||[];l3.current=o}async function tU(e){var l;if(!e){tn.setFieldValue("disableSKULookup",!1);return}let t=await lG({extension:m.A.DocumentTypeDefault.get,parameters:"_dtId=".concat(e)});tn.setFieldValue("disableSKULookup",(null==t?void 0:null===(l=t.record)||void 0===l?void 0:l.disableSKULookup)||!1)}async function tW(){var e,l,t;let a=await tP(null===(l=tn.values)||void 0===l?void 0:null===(e=l.header)||void 0===e?void 0:e.oDocId),n=await Promise.all(null==a?void 0:null===(t=a.items)||void 0===t?void 0:t.map(async(e,l)=>{let t=await tr(null==e?void 0:e.taxId);return tF({...e,id:l+1,qty:parseFloat(e.qty).toFixed(2),unitPrice:parseFloat(e.unitPrice).toFixed(2),extendedPrice:parseFloat(e.extendedPrice).toFixed(2),priceWithVAT:tK(e,null==t?void 0:t[0],O.yO),taxDetails:t},O.yO)}));tn.setFieldValue("items",n),lz(!0)}function tK(){var e,l;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2?arguments[2]:void 0,d=null!==(e=null==t?void 0:t.unitPrice)&&void 0!==e?e:0,i=null!==(l=null==t?void 0:t.priceWithVAT)&&void 0!==l?l:0;if(!a)return(i?Math.abs(i-d):d).toFixed(2);let{amount:o=0,taxBase:r}=a;switch(n){case O.yO:return(d*(1+o/100)).toFixed(2);case O.Xf:if(1==r)return(i/(1+o/100)).toFixed(2);if(2==r)return i.toFixed(2);return(i-d).toFixed(2);default:return}}return(0,d.useEffect)(()=>{tn.setFieldValue("header.name",(null==lQ?void 0:lQ.name)||""),tn.setFieldValue("header.street1",(null==lQ?void 0:lQ.street1)||""),tn.setFieldValue("header.street2",(null==lQ?void 0:lQ.street2)||""),tn.setFieldValue("header.cityId",(null==lQ?void 0:lQ.cityId)||""),tn.setFieldValue("header.city",(null==lQ?void 0:lQ.city)||""),tn.setFieldValue("header.phone",(null==lQ?void 0:lQ.phone)||"")},[lQ]),(0,d.useEffect)(()=>{tU(tn.values.header.dtId)},[tn.values.header.dtId]),(0,d.useEffect)(()=>{tn.setFieldValue("header.qty",parseFloat(tC).toFixed(2)),tn.setFieldValue("header.weight",parseFloat(tZ).toFixed(2)),tn.setFieldValue("header.amount",parseFloat(tw).toFixed(2)),tn.setFieldValue("header.baseAmount",parseFloat(tw).toFixed(2)),tn.setFieldValue("header.subtotal",parseFloat(tj).toFixed(2)),tn.setFieldValue("header.vatAmount",parseFloat(tV).toFixed(2))},[tC,tw,tZ,tj,tV]),(0,d.useEffect)(()=>{!async function(){if(await tG(),lS)await t_(lS);else{await tS();let e=await tD();await tJ(null==e?void 0:e.record)}}()},[]),(0,a.jsx)(b.Z,{resourceId:l7[parseInt(lq)],form:tn,functionId:lq,maxAccess:te,previewReport:to,actions:ty,editMode:to,disabledSubmit:0!=tN||ti,children:(0,a.jsxs)(o.R,{children:[(0,a.jsx)(i.g,{children:(0,a.jsxs)(f.ZP,{container:!0,spacing:2,xs:12,children:[(0,a.jsx)(f.ZP,{item:!0,xs:3,children:(0,a.jsxs)(f.ZP,{container:!0,spacing:2,children:[(0,a.jsx)(f.ZP,{item:!0,xs:12,children:(0,a.jsx)(A.Z,{endpointId:m.A.RetailInvoice.level,reducer:e=>{var l,t,a;return to?null==e?void 0:null===(l=e.record)||void 0===l?void 0:l.documentTypes:null==e?void 0:null===(a=e.record)||void 0===a?void 0:null===(t=a.documentTypes)||void 0===t?void 0:t.filter(e=>1==e.activeStatus)},parameters:"_posId=".concat(parseInt(null==lO?void 0:lO.posId),"&_functionId=").concat(lq),name:"header.dtId",readOnly:ti||(null==tn?void 0:null===(er=tn.values)||void 0===er?void 0:null===(eo=er.items)||void 0===eo?void 0:eo.some(e=>e.sku)),label:lT.documentType,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],valueField:"recordId",displayField:["reference","name"],values:tn.values.header,maxAccess:te,onChange:async(e,l)=>{await tl(l),tn.setFieldValue("header.dtId",(null==l?void 0:l.recordId)||null)},error:(null===(es=tn.touched)||void 0===es?void 0:null===(eu=es.header)||void 0===eu?void 0:eu.dtId)&&!!(null===(ev=tn.errors)||void 0===ev?void 0:null===(ec=ev.header)||void 0===ec?void 0:ec.dtId)})}),(0,a.jsx)(f.ZP,{item:!0,xs:12,children:(0,a.jsx)(R.Z,{name:"header.reference",label:lT.reference,value:null==tn?void 0:null===(eh=tn.values)||void 0===eh?void 0:null===(em=eh.header)||void 0===em?void 0:em.reference,maxAccess:!to&&te,readOnly:to,onChange:tn.handleChange,onClear:()=>tn.setFieldValue("header.reference",""),error:(null===(ex=tn.touched)||void 0===ex?void 0:null===(ep=ex.header)||void 0===ep?void 0:ep.reference)&&!!(null===(ey=tn.errors)||void 0===ey?void 0:null===(eI=ey.header)||void 0===eI?void 0:eI.reference)})}),(0,a.jsx)(f.ZP,{item:!0,xs:12,children:(0,a.jsx)(I.Z,{name:"header.date",required:!0,label:lT.date,readOnly:!0,value:null==tn?void 0:null===(eP=tn.values)||void 0===eP?void 0:null===(ef=eP.header)||void 0===ef?void 0:ef.date,onChange:tn.setFieldValue,editMode:to,maxAccess:te,onClear:()=>tn.setFieldValue("header.date",""),error:(null===(eF=tn.touched)||void 0===eF?void 0:null===(eb=eF.header)||void 0===eb?void 0:eb.date)&&!!(null===(eR=tn.errors)||void 0===eR?void 0:null===(eg=eR.header)||void 0===eg?void 0:eg.date)})}),(0,a.jsx)(f.ZP,{item:!0,xs:12,children:(0,a.jsx)(A.Z,{endpointId:m.A.RetailInvoice.level,reducer:e=>{var l,t,a;return to?null==e?void 0:null===(l=e.record)||void 0===l?void 0:l.salesPeople:null==e?void 0:null===(a=e.record)||void 0===a?void 0:null===(t=a.salesPeople)||void 0===t?void 0:t.filter(e=>!0!==e.isInactive)},parameters:"_posId=".concat(parseInt(null==lO?void 0:lO.posId),"&_functionId=").concat(lq),name:"header.spId",readOnly:ti,label:lT.salesPerson,columnsInDropDown:[{key:"spRef",value:"Reference"},{key:"spName",value:"Name"}],valueField:"spId",displayField:"spName",values:tn.values.header,maxAccess:te,displayFieldWidth:1.5,onChange:(e,l)=>{tn.setFieldValue("header.spId",null==l?void 0:l.spId)},error:(null===(eC=tn.touched)||void 0===eC?void 0:null===(eA=eC.header)||void 0===eA?void 0:eA.spId)&&!!(null===(eZ=tn.errors)||void 0===eZ?void 0:null===(ew=eZ.header)||void 0===ew?void 0:ew.spId)})}),(0,a.jsx)(f.ZP,{item:!0,xs:12,children:(0,a.jsx)(k.Z,{name:"header.KGmetalPrice",maxAccess:te,label:lT.metalPrice,value:tn.values.header.KGmetalPrice,onChange:tn.handleChange,readOnly:!tn.values.baseMetalCuId||ti,hidden:!to&&!tn.values.baseMetalCuId||to&&!tn.values.header.dtId,onClear:()=>tn.setFieldValue("header.KGmetalPrice",""),error:(null===(eV=tn.touched)||void 0===eV?void 0:null===(ej=eV.header)||void 0===ej?void 0:ej.KGmetalPrice)&&!!(null===(eN=tn.errors)||void 0===eN?void 0:null===(ek=eN.header)||void 0===ek?void 0:ek.KGmetalPrice)})}),p.J.RetailReturn==lq&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(f.ZP,{item:!0,xs:9,children:(0,a.jsx)(Z.U,{endpointId:m.A.RetailInvoice.snapshot,parameters:{_posId:parseInt(null==lO?void 0:lO.posId),_functionId:p.J.RetailInvoice},valueField:"reference",displayField:"reference",name:"header.oDocRef",label:lT.invoices,readOnly:ti||(null===(eT=tn.values.items)||void 0===eT?void 0:eT.some(e=>!!e.itemId)),form:tn,displayFieldWidth:1.5,formObject:tn.values.header,secondDisplayField:!1,onChange:(e,l)=>{tn.setFieldValue("header.isVatable",(null==l?void 0:l.isVatable)||!1),tn.setFieldValue("header.oDocRef",(null==l?void 0:l.reference)||""),tn.setFieldValue("header.oDocId",(null==l?void 0:l.recordId)||null)},errorCheck:"oDocId",maxAccess:te})}),(0,a.jsx)(f.ZP,{item:!0,xs:2,children:(0,a.jsx)(K.Z,{onClick:()=>tW(),tooltipText:lM.import,image:"import.png",disabled:!tn.values.header.oDocId||(null===(eO=tn.values.items)||void 0===eO?void 0:eO.some(e=>!!e.itemId))||ti})})]})]})}),(0,a.jsx)(f.ZP,{item:!0,xs:3,children:(0,a.jsxs)(f.ZP,{container:!0,spacing:2,children:[(0,a.jsx)(f.ZP,{item:!0,xs:12,children:(0,a.jsx)(R.Z,{name:"header.name",label:lT.name,value:null==tn?void 0:null===(eS=tn.values)||void 0===eS?void 0:null===(e_=eS.header)||void 0===e_?void 0:e_.name,maxAccess:te,readOnly:ti,onChange:e=>{let{value:l}=e.target;tn.handleChange(e),lH(e=>({...e,name:l})),l1(!0)},onClear:()=>{tn.setFieldValue("header.name",""),lH(e=>({...e,name:""})),l1(!0)},error:(null===(eD=tn.touched)||void 0===eD?void 0:null===(eq=eD.header)||void 0===eq?void 0:eq.name)&&!!(null===(eJ=tn.errors)||void 0===eJ?void 0:null===(eL=eJ.header)||void 0===eL?void 0:eL.name)})}),(0,a.jsx)(f.ZP,{item:!0,xs:12,children:(0,a.jsx)(R.Z,{name:"header.street1",label:lT.street,value:null==tn?void 0:null===(eE=tn.values)||void 0===eE?void 0:null===(eG=eE.header)||void 0===eG?void 0:eG.street1,maxAccess:te,readOnly:ti,onChange:e=>{let{value:l}=e.target;tn.handleChange(e),lH(e=>({...e,street1:l})),l1(!0)},onClear:()=>{tn.setFieldValue("header.street1",""),lH(e=>({...e,street1:""})),l1(!0)},error:(null===(eU=tn.touched.header)||void 0===eU||eU.street1,!!(null===(eW=tn.errors.header)||void 0===eW?void 0:eW.street1))})}),(0,a.jsx)(f.ZP,{item:!0,xs:12,children:(0,a.jsx)(R.Z,{name:"header.street2",label:lT.street2,value:null==tn?void 0:null===(eM=tn.values)||void 0===eM?void 0:null===(eK=eM.header)||void 0===eK?void 0:eK.street2,maxAccess:te,readOnly:ti,onChange:e=>{let{value:l}=e.target;tn.handleChange(e),lH(e=>({...e,street2:l})),l1(!0)},onClear:()=>{tn.setFieldValue("header.street2",""),lH(e=>({...e,street2:""})),l1(!0)},error:(null===(e$=tn.touched)||void 0===e$?void 0:null===(eX=e$.header)||void 0===eX?void 0:eX.street2)&&!!(null===(eH=tn.errors)||void 0===eH?void 0:null===(eQ=eH.header)||void 0===eQ?void 0:eQ.street2)})}),(0,a.jsx)(f.ZP,{item:!0,xs:12,children:(0,a.jsx)(Z.U,{endpointId:C.r.City.snapshot,parameters:{_countryId:tn.values.header.countryId,_stateId:tn.values.header.stateId||0},valueField:"name",displayField:"name",name:"header.city",label:lT.city,readOnly:ti,form:tn,formObject:tn.values.header,secondDisplayField:!1,onChange:(e,l)=>{lH(e=>({...e,cityId:null==l?void 0:l.recordId,city:null==l?void 0:l.name})),tn.setFieldValue("header.cityId",null==l?void 0:l.recordId),tn.setFieldValue("header.city",null==l?void 0:l.name),l1(!0)},error:(null===(eB=tn.touched.header)||void 0===eB||eB.cityId,!!(null===(ez=tn.errors.header)||void 0===ez?void 0:ez.cityId)),maxAccess:te})}),(0,a.jsx)(f.ZP,{item:!0,xs:12,children:(0,a.jsx)(R.Z,{name:"header.phone",label:lT.phone,value:tn.values.header.phone,readOnly:ti,maxLength:"15",phone:!0,onChange:e=>{let{value:l}=e.target;tn.handleChange(e),lH(e=>({...e,phone:l})),l1(!0)},onClear:()=>{tn.setFieldValue("header.phone",""),lH(e=>({...e,phone:""})),l1(!0)},error:(null===(eY=tn.touched.header)||void 0===eY?void 0:eY.phone)&&!!(null===(e0=tn.errors.header)||void 0===e0?void 0:e0.phone),maxAccess:te})})]})}),(0,a.jsx)(f.ZP,{item:!0,xs:3,children:(0,a.jsxs)(f.ZP,{container:!0,spacing:2,children:[(0,a.jsx)(f.ZP,{item:!0,xs:12,children:(0,a.jsx)(R.Z,{name:"header.posRef",label:lT.pos,readOnly:!0,value:null==tn?void 0:null===(e1=tn.values)||void 0===e1?void 0:null===(e2=e1.header)||void 0===e2?void 0:e2.posRef,maxAccess:te,onChange:tn.handleChange,onClear:()=>tn.setFieldValue("header.posRef",""),error:(null===(e6=tn.touched)||void 0===e6?void 0:null===(e3=e6.header)||void 0===e3?void 0:e3.posRef)&&!!(null===(e5=tn.errors)||void 0===e5?void 0:null===(e8=e5.header)||void 0===e8?void 0:e8.posRef)})}),(0,a.jsx)(f.ZP,{item:!0,xs:12,children:(0,a.jsx)(R.Z,{name:"header.plantName",label:lT.plant,value:null==tn?void 0:null===(e7=tn.values)||void 0===e7?void 0:null===(e9=e7.header)||void 0===e9?void 0:e9.plantName,maxAccess:te,readOnly:!0,onChange:tn.handleChange,onClear:()=>tn.setFieldValue("header.plantName",""),error:(null===(le=tn.touched)||void 0===le?void 0:null===(e4=le.header)||void 0===e4?void 0:e4.plantName)&&!!(null===(lt=tn.errors)||void 0===lt?void 0:null===(ll=lt.header)||void 0===ll?void 0:ll.plantName)})}),(0,a.jsx)(f.ZP,{item:!0,xs:12,children:(0,a.jsx)(R.Z,{name:"header.siteName",label:lT.site,value:null==tn?void 0:null===(ln=tn.values)||void 0===ln?void 0:null===(la=ln.header)||void 0===la?void 0:la.siteName,maxAccess:te,readOnly:!0,onChange:tn.handleChange,onClear:()=>tn.setFieldValue("header.siteName",""),error:(null===(li=tn.touched)||void 0===li?void 0:null===(ld=li.header)||void 0===ld?void 0:ld.siteName)&&!!(null===(lr=tn.errors)||void 0===lr?void 0:null===(lo=lr.header)||void 0===lo?void 0:lo.siteName)})}),(0,a.jsx)(f.ZP,{item:!0,xs:12,children:(0,a.jsx)(R.Z,{name:"header.currencyName",label:lT.currency,value:null==tn?void 0:null===(ls=tn.values)||void 0===ls?void 0:null===(lu=ls.header)||void 0===lu?void 0:lu.currencyName,maxAccess:te,readOnly:!0,onChange:tn.handleChange,onClear:()=>tn.setFieldValue("header.currencyName",""),error:(null===(lv=tn.touched)||void 0===lv?void 0:null===(lc=lv.header)||void 0===lc?void 0:lc.currencyName)&&!!(null===(lh=tn.errors)||void 0===lh?void 0:null===(lm=lh.header)||void 0===lm?void 0:lm.currencyName)})}),(0,a.jsx)(f.ZP,{item:!0,xs:10,children:(0,a.jsx)(R.Z,{name:"header.taxRef",label:lT.tax,value:null==tn?void 0:null===(lx=tn.values)||void 0===lx?void 0:null===(lp=lx.header)||void 0===lp?void 0:lp.taxRef,maxAccess:te,readOnly:!0,onChange:tn.handleChange,onClear:()=>tn.setFieldValue("header.taxRef",""),error:(null===(ly=tn.touched)||void 0===ly?void 0:null===(lI=ly.header)||void 0===lI?void 0:lI.taxRef)&&!!(null===(lP=tn.errors)||void 0===lP?void 0:null===(lf=lP.header)||void 0===lf?void 0:lf.taxRef)})}),(0,a.jsx)(f.ZP,{item:!0,xs:2,children:(0,a.jsx)(E.Z,{name:"header.isVatable",value:null===(lF=tn.values)||void 0===lF?void 0:null===(lb=lF.header)||void 0===lb?void 0:lb.isVatable,onChange:e=>tn.setFieldValue("header.isVatable",e.target.checked),label:lT.vat,maxAccess:te,disabled:null==tn?void 0:null===(lR=tn.values)||void 0===lR?void 0:null===(lg=lR.items)||void 0===lg?void 0:lg.some(e=>e.sku)})})]})}),(0,a.jsx)(f.ZP,{item:!0,xs:3,children:(0,a.jsxs)(f.ZP,{container:!0,spacing:2,children:[(0,a.jsx)(f.ZP,{item:!0,xs:12,children:(0,a.jsx)(D.Z,{name:"header.deliveryNotes",label:lT.notes,value:tn.values.header.deliveryNotes,rows:3.8,maxAccess:te,readOnly:ti,onChange:e=>tn.setFieldValue("header.deliveryNotes",e.target.value),onClear:()=>tn.setFieldValue("header.deliveryNotes","")})}),(0,a.jsx)(f.ZP,{item:!0,xs:12,children:(0,a.jsx)(K.Z,{label:lT.addressDetails,onClick:()=>void lK({Component:W.Z,props:{address:lQ,setAddress:lH,isCleared:!1,datasetId:h.i.ADDRetailInvoice}})})}),(0,a.jsx)(f.ZP,{item:!0,xs:12,children:(0,a.jsx)(R.Z,{name:"header.clientTaxNo",label:lT.clientTaxNo,readOnly:ti,maxLength:"30",value:null==tn?void 0:null===(lC=tn.values)||void 0===lC?void 0:null===(lA=lC.header)||void 0===lA?void 0:lA.clientTaxNo,maxAccess:te,onChange:tn.handleChange,onClear:()=>tn.setFieldValue("header.clientTaxNo",""),error:(null===(lZ=tn.touched)||void 0===lZ?void 0:null===(lw=lZ.header)||void 0===lw?void 0:lw.clientTaxNo)&&!!(null===(lV=tn.errors)||void 0===lV?void 0:null===(lj=lV.header)||void 0===lj?void 0:lj.clientTaxNo)})})]})})]})}),(0,a.jsx)(j.Q,{children:(0,a.jsx)(V._,{onChange:(e,l)=>{tn.setFieldValue("items",e),"delete"===l&&lz(!0)},value:null==tn?void 0:null===(lk=tn.values)||void 0===lk?void 0:lk.items,error:tn.errors.items,initialValues:tn.initialValues.items[0],name:"items",columns:tT,maxAccess:te,disabled:ti||!tn.values.header.currencyId,allowDelete:!ti})}),(0,a.jsx)(i.g,{children:(0,a.jsxs)(f.ZP,{container:!0,rowGap:1,xs:12,children:[(0,a.jsx)(f.ZP,{container:!0,rowGap:1,xs:8,children:(0,a.jsx)(V._,{onChange:(e,l)=>{tn.setFieldValue("cash",e)},value:null==tn?void 0:null===(lN=tn.values)||void 0===lN?void 0:lN.cash,error:tn.errors.cash,name:"cash",onSelectionChange:(e,l,t)=>{"ccRef"==t&&tE(null==e?void 0:e.cashAccountId)},columns:tO,maxAccess:te,disabled:ti,allowDelete:!ti})}),(0,a.jsxs)(f.ZP,{container:!0,direction:"row",xs:4,spacing:2,sx:{pl:2},children:[(0,a.jsxs)(f.ZP,{container:!0,item:!0,xs:6,direction:"column",spacing:1,sx:{mt:1},children:[(0,a.jsx)(f.ZP,{item:!0,children:(0,a.jsx)(k.Z,{name:"header.weight",maxAccess:te,label:lT.totWeight,value:tZ,readOnly:!0})}),(0,a.jsx)(f.ZP,{item:!0,children:(0,a.jsx)(k.Z,{name:"header.qty",maxAccess:te,label:lT.totQty,value:tC,readOnly:!0})})]}),(0,a.jsxs)(f.ZP,{container:!0,item:!0,xs:6,direction:"column",spacing:1,sx:{mt:1},children:[(0,a.jsx)(f.ZP,{item:!0,children:(0,a.jsx)(k.Z,{name:"header.subTotal",maxAccess:te,label:lT.subtotal,value:tj,readOnly:!0})}),(0,a.jsx)(f.ZP,{item:!0,children:(0,a.jsx)(k.Z,{name:"header.vatAmount",maxAccess:te,label:lT.vat,value:tV,readOnly:!0})}),(0,a.jsx)(f.ZP,{item:!0,children:(0,a.jsx)(k.Z,{name:"header.amount",maxAccess:te,label:lT.net,value:tw,readOnly:!0})}),(0,a.jsx)(f.ZP,{item:!0,children:(0,a.jsx)(k.Z,{name:"header.balance",maxAccess:te,label:lT.balance,value:tN,readOnly:!0})})]})]})]})})]})})}var Q=t(69387),H=t(78618),B=t(1685),z=t(63165),Y=()=>{var e,l,t;let{postRequest:I,getRequest:y}=(0,d.useContext)(v.$),{platformLabels:f,defaultsData:P}=(0,d.useContext)(c.l),{stack:b,lockRecord:R}=(0,x.zY)(),{stack:A}=(0,u.V)(),{addLockedScreen:C}=(0,d.useContext)(M.Z),{functionId:w}=(0,z.F)(),Z=null===(e=(0,B.m)("userData"))||void 0===e?void 0:e.userId,j=(0,d.useRef)(null),V={[p.J.RetailInvoice]:h.i.RetailInvoice,[p.J.RetailReturn]:h.i.RetailInvoiceReturn,[p.J.RetailPurchase]:h.i.RetailPurchase,[p.J.RetailPurchaseReturn]:h.i.RetailPurchaseReturn},{query:{data:k},filterBy:N,refetch:T,labels:O,access:_,paginationParameters:S,invalidate:q}=(0,g.J)({enabled:!!(null==j?void 0:null===(l=j.current)||void 0===l?void 0:l.posId),queryFn:L,endpointId:m.A.RetailInvoice.qry,datasetId:h.i.RetailInvoice,DatasetIdAccess:V[parseInt(w)],filter:{filterFn:U,default:{functionId:w}}}),D=[{field:"reference",headerName:O.reference,flex:1},{field:"dtName",headerName:O.documentType,flex:1},{field:"date",headerName:O.date,flex:1,type:"date"},{field:"statusName",headerName:O.status,flex:1}];async function L(){var e;let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{_startAt:t=0,_pageSize:a=50,params:n=[]}=l;return{...await y({extension:m.A.RetailInvoice.qry,parameters:"_startAt=".concat(t,"&_pageSize=").concat(a,"&_params=").concat(n,"&_functionId=").concat(w,"&_posId=").concat(null==j?void 0:null===(e=j.current)||void 0===e?void 0:e.posId,"&_filter=")}),_startAt:t}}async function J(){var e;let l=null==P?void 0:null===(e=P.list)||void 0===e?void 0:e.find(e=>{let{key:l}=e;return"countryId"===l});return parseInt(null==l?void 0:l.value)}async function G(){return await y({extension:m.A.PosUsers.get,parameters:"_userId=".concat(Z)})}async function E(){var e,l;if(null==j?void 0:null===(e=j.current)||void 0===e?void 0:e.posId)return await y({extension:m.A.PointOfSales.get,parameters:"_recordId=".concat(null==j?void 0:null===(l=j.current)||void 0===l?void 0:l.posId)})}async function U(e){var l;let{filters:t,pagination:a}=e;return t.qry?await y({extension:m.A.RetailInvoice.snapshot,parameters:"_filter=".concat(t.qry,"&_functionId=").concat(w,"&_posId=").concat(null==j?void 0:null===(l=j.current)||void 0===l?void 0:l.posId)}):L({_startAt:a._startAt||0,params:null==t?void 0:t.params})}let{proxyAction:W}=(0,s.G)({functionId:(null==j?void 0:null===(t=j.current)||void 0===t?void 0:t.posId)?w:null,action:async()=>{var e;if(!(null==j?void 0:null===(e=j.current)||void 0===e?void 0:e.posId)){A({message:O.noUserPos});return}if(!await J()){A({message:O.noSelectedCountry});return}let l=await E();if(null==l?void 0:l.record.isInactive){A({message:O.InactivePos});return}ee()}}),K=e=>e===p.J.RetailInvoice?O.RetailInvoice:e===p.J.RetailReturn?O.RetailReturn:e===p.J.RetailPurchase?O.RetailPurchase:e===p.J.RetailPurchaseReturn?O.RetailPurchaseReturn:void 0,X=e=>{switch(Number(e)){case p.J.RetailInvoice:return h.i.GLRetailInvoice;case p.J.RetailReturn:return h.i.GLRetailInvoiceReturn;case p.J.RetailPurchase:return h.i.GLRetailPurchase;case p.J.RetailPurchaseReturn:return h.i.GLRetailPurchaseReturn;default:return null}};function Y(e){b({Component:$,props:{labels:O,recordId:e,access:_,posUser:null==j?void 0:j.current,functionId:w,lockRecord:R,getGLResource:X},width:1200,height:725,title:K(parseInt(w))})}async function ee(e,l,t){e&&3!==t?await R({recordId:e,reference:l,resourceId:V[parseInt(w)],onSuccess:()=>{C({resourceId:V[parseInt(w)],recordId:e,reference:l}),Y(e)},isAlreadyLocked:e=>{b({Component:H.Z,props:{DialogText:"".concat(f.RecordLocked," ").concat(e),title:f.Dialog}})}}):Y(e)}let el=async()=>{await W()},et=async e=>{await I({extension:m.A.RetailInvoice.del,record:JSON.stringify(e)}),q(),F.ZP.success(f.Deleted)};async function ea(){let e=await G();j.current=null==e?void 0:e.record}return(0,d.useEffect)(()=>{!async function(){await ea()}()},[]),(0,a.jsxs)(o.R,{children:[(0,a.jsx)(i.g,{children:(0,a.jsx)(r.Z,{onAdd:el,maxAccess:_,reportName:"PSIVC",filterBy:N})}),(0,a.jsx)(n.Z,{children:(0,a.jsx)(Q.Z,{columns:D,gridData:k,rowId:["recordId"],onEdit:e=>{ee(null==e?void 0:e.recordId,null==e?void 0:e.reference,null==e?void 0:e.status)},onDelete:et,deleteConfirmationType:"strict",isLoading:!1,pageSize:50,paginationParameters:S,refetch:T,paginationType:"api",maxAccess:_})})]})}},63165:function(e,l,t){"use strict";t.d(l,{F:function(){return d}});var a=t(5632),n=t(2784);let d=()=>{let e=(0,a.useRouter)(),[l,t]=(0,n.useState)(e.query);return l}},45937:function(e,l,t){"use strict";var a=t(52322),n=t(38449),d=t(93894),i=t(2784),o=t(65950),r=t(19473),u=t(21326);let s=e=>{let{recordId:l,editMode:t,onSubmit:s=()=>{},window:c,actions:v=[],address:m,setAddress:h,required:p=!0,...x}=e,{getRequest:I,postRequest:y}=(0,i.useContext)(o.$),{platformLabels:f}=(0,i.useContext)(r.l),[P,b]=(0,i.useState)(l||null),[F,g]=(0,i.useState)(null),R=!!m&&!!h,A=R?m:F,C=R?h:g;(0,u.Z)({title:f.Address,window:c});let w=async e=>{if(!p){C(e),s(e,c);return}let l={...e,recordId:P||(null==A?void 0:A.recordId)||null},t=await y({extension:n.r.Address.set,record:JSON.stringify(l)}),a=(null==t?void 0:t.recordId)||P||null,d={...l,recordId:a,addressId:a};b(a),C(d),s(d,c)};return(0,i.useEffect)(()=>{!R&&P&&(async()=>{let e=await I({extension:n.r.Address.get,parameters:"_filter=&_recordId=".concat(P)});g((null==e?void 0:e.record)||null)})()},[P,R]),(0,a.jsx)(d.O,{editMode:t,setAddress:C,address:A,onSubmit:w,actions:v,window:c,...x})};s.width=600,s.height=500,l.Z=s},93894:function(e,l,t){"use strict";t.d(l,{O:function(){return c}});var a=t(52322),n=t(2784),d=t(82737),i=t(13073),o=t(80983),r=t(31389),u=t(33625),s=t(48601);let c=e=>{let{setAddress:l,address:t,editMode:c,window:v,readOnly:m,allowPost:h=!0,optional:p=!1,onSubmit:x,isSavedClear:I=!0,isCleared:y=!0,changeClear:f=!1,actions:P=[],...b}=e,[F,g]=(0,n.useState)(!p),[R,A]=(0,n.useState)({}),{formik:C}=(0,o.c)({maxAccess:R.maxAccess,initialValues:{recordId:null,name:"",countryId:null,countryName:"",stateId:null,stateName:"",cityId:null,city:"",street1:"",street2:"",email1:"",email2:"",phone:"",phone2:"",phone3:"",addressId:null,postalCode:"",cityDistrictId:null,cityDistrict:"",bldgNo:"",unitNo:"",subNo:"",poBox:""},validateOnChange:!0,validateOnBlur:!0,validationSchema:s.Ry({...R.validate}),onSubmit:e=>{l(e),h?x(e,v):v.close()}});return(0,n.useEffect)(()=>{p&&(C.values.name||C.values.street1||C.values.countryId||C.values.cityId)&&g(!0),!p||C.values.name||C.values.street1||C.values.countryId||C.values.cityId||g(!1)},[C.values]),(0,a.jsx)(d.Z,{form:C,maxAccess:R.maxAccess,isInfo:!1,disabledSubmit:m,editMode:c,isSavedClear:I,isCleared:y,onClear:f?()=>{C.resetForm({values:C.initialValues})}:void 0,actions:P,...b,children:(0,a.jsx)(r.R,{children:(0,a.jsx)(u.g,{children:(0,a.jsx)(i.Z,{addressValidation:C,readOnly:m,required:F,setFormik:A,address:t,...b})})})})}},93878:function(e,l,t){"use strict";t.d(l,{Z:function(){return p}});var a=t(52322),n=t(60218),d=t(2784),i=t(65950),o=t(5088),r=t(80983),u=t(31389),s=t(62362),c=t(65215),v=t(26612),m=t(50023),h=t(21326);function p(e){var l,t,p,x,I,y,f;let{plId:P,itemId:b,window:F}=e,{getRequest:g}=(0,d.useContext)(i.$),{labels:R,access:A}=(0,m.Z)({datasetId:v.i.ItemDetails});(0,h.Z)({title:R.itemQuickView,window:F});let{formik:C}=(0,r.c)({maxAccess:A,initialValues:{recordId:b,sku:"",name:"",weight:null,volume:null,qtyOnHand:null,currentCost:null,defaultSalePrice:null}});return(0,d.useEffect)(()=>{!async function(){var e,l;if(!b)return;let t=await g({extension:c.$.Item.quickView,parameters:"_itemId=".concat(b,"&_plId=").concat(P||0)});C.setValues({...t.record,currentCost:(null==t?void 0:null===(e=t.record)||void 0===e?void 0:e.hideCost)?"**":null==t?void 0:null===(l=t.record)||void 0===l?void 0:l.currentCost})}()},[]),(0,a.jsx)(u.R,{children:(0,a.jsx)(s.Q,{children:(0,a.jsxs)(n.ZP,{container:!0,spacing:3,p:2,children:[(0,a.jsx)(n.ZP,{item:!0,xs:12,children:(0,a.jsx)(o.Z,{name:"sku",value:null==C?void 0:null===(l=C.values)||void 0===l?void 0:l.sku,label:R.sku,readOnly:!0,maxAccess:A})}),(0,a.jsx)(n.ZP,{item:!0,xs:12,children:(0,a.jsx)(o.Z,{name:"name",value:null==C?void 0:null===(t=C.values)||void 0===t?void 0:t.name,label:R.name,readOnly:!0,maxAccess:A})}),(0,a.jsx)(n.ZP,{item:!0,xs:12,children:(0,a.jsx)(o.Z,{name:"weight",value:null==C?void 0:null===(p=C.values)||void 0===p?void 0:p.weight,label:R.weight,readOnly:!0,maxAccess:A})}),(0,a.jsx)(n.ZP,{item:!0,xs:12,children:(0,a.jsx)(o.Z,{name:"volume",value:null==C?void 0:null===(x=C.values)||void 0===x?void 0:x.volume,label:R.volume,readOnly:!0,maxAccess:A})}),(0,a.jsx)(n.ZP,{item:!0,xs:12,children:(0,a.jsx)(o.Z,{name:"qtyOnHand",value:null==C?void 0:null===(I=C.values)||void 0===I?void 0:I.qtyOnHand,label:R.qtyOnHand,readOnly:!0,maxAccess:A})}),(0,a.jsx)(n.ZP,{item:!0,xs:12,children:(0,a.jsx)(o.Z,{name:"currentCost",value:null==C?void 0:null===(y=C.values)||void 0===y?void 0:y.currentCost,label:R.currentCost,readOnly:!0,maxAccess:A})}),(0,a.jsx)(n.ZP,{item:!0,xs:12,children:(0,a.jsx)(o.Z,{name:"defaultSalePrice",value:null==C?void 0:null===(f=C.values)||void 0===f?void 0:f.defaultSalePrice,label:R.defaultSalePrice,readOnly:!0,maxAccess:A})})]})})})}p.width=700,p.height=500},78618:function(e,l,t){"use strict";var a=t(52322),n=t(23925),d=t(31389),i=t(62362);let o=e=>{let{DialogText:l,bottomSection:t}=e;return(0,a.jsxs)(d.R,{children:[(0,a.jsx)(i.Q,{children:(0,a.jsx)(n.Z,{sx:{p:12},textAlign:"center",children:l})}),t]})};o.width=600,o.height=200,l.Z=o},16096:function(e,l,t){"use strict";t.d(l,{ER:function(){return a},Ot:function(){return u},Ww:function(){return r},Yi:function(){return i},a$:function(){return n}});let a=1,n=2,d=e=>{if(!0===e.tdPct){e.tdAmount>100?1===e.typeChange?e.tdAmount=0:e.tdAmount=e.currentDiscount:e.currentDiscount=e.tdAmount,e.hiddenTdPct=e.tdAmount;let l=e.subtotal*e.tdAmount/100;e.hiddenTdAmount=l,e.tdType=n}else if(e.tdAmount>e.subtotal)1===e.typeChange?e.tdAmount=0:e.tdAmount=e.currentDiscount;else{e.currentDiscount=e.tdAmount;let l=0===e.subtotal?0:100*e.tdAmount/e.subtotal;e.hiddenTdPct=l,e.hiddenTdAmount=e.tdAmount,e.tdType=a}return e},i=e=>e=d(e),o=(e,l)=>(e.forEach(e=>{l.totalQty+=parseFloat(e.qty),l.totalWeight+=e.qty*e.weight,l.totalVolume+=e.qty*e.volume,l.totalUpo+=e.upo,l.sumVat+=e.vatAmount}),l.net=l.sumExtended+l.sumVat+((null==l?void 0:l.miscAmount)||0)-((null==l?void 0:l.tdAmount)||0),l),r=e=>e.reduce((e,l)=>e+(Number(l.extendedPrice)||0),0),u=(e,l)=>l=o(e,l)}},function(e){e.O(0,[92515,2494,36908,23352,13073,49774,92888,40179],function(){return e(e.s=63117)}),_N_E=e.O()}]);