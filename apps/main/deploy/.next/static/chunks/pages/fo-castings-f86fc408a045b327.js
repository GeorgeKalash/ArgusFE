(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[69278],{37670:function(e,l,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/fo-castings",function(){return t(59e3)}])},59e3:function(e,l,t){"use strict";t.r(l),t.d(l,{default:function(){return E}});var a=t(52322),n=t(2784),s=t(71987),o=t(65950),i=t(69387),r=t(62202),d=t(61802),u=t(26612),c=t(31389),m=t(33625),v=t(62362),g=t(19473),p=t(98345),f=t(7121),x=t(36908),b=t(29326),h=t(9522),I=t(60218),W=t(89330),y=t(91406),F=t(5088),C=t(82737),j=t(8661),P=t(27423),w=t(36773),Z=t(65215),V=t(90587),_=t(80983),N=t(48601),R=t(38449),S=t(39812),O=t(39704);function k(e){var l,t,i,v,x,b,h,k,q,L,D,A,T,E,B,J,z,M;let{store:$,setStore:U,access:Y,labels:X}=e,{getRequest:H,postRequest:Q}=(0,n.useContext)(o.$),{platformLabels:G,defaultsData:K}=(0,n.useContext)(g.l),{stack:ee}=(0,d.zY)(),el=null==$?void 0:$.recordId,[et,ea]=(0,n.useState)(!1),[en,es]=(0,n.useState)(null),{documentType:eo,maxAccess:ei,changeDT:er}=(0,p.H)({functionId:f.J.Casting,access:Y,enabled:!el}),ed=(0,s.E)({endpointId:w.B.Casting.page}),eu=null==K?void 0:null===(t=K.list)||void 0===t?void 0:null===(l=t.find(e=>{let{key:l}=e;return"castingWorkCenterId"===l}))||void 0===l?void 0:l.value,{formik:ec}=(0,_.c)({maxAccess:ei,documentType:{key:"dtId",value:null==eo?void 0:eo.dtId},initialValues:{recordId:el,dtId:null,reference:"",status:1,date:new Date,waxId:null,waxRef:"",grossWgt:0,mouldWgt:0,rmWgt:0,netWgt:0,suggestedWgt:0,inputWgt:0,netInputWgt:0,outputWgt:0,loss:0,lossPct:0,lossDisassembly:0,lossCasting:0,allowedLossPct:0,lossVariationPct:0,laborId:null,lineId:null,mouldId:null,metalId:null,metalColorId:null,stdLossRate:0,factor:0,scrapWgt:0},validateOnChange:!0,validationSchema:N.Ry({date:N.hT().required(),mouldId:N.Rx().required(),metalId:N.Rx().required(),waxId:N.Rx().required(),metalColorId:N.Rx().required(),factor:N.Rx().required(),stdLossRate:N.Rx().required(),laborId:N.Rx().required(),grossWgt:N.Rx().required(),rmWgt:N.Rx().required(),mouldWgt:N.Rx().required(),netWgt:N.Rx().required(),suggestedWgt:N.Rx().required(),inputWgt:N.Rx().required(),netInputWgt:N.Rx().required(),outputWgt:N.Rx().required(),loss:N.Rx().min(0).required(),lossVariationPct:N.Rx().required(),lossPct:N.Rx().max(100).required(),lossCasting:N.Rx().required(),lossDisassembly:N.Rx().required()}),onSubmit:async e=>{let l=await Q({extension:w.B.Casting.set,record:JSON.stringify({...e,lossPct:parseFloat((null==e?void 0:e.lossPct)||0),date:(null==e?void 0:e.date)?(0,S.ku)(null==e?void 0:e.date):null})});ed(),r.ZP.success(em?G.Edited:G.Added),ej(null==l?void 0:l.recordId)}}),em=!!ec.values.recordId,ev=-1===ec.values.status,eg=3===ec.values.status,ep=(et?(Number(null==ec?void 0:null===(i=ec.values)||void 0===i?void 0:i.inputWgt)||0)+(Number(null==ec?void 0:null===(v=ec.values)||void 0===v?void 0:v.rmWgt)||0):Number(null==ec?void 0:null===(x=ec.values)||void 0===x?void 0:x.netInputWgt)||0).toFixed(2),ef=et?Number(null==ec?void 0:null===(b=ec.values)||void 0===b?void 0:b.lossDisassembly)+Number(null==ec?void 0:null===(h=ec.values)||void 0===h?void 0:h.lossCasting):Number(null==ec?void 0:null===(k=ec.values)||void 0===k?void 0:k.loss),ex=et?100*ef/(ep||1):Number(null==ec?void 0:null===(q=ec.values)||void 0===q?void 0:q.lossPct)||0,eb=et?ex-(Number(null==ec?void 0:null===(L=ec.values)||void 0===L?void 0:L.stdLossRate)||0):null==ec?void 0:null===(D=ec.values)||void 0===D?void 0:D.lossVariationPct;(0,n.useEffect)(()=>{var e,l,t,a,n;if(!et||!en)return;let s=Number((null==ec?void 0:null===(e=ec.values)||void 0===e?void 0:e.inputWgt)||0)+Number((null==ec?void 0:null===(l=ec.values)||void 0===l?void 0:l.rmWgt)||0),o=Number((null==ec?void 0:null===(t=ec.values)||void 0===t?void 0:t.outputWgt)||0),i=Number((null==ec?void 0:null===(a=ec.values)||void 0===a?void 0:a.lossDisassembly)||0),r=Number((null==ec?void 0:null===(n=ec.values)||void 0===n?void 0:n.lossCasting)||0),d=0;switch(en){case"outputWgt":r=(d=s-o)-i,ec.setFieldValue("lossCasting",r),ec.setFieldValue("loss",d);break;case"lossCasting":case"lossDisassembly":d=r+i,ec.setFieldValue("outputWgt",s-d),ec.setFieldValue("loss",d)}},[en,ec.values.outputWgt,ec.values.lossCasting,ec.values.lossDisassembly,ec.values.inputWgt,ec.values.rmWgt]);let eh=[{key:"Locked",condition:eg,disabled:!0},{key:"Unlocked",condition:!eg,onClick:eF,disabled:!em||ev},{key:"Cancel",condition:!0,onClick:eC,disabled:!em||ev||eg},{key:"WorkFlow",condition:!0,onClick:eI,disabled:!em}];async function eI(){ee({Component:O.Z,props:{functionId:f.J.Casting,recordId:ec.values.recordId},width:950,height:600,title:X.workflow})}async function eW(e,l){if(!e&&!l)return;let t=await H({extension:w.B.MetalSettings.get,parameters:"_metalId=".concat(e,"&_metalColorId=").concat(l)});return null==t?void 0:t.record}async function ey(e){if(!e)return;let l=await H({extension:w.B.Wax.get,parameters:"_recordId=".concat(e)});return null==l?void 0:l.record}async function eF(){await Q({extension:w.B.Casting.post,record:JSON.stringify({...ec.values,date:(0,S.ku)(ec.values.date)})}),r.ZP.success(G.Posted),ed(),ej(ec.values.recordId)}async function eC(){await Q({extension:w.B.Casting.cancel,record:JSON.stringify({...ec.values,date:(0,S.ku)(ec.values.date)})}),r.ZP.success(G.Cancelled),ed(),ej(ec.values.recordId)}async function ej(e){var l,t;if(!e)return;let a=await H({extension:w.B.Casting.get,parameters:"_recordId=".concat(e)}),n=await ey(null==a?void 0:null===(l=a.record)||void 0===l?void 0:l.waxId),s=await eW(null==n?void 0:n.metalId,null==n?void 0:n.metalColorId);ec.setValues({...null==a?void 0:a.record,date:(0,S.a1)(null==a?void 0:null===(t=a.record)||void 0===t?void 0:t.date),factor:(null==s?void 0:s.rate)||0,stdLossRate:(null==s?void 0:s.stdLossRate)||0,mouldId:(null==n?void 0:n.mouldId)||null,metalId:(null==n?void 0:n.metalId)||null,metalColorId:(null==n?void 0:n.metalColorId)||null}),U(l=>{var t,s,o,i,r;return{...l,recordId:e,isPosted:(null==a?void 0:null===(t=a.record)||void 0===t?void 0:t.status)==3,isCancelled:(null==a?void 0:null===(s=a.record)||void 0===s?void 0:s.status)==-1,metalInfo:{metalId:(null==n?void 0:n.metalId)||null,metalColorId:(null==n?void 0:n.metalColorId)||null},castingInfo:{...l.castingInfo,outputWgt:null==a?void 0:null===(o=a.record)||void 0===o?void 0:o.outputWgt,inputWgt:null==a?void 0:null===(i=a.record)||void 0===i?void 0:i.inputWgt,loss:null==a?void 0:null===(r=a.record)||void 0===r?void 0:r.loss}}})}return(0,n.useEffect)(()=>{if(!et)return;let e=(Number(ec.values.inputWgt)||0)+(Number(ec.values.rmWgt)||0);ec.setFieldValue("netInputWgt",Number(e.toFixed(3)))},[ec.values.inputWgt,ec.values.rmWgt]),(0,n.useEffect)(()=>{var e;ec.setFieldValue("loss",ef||0),ec.setFieldValue("lossPct",ex||0),ec.setFieldValue("lossVariationPct",eb||0),ec.setFieldValue("netInputWgt",ep||0),ec.setFieldValue("scrapWgt",(null==$?void 0:null===(e=$.castingInfo)||void 0===e?void 0:e.scrapWgt)||0),U(e=>({...e,castingInfo:{...e.castingInfo,loss:Number(ef)}}))},[ef,ex,eb,null==$?void 0:null===(A=$.castingInfo)||void 0===A?void 0:A.scrapWgt]),(0,n.useEffect)(()=>{ej(el)},[]),(0,a.jsx)(C.Z,{resourceId:u.i.FoCastings,functionId:f.J.Casting,form:ec,maxAccess:ei,previewReport:em,actions:eh,editMode:em,disabledSubmit:ev||eg,disabledSavedClear:ev||eg,children:(0,a.jsx)(c.R,{children:(0,a.jsx)(m.g,{children:(0,a.jsx)(I.ZP,{container:!0,children:(0,a.jsxs)(I.ZP,{container:!0,item:!0,xs:12,spacing:2,children:[(0,a.jsx)(I.ZP,{item:!0,xs:6,children:(0,a.jsxs)(I.ZP,{container:!0,direction:"column",spacing:2,children:[(0,a.jsx)(I.ZP,{item:!0,children:(0,a.jsx)(j.Z,{endpointId:R.r.DocumentType.qry,parameters:"_startAt=0&_pageSize=1000&_dgId=".concat(f.J.Casting),name:"dtId",label:X.docType,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],readOnly:em,valueField:"recordId",displayField:["reference","name"],values:ec.values,maxAccess:ei,onChange:async(e,l)=>{await er(l),ec.setFieldValue("dtId",(null==l?void 0:l.recordId)||null)},error:ec.touched.dtId&&!!ec.errors.dtId})}),(0,a.jsx)(I.ZP,{item:!0,children:(0,a.jsx)(F.Z,{name:"reference",label:X.reference,value:null==ec?void 0:null===(T=ec.values)||void 0===T?void 0:T.reference,maxAccess:!em&&ei,readOnly:em,onChange:ec.handleChange,onClear:()=>ec.setFieldValue("reference",""),error:ec.touched.reference&&!!ec.errors.reference})}),(0,a.jsx)(I.ZP,{item:!0,children:(0,a.jsx)(W.Z,{name:"date",required:!0,label:X.date,value:null==ec?void 0:null===(E=ec.values)||void 0===E?void 0:E.date,maxAccess:ei,readOnly:ev||eg,onChange:ec.setFieldValue,onClear:()=>ec.setFieldValue("date",null),error:ec.touched.date&&!!ec.errors.date})}),(0,a.jsx)(I.ZP,{item:!0,children:(0,a.jsx)(P.U,{endpointId:w.B.Wax.open,name:"waxId",readOnly:em,label:X.wax,secondDisplayField:!1,valueField:"waxRef",displayField:"waxRef",required:!0,valueShow:"waxRef",columnsInDropDown:[{key:"reference",value:"Reference"},{key:"mouldRef",value:"Mould"},{key:"prodLineName",value:"Production Line"}],form:ec,onChange:async(e,l)=>{ea(!0);let t=await eW(null==l?void 0:l.metalId,null==l?void 0:l.metalColorId),a=await ey(null==l?void 0:l.recordId);ec.setFieldValue("grossWgt",(null==a?void 0:a.grossWgt)||0),ec.setFieldValue("rmWgt",(null==a?void 0:a.rmWgt)||0),ec.setFieldValue("mouldWgt",(null==a?void 0:a.mouldWgt)||0),ec.setFieldValue("netWgt",(null==a?void 0:a.netWgt)||0),ec.setFieldValue("suggestedWgt",(null==a?void 0:a.suggestedWgt)||0),ec.setFieldValue("factor",(null==t?void 0:t.rate)||0),ec.setFieldValue("stdLossRate",(null==t?void 0:t.stdLossRate)||0),ec.setFieldValue("mouldId",(null==l?void 0:l.mouldId)||null),ec.setFieldValue("metalId",(null==l?void 0:l.metalId)||null),ec.setFieldValue("metalColorId",(null==l?void 0:l.metalColorId)||null),ec.setFieldValue("lineId",(null==l?void 0:l.lineId)||null),ec.setFieldValue("waxRef",(null==l?void 0:l.reference)||null),ec.setFieldValue("waxId",(null==l?void 0:l.recordId)||null),ec.setFieldValue("netInputWgt",(null==a?void 0:a.rmWgt)||0)},errorCheck:"waxId",maxAccess:ei})}),(0,a.jsx)(I.ZP,{item:!0,children:(0,a.jsx)(j.Z,{endpointId:w.B.Mould.qry,name:"mouldId",parameters:"_params=&_startAt=0&_pageSize=1000",label:X.mould,required:!0,valueField:"recordId",readOnly:!0,displayField:"reference",values:ec.values,maxAccess:ei,onChange:(e,l)=>{ec.setFieldValue("mouldId",(null==l?void 0:l.recordId)||null)},error:(null===(B=ec.touched)||void 0===B?void 0:B.mouldId)&&!!(null===(J=ec.errors)||void 0===J?void 0:J.mouldId)})}),(0,a.jsx)(I.ZP,{item:!0,children:(0,a.jsx)(j.Z,{endpointId:Z.$.Metals.qry,name:"metalId",label:X.metal,valueField:"recordId",displayField:"reference",readOnly:!0,values:ec.values,onChange:(e,l)=>{ec.setFieldValue("metalId",(null==l?void 0:l.recordId)||null)},required:!0,error:ec.touched.metalId&&!!ec.errors.metalId,maxAccess:ei})}),(0,a.jsx)(I.ZP,{item:!0,children:(0,a.jsx)(j.Z,{endpointId:Z.$.MetalColor.qry,name:"metalColorId",readOnly:!0,required:!0,label:X.metalColor,valueField:"recordId",displayField:"reference",values:ec.values,maxAccess:ei,onChange:async(e,l)=>{ec.setFieldValue("metalColorId",(null==l?void 0:l.recordId)||null)},error:(null===(z=ec.touched)||void 0===z?void 0:z.metalColorId)&&!!(null===(M=ec.errors)||void 0===M?void 0:M.metalColorId)})}),(0,a.jsx)(I.ZP,{item:!0,children:(0,a.jsx)(y.Z,{name:"factor",label:X.factor,value:ec.values.factor,required:!0,readOnly:!0,onChange:e=>{ec.setFieldValue("factor",e.target.value)},onClear:()=>ec.setFieldValue("factor",0),error:ec.touched.factor&&!!ec.errors.factor})}),(0,a.jsx)(I.ZP,{item:!0,children:(0,a.jsx)(y.Z,{name:"stdLossRate",label:X.standardLoss,value:ec.values.stdLossRate,required:!0,readOnly:!0,onChange:e=>{ec.setFieldValue("stdLossRate",e.target.value)},onClear:()=>ec.setFieldValue("stdLossRate",0),error:ec.touched.stdLossRate&&!!ec.errors.stdLossRate})}),(0,a.jsx)(I.ZP,{item:!0,children:(0,a.jsx)(j.Z,{endpointId:V.u.Labor.qry,parameters:"_startAt=0&_pageSize=200&_params=",filter:e=>e.workCenterId==eu,name:"laborId",label:X.labor,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],displayField:["reference","name"],readOnly:eg||ev,valueField:"recordId",required:!0,values:ec.values,onChange:(e,l)=>{ec.setFieldValue("laborId",(null==l?void 0:l.recordId)||null)},error:ec.touched.laborId&&!!ec.errors.laborId})}),(0,a.jsx)(I.ZP,{item:!0,children:(0,a.jsx)(j.Z,{endpointId:V.u.ProductionLine.qry,parameters:"_startAt=0&_pageSize=1000",values:ec.values,name:"lineId",label:X.productionLine,readOnly:!0,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],maxAccess:ei,onChange:(e,l)=>{ec.setFieldValue("lineId",(null==l?void 0:l.recordId)||null)},error:ec.touched.lineId&&ec.errors.lineId})})]})}),(0,a.jsx)(I.ZP,{item:!0,xs:6,children:(0,a.jsxs)(I.ZP,{container:!0,direction:"column",spacing:2,children:[(0,a.jsx)(I.ZP,{item:!0,children:(0,a.jsx)(y.Z,{name:"grossWgt",label:X.grossWgt,value:ec.values.grossWgt,required:!0,readOnly:!0,maxLength:11,decimalScale:4,onChange:e=>ec.setFieldValue("grossWgt",e.target.value),onClear:()=>ec.setFieldValue("grossWgt",0),error:ec.touched.grossWgt&&!!ec.errors.grossWgt})}),(0,a.jsx)(I.ZP,{item:!0,children:(0,a.jsx)(y.Z,{name:"rmWgt",label:X.rmWgt,value:ec.values.rmWgt,required:!0,readOnly:!0,maxLength:11,decimalScale:4,onChange:e=>ec.setFieldValue("rmWgt",e.target.value),onClear:()=>ec.setFieldValue("rmWgt",0),error:ec.touched.rmWgt&&!!ec.errors.rmWgt})}),(0,a.jsx)(I.ZP,{item:!0,children:(0,a.jsx)(y.Z,{name:"mouldWgt",label:X.mouldWgt,value:ec.values.mouldWgt,required:!0,readOnly:!0,maxLength:11,decimalScale:4,onChange:e=>ec.setFieldValue("mouldWgt",e.target.value),onClear:()=>ec.setFieldValue("mouldWgt",0),error:ec.touched.mouldWgt&&!!ec.errors.mouldWgt})}),(0,a.jsx)(I.ZP,{item:!0,children:(0,a.jsx)(y.Z,{name:"netWgt",label:X.netWgt,value:ec.values.netWgt,required:!0,readOnly:!0,maxLength:11,decimalScale:4,onChange:e=>ec.setFieldValue("netWgt",e.target.value),onClear:()=>ec.setFieldValue("netWgt",0),error:ec.touched.netWgt&&!!ec.errors.netWgt})}),(0,a.jsx)(I.ZP,{item:!0,children:(0,a.jsx)(y.Z,{name:"suggestedWgt",label:X.suggestedWgt,value:ec.values.suggestedWgt,required:!0,readOnly:!0,maxLength:11,decimalScale:3,onChange:e=>ec.setFieldValue("suggestedWgt",e.target.value),onClear:()=>ec.setFieldValue("suggestedWgt",0),error:ec.touched.suggestedWgt&&!!ec.errors.suggestedWgt})}),(0,a.jsx)(I.ZP,{item:!0,children:(0,a.jsx)(y.Z,{name:"inputWgt",label:X.inputWgt,value:ec.values.inputWgt,required:!0,decimalScale:3,readOnly:eg||ev,onChange:e=>{let l=Number(e.target.value)>32767?0:Number(e.target.value);ec.setFieldValue("inputWgt",l),U(e=>({...e,castingInfo:{...e.castingInfo,inputWgt:(null==l?void 0:l.toFixed(3))||0}})),ea(!0)},onClear:()=>ec.setFieldValue("inputWgt",0),error:ec.touched.inputWgt&&!!ec.errors.inputWgt})}),(0,a.jsx)(I.ZP,{item:!0,children:(0,a.jsx)(y.Z,{name:"netInputWgt",label:X.netInputWgt,value:ec.values.netInputWgt,required:!0,readOnly:!0,decimalScale:3,onChange:e=>{ec.setFieldValue("netInputWgt",e.target.value)},onClear:()=>ec.setFieldValue("netInputWgt",0),error:ec.touched.netInputWgt&&!!ec.errors.netInputWgt})}),(0,a.jsx)(I.ZP,{item:!0,children:(0,a.jsx)(y.Z,{name:"outputWgt",label:X.outputWgt,value:ec.values.outputWgt,required:!0,decimalScale:3,readOnly:eg||ev,onChange:e=>{ea(!0),es("outputWgt");let l=Number(e.target.value)>32767?0:Number(e.target.value);ec.setFieldValue("outputWgt",l),U(e=>({...e,castingInfo:{...e.castingInfo,outputWgt:(null==l?void 0:l.toFixed(3))||0}}))},onClear:()=>ec.setFieldValue("outputWgt",0),error:ec.touched.outputWgt&&!!ec.errors.outputWgt})}),(0,a.jsx)(I.ZP,{item:!0,children:(0,a.jsx)(y.Z,{name:"lossCasting",label:X.lossCasting,value:ec.values.lossCasting,required:!0,maxLength:12,decimalScale:3,maxAccess:ei,readOnly:!0,onChange:e=>{ea(!0),es("lossCasting"),ec.setFieldValue("lossCasting",e.target.value)},onClear:()=>ec.setFieldValue("lossCasting",null),error:ec.touched.lossCasting&&!!ec.errors.lossCasting})}),(0,a.jsx)(I.ZP,{item:!0,children:(0,a.jsx)(y.Z,{name:"lossDisassembly",label:X.lossDisassembly,value:ec.values.lossDisassembly,required:!0,maxLength:12,decimalScale:3,readOnly:!0,maxAccess:ei,onChange:e=>{ea(!0),es("lossDisassembly"),ec.setFieldValue("lossDisassembly",e.target.value)},onClear:()=>ec.setFieldValue("lossDisassembly",null),error:ec.touched.lossDisassembly&&!!ec.errors.lossDisassembly})}),(0,a.jsx)(I.ZP,{item:!0,children:(0,a.jsx)(y.Z,{name:"loss",label:X.loss,value:ef,required:!0,maxLength:11,decimalScale:3,readOnly:!0,onChange:e=>ec.setFieldValue("loss",e.target.value),onClear:()=>ec.setFieldValue("loss",0),error:ec.touched.loss&&!!ec.errors.loss})}),(0,a.jsx)(I.ZP,{item:!0,children:(0,a.jsx)(y.Z,{name:"lossPct",label:X.lossPct,value:ex,required:!0,maxLength:3,readOnly:!0,decimalScale:3,onChange:e=>{ec.setFieldValue("lossPct",e.target.value)},onClear:()=>ec.setFieldValue("lossPct",0),error:ec.touched.lossPct&&!!ec.errors.lossPct})}),(0,a.jsx)(I.ZP,{item:!0,children:(0,a.jsx)(y.Z,{name:"lossVariationPct",label:X.lossVariation,value:eb,required:!0,maxLength:5,readOnly:!0,decimalScale:3,onChange:e=>ec.setFieldValue("lossVariationPct",e.target.value),onClear:()=>ec.setFieldValue("lossVariationPct",0),error:ec.touched.lossVariationPct&&!!ec.errors.lossVariationPct})}),(0,a.jsx)(I.ZP,{item:!0,children:(0,a.jsx)(y.Z,{name:"scrapWgt",label:X.scrapWgt,value:ec.values.scrapWgt,readOnly:!0,decimalScale:3,onChange:e=>ec.setFieldValue("scrapWgt",e.target.value),onClear:()=>ec.setFieldValue("scrapWgt",0),error:ec.touched.scrapWgt&&!!ec.errors.scrapWgt})})]})})]})})})})})}var q=t(76399),L=t(54074);function D(e){var l,t,s,i;let{labels:d,maxAccess:u,store:m,setStore:p}=e,{postRequest:f,getRequest:x}=(0,n.useContext)(o.$),{platformLabels:b}=(0,n.useContext)(g.l),h=null==m?void 0:m.recordId,I=null==m?void 0:m.metalInfo,{formik:W}=(0,_.c)({maxAccess:u,initialValues:{items:[{id:1,castingId:h,seqNo:"",itemId:null,sku:"",itemName:"",weight:0}]},onSubmit:async e=>{let l=null==e?void 0:e.items.map((e,l)=>({...e,id:l+1,castingId:h,weight:(null==e?void 0:e.weight)||0}));await f({extension:w.B.CastingDisassembly.set2,record:JSON.stringify({castingId:h,items:l})}),r.ZP.success(b.Edited)}}),y=null===(t=W.values)||void 0===t?void 0:null===(l=t.items)||void 0===l?void 0:l.reduce((e,l)=>{var t;return e+(parseFloat(null===(t=l.weight)||void 0===t?void 0:t.toString().replace(/,/g,""))||0)},0),F=[{component:"resourcelookup",label:d.sku,name:"sku",props:{endpointId:Z.$.Item.snapshot,valueField:"sku",displayField:"sku",readOnly:!0,displayFieldWidth:2,mapping:[{from:"recordId",to:"itemId"},{from:"sku",to:"sku"},{from:"name",to:"itemName"}],columnsInDropDown:[{key:"sku",value:"SKU"},{key:"name",value:"Name"}]}},{component:"textfield",label:d.itemName,name:"itemName",props:{readOnly:!0}},{component:"numberfield",label:d.weight,name:"weight",props:{maxLength:11,decimals:4,allowNegative:!1}}];async function C(){var e,l;if(!(null==I?void 0:I.metalId)&&!(null==I?void 0:I.metalColorId))return;let t=await x({extension:w.B.MetalScrap.qry,parameters:"_metalId=".concat(null==I?void 0:I.metalId,"&_metalColorId=").concat(null==I?void 0:I.metalColorId)}),a=await x({extension:w.B.CastingDisassembly.qry,parameters:"_castingId=".concat(h)});(null==a?void 0:a.list.length)!=0?null==t||t.list.forEach(e=>{let l=null==a?void 0:a.list.find(l=>l.itemId===e.scrapItemId);l&&(e.weight=l.weight)}):null==t||t.list.forEach(e=>{e.weight=0});let n=(null==t?void 0:null===(e=t.list)||void 0===e?void 0:e.length)!=0?null==t?void 0:null===(l=t.list)||void 0===l?void 0:l.map((e,l)=>({...e,id:l+1,itemId:e.scrapItemId,weight:(null==e?void 0:e.weight)||0})):W.initialValues.items;W.setFieldValue("items",n)}return(0,n.useEffect)(()=>{p(e=>({...e,castingInfo:{...e.castingInfo,scrapWgt:y}}))},[y]),(0,n.useEffect)(()=>{h&&C()},[h,I]),(0,a.jsx)(L.Z,{onSave:W.handleSubmit,maxAccess:u,editMode:!0,disabledSubmit:(null==m?void 0:m.isCancelled)||(null==m?void 0:m.isPosted),isParentWindow:!1,children:(0,a.jsx)(c.R,{children:(0,a.jsx)(v.Q,{children:(0,a.jsx)(q._,{onChange:e=>W.setFieldValue("items",e),value:W.values.items,error:W.errors.items,columns:F,initialValues:null==W?void 0:null===(i=W.initialValues)||void 0===i?void 0:null===(s=i.items)||void 0===s?void 0:s[0],name:"items",maxAccess:u,allowDelete:!1,allowAddNewLine:!1,disabled:(null==m?void 0:m.isCancelled)||(null==m?void 0:m.isPosted)})})})})}function A(e){var l,t,s,i,d,u,p,f,x;let{labels:b,maxAccess:h,store:W}=e,{postRequest:F,getRequest:C}=(0,n.useContext)(o.$),{platformLabels:j}=(0,n.useContext)(g.l),P=null==W?void 0:W.recordId,{formik:Z}=(0,_.c)({validateOnChange:!0,initialValues:{disassemblyWgt:0,balanceWgt:0,items:[{id:1,castingId:P,seqNo:"",jobId:null,jobRef:"",itemId:null,sku:"",itemName:"",outputWgt:0,currentWgt:0,metalWgt:0,jobPct:0,issuedWgt:0,returnedWgt:0,loss:0,inputPcs:0,outputPcs:0,netWgt:0}]},validationSchema:N.Ry({balanceWgt:N.Rx().min(0).max(0).required()}),onSubmit:async e=>{let l=null==e?void 0:e.items.map((e,l)=>({...e,id:l+1,castingId:P,jobPct:parseFloat((null==e?void 0:e.jobPct)||0),inputPcs:parseFloat((null==e?void 0:e.inputPcs)||0),outputPcs:parseFloat((null==e?void 0:e.outputPcs)||0)}));await F({extension:w.B.CastingJob.set2,record:JSON.stringify({castingId:P,items:l})}),r.ZP.success(j.Edited)}}),V=null==Z?void 0:null===(t=Z.values)||void 0===t?void 0:null===(l=t.items)||void 0===l?void 0:l.reduce((e,l)=>{var t;return e+(parseFloat(null==l?void 0:null===(t=l.outputWgt)||void 0===t?void 0:t.toString().replace(/,/g,""))||0)},0),R=null==Z?void 0:null===(i=Z.values)||void 0===i?void 0:null===(s=i.items)||void 0===s?void 0:s.reduce((e,l)=>{var t;return e+(parseFloat(null==l?void 0:null===(t=l.loss)||void 0===t?void 0:t.toString().replace(/,/g,""))||0)},0),S=Number(((parseFloat(Z.values.footerOutputWgt)||0)-(parseFloat(null==Z?void 0:null===(d=Z.values)||void 0===d?void 0:d.disassemblyWgt)||0)-(parseFloat(V)||0)).toFixed(2)),O=[{component:"textfield",label:b.jobRef,name:"jobRef",width:150,props:{readOnly:!0}},{component:"textfield",label:b.item,name:"sku",width:130,props:{readOnly:!0}},{component:"textfield",label:b.itemName,name:"itemName",width:150,props:{readOnly:!0}},{component:"numberfield",label:b.outputWgt,name:"outputWgt",width:130,updateOn:"blur",async onChange(e){let{row:{update:l,newRow:t}}=e;l({metalWgt:(parseFloat((null==t?void 0:t.outputWgt)||0)-parseFloat((null==t?void 0:t.currentWgt)||0)).toFixed(3)})}},{component:"numberfield",label:b.currentWgt,name:"currentWgt",width:130,props:{readOnly:!0}},{component:"numberfield",label:b.metalWgt,name:"metalWgt",width:130,props:{readOnly:!0}},{component:"textfield",label:b.jobPct,name:"jobPct",width:130,props:{readOnly:!0}},{component:"numberfield",label:b.issuedWgt,name:"issuedWgt",width:130,props:{readOnly:!0}},{component:"numberfield",label:b.returnedWgt,name:"returnedWgt",width:130,props:{readOnly:!0}},{component:"numberfield",label:b.loss,name:"loss",width:130,props:{readOnly:!0}},{component:"numberfield",label:b.inputPcs,name:"inputPcs",width:130,props:{readOnly:!0}},{component:"numberfield",label:b.outputPcs,name:"outputPcs",width:130,props:{readOnly:!0}},{component:"numberfield",label:b.netWgt,name:"netWgt",width:130,props:{readOnly:!0}}];async function k(){var e,l;let t=await C({extension:w.B.CastingJob.qry,parameters:"_castingId=".concat(P)}),a=(null==t?void 0:null===(e=t.list)||void 0===e?void 0:e.length)?null==t?void 0:null===(l=t.list)||void 0===l?void 0:l.map((e,l)=>({...e,id:l+1,currentWgt:parseFloat((null==e?void 0:e.currentWgt)||0).toFixed(3),metalWgt:parseFloat((null==e?void 0:e.metalWgt)||0).toFixed(3),jobPct:parseFloat((null==e?void 0:e.jobPct)||0).toFixed(2).toString()+"%",issuedWgt:parseFloat((null==e?void 0:e.issuedWgt)||0).toFixed(2),returnedWgt:parseFloat((null==e?void 0:e.returnedWgt)||0).toFixed(2),loss:parseFloat((null==e?void 0:e.loss)||0).toFixed(2),inputPcs:parseFloat((null==e?void 0:e.inputPcs)||0).toFixed(2),outputPcs:parseFloat((null==e?void 0:e.outputPcs)||0).toFixed(2),netWgt:(parseFloat((null==e?void 0:e.currentWgt)||0)+(parseFloat((null==e?void 0:e.issuedWgt)||0)-parseFloat((null==e?void 0:e.returnedWgt)||0)-parseFloat((null==e?void 0:e.loss)||0))).toFixed(2)})):Z.initialValues.items;Z.setFieldValue("items",a)}return(0,n.useEffect)(()=>{P&&k()},[P]),(0,n.useEffect)(()=>{var e,l,t;Z.setFieldValue("disassemblyWgt",null==W?void 0:null===(e=W.castingInfo)||void 0===e?void 0:e.scrapWgt),Z.setFieldValue("footerOutputWgt",null==W?void 0:null===(l=W.castingInfo)||void 0===l?void 0:l.outputWgt),Z.setFieldValue("footerInputWgt",null==W?void 0:null===(t=W.castingInfo)||void 0===t?void 0:t.inputWgt),Z.setFieldValue("balanceWgt",S),function(){var e;let l=0,t=null==Z?void 0:null===(e=Z.values)||void 0===e?void 0:e.items;if(!(null==t?void 0:t.some(e=>e.jobRef)))return;for(let e of t)l+=parseFloat((null==e?void 0:e.metalWgt)||0);let a=e=>l&&parseFloat((100*e/l).toFixed(2))||0,n=function(e,l){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3;return parseFloat((e*l/100).toFixed(t))||0},s=t.map(e=>{var l,t,s;let o=a((null==e?void 0:e.metalWgt)||0),i=n(o,(null==W?void 0:null===(l=W.castingInfo)||void 0===l?void 0:l.inputWgt)||0,2),r=n(o,(null==W?void 0:null===(t=W.castingInfo)||void 0===t?void 0:t.scrapWgt)||0),d=n(o,(null==W?void 0:null===(s=W.castingInfo)||void 0===s?void 0:s.loss)||0,2),u=parseFloat(parseFloat((null==e?void 0:e.currentWgt)||0)+i-r-d);return{...e,jobPct:(null==o?void 0:o.toFixed(2).toString())+"%",issuedWgt:null==i?void 0:i.toFixed(2),returnedWgt:null==r?void 0:r.toFixed(2),loss:null==d?void 0:d.toFixed(2),netWgt:null==u?void 0:u.toFixed(2)}});Z.setFieldValue("items",s)}()},[null==W?void 0:W.castingInfo,S,V]),(0,a.jsx)(L.Z,{onSave:Z.handleSubmit,maxAccess:h,editMode:!0,disabledSubmit:(null==W?void 0:W.isCancelled)||(null==W?void 0:W.isPosted),isParentWindow:!1,children:(0,a.jsxs)(c.R,{children:[(0,a.jsx)(v.Q,{children:(0,a.jsx)(q._,{onChange:e=>Z.setFieldValue("items",e),value:Z.values.items,error:Z.errors.items,columns:O,initialValues:null==Z?void 0:null===(p=Z.initialValues)||void 0===p?void 0:null===(u=p.items)||void 0===u?void 0:u[0],name:"items",maxAccess:h,allowDelete:!1,allowAddNewLine:!1,disabled:(null==W?void 0:W.isCancelled)||(null==W?void 0:W.isPosted)})}),(0,a.jsx)(m.g,{children:(0,a.jsxs)(I.ZP,{container:!0,spacing:2,pt:2,children:[(0,a.jsx)(I.ZP,{item:!0,xs:4,children:(0,a.jsxs)(I.ZP,{container:!0,spacing:2,children:[(0,a.jsx)(I.ZP,{item:!0,xs:12,children:(0,a.jsx)(y.Z,{name:"outputWgt",label:b.outputWgt,value:Z.values.footerOutputWgt,readOnly:!0})}),(0,a.jsx)(I.ZP,{item:!0,xs:12,children:(0,a.jsx)(y.Z,{name:"assignedWgt",label:b.assignedWgt,value:V,readOnly:!0})}),(0,a.jsx)(I.ZP,{item:!0,xs:12,children:(0,a.jsx)(y.Z,{name:"disassemblyWgt",label:b.disassemblyWgt,value:null==Z?void 0:null===(f=Z.values)||void 0===f?void 0:f.disassemblyWgt,readOnly:!0})}),(0,a.jsx)(I.ZP,{item:!0,xs:12,children:(0,a.jsx)(y.Z,{name:"balanceWgt",label:b.balanceWgt,value:Z.values.balanceWgt,readOnly:!0,error:Z.touched.balanceWgt&&!!Z.errors.balanceWgt})})]})}),(0,a.jsx)(I.ZP,{item:!0,xs:4,children:(0,a.jsxs)(I.ZP,{container:!0,spacing:2,children:[(0,a.jsx)(I.ZP,{item:!0,xs:12,children:(0,a.jsx)(y.Z,{name:"totalInputWgt",label:b.totalInputWgt,value:null==Z?void 0:null===(x=Z.values)||void 0===x?void 0:x.footerInputWgt,readOnly:!0})}),(0,a.jsx)(I.ZP,{item:!0,xs:12,children:(0,a.jsx)(y.Z,{name:"totalLoss",label:b.totalLoss,value:R,readOnly:!0})})]})})]})})]})})}var T=e=>{let{recordId:l,access:t,labels:s}=e,[o,i]=(0,n.useState)(0),[r,d]=(0,n.useState)({recordId:l,isPosted:!1,isCancelled:!1,metalInfo:{},castingInfo:{scrapWgt:0,outputWgt:0,loss:0}}),u=[{label:s.castings},{label:s.disassembly,disabled:!r.recordId},{label:s.jobs,disabled:!r.recordId}];return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(h.Y,{tabs:u,activeTab:o,setActiveTab:i,maxAccess:t}),(0,a.jsx)(b.Z,{index:0,value:o,maxAccess:t,children:(0,a.jsx)(k,{store:r,setStore:d,labels:s,access:t})}),(0,a.jsx)(b.Z,{index:1,value:o,maxAccess:t,children:(0,a.jsx)(D,{store:r,setStore:d,labels:s,maxAccess:t})}),(0,a.jsx)(b.Z,{index:2,value:o,maxAccess:t,children:(0,a.jsx)(A,{store:r,labels:s,maxAccess:t})})]})},E=()=>{let{postRequest:e,getRequest:l}=(0,n.useContext)(o.$),{platformLabels:t}=(0,n.useContext)(g.l),{stack:b}=(0,d.zY)(),{query:{data:h},filterBy:I,refetch:W,labels:y,access:F,paginationParameters:C,invalidate:j}=(0,s.J)({queryFn:Z,endpointId:w.B.Casting.page,datasetId:u.i.FoCastings,filter:{filterFn:V}}),P=[{field:"reference",headerName:y.reference,flex:1},{field:"date",headerName:y.date,flex:1,type:"date"},{field:"waxRef",headerName:y.waxRef,flex:1},{field:"mouldRef",headerName:y.mould,flex:1},{field:"metalRef",headerName:y.metal,flex:1},{field:"metalColorRef",headerName:y.metalColor,flex:1},{field:"grossWgt",headerName:y.grossWgt,flex:1,type:"number"},{field:"rmWgt",headerName:y.rmWgt,flex:1,type:"number"},{field:"mouldWgt",headerName:y.mouldWgt,flex:1,type:"number"},{field:"netWgt",headerName:y.netWgt,flex:1,type:"number"},{field:"suggestedWgt",headerName:y.suggestedWgt,flex:1,type:"number"},{field:"inputWgt",headerName:y.inputWgt,flex:1,type:"number"},{field:"netInputWgt",headerName:y.netInputWgt,flex:1,type:"number"},{field:"outputWgt",headerName:y.outputWgt,flex:1,type:"number"},{field:"loss",headerName:y.loss,flex:1,type:"number"},{field:"statusName",headerName:y.status,flex:1}];async function Z(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{_startAt:t=0,_pageSize:a=50,params:n=[]}=e;return{...await l({extension:w.B.Casting.page,parameters:"_startAt=".concat(t,"&_pageSize=").concat(a,"&_params=").concat(n,"&filter=")}),_startAt:t}}async function V(e){let{filters:t,pagination:a}=e;return t.qry?await l({extension:w.B.Casting.snapshot,parameters:"_filter=".concat(t.qry)}):Z({_startAt:a._startAt||0,params:null==t?void 0:t.params})}let{proxyAction:_}=(0,p.G)({functionId:f.J.Casting,action:N});async function N(e){b({Component:T,props:{labels:y,access:F,recordId:e},width:1150,height:750,title:y.castings})}let R=async l=>{await e({extension:w.B.Casting.del,record:JSON.stringify(l)}),j(),r.ZP.success(t.Deleted)};return(0,a.jsxs)(c.R,{children:[(0,a.jsx)(m.g,{children:(0,a.jsx)(x.Z,{onAdd:()=>{_()},maxAccess:F,filterBy:I,reportName:"FOCAS"})}),(0,a.jsx)(v.Q,{children:(0,a.jsx)(i.Z,{name:"casting",columns:P,gridData:h,rowId:["recordId"],onEdit:e=>{N(null==e?void 0:e.recordId)},refetch:W,onDelete:R,deleteConfirmationType:"strict",isLoading:!1,pageSize:50,maxAccess:F,paginationParameters:C,paginationType:"api"})})]})}},1685:function(e,l,t){"use strict";t.d(l,{m:function(){return a}});let a=e=>{let l=window.sessionStorage.getItem(e);return l?JSON.parse(l):null}},98345:function(e,l,t){"use strict";t.d(l,{H:function(){return p},G:function(){return g}});var a=t(45300),n=t(2784),s=t(96026),o=t(38449);t(26612);var i=t(65947),r=t(1685);let d=async(e,l,t)=>{try{let a=await e({extension:l,parameters:t});return l.includes("qry")?a:a.record}catch(e){return null}},u=(e,l,t,a)=>{let n=(e=JSON.parse(JSON.stringify(e))).record.controls,s=n.find(e=>"reference"===e.controlId);return s?s.accessLevel=(null==l?void 0:l.mandatory)?i.$7:i.rr:(null==l?void 0:l.mandatory)?n.push({sgId:0,resourceId:"",controlId:"".concat(a?a+".":"","reference"),accessLevel:(null==l?void 0:l.mandatory)?i.$7:i.rr}):(null==l?void 0:l.readOnly)?n.push({sgId:0,resourceId:"",controlId:"".concat(a?a+".":"","reference"),accessLevel:(null==l?void 0:l.readOnly)?i.rr:i.$7}):n=e.record.controls.filter(e=>"reference"!=e.controlId),t&&n.push({sgId:0,resourceId:"",controlId:"".concat(a?a+".":"","dtId"),accessLevel:i.$7}),{...e,record:{...e.record,controls:n}}},c=async(e,l,t)=>{let a,n;switch(t){case"dtId":let s=(0,r.m)("userData"),i=null==s?void 0:s.userId;n="_userId=".concat(i,"&_functionId=").concat(l),a=o.r.UserFunction.get;break;case"glbSysNumberRange":n="_recordId=".concat(l),a=o.r.SystemFunction.get;break;case"DocumentType":n="_dgId=".concat(l,"&_startAt=",0,"&_pageSize=",50),a=o.r.DocumentType.qry;break;case"DcTypNumberRange":n="_recordId=".concat(l),a=o.r.DocumentType.get;break;case"isExternal":n="_recordId=".concat(l),a=o.r.NumberRange.get;break;default:return null}return await d(e,a,n)},m=async function(e){let l,t,a,n,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,o=arguments.length>2?arguments[2]:void 0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,r=!(arguments.length>4)||void 0===arguments[4]||arguments[4],d=arguments.length>5?arguments[5]:void 0,m=void 0===i&&s&&await c(e,s,"dtId"),v=null==m?void 0:m.dtId,g="",p=!0;if(m&&void 0===i||"nraId"===i){if(v){let t=await c(e,v,"DcTypNumberRange");l=null==t?void 0:t.nraId,p=!((null==t?void 0:t.activeStatus)<0),l||(g="Assign the document type to a number range")}if((!v||!p)&&r&&s){var f;let l=await c(e,s,"DocumentType");n=(null==l?void 0:null===(f=l.list)||void 0===f?void 0:f.filter(e=>(null==e?void 0:e.activeStatus)===1).length)>0}}if(("nraId"===i||void 0===i)&&s){if((!v||v)&&!l||l&&!p){let t=await c(e,s,"glbSysNumberRange");(l=null==t?void 0:t.nraId)&&n&&(n=!1),p=!0}g=l||n?"":"Assign the system Function to a number range"}i>0&&!l&&(l=i),l&&p?(t={readOnly:null==(a=await c(e,l,"isExternal"))||!a.external,mandatory:null!=a&&!!a.external},o&&(o=await u(o,t,n,d))):!l&&o&&(o=await u(o,t,n,d));let x=d?"".concat(d,".reference"):"reference";return{dtId:v,resetReference:null==t?void 0:t.readOnly,dcTypeRequired:n,reference:{fieldName:x,isEmpty:(null==a?void 0:a.external)!==void 0&&(null==a||!a.external)},errorMessage:g,maxAccess:o,selectNraId:i}};var v=t(65950);function g(e){let{functionId:l,action:t,hasDT:a}=e,{getRequest:o}=(0,n.useContext)(v.$),{stack:i}=(0,s.V)();return{proxyAction:async()=>{let e=await m(o,l,"",void 0,a);(null==e?void 0:e.errorMessage)?i({message:null==e?void 0:e.errorMessage}):await t()}}}function p(e){var l;let{functionId:t,access:o,hasDT:i,enabled:r=!0,objectName:d=""}=e,{getRequest:u}=(0,n.useContext)(v.$),{stack:c}=(0,s.V)(),[g,p]=(0,n.useState)(),f=async e=>{let l=await m(u,t,o,e,i,d);if(!l.errorMessage)return l;c({message:null==l?void 0:l.errorMessage})},x=(0,a.a)({retry:!1,staleTime:0,enabled:r,queryKey:[t,g,!!o,r],queryFn:g||"nraId"===g?()=>f(g):()=>f()});return{documentType:x.data,maxAccess:(null==x?void 0:null===(l=x.data)||void 0===l?void 0:l.maxAccess)||o,changeDT(e){p((null==e?void 0:e.nraId)||"nraId")}}}},29326:function(e,l,t){"use strict";var a=t(52322);t(2784);var n=t(23925),s=t(13980),o=t.n(s),i=t(95291),r=t.n(i),d=t(65947);let u=e=>{var l,t,s;let{children:o,value:i,index:u,maxAccess:c,...m}=e,v="".concat(e.name||"tab",".").concat(u),{accessLevel:g}=null!==(s=(null!==(t=null==c?void 0:null===(l=c.record)||void 0===l?void 0:l.controls)&&void 0!==t?t:[]).find(e=>e.controlId===v))&&void 0!==s?s:{accessLevel:0};if(g===d.A1)return null;let p=i===u;return(0,a.jsx)(n.Z,{role:"tabpanel",hidden:!p,id:"simple-tabpanel-".concat(u),"aria-labelledby":"simple-tab-".concat(u),className:"".concat(r().tabPanel," ").concat(p?r().active:r().hidden),...m,children:o})};u.propTypes={children:o().node,index:o().number.isRequired,value:o().number.isRequired},l.Z=u},9522:function(e,l,t){"use strict";t.d(l,{Y:function(){return m}});var a=t(52322),n=t(23925),s=t(54582),o=t(68696),i=t(44258),r=t(2784),d=t(99266),u=t(52614),c=t.n(u);let m=e=>{var l,t,u,m,v;let{tabs:g,activeTab:p,setActiveTab:f,maxAccess:x,name:b="tab"}=e,h=(null==x?void 0:null===(t=x.record)||void 0===t?void 0:null===(l=t.controls)||void 0===l?void 0:l.filter(e=>{var l;return 4===e.accessLevel&&(null===(l=e.controlId)||void 0===l?void 0:l.startsWith("".concat(b,".")))}).map(e=>e.controlId.split(".")[1]))||[],I=null==g?void 0:null===(u=g.map((e,l)=>({...e,id:l})))||void 0===u?void 0:u.filter((e,l)=>!h.includes(String(l))),W=null===(m=I[p])||void 0===m?void 0:m.id,y=null===(v=I[p])||void 0===v?void 0:v.disabled;return(0,r.useEffect)(()=>{W>=0&&!y&&p!=W&&f(W)},[]),(0,a.jsx)(n.Z,{className:c().tabsContainer,children:(0,a.jsx)(n.Z,{className:c().tabsWrapper,children:(0,a.jsx)(s.Z,{value:p,onChange:(e,l)=>f(l),variant:"scrollable",scrollButtons:I.length>3?"auto":"off","aria-label":"scrollable tabs",classes:{indicator:c().tabsIndicator},className:c().tabs,children:null==I?void 0:I.map(e=>(0,a.jsx)(o.Z,{value:e.id,disabled:null==e?void 0:e.disabled,className:"".concat(c().tabName," ").concat(e.disabled?c().tabDisabled:""),classes:{root:c().tabRoot,selected:c().selectedTab},label:(0,a.jsxs)(n.Z,{display:"flex",alignItems:"center",children:[(0,a.jsx)("span",{children:e.label}),e.id===p&&(null==e?void 0:e.onRefetch)&&(0,a.jsx)(i.Z,{size:"small",className:c().refreshButton,onClick:l=>{l.stopPropagation(),e.onRefetch()},children:(0,a.jsx)(d.Z,{className:c().refreshIcon})})]})},e.id))})})})}},39704:function(e,l,t){"use strict";var a=t(52322),n=t(2784),s=t(22341),o=t(65950),i=t(85325),r=t(21326),d=t(19473),u=t(35656),c=t(24868),m=t.n(c);let v=e=>{let{functionId:l,recordId:t,window:c}=e,{getRequest:v}=(0,n.useContext)(o.$),{languageId:g}=(0,n.useContext)(i.V),{platformLabels:p}=(0,n.useContext)(d.l),f=t+"-"+l;(0,r.Z)({title:p.WorkFlow,window:c});let{width:x}=(0,u.d)(),b=x<=1024,h=x>1024&&x<=1280,I=b?10:h?12:14,W=b?75:h?85:95,y=b?15:h?20:25,F=async()=>{var e="_functionId=".concat(l,"&_recordId=").concat(t);let a=await v({extension:s.P.WorkFlow.graph,parameters:e});return null==a?void 0:a.record},C=e=>{let l=[],t=[],a="",n="";return e.objects.forEach(e=>{l.push({functionName:e.functionName,reference:e.reference,date:e.date})}),e.workflow.forEach(l=>{e.objects.forEach(e=>{let t=e.functionName.split(" ").join("\r\n");l.parentId===e.recordId&&l.parentFunctionId===e.functionId&&(a=e.reference+"\r\n"+e.date+"\r\n"+t,l.parentId),l.childId===e.recordId&&l.childFunctionId===e.functionId&&(n=e.reference+"\r\n"+e.date+"\r\n"+t,l.childId)}),""===a||""===n||t.push({from:a,to:n,value:1,labelText:""}),a="",n=""}),t};return(0,n.useEffect)(()=>{!async function(){var e=await F();if(e){let l=(e,l)=>{let t=document.createElement("script");t.type="text/javascript",t.src=e,t.async=!0,t.onload=l,document.head.appendChild(t)};l("https://cdn.amcharts.com/lib/4/core.js",()=>{l("https://cdn.amcharts.com/lib/4/charts.js",()=>{l("https://cdn.amcharts.com/lib/4/themes/animated.js",()=>{am4core.ready(()=>{let l=am4core.create(f,am4charts.SankeyDiagram),t=C(e);l.data=t,l.dataFields.fromName="from",l.dataFields.toName="to",l.dataFields.value="value",l.paddingRight=2===g?0:40,l.paddingLeft=2===g?40:0,l.tooltip.label.fontSize=I;let a=l.nodes.template;a.draggable=!1,a.inert=!0,a.clickable=!1,a.width=W,a.height=y,a.nameLabel.label.fontSize=I,a.nameLabel.locationX=2===g?.85:0,a.nameLabel.height=void 0,a.nameLabel.label.fontWeight="bold";let n=l.links.template;n.middleLine.strokeOpacity=.3,n.middleLine.stroke=am4core.color("#555"),n.middleLine.strokeWidth=5,n.middleLine.hoverable=!1,n.fillOpacity=0,n.hoverable=!0,n.hoverOnFocus=!0,n.fill=am4core.color("#A8C686"),n.isHover=!0,l.appear(1e3,100)})})})})}}()},[]),(0,a.jsx)("div",{id:f,className:m().root})};v.width=950,l.Z=v},95291:function(e){e.exports={tabPanel:"CustomTabPanel_tabPanel__80Dfu",active:"CustomTabPanel_active___6Uvb",hidden:"CustomTabPanel_hidden__y9566"}},52614:function(e){e.exports={customTabPanel:"CustomTabs_customTabPanel__Ztocv",hidden:"CustomTabs_hidden__lZpM7",tabsContainer:"CustomTabs_tabsContainer__28Syi",tabsWrapper:"CustomTabs_tabsWrapper__mlxxj",tabs:"CustomTabs_tabs__25pli",tabName:"CustomTabs_tabName__XzMCn",tabRoot:"CustomTabs_tabRoot__WVR1E",tabDisabled:"CustomTabs_tabDisabled__VauYR",selectedTab:"CustomTabs_selectedTab__sZzwF",tabsIndicator:"CustomTabs_tabsIndicator__89Lek",refreshButton:"CustomTabs_refreshButton__P2mzl",refreshIcon:"CustomTabs_refreshIcon__ADVWF"}},24868:function(e){e.exports={root:"WorkFlow_root__EINm1"}}},function(e){e.O(0,[92515,2494,36908,49774,92888,40179],function(){return e(e.s=37670)}),_N_E=e.O()}]);