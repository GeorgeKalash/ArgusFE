(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2272],{56595:function(e,a,l){(window.__NEXT_P=window.__NEXT_P||[]).push(["/sales-person",function(){return l(135)}])},135:function(e,a,l){"use strict";l.r(a),l.d(a,{default:function(){return k}});var s=l(52322),n=l(2784),t=l(62202),r=l(61802),o=l(69387),i=l(65950),c=l(71987),d=l(26612),u=l(31389),m=l(33625),x=l(62362),h=l(19473),v=l(22341),p=l(29326),b=l(60218),f=l(82737),g=l(5088),_=l(8661),P=l(38449),I=l(84100),y=l(80983),j=l(91406),A=l(48601),C=l(19689);function Z(e){var a;let{labels:l,maxAccess:r,store:o,setStore:m}=e,{getRequest:p,postRequest:Z}=(0,n.useContext)(i.$),{platformLabels:w}=(0,n.useContext)(h.l),{recordId:S}=o,T=(0,c.E)({endpointId:v.P.SalesPerson.page}),{formik:F}=(0,y.c)({initialValues:{recordId:null,spRef:"",name:"",cellPhone:"",commissionPct:null,plantId:null,sptId:null,targetType:null,isInactive:!1},maxAccess:r,validationSchema:A.Ry({spRef:A.Z_().required(),name:A.Z_().required(),commissionPct:A.Rx().nullable().min(.01," must be greater than 0").max(100," must be less than or equal to 100")}),onSubmit:async e=>{let a=await Z({extension:v.P.SalesPerson.set,record:JSON.stringify(e)});e.recordId||(m({recordId:a.recordId}),F.setFieldValue("recordId",a.recordId)),t.ZP.success(e.recordId?w.Edited:w.Added),T()}}),N=!!F.values.recordId;return(0,n.useEffect)(()=>{!async function(){if(S){let e=await p({extension:v.P.SalesPerson.get,parameters:"_recordId=".concat(S)});F.setValues(e.record)}}()},[]),(0,s.jsx)(f.Z,{resourceId:d.i.SalesPerson,form:F,maxAccess:r,actions:[{key:"RecordRemarks",condition:!0,onClick:"onRecordRemarks",disabled:!N}],editMode:N,children:(0,s.jsx)(u.R,{children:(0,s.jsx)(x.Q,{children:(0,s.jsxs)(b.ZP,{container:!0,spacing:2,children:[(0,s.jsx)(b.ZP,{item:!0,xs:12,children:(0,s.jsx)(g.Z,{name:"spRef",label:l.reference,value:F.values.spRef,required:!0,maxLength:"10",maxAccess:r,onChange:F.handleChange,onClear:()=>F.setFieldValue("spRef",""),error:F.touched.spRef&&!!F.errors.spRef})}),(0,s.jsx)(b.ZP,{item:!0,xs:12,children:(0,s.jsx)(g.Z,{name:"name",label:l.name,value:F.values.name,required:!0,maxAccess:r,onChange:F.handleChange,onClear:()=>F.setFieldValue("name",""),error:F.touched.name&&!!F.errors.name})}),(0,s.jsx)(b.ZP,{item:!0,xs:12,children:(0,s.jsx)(g.Z,{name:"cellPhone",label:l.phone,value:F.values.cellPhone,maxLength:"15",phone:!0,onChange:F.handleChange,onClear:()=>F.setFieldValue("cellPhone",null),error:F.touched.cellPhone&&!!F.errors.cellPhone,maxAccess:r})}),(0,s.jsx)(b.ZP,{item:!0,xs:12,children:(0,s.jsx)(j.Z,{name:"commissionPct",label:l.commissionPct,value:F.values.commissionPct,maxAccess:r,onChange:F.handleChange,onClear:()=>F.setFieldValue("commissionPct",null),error:F.touched.commissionPct&&!!F.errors.commissionPct,allowNegative:!1,maxLength:5,decimalScale:2})}),(0,s.jsx)(b.ZP,{item:!0,xs:12,children:(0,s.jsx)(_.Z,{endpointId:P.r.Plant.qry,name:"plantId",label:l.plant,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:F.values,valueField:"recordId",displayField:["reference","name"],maxAccess:r,onChange:(e,a)=>{F.setFieldValue("plantId",(null==a?void 0:a.recordId)||null)},error:F.touched.plantId&&!!F.errors.plantId})}),(0,s.jsx)(b.ZP,{item:!0,xs:12,children:(0,s.jsx)(_.Z,{endpointId:v.P.SalesTeam.qry,name:"sptId",label:l.team,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:F.values,valueField:"recordId",displayField:["reference","name"],maxAccess:r,onChange:(e,a)=>{F.setFieldValue("sptId",(null==a?void 0:a.recordId)||null)},error:F.touched.sptId&&!!F.errors.sptId})}),(0,s.jsx)(b.ZP,{item:!0,xs:12,children:(0,s.jsx)(_.Z,{endpointId:v.P.CommissionSchedule.qry,name:"commissionScheduleId",label:l.commissionSchedule,values:F.values,valueField:"recordId",displayField:"name",maxAccess:r,onChange:(e,a)=>{F.setFieldValue("commissionScheduleId",(null==a?void 0:a.recordId)||null)},error:F.touched.commissionScheduleId&&!!F.errors.commissionScheduleId})}),(0,s.jsx)(b.ZP,{item:!0,xs:12,children:(0,s.jsx)(_.Z,{datasetId:I.v.TARGET_TYPE,name:"targetType",label:l.targetType,valueField:"key",displayField:"value",values:F.values,maxAccess:r,onChange:(e,a)=>{F.setFieldValue("targetType",(null==a?void 0:a.key)||null)},error:F.touched.targetType&&!!F.errors.targetType})}),(0,s.jsx)(b.ZP,{item:!0,xs:12,children:(0,s.jsx)(C.Z,{name:"isInactive",value:null===(a=F.values)||void 0===a?void 0:a.isInactive,onChange:e=>F.setFieldValue("isInactive",e.target.checked),label:l.isInactive,maxAccess:r})})]})})})})}var w=l(9522),S=l(76399),T=l(54074),F=e=>{var a,l;let{labels:r,maxAccess:o,store:c}=e,{getRequest:d,postRequest:m}=(0,n.useContext)(i.$),{platformLabels:p}=(0,n.useContext)(h.l),{recordId:b}=c,f=async()=>{let e=await d({extension:P.r.FiscalYears.qry,parameters:"_filter="}),a=await d({extension:v.P.Target.qry,parameters:"_spId=".concat(b)});if(e.list.length>0){let l=e.list.map((e,l)=>{let s=a.list.find(a=>a.fiscalYear===e.fiscalYear);return{id:l+1,spId:b,fiscalYear:String(null==e?void 0:e.fiscalYear),targetAmount:(null==s?void 0:s.targetAmount)||0}});g.setValues({rows:l})}},{formik:g}=(0,y.c)({maxAccess:o,initialValues:{rows:[]},onSubmit:async e=>{let a={spId:b,items:e.rows};await m({extension:v.P.Target.set2,record:JSON.stringify(a)}),t.ZP.success(p.Updated)}});(0,n.useEffect)(()=>{b&&f()},[b]);let _=[{component:"textfield",label:r.year,name:"fiscalYear",props:{readOnly:!0}},{component:"numberfield",label:r.targetAmount,name:"targetAmount",props:{maxLength:12,decimalScale:0,allowNegative:!1},updateOn:"blur",onChange:e=>{let{row:{update:a,newRow:l}}=e;a("targetAmount",(null==l?void 0:l.targetAmount)||0)},onClear:e=>{let{row:{update:a}}=e;a("targetAmount",0)}}];return(0,s.jsx)(T.Z,{onSave:g.handleSubmit,maxAccess:o,isParentWindow:!1,children:(0,s.jsx)(u.R,{children:(0,s.jsx)(x.Q,{children:(0,s.jsx)(S._,{onChange:e=>{g.setFieldValue("rows",e)},value:null===(a=g.values)||void 0===a?void 0:a.rows,error:null===(l=g.errors)||void 0===l?void 0:l.rows,columns:_,allowDelete:!1,allowAddNewLine:!1})})})})},N=l(85325),R=e=>{var a,l,r,o;let{store:c,labels:d,maxAccess:p}=e,{getRequest:f,postRequest:g}=(0,n.useContext)(i.$),{recordId:C}=c,{platformLabels:Z}=(0,n.useContext)(h.l),{user:w}=(0,n.useContext)(N.V),{formik:F}=(0,y.c)({maxAccess:p,initialValues:{recordId:C,fiscalYear:null,targetAmount:0,balance:"",rows:[{id:1,spId:C,monthId:null,month:"",targetAmount:0,fiscalYear:null}]},validationSchema:A.Ry({fiscalYear:A.Z_().required()}),onSubmit:async e=>{let a=e.rows.map((a,l)=>({...a,id:l+1,month:parseInt(a.monthId),fiscalYear:e.fiscalYear,targetAmount:(null==a?void 0:a.targetAmount)||0})).map(e=>{let{monthId:a,...l}=e;return l}),l={spId:C,fiscalYear:e.fiscalYear,items:a};await g({extension:v.P.TargetMonth.set2,record:JSON.stringify(l)}),t.ZP.success(Z.Updated)}}),R=[{component:"textfield",label:d.month,name:"month",props:{readOnly:!0}},{component:"numberfield",label:null==d?void 0:d.targetAmount,name:"targetAmount",props:{maxLength:12,decimalScale:0,allowNegative:!1}}],Y=F.values.rows.reduce((e,a)=>{var l;return e+(parseFloat(null===(l=a.targetAmount)||void 0===l?void 0:l.toString().replace(/,/g,""))||0)},0),V=parseFloat(null===(a=F.values.targetAmount)||void 0===a?void 0:a.toString().replace(/,/g,""))||0,k=async e=>{if(e){var a;let l=await f({extension:v.P.Target.get,parameters:"_fiscalYear=".concat(e,"&_spId=").concat(C)});F.setFieldValue("targetAmount",(null===(a=l.record)||void 0===a?void 0:a.targetAmount)||0);let s=(await f({extension:P.r.KeyValueStore,parameters:"_dataset=".concat(I.v.MONTHS,"&_language=").concat(null==w?void 0:w.languageId)})).list.sort((e,a)=>parseInt(e.key,10)-parseInt(a.key,10));if(s.length>0){let a=await f({extension:v.P.TargetMonth.qry,parameters:"_spId=".concat(C,"&_fiscalYear=").concat(e)}),l=s.map((e,l)=>{let s=a.list.find(a=>a.month===parseInt(e.key));return{id:l+1,spId:C,monthId:e.key,month:String(null==e?void 0:e.value),targetAmount:(null==s?void 0:s.targetAmount)||0}});F.setFieldValue("rows",l)}}else F.setValues({...F.values,targetAmount:0,rows:[]})};return(0,s.jsx)(T.Z,{onSave:F.handleSubmit,maxAccess:p,isParentWindow:!1,children:(0,s.jsxs)(u.R,{children:[(0,s.jsx)(m.g,{children:(0,s.jsxs)(b.ZP,{container:!0,spacing:2,sx:{p:2},children:[(0,s.jsx)(b.ZP,{item:!0,xs:6,children:(0,s.jsx)(_.Z,{endpointId:P.r.FiscalYears.qry,name:"fiscalYear",label:d.year,valueField:"fiscalYear",displayField:"fiscalYear",values:F.values,required:!0,maxAccess:p,onChange:(e,a)=>{F.setFieldValue("fiscalYear",(null==a?void 0:a.fiscalYear)||null),k(null==a?void 0:a.fiscalYear)},onClear:()=>{F.setFieldValue("fiscalYear",null),k(null)},error:F.touched.fiscalYear&&!!F.errors.fiscalYear})}),(0,s.jsx)(b.ZP,{item:!0,xs:6,children:(0,s.jsx)(j.Z,{name:"targetAmount",label:d.targetAmount,value:F.values.targetAmount,maxAccess:p,readOnly:!0})})]})}),(0,s.jsx)(x.Q,{children:(0,s.jsx)(S._,{onChange:e=>F.setFieldValue("rows",e),value:null===(l=F.values)||void 0===l?void 0:l.rows,error:null===(r=F.errors)||void 0===r?void 0:r.rows,name:"rows",initialValues:null==F?void 0:null===(o=F.initialValues)||void 0===o?void 0:o.rows,columns:R,maxAccess:p,allowDelete:!1,allowAddNewLine:!1})}),(0,s.jsx)(m.g,{children:(0,s.jsx)(b.ZP,{container:!0,spacing:2,sx:{p:2},justifyContent:"flex-end",children:(0,s.jsx)(b.ZP,{item:!0,xs:3,children:(0,s.jsx)(j.Z,{name:"balance",label:d.balance,value:Y-V||0,maxAccess:p,readOnly:!0})})})})]})})},Y=e=>{let{labels:a,maxAccess:l,recordId:t}=e,[r,o]=(0,n.useState)({recordId:t}),[i,c]=(0,n.useState)(0),d=[{label:a.general},{label:a.target,disabled:!r.recordId},{label:a.monthlyTarget,disabled:!r.recordId}];return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(w.Y,{tabs:d,activeTab:i,setActiveTab:c,maxAccess:l}),(0,s.jsx)(p.Z,{index:0,value:i,maxAccess:l,children:(0,s.jsx)(Z,{labels:a,maxAccess:l,store:r,setStore:o})}),(0,s.jsx)(p.Z,{index:1,value:i,maxAccess:l,children:(0,s.jsx)(F,{labels:a,maxAccess:l,store:r})}),(0,s.jsx)(p.Z,{index:2,value:i,maxAccess:l,children:(0,s.jsx)(R,{labels:a,maxAccess:l,store:r})})]})},V=l(36908),k=()=>{let{getRequest:e,postRequest:a}=(0,n.useContext)(i.$),{stack:l}=(0,r.zY)(),{platformLabels:p}=(0,n.useContext)(h.l);async function b(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{_startAt:l=0,_pageSize:s=50,params:n=[]}=a;return{...await e({extension:v.P.SalesPerson.page,parameters:"_startAt=".concat(l,"&_pageSize=").concat(s,"&_params=").concat(n||"")}),_startAt:l}}async function f(a){let{filters:l,pagination:s}=a;return l.qry?await e({extension:v.P.SalesPerson.snapshot,parameters:"_filter=".concat(l.qry)}):b({_startAt:s._startAt||0,params:null==l?void 0:l.params})}let{query:{data:g},labels:_,refetch:P,filterBy:I,invalidate:y,paginationParameters:j,access:A}=(0,c.J)({queryFn:b,endpointId:v.P.SalesPerson.page,datasetId:d.i.SalesPerson,filter:{filterFn:f}}),C=[{field:"spRef",headerName:_.SalesPerson,flex:1},{field:"name",headerName:_.name,flex:1},{field:"cellPhone",headerName:_.phone,flex:1},{field:"commissionPct",headerName:_.commissionPct,flex:1}];function Z(e){l({Component:Y,props:{labels:_,recordId:e,maxAccess:A},width:600,height:550,title:_.SalesPerson})}let w=async e=>{await a({extension:v.P.SalesPerson.del,record:JSON.stringify(e)}),y(),t.ZP.success(p.Deleted)};return(0,s.jsxs)(u.R,{children:[(0,s.jsx)(m.g,{children:(0,s.jsx)(V.Z,{onAdd:()=>{Z()},maxAccess:A,reportName:"SASP",filterBy:I})}),(0,s.jsx)(x.Q,{children:(0,s.jsx)(o.Z,{name:"table",columns:C,gridData:g,rowId:["recordId"],onEdit:e=>{Z(e.recordId)},onDelete:w,pageSize:50,deleteConfirmationType:"strict",paginationType:"api",paginationParameters:j,refetch:P,maxAccess:A})})]})}},29326:function(e,a,l){"use strict";var s=l(52322);l(2784);var n=l(23925),t=l(13980),r=l.n(t),o=l(95291),i=l.n(o),c=l(65947);let d=e=>{var a,l,t;let{children:r,value:o,index:d,maxAccess:u,...m}=e,x="".concat(e.name||"tab",".").concat(d),{accessLevel:h}=null!==(t=(null!==(l=null==u?void 0:null===(a=u.record)||void 0===a?void 0:a.controls)&&void 0!==l?l:[]).find(e=>e.controlId===x))&&void 0!==t?t:{accessLevel:0};if(h===c.A1)return null;let v=o===d;return(0,s.jsx)(n.Z,{role:"tabpanel",hidden:!v,id:"simple-tabpanel-".concat(d),"aria-labelledby":"simple-tab-".concat(d),className:"".concat(i().tabPanel," ").concat(v?i().active:i().hidden),...m,children:r})};d.propTypes={children:r().node,index:r().number.isRequired,value:r().number.isRequired},a.Z=d},9522:function(e,a,l){"use strict";l.d(a,{Y:function(){return m}});var s=l(52322),n=l(23925),t=l(54582),r=l(68696),o=l(44258),i=l(2784),c=l(99266),d=l(52614),u=l.n(d);let m=e=>{var a,l,d,m,x;let{tabs:h,activeTab:v,setActiveTab:p,maxAccess:b,name:f="tab"}=e,g=(null==b?void 0:null===(l=b.record)||void 0===l?void 0:null===(a=l.controls)||void 0===a?void 0:a.filter(e=>{var a;return 4===e.accessLevel&&(null===(a=e.controlId)||void 0===a?void 0:a.startsWith("".concat(f,".")))}).map(e=>e.controlId.split(".")[1]))||[],_=null==h?void 0:null===(d=h.map((e,a)=>({...e,id:a})))||void 0===d?void 0:d.filter((e,a)=>!g.includes(String(a))),P=null===(m=_[v])||void 0===m?void 0:m.id,I=null===(x=_[v])||void 0===x?void 0:x.disabled;return(0,i.useEffect)(()=>{P>=0&&!I&&v!=P&&p(P)},[]),(0,s.jsx)(n.Z,{className:u().tabsContainer,children:(0,s.jsx)(n.Z,{className:u().tabsWrapper,children:(0,s.jsx)(t.Z,{value:v,onChange:(e,a)=>p(a),variant:"scrollable",scrollButtons:_.length>3?"auto":"off","aria-label":"scrollable tabs",classes:{indicator:u().tabsIndicator},className:u().tabs,children:null==_?void 0:_.map(e=>(0,s.jsx)(r.Z,{value:e.id,disabled:null==e?void 0:e.disabled,className:"".concat(u().tabName," ").concat(e.disabled?u().tabDisabled:""),classes:{root:u().tabRoot,selected:u().selectedTab},label:(0,s.jsxs)(n.Z,{display:"flex",alignItems:"center",children:[(0,s.jsx)("span",{children:e.label}),e.id===v&&(null==e?void 0:e.onRefetch)&&(0,s.jsx)(o.Z,{size:"small",className:u().refreshButton,onClick:a=>{a.stopPropagation(),e.onRefetch()},children:(0,s.jsx)(c.Z,{className:u().refreshIcon})})]})},e.id))})})})}},95291:function(e){e.exports={tabPanel:"CustomTabPanel_tabPanel__80Dfu",active:"CustomTabPanel_active___6Uvb",hidden:"CustomTabPanel_hidden__y9566"}},52614:function(e){e.exports={customTabPanel:"CustomTabs_customTabPanel__Ztocv",hidden:"CustomTabs_hidden__lZpM7",tabsContainer:"CustomTabs_tabsContainer__28Syi",tabsWrapper:"CustomTabs_tabsWrapper__mlxxj",tabs:"CustomTabs_tabs__25pli",tabName:"CustomTabs_tabName__XzMCn",tabRoot:"CustomTabs_tabRoot__WVR1E",tabDisabled:"CustomTabs_tabDisabled__VauYR",selectedTab:"CustomTabs_selectedTab__sZzwF",tabsIndicator:"CustomTabs_tabsIndicator__89Lek",refreshButton:"CustomTabs_refreshButton__P2mzl",refreshIcon:"CustomTabs_refreshIcon__ADVWF"}}},function(e){e.O(0,[92515,2494,36908,49774,92888,40179],function(){return e(e.s=56595)}),_N_E=e.O()}]);