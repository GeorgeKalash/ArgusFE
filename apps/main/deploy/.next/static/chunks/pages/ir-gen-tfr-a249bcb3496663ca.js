(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[60112],{96889:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/ir-gen-tfr",function(){return n(47751)}])},47751:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return k}});var l=n(52322),r=n(31389),a=n(62362),d=n(2784),i=n(65950),o=n(26612),s=n(33625),u=n(60218),c=n(19473),m=n(71987),p=n(8661),f=n(80983),v=n(48601),h=n(76399),g=n(62202),I=n(61802),y=n(38449),x=n(7121),q=n(89330),R=n(65215),S=n(5088),b=n(58912),C=n(39812),P=n(96026),w=n(30586),F=n(67920),O=n(54074);function k(){var e,t,n,k,D,N;let{stack:T}=(0,I.zY)(),{getRequest:_,postRequest:L}=(0,d.useContext)(i.$),{stack:E}=(0,P.V)(),{platformLabels:j,userDefaultsData:A}=(0,d.useContext)(c.l),{labels:M,access:Z}=(0,m.J)({datasetId:o.i.GenerateTransfers}),G=parseInt(null==A?void 0:null===(t=A.list)||void 0===t?void 0:null===(e=t.find(e=>"siteId"===e.key))||void 0===e?void 0:e.value),{schema:V}=(0,F.m)({transferNow:e=>(null==e?void 0:e.transferNow)>0,isChecked:e=>null==e?void 0:e.isChecked},!0,Z,"items"),{formik:H}=(0,f.c)({maxAccess:Z,conditionSchema:["items"],initialValues:{dtId:null,fromSiteId:null,toSiteId:null,date:new Date,reference:"",items:[]},validateOnChange:!0,validationSchema:v.Ry({fromSiteId:v.Z_().required(),toSiteId:v.Z_().required(),date:v.hT().required(),items:v.IX().of(V)}),onSubmit:async e=>{var t;if(!(!(H.values.items.filter(e=>e.isChecked).length<1)||(E({message:M.checkItemsBeforeAppend}),0)))return;let n=null===(t=e.items.filter(e=>e.isChecked))||void 0===t?void 0:t.map(e=>({requestId:e.requestId,requestSeqNo:e.seqNo,itemId:e.itemId,qty:e.transferNow,muId:(null==e?void 0:e.muId)||null})),l={dtId:(null==e?void 0:e.dtId)||null,fromSiteId:null==e?void 0:e.fromSiteId,toSiteId:(null==e?void 0:e.toSiteId)||0,date:(0,C.ku)(null==e?void 0:e.date),items:n},r=await L({extension:b.I.Transfer.generate2,record:JSON.stringify(l)});g.ZP.success(j.Generated),J(),T({Component:w.Z,props:{recordId:null==r?void 0:r.recordId}})}}),Q=[{component:"checkbox",name:"isChecked",label:" ",flex:.3,checkAll:{visible:!1,onChange(e){let{checked:t}=e,n=H.values.items.map(e=>{let{isChecked:n,...l}=e;return{...l,isChecked:t,transferNow:t?l.qty:0}});H.setFieldValue("items",n)}},async onChange(e){let{row:{update:t,newRow:n}}=e;t({transferNow:(null==n?void 0:n.isChecked)?null==n?void 0:n.qty:0})}},{component:"textfield",label:M.requestRef,name:"requestRef",flex:1,props:{readOnly:!0}},{component:"textfield",label:M.siteRef,name:"siteRef",flex:1,props:{readOnly:!0}},{component:"textfield",label:M.site,name:"siteName",flex:1,props:{readOnly:!0}},{component:"date",name:"requestDate",flex:1,label:null==M?void 0:M.date,props:{readOnly:!0}},{component:"textfield",label:M.sku,name:"sku",flex:1,props:{readOnly:!0}},{component:"textfield",label:M.itemName,name:"itemName",flex:1,props:{readOnly:!0}},{component:"numberfield",name:"onHandGlobal",label:M.onHandGlobal,flex:1,props:{readOnly:!0}},{component:"numberfield",name:"onHandSite",label:M.onHandSite,flex:1,props:{readOnly:!0}},{component:"numberfield",name:"qty",label:M.qty,flex:1,props:{readOnly:!0}},{component:"numberfield",name:"deliveredQty",label:M.delivered,flex:1,props:{readOnly:!0}},{component:"numberfield",name:"balance",label:M.balance,flex:1,props:{readOnly:!0}},{component:"numberfield",name:"transferNow",label:M.transferNow,flex:1,propsReducer(e){let{row:t,props:n}=e;return{...n,readOnly:!(null==t?void 0:t.isChecked)}},updateOn:"blur",async onChange(e){let{row:{update:t,newRow:n}}=e,l=null==n?void 0:n.transferNow;t({transferNow:l>=0&&l<(null==n?void 0:n.qty)?l:null==n?void 0:n.qty})}}];async function J(e){var t;if(!G)return;let n=await _({extension:b.I.OrderItem.open,parameters:"_reference=".concat(e||"","&_siteId=").concat(H.values.toSiteId||0,"&_fromSiteId=").concat(H.values.fromSiteId||0,"&_workCenterId=",0)});n.list=null==n?void 0:null===(t=n.list)||void 0===t?void 0:t.map((e,t)=>({...e,id:t+1,requestDate:e.requestDate?(0,C.a1)(e.requestDate):null,balance:e.qty||0-e.deliveredQty||0,onHandGlobal:parseFloat(null==e?void 0:e.onhandGlobal).toFixed(2)||0,onHandSite:parseFloat(null==e?void 0:e.onhandSite).toFixed(2)||0,qty:parseFloat(null==e?void 0:e.qty).toFixed(2),transferNow:0})),H.setFieldValue("items",n.list)}return(0,d.useEffect)(()=>{G&&H.setFieldValue("fromSiteId",G)},[G]),(0,d.useEffect)(()=>{J()},[H.values.toSiteId,H.values.fromSiteId]),(0,l.jsx)(O.Z,{onSave:H.handleSubmit,isSaved:!1,actions:[{key:"GenerateJob",condition:!0,onClick:()=>{H.handleSubmit()}}],maxAccess:Z,children:(0,l.jsxs)(r.R,{children:[(0,l.jsx)(s.g,{children:(0,l.jsxs)(u.ZP,{container:!0,spacing:2,children:[(0,l.jsx)(u.ZP,{item:!0,xs:2,children:(0,l.jsx)(p.Z,{endpointId:y.r.DocumentType.qry,parameters:"_startAt=0&_pageSize=1000&_dgId=".concat(x.J.MaterialTransfer),name:"dtId",label:M.documentType,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],valueField:"recordId",displayField:["reference","name"],values:H.values,displayFieldWidth:1.5,maxAccess:Z,onChange:async(e,t)=>{H.setFieldValue("dtId",(null==t?void 0:t.recordId)||null)},error:H.touched.dtId&&!!H.errors.dtId})}),(0,l.jsx)(u.ZP,{item:!0,xs:2,children:(0,l.jsx)(q.Z,{name:"date",label:M.date,value:null==H?void 0:null===(n=H.values)||void 0===n?void 0:n.date,onChange:H.setFieldValue,readOnly:!0,required:!0,maxAccess:Z,onClear:()=>H.setFieldValue("date",null),error:H.touched.date&&!!H.errors.date})}),(0,l.jsx)(u.ZP,{item:!0,xs:2,children:(0,l.jsx)(p.Z,{endpointId:R.$.Site.qry,name:"fromSiteId",readOnly:!0,required:!0,label:M.fromSite,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:H.values,valueField:"recordId",displayField:["reference","name"],maxAccess:Z,onChange:(e,t)=>{H.setFieldValue("fromSiteId",(null==t?void 0:t.recordId)||null)},error:H.touched.fromSiteId&&!!H.errors.fromSiteId})}),(0,l.jsx)(u.ZP,{item:!0,xs:2,children:(0,l.jsx)(p.Z,{endpointId:R.$.Site.qry,name:"toSiteId",label:M.toSite,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:H.values,valueField:"recordId",displayField:["reference","name"],maxAccess:Z,displayFieldWidth:1.5,required:!0,onChange:(e,t)=>{if(!G){E({message:M.selectFromSite});return}H.setFieldValue("toSiteId",(null==t?void 0:t.recordId)||0)},error:H.touched.toSiteId&&!!H.errors.toSiteId})}),(0,l.jsx)(u.ZP,{item:!0,xs:2,children:(0,l.jsx)(S.Z,{name:"reference",label:M.reference,value:null==H?void 0:null===(k=H.values)||void 0===k?void 0:k.reference,maxAccess:Z,onBlur:e=>{if(!G){E({message:M.selectFromSite});return}let t=e.target.value;J(t),H.setFieldValue("reference",t)},onClear:()=>H.setFieldValue("reference",""),onChange:H.handleChange,error:H.touched.reference&&!!H.errors.reference})})]})}),(0,l.jsx)(a.Q,{children:(0,l.jsx)(h._,{onChange:e=>H.setFieldValue("items",e),value:null===(D=H.values)||void 0===D?void 0:D.items,error:null===(N=H.errors)||void 0===N?void 0:N.items,columns:Q,disabled:!1,allowDelete:!1,allowAddNewLine:!1,maxAccess:Z,name:"items"})})]})})}},58912:function(e,t,n){"use strict";n.d(t,{I:function(){return r}});let l="IR.asmx/",r={ReplenishmentGroups:{qry:l+"qryGRP",page:l+"pageGRP",get:l+"getGRP",set:l+"setGRP",del:l+"delGRP"},IvReplenishements:{qry:l+"qryHDR",page:l+"pageHDR",get:l+"getHDR",set:l+"setHDR"},IvReplenishementsList:{qry:l+"qryTRX"},GenerateIvReplenishements:{generate:l+"generateTFR"},MaterialReplenishment:{page:l+"pageREQ",del:l+"delREQ",get:l+"getREQ",set2:l+"set2REQ",snapshot:l+"snapshotREQ",close:l+"closeREQ",reopen:l+"reopenREQ",cancel:l+"cancelREQ",print:l+"printREQ"},OrderItem:{qry:l+"qryREI",open:l+"openREI"},MatPlanning:{page:l+"pageMPL",del:l+"delMPL",get:l+"getMPL",set2:l+"set2MPL",reopen:l+"reopenMPL",close:l+"closeMPL",qry:l+"qryMPL",snapshot:l+"snapshotMPL"},MatPlanningItem:{qry:l+"qryMPI",append:l+"appendMPI"},PurchaseRequest:{generate:l+"generatePR"},PlantSettings:{get:l+"getPLT",set:l+"setPLT",del:l+"delPLT"},DocumentTypeDefault:{get:l+"getDTD",set:l+"setDTD",del:l+"delDTD",page:l+"pageDTD"},materialPlaning:{preview:l+"previewMRP"},Transfer:{generate2:l+"generate2TFR"},ConsumptionOfTools:{generate:l+"generateMFCON"}}},51264:function(e,t,n){"use strict";n.d(t,{p:function(){return r}});let l="LO.asmx/",r={LoCollector:{qry:l+"qryCOL",get:l+"getCOL",set:l+"setCOL",page:l+"pageCOL",del:l+"delCOL"},LoCarrier:{qry:l+"qryCAR",get:l+"getCAR",set:l+"setCAR",page:l+"pageCAR",del:l+"delCAR"},Shipment:{get2:l+"get2SHP",set2:l+"set2SHP"},Transportation:{get:l+"getTPT",set:l+"setTPT"}}},67920:function(e,t,n){"use strict";n.d(t,{m:function(){return r}});var l=n(48601);function r(e,t,n){var r;let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"items",d={...e};return null==n||null===(r=n.record)||void 0===r||r.controls.forEach(e=>{let{controlId:t,accessLevel:n}=e,[l,r]=null==t?void 0:t.split(".");l!==a||2!==n||r in d||(d[r]=e=>(null==e?void 0:e[r])!=null),(1===n||4===n)&&r in d&&delete d[r]}),{schema:l.Ry().shape({...Object.keys(d).reduce((e,n)=>(e[n]=l.nK().nullable().test(function(e){var l;let r=this.parent,[,a]=this.path.match(/^(\w+)\[(\d+)\]/)||[],i=(null===(l=this.options.context)||void 0===l?void 0:l[a])||[];if(t||!t&&i.length>1){if(null!==r[n]&&void 0!==r[n]&&0!==r[n]&&""!==d[n]&&!d[n](r))return!1;if(!Object.entries(d).some(e=>{let[,t]=e;return!!t(r)}))return!0}return!!d[n](r)&&void 0!==e}),e),{})}),requiredFields:d}}}},function(e){e.O(0,[30586,49774,92888,40179],function(){return e(e.s=96889)}),_N_E=e.O()}]);