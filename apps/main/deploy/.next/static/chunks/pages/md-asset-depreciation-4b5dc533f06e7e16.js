(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2132],{5521:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/md-asset-depreciation",function(){return a(10517)}])},10517:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return Z}});var n=a(52322),r=a(2784),s=a(62202),d=a(69387),l=a(65950),i=a(71987),o=a(26612),c=a(31389),u=a(33625),m=a(62362),f=a(61802),p=a(19473),v=a(36908),x=a(68499),y=a(39812),h=a(48601),g=a(7121),I=a(5088),N=a(60218),A=a(8661),w=a(82737),_=a(38449),D=a(98345),b=a(80983),k=a(89330),j=a(21581);function C(e){var t;let{recordId:a,maxAccess:f,labels:v,window:C}=e,{getRequest:Z,postRequest:P}=(0,r.useContext)(l.$),{platformLabels:F}=(0,r.useContext)(p.l),{documentType:S,maxAccess:O,changeDT:T}=(0,D.H)({functionId:g.J.AssetsDepreciation,access:f,enabled:!a}),V=(0,i.E)({endpointId:x.Y.AssetsDescription.snapshot}),E=e=>{let t=(null==e?void 0:e.getMonth())+1,a=null==e?void 0:e.getDate(),n=null==e?void 0:e.getFullYear();return"".concat(t,"-").concat(a,"-").concat(n)},{formik:R}=(0,b.c)({maxAccess:O,documentType:{key:"dtId",value:null==S?void 0:S.dtId},initialValues:{recordId:null,reference:"",date:new Date,notes:"",status:1,dtId:null,plantId:"",asset:[]},validateOnChange:!0,validationSchema:h.Ry({}),onSubmit:async e=>{let{asset:t,...n}=e,r={...n,date:(0,y.ku)(e.date)},d=await P({extension:x.Y.AssetsDescription.set2,record:JSON.stringify({header:r,items:R.values.asset.list||[]})});a?s.ZP.success(F.Edited):(s.ZP.success(F.Added),J(d.recordId)),V()}});async function q(){let e=await Z({extension:x.Y.AssetsDescription.preview,parameters:"_asOfDate=".concat(E(R.values.date))});R.setFieldValue("asset",e)}let Y=!!R.values.recordId,L=async()=>{await P({extension:x.Y.AssetsDescription.post,record:JSON.stringify(R.values)}),s.ZP.success(F.Posted),C.close(),V()};(0,r.useEffect)(()=>{!async function(){if(a){await J(a);let e=await Z({extension:x.Y.AssetsTableData.qry,parameters:"_depId=".concat(a)});R.setFieldValue("asset",e)}}()},[]);let J=async e=>{try{if(e){let t=await Z({extension:x.Y.AssetsDescription.get,parameters:"_recordId=".concat(e)});R.setValues({...t.record,date:(0,y.a1)(t.record.date)})}}catch(e){}},$=[{field:"assetRef",headerName:v.asset,flex:1},{field:"assetName",headerName:v.name,flex:1},{field:"ccName",headerName:v.costCenter,flex:1},{field:"period",headerName:v.days,flex:1,type:"number"},{field:"amount",headerName:v.amount,flex:1},{field:"bookValue",headerName:v.bookValue,flex:1},{field:"depreciationAmount",headerName:v.depAmount,flex:1,type:"number"},{field:"newBookValue",headerName:v.newBookValue,flex:1},{field:"notes",headerName:v.notes,flex:1}],z=3===R.values.status,M=[{key:"GL",condition:!0,onClick:"onClickGL",datasetId:o.i.GLDepreciation,disabled:!Y},{key:"Locked",condition:z,onClick:"onUnpostConfirmation",disabled:!0},{key:"Unlocked",condition:!z,onClick:L,disabled:!Y},{key:"PR",condition:!0,onClick:q,disabled:Y||R.values.asset.count>0}];return(0,n.jsx)(w.Z,{resourceId:o.i.Depreciation,form:R,actions:M,editMode:Y,maxAccess:O,functionId:g.J.AssetsDepreciation,previewReport:!0,children:(0,n.jsxs)(c.R,{children:[(0,n.jsx)(u.g,{children:(0,n.jsxs)(N.ZP,{container:!0,spacing:2,children:[(0,n.jsx)(N.ZP,{item:!0,xs:6,children:(0,n.jsxs)(N.ZP,{container:!0,spacing:2,children:[(0,n.jsx)(N.ZP,{item:!0,xs:12,children:(0,n.jsx)(A.Z,{endpointId:_.r.DocumentType.qry,parameters:"_dgId=".concat(g.J.AssetsDepreciation,"&_startAt=",0,"&_pageSize=",50),name:"dtId",label:v.dtName,readOnly:Y,valueField:"recordId",displayField:"name",values:R.values,onChange:async(e,t)=>{R.setFieldValue("dtId",(null==t?void 0:t.recordId)||""),T(t)},error:R.touched.dtId&&!!R.errors.dtId,maxAccess:O})}),(0,n.jsx)(N.ZP,{item:!0,xs:12,children:(0,n.jsx)(I.Z,{name:"reference",label:v.reference,value:R.values.reference,readOnly:!R.values.dtId||Y,maxAccess:O,error:R.touched.reference&&!!R.errors.reference})}),(0,n.jsx)(N.ZP,{item:!0,xs:12,children:(0,n.jsx)(k.Z,{name:"date",label:v.date,value:null===(t=R.values)||void 0===t?void 0:t.date,onChange:R.setFieldValue,onClear:()=>R.setFieldValue("date",""),maxAccess:O,readOnly:Y,error:!R.values.date})})]})}),(0,n.jsx)(N.ZP,{item:!0,xs:6,children:(0,n.jsxs)(N.ZP,{container:!0,spacing:2,children:[(0,n.jsx)(N.ZP,{item:!0,xs:12,children:(0,n.jsx)(A.Z,{endpointId:_.r.Plant.qry,name:"plantId",label:v.plantName,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"plant Ref"},{key:"name",value:"Name"}],values:R.values,readOnly:Y,maxAccess:O,onChange:(e,t)=>{let a=(null==t?void 0:t.recordId)||"";R.setFieldValue("plantId",a)},error:R.touched.plantId&&!!R.errors.plantId})}),(0,n.jsx)(N.ZP,{item:!0,xs:12,children:(0,n.jsx)(j.Z,{name:"notes",label:v.notes,value:R.values.notes,maxLength:"200",readOnly:Y,maxAccess:O,onChange:R.handleChange,onClear:()=>R.setFieldValue("notes",""),error:R.touched.notes&&!!R.errors.notes})})]})})]})}),(0,n.jsx)(m.Q,{children:(0,n.jsx)(d.Z,{name:"assets",columns:$,gridData:R.values.asset,rowId:["recordId"],isLoading:!1,maxAccess:f,pagination:!1})})]})})}var Z=()=>{let{getRequest:e,postRequest:t}=(0,r.useContext)(l.$),{platformLabels:a}=(0,r.useContext)(p.l),[y,h]=(0,r.useState)(""),{stack:g}=(0,f.zY)();async function I(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{_startAt:a=0,_pageSize:n=50,params:r=[]}=t;return{...await e({extension:x.Y.AssetsDescription.qry,parameters:"_startAt=".concat(a,"&_pageSize=").concat(n,"&_filter=&_sortField=&_params=").concat(r)}),_startAt:a}}let{query:{data:N},filterBy:A,refetch:w,labels:_,access:D,paginationParameters:b,invalidate:k}=(0,i.J)({queryFn:I,endpointId:x.Y.AssetsDescription.snapshot,datasetId:o.i.Depreciation,filter:{filterFn:j}});async function j(t){let{filters:a,pagination:n={}}=t,{_startAt:r=0,_size:s=50}=n;return a.qry?{...await e({extension:x.Y.AssetsDescription.snapshot,parameters:"_filter=".concat(a.qry,"&_startAt=").concat(r,"&_size=").concat(s)}),_startAt:r}:I({_startAt:n._startAt||0,params:null==a?void 0:a.params})}let Z=[{field:"dtName",headerName:_.dtName,flex:1},{field:"reference",headerName:_.reference,flex:1},{field:"date",headerName:_.date,flex:1,type:"date"},{field:"plantName",headerName:_.plantName,flex:1},{field:"statusName",headerName:_.status,flex:1},{field:"wipName",headerName:_.wip,flex:1},{field:"notes",headerName:_.notes,flex:1}];function P(e){g({Component:C,props:{labels:_,recordId:e,maxAccess:D},width:1200,height:660,title:_.assetD})}let F=async e=>{await t({extension:x.Y.AssetsDescription.del,record:JSON.stringify(e)}),k(),s.ZP.success(a.Deleted)};return(0,n.jsxs)(c.R,{children:[(0,n.jsx)(u.g,{children:(0,n.jsx)(v.Z,{onAdd:()=>{P()},maxAccess:D,reportName:"FADEP",filterBy:A})}),(0,n.jsx)(m.Q,{children:(0,n.jsx)(d.Z,{columns:Z,gridData:N,rowId:["recordId"],onEdit:e=>{P(null==e?void 0:e.recordId)},onDelete:F,isLoading:!1,pageSize:50,paginationType:"api",deleteConfirmationType:"strict",paginationParameters:b,refetch:w,maxAccess:D})})]})}},1685:function(e,t,a){"use strict";a.d(t,{m:function(){return n}});let n=e=>{let t=window.sessionStorage.getItem(e);return t?JSON.parse(t):null}},98345:function(e,t,a){"use strict";a.d(t,{H:function(){return v},G:function(){return p}});var n=a(45300),r=a(2784),s=a(96026),d=a(38449);a(26612);var l=a(65947),i=a(1685);let o=async(e,t,a)=>{try{let n=await e({extension:t,parameters:a});return t.includes("qry")?n:n.record}catch(e){return null}},c=(e,t,a,n)=>{let r=(e=JSON.parse(JSON.stringify(e))).record.controls,s=r.find(e=>"reference"===e.controlId);return s?s.accessLevel=(null==t?void 0:t.mandatory)?l.$7:l.rr:(null==t?void 0:t.mandatory)?r.push({sgId:0,resourceId:"",controlId:"".concat(n?n+".":"","reference"),accessLevel:(null==t?void 0:t.mandatory)?l.$7:l.rr}):(null==t?void 0:t.readOnly)?r.push({sgId:0,resourceId:"",controlId:"".concat(n?n+".":"","reference"),accessLevel:(null==t?void 0:t.readOnly)?l.rr:l.$7}):r=e.record.controls.filter(e=>"reference"!=e.controlId),a&&r.push({sgId:0,resourceId:"",controlId:"".concat(n?n+".":"","dtId"),accessLevel:l.$7}),{...e,record:{...e.record,controls:r}}},u=async(e,t,a)=>{let n,r;switch(a){case"dtId":let s=(0,i.m)("userData"),l=null==s?void 0:s.userId;r="_userId=".concat(l,"&_functionId=").concat(t),n=d.r.UserFunction.get;break;case"glbSysNumberRange":r="_recordId=".concat(t),n=d.r.SystemFunction.get;break;case"DocumentType":r="_dgId=".concat(t,"&_startAt=",0,"&_pageSize=",50),n=d.r.DocumentType.qry;break;case"DcTypNumberRange":r="_recordId=".concat(t),n=d.r.DocumentType.get;break;case"isExternal":r="_recordId=".concat(t),n=d.r.NumberRange.get;break;default:return null}return await o(e,n,r)},m=async function(e){let t,a,n,r,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,d=arguments.length>2?arguments[2]:void 0,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,i=!(arguments.length>4)||void 0===arguments[4]||arguments[4],o=arguments.length>5?arguments[5]:void 0,m=void 0===l&&s&&await u(e,s,"dtId"),f=null==m?void 0:m.dtId,p="",v=!0;if(m&&void 0===l||"nraId"===l){if(f){let a=await u(e,f,"DcTypNumberRange");t=null==a?void 0:a.nraId,v=!((null==a?void 0:a.activeStatus)<0),t||(p="Assign the document type to a number range")}if((!f||!v)&&i&&s){var x;let t=await u(e,s,"DocumentType");r=(null==t?void 0:null===(x=t.list)||void 0===x?void 0:x.filter(e=>(null==e?void 0:e.activeStatus)===1).length)>0}}if(("nraId"===l||void 0===l)&&s){if((!f||f)&&!t||t&&!v){let a=await u(e,s,"glbSysNumberRange");(t=null==a?void 0:a.nraId)&&r&&(r=!1),v=!0}p=t||r?"":"Assign the system Function to a number range"}l>0&&!t&&(t=l),t&&v?(a={readOnly:null==(n=await u(e,t,"isExternal"))||!n.external,mandatory:null!=n&&!!n.external},d&&(d=await c(d,a,r,o))):!t&&d&&(d=await c(d,a,r,o));let y=o?"".concat(o,".reference"):"reference";return{dtId:f,resetReference:null==a?void 0:a.readOnly,dcTypeRequired:r,reference:{fieldName:y,isEmpty:(null==n?void 0:n.external)!==void 0&&(null==n||!n.external)},errorMessage:p,maxAccess:d,selectNraId:l}};var f=a(65950);function p(e){let{functionId:t,action:a,hasDT:n}=e,{getRequest:d}=(0,r.useContext)(f.$),{stack:l}=(0,s.V)();return{proxyAction:async()=>{let e=await m(d,t,"",void 0,n);(null==e?void 0:e.errorMessage)?l({message:null==e?void 0:e.errorMessage}):await a()}}}function v(e){var t;let{functionId:a,access:d,hasDT:l,enabled:i=!0,objectName:o=""}=e,{getRequest:c}=(0,r.useContext)(f.$),{stack:u}=(0,s.V)(),[p,v]=(0,r.useState)(),x=async e=>{let t=await m(c,a,d,e,l,o);if(!t.errorMessage)return t;u({message:null==t?void 0:t.errorMessage})},y=(0,n.a)({retry:!1,staleTime:0,enabled:i,queryKey:[a,p,!!d,i],queryFn:p||"nraId"===p?()=>x(p):()=>x()});return{documentType:y.data,maxAccess:(null==y?void 0:null===(t=y.data)||void 0===t?void 0:t.maxAccess)||d,changeDT(e){v((null==e?void 0:e.nraId)||"nraId")}}}}},function(e){e.O(0,[92515,2494,36908,49774,92888,40179],function(){return e(e.s=5521)}),_N_E=e.O()}]);