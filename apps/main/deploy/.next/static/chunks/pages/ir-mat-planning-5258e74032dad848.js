(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[80783],{99967:function(e,n,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/ir-mat-planning",function(){return a(48901)}])},48901:function(e,n,a){"use strict";a.r(n),a.d(n,{default:function(){return b}});var t=a(52322),r=a(2784),d=a(62202),o=a(69387),l=a(65950),i=a(26612),s=a(71987),c=a(61802),u=a(31389),m=a(33625),p=a(62362),h=a(19473),f=a(98345),v=a(7121),y=a(58912),g=a(36908),I=a(30032),b=()=>{let{getRequest:e,postRequest:n}=(0,r.useContext)(l.$),{stack:a}=(0,c.zY)(),{platformLabels:b}=(0,r.useContext)(h.l);async function x(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{_startAt:a=0,_pageSize:t=50,params:r}=n;return{...await e({extension:y.I.MatPlanning.page,parameters:"_startAt=".concat(a,"&_pageSize=").concat(t,"&_params=").concat(r||"")}),_startAt:a}}let{query:{data:w},labels:k,filterBy:P,paginationParameters:C,invalidate:N,access:O,refetch:S}=(0,s.J)({queryFn:x,endpointId:y.I.MatPlanning.page,datasetId:i.i.MaterialReqPlannings,filter:{filterFn:_}});async function _(n){let{filters:a,pagination:t}=n;return(null==a?void 0:a.qry)?await e({extension:y.I.MatPlanning.snapshot,parameters:"_filter=".concat(a.qry)}):x({_startAt:t._startAt||0,params:null==a?void 0:a.params})}let R=[{field:"dtRef",headerName:k.documentType,flex:1},{field:"date",headerName:k.date,flex:1,type:"date"},{field:"reference",headerName:k.reference,flex:1},{field:"statusName",headerName:k.status,flex:1},{field:"rsName",headerName:k.releaseStatus,flex:1},{field:"wipName",headerName:k.wip,flex:1},{field:"notes",headerName:k.notes,flex:1}],j=async e=>{await n({extension:y.I.MatPlanning.del,record:JSON.stringify(e)}),d.ZP.success(b.Deleted),N()},{proxyAction:Z}=(0,f.G)({functionId:v.J.MRP,action:F}),A=async()=>{await Z()};function F(e){a({Component:I.Z,props:{recordId:e}})}return(0,t.jsxs)(u.R,{children:[(0,t.jsx)(m.g,{children:(0,t.jsx)(g.Z,{onAdd:A,maxAccess:O,reportName:"IRMPL",filterBy:P})}),(0,t.jsx)(p.Q,{children:(0,t.jsx)(o.Z,{name:"table",columns:R,gridData:w,rowId:["recordId"],paginationParameters:C,deleteConfirmationType:"strict",paginationType:"api",refetch:S,onEdit:e=>{F(null==e?void 0:e.recordId)},onDelete:j,pageSize:50,maxAccess:O})})]})}},1685:function(e,n,a){"use strict";a.d(n,{m:function(){return t}});let t=e=>{let n=window.sessionStorage.getItem(e);return n?JSON.parse(n):null}},98345:function(e,n,a){"use strict";a.d(n,{H:function(){return f},G:function(){return h}});var t=a(45300),r=a(2784),d=a(96026),o=a(38449);a(26612);var l=a(65947),i=a(1685);let s=async(e,n,a)=>{try{let t=await e({extension:n,parameters:a});return n.includes("qry")?t:t.record}catch(e){return null}},c=(e,n,a,t)=>{let r=(e=JSON.parse(JSON.stringify(e))).record.controls,d=r.find(e=>"reference"===e.controlId);return d?d.accessLevel=(null==n?void 0:n.mandatory)?l.$7:l.rr:(null==n?void 0:n.mandatory)?r.push({sgId:0,resourceId:"",controlId:"".concat(t?t+".":"","reference"),accessLevel:(null==n?void 0:n.mandatory)?l.$7:l.rr}):(null==n?void 0:n.readOnly)?r.push({sgId:0,resourceId:"",controlId:"".concat(t?t+".":"","reference"),accessLevel:(null==n?void 0:n.readOnly)?l.rr:l.$7}):r=e.record.controls.filter(e=>"reference"!=e.controlId),a&&r.push({sgId:0,resourceId:"",controlId:"".concat(t?t+".":"","dtId"),accessLevel:l.$7}),{...e,record:{...e.record,controls:r}}},u=async(e,n,a)=>{let t,r;switch(a){case"dtId":let d=(0,i.m)("userData"),l=null==d?void 0:d.userId;r="_userId=".concat(l,"&_functionId=").concat(n),t=o.r.UserFunction.get;break;case"glbSysNumberRange":r="_recordId=".concat(n),t=o.r.SystemFunction.get;break;case"DocumentType":r="_dgId=".concat(n,"&_startAt=",0,"&_pageSize=",50),t=o.r.DocumentType.qry;break;case"DcTypNumberRange":r="_recordId=".concat(n),t=o.r.DocumentType.get;break;case"isExternal":r="_recordId=".concat(n),t=o.r.NumberRange.get;break;default:return null}return await s(e,t,r)},m=async function(e){let n,a,t,r,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,o=arguments.length>2?arguments[2]:void 0,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,i=!(arguments.length>4)||void 0===arguments[4]||arguments[4],s=arguments.length>5?arguments[5]:void 0,m=void 0===l&&d&&await u(e,d,"dtId"),p=null==m?void 0:m.dtId,h="",f=!0;if(m&&void 0===l||"nraId"===l){if(p){let a=await u(e,p,"DcTypNumberRange");n=null==a?void 0:a.nraId,f=!((null==a?void 0:a.activeStatus)<0),n||(h="Assign the document type to a number range")}if((!p||!f)&&i&&d){var v;let n=await u(e,d,"DocumentType");r=(null==n?void 0:null===(v=n.list)||void 0===v?void 0:v.filter(e=>(null==e?void 0:e.activeStatus)===1).length)>0}}if(("nraId"===l||void 0===l)&&d){if((!p||p)&&!n||n&&!f){let a=await u(e,d,"glbSysNumberRange");(n=null==a?void 0:a.nraId)&&r&&(r=!1),f=!0}h=n||r?"":"Assign the system Function to a number range"}l>0&&!n&&(n=l),n&&f?(a={readOnly:null==(t=await u(e,n,"isExternal"))||!t.external,mandatory:null!=t&&!!t.external},o&&(o=await c(o,a,r,s))):!n&&o&&(o=await c(o,a,r,s));let y=s?"".concat(s,".reference"):"reference";return{dtId:p,resetReference:null==a?void 0:a.readOnly,dcTypeRequired:r,reference:{fieldName:y,isEmpty:(null==t?void 0:t.external)!==void 0&&(null==t||!t.external)},errorMessage:h,maxAccess:o,selectNraId:l}};var p=a(65950);function h(e){let{functionId:n,action:a,hasDT:t}=e,{getRequest:o}=(0,r.useContext)(p.$),{stack:l}=(0,d.V)();return{proxyAction:async()=>{let e=await m(o,n,"",void 0,t);(null==e?void 0:e.errorMessage)?l({message:null==e?void 0:e.errorMessage}):await a()}}}function f(e){var n;let{functionId:a,access:o,hasDT:l,enabled:i=!0,objectName:s=""}=e,{getRequest:c}=(0,r.useContext)(p.$),{stack:u}=(0,d.V)(),[h,f]=(0,r.useState)(),v=async e=>{let n=await m(c,a,o,e,l,s);if(!n.errorMessage)return n;u({message:null==n?void 0:n.errorMessage})},y=(0,t.a)({retry:!1,staleTime:0,enabled:i,queryKey:[a,h,!!o,i],queryFn:h||"nraId"===h?()=>v(h):()=>v()});return{documentType:y.data,maxAccess:(null==y?void 0:null===(n=y.data)||void 0===n?void 0:n.maxAccess)||o,changeDT(e){f((null==e?void 0:e.nraId)||"nraId")}}}},30032:function(e,n,a){"use strict";a.d(n,{Z:function(){return j}});var t=a(52322),r=a(89330),d=a(39812),o=a(60218),l=a(2784),i=a(48601),s=a(82737),c=a(62202),u=a(65950),m=a(71987),p=a(26612),h=a(5088),f=a(21581),v=a(8661),y=a(38449),g=a(7121),I=a(62362),b=a(31389),x=a(80983),w=a(19473),k=a(98345),P=a(61802),C=a(58912),N=a(76399),O=a(33625),S=a(39704),_=a(50023),R=a(21326);function j(e){var n,a,j,Z,A,F,M,T,q,E,D,L;let{recordId:J,window:V}=e,{getRequest:$,postRequest:z}=(0,l.useContext)(u.$),{platformLabels:W}=(0,l.useContext)(w.l),{stack:Q}=(0,P.zY)(),{labels:H,access:X}=(0,_.Z)({datasetId:p.i.MaterialReqPlannings,editMode:!!J}),{documentType:G,maxAccess:Y,changeDT:B}=(0,k.H)({functionId:g.J.MRP,access:X,enabled:!J,objectName:"header"});(0,R.Z)({title:H.materialRequestPlaning,window:V});let K=(0,m.E)({endpointId:C.I.MatPlanning.page}),{formik:U}=(0,x.c)({maxAccess:Y,documentType:{key:"header.dtId",value:null==G?void 0:G.dtId},initialValues:{recordId:J,header:{recordId:J,dtId:null,reference:"",date:new Date,notes:"",status:1,releaseStatus:null,wip:1},items:[]},validateOnChange:!0,validationSchema:i.Ry({header:i.Ry({date:i.hT().required()}),items:i.IX().of(i.Ry({qty:i.Rx().required()}))}),onSubmit:async e=>{let n=await z({extension:C.I.MatPlanning.set2,record:JSON.stringify({header:{...e.header,date:(0,d.ku)(e.header.date)},items:e.items})});c.ZP.success(e.recordId?W.Edited:W.Added),et(n.recordId),K()}}),ee=!!U.values.recordId,en=4==U.values.header.status,ea=2===U.values.header.wip;async function et(e){let{record:n}=await $({extension:C.I.MatPlanning.get,parameters:"_requestId=".concat(e)}),{list:a}=await $({extension:C.I.MatPlanningItem.qry,parameters:"_mrpId=".concat(e)});U.setValues({recordId:n.recordId,header:{...n,date:(0,d.a1)(null==n?void 0:n.date)},items:null==a?void 0:a.map((e,n)=>({...e,id:n+1,seqNo:n+1,date:(0,d.a1)(e.date)}))})}let er=[{key:"Reopen",condition:ea,onClick:async function(){await z({extension:C.I.MatPlanning.reopen,record:JSON.stringify({...U.values.header,date:(0,d.ku)(U.values.header.date)})}),c.ZP.success(W.Reopened),K(),et(U.values.recordId)},disabled:!ea},{key:"Close",condition:!ea,onClick:async function(){await z({extension:C.I.MatPlanning.close,record:JSON.stringify({...U.values.header,date:(0,d.ku)(U.values.header.date)})}),c.ZP.success(W.Closed),K(),et(U.values.recordId)},disabled:ea||!ee},{key:"RecordRemarks",condition:!0,onClick:"onRecordRemarks",disabled:!ee},{key:"WorkFlow",condition:!0,onClick:async function(){Q({Component:S.Z,props:{functionId:g.J.MRP,recordId:U.values.recordId}})},disabled:!ee},{key:"Approval",condition:!0,onClick:"onApproval",disabled:!ea},{key:"generate",condition:!0,onClick:async()=>{await z({extension:C.I.PurchaseRequest.generate,record:JSON.stringify({...U.values.header,date:(0,d.ku)(U.values.header.date)})}),c.ZP.success(W.Generated),K(),et(U.values.recordId)},disabled:!ee||!en}];(0,l.useEffect)(()=>{J&&et(J)},[]);let ed=[{component:"textfield",label:H.sku,name:"sku",width:100,props:{readOnly:!0}},{component:"textfield",label:H.name,name:"itemName",width:150,props:{readOnly:!0}},{component:"numberfield",label:H.onHand,name:"onhand",width:100,props:{readOnly:!0}},{component:"numberfield",label:H.openPr,name:"openPR",width:100,props:{readOnly:!0}},{component:"numberfield",label:H.openPo,name:"openPO",width:100,props:{readOnly:!0}},{component:"numberfield",label:H.leadTime,name:"leadTime",width:100,props:{readOnly:!0}},{component:"numberfield",label:H.safetyStock,name:"safetyStock",width:100,props:{readOnly:!0}},{component:"numberfield",label:H.reorderPoint,name:"reorderPoint",width:100,props:{readOnly:!0}},{component:"numberfield",label:H.min,name:"minStock",width:100,props:{readOnly:!0}},{component:"numberfield",label:H.max,name:"maxStock",width:100,props:{readOnly:!0}},{component:"numberfield",label:H.amcShortTerm,name:"amcShortTerm",width:100,props:{readOnly:!0}},{component:"numberfield",label:H.amcLongTerm,name:"amcLongTerm",width:100,props:{readOnly:!0}},{component:"numberfield",label:H.siteCoverageStock,name:"siteCoverageStock",width:100,props:{readOnly:!0}},{component:"numberfield",label:H.totalCoverageStock,name:"totalStockCoverage",width:100,props:{readOnly:!0}},{component:"textfield",label:H.mu,name:"msRef",width:100,props:{readOnly:!0}},{component:"numberfield",label:H.unitCost,name:"unitCost",width:100,props:{readOnly:!0}},{component:"numberfield",label:H.totalCost,name:"totalCost",width:100,props:{readOnly:!0}},{component:"numberfield",label:H.sugQty,name:"suggestedPRQty",width:100,props:{readOnly:!0}},{component:"numberfield",label:H.reqQty,name:"qty",width:100,props:{decimalScale:2}}];return(0,t.jsx)(s.Z,{resourceId:p.i.MaterialReqPlannings,functionId:g.J.MRP,form:U,maxAccess:Y,actions:er,editMode:ee,previewReport:ee,disabledSubmit:ea,children:(0,t.jsxs)(b.R,{children:[(0,t.jsx)(O.g,{children:(0,t.jsxs)(o.ZP,{container:!0,spacing:2,children:[(0,t.jsx)(o.ZP,{item:!0,xs:4,children:(0,t.jsxs)(o.ZP,{container:!0,spacing:2,children:[(0,t.jsx)(o.ZP,{item:!0,xs:12,children:(0,t.jsx)(v.Z,{endpointId:y.r.DocumentType.qry,parameters:"_startAt=0&_pageSize=1000&_dgId=".concat(g.J.MRP),name:"header.dtId",label:H.documentType,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],readOnly:ee,valueField:"recordId",displayField:["reference","name"],values:U.values.header,maxAccess:Y,onChange:(e,n)=>{U.setFieldValue("header.dtId",(null==n?void 0:n.recordId)||null),B(n)},error:(null===(n=U.touched.header)||void 0===n?void 0:n.dtId)&&!!(null===(a=U.errors.header)||void 0===a?void 0:a.dtId)})}),(0,t.jsx)(o.ZP,{item:!0,xs:12,children:(0,t.jsx)(r.Z,{name:"header.date",label:H.date,value:null===(j=U.values)||void 0===j?void 0:j.header.date,readOnly:ea,required:!0,onChange:U.setFieldValue,onClear:()=>U.setFieldValue("header.date",null),error:(null===(Z=U.touched.header)||void 0===Z?void 0:Z.date)&&!!(null===(A=U.errors.header)||void 0===A?void 0:A.date),maxAccess:Y})}),(0,t.jsx)(o.ZP,{item:!0,xs:12,children:(0,t.jsx)(h.Z,{name:"header.reference",label:H.reference,value:null==U?void 0:null===(F=U.values)||void 0===F?void 0:F.header.reference,maxAccess:!ee&&Y,readOnly:ee,onChange:U.handleChange,onClear:()=>U.setFieldValue("header.reference",""),error:(null===(M=U.touched.header)||void 0===M?void 0:M.reference)&&!!(null===(T=U.errors.header)||void 0===T?void 0:T.reference)})})]})}),(0,t.jsx)(o.ZP,{item:!0,xs:4,children:(0,t.jsx)(f.Z,{name:"header.notes",label:H.notes,value:U.values.header.notes,rows:3,readOnly:ea,maxAccess:Y,onChange:e=>U.setFieldValue("header.notes",e.target.value),onClear:()=>U.setFieldValue("header.notes",""),error:(null===(q=U.touched.header)||void 0===q?void 0:q.notes)&&!!(null===(E=U.errors.header)||void 0===E?void 0:E.notes)})})]})}),(0,t.jsx)(I.Q,{children:(0,t.jsx)(N._,{onChange:e=>{U.setFieldValue("items",e)},value:null==U?void 0:null===(D=U.values)||void 0===D?void 0:D.items,error:null==U?void 0:null===(L=U.errors)||void 0===L?void 0:L.items,columns:ed,maxAccess:Y,name:"items",allowDelete:!ea,allowAddNewLine:!1,disabled:ea})})]})})}j.width=1300,j.height=600},39704:function(e,n,a){"use strict";var t=a(52322),r=a(2784),d=a(22341),o=a(65950),l=a(85325),i=a(21326),s=a(19473),c=a(35656),u=a(24868),m=a.n(u);let p=e=>{let{functionId:n,recordId:a,window:u}=e,{getRequest:p}=(0,r.useContext)(o.$),{languageId:h}=(0,r.useContext)(l.V),{platformLabels:f}=(0,r.useContext)(s.l),v=a+"-"+n;(0,i.Z)({title:f.WorkFlow,window:u});let{width:y}=(0,c.d)(),g=y<=1024,I=y>1024&&y<=1280,b=g?10:I?12:14,x=g?75:I?85:95,w=g?15:I?20:25,k=async()=>{var e="_functionId=".concat(n,"&_recordId=").concat(a);let t=await p({extension:d.P.WorkFlow.graph,parameters:e});return null==t?void 0:t.record},P=e=>{let n=[],a=[],t="",r="";return e.objects.forEach(e=>{n.push({functionName:e.functionName,reference:e.reference,date:e.date})}),e.workflow.forEach(n=>{e.objects.forEach(e=>{let a=e.functionName.split(" ").join("\r\n");n.parentId===e.recordId&&n.parentFunctionId===e.functionId&&(t=e.reference+"\r\n"+e.date+"\r\n"+a,n.parentId),n.childId===e.recordId&&n.childFunctionId===e.functionId&&(r=e.reference+"\r\n"+e.date+"\r\n"+a,n.childId)}),""===t||""===r||a.push({from:t,to:r,value:1,labelText:""}),t="",r=""}),a};return(0,r.useEffect)(()=>{!async function(){var e=await k();if(e){let n=(e,n)=>{let a=document.createElement("script");a.type="text/javascript",a.src=e,a.async=!0,a.onload=n,document.head.appendChild(a)};n("https://cdn.amcharts.com/lib/4/core.js",()=>{n("https://cdn.amcharts.com/lib/4/charts.js",()=>{n("https://cdn.amcharts.com/lib/4/themes/animated.js",()=>{am4core.ready(()=>{let n=am4core.create(v,am4charts.SankeyDiagram),a=P(e);n.data=a,n.dataFields.fromName="from",n.dataFields.toName="to",n.dataFields.value="value",n.paddingRight=2===h?0:40,n.paddingLeft=2===h?40:0,n.tooltip.label.fontSize=b;let t=n.nodes.template;t.draggable=!1,t.inert=!0,t.clickable=!1,t.width=x,t.height=w,t.nameLabel.label.fontSize=b,t.nameLabel.locationX=2===h?.85:0,t.nameLabel.height=void 0,t.nameLabel.label.fontWeight="bold";let r=n.links.template;r.middleLine.strokeOpacity=.3,r.middleLine.stroke=am4core.color("#555"),r.middleLine.strokeWidth=5,r.middleLine.hoverable=!1,r.fillOpacity=0,r.hoverable=!0,r.hoverOnFocus=!0,r.fill=am4core.color("#A8C686"),r.isHover=!0,n.appear(1e3,100)})})})})}}()},[]),(0,t.jsx)("div",{id:v,className:m().root})};p.width=950,n.Z=p},24868:function(e){e.exports={root:"WorkFlow_root__EINm1"}}},function(e){e.O(0,[92515,2494,36908,49774,92888,40179],function(){return e(e.s=99967)}),_N_E=e.O()}]);