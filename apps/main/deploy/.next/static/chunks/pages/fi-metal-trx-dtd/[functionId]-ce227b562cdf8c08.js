(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[81492],{53786:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/fi-metal-trx-dtd/[functionId]",function(){return n(21436)}])},21436:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return T}});var a=n(52322),d=n(2784),r=n(62202),s=n(69387),l=n(27723),i=n(65950),c=n(71987),o=n(26612),u=n(31389),f=n(33625),I=n(62362),p=n(61802),m=n(19473),x=n(7121),y=n(60218),h=n(48601),v=n(82737),D=n(80983),g=n(38449),F=n(8661),_=n(65215),N=n(25870);function j(e){let{labels:t,maxAccess:n,recordId:s,functionId:l,window:f}=e,{platformLabels:p}=(0,d.useContext)(m.l),{getRequest:x,postRequest:j}=(0,d.useContext)(i.$),w=(0,c.E)({endpointId:N.H.FIDocTypeDefaults.page}),{formik:T}=(0,D.c)({initialValues:{dtId:null,recordId:s,plantId:null,siteId:null},maxAccess:n,validationSchema:h.Ry({dtId:h.Z_().required()}),onSubmit:async e=>{await j({extension:N.H.FIDocTypeDefaults.set,record:JSON.stringify(e)}),s?r.ZP.success(p.Edited):(T.setFieldValue("recordId",T.values.dtId),r.ZP.success(p.Added)),w(),f.close()}}),Z=!!T.values.recordId;return(0,d.useEffect)(()=>{!async function(){if(s){let e=await x({extension:N.H.FIDocTypeDefaults.get,parameters:"_dtId=".concat(s)});T.setValues({...e.record,recordId:e.record.dtId})}}()},[]),(0,a.jsx)(v.Z,{resourceId:o.i.FIDocTypeDefaults,form:T,maxAccess:n,editMode:Z,functionId:l,children:(0,a.jsx)(u.R,{children:(0,a.jsx)(I.Q,{children:(0,a.jsxs)(y.ZP,{container:!0,spacing:2,children:[(0,a.jsx)(y.ZP,{item:!0,xs:12,children:(0,a.jsx)(F.Z,{endpointId:g.r.DocumentType.qry,parameters:"_startAt=0&_pageSize=1000&_dgId=".concat(l),name:"dtId",required:!0,label:t.doctype,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],valueField:"recordId",displayField:["reference","name"],readOnly:Z,values:T.values,maxAccess:n,onChange:(e,t)=>{T&&T.setFieldValue("dtId",null==t?void 0:t.recordId)},error:T.touched.dtId&&!!T.errors.dtId})}),(0,a.jsx)(y.ZP,{item:!0,xs:12,children:(0,a.jsx)(F.Z,{endpointId:g.r.Plant.qry,name:"plantId",label:t.plant,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Ref"},{key:"name",value:"Name"}],values:T.values,maxAccess:n,onChange:(e,t)=>{T.setFieldValue("plantId",null==t?void 0:t.recordId)},error:T.touched.plantId&&!!T.errors.plantId})}),(0,a.jsx)(y.ZP,{item:!0,xs:12,children:(0,a.jsx)(F.Z,{endpointId:_.$.Site.qry,name:"siteId",label:t.site,values:T.values,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Ref"},{key:"name",value:"Name"}],maxAccess:n,onChange:(e,t)=>{T.setFieldValue("siteId",null==t?void 0:t.recordId)},error:T.touched.siteId&&!!T.errors.siteId})})]})})})})}var w=n(63165),T=()=>{let{getRequest:e,postRequest:t}=(0,d.useContext)(i.$),{platformLabels:n}=(0,d.useContext)(m.l),{stack:y}=(0,p.zY)(),{functionId:h}=(0,w.F)();async function v(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{_startAt:n=0,_pageSize:a=50}=t;return{...await e({extension:N.H.FIDocTypeDefaults.page,parameters:"_startAt=".concat(n,"&_pageSize=").concat(a,"&_functionId=").concat(h)}),_startAt:n}}let{query:{data:D},labels:g,access:F,invalidate:_,refetch:T,paginationParameters:Z}=(0,c.J)({endpointId:N.H.FIDocTypeDefaults.page,datasetId:o.i.FIDocTypeDefaults,filter:{filterFn:v,default:{functionId:h}}}),A=[{field:"dtName",headerName:g.doctype,flex:1},{field:"plantName",headerName:g.plant,flex:1},{field:"siteRef",headerName:g.siteRef,flex:1},{field:"siteName",headerName:g.site,flex:1}];function P(e){y({Component:j,props:{labels:g,recordId:null==e?void 0:e.dtId,maxAccess:F,functionId:h},width:600,height:380,title:h==x.J.MetalReceiptVoucher?g.metalTransactionReceipt:g.metalTransactionPayment})}let R=async()=>{P()},k=async e=>{await t({extension:N.H.FIDocTypeDefaults.del,record:JSON.stringify(e)}),_(),r.ZP.success(n.Deleted)};return(0,a.jsxs)(u.R,{children:[(0,a.jsx)(f.g,{children:(0,a.jsx)(l.Z,{onAdd:R,maxAccess:F})}),(0,a.jsx)(I.Q,{children:(0,a.jsx)(s.Z,{columns:A,gridData:D,rowId:["dtId"],onEdit:e=>{P(e)},onDelete:k,isLoading:!1,pageSize:50,paginationParameters:Z,refetch:T,paginationType:"api",maxAccess:F})})]})}},63165:function(e,t,n){"use strict";n.d(t,{F:function(){return r}});var a=n(5632),d=n(2784);let r=()=>{let e=(0,a.useRouter)(),[t,n]=(0,d.useState)(e.query);return t}}},function(e){e.O(0,[49774,92888,40179],function(){return e(e.s=53786)}),_N_E=e.O()}]);