(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[80522],{32194:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/work-center-consumption",function(){return n(48805)}])},48805:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return I}});var r=n(52322),a=n(2784),l=n(71987),i=n(65950),o=n(69387),d=n(62202),s=n(61802),c=n(26612),u=n(31389),f=n(33625),m=n(62362),p=n(19473),g=n(98345),v=n(7121),y=n(36908),h=n(90587),x=n(84622),I=()=>{let{postRequest:e,getRequest:t}=(0,a.useContext)(i.$),{platformLabels:n}=(0,a.useContext)(p.l),{stack:I}=(0,s.zY)(),{query:{data:w},filterBy:N,refetch:C,labels:b,access:S,paginationParameters:_,invalidate:k}=(0,l.J)({queryFn:j,endpointId:h.u.WorkCenterConsumption.page,datasetId:c.i.WorkCenterConsumptions,filter:{filterFn:Z}}),T=[{field:"reference",headerName:b.reference,flex:1},{field:"dtName",headerName:b.docType,flex:1},{field:"date",headerName:b.date,flex:1,type:"date"},{field:"WcName",headerName:b.workCenter,flex:1},{field:"siteName",headerName:b.site,flex:1},{field:"totalQty",headerName:b.weight,flex:1,type:"number"},{field:"statusName",headerName:b.status,flex:1},{field:"wipName",headerName:b.wip,flex:1},{field:"description",headerName:b.description,flex:1}];async function j(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{_startAt:n=0,_pageSize:r=50,params:a=[]}=e;return{...await t({extension:h.u.WorkCenterConsumption.page,parameters:"_startAt=".concat(n,"&_pageSize=").concat(r,"&_params=").concat(a)}),_startAt:n}}async function Z(e){let{filters:n,pagination:r}=e;return n.qry?await t({extension:h.u.WorkCenterConsumption.snapshot,parameters:"_filter=".concat(n.qry)}):j({_startAt:r._startAt||0,params:null==n?void 0:n.params})}let{proxyAction:A}=(0,g.G)({functionId:v.J.WorkCenterConsumption,action:D}),O=async()=>{await A()};async function D(e){I({Component:x.Z,props:{recordId:e}})}let P=async t=>{await e({extension:h.u.WorkCenterConsumption.del,record:JSON.stringify(t)}),k(),d.ZP.success(n.Deleted)};return(0,r.jsxs)(u.R,{children:[(0,r.jsx)(f.g,{children:(0,r.jsx)(y.Z,{onAdd:O,maxAccess:S,filterBy:N,reportName:"MFCON"})}),(0,r.jsx)(m.Q,{children:(0,r.jsx)(o.Z,{name:"WCCtable",columns:T,gridData:w,rowId:["recordId"],onEdit:e=>{D(null==e?void 0:e.recordId)},refetch:C,onDelete:P,deleteConfirmationType:"strict",isLoading:!1,pageSize:50,maxAccess:S,paginationParameters:_,paginationType:"api"})})]})}},1685:function(e,t,n){"use strict";n.d(t,{m:function(){return r}});let r=e=>{let t=window.sessionStorage.getItem(e);return t?JSON.parse(t):null}},98345:function(e,t,n){"use strict";n.d(t,{H:function(){return g},G:function(){return p}});var r=n(45300),a=n(2784),l=n(96026),i=n(38449);n(26612);var o=n(65947),d=n(1685);let s=async(e,t,n)=>{try{let r=await e({extension:t,parameters:n});return t.includes("qry")?r:r.record}catch(e){return null}},c=(e,t,n,r)=>{let a=(e=JSON.parse(JSON.stringify(e))).record.controls,l=a.find(e=>"reference"===e.controlId);return l?l.accessLevel=(null==t?void 0:t.mandatory)?o.$7:o.rr:(null==t?void 0:t.mandatory)?a.push({sgId:0,resourceId:"",controlId:"".concat(r?r+".":"","reference"),accessLevel:(null==t?void 0:t.mandatory)?o.$7:o.rr}):(null==t?void 0:t.readOnly)?a.push({sgId:0,resourceId:"",controlId:"".concat(r?r+".":"","reference"),accessLevel:(null==t?void 0:t.readOnly)?o.rr:o.$7}):a=e.record.controls.filter(e=>"reference"!=e.controlId),n&&a.push({sgId:0,resourceId:"",controlId:"".concat(r?r+".":"","dtId"),accessLevel:o.$7}),{...e,record:{...e.record,controls:a}}},u=async(e,t,n)=>{let r,a;switch(n){case"dtId":let l=(0,d.m)("userData"),o=null==l?void 0:l.userId;a="_userId=".concat(o,"&_functionId=").concat(t),r=i.r.UserFunction.get;break;case"glbSysNumberRange":a="_recordId=".concat(t),r=i.r.SystemFunction.get;break;case"DocumentType":a="_dgId=".concat(t,"&_startAt=",0,"&_pageSize=",50),r=i.r.DocumentType.qry;break;case"DcTypNumberRange":a="_recordId=".concat(t),r=i.r.DocumentType.get;break;case"isExternal":a="_recordId=".concat(t),r=i.r.NumberRange.get;break;default:return null}return await s(e,r,a)},f=async function(e){let t,n,r,a,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,d=!(arguments.length>4)||void 0===arguments[4]||arguments[4],s=arguments.length>5?arguments[5]:void 0,f=void 0===o&&l&&await u(e,l,"dtId"),m=null==f?void 0:f.dtId,p="",g=!0;if(f&&void 0===o||"nraId"===o){if(m){let n=await u(e,m,"DcTypNumberRange");t=null==n?void 0:n.nraId,g=!((null==n?void 0:n.activeStatus)<0),t||(p="Assign the document type to a number range")}if((!m||!g)&&d&&l){var v;let t=await u(e,l,"DocumentType");a=(null==t?void 0:null===(v=t.list)||void 0===v?void 0:v.filter(e=>(null==e?void 0:e.activeStatus)===1).length)>0}}if(("nraId"===o||void 0===o)&&l){if((!m||m)&&!t||t&&!g){let n=await u(e,l,"glbSysNumberRange");(t=null==n?void 0:n.nraId)&&a&&(a=!1),g=!0}p=t||a?"":"Assign the system Function to a number range"}o>0&&!t&&(t=o),t&&g?(n={readOnly:null==(r=await u(e,t,"isExternal"))||!r.external,mandatory:null!=r&&!!r.external},i&&(i=await c(i,n,a,s))):!t&&i&&(i=await c(i,n,a,s));let y=s?"".concat(s,".reference"):"reference";return{dtId:m,resetReference:null==n?void 0:n.readOnly,dcTypeRequired:a,reference:{fieldName:y,isEmpty:(null==r?void 0:r.external)!==void 0&&(null==r||!r.external)},errorMessage:p,maxAccess:i,selectNraId:o}};var m=n(65950);function p(e){let{functionId:t,action:n,hasDT:r}=e,{getRequest:i}=(0,a.useContext)(m.$),{stack:o}=(0,l.V)();return{proxyAction:async()=>{let e=await f(i,t,"",void 0,r);(null==e?void 0:e.errorMessage)?o({message:null==e?void 0:e.errorMessage}):await n()}}}function g(e){var t;let{functionId:n,access:i,hasDT:o,enabled:d=!0,objectName:s=""}=e,{getRequest:c}=(0,a.useContext)(m.$),{stack:u}=(0,l.V)(),[p,g]=(0,a.useState)(),v=async e=>{let t=await f(c,n,i,e,o,s);if(!t.errorMessage)return t;u({message:null==t?void 0:t.errorMessage})},y=(0,r.a)({retry:!1,staleTime:0,enabled:d,queryKey:[n,p,!!i,d],queryFn:p||"nraId"===p?()=>v(p):()=>v()});return{documentType:y.data,maxAccess:(null==y?void 0:null===(t=y.data)||void 0===t?void 0:t.maxAccess)||i,changeDT(e){g((null==e?void 0:e.nraId)||"nraId")}}}},9657:function(e,t,n){"use strict";var r=n(52322),a=n(2784),l=n(60218),i=n(62202),o=n(33625),d=n(62362),s=n(31389),c=n(27723),u=n(5088),f=n(69387),m=n(39812),p=n(65950),g=n(38449),v=n(96026),y=n(21326),h=n(19473),x=n(54074),I=n(69627);let w=e=>{let[t,n,r]=e.split("/").map(e=>parseInt(e,10));return new Date(Date.UTC(r<100?2e3+r:r,n-1,t,0,0,0)).toISOString().split(".")[0]+"Z"},N=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(""===e)return e;switch(t){case 2:return parseInt(e,10);case 3:return parseFloat(e);case 5:return n?w(e):(0,m.L6)((0,m.p6)(e));default:return e}},C=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=e.split("\n").filter(e=>e.trim());if(!r.length)return{count:0,list:[]};let a=r[0].split(",").map(e=>e.trim()),l=t.reduce((e,t)=>(e[t.headerName]=t,e),{}),i=a.map(e=>l[e]),o=r.slice(1).map((e,t)=>{let r=e.split(",").map(e=>e.trim()),l=i.reduce((e,t,n)=>{let l=a[n];return t?e[t.field]=N(r[n],t.dataType):e[l]=r[n],e},{recordId:t+1});return n.forEach(e=>{a.includes(e.field),l[e.field]=e.value}),l.minPrice&&(l.minPrice=parseFloat(l.minPrice)||0),l});return{count:o.length,list:o}},b=(e,t,n)=>{let r=t.filter(e=>e.mandatory),a=[...new Set(e.flatMap(e=>r.filter(t=>null===e[t.field]||void 0===e[t.field]||""===e[t.field]).map(e=>e.headerName)))];return!a.length||(n({message:"".concat(a.join(", ")," ").concat(a.length>1?"are":"is"," mandatory.")}),!1)},S=(e,t,n)=>{let r=t.filter(e=>e.mandatory),a=e.list.flatMap(e=>r.filter(t=>null===e[t.field]||void 0===e[t.field]||""===e[t.field]).map(e=>e.headerName));if(a.length>0){let e=[...new Set(a)];n({message:"".concat(e.join(", ")," ").concat(e.length>1?"are":"is"," mandatory field").concat(e.length>1?"s":"",".")})}return e.list.map(e=>Object.keys(e).reduce((n,r)=>{let a=t.find(e=>e.field===r),l=e[r];return l=""===l?null:l,n[r]=a?N(l,a.dataType,!0):l,n},{}))},_=e=>{var t;let{staticColumns:n=[],onSuccess:m,resourceId:w,access:N,window:_}=e,{stack:k}=(0,v.V)(),{getRequest:T,postRequest:j}=(0,a.useContext)(p.$),{platformLabels:Z}=(0,a.useContext)(h.l),[A,O]=(0,a.useState)(null),[D,P]=(0,a.useState)({count:0,list:[]}),[E,F]=(0,a.useState)(null),L=(0,a.useRef)(null);if((0,y.Z)({title:Z.import,window:_}),(0,a.useEffect)(()=>{w&&T({extension:g.r.ETL.get,parameters:"_resourceId=".concat(w)}).then(e=>{e.record&&O(e)})},[w]),!(null==A?void 0:A.record))return null;let R=(null===(t=A.record.fields)||void 0===t?void 0:t.map(e=>{let{name:t,dataType:n,format:r,...a}=e;return{field:t,headerName:t,width:130,type:2===n&&"1"===r||3===n?"number":void 0,dataType:n,...a}}))||[],W=R.map(e=>e.field),q=[...n.filter(e=>!W.includes(e.field)).map(e=>({field:e.field,headerName:e.field,width:130,dataType:1,readOnly:!0})),...R],$=A.record.objectName,J=A.record.endPoint,M=async()=>{let e=b(D.list,q,k),t=S(D,q,k);if(!e)return;let n=await j({extension:J,record:JSON.stringify({[$]:t})});null==m||m(n),i.ZP.success(Z.Imported),_&&_.close()},z=[{key:"Import",condition:!0,onClick:M,disabled:!(null==E?void 0:E.name)}];return(0,r.jsx)(x.Z,{onSave:M,disabledSubmit:!(null==E?void 0:E.name),isSaved:!1,actions:z,maxAccess:N,isParentWindow:!1,children:(0,r.jsxs)(s.R,{children:[(0,r.jsx)(o.g,{children:(0,r.jsx)(c.Z,{leftSection:(0,r.jsx)(l.ZP,{container:!0,spacing:2,alignItems:"center",children:(0,r.jsx)(l.ZP,{item:!0,xs:4,children:(0,r.jsxs)(l.ZP,{item:!0,sx:{display:"flex",mr:2},children:[(0,r.jsx)(u.Z,{name:"name",label:null==Z?void 0:Z.SelectCSV,value:null==E?void 0:E.name,readOnly:!0,disabled:!!(null==E?void 0:E.name)}),(0,r.jsx)(I.Z,{label:"".concat(null==Z?void 0:Z.Browse,"..."),disabled:!!(null==E?void 0:E.name),onClick:()=>L.current.click(),style:{marginLeft:2}}),(0,r.jsx)("input",{type:"file",accept:".csv",ref:L,style:{display:"none"},onChange:e=>{let t=e.target.files[0];if(F(t),t){let e=new FileReader;e.onload=e=>{P(C(e.target.result,q,n))},e.readAsText(t)}}}),(0,r.jsx)(I.Z,{image:"clear.png",tooltipText:null==Z?void 0:Z.Clear,onClick:()=>{F(null),P({count:0,list:[]}),L.current&&(L.current.value=null)},style:{marginLeft:2,backgroundColor:"#f44336",padding:0}})]})})})})}),(0,r.jsx)(d.Q,{children:(0,r.jsx)(f.Z,{name:"import",columns:[{field:"recordId",headerName:"",width:130},...q],gridData:D,rowId:["recordId"],isLoading:!1,pageSize:50,paginationType:"api",pagination:!1,maxAccess:N,textTransform:!0})})]})})};_.width=1e3,_.height=600,t.Z=_}},function(e){e.O(0,[92515,2494,36908,84622,49774,92888,40179],function(){return e(e.s=32194)}),_N_E=e.O()}]);