(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8344],{78604:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/fo-metal-setting",function(){return a(45147)}])},45147:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return F}});var s=a(52322),l=a(2784),r=a(71987),n=a(65950),o=a(69387),d=a(62202),i=a(61802),c=a(26612),u=a(31389),m=a(33625),p=a(62362),I=a(19473),v=a(36773),h=a(27723),b=a(29326),x=a(9522),g=a(60218),f=a(48601),C=a(82737),_=a(80983),y=a(8661),S=a(65215),A=a(91406),T=a(27423);function j(e){var t,a;let{labels:o,maxAccess:i,store:m,setStore:h,window:b}=e,{platformLabels:x}=(0,l.useContext)(I.l),{recordId:j,metalColorId:q}=m,{getRequest:M,postRequest:R}=(0,l.useContext)(n.$),Z=(0,r.E)({endpointId:v.B.MetalSettings.page}),{formik:F}=(0,_.c)({initialValues:{recordId:null,metalId:null,metalColorId:null,rate:"",stdLossRate:"",rmItemId:null,sfItemId:null},maxAccess:i,validateOnChange:!0,validationSchema:f.Ry({metalId:f.Z_().required(),metalColorId:f.Z_().required(),rate:f.Rx().required()}),onSubmit:async e=>{if(await R({extension:v.B.MetalSettings.set,record:JSON.stringify(e)}),!e.recordId){var t,a;F.setFieldValue("recordId",e.metalId);let s=await M({extension:v.B.Scrap.qry,parameters:"_metalId=".concat(null===(t=F.values)||void 0===t?void 0:t.metalId,"&_metalColorId=").concat(null===(a=F.values)||void 0===a?void 0:a.metalColorId)});h(e=>{var t,a;return{...e,recordId:null===(t=F.values)||void 0===t?void 0:t.metalId,metalColorId:null===(a=F.values)||void 0===a?void 0:a.metalColorId,scrap:s.list.map((e,t)=>({...e,scrapItemId:e.scrapItemId,id:t+1}))}})}d.ZP.success(e.recordId?x.Edited:x.Added),Z(),b.close()}}),P=!!F.values.recordId;return(0,l.useEffect)(()=>{!async function(){if(j&&q){let e=await M({extension:v.B.MetalSettings.get,parameters:"_metalId=".concat(j,"&_metalColorId=").concat(q)});F.setValues({...e.record,recordId:e.record.metalId})}}()},[]),(0,s.jsx)(C.Z,{resourceId:c.i.MetalSettings,form:F,maxAccess:i,editMode:P,isInfo:!1,children:(0,s.jsx)(u.R,{children:(0,s.jsx)(p.Q,{children:(0,s.jsxs)(g.ZP,{container:!0,spacing:2,children:[(0,s.jsx)(g.ZP,{item:!0,xs:12,children:(0,s.jsx)(y.Z,{endpointId:S.$.Metals.qry,name:"metalId",label:o.metal,valueField:"recordId",displayField:"reference",readOnly:P,values:F.values,onChange:(e,t)=>{F.setFieldValue("metalId",null==t?void 0:t.recordId)},required:!0,error:F.touched.metalId&&!!F.errors.metalId,maxAccess:i})}),(0,s.jsx)(g.ZP,{item:!0,xs:12,children:(0,s.jsx)(y.Z,{endpointId:S.$.Items.pack,values:F.values,reducer:e=>{var t;return null==e?void 0:null===(t=e.record)||void 0===t?void 0:t.metalColors},name:"metalColorId",label:o.metalColor,readOnly:P,valueField:"recordId",displayField:"reference",displayFieldWidth:1,required:!0,maxAccess:i,onChange:(e,t)=>{F.setFieldValue("metalColorId",null==t?void 0:t.recordId)},error:F.touched.metalColorId&&F.errors.metalColorId})}),(0,s.jsx)(g.ZP,{item:!0,xs:12,children:(0,s.jsx)(A.Z,{name:"rate",label:o.rate,value:null===(t=F.values)||void 0===t?void 0:t.rate,required:!0,onChange:F.handleChange,onClear:()=>F.setFieldValue("rate",""),maxAccess:i,error:F.touched.rate&&!!F.errors.rate})}),(0,s.jsx)(g.ZP,{item:!0,xs:12,children:(0,s.jsx)(A.Z,{name:"stdLossRate",label:o.stdLossRate,value:null===(a=F.values)||void 0===a?void 0:a.stdLossRate,onChange:F.handleChange,onClear:()=>F.setFieldValue("stdLossRate",""),maxAccess:i,error:F.touched.stdLossRate&&!!F.errors.stdLossRate})}),(0,s.jsx)(g.ZP,{item:!0,xs:12,children:(0,s.jsx)(T.U,{endpointId:S.$.RMSKU.snapshot,name:"rmItemId",label:o.RMSKU,valueField:"sku",displayField:"name",valueShow:"rmItemSku",secondValueShow:"rmItemName",form:F,onChange:(e,t)=>{F.setFieldValue("rmItemId",null==t?void 0:t.recordId),F.setFieldValue("rmItemSku",null==t?void 0:t.sku),F.setFieldValue("rmItemName",null==t?void 0:t.name)},error:F.touched.rmItemId&&!!F.errors.rmItemId,maxAccess:i})}),(0,s.jsx)(g.ZP,{item:!0,xs:12,children:(0,s.jsx)(T.U,{endpointId:S.$.SFSKU.snapshot,name:"sfItemId",label:o.SFSKU,valueField:"sku",displayField:"name",valueShow:"sfItemSku",secondValueShow:"sfItemName",form:F,onChange:(e,t)=>{F.setFieldValue("sfItemId",null==t?void 0:t.recordId),F.setFieldValue("sfItemSku",null==t?void 0:t.sku),F.setFieldValue("sfItemName",null==t?void 0:t.name)},error:F.touched.sfItemId&&!!F.errors.sfItemId,maxAccess:i})})]})})})})}var q=a(76399),M=a(54074),R=e=>{let{store:t,maxAccess:a,labels:r}=e,{recordId:o,metalColorId:i}=t,{getRequest:c,postRequest:m}=(0,l.useContext)(n.$),{platformLabels:h}=(0,l.useContext)(I.l),{formik:b}=(0,_.c)({validateOnChange:!0,maxAccess:a,validationSchema:f.Ry({scrap:f.IX().of(f.Ry().shape({sku:f.Z_().required()})).required()}),initialValues:{scrap:(null==t?void 0:t.scrap.length)>0?t.scrap:[{id:1,metalId:o,seqNo:"",sku:"",itemName:"",scrapItemId:""}]},onSubmit:async e=>{let t=null==e?void 0:e.scrap.map(e=>{let{id:t,...a}=e;return{...a,metalId:o,metalColorId:i,scrapItemId:a.scrapItemId,seqNo:t}}),a=await m({extension:v.B.Scrap.set2,record:JSON.stringify({metalId:o,metalColorId:i,metalScraps:t})});d.ZP.success(h.Updated),b.setFieldValue("recordId",a.recordId)}});(0,l.useEffect)(()=>{!async function(){if(o&&i){var e;let t=await c({extension:v.B.Scrap.qry,parameters:"_metalId=".concat(o,"&_metalColorId=").concat(i)});if((null==t?void 0:null===(e=t.list)||void 0===e?void 0:e.length)>0){let e=t.list.map((e,t)=>({...e,scrapItemId:e.scrapItemId,id:t+1}));b.setFieldValue("scrap",e)}}}()},[]);let x=[{component:"resourcelookup",label:r.sku,name:"sku",props:{endpointId:S.$.Item.snapshot,valueField:"recordId",displayField:"sku",mapping:[{from:"recordId",to:"itemId"},{from:"sku",to:"sku"},{from:"name",to:"itemName"},{from:"recordId",to:"scrapItemId"}],columnsInDropDown:[{key:"sku",value:"SKU"},{key:"name",value:"Name"}],displayFieldWidth:1}},{component:"textfield",label:r.itemName,name:"itemName",props:{readOnly:!0}}];return(0,s.jsx)(M.Z,{onSave:b.handleSubmit,maxAccess:a,editMode:!!o,isParentWindow:!1,children:(0,s.jsx)(u.R,{children:(0,s.jsx)(p.Q,{children:(0,s.jsx)(q._,{onChange:e=>b.setFieldValue("scrap",e),value:b.values.scrap,error:b.errors.scrap,columns:x,name:"scrap",maxAccess:a})})})})},Z=e=>{let{recordId:t,metalColorId:a,labels:r,maxAccess:n,window:o}=e,[d,i]=(0,l.useState)(0),[c,u]=(0,l.useState)({recordId:t||null,metalColorId:a||null,scrap:[]}),m=[{label:r.MetalSettings},{label:r.Scrap,disabled:!c.recordId}];return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(x.Y,{tabs:m,activeTab:d,setActiveTab:i,maxAccess:n}),(0,s.jsx)(b.Z,{index:0,value:d,maxAccess:n,children:(0,s.jsx)(j,{labels:r,setStore:u,store:c,access:n,window:o})}),(0,s.jsx)(b.Z,{index:1,value:d,maxAccess:n,children:(0,s.jsx)(R,{labels:r,store:c,maxAccess:n})})]})},F=()=>{let{postRequest:e,getRequest:t}=(0,l.useContext)(n.$),{platformLabels:a}=(0,l.useContext)(I.l),{stack:b}=(0,i.zY)();async function x(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{_startAt:a=0,_pageSize:s=50}=e;return{...await t({extension:v.B.MetalSettings.page,parameters:"_startAt=".concat(a,"&_pageSize=").concat(s,"&_filter=")}),_startAt:a}}let{query:{data:g},refetch:f,labels:C,access:_,paginationParameters:y,invalidate:S}=(0,r.J)({queryFn:x,endpointId:v.B.MetalSettings.page,datasetId:c.i.MetalSettings}),A=[{field:"metalRef",headerName:C.metal,flex:1},{field:"metalColorRef",headerName:C.metalColor,flex:1},{field:"rate",headerName:C.rate,flex:1,type:"number"},{field:"stdLossRate",headerName:C.stdLossRate,flex:1,type:"number"}],T=async()=>{j()};async function j(e){b({Component:Z,props:{labels:C,metalColorId:null==e?void 0:e.metalColorId,recordId:null==e?void 0:e.metalId,maxAccess:_},width:800,height:500,title:C.MetalSettings})}let q=async t=>{await e({extension:v.B.MetalSettings.del,record:JSON.stringify(t)}),S(),d.ZP.success(a.Deleted)};return(0,s.jsxs)(u.R,{children:[(0,s.jsx)(m.g,{children:(0,s.jsx)(h.Z,{onAdd:T,maxAccess:_,labels:C})}),(0,s.jsx)(p.Q,{children:(0,s.jsx)(o.Z,{columns:A,gridData:g,rowId:["metalId"],onEdit:e=>{j(e)},refetch:f,onDelete:q,isLoading:!1,pageSize:50,maxAccess:_,paginationParameters:y,paginationType:"api"})})]})}},36773:function(e,t,a){"use strict";a.d(t,{B:function(){return l}});let s="FO.asmx/",l={WorkCenter:{page:s+"pageWCT",qry:s+"qryWCT",set:s+"setWCT",get:s+"getWCT",del:s+"delWCT"},Wax:{page:s+"pageWAX",snapshot:s+"snapshotWAX",set:s+"setWAX",set2:s+"set2WAX",get:s+"getWAX",del:s+"delWAX",post:s+"postWAX",unpost:s+"unpostWAX",close:s+"closeWAX",open:s+"openWAX",reopen:s+"reopenWAX"},WaxJob:{qry:s+"qryWAJ",qry2:s+"qry2WAJ"},Mould:{qry:s+"qryMOU",qry2:s+"qry2MOU",page:s+"pageMOU",set:s+"setMOU",get:s+"getMOU",del:s+"delMOU",snapshot:s+"snapshotMOU"},MetalSettings:{page:s+"pageMTS",set:s+"setMTS",get:s+"getMTS",del:s+"delMTS"},Scrap:{qry:s+"qryMSC",set2:s+"set2MSC"},JobWaxInquiry:{qry2:s+"qry2WAJ"},Casting:{page:s+"pageCAS",get:s+"getCAS",set:s+"setCAS",del:s+"delCAS",cancel:s+"cancelCAS",post:s+"postCAS",snapshot:s+"snapshotCAS"},CastingDisassembly:{qry:s+"qryCDA",set2:s+"set2CDA"},MetalScrap:{qry:s+"qryMSC"},CastingJob:{qry:s+"qryCAJ",set2:s+"set2CAJ"},FoundaryTransaction:{get:s+"getTRX",get2:s+"get2TRX",del:s+"delTRX",set2:s+"set2TRX",page:s+"pageTRX",snapshot:s+"snapshotTRX",post:s+"postTRX",unpost:s+"unpostTRX"},AlloyMetals:{page:s+"pageALM",set:s+"setALM",get:s+"getALM",del:s+"delALM",qry:s+"qryALM"},SmeltingScrapItem:{qry:s+"qrySMSI",set2:s+"set2SMSI"},DocumentTypeDefault:{page:s+"pageDTD",set:s+"setDTD",get:s+"getDTD",del:s+"delDTD"},PurityAdjustment:{combos:s+"getPackPADJ",get2:s+"get2PADJ",del:s+"delPADJ",set2:s+"set2PADJ",page:s+"pagePADJ",snapshot:s+"snapshotPADJ",post:s+"postPADJ",unpost:s+"unpostPADJ"}}},29326:function(e,t,a){"use strict";var s=a(52322);a(2784);var l=a(23925),r=a(13980),n=a.n(r),o=a(95291),d=a.n(o),i=a(65947);let c=e=>{var t,a,r;let{children:n,value:o,index:c,maxAccess:u,...m}=e,p="".concat(e.name||"tab",".").concat(c),{accessLevel:I}=null!==(r=(null!==(a=null==u?void 0:null===(t=u.record)||void 0===t?void 0:t.controls)&&void 0!==a?a:[]).find(e=>e.controlId===p))&&void 0!==r?r:{accessLevel:0};if(I===i.A1)return null;let v=o===c;return(0,s.jsx)(l.Z,{role:"tabpanel",hidden:!v,id:"simple-tabpanel-".concat(c),"aria-labelledby":"simple-tab-".concat(c),className:"".concat(d().tabPanel," ").concat(v?d().active:d().hidden),...m,children:n})};c.propTypes={children:n().node,index:n().number.isRequired,value:n().number.isRequired},t.Z=c},9522:function(e,t,a){"use strict";a.d(t,{Y:function(){return m}});var s=a(52322),l=a(23925),r=a(54582),n=a(68696),o=a(44258),d=a(2784),i=a(99266),c=a(52614),u=a.n(c);let m=e=>{var t,a,c,m,p;let{tabs:I,activeTab:v,setActiveTab:h,maxAccess:b,name:x="tab"}=e,g=(null==b?void 0:null===(a=b.record)||void 0===a?void 0:null===(t=a.controls)||void 0===t?void 0:t.filter(e=>{var t;return 4===e.accessLevel&&(null===(t=e.controlId)||void 0===t?void 0:t.startsWith("".concat(x,".")))}).map(e=>e.controlId.split(".")[1]))||[],f=null==I?void 0:null===(c=I.map((e,t)=>({...e,id:t})))||void 0===c?void 0:c.filter((e,t)=>!g.includes(String(t))),C=null===(m=f[v])||void 0===m?void 0:m.id,_=null===(p=f[v])||void 0===p?void 0:p.disabled;return(0,d.useEffect)(()=>{C>=0&&!_&&v!=C&&h(C)},[]),(0,s.jsx)(l.Z,{className:u().tabsContainer,children:(0,s.jsx)(l.Z,{className:u().tabsWrapper,children:(0,s.jsx)(r.Z,{value:v,onChange:(e,t)=>h(t),variant:"scrollable",scrollButtons:f.length>3?"auto":"off","aria-label":"scrollable tabs",classes:{indicator:u().tabsIndicator},className:u().tabs,children:null==f?void 0:f.map(e=>(0,s.jsx)(n.Z,{value:e.id,disabled:null==e?void 0:e.disabled,className:"".concat(u().tabName," ").concat(e.disabled?u().tabDisabled:""),classes:{root:u().tabRoot,selected:u().selectedTab},label:(0,s.jsxs)(l.Z,{display:"flex",alignItems:"center",children:[(0,s.jsx)("span",{children:e.label}),e.id===v&&(null==e?void 0:e.onRefetch)&&(0,s.jsx)(o.Z,{size:"small",className:u().refreshButton,onClick:t=>{t.stopPropagation(),e.onRefetch()},children:(0,s.jsx)(i.Z,{className:u().refreshIcon})})]})},e.id))})})})}},95291:function(e){e.exports={tabPanel:"CustomTabPanel_tabPanel__80Dfu",active:"CustomTabPanel_active___6Uvb",hidden:"CustomTabPanel_hidden__y9566"}},52614:function(e){e.exports={customTabPanel:"CustomTabs_customTabPanel__Ztocv",hidden:"CustomTabs_hidden__lZpM7",tabsContainer:"CustomTabs_tabsContainer__28Syi",tabsWrapper:"CustomTabs_tabsWrapper__mlxxj",tabs:"CustomTabs_tabs__25pli",tabName:"CustomTabs_tabName__XzMCn",tabRoot:"CustomTabs_tabRoot__WVR1E",tabDisabled:"CustomTabs_tabDisabled__VauYR",selectedTab:"CustomTabs_selectedTab__sZzwF",tabsIndicator:"CustomTabs_tabsIndicator__89Lek",refreshButton:"CustomTabs_refreshButton__P2mzl",refreshIcon:"CustomTabs_refreshIcon__ADVWF"}}},function(e){e.O(0,[49774,92888,40179],function(){return e(e.s=78604)}),_N_E=e.O()}]);