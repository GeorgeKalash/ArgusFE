(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4239],{38395:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/physical-count-item",function(){return s(3172)}])},3172:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return S}});var l=s(52322),i=s(31389),n=s(62362),o=s(69387),a=s(2784),r=s(65950),d=s(26612),c=s(33625),u=s(60218),I=s(19473),m=s(71987),C=s(8661),p=s(76426),y=s(82737),h=s(91406),g=s(80983),x=s(48601),f=s(32025),v=s(61802),k=s(69627),S=()=>{var e;let{getRequest:t}=(0,a.useContext)(r.$),{platformLabels:s}=(0,a.useContext)(I.l),[S,T]=(0,a.useState)([]),[q,D]=(0,a.useState)([]),{stack:R}=(0,v.zY)(),{labels:P,refetch:j,access:L}=(0,m.J)({queryFn:_,endpointId:p.x.StockCountItem.qry,datasetId:d.i.IVPhysicalCountItem}),{formik:Z}=(0,g.c)({initialValues:{stockCountId:"",siteId:"",totalCostPrice:"",totalWeight:""},maxAccess:L,validateOnChange:!0,validationSchema:x.Ry({stockCountId:x.Z_().required(),siteId:x.Z_().required()})});async function _(){var e,s;if(!Z.values.stockCountId||!Z.values.siteId)return;let l=await t({extension:p.x.StockCountItem.qry,parameters:"_stockCountId=".concat(null===(e=Z.values)||void 0===e?void 0:e.stockCountId,"&_siteId=").concat(null===(s=Z.values)||void 0===s?void 0:s.siteId)}),i=0,n=0;l.list.map(e=>{i+=e.currentCost||0,n+=e.weight||0}),Z.setFieldValue("totalCostPrice",i),Z.setFieldValue("totalWeight",n),T(l||{list:[]})}let w=(null==S?void 0:null===(e=S.list)||void 0===e?void 0:e.length)>0,N=e=>{D([]),t({extension:p.x.Sites.qry,parameters:"_stockCountId=".concat(e)}).then(e=>{D(e.list.filter(e=>!0==e.isChecked))})},H=[{field:"sku",headerName:P.sku,flex:1},{field:"itemName",headerName:P.itemName,flex:1},{field:"countedQty",headerName:P.qty,flex:1},{field:"systemQty",headerName:P.system,flex:1},{field:"varianceQty",headerName:P.variation,flex:1},{field:"currentCost",headerName:P.costPrice,flex:1},{field:"weight",headerName:P.weight,flex:1}];(0,a.useEffect)(()=>{!async function(){await _()}()},[Z.values.stockCountId,Z.values.siteId]);let b=async()=>{var e;return(null==S?void 0:null===(e=S.list)||void 0===e?void 0:e.filter(e=>e.metalId).map(e=>({qty:e.countedQty,metalRef:"",metalId:e.metalId,metalPurity:e.metalPurity,weight:e.weight,priceType:e.priceType})))||[]};return(0,l.jsx)(y.Z,{form:Z,isInfo:!1,isSaved:!1,isCleared:!1,isSavedClear:!1,actions:[{key:"Metals",condition:!0,onClick:"onClickMetal",handleMetalClick:b}],maxAccess:L,resourceId:d.i.IVPhysicalCountItem,previewReport:w,children:(0,l.jsxs)(i.R,{children:[(0,l.jsx)(c.g,{children:(0,l.jsxs)(u.ZP,{container:!0,spacing:2,children:[(0,l.jsx)(u.ZP,{item:!0,xs:2,children:(0,l.jsx)(C.Z,{endpointId:p.x.StockCount.qry,parameters:"_startAt=0&_pageSize=1000&_params=",name:"stockCountId",label:P.stockCount,valueField:"recordId",displayField:"reference",values:Z.values,required:!0,readOnly:Z.values.siteId,maxAccess:L,onChange:(e,t)=>{Z.setFieldValue("stockCountId",null==t?void 0:t.recordId),Z.setFieldValue("siteId",""),t?N(null==t?void 0:t.recordId):D([])},error:Z.touched.stockCountId&&!!Z.errors.stockCountId})}),(0,l.jsx)(u.ZP,{item:!0,xs:2,children:(0,l.jsx)(C.Z,{name:"siteId",store:q,label:P.site,valueField:"siteId",displayField:["siteRef","siteName"],columnsInDropDown:[{key:"siteRef",value:"Reference"},{key:"siteName",value:"Name"}],values:Z.values,required:!0,readOnly:Z.values.siteId,onChange:(e,t)=>{Z.setFieldValue("siteId",null==t?void 0:t.siteId)},error:Z.touched.siteId&&!!Z.errors.siteId,maxAccess:L})}),(0,l.jsx)(u.ZP,{item:!0,xs:2,children:(0,l.jsx)(k.Z,{image:"clear.png",tooltipText:s.Clear,onClick:function(){R({Component:f.Z,props:{open:{flag:!0},fullScreen:!1,dialogText:s.ClearFormGrid,onConfirm:()=>{Z.resetForm(),T({list:[]}),D([])}}})},style:{backgroundColor:"#f44336"}})})]})}),(0,l.jsx)(n.Q,{children:(0,l.jsx)(o.Z,{columns:H,gridData:null!=S?S:{list:[]},rowId:["recordId"],isLoading:!1,pageSize:50,refetch:j,paginationType:"api",pagination:!1,maxAccess:L,textTransform:!0})}),(0,l.jsx)(c.g,{children:(0,l.jsxs)(u.ZP,{container:!0,justifyContent:"flex-end",spacing:2,sx:{pt:5},children:[(0,l.jsx)(u.ZP,{item:!0,xs:2,children:(0,l.jsx)(h.Z,{name:"totalCostPrice",label:P.totalCostPrice,value:Z.values.totalCostPrice,readOnly:!0,hidden:!(Z.values.stockCountId&&Z.values.siteId),maxAccess:L})}),(0,l.jsx)(u.ZP,{item:!0,xs:2,children:(0,l.jsx)(h.Z,{name:"totalWeight",label:P.totalWeight,value:Z.values.totalWeight,readOnly:!0,hidden:!(Z.values.stockCountId&&Z.values.siteId),maxAccess:L})})]})})]})})}},76426:function(e,t,s){"use strict";s.d(t,{x:function(){return i}});let l="SC.asmx/",i={LabelTemplate:{qry:l+"qryLBT",set:l+"setLBT",get:l+"getLBT",del:l+"delLBT"},Item:{qry:l+"qryLBI",set:l+"setLBI",get:l+"getLBI",del:l+"delLBI"},Sites:{qry:l+"qrySIT",set:l+"setSIT",set2:l+"set2SIT",get:l+"getSIT",del:l+"delSIT",reopen:l+"reopenSIT",end:l+"endSIT"},Controller:{qry:l+"qryCRL"},StockCountControllerTab:{qry:l+"qryPHY",set2:l+"set2PHY",set:l+"setPHY",get:l+"getPHY",del:l+"delPHY"},StockCount:{page:l+"pageHDR",post:l+"postHDR",unpost:l+"unpostHDR",qry:l+"qryHDR",get:l+"getHDR",set:l+"setHDR",del:l+"delHDR",close:l+"closeHDR",reopen:l+"reopenHDR",snapshot:l+"snapshotHDR"},StockCountController:{page:l+"pageCRL",set:l+"setCRL",get:l+"getCRL",del:l+"delCRL"},DocumentTypeDefaults:{qry:l+"qryDTD",set:l+"setDTD",get:l+"getDTD",del:l+"delDTD"},StockCountItem:{qry:l+"qryITM",set:l+"setITM",get:l+"getITM",del:l+"delITM"},StockCountSerialSum:{qry:l+"qrySRS"},StockCountItemDetail:{qry:l+"qryITD",set:l+"setITD",get:l+"getITD",del:l+"delITD",set2:l+"set2ITD"},StockCountSerialDetail:{set2:l+"set2SRL",qry:l+"qrySRL",append:l+"appendSRL",del:l+"delSRL",batch:l+"batchSRL"}}},32025:function(e,t,s){"use strict";var l=s(52322),i=s(2784),n=s(23361),o=s(19473),a=s(21326);let r=e=>{let{window:t,onConfirm:s,fullScreen:r,open:d,dialogText:c}=e,{platformLabels:u}=(0,i.useContext)(o.l);return(0,a.Z)({title:u.Clear,window:t}),(0,l.jsx)(n.Z,{open:null!=d&&!!d.flag&&(null==d?void 0:d.flag),DialogText:c,okButtonAction:()=>{"function"==typeof s&&s(),t.close()},fullScreen:r,cancelButtonAction:()=>t.close(),height:"140px"})};r.width=570,r.height=170,t.Z=r}},function(e){e.O(0,[49774,92888,40179],function(){return e(e.s=38395)}),_N_E=e.O()}]);