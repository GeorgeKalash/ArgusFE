(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[79825],{29616:function(e,a,l){(window.__NEXT_P=window.__NEXT_P||[]).push(["/hr-lr-one-or-more",function(){return l(17507)}])},17507:function(e,a,l){"use strict";l.r(a),l.d(a,{default:function(){return k}});var t=l(52322),n=l(2784),r=l(62202),d=l(69387),s=l(65950),i=l(26612),o=l(71987),u=l(61802),c=l(31389),v=l(33625),m=l(62362),y=l(36908),h=l(19473),f=l(50496),p=l(87559),x=l(60218),D=l(5088),I=l(8661),g=l(80983),w=l(48601),j=l(21326),F=l(89330),C=l(27423),_=l(92407),N=l(82737),V=l(39812),b=l(7121),R=l(91406),Z=l(28879),O=l.n(Z),q=l(50023),L=l(76399),A=l(96026);let P=e=>{var a,l,d,u,v,y;let{recordId:Z,window:P}=e,{postRequest:k,getRequest:E}=(0,n.useContext)(s.$),{platformLabels:B}=(0,n.useContext)(h.l),{stack:M}=(0,A.V)(),U=!!Z,{labels:S,access:T}=(0,q.Z)({datasetId:i.i.LeaveRequestODOM,editMode:U});(0,j.Z)({title:B.LeaveRequestODOM,window:P});let Y=(0,o.E)({endpointId:f.U.LeaveRequest.page}),{formik:J}=(0,g.c)({maxAccess:T,initialValues:{recordId:Z,startDate:new Date,endDate:new Date,date:new Date,employeeId:null,justification:"",reference:"",destination:"",ltId:null,isPaid:!1,status:1,employeeName:"",hours:null,leaveDays:null,leaveBalance:0,multiDayLeave:2,wip:1,items:[]},validationSchema:w.Ry({date:w.hT().required(),employeeId:w.Rx().required(),ltId:w.Rx().required(),startDate:w.hT().required(),endDate:w.hT().required(),destination:w.Z_().required(),items:w.IX().of(w.Ry({dayId:w.Z_().nullable(),hours:w.Rx().nullable().typeError().min(0).test("hours-not-greater-than-scheduled","Hours cannot be greater than scheduled hours",function(e){let{scheduledHours:a}=this.parent;return null==e||null==a||e<=a})}))}),onSubmit:async e=>{let{items:a,...l}=e,t={leave:{...l},leaveDays:a.map(a=>({...a,leaveId:e.recordId?e.recordId:0,dayId:O()(new Date(a.dayId)).format("YYYYMMDD")}))||[]},n=await k({extension:f.U.LeaveRequest.set2,record:JSON.stringify(t)});await Q(n.recordId),r.ZP.success(e.recordId?B.Edited:B.Added),Y()}}),z=async(e,a,l,t)=>{var n,r,d,s,i;if(!a||!l){J.setFieldValue("leaveBalance",0);return}let o=await E({extension:_.y.Leaves.get,parameters:"_ltId=".concat(l,"&_employeeId=").concat(a)}),u=null==o?void 0:null===(n=o.record)||void 0===n?void 0:n.lsId;if(!u){J.setFieldValue("leaveBalance",0);return}let c=await E({extension:f.U.Leaves.qry,parameters:"_recordId=".concat(e,"&_employeeId=").concat(a,"&_lsId=").concat(u,"&_asOfDate=").concat(t?(0,V.jW)(t):(0,V.jW)(new Date))});J.setFieldValue("leaveBalance",null!==(i=null==c?void 0:null===(s=c.list)||void 0===s?void 0:null===(d=s[0])||void 0===d?void 0:null===(r=d.summary)||void 0===r?void 0:r.balance)&&void 0!==i?i:0)},X=2==J.values.wip,H=[{component:"textfield",label:S.date,name:"dayId",props:{readOnly:!0},flex:2},{component:"textfield",label:S.leaveDayType,name:"ldtName",props:{readOnly:!0},flex:1.5},{component:"numberfield",label:S.hours,name:"hours",flex:1,props:{maxLength:12,decimalScale:2}}],Q=async e=>{var a,l,t,n,r,d;if(!e)return;let s=await E({extension:f.U.LeaveRequest.get2,parameters:"_recordId=".concat(e)});J.setValues({...s.record.leave,date:s.record.leave.date?(0,V.a1)(s.record.leave.date):null,startDate:s.record.leave.startDate?(0,V.a1)(s.record.leave.startDate):null,endDate:s.record.leave.endDate?(0,V.a1)(s.record.leave.endDate):null,items:s.record.leaveDays.map((e,a)=>({...e,dayId:(0,V.u3)(e.dayId),id:a}))||[]}),z(e,null==s?void 0:null===(l=s.record)||void 0===l?void 0:null===(a=l.leave)||void 0===a?void 0:a.employeeId,null==s?void 0:null===(n=s.record)||void 0===n?void 0:null===(t=n.leave)||void 0===t?void 0:t.ltId,(0,V.a1)(null==s?void 0:null===(d=s.record)||void 0===d?void 0:null===(r=d.leave)||void 0===r?void 0:r.date))},W=async()=>{let{items:e,...a}=J.values,l=await k({extension:f.U.LeaveRequest.close,record:JSON.stringify(a)});r.ZP.success(B.Closed),Y(),Q(l.recordId)},$=async()=>{let{items:e,...a}=J.values,l=await k({extension:f.U.LeaveRequest.reopen,record:JSON.stringify(a)});r.ZP.success(B.Reopened),Y(),Q(l.recordId)};async function G(){if(Object.keys(await J.validateForm()).length){let e=Object.keys(await J.validateForm()).reduce((e,a)=>(J.touched[a]||(e[a]=!0),e),{});Object.keys(e).length&&J.setTouched(e,!0)}}let K=e=>{let a=0,l=0;return e.forEach(e=>{let t=parseFloat(e.hours)||0,n=parseFloat(e.scheduledHours)||0;if(a+=t,n>0){let e=t/n;isNaN(e)||(l+=e)}}),{totalHours:a,totalDays:l}},ee=async()=>{let{startDate:e,endDate:a,employeeId:l,ltId:t}=J.values,n=(0,p.Z)(new Date(e),"yyyyMMdd"),r=(0,p.Z)(new Date(a),"yyyyMMdd");if(!l||!t||!n||!r){await G();return}if(O()(a).diff(O()(e),"year",!0)>1){M({message:S.cannotExceedOneYear});return}let d=await E({extension:f.U.PreviewDays.preview,parameters:"_filter=&_size=30&_startAt=0&_employeeId=".concat(J.values.employeeId,"&_ltId=").concat(J.values.ltId,"&_fromDayId=").concat(n,"&_toDayId=").concat(r)});if(null==d?void 0:d.list){J.setFieldValue("items",d.list.map((e,a)=>({...e,dayId:(0,V.u3)(e.dayId),id:a+1})));let{totalHours:e,totalDays:a}=K(d.list);J.setFieldValue("hours",e),J.setFieldValue("leaveDays",a)}else J.setFieldValue("items",[]),J.setFieldValue("hours",null),J.setFieldValue("leaveDays",null)};(0,n.useEffect)(()=>{!async function(){U&&await ee(),Q(Z)}()},[]),(0,n.useEffect)(()=>{let{totalHours:e,totalDays:a}=K(J.values.items);J.setFieldValue("hours",e),J.setFieldValue("leaveDays",a)},[J.values.items]);let ea=[{key:"Close",condition:!X,onClick:W,disabled:X||!U},{key:"Reopen",condition:X,onClick:$,disabled:!X},{key:"Approval",condition:!0,onClick:"onApproval",disabled:!X},{key:"Preview",condition:!0,onClick:ee}];return(0,t.jsx)(N.Z,{resourceId:i.i.LeaveRequestODOM,functionId:b.J.LeaveRequest,actions:ea,form:J,maxAccess:T,editMode:U,previewReport:U,disabledSubmit:0===J.values.items.length||X,children:(0,t.jsx)(c.R,{children:(0,t.jsx)(m.Q,{children:(0,t.jsxs)(x.ZP,{container:!0,spacing:2,children:[(0,t.jsx)(x.ZP,{item:!0,xs:12,children:(0,t.jsx)(D.Z,{name:"reference",label:S.reference,value:null===(a=J.values)||void 0===a?void 0:a.reference,maxAccess:T,readOnly:!0,onChange:J.handleChange,onClear:()=>J.setFieldValue("reference",""),error:J.touched.reference&&!!J.errors.reference})}),(0,t.jsx)(x.ZP,{item:!0,xs:12,children:(0,t.jsx)(F.Z,{name:"date",label:S.date,value:null===(l=J.values)||void 0===l?void 0:l.date,readOnly:X,onChange:async(e,a)=>{var l,t;J.setFieldValue("date",a),await z(Z,null==J?void 0:null===(l=J.values)||void 0===l?void 0:l.employeeId,null==J?void 0:null===(t=J.values)||void 0===t?void 0:t.ltId,a)},onClear:()=>J.setFieldValue("date",null),error:J.touched.date&&!!J.errors.date,maxAccess:T})}),(0,t.jsx)(x.ZP,{item:!0,xs:12,children:(0,t.jsx)(C.U,{endpointId:_.y.Employee.snapshot,parameters:{_branchId:0},form:J,maxAccess:T,valueField:"reference",readOnly:X,displayField:"fullName",name:"employeeRef",label:S.employee,required:!0,secondValue:J.values.employeeName,onChange:async(e,a)=>{var l;J.setFieldValue("employeeRef",(null==a?void 0:a.reference)||""),J.setFieldValue("employeeName",(null==a?void 0:a.fullName)||""),J.setFieldValue("employeeId",(null==a?void 0:a.recordId)||null),await z(Z,null==a?void 0:a.recordId,null==J?void 0:null===(l=J.values)||void 0===l?void 0:l.ltId,J.values.date)},error:J.touched.employeeId&&!!J.errors.employeeId})}),(0,t.jsx)(x.ZP,{item:!0,xs:12,children:(0,t.jsx)(D.Z,{name:"justification",label:S.justification,value:null===(d=J.values)||void 0===d?void 0:d.justification,maxLength:512,readOnly:X,maxAccess:T,onChange:J.handleChange,onClear:()=>J.setFieldValue("justification",""),error:J.touched.justification&&!!J.errors.justification})}),(0,t.jsxs)(x.ZP,{item:!0,xs:6,sx:{display:"flex",flexDirection:"column",gap:2,paddingTop:3,overflowY:"auto"},children:[(0,t.jsx)(F.Z,{name:"startDate",label:S.startDate,value:null===(u=J.values)||void 0===u?void 0:u.startDate,max:J.values.endDate,onChange:J.setFieldValue,onClear:()=>J.setFieldValue("startDate",null),error:J.touched.startDate&&!!J.errors.startDate,maxAccess:T,readOnly:X}),(0,t.jsx)(F.Z,{name:"endDate",label:S.endDate,value:null===(v=J.values)||void 0===v?void 0:v.endDate,min:J.values.startDate,onChange:J.setFieldValue,onClear:()=>J.setFieldValue("endDate",null),error:J.touched.endDate&&!!J.errors.endDate,maxAccess:T,readOnly:X}),(0,t.jsx)(I.Z,{endpointId:f.U.IndemnityAccuralsFilters.qry,name:"ltId",label:S.leaveType,valueField:"recordId",displayField:"name",values:J.values,maxAccess:T,readOnly:X,required:!0,onChange:async(e,a)=>{var l;J.setFieldValue("hours",0),J.setFieldValue("leaveBalance",0),J.setFieldValue("leaveDays",0),await z(Z,null==J?void 0:null===(l=J.values)||void 0===l?void 0:l.employeeId,null==a?void 0:a.recordId,J.values.date),J.setFieldValue("ltId",(null==a?void 0:a.recordId)||null)},error:J.touched.ltId&&!!J.errors.ltId}),(0,t.jsx)(D.Z,{name:"destination",label:S.destination,value:null===(y=J.values)||void 0===y?void 0:y.destination,required:!0,readOnly:X,maxLength:50,maxAccess:T,onChange:J.handleChange,onClear:()=>J.setFieldValue("destination",""),error:J.touched.destination&&!!J.errors.destination}),(0,t.jsx)(R.Z,{name:"leaveBalance",label:S.leaveBalance,value:J.values.leaveBalance,readOnly:!0,maxAccess:T,onChange:J.handleChange,onClear:()=>J.setFieldValue("leaveBalance",null),error:J.touched.leaveBalance&&!!J.errors.leaveBalance})]}),(0,t.jsx)(x.ZP,{item:!0,xs:6,sx:{display:"flex",flexDirection:"column",height:"70%",overflow:"hidden"},children:(0,t.jsx)(L._,{name:"items",onChange:e=>J.setFieldValue("items",e),value:J.values.items,error:J.errors.items,columns:H,allowDelete:!1,allowAddNewLine:!1,maxAccess:T})}),(0,t.jsx)(x.ZP,{item:!0,xs:6}),(0,t.jsx)(x.ZP,{item:!0,xs:3,children:(0,t.jsx)(R.Z,{name:"hours",label:S.hours,value:J.values.hours,readOnly:!0,maxAccess:T,onChange:J.handleChange,onClear:()=>J.setFieldValue("hours",null),error:J.touched.hours&&!!J.errors.hours})}),(0,t.jsx)(x.ZP,{item:!0,xs:3,children:(0,t.jsx)(R.Z,{name:"leaveDays",label:S.leaveDays,value:J.values.leaveDays,readOnly:!0,maxAccess:T,decimalScale:3,onChange:J.handleChange,onClear:()=>J.setFieldValue("leaveDays",null),error:J.touched.leaveDays&&!!J.errors.leaveDays})})]})})})})};P.width=1e3,P.height=650;var k=()=>{let{getRequest:e,postRequest:a}=(0,n.useContext)(s.$),{platformLabels:l}=(0,n.useContext)(h.l),{stack:p}=(0,u.zY)(),x=e=>{if(!e)return null;let a=e.match(/\d+/);return a?new Date(parseInt(a[0],10)):null};async function D(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{_startAt:l=0,_pageSize:t=50,params:n=[]}=a,r=await e({extension:f.U.LeaveRequest.page,parameters:"_size=30&_startAt=".concat(l,"&_pageSize=").concat(t,"&_params=").concat(n,"&_sortBy=recordId&_multiDayLeave=2")});return r&&(null==r?void 0:r.list)&&(r.list=r.list.map(e=>{let a=x(null==e?void 0:e.endDate),l=x(null==e?void 0:e.actualReturnDate),t="";return l&&a&&(t=Math.floor((a-l)/864e5)+1),{...e,lateDays:t}})),{...r,_startAt:l}}let{query:{data:I},filterBy:g,refetch:w,labels:j,access:F,paginationParameters:C,invalidate:_}=(0,o.J)({queryFn:D,endpointId:f.U.LeaveRequest.page,datasetId:i.i.LeaveRequestODOM,filter:{filterFn:N,default:{_multiDayLeave:2}}});async function N(a){let{filters:l,pagination:t}=a;return l.qry?await e({extension:f.U.LeaveRequest.snapshot,parameters:"_filter=".concat(l.qry,"&_multiDayLeave=2")}):D({_startAt:t._startAt||0,params:null==l?void 0:l.params})}let V=[{field:"reference",headerName:j.reference,flex:1},{field:"employeeRef",headerName:j.employeeRef,flex:1},{field:"employeeName",headerName:j.employeeName,flex:1},{field:"startDate",headerName:j.startDate,flex:1,type:"date"},{field:"endDate",headerName:j.endDate,flex:1,type:"date"},{field:"actualReturnDate",headerName:j.actualReturnDate,flex:1,type:"date"},{field:"leaveDays",headerName:j.days,flex:1,type:"number"},{field:"lateDays",headerName:j.lateDays,flex:1},{field:"ltName",headerName:j.leaveType,flex:1},{field:"statusName",headerName:j.statusName,flex:1},{field:"releaseStatus",headerName:j.statusRelease,flex:1},{field:"wipName",headerName:j.wipName,flex:1}];function b(e){p({Component:P,props:{recordId:e}})}let R=async e=>{await a({extension:f.U.LeaveRequest.del,record:JSON.stringify(e)}),_(),r.ZP.success(l.Deleted)};return(0,t.jsxs)(c.R,{children:[(0,t.jsx)(v.g,{children:(0,t.jsx)(y.Z,{onAdd:()=>{b()},maxAccess:F,reportName:"LMLR",filterBy:g})}),(0,t.jsx)(m.Q,{children:(0,t.jsx)(d.Z,{name:"table",columns:V,gridData:I,rowId:["recordId"],onEdit:e=>{b(e.recordId)},onDelete:R,deleteConfirmationType:"strict",pageSize:50,paginationType:"api",paginationParameters:C,maxAccess:F,refetch:w})})]})}}},function(e){e.O(0,[92515,2494,36908,49774,92888,40179],function(){return e(e.s=29616)}),_N_E=e.O()}]);