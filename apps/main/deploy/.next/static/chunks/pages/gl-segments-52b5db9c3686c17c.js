(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[22496],{77688:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/gl-segments",function(){return t(9586)}])},9586:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return k}});var s=t(52322),a=t(2784),l=t(62202),r=t(69387),i=t(27723),d=t(65950),c=t(26612),u=t(31389),m=t(61802),o=t(71987),g=t(33625),f=t(62362),x=t(19473),h=t(66361),v=t(80983),y=t(60218),p=t(38449),I=t(48601),S=t(5088),_=t(54074);function C(e){let{labels:n,obj:t,maxAccess:r,formikSegmentId:i,fetchGridData:c}=e,{platformLabels:m}=(0,a.useContext)(x.l),{getRequest:g,postRequest:p}=(0,a.useContext)(d.$),C=(0,o.E)({endpointId:h.x.Segments.qry}),{formik:N}=(0,v.c)({initialValues:{name:"",reference:"",segmentId:null},maxAccess:r,validateOnChange:!0,validationSchema:I.Ry({name:I.Z_().required(),reference:I.Z_().required()}),onSubmit:async e=>{e.segmentId||(e.segmentId=i),await p({extension:h.x.Segments.set,record:JSON.stringify(e)}),e.segmentId?l.ZP.success(m.Edited):(l.ZP.success(m.Added),N.setValues(e)),C(),c()}}),j=!!N.values.segmentId;return(0,a.useEffect)(()=>{!async function(){if(t){let e=await g({extension:h.x.Segments.get,parameters:"_segmentId=".concat(t.segmentId,"&_reference=").concat(t.reference)});N.setValues(e.record)}}()},[]),(0,s.jsx)(_.Z,{onSave:N.handleSubmit,maxAccess:r,editMode:j,children:(0,s.jsx)(u.R,{children:(0,s.jsx)(f.Q,{children:(0,s.jsxs)(y.ZP,{container:!0,spacing:2,children:[(0,s.jsx)(y.ZP,{item:!0,xs:12,children:(0,s.jsx)(S.Z,{name:"reference",label:n.reference,value:N.values.reference,required:!0,readOnly:j,maxAccess:r,onChange:N.handleChange,onClear:()=>N.setFieldValue("reference",""),error:N.touched.reference&&N.errors.reference})}),(0,s.jsx)(y.ZP,{item:!0,xs:12,children:(0,s.jsx)(S.Z,{name:"name",label:n.name,value:N.values.name,required:!0,maxAccess:r,onChange:N.handleChange,onClear:()=>N.setFieldValue("name",""),error:N.touched.name&&N.errors.name})})]})})})})}var N=t(3191),j=t(96026),k=()=>{let{getRequest:e,postRequest:n}=(0,a.useContext)(d.$),{platformLabels:t}=(0,a.useContext)(x.l),[I,S]=(0,a.useState)([]),[_,k]=(0,a.useState)([]),{stack:Z}=(0,j.V)(),{stack:w}=(0,m.zY)();async function A(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(null!==F.values.segmentId&&void 0!==F.values.segmentId){let{_startAt:t=0,_pageSize:s=50}=n;S(await e({extension:h.x.Segments.qry,parameters:"_startAt=".concat(t,"&_pageSize=").concat(s,"&_segmentId=").concat(F.values.segmentId)}))}}let{labels:E,paginationParameters:q,invalidate:V,refetch:b,access:P}=(0,o.J)({queryFn:A,endpointId:h.x.Segments.qry,datasetId:c.i.Segments}),{formik:F}=(0,v.c)({initialValues:{segmentName:null},maxAccess:P,validateOnChange:!0});(0,a.useEffect)(()=>{A()},[F.values.segmentId]);let O=[{field:"reference",headerName:E.reference,flex:1},{field:"name",headerName:E.segment,flex:1}],D=async e=>{await n({extension:h.x.Segments.del,record:JSON.stringify(e)}),V(),l.ZP.success(t.Deleted)};function G(e){null===F.values.segmentId||void 0===F.values.segmentId?Z({message:E.chooseSegmentError}):w({Component:C,props:{labels:E,obj:e,maxAccess:P,formikSegmentId:F.values.segmentId,fetchGridData:A},width:500,height:260,title:E.segment})}return(0,a.useEffect)(()=>{!async function(){let n=await e({extension:p.r.Defaults.qry,parameters:"_filter=GLACSeg"});if(n&&n.list){let e=n.list.filter(e=>e.key.startsWith("GLACSegName")&&null!==e.value).map(e=>{let t=e.key.replace("Name","");return n.list.find(e=>e.key===t&&null!==e.value)?{key:e.value,value:e.key.split("GLACSegName")[1]}:null}).filter(Boolean);k(e),e.length>0&&(F.setFieldValue("segmentName",e[0].key),F.setFieldValue("segmentId",e[0].value))}}()},[]),(0,s.jsxs)(u.R,{children:[(0,s.jsx)(g.g,{children:(0,s.jsx)(i.Z,{onAdd:()=>{G()},maxAccess:P,labels:E,middleSection:(0,s.jsx)(y.ZP,{item:!0,sx:{display:"flex",mr:2},children:(0,s.jsx)(N.Z,{endpointId:p.r.Defaults.qry,parameters:"_filter=GLACSeg",sx:{width:450},name:"segmentName",label:E.segment,valueField:"key",displayField:"key",store:_,value:F.values.segmentName,required:!0,onChange:(e,n)=>{F.setFieldValue("segmentName",null==n?void 0:n.key),F.setFieldValue("segmentId",null==n?void 0:n.value)},error:!F.values.segmentName})})})}),(0,s.jsx)(f.Q,{children:(0,s.jsx)(r.Z,{columns:O,gridData:I,rowId:["segmentId"],refetch:b,onEdit:e=>{G(e)},onDelete:D,maxAccess:P,pageSize:50,paginationParameters:q,paginationType:"api"})})]})}}},function(e){e.O(0,[49774,92888,40179],function(){return e(e.s=77688)}),_N_E=e.O()}]);