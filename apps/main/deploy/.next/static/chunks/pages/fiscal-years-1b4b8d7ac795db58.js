(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[47255],{21811:function(e,a,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/fiscal-years",function(){return t(92994)}])},92994:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return V}});var s=t(52322),l=t(2784),r=t(62202),n=t(69387),i=t(27723),d=t(65950),o=t(38449),c=t(26612),u=t(61802),m=t(31389),p=t(33625),v=t(62362),b=t(29326),x=t(60218),f=t(48601),h=t(82737),_=t(71987),D=t(5088),y=t(8661),I=t(25506),C=t(80983),j=t(89330),Z=t(84100),F=t(39812),Y=t(19473),g=t(76385);function w(e){let{labels:a,maxAccess:t,setStore:n,store:i,window:u}=e,{getRequest:p,postRequest:b}=(0,l.useContext)(d.$),{platformLabels:w}=(0,l.useContext)(Y.l),{recordId:N}=i,P=(0,_.E)({endpointId:o.r.FiscalYears.page}),{formik:T}=(0,C.c)({initialValues:{recordId:null,fiscalYear:"",startDate:null,endDate:null,periods:"",status:""},maxAccess:t,validateOnChange:!0,validationSchema:f.Ry({fiscalYear:f.Rx().required().transform((e,a)=>(0,I.vR)(e,a)).min(1900,a.yearMin).max(2099,a.yearMax),startDate:f.Z_().required(),endDate:f.Z_().required(),periods:f.Z_().required(),status:f.Z_().required()}),onSubmit:async e=>{let a={...e,startDate:(0,F.ku)(e.startDate),endDate:(0,F.ku)(e.endDate)};await b({extension:o.r.FiscalYears.set,record:JSON.stringify(a)}),N||(T.setFieldValue("recordId",e.fiscalYear),n(a=>({...a,recordId:e.fiscalYear}))),r.ZP.success(e.recordId?w.Edited:w.Added),P(),u.close()}}),A=!!T.values.recordId;return(0,l.useEffect)(()=>{!async function(){if(N){let e=await p({extension:o.r.FiscalYears.get,parameters:"_fiscalYear=".concat(N)});T.setValues({...e.record,startDate:(0,F.a1)(e.record.startDate),endDate:(0,F.a1)(e.record.endDate),recordId:e.record.fiscalYear})}}()},[]),(0,l.useEffect)(()=>{if(T.values.fiscalYear){let e=parseInt(T.values.fiscalYear,10);e&&(T.setFieldValue("startDate",new Date(Date.UTC(e,0,1))),T.setFieldValue("endDate",new Date(Date.UTC(e,11,31,0,0,0,0))))}else T.setFieldValue("startDate",null),T.setFieldValue("endDate",null)},[T.values.fiscalYear]),(0,s.jsx)(h.Z,{resourceId:c.i.FiscalYears,form:T,maxAccess:t,editMode:A,children:(0,s.jsx)(m.R,{children:(0,s.jsx)(v.Q,{children:(0,s.jsxs)(x.ZP,{container:!0,spacing:2,children:[(0,s.jsx)(x.ZP,{item:!0,xs:12,children:(0,s.jsx)(D.Z,{name:"fiscalYear",label:a.fiscalYear,value:T.values.fiscalYear,onChange:T.handleChange,onClear:()=>T.setFieldValue("fiscalYear",""),error:T.touched.fiscalYear&&!!T.errors.fiscalYear,maxAccess:t,required:!0})}),(0,s.jsx)(x.ZP,{item:!0,xs:12,children:(0,s.jsx)(j.Z,{name:"startDate",label:a.startDate,value:T.values.startDate,onChange:T.setFieldValue,required:!0,maxAccess:t,onClear:()=>T.setFieldValue("startDate",null),error:T.touched.startDate&&!!T.errors.startDate})}),(0,s.jsx)(x.ZP,{item:!0,xs:12,children:(0,s.jsx)(j.Z,{name:"endDate",label:a.endDate,value:T.values.endDate,onChange:T.setFieldValue,required:!0,maxAccess:t,onClear:()=>T.setFieldValue("endDate",null),error:T.touched.endDate&&!!T.errors.endDate})}),(0,s.jsx)(x.ZP,{item:!0,xs:12,children:(0,s.jsxs)(x.ZP,{container:!0,spacing:2,alignItems:"center",children:[(0,s.jsx)(x.ZP,{item:!0,xs:4,children:(0,s.jsx)(y.Z,{datasetId:Z.v.FY_PERIODS,name:"periods",label:a.periods,valueField:"key",displayField:"value",values:T.values,onChange:(e,a)=>T.setFieldValue("periods",a?a.key:null),maxAccess:t,readOnly:A,error:T.touched.periods&&!!T.errors.periods,required:!0})}),(0,s.jsx)(x.ZP,{item:!0,children:(0,s.jsx)(g.Z,{children:a.months})})]})}),(0,s.jsx)(x.ZP,{item:!0,xs:12,children:(0,s.jsx)(y.Z,{datasetId:Z.v.FY_PERIOD_STATUS,name:"status",label:a.status,valueField:"key",displayField:"value",values:T.values,onChange:(e,a)=>T.setFieldValue("status",a?a.key:null),maxAccess:t,error:T.touched.status&&!!T.errors.status,required:!0})})]})})})})}var N=t(76399),P=t(80968),T=t(54074),A=e=>{var a,t;let{recordId:n,labels:i,maxAccess:c,row:u,window:p}=e,{getRequest:b,postRequest:x}=(0,l.useContext)(d.$),{getAllKvsByDataset:f}=(0,l.useContext)(P.k),{platformLabels:h}=(0,l.useContext)(Y.l),_=async e=>{try{let a={fiscalYear:n,periodId:u.periodId,fiscalModules:e.filter(e=>{let{status:a}=e;return 0!==a}).map(e=>{let{id:a,status:t,...s}=e;return{status:parseInt(t,10),...s}})};await x({extension:o.r.FiscalModulePack.set2,record:JSON.stringify(a)}),r.ZP.success(h.Edited),p.close()}catch(e){}},{formik:D}=(0,C.c)({initialValues:{modules:[]},maxAccess:c,validateOnChange:!0,onSubmit:async e=>{await _(e.modules)}}),y=[{component:"textfield",label:i.moduleName,name:"moduleName",props:{readOnly:!0}},{component:"resourcecombobox",label:null==i?void 0:i.status,name:"statusName",props:{datasetId:Z.v.FY_PERIOD_STATUS,valueField:"key",displayField:"value",mapping:[{from:"key",to:"status"},{from:"value",to:"statusName"}],columnsInDropDown:[{key:"value",value:"Name"}],displayFieldWidth:1}}];(0,l.useEffect)(()=>{n&&I()},[n]);let I=()=>{!async function(){try{let e=await j(),a=await b({extension:o.r.FiscalModule.qry,parameters:"_fiscalYear=".concat(n,"&_periodId=").concat(u.periodId)}),t=[];e.forEach(e=>{var s;let l={fiscalYear:n,periodId:u.periodId,moduleId:parseInt(e.key,10),moduleName:e.value,status:0,statusName:null};null==a||null===(s=a.list)||void 0===s||s.forEach(e=>{e.moduleId===l.moduleId&&(l.status=e.status,l.statusName=e.statusName)}),t.push(l)});let s=t.map((e,a)=>{let{id:t,...s}=e;return{id:a+1,...s}});D.setFieldValue("modules",s)}catch(e){}}()};async function j(){return new Promise((e,a)=>{f({_dataset:Z.v.MODULE,callback:t=>{t?e(t):a()}})})}return(0,s.jsx)(T.Z,{onSave:D.handleSubmit,maxAccess:c,editMode:!!n,isParentWindow:!1,children:(0,s.jsx)(m.R,{children:(0,s.jsx)(v.Q,{children:(0,s.jsx)(N._,{onChange:e=>D.setFieldValue("modules",e),value:null===(a=D.values)||void 0===a?void 0:a.modules,error:null===(t=D.errors)||void 0===t?void 0:t.modules,columns:y,allowDelete:!1,allowAddNewLine:!1})})})})},S=e=>{var a,t;let{labels:n,maxAccess:i,store:c}=e,{getRequest:p,postRequest:b}=(0,l.useContext)(d.$),{stack:x}=(0,u.zY)(),{platformLabels:h}=(0,l.useContext)(Y.l),{recordId:_}=c,D=async e=>{let a={fiscalYear:_,periods:e.map(e=>{let{id:a,periodId:t,startDate:s,endDate:l,...r}=e;return{periodId:a,startDate:(0,F.ku)(s),endDate:(0,F.ku)(l),...r}})};await b({extension:o.r.FiscalPeriodPack.set2,record:JSON.stringify(a)}),r.ZP.success(h.Edited),g()},{formik:y}=(0,C.c)({initialValues:{recordId:_||null,periods:[]},maxAccess:i,validateOnChange:!0,validationSchema:f.Ry({periods:f.IX().of(f.Ry().shape({statusName:f.Z_().required(),startDate:f.Z_().required(),endDate:f.Z_().required()})).required()}),onSubmit:async e=>{await D(e.periods)}}),I=!!y.values.recordId,j=[{component:"numberfield",label:null==n?void 0:n.period,name:"periodId",props:{readOnly:!0}},{component:"date",name:"startDate",label:null==n?void 0:n.startDate},{component:"date",name:"endDate",label:null==n?void 0:n.endDate},{component:"resourcecombobox",label:null==n?void 0:n.status,name:"statusName",props:{datasetId:Z.v.FY_PERIOD_STATUS,valueField:"key",displayField:"value",widthDropDown:200,mapping:[{from:"key",to:"status"},{from:"value",to:"statusName"}],columnsInDropDown:[{key:"value",value:"Name"}],displayFieldWidth:2}},{component:"button",name:"saved",onClick:(e,a)=>{x({Component:A,props:{labels:n,maxAccess:i,row:a,recordId:_},width:600,title:null==n?void 0:n.period})}}];(0,l.useEffect)(()=>{_&&g()},[_]);let g=async()=>{try{var e;let a=await p({extension:o.r.Period.qry,parameters:"_fiscalYear=".concat(_)});if((null===(e=a.list)||void 0===e?void 0:e.length)>0){let e=a.list.map((e,a)=>{let{id:t,periodId:s,startDate:l,endDate:r,...n}=e;return{id:a+1,periodId:a+1,startDate:(0,F.a1)(l),endDate:(0,F.a1)(r),saved:!0,...n}});y.setValues({recordId:_,periods:e})}}catch(e){}};return(0,s.jsx)(T.Z,{onSave:y.handleSubmit,maxAccess:i,editMode:I,isParentWindow:!1,children:(0,s.jsx)(m.R,{children:(0,s.jsx)(v.Q,{children:(0,s.jsx)(N._,{onChange:e=>y.setFieldValue("periods",e),value:null===(a=y.values)||void 0===a?void 0:a.periods,error:null===(t=y.errors)||void 0===t?void 0:t.periods,columns:j,allowDelete:!1,allowAddNewLine:!1})})})})},k=t(9522),E=e=>{let{labels:a,maxAccess:t,recordId:r,window:n}=e,[i,d]=(0,l.useState)(0),[o,c]=(0,l.useState)({recordId:r||null}),u=[{label:a.fiscalYear},{label:a.periods,disabled:!o.recordId}];return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(k.Y,{tabs:u,activeTab:i,setActiveTab:d,maxAccess:t}),(0,s.jsx)(b.Z,{index:0,value:i,maxAccess:t,children:(0,s.jsx)(w,{labels:a,maxAccess:t,setStore:c,store:o,window:n})}),(0,s.jsx)(b.Z,{index:1,value:i,maxAccess:t,children:(0,s.jsx)(S,{maxAccess:t,labels:a,store:o})})]})},V=()=>{let{getRequest:e,postRequest:a}=(0,l.useContext)(d.$),{stack:t}=(0,u.zY)(),{platformLabels:b}=(0,l.useContext)(Y.l);async function x(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{_startAt:t=0,_pageSize:s=50}=a;return{...await e({extension:o.r.FiscalYears.page,parameters:"_startAt=".concat(t,"&_pageSize=").concat(s,"&_filter=")}),_startAt:t}}let{query:{data:f},refetch:h,labels:D,access:y,paginationParameters:I,invalidate:C}=(0,_.J)({queryFn:x,endpointId:o.r.FiscalYears.page,datasetId:c.i.FiscalYears}),j=[{field:"fiscalYear",headerName:D.fiscalYear,flex:1},{field:"startDate",headerName:D.startDate,flex:1,type:"date"},,{field:"endDate",headerName:D.endDate,flex:1,type:"date"}];function Z(e){t({Component:E,props:{labels:D,maxAccess:y,recordId:e},width:800,title:D.fiscalYear})}let F=async e=>{await a({extension:o.r.FiscalYears.del,record:JSON.stringify(e)}),C(),r.ZP.success(b.Deleted)};return(0,s.jsxs)(m.R,{children:[(0,s.jsx)(p.g,{children:(0,s.jsx)(i.Z,{onAdd:()=>{Z()},maxAccess:y,labels:D})}),(0,s.jsx)(v.Q,{children:(0,s.jsx)(n.Z,{columns:j,gridData:f,rowId:["fiscalYear"],onEdit:e=>{Z(e.fiscalYear)},onDelete:F,isLoading:!1,pageSize:50,paginationParameters:I,paginationType:"api",maxAccess:y,refetch:h,globalStatus:!1})})]})}},29326:function(e,a,t){"use strict";var s=t(52322);t(2784);var l=t(23925),r=t(13980),n=t.n(r),i=t(95291),d=t.n(i),o=t(65947);let c=e=>{var a,t,r;let{children:n,value:i,index:c,maxAccess:u,...m}=e,p="".concat(e.name||"tab",".").concat(c),{accessLevel:v}=null!==(r=(null!==(t=null==u?void 0:null===(a=u.record)||void 0===a?void 0:a.controls)&&void 0!==t?t:[]).find(e=>e.controlId===p))&&void 0!==r?r:{accessLevel:0};if(v===o.A1)return null;let b=i===c;return(0,s.jsx)(l.Z,{role:"tabpanel",hidden:!b,id:"simple-tabpanel-".concat(c),"aria-labelledby":"simple-tab-".concat(c),className:"".concat(d().tabPanel," ").concat(b?d().active:d().hidden),...m,children:n})};c.propTypes={children:n().node,index:n().number.isRequired,value:n().number.isRequired},a.Z=c},9522:function(e,a,t){"use strict";t.d(a,{Y:function(){return m}});var s=t(52322),l=t(23925),r=t(54582),n=t(68696),i=t(44258),d=t(2784),o=t(99266),c=t(52614),u=t.n(c);let m=e=>{var a,t,c,m,p;let{tabs:v,activeTab:b,setActiveTab:x,maxAccess:f,name:h="tab"}=e,_=(null==f?void 0:null===(t=f.record)||void 0===t?void 0:null===(a=t.controls)||void 0===a?void 0:a.filter(e=>{var a;return 4===e.accessLevel&&(null===(a=e.controlId)||void 0===a?void 0:a.startsWith("".concat(h,".")))}).map(e=>e.controlId.split(".")[1]))||[],D=null==v?void 0:null===(c=v.map((e,a)=>({...e,id:a})))||void 0===c?void 0:c.filter((e,a)=>!_.includes(String(a))),y=null===(m=D[b])||void 0===m?void 0:m.id,I=null===(p=D[b])||void 0===p?void 0:p.disabled;return(0,d.useEffect)(()=>{y>=0&&!I&&b!=y&&x(y)},[]),(0,s.jsx)(l.Z,{className:u().tabsContainer,children:(0,s.jsx)(l.Z,{className:u().tabsWrapper,children:(0,s.jsx)(r.Z,{value:b,onChange:(e,a)=>x(a),variant:"scrollable",scrollButtons:D.length>3?"auto":"off","aria-label":"scrollable tabs",classes:{indicator:u().tabsIndicator},className:u().tabs,children:null==D?void 0:D.map(e=>(0,s.jsx)(n.Z,{value:e.id,disabled:null==e?void 0:e.disabled,className:"".concat(u().tabName," ").concat(e.disabled?u().tabDisabled:""),classes:{root:u().tabRoot,selected:u().selectedTab},label:(0,s.jsxs)(l.Z,{display:"flex",alignItems:"center",children:[(0,s.jsx)("span",{children:e.label}),e.id===b&&(null==e?void 0:e.onRefetch)&&(0,s.jsx)(i.Z,{size:"small",className:u().refreshButton,onClick:a=>{a.stopPropagation(),e.onRefetch()},children:(0,s.jsx)(o.Z,{className:u().refreshIcon})})]})},e.id))})})})}},95291:function(e){e.exports={tabPanel:"CustomTabPanel_tabPanel__80Dfu",active:"CustomTabPanel_active___6Uvb",hidden:"CustomTabPanel_hidden__y9566"}},52614:function(e){e.exports={customTabPanel:"CustomTabs_customTabPanel__Ztocv",hidden:"CustomTabs_hidden__lZpM7",tabsContainer:"CustomTabs_tabsContainer__28Syi",tabsWrapper:"CustomTabs_tabsWrapper__mlxxj",tabs:"CustomTabs_tabs__25pli",tabName:"CustomTabs_tabName__XzMCn",tabRoot:"CustomTabs_tabRoot__WVR1E",tabDisabled:"CustomTabs_tabDisabled__VauYR",selectedTab:"CustomTabs_selectedTab__sZzwF",tabsIndicator:"CustomTabs_tabsIndicator__89Lek",refreshButton:"CustomTabs_refreshButton__P2mzl",refreshIcon:"CustomTabs_refreshIcon__ADVWF"}}},function(e){e.O(0,[49774,92888,40179],function(){return e(e.s=21811)}),_N_E=e.O()}]);