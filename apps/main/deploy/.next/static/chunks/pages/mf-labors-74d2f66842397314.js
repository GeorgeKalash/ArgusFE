(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[37855],{30391:function(e,r,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/mf-labors",function(){return a(75346)}])},75346:function(e,r,a){"use strict";a.r(r),a.d(r,{default:function(){return N}});var n=a(52322),l=a(2784),o=a(62202),s=a(69387),t=a(65950),d=a(90587),u=a(71987),i=a(26612),c=a(31389),m=a(33625),p=a(62362),x=a(61802),h=a(60218),f=a(48601),I=a(82737),y=a(8661),v=a(27423),g=a(5088),C=a(38449),b=a(92407),_=a(80983),F=a(19473),R=a(19689);function j(e){var r;let{labels:a,maxAccess:s,recordId:m}=e,[x,j]=(0,l.useState)(!!m),{getRequest:Z,postRequest:N}=(0,l.useContext)(t.$),{platformLabels:w}=(0,l.useContext)(F.l),[k,A]=(0,l.useState)(!1),V=(0,u.E)({endpointId:d.u.Labor.page}),{formik:P}=(0,_.c)({initialValues:{recordId:null,reference:"",name:"",workCenterId:"",operationId:"",hourRateCurrencyId:"",canSignIn:!1,userId:"",hourRate:"",groupId:"",employeeName:"",employeeRef:"",employeeId:null},maxAccess:s,validateOnChange:!0,validationSchema:f.Ry({reference:f.Z_().required(),name:f.Z_().required(),hourRate:f.Rx().transform(e=>isNaN(e)?void 0:e),hourRateCurrencyId:k?f.Z_().required():null}),onSubmit:async e=>{let r=e.recordId,a=await N({extension:d.u.Labor.set,record:JSON.stringify(e)});r?o.ZP.success(w.Edited):(o.ZP.success(w.Added),P.setValues({...e,recordId:a.recordId})),j(!0),V()}});return(0,l.useEffect)(()=>{!async function(){try{if(m){let e=await Z({extension:d.u.Labor.get,parameters:"_recordId=".concat(m)});P.setValues(e.record)}}catch(e){}}()},[m]),(0,n.jsx)(I.Z,{resourceId:i.i.Labor,form:P,maxAccess:s,editMode:x,children:(0,n.jsx)(c.R,{children:(0,n.jsx)(p.Q,{children:(0,n.jsxs)(h.ZP,{container:!0,spacing:2,children:[(0,n.jsxs)(h.ZP,{item:!0,rowspacing:2,xs:6,children:[(0,n.jsx)(h.ZP,{item:!0,sx:{pb:"10px"},xs:12,children:(0,n.jsx)(g.Z,{name:"reference",label:a.reference,value:P.values.reference,required:!0,maxAccess:s,maxLength:"6",onChange:P.handleChange,onClear:()=>P.setFieldValue("reference",""),error:P.touched.reference&&!!P.errors.reference})}),(0,n.jsx)(h.ZP,{item:!0,sx:{pb:"10px"},xs:12,children:(0,n.jsx)(g.Z,{name:"name",label:a.name,value:P.values.name,maxLength:"40",required:!0,maxAccess:s,onChange:P.handleChange,onClear:()=>P.setFieldValue("name",""),error:P.touched.name&&!!P.errors.name})}),(0,n.jsx)(h.ZP,{item:!0,sx:{pb:"10px"},xs:12,children:(0,n.jsx)(y.Z,{endpointId:d.u.WorkCenter.qry,parameters:"_startAt=0&_pageSize=100",name:"workCenterId",label:a.workCenter,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],valueField:"recordId",displayField:["reference","name"],values:P.values,maxAccess:s,onChange:(e,r)=>{P&&P.setFieldValue("workCenterId",null==r?void 0:r.recordId)},error:P.touched.workCenterId&&!!P.errors.workCenterId})}),(0,n.jsx)(h.ZP,{item:!0,sx:{pb:"10px"},xs:12,children:(0,n.jsx)(y.Z,{endpointId:d.u.Operation.qry,parameters:"_workCenterId=0&_startAt=0&_pageSize=100&",name:"operationId",label:a.operation,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],valueField:"recordId",displayField:["reference","name"],values:P.values,maxAccess:s,onChange:(e,r)=>{P&&P.setFieldValue("operationId",null==r?void 0:r.recordId)},error:P.touched.operationId&&!!P.errors.operationId})}),(0,n.jsx)(h.ZP,{item:!0,sx:{pb:"10px"},xs:12,children:(0,n.jsx)(g.Z,{name:"hourRate",label:a.hourRate,value:P.values.hourRate,type:"number",numberField:!0,onChange:e=>{A(!0),P.handleChange(e)},onClear:()=>{A(!1),P.setFieldValue("hourRate",""),P.setFieldValue("hourRateCurrencyId","")},error:P.touched.hourRate&&!!P.errors.hourRate})}),(0,n.jsx)(h.ZP,{item:!0,sx:{pb:"10px"},xs:12,children:(0,n.jsx)(y.Z,{endpointId:C.r.Currency.qry,parameters:"_startAt=0&_pageSize=100&_filter=",name:"hourRateCurrencyId",label:a.hourRateCurrency,readOnly:!P.values.hourRate,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],valueField:"recordId",displayField:["reference","name"],values:P.values,maxAccess:s,onChange:(e,r)=>{P&&P.setFieldValue("hourRateCurrencyId",null==r?void 0:r.recordId)},required:!!P.values.hourRate,error:!!P.values.hourRate&&!P.values.hourRateCurrencyId&&!!P.errors.hourRateCurrencyId})})]}),(0,n.jsxs)(h.ZP,{item:!0,xs:6,children:[(0,n.jsx)(h.ZP,{item:!0,sx:{pb:"10px"},xs:12,children:(0,n.jsx)(R.Z,{name:"canSignIn",value:null===(r=P.values)||void 0===r?void 0:r.canSignIn,onChange:e=>P.setFieldValue("canSignIn",e.target.checked),label:a.canSignIn,maxAccess:s})}),(0,n.jsx)(h.ZP,{item:!0,sx:{pb:"10px"},xs:12,children:(0,n.jsx)(y.Z,{endpointId:C.r.Users.qry,parameters:"_startAt=0&_pageSize=100&_size=50&_sortBy=fullName&_filter=",name:"userId",label:a.user,readOnly:!P.values.canSignIn,valueField:"recordId",displayField:"fullName",values:P.values,maxAccess:s,onChange:(e,r)=>{P&&P.setFieldValue("userId",null==r?void 0:r.recordId)},error:P.touched.userId&&!!P.errors.userId})}),(0,n.jsx)(h.ZP,{item:!0,sx:{pb:"10px"},xs:12,children:(0,n.jsx)(y.Z,{endpointId:d.u.LaborGroup.qry,parameters:"_startAt=0&_pageSize=100&_filter=",name:"groupId",label:a.laborGroup,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],valueField:"recordId",displayField:["reference","name"],values:P.values,maxAccess:s,onChange:(e,r)=>{P&&P.setFieldValue("groupId",null==r?void 0:r.recordId)},error:P.touched.groupId&&!!P.errors.groupId})}),(0,n.jsx)(h.ZP,{item:!0,sx:{pb:"10px"},xs:12,children:(0,n.jsx)(v.U,{endpointId:b.y.Employee.snapshot,parameters:{_branchId:0},form:P,valueField:"reference",displayField:"fullName",name:"employeeRef",label:a.employee,secondDisplayField:!0,secondValue:P.values.employeeName,onChange:(e,r)=>{r?(P.setFieldValue("employeeId",null==r?void 0:r.recordId),P.setFieldValue("employeeRef",null==r?void 0:r.reference),P.setFieldValue("employeeName",null==r?void 0:r.fullName)):(P.setFieldValue("employeeId",null),P.setFieldValue("employeeRef",""),P.setFieldValue("employeeName",""))},error:P.touched.employeeId&&!!P.errors.employeeId})})]})]})})})})}var Z=a(36908),N=()=>{let{getRequest:e,postRequest:r}=(0,l.useContext)(t.$),{stack:a}=(0,x.zY)();async function h(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{_startAt:a=0,_pageSize:n=50,params:l}=r;return{...await e({extension:d.u.Labor.page,parameters:"_startAt=".concat(a,"&_pageSize=").concat(n,"&_params=").concat(l||"")}),_startAt:a}}let{query:{data:f},labels:I,filterBy:y,refetch:v,access:g,paginationParameters:C,invalidate:b}=(0,u.J)({queryFn:h,endpointId:d.u.Labor.page,datasetId:i.i.Labor,filter:{filterFn:_}});async function _(r){let{filters:a,pagination:n}=r;return a.qry?await e({extension:d.u.Labor.snapshot,parameters:"_filter=".concat(a.qry,"&_workCenterId=0")}):h({_startAt:n._startAt||0,params:null==a?void 0:a.params})}let F=[{field:"reference",headerName:I.reference,flex:1},{field:"name",headerName:I.name,flex:1},{field:"workCenterName",headerName:I.workCenter,flex:1},{field:"operationName",headerName:I.operation,flex:1},{field:"userName",headerName:I.user,flex:1}];function R(e){a({Component:j,props:{labels:I,recordId:e,maxAccess:g},height:500,title:I.labor})}let N=async e=>{await r({extension:d.u.Labor.del,record:JSON.stringify(e)}),b(),o.ZP.success(platformLabels.Deleted)};return(0,n.jsxs)(c.R,{children:[(0,n.jsx)(m.g,{children:(0,n.jsx)(Z.Z,{onAdd:()=>{R()},maxAccess:g,reportName:"MFLBR",filterBy:y,previewReport:i.i.Labor})}),(0,n.jsx)(p.Q,{children:(0,n.jsx)(s.Z,{name:"table",columns:F,gridData:f,rowId:["recordId"],onEdit:e=>{R(null==e?void 0:e.recordId)},onDelete:N,pageSize:50,paginationType:"api",paginationParameters:C,refetch:v,maxAccess:g})})]})}}},function(e){e.O(0,[92515,2494,36908,49774,92888,40179],function(){return e(e.s=30391)}),_N_E=e.O()}]);