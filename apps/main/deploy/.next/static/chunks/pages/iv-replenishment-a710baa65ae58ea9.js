(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[64187],{42055:function(e,a,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/iv-replenishment",function(){return t(46054)}])},46054:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return w}});var s=t(52322),n=t(2784),l=t(69387),r=t(65950),d=t(61802),i=t(71987),o=t(26612),c=t(31389),u=t(33625),m=t(62362),h=t(19473),b=t(58912),v=t(29326),x=t(9522),p=t(60218),f=t(48601),_=t(62202),I=t(82737),T=t(8661),g=t(80983),j=t(65215),C=t(89330),Z=t(39812),y=t(21581),R=e=>{let{labels:a,maxAccess:t,setStore:l,store:d}=e,{postRequest:u,getRequest:v}=(0,n.useContext)(r.$),{platformLabels:x,defaultsData:R}=(0,n.useContext)(h.l),{recordId:F}=d,N=(0,i.E)({endpointId:b.I.IvReplenishements.page}),{formik:A}=(0,g.c)({maxAccess:t,initialValues:{recordId:null,siteId:"",dateFrom:null,dateTo:null,date:new Date,notes:""},validateOnChange:!0,validationSchema:f.Ry({siteId:f.Z_().required(),dateFrom:f.hT().required().test(function(e){let{dateTo:a}=this.parent;return e.getTime()<=(null==a?void 0:a.getTime())}),dateTo:f.hT().required().test(function(e){let{date:a,dateFrom:t}=this.parent;return e.getTime()<=(null==a?void 0:a.getTime())&&e.getTime()>=(null==t?void 0:t.getTime())}),date:f.hT().required().test(function(e){let{dateTo:a}=this.parent;return e.getTime()>=(null==a?void 0:a.getTime())})}),onSubmit:async e=>{let a={...e,dateTo:(0,Z.OZ)(new Date(e.dateTo)),dateFrom:(0,Z.OZ)(new Date(e.dateFrom))},t=await u({extension:b.I.IvReplenishements.set,record:JSON.stringify(a)});e.recordId?_.ZP.success(x.Edited):(_.ZP.success(x.Added),A.setFieldValue("recordId",t.recordId),l(e=>({...e,recordId:t.recordId}))),N()}}),P=!!A.values.recordId;async function w(){var e;if(P)return;let a=null==R?void 0:null===(e=R.list)||void 0===e?void 0:e.find(e=>{let{key:a}=e;return"de_siteId"===a});(null==a?void 0:a.value)&&A.setFieldValue("siteId",parseInt((null==a?void 0:a.value)||""))}(0,n.useEffect)(()=>{!async function(){if(F){let e=await v({extension:b.I.IvReplenishements.get,parameters:"_recordId=".concat(F)});A.setValues({...e.record,date:(0,Z.a1)(e.record.date),dateFrom:(0,Z.a1)(e.record.dateFrom),dateTo:(0,Z.a1)(e.record.dateTo)})}await w()}()},[]);let q=[{key:"RecordRemarks",condition:!0,onClick:"onRecordRemarks",disabled:!P},{key:"generate",condition:!0,onClick:async()=>{await u({extension:b.I.GenerateIvReplenishements.generate,record:JSON.stringify(A.values)}),_.ZP.success(x.Generated),N()},disabled:!P}];return(0,s.jsx)(I.Z,{form:A,actions:q,resourceId:o.i.IvReplenishements,maxAccess:t,editMode:P,children:(0,s.jsx)(c.R,{children:(0,s.jsx)(m.Q,{children:(0,s.jsxs)(p.ZP,{container:!0,spacing:2,children:[(0,s.jsx)(p.ZP,{item:!0,xs:12,children:(0,s.jsx)(T.Z,{endpointId:j.$.Site.qry,name:"siteId",readOnly:!0,label:a.site,values:A.values,displayField:"name",maxAccess:t})}),(0,s.jsx)(p.ZP,{item:!0,xs:12,children:(0,s.jsx)(C.Z,{name:"dateFrom",max:A.values.dateTo||A.values.date,readOnly:P,label:a.dateFrom,value:A.values.dateFrom,onChange:A.setFieldValue,required:!0,maxAccess:t,onClear:()=>A.setFieldValue("dateFrom",null),error:A.touched.dateFrom&&!!A.errors.dateFrom})}),(0,s.jsx)(p.ZP,{item:!0,xs:12,children:(0,s.jsx)(C.Z,{name:"dateTo",min:A.values.dateFrom,max:A.values.date,readOnly:P,label:a.dateTo,value:A.values.dateTo,onChange:A.setFieldValue,required:!0,maxAccess:t,onClear:()=>A.setFieldValue("dateTo",null),error:A.touched.dateTo&&!!A.errors.dateTo})}),(0,s.jsx)(p.ZP,{item:!0,xs:12,children:(0,s.jsx)(C.Z,{name:"date",min:A.values.dateTo,readOnly:P,label:a.date,value:A.values.date,onChange:A.setFieldValue,required:!0,maxAccess:t,onClear:()=>A.setFieldValue("date",null),error:A.touched.date&&!!A.errors.date})}),(0,s.jsx)(p.ZP,{item:!0,xs:12,children:(0,s.jsx)(y.Z,{name:"notes",label:a.notes,value:A.values.notes,maxLength:"100",rows:2,maxAccess:t,onChange:A.handleChange,onClear:()=>A.setFieldValue("notes",""),error:A.touched.notes&&!!A.errors.notes})})]})})})})},F=t(27723),N=e=>{let{store:a,labels:t,maxAccess:d}=e,{getRequest:h}=(0,n.useContext)(r.$),{recordId:v}=a;async function x(){return await h({extension:b.I.IvReplenishementsList.qry,parameters:"&_replenishmentId=".concat(v)})}let{query:{data:p},labels:f}=(0,i.J)({enabled:!!v,datasetId:o.i.IvReplenishements,queryFn:x,endpointId:b.I.IvReplenishementsList.qry}),_=[{field:"plantName",headerName:t.palnt,flex:1},{field:"transferRef",headerName:t.transferRef,flex:1}];return(0,s.jsxs)(c.R,{children:[(0,s.jsx)(u.g,{children:(0,s.jsx)(F.Z,{maxAccess:d})}),(0,s.jsx)(m.Q,{children:(0,s.jsx)(l.Z,{name:"replenishments",columns:_,gridData:p,rowId:["recordId"],isLoading:!1,pageSize:50,pagination:!1,maxAccess:d})})]})},A=e=>{let{recordId:a,labels:t,maxAccess:l}=e,[r,d]=(0,n.useState)(0),[i,o]=(0,n.useState)({recordId:a||null}),c=[{label:t.itemRep},{label:t.repTra,disabled:!i.recordId}];return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(x.Y,{tabs:c,activeTab:r,setActiveTab:d,maxAccess:l}),(0,s.jsx)(v.Z,{index:0,value:r,maxAccess:l,children:(0,s.jsx)(R,{labels:t,setStore:o,store:i,maxAccess:l})}),(0,s.jsx)(v.Z,{index:1,value:r,maxAccess:l,children:(0,s.jsx)(N,{labels:t,maxAccess:l,store:i})})]})},P=t(36908),w=()=>{let{getRequest:e}=(0,n.useContext)(r.$),{stack:a}=(0,d.zY)();async function t(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{_startAt:t=0,_pageSize:s=50,params:n}=a;return{...await e({extension:b.I.IvReplenishements.page,parameters:"_startAt=".concat(t,"&_pageSize=").concat(s,"&_filter=&_sortField=&_params=").concat(n||"")}),_startAt:t}}async function h(e){let{filters:a,pagination:s}=e;return t({_startAt:s._startAt||0,params:null==a?void 0:a.params})}let{query:{data:v},labels:x,paginationParameters:p,filterBy:f,refetch:_,access:I}=(0,i.J)({queryFn:t,endpointId:b.I.IvReplenishements.page,datasetId:o.i.IvReplenishements,filter:{filterFn:h}}),T=[{field:"siteName",headerName:x.site,flex:1},{field:"dateFrom",headerName:x.dateFrom,flex:1,type:"date"},{field:"dateTo",headerName:x.dateTo,flex:1,type:"date"},{field:"date",headerName:x.date,flex:1,type:"date"},,{field:"notes",headerName:x.notes,flex:1}];function g(e){a({Component:A,props:{labels:x,recordId:e,maxAccess:I},width:600,height:500,title:x.itemRep})}return(0,s.jsxs)(c.R,{children:[(0,s.jsx)(u.g,{children:(0,s.jsx)(P.Z,{onAdd:()=>{g()},hasSearch:!1,maxAccess:I,reportName:"IRHDR",filterBy:f})}),(0,s.jsx)(m.Q,{children:(0,s.jsx)(l.Z,{name:"table",columns:T,gridData:v,rowId:["recordId"],onEdit:e=>{g(null==e?void 0:e.recordId)},isLoading:!1,pageSize:50,refetch:_,paginationParameters:p,paginationType:"api",maxAccess:I})})]})}},29326:function(e,a,t){"use strict";var s=t(52322);t(2784);var n=t(23925),l=t(13980),r=t.n(l),d=t(95291),i=t.n(d),o=t(65947);let c=e=>{var a,t,l;let{children:r,value:d,index:c,maxAccess:u,...m}=e,h="".concat(e.name||"tab",".").concat(c),{accessLevel:b}=null!==(l=(null!==(t=null==u?void 0:null===(a=u.record)||void 0===a?void 0:a.controls)&&void 0!==t?t:[]).find(e=>e.controlId===h))&&void 0!==l?l:{accessLevel:0};if(b===o.A1)return null;let v=d===c;return(0,s.jsx)(n.Z,{role:"tabpanel",hidden:!v,id:"simple-tabpanel-".concat(c),"aria-labelledby":"simple-tab-".concat(c),className:"".concat(i().tabPanel," ").concat(v?i().active:i().hidden),...m,children:r})};c.propTypes={children:r().node,index:r().number.isRequired,value:r().number.isRequired},a.Z=c},9522:function(e,a,t){"use strict";t.d(a,{Y:function(){return m}});var s=t(52322),n=t(23925),l=t(54582),r=t(68696),d=t(44258),i=t(2784),o=t(99266),c=t(52614),u=t.n(c);let m=e=>{var a,t,c,m,h;let{tabs:b,activeTab:v,setActiveTab:x,maxAccess:p,name:f="tab"}=e,_=(null==p?void 0:null===(t=p.record)||void 0===t?void 0:null===(a=t.controls)||void 0===a?void 0:a.filter(e=>{var a;return 4===e.accessLevel&&(null===(a=e.controlId)||void 0===a?void 0:a.startsWith("".concat(f,".")))}).map(e=>e.controlId.split(".")[1]))||[],I=null==b?void 0:null===(c=b.map((e,a)=>({...e,id:a})))||void 0===c?void 0:c.filter((e,a)=>!_.includes(String(a))),T=null===(m=I[v])||void 0===m?void 0:m.id,g=null===(h=I[v])||void 0===h?void 0:h.disabled;return(0,i.useEffect)(()=>{T>=0&&!g&&v!=T&&x(T)},[]),(0,s.jsx)(n.Z,{className:u().tabsContainer,children:(0,s.jsx)(n.Z,{className:u().tabsWrapper,children:(0,s.jsx)(l.Z,{value:v,onChange:(e,a)=>x(a),variant:"scrollable",scrollButtons:I.length>3?"auto":"off","aria-label":"scrollable tabs",classes:{indicator:u().tabsIndicator},className:u().tabs,children:null==I?void 0:I.map(e=>(0,s.jsx)(r.Z,{value:e.id,disabled:null==e?void 0:e.disabled,className:"".concat(u().tabName," ").concat(e.disabled?u().tabDisabled:""),classes:{root:u().tabRoot,selected:u().selectedTab},label:(0,s.jsxs)(n.Z,{display:"flex",alignItems:"center",children:[(0,s.jsx)("span",{children:e.label}),e.id===v&&(null==e?void 0:e.onRefetch)&&(0,s.jsx)(d.Z,{size:"small",className:u().refreshButton,onClick:a=>{a.stopPropagation(),e.onRefetch()},children:(0,s.jsx)(o.Z,{className:u().refreshIcon})})]})},e.id))})})})}},95291:function(e){e.exports={tabPanel:"CustomTabPanel_tabPanel__80Dfu",active:"CustomTabPanel_active___6Uvb",hidden:"CustomTabPanel_hidden__y9566"}},52614:function(e){e.exports={customTabPanel:"CustomTabs_customTabPanel__Ztocv",hidden:"CustomTabs_hidden__lZpM7",tabsContainer:"CustomTabs_tabsContainer__28Syi",tabsWrapper:"CustomTabs_tabsWrapper__mlxxj",tabs:"CustomTabs_tabs__25pli",tabName:"CustomTabs_tabName__XzMCn",tabRoot:"CustomTabs_tabRoot__WVR1E",tabDisabled:"CustomTabs_tabDisabled__VauYR",selectedTab:"CustomTabs_selectedTab__sZzwF",tabsIndicator:"CustomTabs_tabsIndicator__89Lek",refreshButton:"CustomTabs_refreshButton__P2mzl",refreshIcon:"CustomTabs_refreshIcon__ADVWF"}}},function(e){e.O(0,[92515,2494,36908,49774,92888,40179],function(){return e(e.s=42055)}),_N_E=e.O()}]);