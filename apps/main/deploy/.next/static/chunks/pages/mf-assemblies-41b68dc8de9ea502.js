(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[14546],{93590:function(e,l,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/mf-assemblies",function(){return t(98714)}])},98714:function(e,l,t){"use strict";t.r(l),t.d(l,{default:function(){return z}});var a=t(52322),n=t(2784),d=t(71987),i=t(65950),r=t(69387),s=t(62202),o=t(61802),u=t(26612),c=t(31389),m=t(33625),v=t(62362),y=t(19473),f=t(98345),h=t(7121),b=t(36908),p=t(90587),x=t(29326),I=t(9522),g=t(60218),_=t(48601),N=t(82737),C=t(76399),Z=t(5088),j=t(80983),w=t(89330),A=t(8661),k=t(38449),q=t(21581),F=t(39812),S=t(65215),R=t(91406),O=t(27423),P=t(69627),V=t(23361),T=t(96026),D=t(54074);function L(e){var l,t,d,r,o,u,m,f;let{labels:h,maxAccess:b,form:x}=e,{platformLabels:I}=(0,n.useContext)(y.l),{getRequest:N,postRequest:C}=(0,n.useContext)(i.$),[A,k]=(0,n.useState)(()=>_.Ry({})),[q,F]=(0,n.useState)({}),{formik:R}=(0,j.c)({initialValues:{recordId:null==x?void 0:x.recordId,lotId:0,reference:"",name:"",itemId:null==x?void 0:x.itemId,LSku:null==x?void 0:x.sku,LItem:null==x?void 0:x.itemName,LlotCategory:null==x?void 0:x.lotCategoryName,udd1:null,udd2:null,udt1:null,udt2:null,udn1:null,udn2:null},maxAccess:b,validateOnChange:!0,validationSchema:A,onSubmit:async e=>{let l=await C({extension:S.$.Lot.set,record:JSON.stringify(e)}),{record:t}=await N({extension:S.$.Lot.get,parameters:"_itemId=".concat(null==x?void 0:x.itemId,"$_lotId=").concat(null==l?void 0:l.recordId)});await C({extension:p.u.AssemblyLot.set,record:JSON.stringify({assemblyId:x.recordId,itemId:t.itemId,lotId:t.lotId})}),s.ZP.success(e.lotId?I.Edited:I.Added),R.setFieldValue("lotId",null==t?void 0:t.lotId),R.setFieldValue("reference",null==t?void 0:t.reference)}}),P=!!x.recordId;return(0,n.useEffect)(()=>{!async function(){if(!x.lotCategoryId)return;let{record:e}=await N({extension:S.$.LotCategory.get,parameters:"_recordId=".concat(x.lotCategoryId)});F({udd1:(null==e?void 0:e.udd1)||"N/A",udd2:(null==e?void 0:e.udd2)||"N/A",udt1:(null==e?void 0:e.udt1)||"N/A",udt2:(null==e?void 0:e.udt2)||"N/A",udn1:(null==e?void 0:e.udn1)||"N/A",udn2:(null==e?void 0:e.udn2)||"N/A"}),k(_.Ry({udd1:(null==e?void 0:e.udd1)?_.Z_().required("udd1 is required"):_.Z_().nullable(),udd2:(null==e?void 0:e.udd2)?_.Z_().required("udd2 is required"):_.Z_().nullable(),udt1:(null==e?void 0:e.udt1)?_.Z_().required("udt1 is required"):_.Z_().nullable(),udt2:(null==e?void 0:e.udt2)?_.Z_().required("udt2 is required"):_.Z_().nullable(),udn1:(null==e?void 0:e.udn1)?_.Z_().required("udn1 is required"):_.Z_().nullable(),udn2:(null==e?void 0:e.udn2)?_.Z_().required("udn2 is required"):_.Z_().nullable()}));let{record:l}=await N({extension:p.u.AssemblyLot.get,parameters:"_assemblyId=".concat(x.recordId)});if(l){let{record:e}=await N({extension:S.$.Lot.get,parameters:"_itemId=".concat(l.itemId,"$_lotId=").concat(l.lotId)});R.setValues({...R.values,...e||{}})}}()},[]),(0,a.jsx)(D.Z,{onSave:R.handleSubmit,maxAccess:b,editMode:P,children:(0,a.jsx)(c.R,{children:(0,a.jsx)(v.Q,{children:(0,a.jsxs)(g.ZP,{container:!0,spacing:2,children:[(0,a.jsx)(g.ZP,{item:!0,xs:12,children:(0,a.jsx)(Z.Z,{name:"LlotCategory",label:h.lotCategory,value:null==R?void 0:null===(l=R.values)||void 0===l?void 0:l.LlotCategory,maxAccess:b,readOnly:!0})}),(0,a.jsx)(g.ZP,{item:!0,xs:12,children:(0,a.jsx)(Z.Z,{name:"reference",label:h.reference,value:null==R?void 0:null===(t=R.values)||void 0===t?void 0:t.reference,maxAccess:b,readOnly:!0})}),(0,a.jsx)(g.ZP,{item:!0,xs:12,children:(0,a.jsx)(O.U,{endpointId:S.$.Item.snapshot,name:"itemId",label:null==h?void 0:h.sku,valueField:"recordId",displayField:"LSku",valueShow:"LSku",secondValueShow:"LItem",displayFieldWidth:2,form:R,readOnly:!0,maxAccess:b})}),(0,a.jsx)(g.ZP,{item:!0,xs:12,children:(0,a.jsx)(w.Z,{name:"udd1",required:!0,label:q.udd1,value:null==R?void 0:null===(d=R.values)||void 0===d?void 0:d.udd1,onChange:R.setFieldValue,editMode:P,maxAccess:b,readOnly:"N/A"==q.udd1,onClear:()=>R.setFieldValue("udd1",null),error:R.touched.udd1&&!!R.errors.udd1})}),(0,a.jsx)(g.ZP,{item:!0,xs:12,children:(0,a.jsx)(w.Z,{name:"udd2",required:!0,readOnly:"N/A"==q.udd2,label:q.udd2,value:null==R?void 0:null===(r=R.values)||void 0===r?void 0:r.udd2,onChange:R.setFieldValue,editMode:P,maxAccess:b,onClear:()=>R.setFieldValue("udd2",null),error:R.touched.udd2&&!!R.errors.udd2})}),(0,a.jsx)(g.ZP,{item:!0,xs:12,children:(0,a.jsx)(Z.Z,{name:"udt1",label:q.udt1,value:null==R?void 0:null===(o=R.values)||void 0===o?void 0:o.udt1,readOnly:"N/A"==q.udt1,maxAccess:b,error:R.touched.udt1&&!!R.errors.udt1})}),(0,a.jsx)(g.ZP,{item:!0,xs:12,children:(0,a.jsx)(Z.Z,{name:"udt2",label:q.udt2,value:null==R?void 0:null===(u=R.values)||void 0===u?void 0:u.udt2,maxAccess:b,readOnly:"N/A"==q.udt2,error:R.touched.udt2&&!!R.errors.udt2})}),(0,a.jsx)(g.ZP,{item:!0,xs:12,children:(0,a.jsx)(Z.Z,{name:"udn1",label:q.udn1,value:null==R?void 0:null===(m=R.values)||void 0===m?void 0:m.udn1,maxAccess:b,readOnly:"N/A"==q.udn1,error:R.touched.udn1&&!!R.errors.udn1})}),(0,a.jsx)(g.ZP,{item:!0,xs:12,children:(0,a.jsx)(Z.Z,{name:"udn2",label:q.udn2,value:null==R?void 0:null===(f=R.values)||void 0===f?void 0:f.udn2,readOnly:"N/A"==q.udn2,maxAccess:b,error:R.touched.udn2&&!!R.errors.udn2})})]})})})})}function Q(e){var l,t,r,b,x,I,D,Q,$,M,z,E,B;let{labels:J,maxAccess:W,store:U,setStore:G,totalOverhead:X}=e,{getRequest:Y,postRequest:H}=(0,n.useContext)(i.$),{platformLabels:K,defaultsData:ee,userDefaultsData:el}=(0,n.useContext)(y.l),et=null==U?void 0:U.recordId,ea=(0,n.useRef)(null),{stack:en}=(0,o.zY)(),{stack:ed}=(0,T.V)(),{documentType:ei,maxAccess:er,changeDT:es}=(0,f.H)({functionId:h.J.Assembly,access:W,enabled:!et}),eo=(0,d.E)({endpointId:p.u.Assembly.page}),eu=(null==ee?void 0:null===(t=ee.list)||void 0===t?void 0:null===(l=t.find(e=>{let{key:l}=e;return"mf_mu"===l}))||void 0===l?void 0:l.value)==1,ec=null==el?void 0:null===(b=el.list)||void 0===b?void 0:null===(r=b.find(e=>{let{key:l}=e;return"siteId"===l}))||void 0===r?void 0:r.value,{formik:em}=(0,j.c)({initialValues:{recordId:null,bomId:null,bomName:"",bomRef:"",sku:null,itemId:null,itemName:"",siteId:parseInt(ec)||null,qty:0,rmCost:0,notes:"",dtId:null,reference:"",status:1,releaseStatus:null,date:new Date,plantId:null,machineId:null,machineName:"",machineRef:"",batches:0,batchSize:0,trackBy:null,lotCategoryId:null,labourId:null,shiftId:null,items:[]},maxAccess:er,documentType:{key:"dtId",value:null==ei?void 0:ei.dtId},validateOnChange:!0,validationSchema:_.Ry({date:_.hT().required(),dtId:_.Z_().required(),siteId:_.Z_().required(),qty:_.Rx().required(),itemId:_.Z_().required(),items:_.IX().of(_.Ry().shape({sku:_.Z_().required(),itemName:_.Z_().required(),siteName:_.Z_().required(),siteRef:_.Z_().required(),qty:_.Rx().required(),diffQty:_.Rx().required()})).required()}),onSubmit:async()=>{var e;let l=null==em?void 0:null===(e=em.values)||void 0===e?void 0:e.items.map((e,l)=>({...e,seqNo:l+1,transferId:em.values.recordId||0,baseQty:!eu&&e.muId?e.qty*e.muQty:e.qty})),t={header:{...em.values,date:(0,F.ku)(em.values.date)},items:l};eq((await H({extension:p.u.Assembly.set2,record:JSON.stringify(t)})).recordId),s.ZP.success(et?K.Edited:K.Added),eo()}}),ev=3===em.values.status,ey=!!em.values.recordId,ef=((Number(em.values.items.reduce((e,l)=>{var t,a;return e+(parseFloat(null===(t=l.qty)||void 0===t?void 0:t.toString().replace(/,/g,""))||0)*(parseFloat(null===(a=l.cost)||void 0===a?void 0:a.toString().replace(/,/g,""))||0)},0).toFixed(2))||0)+(Number(X)||0))/(Number(em.values.qty)||0),eh=em.values.items.reduce((e,l)=>{var t;return e+(parseFloat(null===(t=l.designQty)||void 0===t?void 0:t.toString().replace(/,/g,""))||0)},0),eb=em.values.items.reduce((e,l)=>{var t;return e+(parseFloat(null===(t=l.diffQty)||void 0===t?void 0:t.toString().replace(/,/g,""))||0)},0),ep=em.values.items.reduce((e,l)=>{var t,a;return e+(parseFloat(null===(t=l.cost)||void 0===t?void 0:t.toString().replace(/,/g,""))||0)*(parseFloat(null===(a=l.qty)||void 0===a?void 0:a.toString().replace(/,/g,""))||0)},0),ex=!em.values.bomId||!em.values.siteId||!Number(em.values.qty),eI=async e=>{var l,t,a,n,d;if(!e)return;let i=[];if(!ea.current)return i;let[r,s]=await Promise.all([Y({extension:S.$.Replacement.qry,parameters:"_itemId=".concat(ea.current)}),Y({extension:S.$.Item.get,parameters:"_recordId=".concat(ea.current)})]);return i.push({sku:null==s?void 0:null===(l=s.record)||void 0===l?void 0:l.sku,itemName:null==s?void 0:null===(t=s.record)||void 0===t?void 0:t.name,itemId:null==s?void 0:null===(a=s.record)||void 0===a?void 0:a.recordId,ivtItem:null==s?void 0:null===(n=s.record)||void 0===n?void 0:n.ivtItem}),null==r||null===(d=r.list)||void 0===d||d.forEach(e=>{let{replacementSKU:l,replacementItemName:t,replacementId:a,ivtItem:n}=e;i.push({sku:l,itemName:t,itemId:a,ivtItem:n})}),i.filter(l=>{var t,a;return(null===(t=l.sku)||void 0===t?void 0:t.toLowerCase().includes(e.toLowerCase()))||(null===(a=l.itemName)||void 0===a?void 0:a.toLowerCase().includes(e.toLowerCase()))})},eg=[{component:"resourcelookup",label:J.componentItem,name:"sku",props:{onLookup:eI,valueField:"itemName",displayField:"itemName",displayFieldWidth:3,mapping:[{from:"itemId",to:"itemId"},{from:"sku",to:"sku"},{from:"itemName",to:"itemName"}],columnsInDropDown:[{key:"sku",value:"sku"},{key:"itemName",value:"itemName"}]},async onChange(e){let{row:{update:l,newRow:t,oldRow:a}}=e;if(!t.itemId){l(a);return}l({cost:await eN(t.itemId)})}},{component:"textfield",label:J.sku,name:"sku",props:{readOnly:!0}},{component:"resourcecombobox",label:J.siteRef,name:"siteRef",props:{endpointId:S.$.Site.qry,displayField:"reference",valueField:"recordId",mapping:[{from:"recordId",to:"siteId"},{from:"reference",to:"siteRef"},{from:"name",to:"siteName"}],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],displayFieldWidth:3}},{component:"textfield",label:J.siteName,name:"siteName",props:{readOnly:!0}},{component:"numberfield",label:J.designQty,name:"designQty",props:{readOnly:!0,decimalScale:3}},!eu&&{component:"resourcecombobox",label:J.measurementUnit,name:"muRef",props:{endpointId:S.$.MeasurementUnit.qry,parameters:"_msId=0&filter=",displayField:"reference",valueField:"recordId",mapping:[{from:"reference",to:"muRef"},{from:"qty",to:"muQty"},{from:"recordId",to:"muId"}],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],displayFieldWidth:3}},{component:"numberfield",label:J.qty,name:"qty",updateOn:"blur",props:{readOnly:ev,decimalScale:3},async onChange(e){let{row:{update:l,newRow:t}}=e;await e_(null==t?void 0:t.designQty,null==t?void 0:t.qty,null==t?void 0:t.variationLimit,l)}},{component:"numberfield",label:J.diffQty,name:"diffQty",props:{readOnly:!0,decimalScale:3}},{component:"numberfield",label:J.cost,name:"cost",props:{readOnly:!0,decimalScale:3}},{component:"numberfield",label:J.variationLimit,name:"variationLimit",props:{readOnly:!0}}].filter(Boolean);async function e_(e,l,t,a){let n=l-e;return t?Math.abs(n)>t/100*e?(a({qty:0,diffQty:0}),ed({message:J.inValidQty}),!1):(a({qty:l,diffQty:n}),!0):(a({diffQty:n}),!0)}async function eN(e){var l;if(!e)return;let t=await Y({extension:S.$.CurrentCost.get,parameters:"_itemId=".concat(e)});return(null==t?void 0:null===(l=t.record)||void 0===l?void 0:l.currentCost)||0}async function eC(){if(em.values.siteId)return(await Y({extension:S.$.Site.get,parameters:"_recordId=".concat(em.values.siteId)})).record}async function eZ(){if(em.values.bomId)return(await Y({extension:p.u.BillOfMaterials.get,parameters:"_recordId=".concat(em.values.bomId)})).record}async function ej(e){var l;let t=await Y({extension:p.u.Assembly.get,parameters:"_recordId=".concat(e)});return t.record.date=(0,F.a1)(null==t?void 0:null===(l=t.record)||void 0===l?void 0:l.date),t}async function ew(e){return await Y({extension:p.u.AssemblyItems.qry,parameters:"_assemblyId=".concat(e)})}async function eA(){var e;let l=await Y({extension:p.u.Component.qry,parameters:"_bomId=".concat(em.values.bomId)}),t=await eC(),a=await eZ(),n=null==l?void 0:null===(e=l.list)||void 0===e?void 0:e.map(e=>({...e,id:e.seqNo,cost:e.currentCost||0,designQty:(e.qty*(em.values.qty||0)/parseFloat((null==a?void 0:a.qty)||0)).toFixed(3),qty:(e.qty*(em.values.qty||0)/parseFloat((null==a?void 0:a.qty)||0)).toFixed(3),diffQty:0,baseQty:e.baseQty*(em.values.qty||0),siteId:e.siteId||em.values.siteId,siteRef:e.siteId?e.siteRef:null==t?void 0:t.reference,siteName:e.siteId?e.siteName:null==t?void 0:t.name}));em.setFieldValue("items",n)}async function ek(e){if(!e)return;let l=await Y({extension:p.u.BillOfMaterials.get,parameters:"_recordId=".concat(e)});return null==l?void 0:l.record}async function eq(e){var l;let t=await ej(e),a=await ew(e);G(e=>({...e,recordId:null==t?void 0:t.record.recordId,isPosted:(null==t?void 0:t.record.status)==3})),em.setValues({...t.record,items:(null==a?void 0:null===(l=a.list)||void 0===l?void 0:l.map(e=>({...e,id:e.seqNo,diffQty:((e.qty||0)-(e.designQty||0)).toFixed(3),designQty:(e.designQty||0).toFixed(3),qty:(e.qty||0).toFixed(3)})))||[]})}let eF=async()=>{await H({extension:p.u.Assembly.post,record:JSON.stringify(em.values)}),s.ZP.success(K.Posted),eo(),await eq(em.values.recordId),G(e=>({...e,isPosted:!0}))},eS=async()=>{await H({extension:p.u.Assembly.unpost,record:JSON.stringify(em.values)}),s.ZP.success(K.Unposted),eo(),await eq(em.values.recordId),G(e=>({...e,isPosted:!1}))},eR=[{key:"ClearGrid",condition:!0,onClick:()=>{em.setFieldValue("items",em.initialValues.items)},disabled:(null==em?void 0:null===(I=em.values)||void 0===I?void 0:null===(x=I.items)||void 0===x?void 0:x.length)===0},{key:"RecordRemarks",condition:!0,onClick:"onRecordRemarks",disabled:!ey},{key:"GL",condition:!0,onClick:"onClickGL",datasetId:u.i.GLAssemblies,disabled:!ey},{key:"IV",condition:!0,onClick:"onInventoryTransaction",disabled:!ey||!ev},{key:"Locked",condition:ev,onClick:"onUnpostConfirmation",onSuccess:eS,disabled:!ey},{key:"Unlocked",condition:!ev,onClick:eF,disabled:!ey},{key:"Lots",condition:!0,onClick:()=>{en({Component:L,props:{labels:J,access:W,form:em.values},width:700,height:550,title:J.lot})},disabled:!ey||ev||2!=em.values.trackBy}];return(0,n.useEffect)(()=>{et&&eq(et)},[]),(0,a.jsx)(N.Z,{resourceId:u.i.Assemblies,form:em,maxAccess:er,editMode:ey,previewReport:ey,actions:eR,functionId:h.J.Assembly,disabledSubmit:ev,children:(0,a.jsxs)(c.R,{children:[(0,a.jsx)(m.g,{children:(0,a.jsxs)(g.ZP,{container:!0,spacing:2,children:[(0,a.jsx)(g.ZP,{item:!0,xs:4,children:(0,a.jsxs)(g.ZP,{container:!0,spacing:2,children:[(0,a.jsx)(g.ZP,{item:!0,xs:12,children:(0,a.jsx)(A.Z,{endpointId:k.r.DocumentType.qry,parameters:"_startAt=0&_pageSize=1000&_dgId=".concat(h.J.Assembly),name:"dtId",label:J.docType,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],readOnly:ey,required:!0,valueField:"recordId",displayField:["reference","name"],values:em.values,maxAccess:er,onChange:(e,l)=>{em.setFieldValue("dtId",null==l?void 0:l.recordId),es(l)},error:em.touched.dtId&&!!em.errors.dtId})}),(0,a.jsx)(g.ZP,{item:!0,xs:12,children:(0,a.jsx)(Z.Z,{name:"reference",label:J.reference,value:null==em?void 0:null===(D=em.values)||void 0===D?void 0:D.reference,maxAccess:!ey&&er,readOnly:ey,onChange:em.handleChange,onClear:()=>em.setFieldValue("reference",null),error:em.touched.reference&&!!em.errors.reference})}),(0,a.jsx)(g.ZP,{item:!0,xs:12,children:(0,a.jsx)(w.Z,{name:"date",required:!0,readOnly:ev,label:J.date,value:null==em?void 0:null===(Q=em.values)||void 0===Q?void 0:Q.date,onChange:em.setFieldValue,maxAccess:er,onClear:()=>em.setFieldValue("date",null),error:em.touched.date&&!!em.errors.date})}),(0,a.jsx)(g.ZP,{item:!0,xs:12,children:(0,a.jsx)(q.Z,{name:"notes",label:J.notes,value:em.values.notes,rows:2.5,maxLength:"100",readOnly:ev,disabled:em.values.notes,maxAccess:er,onChange:e=>em.setFieldValue("notes",e.target.value),onClear:()=>em.setFieldValue("notes","")})})]})}),(0,a.jsx)(g.ZP,{item:!0,xs:5,children:(0,a.jsxs)(g.ZP,{container:!0,spacing:2,children:[(0,a.jsx)(g.ZP,{item:!0,xs:12,children:(0,a.jsx)(O.U,{endpointId:p.u.Machine.snapshot,valueField:"reference",displayField:"name",name:"machineId",label:J.machine,form:em,readOnly:ey,displayFieldWidth:2,valueShow:"machineRef",secondValueShow:"machineName",maxAccess:er,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],onChange:async(e,l)=>{em.setFieldValue("machineId",null==l?void 0:l.recordId),em.setFieldValue("machineName",null==l?void 0:l.name),em.setFieldValue("machineRef",null==l?void 0:l.reference),em.setFieldValue("batchSize",null==l?void 0:l.batchSize)},errorCheck:"machineId"})}),(0,a.jsx)(g.ZP,{item:!0,xs:12,children:(0,a.jsx)(O.U,{endpointId:p.u.BillOfMaterials.snapshot,valueField:"reference",displayField:"name",name:"bomId",label:J.BOM,form:em,displayFieldWidth:2,valueShow:"bomRef",secondValueShow:"bomName",maxAccess:er,filter:{activeStatus:1},readOnly:ev||ey||(null===($=em.values.items)||void 0===$?void 0:$.some(e=>!!e.sku)),columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],onChange:async(e,l)=>{em.setFieldValue("bomId",null==l?void 0:l.recordId),em.setFieldValue("bomName",null==l?void 0:l.name),em.setFieldValue("bomRef",null==l?void 0:l.reference);let t=await ek(null==l?void 0:l.recordId);em.setFieldValue("itemName",null==t?void 0:t.itemName),em.setFieldValue("sku",null==t?void 0:t.sku),em.setFieldValue("itemId",null==t?void 0:t.itemId)},errorCheck:"bomId"})}),(0,a.jsx)(g.ZP,{item:!0,xs:12,children:(0,a.jsx)(O.U,{endpointId:S.$.Item.snapshot,name:"itemId",label:null==J?void 0:J.sku,valueField:"recordId",displayField:"sku",valueShow:"sku",secondValueShow:"itemName",displayFieldWidth:2,form:em,readOnly:!0,required:!0,maxAccess:er,errorCheck:"itemId"})}),(0,a.jsx)(g.ZP,{item:!0,xs:12,children:(0,a.jsx)(A.Z,{endpointId:S.$.Site.qry,name:"siteId",label:J.site,values:em.values,displayField:["reference","name"],maxAccess:er,required:!0,readOnly:ev,columnsInDropDown:[{key:"reference",value:"reference"},{key:"name",value:"Name"}],onChange:(e,l)=>{em.setFieldValue("siteId",null==l?void 0:l.recordId)},error:em.touched.siteId&&!!em.errors.siteId})}),(0,a.jsx)(g.ZP,{item:!0,xs:6,children:(0,a.jsx)(R.Z,{name:"rmCost",label:J.totalCost,value:ep,maxAccess:er,readOnly:!0})}),(0,a.jsx)(g.ZP,{item:!0,xs:6,children:(0,a.jsx)(P.Z,{onClick:()=>{var e;(null===(e=em.values.items)||void 0===e?void 0:e.some(e=>!!e.sku))?en({Component:V.Z,props:{DialogText:J.resetMsg,okButtonAction:eA,fullScreen:!1,close:!0},width:400,height:150,title:K.Confirmation}):eA()},image:"preview.png",tooltipText:K.Preview,disabled:ev||ex})}),(0,a.jsx)(g.ZP,{item:!0,xs:12,children:(0,a.jsx)(R.Z,{name:"avgUnitCost",label:J.unitCost,readOnly:!0,value:ef,maxAccess:er})})]})}),(0,a.jsx)(g.ZP,{item:!0,xs:3,children:(0,a.jsxs)(g.ZP,{container:!0,spacing:2,children:[(0,a.jsx)(g.ZP,{item:!0,xs:12,children:(0,a.jsx)(R.Z,{name:"designQty",label:J.designQty,readOnly:!0,value:eh,maxAccess:er})}),(0,a.jsx)(g.ZP,{item:!0,xs:12,children:(0,a.jsx)(R.Z,{name:"qty",label:J.qty,allowNegative:!1,readOnly:ev||ey||(null===(M=em.values.items)||void 0===M?void 0:M.some(e=>!!e.sku)),onChange:em.handleChange,value:null==em?void 0:null===(z=em.values)||void 0===z?void 0:z.qty,maxAccess:er,onClear:()=>em.setFieldValue("qty",0),error:em.touched.qty&&!!em.errors.qty})}),(0,a.jsx)(g.ZP,{item:!0,xs:12,children:(0,a.jsx)(R.Z,{name:"diffQty",label:J.diffQty,readOnly:!0,value:eb,maxAccess:er})}),(0,a.jsx)(g.ZP,{item:!0,xs:12,children:(0,a.jsx)(R.Z,{name:"totalRM",label:J.totalRM,readOnly:!0,value:eh+eb,maxAccess:er})}),(0,a.jsx)(g.ZP,{item:!0,xs:12,children:(0,a.jsx)(R.Z,{name:"batchSize",label:J.batchSize,readOnly:ey,allowNegative:!1,value:null==em?void 0:null===(E=em.values)||void 0===E?void 0:E.batchSize,maxAccess:er,onChange:e=>{let l=Number(e.target.value.replace(/,/g,""));em.setFieldValue("batchSize",l),l&&em.setFieldValue("qty",(em.values.qty||0)*l)},onClear:()=>em.setFieldValue("batchSize",0),error:em.touched.batchSize&&!!em.errors.batchSize})}),(0,a.jsx)(g.ZP,{item:!0,xs:12,children:(0,a.jsx)(R.Z,{name:"batches",label:J.batches,readOnly:ey,value:null==em?void 0:null===(B=em.values)||void 0===B?void 0:B.batches,maxAccess:er,allowNegative:!1,onChange:e=>{let l=Number(e.target.value.replace(/,/g,""));em.setFieldValue("batches",l),l&&em.setFieldValue("qty",(em.values.batchSize||0)*l)},onClear:()=>em.setFieldValue("batches",0),error:em.touched.batches&&!!em.errors.batches})})]})})]})}),(0,a.jsx)(v.Q,{children:(0,a.jsx)(C._,{onChange:e=>em.setFieldValue("items",ex?[]:e),value:em.values.items,error:em.errors.items,columns:eg,name:"items",maxAccess:er,disabled:ev,allowDelete:!1,allowAddNewLine:!1,onSelectionChange:(e,l,t)=>{"sku"==t&&(ea.current=null==e?void 0:e.itemId)}})})]})})}function $(e){var l,t;let{labels:d,maxAccess:r,store:o,setTotalOverhead:u}=e,{postRequest:f,getRequest:h}=(0,n.useContext)(i.$),{platformLabels:b}=(0,n.useContext)(y.l),x=null==o?void 0:o.recordId,{formik:I}=(0,j.c)({validateOnChange:!0,initialValues:{items:[{id:1,assemblyId:x,overheadId:null,seqNo:"",amount:0,units:0,unitCost:0}]},validationSchema:_.Ry({items:_.IX().of(_.Ry({overheadRef:_.Z_().test(function(e){var l,t,a;let n=this.parent.units;return(null===(a=this.options.from[1])||void 0===a?void 0:null===(t=a.value)||void 0===t?void 0:null===(l=t.items)||void 0===l?void 0:l.length)===1&&(!n||0==n)||!!e}),overheadName:_.Z_().test(function(e){var l,t,a;let n=this.parent.units;return(null===(a=this.options.from[1])||void 0===a?void 0:null===(t=a.value)||void 0===t?void 0:null===(l=t.items)||void 0===l?void 0:l.length)===1&&(!n||0==n)||!!e}),units:_.Z_().test("check-value","Units must be at least 1",function(e){if(this.parent.overheadRef){let l=Number(e);if(!e||isNaN(l)||l<1)return!1}return!0})}))}),onSubmit:async e=>{let l=null==e?void 0:e.items.map((e,l)=>({...e,seqNo:l+1,assemblyId:x})).filter(e=>e.overheadRef||e.units);await f({extension:p.u.AssemblyOverhead.set2,record:JSON.stringify({assemblyId:x,items:l})}),s.ZP.success(b.Edited)}}),N=I.values.items.reduce((e,l)=>{var t;return e+(parseFloat(null==l?void 0:null===(t=l.amount)||void 0===t?void 0:t.toString().replace(/,/g,""))||0)},0),Z=[{component:"resourcelookup",label:d.overheadRef,name:"overheadRef",props:{endpointId:p.u.Overhead.snapshot,displayField:"reference",valueField:"reference",mapping:[{from:"recordId",to:"overheadId"},{from:"reference",to:"overheadRef"},{from:"name",to:"overheadName"},{from:"unitCost",to:"unitCost"}],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],displayFieldWidth:2},async onChange(e){let{row:{update:l,newRow:t}}=e;l({overheadId:null==t?void 0:t.overheadId,overheadRef:null==t?void 0:t.overheadRef,overheadName:null==t?void 0:t.overheadName,unitCost:(null==t?void 0:t.unitCost)||0})}},{component:"textfield",label:d.overheadName,name:"overheadName",props:{readOnly:!0}},{component:"numberfield",label:d.units,name:"units",async onChange(e){let{row:{update:l,newRow:t}}=e;l({amount:(null==t?void 0:t.units)*(null==t?void 0:t.unitCost)||0})}},{component:"numberfield",label:d.unitCost,name:"unitCost",props:{readOnly:!0}},{component:"numberfield",label:d.amount,name:"amount",props:{readOnly:!0}}];async function w(){var e,l;let t=await h({extension:p.u.AssemblyOverhead.qry,parameters:"_assemblyId=".concat(x)}),a=(null==t?void 0:null===(e=t.list)||void 0===e?void 0:e.length)!=0?await Promise.all(null==t?void 0:null===(l=t.list)||void 0===l?void 0:l.map(async(e,l)=>({...e,id:l+1}))):[{id:1}];I.setFieldValue("items",a)}return(0,n.useEffect)(()=>{N&&u(N)},[N]),(0,n.useEffect)(()=>{!async function(){x&&await w()}()},[x]),(0,a.jsx)(D.Z,{onSave:I.handleSubmit,maxAccess:r,editMode:!0,disabledSubmit:null==o?void 0:o.isPosted,children:(0,a.jsxs)(c.R,{children:[(0,a.jsx)(v.Q,{children:(0,a.jsx)(C._,{onChange:e=>I.setFieldValue("items",e),value:I.values.items,error:I.errors.items,columns:Z,name:"items",initialValues:null==I?void 0:null===(t=I.initialValues)||void 0===t?void 0:null===(l=t.items)||void 0===l?void 0:l[0],maxAccess:r,disabled:null==o?void 0:o.isPosted,allowDelete:!(null==o?void 0:o.isPosted)})}),(0,a.jsx)(m.g,{children:(0,a.jsx)(g.ZP,{container:!0,p:2,children:(0,a.jsx)(g.ZP,{item:!0,xs:2,children:(0,a.jsx)(R.Z,{name:"totalAmount",label:d.total,value:N,readOnly:!0})})})})]})})}var M=e=>{let{recordId:l,access:t,labels:d}=e,[i,r]=(0,n.useState)(0),[s,o]=(0,n.useState)({recordId:l,isPosted:!1}),[u,c]=(0,n.useState)(0),m=[{label:d.assembly},{label:d.overhead,disabled:!s.recordId}];return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(I.Y,{tabs:m,activeTab:i,setActiveTab:r,maxAccess:t}),(0,a.jsx)(x.Z,{index:0,value:i,maxAccess:t,children:(0,a.jsx)(Q,{store:s,setStore:o,labels:d,maxAccess:t,totalOverhead:u})}),(0,a.jsx)(x.Z,{index:1,value:i,maxAccess:t,children:(0,a.jsx)($,{store:s,labels:d,maxAccess:t,setTotalOverhead:c})})]})},z=()=>{let{postRequest:e,getRequest:l}=(0,n.useContext)(i.$),{platformLabels:t}=(0,n.useContext)(y.l),{stack:x}=(0,o.zY)(),{query:{data:I},filterBy:g,refetch:_,labels:N,access:C,paginationParameters:Z,invalidate:j}=(0,d.J)({queryFn:A,endpointId:p.u.Assembly.page,datasetId:u.i.Assemblies,filter:{filterFn:k}}),w=[{field:"reference",headerName:N.reference,flex:1},{field:"bomName",headerName:N.bomName,flex:1},{field:"bomRef",headerName:N.BOM,flex:1},{field:"siteRef",headerName:N.site,flex:1},{field:"machineName",headerName:N.machine,flex:1},{field:"sku",headerName:N.sku,flex:1},{field:"itemName",headerName:N.componentItem,flex:1},{field:"date",headerName:N.date,flex:1,type:"date"},{field:"notes",headerName:N.notes,flex:1},{field:"qty",headerName:N.qty,flex:1,type:"number"},{field:"statusName",headerName:N.status,flex:1}];async function A(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{_startAt:t=0,_pageSize:a=50,params:n=[]}=e;return{...await l({extension:p.u.Assembly.page,parameters:"_startAt=".concat(t,"&_pageSize=").concat(a,"&_sortBy=&_params=").concat(n,"&filter=")}),_startAt:t}}async function k(e){let{filters:t,pagination:a}=e;return t.qry?await l({extension:p.u.Assembly.snapshot,parameters:"_filter=".concat(t.qry)}):A({_startAt:a._startAt||0,params:null==t?void 0:t.params})}let{proxyAction:q}=(0,f.G)({functionId:h.J.Assembly,action:S}),F=async()=>{q()};async function S(e){x({Component:M,props:{labels:N,access:C,recordId:e},width:1300,height:730,title:N.assembly})}let R=async l=>{await e({extension:p.u.Assembly.del,record:JSON.stringify(l)}),j(),s.ZP.success(t.Deleted)};return(0,a.jsxs)(c.R,{children:[(0,a.jsx)(m.g,{children:(0,a.jsx)(b.Z,{onAdd:F,maxAccess:C,reportName:"MFASM",filterBy:g})}),(0,a.jsx)(v.Q,{children:(0,a.jsx)(r.Z,{name:"table",columns:w,gridData:I,rowId:["recordId"],onEdit:e=>{S(null==e?void 0:e.recordId)},refetch:_,onDelete:R,deleteConfirmationType:"strict",isLoading:!1,pageSize:50,maxAccess:C,paginationParameters:Z,paginationType:"api"})})]})}},1685:function(e,l,t){"use strict";t.d(l,{m:function(){return a}});let a=e=>{let l=window.sessionStorage.getItem(e);return l?JSON.parse(l):null}},98345:function(e,l,t){"use strict";t.d(l,{H:function(){return f},G:function(){return y}});var a=t(45300),n=t(2784),d=t(96026),i=t(38449);t(26612);var r=t(65947),s=t(1685);let o=async(e,l,t)=>{try{let a=await e({extension:l,parameters:t});return l.includes("qry")?a:a.record}catch(e){return null}},u=(e,l,t,a)=>{let n=(e=JSON.parse(JSON.stringify(e))).record.controls,d=n.find(e=>"reference"===e.controlId);return d?d.accessLevel=(null==l?void 0:l.mandatory)?r.$7:r.rr:(null==l?void 0:l.mandatory)?n.push({sgId:0,resourceId:"",controlId:"".concat(a?a+".":"","reference"),accessLevel:(null==l?void 0:l.mandatory)?r.$7:r.rr}):(null==l?void 0:l.readOnly)?n.push({sgId:0,resourceId:"",controlId:"".concat(a?a+".":"","reference"),accessLevel:(null==l?void 0:l.readOnly)?r.rr:r.$7}):n=e.record.controls.filter(e=>"reference"!=e.controlId),t&&n.push({sgId:0,resourceId:"",controlId:"".concat(a?a+".":"","dtId"),accessLevel:r.$7}),{...e,record:{...e.record,controls:n}}},c=async(e,l,t)=>{let a,n;switch(t){case"dtId":let d=(0,s.m)("userData"),r=null==d?void 0:d.userId;n="_userId=".concat(r,"&_functionId=").concat(l),a=i.r.UserFunction.get;break;case"glbSysNumberRange":n="_recordId=".concat(l),a=i.r.SystemFunction.get;break;case"DocumentType":n="_dgId=".concat(l,"&_startAt=",0,"&_pageSize=",50),a=i.r.DocumentType.qry;break;case"DcTypNumberRange":n="_recordId=".concat(l),a=i.r.DocumentType.get;break;case"isExternal":n="_recordId=".concat(l),a=i.r.NumberRange.get;break;default:return null}return await o(e,a,n)},m=async function(e){let l,t,a,n,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,s=!(arguments.length>4)||void 0===arguments[4]||arguments[4],o=arguments.length>5?arguments[5]:void 0,m=void 0===r&&d&&await c(e,d,"dtId"),v=null==m?void 0:m.dtId,y="",f=!0;if(m&&void 0===r||"nraId"===r){if(v){let t=await c(e,v,"DcTypNumberRange");l=null==t?void 0:t.nraId,f=!((null==t?void 0:t.activeStatus)<0),l||(y="Assign the document type to a number range")}if((!v||!f)&&s&&d){var h;let l=await c(e,d,"DocumentType");n=(null==l?void 0:null===(h=l.list)||void 0===h?void 0:h.filter(e=>(null==e?void 0:e.activeStatus)===1).length)>0}}if(("nraId"===r||void 0===r)&&d){if((!v||v)&&!l||l&&!f){let t=await c(e,d,"glbSysNumberRange");(l=null==t?void 0:t.nraId)&&n&&(n=!1),f=!0}y=l||n?"":"Assign the system Function to a number range"}r>0&&!l&&(l=r),l&&f?(t={readOnly:null==(a=await c(e,l,"isExternal"))||!a.external,mandatory:null!=a&&!!a.external},i&&(i=await u(i,t,n,o))):!l&&i&&(i=await u(i,t,n,o));let b=o?"".concat(o,".reference"):"reference";return{dtId:v,resetReference:null==t?void 0:t.readOnly,dcTypeRequired:n,reference:{fieldName:b,isEmpty:(null==a?void 0:a.external)!==void 0&&(null==a||!a.external)},errorMessage:y,maxAccess:i,selectNraId:r}};var v=t(65950);function y(e){let{functionId:l,action:t,hasDT:a}=e,{getRequest:i}=(0,n.useContext)(v.$),{stack:r}=(0,d.V)();return{proxyAction:async()=>{let e=await m(i,l,"",void 0,a);(null==e?void 0:e.errorMessage)?r({message:null==e?void 0:e.errorMessage}):await t()}}}function f(e){var l;let{functionId:t,access:i,hasDT:r,enabled:s=!0,objectName:o=""}=e,{getRequest:u}=(0,n.useContext)(v.$),{stack:c}=(0,d.V)(),[y,f]=(0,n.useState)(),h=async e=>{let l=await m(u,t,i,e,r,o);if(!l.errorMessage)return l;c({message:null==l?void 0:l.errorMessage})},b=(0,a.a)({retry:!1,staleTime:0,enabled:s,queryKey:[t,y,!!i,s],queryFn:y||"nraId"===y?()=>h(y):()=>h()});return{documentType:b.data,maxAccess:(null==b?void 0:null===(l=b.data)||void 0===l?void 0:l.maxAccess)||i,changeDT(e){f((null==e?void 0:e.nraId)||"nraId")}}}},29326:function(e,l,t){"use strict";var a=t(52322);t(2784);var n=t(23925),d=t(13980),i=t.n(d),r=t(95291),s=t.n(r),o=t(65947);let u=e=>{var l,t,d;let{children:i,value:r,index:u,maxAccess:c,...m}=e,v="".concat(e.name||"tab",".").concat(u),{accessLevel:y}=null!==(d=(null!==(t=null==c?void 0:null===(l=c.record)||void 0===l?void 0:l.controls)&&void 0!==t?t:[]).find(e=>e.controlId===v))&&void 0!==d?d:{accessLevel:0};if(y===o.A1)return null;let f=r===u;return(0,a.jsx)(n.Z,{role:"tabpanel",hidden:!f,id:"simple-tabpanel-".concat(u),"aria-labelledby":"simple-tab-".concat(u),className:"".concat(s().tabPanel," ").concat(f?s().active:s().hidden),...m,children:i})};u.propTypes={children:i().node,index:i().number.isRequired,value:i().number.isRequired},l.Z=u},9522:function(e,l,t){"use strict";t.d(l,{Y:function(){return m}});var a=t(52322),n=t(23925),d=t(54582),i=t(68696),r=t(44258),s=t(2784),o=t(99266),u=t(52614),c=t.n(u);let m=e=>{var l,t,u,m,v;let{tabs:y,activeTab:f,setActiveTab:h,maxAccess:b,name:p="tab"}=e,x=(null==b?void 0:null===(t=b.record)||void 0===t?void 0:null===(l=t.controls)||void 0===l?void 0:l.filter(e=>{var l;return 4===e.accessLevel&&(null===(l=e.controlId)||void 0===l?void 0:l.startsWith("".concat(p,".")))}).map(e=>e.controlId.split(".")[1]))||[],I=null==y?void 0:null===(u=y.map((e,l)=>({...e,id:l})))||void 0===u?void 0:u.filter((e,l)=>!x.includes(String(l))),g=null===(m=I[f])||void 0===m?void 0:m.id,_=null===(v=I[f])||void 0===v?void 0:v.disabled;return(0,s.useEffect)(()=>{g>=0&&!_&&f!=g&&h(g)},[]),(0,a.jsx)(n.Z,{className:c().tabsContainer,children:(0,a.jsx)(n.Z,{className:c().tabsWrapper,children:(0,a.jsx)(d.Z,{value:f,onChange:(e,l)=>h(l),variant:"scrollable",scrollButtons:I.length>3?"auto":"off","aria-label":"scrollable tabs",classes:{indicator:c().tabsIndicator},className:c().tabs,children:null==I?void 0:I.map(e=>(0,a.jsx)(i.Z,{value:e.id,disabled:null==e?void 0:e.disabled,className:"".concat(c().tabName," ").concat(e.disabled?c().tabDisabled:""),classes:{root:c().tabRoot,selected:c().selectedTab},label:(0,a.jsxs)(n.Z,{display:"flex",alignItems:"center",children:[(0,a.jsx)("span",{children:e.label}),e.id===f&&(null==e?void 0:e.onRefetch)&&(0,a.jsx)(r.Z,{size:"small",className:c().refreshButton,onClick:l=>{l.stopPropagation(),e.onRefetch()},children:(0,a.jsx)(o.Z,{className:c().refreshIcon})})]})},e.id))})})})}},95291:function(e){e.exports={tabPanel:"CustomTabPanel_tabPanel__80Dfu",active:"CustomTabPanel_active___6Uvb",hidden:"CustomTabPanel_hidden__y9566"}},52614:function(e){e.exports={customTabPanel:"CustomTabs_customTabPanel__Ztocv",hidden:"CustomTabs_hidden__lZpM7",tabsContainer:"CustomTabs_tabsContainer__28Syi",tabsWrapper:"CustomTabs_tabsWrapper__mlxxj",tabs:"CustomTabs_tabs__25pli",tabName:"CustomTabs_tabName__XzMCn",tabRoot:"CustomTabs_tabRoot__WVR1E",tabDisabled:"CustomTabs_tabDisabled__VauYR",selectedTab:"CustomTabs_selectedTab__sZzwF",tabsIndicator:"CustomTabs_tabsIndicator__89Lek",refreshButton:"CustomTabs_refreshButton__P2mzl",refreshIcon:"CustomTabs_refreshIcon__ADVWF"}}},function(e){e.O(0,[92515,2494,36908,49774,92888,40179],function(){return e(e.s=93590)}),_N_E=e.O()}]);