"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[43933],{43933:function(e,d,l){l.d(d,{Z:function(){return R}});var r=l(52322),n=l(89330),i=l(39812),o=l(60218),a=l(2784),s=l(48601),u=l(82737),t=l(62202),c=l(65950),v=l(71987),h=l(26612),m=l(5088),p=l(21581),I=l(8661),x=l(38449),y=l(65215),g=l(7121),f=l(76399),j=l(31389),F=l(33625),k=l(62362),w=l(80983),b=l(19473),C=l(98345),Z=l(90587),D=l(91406),S=l(67920),P=l(27423),q=l(63518),N=l(2801),O=l(50023),V=l(21326);function R(e){var d,l,R,A,L,_,z,G,J,U,E,T,$,W,M,K,H,Q,X,B,Y,ee,ed,el,er,en,ei,eo,ea,es,eu,et,ec,ev,eh,em,ep,eI,ex,ey,eg,ef,ej,eF,ek,ew,eb,eC,eZ,eD;let{recordId:eS,window:eP}=e,{getRequest:eq,postRequest:eN}=(0,a.useContext)(c.$),{platformLabels:eO}=(0,a.useContext)(b.l),eV=(0,a.useRef)(null),{labels:eR,access:eA}=(0,O.Z)({datasetId:h.i.Samples,editMode:!!eS});(0,V.Z)({title:eR.samples,window:eP});let{documentType:eL,maxAccess:e_,changeDT:ez}=(0,C.H)({functionId:g.J.Samples,access:eA,enabled:!eS}),eG=(0,v.E)({endpointId:q.z.Samples.page}),{schema:eJ,requiredFields:eU}=(0,S.m)({sku:e=>null==e?void 0:e.sku,stonePct:e=>(null==e?void 0:e.stonePct)!=null,weight:e=>(null==e?void 0:e.weight)!=null,pcs:e=>(null==e?void 0:e.pcs)!=null,itemName:e=>null==e?void 0:e.itemName},!0,e_,"rows"),{formik:eE}=(0,w.c)({maxAccess:e_,documentType:{key:"dtId",value:null==eL?void 0:eL.dtId},conditionSchema:["rows"],initialValues:{recordId:eS,header:{recordId:eS,dtId:null,reference:"",date:new Date,productionStandardId:null,productionClassId:null,weight:null,siteId:null,collectionId:null,jobId:null,itemId:null,threeDDId:null,productionLineId:null,designFamilyId:null,designGroupId:null,statusName:"",notes:"",status:1},rows:[{id:1,sampleId:eS,sku:"",itemName:"",weight:null,pcs:null,stonePct:null,seqNo:""}]},validateOnChange:!0,validationSchema:s.Ry({header:s.Ry({productionStandardId:s.Rx().required(),productionClassId:s.Rx().required(),weight:s.Rx().required(),siteId:s.Rx().required(),collectionId:s.Rx().required(),jobId:s.Rx().required(),threeDDId:s.Rx().required(),productionLineId:s.Rx().required(),date:s.hT().required()}),rows:s.IX().of(eJ)}),onSubmit:async e=>{let{rows:d,header:l}=e,r={...l,date:(0,i.ku)(l.date)},n=null==d?void 0:d.filter(e=>{var d;return null===(d=Object.values(eU))||void 0===d?void 0:d.every(d=>d(e))}).map((e,d)=>({...e,sampleId:null!=eS?eS:0,seqNo:d+1})),o=await eN({extension:q.z.Samples.set2,record:JSON.stringify({header:r,items:n})});eV.current&&(eV.current.value=o.recordId,await eV.current.submit()),t.ZP.success(e.recordId?eO.Edited:eO.Added),eG(),eH(null==o?void 0:o.recordId)}}),eT=!!eE.values.recordId,e$=3===eE.values.header.status,eW=2===eE.values.header.wip;async function eM(){var e,d;await eN({extension:q.z.Samples.post,record:JSON.stringify({...null==eE?void 0:null===(e=eE.values)||void 0===e?void 0:e.header,date:(0,i.ku)(null==eE?void 0:null===(d=eE.values)||void 0===d?void 0:d.header.date)})}),t.ZP.success(eO.Posted),eP.close(),eG()}let eK=[{component:"resourcelookup",label:eR.sku,name:"sku",width:100,props:{endpointId:y.$.Item.snapshot,valueField:"sku",displayField:"sku",mapping:[{from:"recordId",to:"itemId"},{from:"sku",to:"sku"},{from:"name",to:"itemName"}],columnsInDropDown:[{key:"sku",value:"SKU"},{key:"name",value:"Name"}],displayFieldWidth:2}},{component:"numberfield",name:"pcs",label:eR.pcs,width:100,props:{maxLength:4}},{component:"numberfield",name:"weight",label:eR.weight,width:100,props:{maxLength:10,decimalScale:3}},{component:"numberfield",name:"stonePct",label:eR.stonePct,width:100,props:{maxLength:5,decimalScale:2}}];async function eH(e){var d,l,r,n,o,a,s,u,t;let c=await eq({extension:q.z.Samples.get2,parameters:"_recordId=".concat(e)}),v=(null==c?void 0:null===(l=c.record)||void 0===l?void 0:null===(d=l.items)||void 0===d?void 0:d.length)?null==c?void 0:null===(n=c.record)||void 0===n?void 0:null===(r=n.items)||void 0===r?void 0:r.map((e,d)=>({...e,id:d+1})):eE.initialValues.rows;return eE.setValues({recordId:null==c?void 0:null===(a=c.record)||void 0===a?void 0:null===(o=a.header)||void 0===o?void 0:o.recordId,header:{...null==c?void 0:null===(s=c.record)||void 0===s?void 0:s.header,date:(0,i.a1)(null==c?void 0:null===(t=c.record)||void 0===t?void 0:null===(u=t.header)||void 0===u?void 0:u.date)},rows:v}),null==c?void 0:c.record}(0,a.useEffect)(()=>{eS&&eH(eS)},[]);let eQ=[{key:"Approval",condition:!0,onClick:"onApproval",disabled:!eW},{key:"Unlocked",condition:!e$,onClick:eM,disabled:!eT||!eW},{key:"Locked",condition:e$,onClick:"onUnpostConfirmation",disabled:!0},{key:"Close",condition:!eW,onClick:async()=>{var e,d;await eN({extension:q.z.Samples.close,record:JSON.stringify(eE.values.header)}),t.ZP.success(eO.Closed),eH(null==eE?void 0:null===(d=eE.values)||void 0===d?void 0:null===(e=d.header)||void 0===e?void 0:e.recordId),eG()},disabled:eW||!eT},{key:"Reopen",condition:eW,onClick:async()=>{var e,d;await eN({extension:q.z.Samples.reopen,record:JSON.stringify(eE.values.header)}),t.ZP.success(eO.Closed),eH(null==eE?void 0:null===(d=eE.values)||void 0===d?void 0:null===(e=d.header)||void 0===e?void 0:e.recordId),eG()},disabled:!eW||e$}];return(0,r.jsx)(u.Z,{resourceId:h.i.Samples,functionId:g.J.Samples,form:eE,maxAccess:e_,actions:eQ,editMode:eT,previewReport:eT,disabledSubmit:eW,children:(0,r.jsxs)(j.R,{children:[(0,r.jsx)(F.g,{children:(0,r.jsxs)(o.ZP,{container:!0,spacing:2,children:[(0,r.jsx)(o.ZP,{item:!0,xs:3,children:(0,r.jsxs)(o.ZP,{container:!0,spacing:2,children:[(0,r.jsx)(o.ZP,{item:!0,xs:12,children:(0,r.jsx)(I.Z,{endpointId:x.r.DocumentType.qry,parameters:"_startAt=0&_pageSize=1000&_dgId=".concat(g.J.Samples),name:"header.dtId",label:eR.documentType,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],readOnly:eT,valueField:"recordId",displayField:["reference","name"],values:eE.values.header,maxAccess:e_,onChange:(e,d)=>{eE.setFieldValue("header.dtId",(null==d?void 0:d.recordId)||null),ez(d)},error:(null===(l=eE.touched)||void 0===l?void 0:null===(d=l.header)||void 0===d?void 0:d.dtId)&&!!(null===(A=eE.errors)||void 0===A?void 0:null===(R=A.header)||void 0===R?void 0:R.dtId)})}),(0,r.jsx)(o.ZP,{item:!0,xs:12,children:(0,r.jsx)(m.Z,{name:"header.reference",label:eR.reference,value:null==eE?void 0:null===(_=eE.values)||void 0===_?void 0:null===(L=_.header)||void 0===L?void 0:L.reference,maxAccess:!eT&&e_,maxLength:"30",readOnly:eT,onChange:eE.handleChange,onClear:()=>eE.setFieldValue("header.reference",""),error:(null===(z=eE.touched.header)||void 0===z?void 0:z.reference)&&!!(null===(G=eE.errors.header)||void 0===G?void 0:G.reference)})}),(0,r.jsx)(o.ZP,{item:!0,xs:12,children:(0,r.jsx)(n.Z,{name:"header.date",label:eR.date,readOnly:eW,value:null==eE?void 0:null===(J=eE.values)||void 0===J?void 0:J.header.date,onChange:eE.setFieldValue,required:!0,maxAccess:e_,onClear:()=>eE.setFieldValue("header.date",null),error:(null==eE?void 0:null===(E=eE.touched)||void 0===E?void 0:null===(U=E.header)||void 0===U?void 0:U.date)&&!!(null==eE?void 0:null===($=eE.errors)||void 0===$?void 0:null===(T=$.header)||void 0===T?void 0:T.date)})}),(0,r.jsx)(o.ZP,{item:!0,xs:12,children:(0,r.jsx)(I.Z,{endpointId:y.$.Site.qry,name:"header.siteId",label:eR.site,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:eE.values.header,valueField:"recordId",displayField:["reference","name"],maxAccess:e_,readOnly:eW,onChange:(e,d)=>{eE.setFieldValue("header.siteId",(null==d?void 0:d.recordId)||null)},required:!0,error:(null==eE?void 0:null===(M=eE.touched)||void 0===M?void 0:null===(W=M.header)||void 0===W?void 0:W.siteId)&&!!(null===(H=eE.errors)||void 0===H?void 0:null===(K=H.header)||void 0===K?void 0:K.siteId)})})]})}),(0,r.jsx)(o.ZP,{item:!0,xs:3,children:(0,r.jsxs)(o.ZP,{container:!0,spacing:2,children:[(0,r.jsx)(o.ZP,{item:!0,xs:12,children:(0,r.jsx)(I.Z,{endpointId:Z.u.ProductionLine.qry,parameters:"_startAt=0&_pageSize=1000&_dtId=".concat(eE.values.header.dtId),values:eE.values.header,name:"header.productionLineId",label:eR.productionLine,valueField:"recordId",displayField:["reference","name"],displayFieldWidth:1,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],required:!0,readOnly:eW,maxAccess:e_,onChange:(e,d)=>{eE.setFieldValue("header.productionLineId",(null==d?void 0:d.recordId)||null)},error:(null==eE?void 0:null===(X=eE.touched)||void 0===X?void 0:null===(Q=X.header)||void 0===Q?void 0:Q.productionLineId)&&(null==eE?void 0:null===(Y=eE.errors)||void 0===Y?void 0:null===(B=Y.header)||void 0===B?void 0:B.productionLineId)})}),(0,r.jsx)(o.ZP,{item:!0,xs:12,children:(0,r.jsx)(I.Z,{endpointId:Z.u.ProductionStandard.qry,values:eE.values.header,name:"header.productionStandardId",label:eR.productionStandard,valueField:"recordId",displayField:"reference",required:!0,readOnly:eW,maxAccess:e_,onChange:(e,d)=>{eE.setFieldValue("header.productionStandardId",(null==d?void 0:d.recordId)||"")},error:(null==eE?void 0:null===(ed=eE.touched)||void 0===ed?void 0:null===(ee=ed.header)||void 0===ee?void 0:ee.productionStandardId)&&!!(null==eE?void 0:null===(er=eE.errors)||void 0===er?void 0:null===(el=er.header)||void 0===el?void 0:el.productionStandardId)})}),(0,r.jsx)(o.ZP,{item:!0,xs:12,children:(0,r.jsx)(I.Z,{endpointId:Z.u.ProductionClass.qry,values:eE.values.header,name:"header.productionClassId",label:eR.productionClass,valueField:"recordId",readOnly:eW,displayField:"name",maxAccess:e_,required:!0,onChange:(e,d)=>{eE.setFieldValue("header.productionClassId",(null==d?void 0:d.recordId)||"")},error:(null==eE?void 0:null===(ei=eE.touched)||void 0===ei?void 0:null===(en=ei.header)||void 0===en?void 0:en.productionClassId)&&!!(null==eE?void 0:null===(ea=eE.errors)||void 0===ea?void 0:null===(eo=ea.header)||void 0===eo?void 0:eo.productionClassId)})}),(0,r.jsx)(o.ZP,{item:!0,xs:12,children:(0,r.jsx)(D.Z,{name:"header.weight",maxAccess:e_,label:eR.sampleWgt,value:eE.values.header.weight,maxLength:10,decimalScale:2,readOnly:eW,required:!0,onChange:e=>eE.setFieldValue("header.weight",e.target.value),onClear:()=>{eE.setFieldValue("header.weight",null)},error:(null==eE?void 0:null===(eu=eE.touched)||void 0===eu?void 0:null===(es=eu.header)||void 0===es?void 0:es.weight)&&!!(null==eE?void 0:null===(ec=eE.errors)||void 0===ec?void 0:null===(et=ec.header)||void 0===et?void 0:et.weight)})}),(0,r.jsx)(o.ZP,{item:!0,xs:12,children:(0,r.jsx)(I.Z,{endpointId:Z.u.DesignFamily.qry,name:"header.designFamilyId",label:eR.familyGroup,valueField:"recordId",displayField:"name",values:eE.values.header,readOnly:eW,onChange:(e,d)=>{eE.setFieldValue("header.designFamilyId",(null==d?void 0:d.recordId)||null)},error:(null==eE?void 0:null===(eh=eE.touched)||void 0===eh?void 0:null===(ev=eh.header)||void 0===ev?void 0:ev.designFamilyId)&&!!(null==eE?void 0:null===(ep=eE.errors)||void 0===ep?void 0:null===(em=ep.header)||void 0===em?void 0:em.designFamilyId),maxAccess:e_})})]})}),(0,r.jsx)(o.ZP,{item:!0,xs:3,children:(0,r.jsxs)(o.ZP,{container:!0,spacing:2,children:[(0,r.jsx)(o.ZP,{item:!0,xs:12,children:(0,r.jsx)(P.U,{endpointId:Z.u.MFJobOrder.snapshot3,parameters:{_status:1},valueField:"reference",displayField:"reference",secondDisplayField:!1,name:"header.jobId",label:eR.jobOrder,readOnly:eW,formObject:eE.values.header,form:eE,required:!0,valueShow:"jobRef",maxAccess:eA,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"itemName",value:"Item Name"},{key:"description",value:"Description"}],onChange:(e,d)=>{eE.setFieldValue("header.jobRef",(null==d?void 0:d.reference)||""),eE.setFieldValue("header.jobId",(null==d?void 0:d.recordId)||null)},errorCheck:"header.jobId"})}),(0,r.jsx)(o.ZP,{item:!0,xs:12,children:(0,r.jsx)(P.U,{endpointId:y.$.Item.snapshot,name:"header.itemId",label:eR.sku,valueField:"sku",displayFieldWidth:2,displayField:"name",readOnly:eW,valueShow:"sku",secondValueShow:"itemName",formObject:eE.values.header,form:eE,columnsInDropDown:[{key:"sku",value:"SKU"},{key:"name",value:"Name"}],onChange:(e,d)=>{eE.setFieldValue("header.itemId",(null==d?void 0:d.recordId)||null),eE.setFieldValue("header.itemName",(null==d?void 0:d.name)||""),eE.setFieldValue("header.sku",(null==d?void 0:d.sku)||"")},errorCheck:"header.itemId",maxAccess:e_})}),(0,r.jsx)(o.ZP,{item:!0,xs:12,children:(0,r.jsx)(P.U,{endpointId:q.z.ThreeDDesign.snapshot,valueField:"reference",displayField:"reference",secondDisplayField:!1,name:"header.threeDDId",label:eR.threeDD,formObject:eE.values.header,form:eE,required:!0,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"date",value:"Date",type:"date"},{key:"designerRef",value:"Designer"}],valueShow:"threeDDRef",maxAccess:e_,readOnly:eW,onChange:(e,d)=>{eE.setFieldValue("header.threeDDRef",(null==d?void 0:d.reference)||""),eE.setFieldValue("header.threeDDId",(null==d?void 0:d.recordId)||null)},errorCheck:"header.threeDDId"})}),(0,r.jsx)(o.ZP,{item:!0,xs:12,children:(0,r.jsx)(I.Z,{endpointId:y.$.Collections.qry,name:"header.collectionId",label:eR.collection,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],required:!0,maxAccess:e_,readOnly:eW,values:eE.values.header,onChange:(e,d)=>{eE.setFieldValue("header.collectionId",(null==d?void 0:d.recordId)||null)},error:(null==eE?void 0:null===(ex=eE.touched)||void 0===ex?void 0:null===(eI=ex.header)||void 0===eI?void 0:eI.collectionId)&&!!(null==eE?void 0:null===(eg=eE.errors)||void 0===eg?void 0:null===(ey=eg.header)||void 0===ey?void 0:ey.collectionId)})}),(0,r.jsx)(o.ZP,{item:!0,xs:12,children:(0,r.jsx)(I.Z,{endpointId:Z.u.DesignGroup.qry,name:"header.designGroupId",label:eR.designGroup,valueField:"recordId",displayField:"name",values:eE.values.header,readOnly:eW,onChange:(e,d)=>{eE.setFieldValue("header.designGroupId",(null==d?void 0:d.recordId)||null)},error:(null==eE?void 0:null===(ej=eE.touched)||void 0===ej?void 0:null===(ef=ej.header)||void 0===ef?void 0:ef.designGroupId)&&!!(null==eE?void 0:null===(ek=eE.errors)||void 0===ek?void 0:null===(eF=ek.header)||void 0===eF?void 0:eF.designGroupId),maxAccess:e_})})]})}),(0,r.jsx)(o.ZP,{item:!0,xs:3,children:(0,r.jsx)(N.Z,{ref:eV,resourceId:h.i.Samples,seqNo:0,disabled:eW,recordId:eS,width:250,height:200})})]})}),(0,r.jsx)(k.Q,{children:(0,r.jsx)(f._,{onChange:e=>eE.setFieldValue("rows",e),value:eE.values.rows,error:eE.errors.rows,name:"rows",maxAccess:e_,columns:eK,allowAddNewLine:!eW,allowDelete:!eW,disabled:eW})}),(0,r.jsx)(F.g,{children:(0,r.jsxs)(o.ZP,{container:!0,spacing:2,children:[(0,r.jsx)(o.ZP,{item:!0,xs:3,children:(0,r.jsx)(m.Z,{name:"header.statusName",label:eR.statusName,value:eE.values.header.statusName,maxAccess:e_,readOnly:!0})}),(0,r.jsx)(o.ZP,{item:!0,xs:3,children:(0,r.jsx)(p.Z,{name:"header.notes",label:eR.notes,value:null==eE?void 0:null===(ew=eE.values.header)||void 0===ew?void 0:ew.notes,rows:2.5,readOnly:eW,maxAccess:e_,onChange:e=>eE.setFieldValue("header.notes",e.target.value),onClear:()=>eE.setFieldValue("header.notes",""),error:(null==eE?void 0:null===(eC=eE.touched)||void 0===eC?void 0:null===(eb=eC.header)||void 0===eb?void 0:eb.notes)&&!!(null==eE?void 0:null===(eD=eE.errors)||void 0===eD?void 0:null===(eZ=eD.header)||void 0===eZ?void 0:eZ.notes)})})]})})]})})}R.width=1200,R.height=680}}]);