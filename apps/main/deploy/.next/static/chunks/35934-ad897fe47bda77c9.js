"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[35934],{35934:function(e,n,l){l.d(n,{Z:function(){return V}});var o=l(52322),i=l(89330),r=l(39812),d=l(60218),t=l(2784),a=l(48601),s=l(82737),c=l(62202),u=l(65950),m=l(71987),p=l(26612),v=l(5088),f=l(21581),y=l(8661),h=l(38449),I=l(65215),g=l(7121),x=l(76399),b=l(31389),k=l(33625),w=l(62362),C=l(80983),j=l(19473),P=l(98345),N=l(90587),Z=l(91406),F=l(23361),O=l(61802),R=l(22341),S=l(9657),D=l(67920),A=l(39704),q=l(50023),L=l(21326);function V(e){var n,l,V,T,J,W,_,E,z;let{recordId:Q,window:$}=e,{getRequest:U,postRequest:G}=(0,t.useContext)(u.$),{platformLabels:M,userDefaultsData:B}=(0,t.useContext)(j.l),{stack:H}=(0,O.zY)(),{labels:K,access:X}=(0,q.Z)({datasetId:p.i.ProductionOrder}),{documentType:Y,maxAccess:ee,changeDT:en}=(0,P.H)({functionId:g.J.ProductionOrder,access:X,enabled:!Q});(0,L.Z)({title:K.ProductionOrder,window:$});let el=parseInt(null==B?void 0:null===(l=B.list)||void 0===l?void 0:null===(n=l.find(e=>"plantId"===e.key))||void 0===n?void 0:n.value),eo=(0,m.E)({endpointId:N.u.ProductionOrder.page}),{schema:ei,requiredFields:er}=(0,D.m)({sku:e=>null==e?void 0:e.sku,qty:e=>(null==e?void 0:e.qty)!=null,jobCount:e=>(null==e?void 0:e.jobCount)!=null,itemName:e=>null==e?void 0:e.itemName},!0,ee,"rows"),{formik:ed}=(0,C.c)({maxAccess:ee,documentType:{key:"dtId",value:null==Y?void 0:Y.dtId},conditionSchema:["rows"],initialValues:{recordId:Q,dtId:null,reference:"",plantId:el,lineId:null,notes:"",date:new Date,status:1,rows:[{id:1,poId:Q,sku:"",itemName:"",qty:null,pcs:null,designId:null,jobCount:null,notes:"",seqNo:"",lineId:null,lineRef:""}]},validateOnChange:!0,validationSchema:a.Ry({date:a.hT().required(),rows:a.IX().of(ei)}),onSubmit:async e=>{let{rows:n,date:l,...o}=e,i={...o,date:(0,r.ku)(l)},d=null==n?void 0:n.filter(e=>{var n;return null===(n=Object.values(er))||void 0===n?void 0:n.every(n=>n(e))}).map((e,n)=>({...e,poId:null!=Q?Q:0,deliveryDate:e.deliveryDate?(0,r.ku)(e.deliveryDate):null,seqNo:n+1})),t=await G({extension:N.u.ProductionOrder.set2,record:JSON.stringify({header:i,items:d})}),a=e.recordId?M.Edited:M.Added;c.ZP.success(a),eo(),ef(null==t?void 0:t.recordId)}}),et=!!ed.values.recordId,ea=3===ed.values.status,es=2===ed.values.wip,ec=null===(T=ed.values)||void 0===T?void 0:null===(V=T.rows)||void 0===V?void 0:V.reduce((e,n)=>e+(parseFloat(n.qty)||0),0).toFixed(2);async function eu(){Object.keys(await ed.validateForm()).length>0||(await G({extension:N.u.ProductionOrder.post,record:JSON.stringify({...ed.values,date:(0,r.ku)(ed.values.date)})}),c.ZP.success(M.Posted),$.close(),eo())}async function em(){let e=await G({extension:N.u.Assembly.generate,record:JSON.stringify({poId:ed.values.recordId})});H({Component:F.Z,props:{DialogText:(null==e?void 0:e.recordId)||M.NoAssembliesGenerated,fullScreen:!1,close:!0,okButtonAction:()=>$.close()},width:500,height:150,title:(null==e?void 0:e.recordId)?M.Success:M.Error})}async function ep(e){if(e){var n,l;let o=await U({extension:I.$.DocumentTypeDefaults.get,parameters:"_dtId=".concat(e)});return ed.setFieldValue("plantId",(null==o?void 0:null===(n=o.record)||void 0===n?void 0:n.plantId)?null==o?void 0:null===(l=o.record)||void 0===l?void 0:l.plantId:el),o}}(0,t.useEffect)(()=>{var e;ep(null==ed?void 0:null===(e=ed.values)||void 0===e?void 0:e.dtId)},[ed.values.dtId]);let ev=[{component:"resourcelookup",label:K.sku,name:"sku",width:100,props:{endpointId:I.$.Item.snapshot,valueField:"sku",displayField:"sku",mapping:[{from:"recordId",to:"itemId"},{from:"sku",to:"sku"},{from:"name",to:"itemName"}],columnsInDropDown:[{key:"sku",value:"SKU"},{key:"name",value:"Name"}],displayFieldWidth:3},async onChange(e){let n,l,{row:{update:o,newRow:i}}=e;if(null==i?void 0:i.itemId){let e=await U({extension:I.$.ItemProduction.get,parameters:"_recordId=".concat(i.itemId)});if(null==(n=null==e?void 0:e.record)?void 0:n.designId){var r;let n=await U({extension:N.u.Design.get,parameters:"_recordId=".concat(null===(r=e.record)||void 0===r?void 0:r.designId)});l=null==n?void 0:n.record}}o({designId:(null==n?void 0:n.designId)||null,designRef:(null==n?void 0:n.designRef)||"",lineId:(null==n?void 0:n.lineId)||null,lineRef:(null==n?void 0:n.lineRef)||"",itemWeight:(null==l?void 0:l.stdWeight)||null,routingId:(null==l?void 0:l.routingId)||null,routingRef:(null==l?void 0:l.routingRef)||"",routingName:(null==l?void 0:l.routingName)||"",jobCount:1})}},{component:"textfield",label:K.itemName,name:"itemName",width:200,props:{readOnly:!0}},{component:"textfield",label:K.design,name:"designRef",width:200,props:{readOnly:!0}},{component:"numberfield",label:K.jobCount,name:"jobCount",width:100},{component:"resourcecombobox",label:K.prodLine,name:"lineId",props:{endpointId:N.u.ProductionLine.qry,valueField:"recordId",displayField:"reference",displayFieldWidth:2,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],mapping:[{from:"reference",to:"lineRef"},{from:"recordId",to:"lineId"},{from:"name",to:"lineName"}]},width:150},{component:"date",name:"deliveryDate",width:150,label:null==K?void 0:K.deliveryDate},{component:"resourcelookup",label:K.routing,name:"routingName",width:150,props:{valueField:"reference",displayField:"reference",displayFieldWidth:2,endpointId:N.u.Routing.snapshot,mapping:[{from:"recordId",to:"routingId"},{from:"name",to:"routingName"},{from:"reference",to:"routingRef"}],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}]}},{component:"numberfield",name:"itemWeight",label:K.stdWeight,width:100,props:{maxLength:12,decimalScale:3,readOnly:!0},async onChange(e){let{row:{update:n,newRow:l}}=e;n({qty:(null==l?void 0:l.itemWeight)*(null==l?void 0:l.pcs)||0})}},{component:"numberfield",name:"pcs",label:K.ExPcs,width:100,props:{maxLength:4,decimalScale:0},async onChange(e){let{row:{update:n,newRow:l}}=e;n({qty:(null==l?void 0:l.itemWeight)*(null==l?void 0:l.pcs)||0})}},{component:"numberfield",name:"qty",width:100,label:K.ExQty,props:{maxLength:12,decimalScale:2}},{component:"resourcelookup",label:K.sizeRef,name:"sizeName",width:100,props:{endpointId:I.$.ItemSizes.snapshot,displayField:"reference",valueField:"reference",minChars:2,mapping:[{from:"recordId",to:"sizeId"},{from:"reference",to:"sizeRef"},{from:"name",to:"sizeName"}],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],displayFieldWidth:2}},{component:"resourcecombobox",label:K.jobCategory,name:"jobCategoryId",width:150,props:{endpointId:N.u.JobCategory.qry,valueField:"recordId",displayField:"name",displayFieldWidth:1.5,mapping:[{from:"name",to:"jobCategoryName"},{from:"recordId",to:"jobCategoryId"}]}},{component:"resourcelookup",label:K.client,name:"clientName",width:100,props:{endpointId:R.P.Client.snapshot,displayField:"reference",valueField:"reference",displayFieldWidth:3,minChars:2,mapping:[{from:"recordId",to:"clientId"},{from:"reference",to:"clientRef"},{from:"name",to:"clientName"}],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}]}},{component:"textfield",label:K.notes,width:200,name:"notes"}];async function ef(e){var n,l,o,i,d,t,a;let s=await U({extension:N.u.ProductionOrder.get2,parameters:"_recordId=".concat(e)}),c=(null==s?void 0:null===(l=s.record)||void 0===l?void 0:null===(n=l.items)||void 0===n?void 0:n.length)?null==s?void 0:null===(i=s.record)||void 0===i?void 0:null===(o=i.items)||void 0===o?void 0:o.map((e,n)=>({...e,deliveryDate:(0,r.a1)(e.deliveryDate),id:n+1})):ed.initialValues.rows;return ed.setValues({...null==s?void 0:null===(d=s.record)||void 0===d?void 0:d.header,date:(0,r.a1)(null==s?void 0:null===(a=s.record)||void 0===a?void 0:null===(t=a.header)||void 0===t?void 0:t.date),rows:c}),null==s?void 0:s.record}(0,t.useEffect)(()=>{Q&&ef(Q)},[]);let ey=[{key:"RecordRemarks",condition:!0,onClick:"onRecordRemarks",disabled:!et},{key:"WorkFlow",condition:!0,onClick:async()=>{H({Component:A.Z,props:{functionId:g.J.ProductionOrder,recordId:ed.values.recordId}})},disabled:!et},{key:"Unlocked",condition:!ea,onClick:eu,disabled:!et||!es},{key:"Locked",condition:ea,onClick:"onUnpostConfirmation",disabled:!0},{key:"Close",condition:!0,onClick:async()=>{Object.keys(await ed.validateForm()).length>0||(await G({extension:N.u.ProductionOrder.close,record:JSON.stringify(ed.values)}),c.ZP.success(M.Closed),ef(ed.values.recordId),eo())},disabled:es||!et},{key:"generate",condition:!0,onClick:em,disabled:!et},{key:"GenerateJob",condition:!0,onClick:eh,disabled:!ea},{key:"Import",condition:!0,onClick:async function(){H({Component:S.Z,props:{resourceId:p.i.ImportProductionOrder,access:ee,staticColumns:[{field:"poRef",value:ed.values.reference}],onSuccess:async()=>{Q&&ef(Q)}}})},disabled:!et||ea||es},{key:"Refresh",condition:!0,onClick:eI,disabled:ea}];async function eh(){let{rows:e,rsName:n,statusName:l,wipName:o,batchId:i,date:d,plantRef:t,plantName:a,isVerified:s,...u}=ed.values;await G({extension:N.u.JobOrder.gen,record:JSON.stringify({...u,date:(0,r.ku)(d)})}),c.ZP.success(M.Generated)}async function eI(){await G({extension:N.u.RefreshPoItem.refresh,record:JSON.stringify(ed.values)}),c.ZP.success(M.Refresh),ef(ed.values.recordId)}return(0,o.jsx)(s.Z,{resourceId:p.i.ProductionOrder,functionId:g.J.ProductionOrder,form:ed,maxAccess:ee,actions:ey,editMode:et,previewReport:et,disabledSubmit:ea||es,children:(0,o.jsxs)(b.R,{children:[(0,o.jsx)(k.g,{children:(0,o.jsxs)(d.ZP,{container:!0,spacing:2,children:[(0,o.jsx)(d.ZP,{item:!0,xs:6,children:(0,o.jsxs)(d.ZP,{container:!0,spacing:2,children:[(0,o.jsx)(d.ZP,{item:!0,xs:12,children:(0,o.jsx)(y.Z,{endpointId:h.r.DocumentType.qry,parameters:"_startAt=0&_pageSize=1000&_dgId=".concat(g.J.ProductionOrder),name:"dtId",label:K.documentType,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],readOnly:et,valueField:"recordId",displayField:["reference","name"],values:ed.values,maxAccess:ee,onChange:(e,n)=>{ed.setFieldValue("dtId",(null==n?void 0:n.recordId)||null),en(n)},error:ed.touched.dtId&&!!ed.errors.dtId})}),(0,o.jsx)(d.ZP,{item:!0,xs:12,children:(0,o.jsx)(v.Z,{name:"reference",label:K.reference,value:null==ed?void 0:null===(J=ed.values)||void 0===J?void 0:J.reference,maxAccess:!et&&ee,maxLength:"30",readOnly:et,onChange:ed.handleChange,onClear:()=>ed.setFieldValue("reference",""),error:ed.touched.reference&&!!ed.errors.reference})}),(0,o.jsx)(d.ZP,{item:!0,xs:12,children:(0,o.jsx)(i.Z,{name:"date",label:K.date,readOnly:ea||es,value:null==ed?void 0:null===(W=ed.values)||void 0===W?void 0:W.date,onChange:ed.setFieldValue,required:!0,maxAccess:ee,onClear:()=>ed.setFieldValue("date",null),error:ed.touched.date&&!!ed.errors.date})})]})}),(0,o.jsx)(d.ZP,{item:!0,xs:6,children:(0,o.jsxs)(d.ZP,{container:!0,spacing:2,children:[(0,o.jsx)(d.ZP,{item:!0,xs:12,children:(0,o.jsx)(y.Z,{endpointId:h.r.Plant.qry,name:"plantId",label:K.plant,readOnly:ea||es,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:ed.values,valueField:"recordId",displayField:["reference","name"],maxAccess:ee,onChange:(e,n)=>{ed.setFieldValue("plantId",null==n?void 0:n.recordId)},error:ed.touched.plantId&&!!ed.errors.plantId})}),(0,o.jsx)(d.ZP,{item:!0,xs:12,children:(0,o.jsx)(y.Z,{endpointId:N.u.ProductionLine.qry,name:"lineId",label:K.prodLine,readOnly:ea||es,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:ed.values,valueField:"recordId",displayField:["reference","name"],maxAccess:ee,onChange:(e,n)=>{ed.setFieldValue("lineId",null==n?void 0:n.recordId)},error:ed.touched.lineId&&!!ed.errors.lineId})}),(0,o.jsx)(d.ZP,{item:!0,xs:12,children:(0,o.jsx)(f.Z,{name:"notes",label:K.description,value:null==ed?void 0:null===(_=ed.values)||void 0===_?void 0:_.notes,rows:2.5,readOnly:ea||es,maxAccess:ee,onChange:ed.handleChange,onClear:()=>ed.setFieldValue("notes",""),error:ed.touched.notes&&!!ed.errors.notes})})]})})]})}),(0,o.jsx)(w.Q,{children:(0,o.jsx)(x._,{onChange:e=>ed.setFieldValue("rows",e),value:ed.values.rows,error:ed.errors.rows,name:"rows",maxAccess:ee,initialValues:null==ed?void 0:null===(z=ed.initialValues)||void 0===z?void 0:null===(E=z.rows)||void 0===E?void 0:E[0],columns:ev,allowAddNewLine:!ea&&!es,allowDelete:!ea&&!es,disabled:ea||es})}),(0,o.jsx)(k.g,{children:(0,o.jsx)(d.ZP,{container:!0,xs:6,children:(0,o.jsx)(Z.Z,{name:"totalQty",label:K.totalQty,maxAccess:ee,value:ec,maxLength:"30",readOnly:!0,error:ed.touched.totalQty&&!!ed.errors.totalQty})})})]})})}V.width=1200,V.height=680},9657:function(e,n,l){var o=l(52322),i=l(2784),r=l(60218),d=l(62202),t=l(33625),a=l(62362),s=l(31389),c=l(27723),u=l(5088),m=l(69387),p=l(39812),v=l(65950),f=l(38449),y=l(96026),h=l(21326),I=l(19473),g=l(54074),x=l(69627);let b=e=>{let[n,l,o]=e.split("/").map(e=>parseInt(e,10));return new Date(Date.UTC(o<100?2e3+o:o,l-1,n,0,0,0)).toISOString().split(".")[0]+"Z"},k=function(e,n){let l=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(""===e)return e;switch(n){case 2:return parseInt(e,10);case 3:return parseFloat(e);case 5:return l?b(e):(0,p.L6)((0,p.p6)(e));default:return e}},w=function(e,n){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],o=e.split("\n").filter(e=>e.trim());if(!o.length)return{count:0,list:[]};let i=o[0].split(",").map(e=>e.trim()),r=n.reduce((e,n)=>(e[n.headerName]=n,e),{}),d=i.map(e=>r[e]),t=o.slice(1).map((e,n)=>{let o=e.split(",").map(e=>e.trim()),r=d.reduce((e,n,l)=>{let r=i[l];return n?e[n.field]=k(o[l],n.dataType):e[r]=o[l],e},{recordId:n+1});return l.forEach(e=>{i.includes(e.field),r[e.field]=e.value}),r.minPrice&&(r.minPrice=parseFloat(r.minPrice)||0),r});return{count:t.length,list:t}},C=(e,n,l)=>{let o=n.filter(e=>e.mandatory),i=[...new Set(e.flatMap(e=>o.filter(n=>null===e[n.field]||void 0===e[n.field]||""===e[n.field]).map(e=>e.headerName)))];return!i.length||(l({message:"".concat(i.join(", ")," ").concat(i.length>1?"are":"is"," mandatory.")}),!1)},j=(e,n,l)=>{let o=n.filter(e=>e.mandatory),i=e.list.flatMap(e=>o.filter(n=>null===e[n.field]||void 0===e[n.field]||""===e[n.field]).map(e=>e.headerName));if(i.length>0){let e=[...new Set(i)];l({message:"".concat(e.join(", ")," ").concat(e.length>1?"are":"is"," mandatory field").concat(e.length>1?"s":"",".")})}return e.list.map(e=>Object.keys(e).reduce((l,o)=>{let i=n.find(e=>e.field===o),r=e[o];return r=""===r?null:r,l[o]=i?k(r,i.dataType,!0):r,l},{}))},P=e=>{var n;let{staticColumns:l=[],onSuccess:p,resourceId:b,access:k,window:P}=e,{stack:N}=(0,y.V)(),{getRequest:Z,postRequest:F}=(0,i.useContext)(v.$),{platformLabels:O}=(0,i.useContext)(I.l),[R,S]=(0,i.useState)(null),[D,A]=(0,i.useState)({count:0,list:[]}),[q,L]=(0,i.useState)(null),V=(0,i.useRef)(null);if((0,h.Z)({title:O.import,window:P}),(0,i.useEffect)(()=>{b&&Z({extension:f.r.ETL.get,parameters:"_resourceId=".concat(b)}).then(e=>{e.record&&S(e)})},[b]),!(null==R?void 0:R.record))return null;let T=(null===(n=R.record.fields)||void 0===n?void 0:n.map(e=>{let{name:n,dataType:l,format:o,...i}=e;return{field:n,headerName:n,width:130,type:2===l&&"1"===o||3===l?"number":void 0,dataType:l,...i}}))||[],J=T.map(e=>e.field),W=[...l.filter(e=>!J.includes(e.field)).map(e=>({field:e.field,headerName:e.field,width:130,dataType:1,readOnly:!0})),...T],_=R.record.objectName,E=R.record.endPoint,z=async()=>{let e=C(D.list,W,N),n=j(D,W,N);if(!e)return;let l=await F({extension:E,record:JSON.stringify({[_]:n})});null==p||p(l),d.ZP.success(O.Imported),P&&P.close()},Q=[{key:"Import",condition:!0,onClick:z,disabled:!(null==q?void 0:q.name)}];return(0,o.jsx)(g.Z,{onSave:z,disabledSubmit:!(null==q?void 0:q.name),isSaved:!1,actions:Q,maxAccess:k,isParentWindow:!1,children:(0,o.jsxs)(s.R,{children:[(0,o.jsx)(t.g,{children:(0,o.jsx)(c.Z,{leftSection:(0,o.jsx)(r.ZP,{container:!0,spacing:2,alignItems:"center",children:(0,o.jsx)(r.ZP,{item:!0,xs:4,children:(0,o.jsxs)(r.ZP,{item:!0,sx:{display:"flex",mr:2},children:[(0,o.jsx)(u.Z,{name:"name",label:null==O?void 0:O.SelectCSV,value:null==q?void 0:q.name,readOnly:!0,disabled:!!(null==q?void 0:q.name)}),(0,o.jsx)(x.Z,{label:"".concat(null==O?void 0:O.Browse,"..."),disabled:!!(null==q?void 0:q.name),onClick:()=>V.current.click(),style:{marginLeft:2}}),(0,o.jsx)("input",{type:"file",accept:".csv",ref:V,style:{display:"none"},onChange:e=>{let n=e.target.files[0];if(L(n),n){let e=new FileReader;e.onload=e=>{A(w(e.target.result,W,l))},e.readAsText(n)}}}),(0,o.jsx)(x.Z,{image:"clear.png",tooltipText:null==O?void 0:O.Clear,onClick:()=>{L(null),A({count:0,list:[]}),V.current&&(V.current.value=null)},style:{marginLeft:2,backgroundColor:"#f44336",padding:0}})]})})})})}),(0,o.jsx)(a.Q,{children:(0,o.jsx)(m.Z,{name:"import",columns:[{field:"recordId",headerName:"",width:130},...W],gridData:D,rowId:["recordId"],isLoading:!1,pageSize:50,paginationType:"api",pagination:!1,maxAccess:k,textTransform:!0})})]})})};P.width=1e3,P.height=600,n.Z=P}}]);