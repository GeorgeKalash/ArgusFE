"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[38096],{38096:function(e,l,d){var n=d(52322),a=d(60218),r=d(2784),s=d(48601),i=d(82737),t=d(62202),o=d(65950),u=d(71987),c=d(26612),v=d(80983),m=d(5088),I=d(8661),p=d(31389),h=d(62362),y=d(19473),x=d(63518),g=d(21581),D=d(39812),f=d(38449),C=d(91406),k=d(89330),F=d(7121),Z=d(98345),j=d(27423),P=d(84100),R=d(2801),b=d(44129),w=d(61802),S=d(65215),A=d(90587),N=d(93883),G=d(50023),V=d(21326);let O=e=>{var l,d,O,T,q,_,L,z,E,M,J,U;let{recordId:$,window:W}=e,{platformLabels:H}=(0,r.useContext)(y.l),{getRequest:Y,postRequest:Q}=(0,r.useContext)(o.$),{stack:B}=(0,w.zY)(),K=F.J.ThreeDDesign,X=(0,r.useRef)(null),ee=(0,u.E)({endpointId:x.z.ThreeDDesign.page}),{labels:el,access:ed}=(0,G.Z)({datasetId:c.i.ThreeDDesign,editMode:!!$});(0,V.Z)({title:el.ThreeDDesign,window:W});let{documentType:en,maxAccess:ea,changeDT:er}=(0,Z.H)({functionId:K,access:ed,enabled:!$}),{formik:es}=(0,v.c)({documentType:{key:"dtId",value:null==en?void 0:en.dtId},initialValues:{recordId:null,wip:1,status:1,dtId:null,reference:"",source:null,sketchId:null,designerId:null,setPcs:0,weight:0,castingType:null,notes:"",date:new Date,startDate:null,designGroupId:null,designFamilyId:null,endDate:null,fileReference:"",itemGroupId:null,productionClassId:null,productionStandardId:null,metalId:null,collectionId:null},maxAccess:ea,validateOnChange:!0,validationSchema:s.Ry({source:s.Rx().required(),sketchId:s.Rx().required(),castingType:s.Rx().required(),fileReference:s.Z_().required()}),onSubmit:async e=>{let l={...e,date:(0,D.ku)(e.date),startDate:e.startDate?(0,D.ku)(e.startDate):null,endDate:e.endDate?(0,D.ku)(e.endDate):null},d=await Q({extension:x.z.ThreeDDesign.set,record:JSON.stringify(l)});X.current&&(X.current.value=d.recordId,await X.current.submit()),await eu(d.recordId),ee(),t.ZP.success($?H.Edited:H.Added)}}),ei=!!es.values.recordId,et=2===es.values.wip,eo=3===es.values.status;async function eu(e){await Y({extension:x.z.ThreeDDesign.get,parameters:"_recordId=".concat(e)}).then(e=>{var l,d,n;es.setValues({...e.record,date:(0,D.a1)(null==e?void 0:null===(l=e.record)||void 0===l?void 0:l.date),startDate:(0,D.a1)(null==e?void 0:null===(d=e.record)||void 0===d?void 0:d.startDate),endDate:(0,D.a1)(null==e?void 0:null===(n=e.record)||void 0===n?void 0:n.endDate)})})}(0,r.useEffect)(()=>{!async function(){$&&await eu($)}()},[]);let ec=[{key:"Close",condition:!et,onClick:async function(){let e={...es.values,date:(0,D.ku)(es.values.date),startDate:es.values.startDate?(0,D.ku)(es.values.startDate):null,endDate:es.values.endDate?(0,D.ku)(es.values.endDate):null};await Q({extension:x.z.ThreeDDesign.close,record:JSON.stringify(e)}).then(async e=>{await eu(e.recordId),t.ZP.success(H.Closed),ee()})},disabled:!ei||eo},{key:"Reopen",condition:et,onClick:async function(){let e={...es.values,date:(0,D.ku)(es.values.date),startDate:es.values.startDate?(0,D.ku)(es.values.startDate):null,endDate:es.values.endDate?(0,D.ku)(es.values.endDate):null};await Q({extension:x.z.ThreeDDesign.reopen,record:JSON.stringify(e)}).then(async e=>{await eu(e.recordId),t.ZP.success(H.Reopened),ee()})},disabled:!ei||eo},{key:"Unlocked",condition:!eo,onClick:async()=>{let e={...es.values,date:(0,D.ku)(es.values.date),startDate:es.values.startDate?(0,D.ku)(es.values.startDate):null,endDate:es.values.endDate?(0,D.ku)(es.values.endDate):null};await Q({extension:x.z.ThreeDDesign.post,record:JSON.stringify(e)}).then(async()=>{await eu(e.recordId),t.ZP.success(H.Posted),ee()})},disabled:!ei||!et},{key:"Locked",condition:eo,onClick:"onUnpostConfirmation",disabled:!0},{key:"Approval",condition:!0,onClick:"onApproval",disabled:!et},{key:"Sketch",condition:!0,onClick:async function(){var e;B({Component:b.Z,props:{labels:el,recordId:null==es?void 0:null===(e=es.values)||void 0===e?void 0:e.sketchId,maxAccess:ed}})},disabled:!(null==es?void 0:null===(l=es.values)||void 0===l?void 0:l.sketchId)}];return(0,n.jsx)(i.Z,{resourceId:c.i.ThreeDDesign,functionId:K,form:es,maxAccess:ea,editMode:ei,actions:ec,disabledSubmit:et,children:(0,n.jsx)(p.R,{children:(0,n.jsx)(h.Q,{children:(0,n.jsxs)(a.ZP,{container:!0,spacing:2,children:[(0,n.jsx)(a.ZP,{item:!0,xs:4,children:(0,n.jsxs)(a.ZP,{container:!0,spacing:2,children:[(0,n.jsx)(a.ZP,{item:!0,xs:12,children:(0,n.jsx)(I.Z,{endpointId:f.r.DocumentType.qry,parameters:"_startAt=0&_pageSize=1000&_dgId=".concat(K),name:"dtId",label:el.doctype,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],valueField:"recordId",displayField:["reference","name"],values:es.values,maxAccess:ea,onChange:async(e,l)=>{if(es.setFieldValue("dtId",(null==l?void 0:l.recordId)||""),er(l),es.setFieldValue("productionLineId",null),null==l?void 0:l.recordId){let{record:e}=await Y({extension:x.z.DocumentTypeDefault.get,parameters:"_dtId=".concat(null==l?void 0:l.recordId)});(null==e?void 0:e.productionLineId)&&es.setValues({...es.values,dtId:null==l?void 0:l.recordId,productionLineId:null==e?void 0:e.productionLineId,sketchId:null,sketchRef:"",sketchName:"",itemGroupId:null,itemGroupRef:"",itemGroupName:"",productionClassId:null,productionClassRef:"",productionClassName:"",productionStandardId:null,productionStandardRef:"",productionStandardName:"",collectionId:null,metalPurity:null,metalId:null,designGroupId:null,designFamilyId:null})}},readOnly:ei,error:es.touched.dtId&&!!es.errors.dtId})}),(0,n.jsx)(a.ZP,{item:!0,xs:12,children:(0,n.jsx)(m.Z,{name:"reference",label:el.reference,value:es.values.reference,rows:2,maxAccess:!ei&&ea,onChange:es.handleChange,readOnly:ei,onClear:()=>es.setFieldValue("reference",""),error:es.touched.reference&&!!es.errors.reference})}),(0,n.jsx)(a.ZP,{item:!0,xs:12,children:(0,n.jsx)(I.Z,{endpointId:A.u.ProductionLine.qry,parameters:"_startAt=0&_pageSize=1000&_dtId=".concat(es.values.dtId),values:es.values,name:"productionLineId",label:el.productionLine,valueField:"recordId",displayField:["reference","name"],displayFieldWidth:1,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],readOnly:!0,maxAccess:ea,onChange:(e,l)=>{es.setFieldValue("productionLineId",(null==l?void 0:l.recordId)||null)},error:es.touched.productionLineId&&es.errors.productionLineId})}),(0,n.jsx)(a.ZP,{item:!0,xs:12,children:(0,n.jsx)(I.Z,{datasetId:P.v.THREED_DESIGN_SOURCE,name:"source",label:el.source,valueField:"key",displayField:"value",values:es.values,required:!0,maxAccess:ea,onChange:(e,l)=>{es.setFieldValue("source",(null==l?void 0:l.key)||null)},error:es.touched.source&&!!es.errors.source})}),(0,n.jsx)(a.ZP,{item:!0,xs:12,children:(0,n.jsx)(j.U,{endpointId:x.z.Sketch.snapshot3,parameters:{_productionLineId:es.values.productionLineId||0},name:"sketchId",required:!0,label:el.sketchRef,secondDisplayField:!1,valueField:"reference",valueShow:"sketchRef",columnsInDropDown:[{key:"reference",value:"Reference"},{key:"date",value:"date",type:"date"},{key:"designerRef",value:"designer Ref"},{key:"designerName",value:"designer Name",grid:4}],form:es,displayFieldWidth:2,readOnly:et,onChange:(e,l)=>{es.setValues({...es.values,sketchId:(null==l?void 0:l.recordId)||null,sketchRef:(null==l?void 0:l.reference)||"",sketchName:(null==l?void 0:l.name)||"",itemGroupId:(null==l?void 0:l.itemGroupId)||null,itemGroupRef:(null==l?void 0:l.itemGroupRef)||"",itemGroupName:(null==l?void 0:l.itemGroupName)||"",productionClassId:(null==l?void 0:l.productionClassId)||null,productionClassRef:(null==l?void 0:l.productionClassRef)||"",productionClassName:(null==l?void 0:l.productionClassName)||"",productionStandardId:(null==l?void 0:l.productionStandardId)||null,productionStandardRef:(null==l?void 0:l.productionStandardRef)||"",productionStandardName:(null==l?void 0:l.productionStandardName)||"",collectionId:(null==l?void 0:l.collectionId)||null,metalPurity:(null==l?void 0:l.metalPurity)||null,designFamilyId:(null==l?void 0:l.designFamilyId)||null,designGroupId:(null==l?void 0:l.designGroupId)||null,metalId:(null==l?void 0:l.metalId)||null})},errorCheck:"sketchId",maxAccess:ea})}),(0,n.jsx)(a.ZP,{item:!0,xs:12,children:(0,n.jsx)(I.Z,{endpointId:A.u.DesignFamily.qry,name:"designFamilyId",label:el.familyGroup,valueField:"recordId",displayField:"name",values:es.values,readOnly:!0,onChange:(e,l)=>es.setFieldValue("designFamilyId",(null==l?void 0:l.recordId)||null),error:(null==es?void 0:null===(d=es.touched)||void 0===d?void 0:d.designFamilyId)&&!!(null==es?void 0:null===(O=es.errors)||void 0===O?void 0:O.designFamilyId),maxAccess:ea})}),(0,n.jsx)(a.ZP,{item:!0,xs:12,children:(0,n.jsx)(I.Z,{endpointId:A.u.DesignGroup.qry,name:"designGroupId",label:el.designGroup,valueField:"recordId",displayField:"name",values:es.values,readOnly:!0,onChange:(e,l)=>es.setFieldValue("designGroupId",(null==l?void 0:l.recordId)||null),error:(null==es?void 0:null===(T=es.touched)||void 0===T?void 0:T.designGroupId)&&!!(null==es?void 0:null===(q=es.errors)||void 0===q?void 0:q.designGroupId),maxAccess:ea})}),(0,n.jsx)(a.ZP,{item:!0,xs:12,children:(0,n.jsx)(I.Z,{endpointId:x.z.Designer.qry,name:"designerId",label:el.designer,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"},{key:"typeName",value:"Type"}],readOnly:et,maxAccess:ea,values:es.values,onChange:(e,l)=>{es.setFieldValue("designerId",(null==l?void 0:l.recordId)||null)},error:es.touched.designerId&&!!es.errors.designerId})}),(0,n.jsx)(a.ZP,{item:!0,xs:12,children:(0,n.jsx)(a.ZP,{item:!0,xs:12,children:(0,n.jsx)(I.Z,{endpointId:S.$.Metals.qry,name:"metalId",label:el.purity,valueField:"recordId",displayField:["reference"],values:es.values,onChange:(e,l)=>{es.setFieldValue("metalId",(null==l?void 0:l.recordId)||null),es.setFieldValue("metalPurity",(null==l?void 0:l.purity)||null)},readOnly:et,error:es.touched.metalId&&!!es.errors.metalId,maxAccess:ea})})}),(0,n.jsx)(a.ZP,{item:!0,xs:12,children:(0,n.jsx)(I.Z,{endpointId:S.$.Group.qry,parameters:"_startAt=0&_pageSize=1000",values:es.values,name:"itemGroupId",label:el.itemGroup,valueField:"recordId",displayField:["reference","name"],displayFieldWidth:1,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],readOnly:et,maxAccess:ea,onChange:(e,l)=>{es.setFieldValue("itemGroupId",(null==l?void 0:l.recordId)||null)},error:es.touched.itemGroupId&&es.errors.itemGroupId})}),(0,n.jsx)(a.ZP,{item:!0,xs:12,children:(0,n.jsx)(I.Z,{endpointId:A.u.ProductionClass.qry,values:es.values,name:"productionClassId",label:el.productionClass,valueField:"recordId",readOnly:et,displayField:"name",maxAccess:ea,onChange:(e,l)=>{es.setFieldValue("productionClassId",(null==l?void 0:l.recordId)||"")},error:es.touched.productionClassId&&!!es.errors.productionClassId})}),(0,n.jsx)(a.ZP,{item:!0,xs:12,children:(0,n.jsx)(I.Z,{endpointId:A.u.ProductionStandard.qry,values:es.values,name:"productionStandardId",label:el.productionStandard,valueField:"recordId",displayField:"reference",readOnly:et,maxAccess:ea,onChange:(e,l)=>{es.setFieldValue("productionStandardId",(null==l?void 0:l.recordId)||"")},error:es.touched.productionStandardId&&!!es.errors.productionStandardId})}),(0,n.jsx)(a.ZP,{item:!0,xs:12,children:(0,n.jsx)(I.Z,{endpointId:S.$.Collections.qry,name:"collectionId",label:el.collection,valueField:"recordId",readOnly:et,displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],maxAccess:ea,values:es.values,onChange:(e,l)=>{es.setFieldValue("collectionId",null==l?void 0:l.recordId)},error:es.touched.collectionId&&!!es.errors.collectionId})}),(0,n.jsx)(a.ZP,{item:!0,xs:12,children:(0,n.jsx)(I.Z,{datasetId:P.v.CASTING_TYPE,name:"castingType",required:!0,label:el.castingType,valueField:"key",readOnly:et,displayField:"value",values:es.values,maxAccess:ea,onChange:(e,l)=>{es.setFieldValue("castingType",null==l?void 0:l.key)},error:es.touched.castingType&&!!es.errors.castingType})})]})}),(0,n.jsx)(a.ZP,{item:!0,xs:4,children:(0,n.jsxs)(a.ZP,{container:!0,spacing:2,children:[(0,n.jsx)(a.ZP,{item:!0,xs:12,sx:{marginTop:20.5},children:(0,n.jsx)(k.Z,{name:"date",label:el.date,value:null==es?void 0:null===(_=es.values)||void 0===_?void 0:_.date,onChange:es.setFieldValue,editMode:ei,maxAccess:ea,onClear:()=>es.setFieldValue("date",null),readOnly:et,error:es.touched.date&&!!es.errors.date})}),(0,n.jsx)(a.ZP,{item:!0,xs:12,children:(0,n.jsx)(N.Z,{name:"startDate",readOnly:et,label:el.startDate,onChange:es.setFieldValue,editMode:ei,maxAccess:ea,onClear:()=>es.setFieldValue("startDate",null),value:null===(L=es.values)||void 0===L?void 0:L.startDate,error:(null===(z=es.errors)||void 0===z?void 0:z.startDate)&&!!(null===(E=es.errors)||void 0===E?void 0:E.startDate)})}),(0,n.jsx)(a.ZP,{item:!0,xs:12,children:(0,n.jsx)(N.Z,{name:"endDate",readOnly:et,label:el.endDate,onChange:es.setFieldValue,editMode:ei,maxAccess:ea,onClear:()=>es.setFieldValue("endDate",null),value:null===(M=es.values)||void 0===M?void 0:M.endDate,error:(null===(J=es.errors)||void 0===J?void 0:J.endDate)&&!!(null===(U=es.errors)||void 0===U?void 0:U.endDate)})}),(0,n.jsx)(a.ZP,{item:!0,xs:12,children:(0,n.jsx)(C.Z,{name:"setPcs",label:el.setPcs,value:es.values.setPcs,maxAccess:ea,readOnly:et,onChange:es.handleChange,onClear:()=>es.setFieldValue("setPcs",0),error:es.touched.setPcs&&!!es.errors.setPcs})}),(0,n.jsx)(a.ZP,{item:!0,xs:12,children:(0,n.jsx)(C.Z,{name:"weight",label:el.weight,value:es.values.weight,maxAccess:ea,readOnly:et,onChange:es.handleChange,onClear:()=>es.setFieldValue("weight",0),error:es.touched.weight&&!!es.errors.weight})}),(0,n.jsx)(a.ZP,{item:!0,xs:12,children:(0,n.jsx)(m.Z,{name:"fileReference",required:!0,label:el.fileReference,value:es.values.fileReference,rows:2,maxAccess:ea,onChange:es.handleChange,readOnly:et,onClear:()=>es.setFieldValue("fileReference ",""),error:es.touched.fileReference&&!!es.errors.fileReference})}),(0,n.jsx)(a.ZP,{item:!0,xs:12,children:(0,n.jsx)(m.Z,{name:"statusName",label:el.statusName,value:es.values.statusName,maxAccess:ea,readOnly:!0})}),(0,n.jsx)(a.ZP,{item:!0,xs:12,children:(0,n.jsx)(g.Z,{name:"notes",label:el.notes,value:es.values.notes,maxLength:"100",rows:2,maxAccess:ea,onChange:es.handleChange,readOnly:et,onClear:()=>es.setFieldValue("notes",""),error:es.touched.notes&&!!es.errors.notes})})]})}),(0,n.jsx)(a.ZP,{item:!0,xs:4,children:(0,n.jsx)(R.Z,{ref:X,resourceId:c.i.ThreeDDesign,seqNo:0,recordId:$,height:250})})]})})})})};O.width=1200,O.height=700,l.Z=O}}]);