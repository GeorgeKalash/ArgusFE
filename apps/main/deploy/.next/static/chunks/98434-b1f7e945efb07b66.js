(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[98434],{98434:function(e,l,a){"use strict";a.d(l,{Z:function(){return $}});var d=a(52322),r=a(29326),n=a(9522),t=a(2784),o=a(60218),i=a(48601),s=a(82737),u=a(62202),c=a(65950),m=a(71987),v=a(26612),x=a(2801),h=a(80983),p=a(5088),I=a(8661),y=a(31389),b=a(19473),f=a(65215),j=a(90587),g=a(27423),Z=a(38449),w=a(91406),P=a(89330),C=a(93883),k=a(33625),N=a(21581),_=a(98345),A=a(39812),O=a(7121),R=a(74550),q=a(61802),F=a(39704);function T(e){var l,a,r,n,Z,T,D,V,Q,S,W,M;let{labels:J,maxAccess:E,setStore:B,store:L,joInvalidate:z}=e,{platformLabels:$}=(0,t.useContext)(b.l),{getRequest:U,postRequest:Y}=(0,t.useContext)(c.$),{recordId:G}=L,{stack:H}=(0,q.zY)(),X=O.J.Worksheet,K=v.i.Worksheet,ee=!!G,{documentType:el,access:ea,changeDT:ed}=(0,_.H)({functionId:X,access:E,enabled:!G}),er=(0,m.E)({endpointId:j.u.Worksheet.page}),{formik:en}=(0,h.c)({documentType:{key:"dtId",value:null==el?void 0:el.dtId},initialValues:{recordId:null,seqNo:1,dtId:null,reference:"",designRef:"",status:1,releaseStatus:null,date:new Date,jobId:null,workCenterId:null,laborId:null,siteId:null,notes:"",qty:0,routingId:null,wipQty:0,rmQty:0,wipPcs:0,duration:0,jobQty:0,jobPcs:0,startTime:null,endTime:null,wgtBefore:null,wgtAfter:null,eopQty:0,damagedPcs:null,shiftId:null,category:"",pgItemName:"",itemCategoryName:""},maxAccess:ea,validationSchema:i.Ry({jobId:i.Rx().required(),workCenterId:i.Rx().required(),laborId:i.Rx().required(),wipQty:i.Rx().required(),siteId:i.Rx().required(),qty:i.Rx().required(),jobQty:i.Rx().required()}),onSubmit:async e=>{let l={...e,date:(0,A.ku)(null==e?void 0:e.date),startTime:(0,A.ku)(new Date),endTime:(0,A.ku)(new Date)};await Y({extension:j.u.Worksheet.set,record:JSON.stringify({...l})}).then(async a=>{e.recordId||B(e=>({...e,recordId:null==a?void 0:a.recordId,isPosted:(null==a?void 0:a.status)==3,values:l})),et(a.recordId),u.ZP.success(e.recordId?$.Edited:$.Added),z?z():er()})}}),et=async e=>{await U({extension:j.u.Worksheet.get,parameters:"_recordId=".concat(e||en.values.recordId)}).then(async e=>{var l,a,d,r,n;let t=await U({extension:j.u.WorkCenter.get,parameters:"_recordId=".concat(null==e?void 0:null===(l=e.record)||void 0===l?void 0:l.workCenterId)});en.setValues({...null==e?void 0:e.record,date:(0,A.a1)(null==e?void 0:null===(a=e.record)||void 0===a?void 0:a.date),startTime:(0,A.a1)(null==e?void 0:null===(d=e.record)||void 0===d?void 0:d.startTime),endTime:(0,A.a1)(null==e?void 0:null===(r=e.record)||void 0===r?void 0:r.endTime),siteId:null==t?void 0:null===(n=t.record)||void 0===n?void 0:n.siteId}),B(l=>{var a,d,r;return{...l,isPosted:(null==e?void 0:null===(a=e.record)||void 0===a?void 0:a.status)==3,values:{...null==e?void 0:e.record,siteId:null==t?void 0:null===(d=t.record)||void 0===d?void 0:d.siteId,date:(0,A.a1)(null==e?void 0:null===(r=e.record)||void 0===r?void 0:r.date)}}})})};(0,t.useEffect)(()=>{!async function(){G&&await et(G)}()},[]);let eo=3===en.values.status,ei=[{key:"WorkFlow",condition:!0,onClick:async()=>{H({Component:F.Z,props:{functionId:X,recordId:en.values.recordId}})},disabled:!ee||eo},{key:"Unlocked",condition:!eo,onClick:async()=>{var e;let l={...en.values,date:(0,A.ku)(null==en?void 0:null===(e=en.values)||void 0===e?void 0:e.date)||null};await Y({extension:j.u.Worksheet.post,record:JSON.stringify(l)}).then(async()=>{await et(),z?z():er(),u.ZP.success($.Posted)})},disabled:!ee},{key:"Locked",condition:eo,disabled:!0},{key:"IV",condition:!0,onClick:"onInventoryTransaction",disabled:!ee||!eo},{key:"GL",condition:!0,onClick:"onClickGL",datasetId:v.i.GLWorksheet,disabled:!ee},{key:"Damage",condition:!0,onClick:()=>{var e;H({Component:R.Z,props:{jobId:null==en?void 0:null===(e=en.values)||void 0===e?void 0:e.jobId},width:1e3,height:700,title:J.Damage})},disabled:!ee}],es=async e=>{if(e){var l,a,d,r;let n=await U({extension:j.u.DocumentTypeDefault.get,parameters:"_dtId=".concat(e)}),t=n.record&&await U({extension:j.u.WorkCenter.get,parameters:"_recordId=".concat(null==n?void 0:null===(l=n.record)||void 0===l?void 0:l.workCenterId)});en.setFieldValue("dtId",e||null),en.setFieldValue("siteName",(null==t?void 0:null===(a=t.record)||void 0===a?void 0:a.siteName)||""),en.setFieldValue("siteId",(null==t?void 0:null===(d=t.record)||void 0===d?void 0:d.siteId)||null),en.setFieldValue("workCenterId",(null==n?void 0:null===(r=n.record)||void 0===r?void 0:r.workCenterId)||null)}else en.setFieldValue("dtId",null),en.setFieldValue("siteId",null),en.setFieldValue("siteName",""),en.setFieldValue("laborId",null),en.setFieldValue("workCenterId",null)};return(0,t.useEffect)(()=>{!async function(){!G&&(null==el?void 0:el.dtId)&&es(null==el?void 0:el.dtId)}()},[null==el?void 0:el.dtId]),(0,d.jsx)(s.Z,{resourceId:K,functionId:X,form:en,maxAccess:ea,editMode:ee,actions:ei,previewReport:!0,disabledSubmit:eo,children:(0,d.jsx)(y.R,{children:(0,d.jsx)(k.g,{children:(0,d.jsxs)(o.ZP,{container:!0,children:[(0,d.jsx)(o.ZP,{item:!0,xs:8,children:(0,d.jsxs)(o.ZP,{container:!0,spacing:2,children:[(0,d.jsx)(o.ZP,{item:!0,xs:12,children:(0,d.jsx)(I.Z,{endpointId:j.u.Worksheet.pack,reducer:e=>{var l;return null==e?void 0:null===(l=e.record)||void 0===l?void 0:l.documentTypes},name:"dtId",label:J.documentType,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],valueField:"recordId",displayField:["reference","name"],values:en.values,maxAccess:ea,onChange:async(e,l)=>{await es(null==l?void 0:l.recordId),en.setFieldValue("dtId",(null==l?void 0:l.recordId)||null),ed(l)},readOnly:ee,error:en.touched.dtId&&!!en.errors.dtId})}),(0,d.jsx)(o.ZP,{item:!0,xs:6,children:(0,d.jsxs)(o.ZP,{container:!0,spacing:2,children:[(0,d.jsx)(o.ZP,{item:!0,xs:12,children:(0,d.jsx)(p.Z,{name:"reference",label:J.reference,value:en.values.reference,readOnly:ee,maxLength:"15",maxAccess:!ee&&ea,onChange:en.handleChange,onClear:()=>en.setFieldValue("reference",""),error:en.touched.reference&&!!en.errors.reference})}),(0,d.jsx)(o.ZP,{item:!0,xs:12,children:(0,d.jsx)(g.U,{endpointId:j.u.MFJobOrder.snapshot2,parameters:{_workCenterId:en.values.workCenterId},name:"jobRef",label:J.jobRef,valueField:"jobRef",displayField:"jobRef",valueShow:"jobRef",columnsInDropDown:[{key:"jobRef",value:"Job Order"},{key:"designRef",value:"Design Ref"}],readOnly:!(null==en?void 0:null===(l=en.values)||void 0===l?void 0:l.workCenterId)||eo||ee,required:!0,secondDisplayField:!1,form:en,onChange:async(e,l)=>{var a,d,r,n,t,o,i,s,u;if(!(null==l?void 0:l.jobId))return;let c=await U({extension:j.u.MFJobOrder.get,parameters:"_recordId=".concat(null==l?void 0:l.jobId)});if(en.setValues({...en.values,jobId:(null==l?void 0:l.jobId)||null,jobRef:(null==l?void 0:l.jobRef)||"",routingId:(null==c?void 0:null===(a=c.record)||void 0===a?void 0:a.routingId)||null,designRef:(null==c?void 0:null===(d=c.record)||void 0===d?void 0:d.designRef)||"",pgItemName:(null==c?void 0:null===(r=c.record)||void 0===r?void 0:r.itemName)||"",pgItemId:(null==c?void 0:null===(n=c.record)||void 0===n?void 0:n.itemId)||null,category:(null==c?void 0:null===(t=c.record)||void 0===t?void 0:t.categoryName)||"",jobQty:(null==l?void 0:l.qty)||0,jobPcs:(null==l?void 0:l.pcs)||0,wipQty:(null==l?void 0:l.qty)||0,wipPcs:(null==l?void 0:l.pcs)||0,seqNo:(null==c?void 0:null===(o=c.record)||void 0===o?void 0:o.routingSeqNo)||1,laborId:null,laborRef:"",laborName:""}),null==c?void 0:null===(i=c.record)||void 0===i?void 0:i.itemId){let e=await U({extension:f.$.Item.get,parameters:"_recordId=".concat(null==c?void 0:null===(s=c.record)||void 0===s?void 0:s.itemId)});en.setFieldValue("itemCategoryName",(null==e?void 0:null===(u=e.record)||void 0===u?void 0:u.categoryName)||null)}},errorCheck:"jobId",maxAccess:ea})}),(0,d.jsx)(o.ZP,{item:!0,xs:12,children:(0,d.jsx)(I.Z,{endpointId:j.u.Worksheet.pack,reducer:e=>{var l;return null==e?void 0:null===(l=e.record)||void 0===l?void 0:l.workCenters},name:"workCenterId",label:J.workCenter,readOnly:!0,valueField:"recordId",displayField:["reference","name"],values:en.values,required:!0,maxAccess:ea,error:en.touched.workCenterId&&en.errors.workCenterId})}),(0,d.jsx)(o.ZP,{item:!0,xs:12,children:(0,d.jsx)(I.Z,{endpointId:en.values.workCenterId&&j.u.Labor.qry2,parameters:"_workCenterId=".concat(en.values.workCenterId),name:"laborId",label:J.labor,required:!0,maxAccess:ea,readOnly:!en.values.workCenterId||eo,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],valueField:"recordId",displayField:["reference","name"],values:en.values,onChange:(e,l)=>{en.setFieldValue("laborId",(null==l?void 0:l.recordId)||null)},error:en.touched.laborId&&!!en.errors.laborId})}),(0,d.jsx)(o.ZP,{item:!0,xs:6,children:(0,d.jsx)(w.Z,{name:"wipQty",required:!0,readOnly:eo||ee,label:J.qty,value:null==en?void 0:null===(a=en.values)||void 0===a?void 0:a.wipQty,maxAccess:ea,onChange:en.handleChange,onClear:()=>en.setFieldValue("wipQty",0),error:en.touched.wipQty&&!!en.errors.wipQty,decimalScale:3})}),(0,d.jsx)(o.ZP,{item:!0,xs:6,children:(0,d.jsx)(w.Z,{name:"wipPcs",readOnly:eo||ee,label:J.pcs,value:null==en?void 0:null===(r=en.values)||void 0===r?void 0:r.wipPcs,maxAccess:ea,onChange:en.handleChange,onClear:()=>en.setFieldValue("wipPcs",0),error:en.touched.wipPcs&&!!en.errors.wipPcs,decimalScale:3})}),(0,d.jsx)(o.ZP,{item:!0,xs:6,children:(0,d.jsx)(w.Z,{name:"rmQty",readOnly:!0,label:J.rmQty,value:null==en?void 0:null===(n=en.values)||void 0===n?void 0:n.rmQty,maxAccess:ea})}),(0,d.jsx)(o.ZP,{item:!0,xs:6,children:(0,d.jsx)(w.Z,{name:"damagedPcs",readOnly:!0,label:J.damagedPcs,value:null==en?void 0:null===(Z=en.values)||void 0===Z?void 0:Z.damagedPcs,maxAccess:ea})}),(0,d.jsx)(o.ZP,{item:!0,xs:6,children:(0,d.jsx)(w.Z,{name:"eopQty",readOnly:!0,label:J.eopQty,value:null==en?void 0:null===(T=en.values)||void 0===T?void 0:T.eopQty,maxAccess:ea})}),(0,d.jsx)(o.ZP,{item:!0,xs:6,children:(0,d.jsx)(w.Z,{name:"endPcs",readOnly:!0,label:J.endPcs,value:((null==en?void 0:null===(D=en.values)||void 0===D?void 0:D.wipPcs)||0)-((null==en?void 0:null===(V=en.values)||void 0===V?void 0:V.damagedPcs)||0),maxAccess:ea})}),(0,d.jsx)(o.ZP,{item:!0,xs:12,children:(0,d.jsx)(N.Z,{name:"notes",readOnly:eo,label:J.notes,value:en.values.notes,rows:3,maxLength:"100",editMode:ee,maxAccess:ea,onChange:e=>en.setFieldValue("notes",e.target.value),onClear:()=>en.setFieldValue("notes","")})})]})}),(0,d.jsx)(o.ZP,{item:!0,xs:6,children:(0,d.jsxs)(o.ZP,{container:!0,spacing:2,children:[(0,d.jsx)(o.ZP,{item:!0,xs:12,children:(0,d.jsx)(p.Z,{name:"pgItemName",label:J.pgItem,value:en.values.pgItemName,readOnly:!0,maxAccess:ea})}),(0,d.jsx)(o.ZP,{item:!0,xs:12,children:(0,d.jsx)(p.Z,{name:"itemCategoryName",label:J.itemCategory,value:en.values.itemCategoryName,readOnly:!0,maxAccess:ea})}),(0,d.jsx)(o.ZP,{item:!0,xs:12,children:(0,d.jsx)(p.Z,{name:"category",label:J.jobCategory,value:en.values.category,readOnly:!0,maxAccess:ea})}),(0,d.jsx)(o.ZP,{item:!0,xs:12,children:(0,d.jsx)(I.Z,{endpointId:j.u.Worksheet.pack,reducer:e=>{var l;return null==e?void 0:null===(l=e.record)||void 0===l?void 0:l.sites},name:"siteId",label:J.site,required:!0,readOnly:!0,values:en.values,displayField:"name",maxAccess:ea,error:en.touched.siteId&&!!en.errors.siteId})}),(0,d.jsx)(o.ZP,{item:!0,xs:12,children:(0,d.jsx)(p.Z,{name:"designRef",label:J.designRef,value:en.values.designRef,readOnly:!0,maxAccess:ea})}),(0,d.jsx)(o.ZP,{item:!0,xs:12,children:(0,d.jsx)(w.Z,{name:"jobQty",label:J.jobQty,value:en.values.jobQty,required:!0,readOnly:!0,maxAccess:ea})}),(0,d.jsx)(o.ZP,{item:!0,xs:12,children:(0,d.jsx)(w.Z,{name:"jobPcs",label:J.jobPcs,value:en.values.jobPcs,readOnly:!0,maxAccess:ea})}),(0,d.jsx)(o.ZP,{item:!0,xs:12,children:(0,d.jsx)(w.Z,{name:"wgtBefore",readOnly:eo,label:J.wgtBefore,value:null==en?void 0:null===(Q=en.values)||void 0===Q?void 0:Q.wgtBefore,maxAccess:ea,onChange:en.handleChange,onClear:()=>en.setFieldValue("wgtBefore",""),error:en.touched.wgtBefore&&!!en.errors.wgtBefore,decimalScale:3})}),(0,d.jsx)(o.ZP,{item:!0,xs:12,children:(0,d.jsx)(w.Z,{name:"wgtAfter",readOnly:eo,label:J.wgtAfter,value:null==en?void 0:null===(S=en.values)||void 0===S?void 0:S.wgtAfter,maxAccess:ea,onChange:en.handleChange,onClear:()=>en.setFieldValue("wgtAfter",""),error:en.touched.wgtAfter&&!!en.errors.wgtAfter,decimalScale:3})})]})})]})}),(0,d.jsx)(o.ZP,{item:!0,xs:4,children:(0,d.jsxs)(o.ZP,{container:!0,spacing:2,children:[(0,d.jsx)(o.ZP,{item:!0,xs:12,children:(0,d.jsx)(x.Z,{resourceId:v.i.MFJobOrders,seqNo:0,recordId:en.values.jobId,customWidth:320,customHeight:190,isAbsolutePath:!0,disabled:!0})}),(0,d.jsx)(o.ZP,{item:!0,xs:12,children:(0,d.jsx)(P.Z,{name:"date",readOnly:!0,label:J.date,value:en.values.date,maxAccess:ea})}),(0,d.jsx)(o.ZP,{item:!0,xs:12,children:(0,d.jsx)(C.Z,{name:"startTime",readOnly:!0,label:J.startTime,value:null===(W=en.values)||void 0===W?void 0:W.startTime,maxAccess:ea})}),(0,d.jsx)(o.ZP,{item:!0,xs:12,children:(0,d.jsx)(C.Z,{name:"endTime",readOnly:!0,label:J.endTime,value:null===(M=en.values)||void 0===M?void 0:M.endTime,maxAccess:ea})}),(0,d.jsx)(o.ZP,{item:!0,xs:12,children:(0,d.jsx)(I.Z,{endpointId:j.u.Worksheet.pack,reducer:e=>{var l;return null==e?void 0:null===(l=e.record)||void 0===l?void 0:l.shifts},name:"shiftId",label:J.shift,maxAccess:ea,readOnly:eo,valueField:"recordId",displayField:"name",values:en.values,onChange:(e,l)=>{en.setFieldValue("shiftId",(null==l?void 0:l.recordId)||null)},error:en.touched.shiftId&&!!en.errors.shiftId})})]})})]})})})})}var D=a(69387),V=a(62362),Q=a(27723),S=a(84100),W=a(76399);function M(e){var l,a,r,n,x,g,C,A,R,q,F,T,D,Q,M,J,E,B;let{labels:L,access:z,recordId:$,wsId:U,values:Y,isPosted:G}=e,{getRequest:H,postRequest:X}=(0,t.useContext)(c.$),{platformLabels:K,defaultsData:ee}=(0,t.useContext)(b.l),el=O.J.IssueOfMaterial,ea=v.i.IssueOfMaterials,ed=e=>{var l;return(null===(l=ee.list.find(l=>l.key===e))||void 0===l?void 0:l.value)||0},er=e=>{var l;return ed("ivtDimension".concat(null===(l=ee.list.find(l=>l.key===e))||void 0===l?void 0:l.value))},en=["mfimd1","mfimd2"],et=en.map(e=>Number(ed(e))),{documentType:eo,maxAccess:ei,changeDT:es}=(0,_.H)({functionId:el,access:z,enabled:!$}),eu=(0,m.E)({endpointId:j.u.WorksheetMaterials.qry}),{formik:ec}=(0,h.c)({documentType:{key:"header.dtId",value:null==eo?void 0:eo.dtId},initialValues:{recordId:$,header:{jobId:Y.jobId,notes:"",siteId:Y.siteId,status:1,worksheetId:U,dtId:null,currencyId:null,operationId:null,type:null,reference:"",wsJobRef:Y.reference,joJobRef:Y.jobRef,date:Y.date,pgItemName:Y.pgItemName,laborName:Y.laborName,wipQty:Y.wipQty||0,wipPcs:Y.wipPcs||0},items:[{id:1,imaId:$||0,worksheetId:U,seqNo:1,itemId:null,sku:"",itemName:"",unitCost:0,trackBy:0,qty:0,pcs:0}]},maxAccess:ei,validateOnChange:!0,validationSchema:i.Ry({header:i.Ry({operationId:i.Rx().required(),type:i.Rx().required()}),items:i.IX().of(i.Ry({sku:i.Z_().required(),itemName:i.Z_().required(),qty:i.Rx().required()}))}),onSubmit:async e=>{var l;let a={...e,jobId:Y.jobId,siteId:Y.siteId,date:Y.date,items:null==e?void 0:null===(l=e.items)||void 0===l?void 0:l.map((e,l)=>({...e,imaId:$||0,unitCost:e.unitCost||0,seqNo:l+1}))},d=await X({extension:j.u.WorksheetMaterials.set2,record:JSON.stringify(a)}),r=[];for(let e of a.items){let{seqNo:l}=e;et.forEach((a,n)=>{let t="dim".concat(n+1,"Id"),o="dimensionName".concat(n+1);e[t]&&r.push({imaId:d.recordId,seqNo:l,dimension:a,dimensionName:e[o],id:e[t]})})}for(let e of r)await X({extension:j.u.IssueOfMaterialDimension.set,record:JSON.stringify(e)});u.ZP.success(e.recordId?K.Edited:K.Added),eu(),await em(d.recordId)}});(0,t.useEffect)(()=>{!async function(){em($)}()},[]);let em=async e=>{var l,a;if(!e)return;let d=await H({extension:j.u.WorksheetMaterials.pack,parameters:"_recordId=".concat(e)}),r=(null==d?void 0:null===(l=d.record)||void 0===l?void 0:l.header)||{},n=(null==d?void 0:null===(a=d.record)||void 0===a?void 0:a.items)||[],t=await Promise.all(n.map(async(e,l)=>{var a;let r=(((null==d?void 0:null===(a=d.record)||void 0===a?void 0:a.dimensions)||[]).filter(l=>(null==l?void 0:l.seqNo)===(null==e?void 0:e.seqNo))||[]).sort((e,l)=>e.dimension-l.dimension),n={};return r.forEach(e=>{let l=et.findIndex(l=>l===e.dimension);if(-1!==l){let a=l+1;n["dim".concat(a,"Id")]=e.id,n["dimensionName".concat(a)]=e.dimensionName}}),{id:l+1,...e,...n}}));Y&&ec.setValues({recordId:e,header:{...ec.values.header,...r,siteId:Y.siteId,wsJobRef:Y.reference,joJobRef:Y.jobRef,date:Y.date,pgItemName:Y.pgItemName,laborName:Y.laborName,wipQty:Y.wipQty,wipPcs:Y.wipPcs,jobId:Y.jobId},items:t})};async function ev(e,l){if(1==e){var a;let e=await H({extension:j.u.DesignRawMaterial.qry2,parameters:"_jobId=".concat(Y.jobId,"&_operationId=").concat(l,"&_pcs=").concat(Y.wipPcs)});ec.setFieldValue("items",(null==e?void 0:null===(a=e.list)||void 0===a?void 0:a.map((e,l)=>{let{...a}=e;return{id:l+1,...a,pcs:a.pcs||0,qty:a.qty||0}}))||ec.values.items)}}let ex=!!(null==ec?void 0:null===(a=ec.values)||void 0===a?void 0:null===(l=a.header)||void 0===l?void 0:l.recordId),eh=null!==(M=null===(n=ec.values)||void 0===n?void 0:null===(r=n.items)||void 0===r?void 0:r.reduce((e,l)=>e+(parseFloat(l.qty)||0),0))&&void 0!==M?M:0,ep=null!==(J=null===(g=ec.values)||void 0===g?void 0:null===(x=g.items)||void 0===x?void 0:x.reduce((e,l)=>e+(parseFloat(l.pcs)||0),0))&&void 0!==J?J:0,eI=null!==(E=null===(C=ec.values.items)||void 0===C?void 0:C.reduce((e,l)=>{let{designQty:a=0}=l;return e+(Number(a)||0)},0))&&void 0!==E?E:0,ey=null!==(B=null===(A=ec.values.items)||void 0===A?void 0:A.reduce((e,l)=>{let{designPcs:a=0}=l;return e+(Number(a)||0)},0))&&void 0!==B?B:0,eb=et.map((e,l)=>e?{component:"resourcecombobox",label:er(en[l]),name:"dimensionName".concat(l+1),props:{endpointId:f.$.Dimension.qry,dynamicParams:"_dimension=".concat(e),valueField:"id",displayField:"name",mapping:[{from:"id",to:"dim".concat(l+1,"Id")},{from:"name",to:"dimensionName".concat(l+1)}],displayFieldWidth:2}}:null).filter(Boolean);return(0,d.jsx)(s.Z,{resourceId:ea,form:ec,maxAccess:ei,editMode:ex,disabledSubmit:G,children:(0,d.jsxs)(y.R,{children:[(0,d.jsx)(k.g,{children:(0,d.jsxs)(o.ZP,{container:!0,spacing:2,children:[(0,d.jsx)(o.ZP,{item:!0,xs:4,children:(0,d.jsx)(I.Z,{endpointId:Z.r.DocumentType.qry,parameters:"_startAt=0&_pageSize=1000&_dgId=".concat(el),name:"dtId",label:L.documentType,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],valueField:"recordId",displayField:["reference","name"],values:ec.values.header,maxAccess:ei,onChange:(e,l)=>{ec.setFieldValue("header.dtId",(null==l?void 0:l.recordId)||""),es(l)},readOnly:ex,error:(null===(R=ec.touched.header)||void 0===R?void 0:R.dtId)&&!!ec.errors.dtId})}),(0,d.jsx)(o.ZP,{item:!0,xs:4,children:(0,d.jsx)(p.Z,{name:"wsJobRef",label:L.wsJobRef,value:ec.values.header.wsJobRef,readOnly:!0,maxAccess:ei})}),(0,d.jsx)(o.ZP,{item:!0,xs:4,children:(0,d.jsx)(p.Z,{name:"laborName",label:L.labor,value:ec.values.header.laborName,readOnly:!0,maxAccess:ei})}),(0,d.jsx)(o.ZP,{item:!0,xs:4,children:(0,d.jsx)(p.Z,{name:"reference",label:L.reference,value:ec.values.header.reference,rows:2,maxAccess:ei,onChange:ec.handleChange,readOnly:ex,onClear:()=>ec.setFieldValue("header.reference",""),error:(null===(q=ec.touched.header)||void 0===q?void 0:q.reference)&&!!ec.errors.reference})}),(0,d.jsx)(o.ZP,{item:!0,xs:4,children:(0,d.jsx)(p.Z,{name:"joJobRef",label:L.joJobRef,value:ec.values.header.joJobRef,readOnly:!0,maxAccess:ei})}),(0,d.jsx)(o.ZP,{item:!0,xs:4,children:(0,d.jsx)(p.Z,{name:"wipQty",label:L.wsQty,value:ec.values.header.wipQty,readOnly:!0,maxAccess:ei})}),(0,d.jsx)(o.ZP,{item:!0,xs:4,children:(0,d.jsx)(I.Z,{endpointId:j.u.Operation.qry,parameters:"_workCenterId=".concat(Y.workCenterId,"&_startAt=0&_pageSize=100&"),name:"operationId",label:L.operation,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],required:!0,valueField:"recordId",displayField:["reference","name"],values:ec.values.header,maxAccess:ei,readOnly:G,onChange:(e,l)=>{ec.setFieldValue("header.operationId",(null==l?void 0:l.recordId)||null),(null==l?void 0:l.recordId)&&ec.values.header.type&&ev(ec.values.header.type,null==l?void 0:l.recordId)},error:(null===(F=ec.touched.header)||void 0===F?void 0:F.operationId)&&!!(null===(T=ec.errors.header)||void 0===T?void 0:T.operationId)})}),(0,d.jsx)(o.ZP,{item:!0,xs:4,children:(0,d.jsx)(P.Z,{name:"date",label:L.date,value:ec.values.header.date,readOnly:!0,maxAccess:ei})}),(0,d.jsx)(o.ZP,{item:!0,xs:4,children:(0,d.jsx)(p.Z,{name:"wipPcs",label:L.wsPcs,value:ec.values.header.wipPcs,readOnly:!0,maxAccess:ei})}),(0,d.jsx)(o.ZP,{item:!0,xs:4,children:(0,d.jsx)(I.Z,{datasetId:S.v.MF_IOM_TYPE,name:"type",label:L.type,valueField:"key",displayField:"value",values:ec.values.header,required:!0,readOnly:ex,maxAccess:ei,onChange:(e,l)=>{ec.setFieldValue("header.type",(null==l?void 0:l.key)||null),(null==l?void 0:l.key)&&ec.values.header.operationId&&ev(null==l?void 0:l.key,ec.values.header.operationId)},error:(null===(D=ec.touched.header)||void 0===D?void 0:D.type)&&!!(null===(Q=ec.errors.header)||void 0===Q?void 0:Q.type)})}),(0,d.jsx)(o.ZP,{item:!0,xs:4,children:(0,d.jsx)(p.Z,{name:"pgItemName",label:L.pgItem,value:ec.values.header.pgItemName,readOnly:!0,maxAccess:ei})})]})}),(0,d.jsx)(V.Q,{children:(0,d.jsx)(W._,{onChange:e=>ec.setFieldValue("items",e),name:"items",value:ec.values.items,error:ec.errors.items,maxAccess:z,columns:[{component:"resourcelookup",label:L.sku,name:"sku",props:{endpointId:f.$.Materials.snapshot,valueField:"recordId",displayField:"sku",mandatory:!0,displayFieldWidth:3,mapping:[{from:"recordId",to:"itemId"},{from:"sku",to:"sku"},{from:"name",to:"itemName"}],columnsInDropDown:[{key:"sku",value:"SKU"},{key:"name",value:"Name"}]},async onChange(e){let{row:{update:l,newRow:a}}=e;if(null==a?void 0:a.itemId){var d,r;let e=await H({extension:f.$.CurrentCost.get,parameters:"_itemId=".concat(null==a?void 0:a.itemId)}),n=await H({extension:f.$.ItemProduction.get,parameters:"_recordId=".concat(null==a?void 0:a.itemId)});l({unitCost:(null==e?void 0:null===(d=e.record)||void 0===d?void 0:d.unitCost)||0,rmCategoryName:null==n?void 0:null===(r=n.record)||void 0===r?void 0:r.rmcName})}}},{component:"textfield",label:L.item,name:"itemName",props:{readOnly:!0}},{component:"textfield",label:L.rawCategory,name:"rmCategoryName",props:{readOnly:!0}},{component:"numberfield",label:L.lot,name:"lotCategoryId",props:{readOnly:!0}},{component:"numberfield",label:L.expectedQty,name:"designQty",props:{readOnly:!0}},{component:"numberfield",label:L.expectedPcs,name:"designPcs",props:{readOnly:!0}},...eb,{component:"numberfield",label:L.quantity,name:"qty",props:{maxLength:10}},{component:"numberfield",label:L.pieces,name:"pcs",props:{decimalScale:0}}],disabled:G,allowDelete:!G,allowAddNewLine:!G})}),(0,d.jsx)(k.g,{children:(0,d.jsxs)(o.ZP,{container:!0,spacing:2,children:[(0,d.jsx)(o.ZP,{item:!0,xs:3,children:(0,d.jsx)(N.Z,{name:"notes",label:L.notes,value:ec.values.header.notes,rows:2,maxLength:"100",editMode:ex,readOnly:G,maxAccess:ei,onChange:e=>ec.setFieldValue("header.notes",e.target.value),onClear:()=>ec.setFieldValue("header.notes","")})}),(0,d.jsx)(o.ZP,{item:!0,xs:1}),(0,d.jsx)(o.ZP,{item:!0,xs:2,children:(0,d.jsx)(w.Z,{name:"totalExpQty",label:L.totalExpQty,value:eI,readOnly:!0})}),(0,d.jsx)(o.ZP,{item:!0,xs:2,children:(0,d.jsx)(w.Z,{name:"totalExpPcs",label:L.totalExpPcs,value:ey,readOnly:!0})}),(0,d.jsx)(o.ZP,{item:!0,xs:2,children:(0,d.jsx)(w.Z,{name:"totalQty",label:L.totalQty,value:eh,readOnly:!0})}),(0,d.jsx)(o.ZP,{item:!0,xs:2,children:(0,d.jsx)(w.Z,{name:"totalPcs",label:L.totalPcs,value:ep,readOnly:!0})})]})})]})})}var J=e=>{var l;let{store:a}=e,{platformLabels:r}=(0,t.useContext)(b.l),{recordId:n,isPosted:i,values:s}=a,{getRequest:x,postRequest:h}=(0,t.useContext)(c.$),{stack:p}=(0,q.zY)(),{query:{data:I},invalidate:f,labels:g,access:Z}=(0,m.J)({queryFn:C,endpointId:j.u.WorksheetMaterials.qry,datasetId:v.i.IssueOfMaterials,enabled:!!n}),P=[{field:"reference",headerName:g.reference,flex:1},{field:"date",headerName:g.date,flex:1,type:"date"},{field:"typeName",headerName:g.type,flex:1},{field:"operationName",headerName:g.operation,flex:1},{field:"qty",headerName:g.qty,flex:1,type:{field:"number",decimal:2}},{field:"notes",headerName:g.notes,flex:1}];async function C(){return await x({extension:j.u.WorksheetMaterials.qry,parameters:"_worksheetId=".concat(n)})}let N=async e=>{await h({extension:j.u.WorksheetMaterials.del,record:JSON.stringify(e)}),f(),u.ZP.success(r.Deleted)},{proxyAction:A}=(0,_.G)({functionId:O.J.IssueOfMaterial,action:R});function R(e){p({Component:M,props:{labels:g,recordId:null==e?void 0:e.recordId,wsId:n,isPosted:i,access:Z,values:s},width:1200,height:700,title:g.issueOfMaterials})}let F=async()=>{await A()},T=null==I?void 0:null===(l=I.list)||void 0===l?void 0:l.reduce((e,l)=>{var a;return e+(parseFloat(null==l?void 0:null===(a=l.qty)||void 0===a?void 0:a.toString().replace(/,/g,""))||0)},0);return(0,d.jsxs)(y.R,{children:[(0,d.jsx)(k.g,{children:(0,d.jsx)(Q.Z,{maxAccess:Z,labels:g,onAdd:F,disableAdd:i})}),(0,d.jsx)(V.Q,{children:(0,d.jsx)(D.Z,{name:"MaterialsTable",columns:P,gridData:I,rowId:["recordId"],isLoading:!1,onDelete:i?null:N,onEdit:e=>{R(e)},maxAccess:Z,pagination:!1})}),(0,d.jsx)(k.g,{children:(0,d.jsx)(o.ZP,{container:!0,padding:4,children:(0,d.jsx)(o.ZP,{item:!0,xs:2,children:(0,d.jsx)(w.Z,{name:"totalQty",label:g.totalQty,value:T,readOnly:!0})})})})]})};function E(e){let{store:l,labels:a,access:r}=e,{getRequest:n}=(0,t.useContext)(c.$),{recordId:i}=l,s=v.i.Worksheet,{query:{data:u}}=(0,m.J)({queryFn:x,endpointId:j.u.Worksheet.summary,datasetId:s,params:{disabledReqParams:!0,maxAccess:r},enabled:!!i});async function x(){return await n({extension:j.u.Worksheet.summary,parameters:"_worksheetId=".concat(i)})}let h=u?u.list.reduce((e,l)=>e+(null==l?void 0:l.issued_qty),0):0,p=u?u.list.reduce((e,l)=>e+(null==l?void 0:l.lost_qty),0):0,I=u?u.list.reduce((e,l)=>e+(null==l?void 0:l.returned_qty),0):0,b=u?u.list.reduce((e,l)=>e+(null==l?void 0:l.consumed_qty),0):0;return(0,d.jsxs)(y.R,{children:[(0,d.jsx)(V.Q,{children:(0,d.jsx)(D.Z,{name:"operationTable",gridData:u,maxAccess:r,columns:[{field:"operationRef",headerName:a.operationRef,flex:1},{field:"operationName",headerName:a.operationName,flex:2},{field:"categoryName",headerName:a.category,flex:2},{field:"issued_qty",headerName:a.issued,type:"number",flex:1},{field:"returned_qty",headerName:a.returned,type:"number",flex:1},{field:"lost_qty",headerName:a.loss,type:"number",flex:1},{field:"consumed_qty",headerName:a.consumed,type:"number",flex:1}],rowId:["operationId"],pagination:!1})}),(0,d.jsx)(k.g,{children:(0,d.jsxs)(o.ZP,{container:!0,spacing:1,sx:{pt:2},children:[(0,d.jsx)(o.ZP,{item:!0,xs:6.8}),(0,d.jsx)(o.ZP,{item:!0,xs:5,children:(0,d.jsxs)(o.ZP,{container:!0,spacing:2,children:[(0,d.jsx)(o.ZP,{item:!0,xs:3,children:(0,d.jsx)(w.Z,{name:"totalIssued",value:h,label:a.totalIssued,readOnly:!0})}),(0,d.jsx)(o.ZP,{item:!0,xs:3,children:(0,d.jsx)(w.Z,{name:"totalLoss",label:a.totalLoss,value:p,readOnly:!0})}),(0,d.jsx)(o.ZP,{item:!0,xs:3,children:(0,d.jsx)(w.Z,{name:"totalReturned",label:a.totalReturned,value:I,readOnly:!0})}),(0,d.jsx)(o.ZP,{item:!0,xs:3,children:(0,d.jsx)(w.Z,{name:"totalConsumed",label:a.totalConsumed,value:b,readOnly:!0})}),(0,d.jsx)(o.ZP,{item:!0,xs:.2})]})})]})})]})}var B=a(21326),L=a(50023);let z=e=>{let{recordId:l,window:a,joInvalidate:o}=e,[i,s]=(0,t.useState)(0),[u,c]=(0,t.useState)({recordId:l,isPosted:!1,values:null}),{labels:m,access:x}=(0,L.Z)({datasetId:v.i.Worksheet,editMode:!!l});(0,B.Z)({title:m.Worksheet,window:a});let h=[{label:m.Worksheet},{label:m.issueOfMaterials,disabled:!u.recordId},{label:m.Summary,disabled:!u.recordId}];return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(n.Y,{tabs:h,activeTab:i,setActiveTab:s,maxAccess:x}),(0,d.jsx)(r.Z,{index:0,value:i,maxAccess:x,children:(0,d.jsx)(T,{labels:m,setStore:c,store:u,maxAccess:x,window:a,joInvalidate:o})}),(0,d.jsx)(r.Z,{index:1,value:i,maxAccess:x,children:(0,d.jsx)(J,{store:u})}),(0,d.jsx)(r.Z,{index:2,value:i,maxAccess:x,children:(0,d.jsx)(E,{store:u,labels:m,maxAccess:x})})]})};z.width=1200,z.height=650;var $=z},2801:function(e,l,a){"use strict";var d=a(52322),r=a(23925),n=a(2784),t=a(80983),o=a(65950),i=a(38449),s=a(19473),u=a(35656),c=a(10498),m=a.n(c),v=a(69627);let x=(0,n.forwardRef)((e,l)=>{let{resourceId:c,error:x,seqNo:h,recordId:p,width:I=140,height:y=140,customWidth:b,customHeight:f,disabled:j=!1,isAbsolutePath:g=!1,parentImage:Z}=e,w=(0,n.useRef)(null),P=(0,n.useRef)(null),C=(0,n.useRef)({}),{getRequest:k,postRequest:N}=(0,n.useContext)(o.$),{platformLabels:_}=(0,n.useContext)(s.l),[A,O]=(0,n.useState)(""),R=null==Z?void 0:Z.recordId,q=null==Z?void 0:Z.resourceId,{formik:F}=(0,t.c)({initialValues:{}}),{width:T}=(0,u.d)(),D=T>=1680?1:T>=1600?.9:T<=1024?.7:.7+(T-1024)/576*.22000000000000008;(0,n.useImperativeHandle)(l,()=>({submit:V}));let V=()=>{var e,a,d,r,n,t,o,s,u,m,v,x;if(j)return;let h=(null==l?void 0:null===(e=l.current)||void 0===e?void 0:e.value)||p;if(g){if((null===(t=F.values)||void 0===t?void 0:null===(n=t.file)||void 0===n?void 0:n.name)||F.values.url){let e={...F.values,fileName:(null===(u=F.values.file)||void 0===u?void 0:u.name)||F.values.url,resourceId:c,recordId:h};return N({extension:i.r.Attachment.set2,record:JSON.stringify(e),file:null===(m=F.values)||void 0===m?void 0:m.file}).then(()=>S(h))}return A||null===(o=C.current)||void 0===o||!o.fileName||(null===(s=F.values)||void 0===s?void 0:s.fileName)?void 0:N({extension:i.r.Attachment.del,record:JSON.stringify(C.current)}).then(()=>S(h))}if(null===(a=F.values)||void 0===a?void 0:a.file){let e={...F.values,recordId:h};return N({extension:i.r.Attachment.set,record:JSON.stringify(e),file:null===(v=F.values)||void 0===v?void 0:v.file}).then(()=>S(h))}if(!A&&(null===(d=C.current)||void 0===d?void 0:d.url)&&!(null===(r=F.values)||void 0===r?void 0:r.url))return N({extension:i.r.Attachment.del,record:JSON.stringify(C.current),file:null===(x=C.current)||void 0===x?void 0:x.url}).then(()=>S(h))},Q=()=>{O(""),F.setValues({})},S=async e=>{let l=e||p;if(!c)return;if(g&&l){let e=await k({extension:i.r.Attachment.get2,parameters:"_resourceId=".concat(c,"&_seqNo=").concat(h,"&_recordId=").concat(l)}),a=(null==e?void 0:e.record)||{};F.setValues({...a,resourceId:c}),C.current={...a,resourceId:c},O((null==a?void 0:a.fileName)?"".concat(a.fileName,"?t=").concat(Date.now()):"");return}let a=q||c,d=R||l;if(!d)return;let r=await k({extension:i.r.Attachment.get,parameters:"_resourceId=".concat(a,"&_seqNo=").concat(h,"&_recordId=").concat(d)}),n=(null==r?void 0:r.record)||{};F.setValues({...n,resourceId:a}),C.current={...n,resourceId:a},O((null==n?void 0:n.url)?"".concat(n.url,"?t=").concat(Date.now()):"")};return(0,n.useEffect)(()=>{R||p?S():Q()},[R,p]),(0,d.jsxs)(r.Z,{className:m().container,children:[(0,d.jsx)(r.Z,{className:m().previewBox,style:{width:"100%",maxWidth:(b||I)*D,height:(f||y)*D},onClick:()=>{j||w.current.click()},children:(0,d.jsx)("img",{src:A||a(68802).default.src,alt:"",className:m().previewImage,style:{border:x?"2px solid #F44336":"none"},onError:e=>{e.currentTarget.src=a(68802).default.src}})}),(0,d.jsxs)(r.Z,{className:m().bottomSection,children:[(0,d.jsx)("input",{hidden:!0,type:"file",accept:"image/png, image/jpeg, image/jpg",ref:w,onChange:e=>{var l,a;let d=null==e?void 0:null===(a=e.target)||void 0===a?void 0:null===(l=a.files)||void 0===l?void 0:l[0];if(!d)return;if(Math.round(d.size/1024)>500){alert(_.MaxFileSize);return}let r=new Date(d.lastModifiedDate),n="".concat(r.getDate(),"/").concat(r.getMonth()+1,"/").concat(r.getFullYear());F.setValues({resourceId:c,recordId:p,seqNo:0,fileName:d.name,folderId:null,folderName:null,date:n,url:null,file:d});let t=new FileReader;P.current=t,t.onloadend=e=>O(e.target.result),t.readAsDataURL(d)},disabled:j}),(0,d.jsx)(v.Z,{onClick:Q,image:"clear.png",tooltipText:_.Clear,color:"#F44336",border:"none",disabled:j})]})]})});l.Z=x},29326:function(e,l,a){"use strict";var d=a(52322);a(2784);var r=a(23925),n=a(13980),t=a.n(n),o=a(95291),i=a.n(o),s=a(65947);let u=e=>{var l,a,n;let{children:t,value:o,index:u,maxAccess:c,...m}=e,v="".concat(e.name||"tab",".").concat(u),{accessLevel:x}=null!==(n=(null!==(a=null==c?void 0:null===(l=c.record)||void 0===l?void 0:l.controls)&&void 0!==a?a:[]).find(e=>e.controlId===v))&&void 0!==n?n:{accessLevel:0};if(x===s.A1)return null;let h=o===u;return(0,d.jsx)(r.Z,{role:"tabpanel",hidden:!h,id:"simple-tabpanel-".concat(u),"aria-labelledby":"simple-tab-".concat(u),className:"".concat(i().tabPanel," ").concat(h?i().active:i().hidden),...m,children:t})};u.propTypes={children:t().node,index:t().number.isRequired,value:t().number.isRequired},l.Z=u},9522:function(e,l,a){"use strict";a.d(l,{Y:function(){return m}});var d=a(52322),r=a(23925),n=a(54582),t=a(68696),o=a(44258),i=a(2784),s=a(99266),u=a(52614),c=a.n(u);let m=e=>{var l,a,u,m,v;let{tabs:x,activeTab:h,setActiveTab:p,maxAccess:I,name:y="tab"}=e,b=(null==I?void 0:null===(a=I.record)||void 0===a?void 0:null===(l=a.controls)||void 0===l?void 0:l.filter(e=>{var l;return 4===e.accessLevel&&(null===(l=e.controlId)||void 0===l?void 0:l.startsWith("".concat(y,".")))}).map(e=>e.controlId.split(".")[1]))||[],f=null==x?void 0:null===(u=x.map((e,l)=>({...e,id:l})))||void 0===u?void 0:u.filter((e,l)=>!b.includes(String(l))),j=null===(m=f[h])||void 0===m?void 0:m.id,g=null===(v=f[h])||void 0===v?void 0:v.disabled;return(0,i.useEffect)(()=>{j>=0&&!g&&h!=j&&p(j)},[]),(0,d.jsx)(r.Z,{className:c().tabsContainer,children:(0,d.jsx)(r.Z,{className:c().tabsWrapper,children:(0,d.jsx)(n.Z,{value:h,onChange:(e,l)=>p(l),variant:"scrollable",scrollButtons:f.length>3?"auto":"off","aria-label":"scrollable tabs",classes:{indicator:c().tabsIndicator},className:c().tabs,children:null==f?void 0:f.map(e=>(0,d.jsx)(t.Z,{value:e.id,disabled:null==e?void 0:e.disabled,className:"".concat(c().tabName," ").concat(e.disabled?c().tabDisabled:""),classes:{root:c().tabRoot,selected:c().selectedTab},label:(0,d.jsxs)(r.Z,{display:"flex",alignItems:"center",children:[(0,d.jsx)("span",{children:e.label}),e.id===h&&(null==e?void 0:e.onRefetch)&&(0,d.jsx)(o.Z,{size:"small",className:c().refreshButton,onClick:l=>{l.stopPropagation(),e.onRefetch()},children:(0,d.jsx)(s.Z,{className:c().refreshIcon})})]})},e.id))})})})}},10498:function(e){e.exports={container:"ImageUpload_container__I2BWx",previewBox:"ImageUpload_previewBox__JogCN",previewImage:"ImageUpload_previewImage___eqQX",bottomSection:"ImageUpload_bottomSection__jpph8"}},95291:function(e){e.exports={tabPanel:"CustomTabPanel_tabPanel__80Dfu",active:"CustomTabPanel_active___6Uvb",hidden:"CustomTabPanel_hidden__y9566"}},52614:function(e){e.exports={customTabPanel:"CustomTabs_customTabPanel__Ztocv",hidden:"CustomTabs_hidden__lZpM7",tabsContainer:"CustomTabs_tabsContainer__28Syi",tabsWrapper:"CustomTabs_tabsWrapper__mlxxj",tabs:"CustomTabs_tabs__25pli",tabName:"CustomTabs_tabName__XzMCn",tabRoot:"CustomTabs_tabRoot__WVR1E",tabDisabled:"CustomTabs_tabDisabled__VauYR",selectedTab:"CustomTabs_selectedTab__sZzwF",tabsIndicator:"CustomTabs_tabsIndicator__89Lek",refreshButton:"CustomTabs_refreshButton__P2mzl",refreshIcon:"CustomTabs_refreshIcon__ADVWF"}}}]);