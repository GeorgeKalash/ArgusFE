"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[57981],{57981:function(e,a,r){var n=r(52322),t=r(2784),s=r(60218),o=r(48601),l=r(5088),d=r(82737),c=r(26612),i=r(8661),u=r(2119),m=r(65950),f=r(38449),p=r(71987),v=r(89330),I=r(62202),h=r(96026),y=r(7121),C=r(91088),x=r(76399),A=r(21581),b=r(30390),w=r(39812),g=r(31389),k=r(33625),F=r(62362),P=r(61802),Z=r(80983),N=r(1251),j=r(26553),q=r(30657),_=r(39704),R=r(98345),V=r(50023),S=r(21326);let T=e=>{var a,r,T,D;let{recordId:G,plantId:O,cashAccountId:M,dtId:J,refetch:B,window:E}=e,[L,H]=(0,t.useState)(!!G),{getRequest:U,postRequest:W}=(0,t.useContext)(m.$),{stack:z}=(0,h.V)(),{stack:Q}=(0,P.zY)(),[X,Y]=(0,t.useState)(!1),[$,K]=(0,t.useState)(!0),ee=(0,p.E)({endpointId:u.G.CashTransfer.page}),{labels:ea,access:er}=(0,V.Z)({datasetId:c.i.CashTransfer,editMode:!!G});(0,S.Z)({title:ea.cashTransfer,window:E});let[en,et]=(0,t.useState)({recordId:G||null,dtId:parseInt(J),reference:"",date:new Date,toPlantId:parseInt(O),fromPlantId:parseInt(O),fromCashAccountId:parseInt(M),toCashAccountId:"",baseAmount:"",notes:"",wip:"",status:"",statusName:"",releaseStatus:"",rsName:"",wipName:"",transfers:[{id:1,transferId:G||0,seqNo:"",currencyId:"",currencyName:"",currencyRef:"",amount:"",baseAmount:"",exRate:"",rateCalcMethod:"",balance:0}]}),{maxAccess:es}=(0,R.H)({functionId:y.J.CashTransfer,access:er,enabled:!G,hasDT:!1}),{formik:eo}=(0,Z.c)({maxAccess:es,initialValues:en,validateOnChange:!0,validationSchema:o.Ry({fromCashAccountId:o.Z_().required(),fromPlantId:o.Z_().required(),date:o.Z_().required(),toPlantId:o.Z_().required(),toCashAccountId:o.Z_().nullable().test("",function(e){let{fromPlantId:a,toPlantId:r}=this.parent;return a!=r||!!e}),transfers:o.IX().of(o.Ry().shape({currencyName:o.Z_().required(),amount:o.Z_().nullable().required()})).required()}),onSubmit:async e=>{let a={...e};delete a.transfers,a.date=(0,w.ku)(a.date),a.status=""===a.status?1:a.status,a.wip=""===a.wip?1:a.wip,a.baseAmount=el;let r=eo.values.transfers.map((e,a)=>({...e,seqNo:a+1,transferId:eo.values.recordId||0}));if(1===r.length&&""===r[0].currencyId){z({message:"Grid not filled. Please fill the grid before saving."});return}let n=await W({extension:u.G.CashTransfer.set,record:JSON.stringify({header:a,items:r})});if(n.recordId){I.ZP.success("Record Updated Successfully"),eo.setFieldValue("recordId",n.recordId),H(!0);let e=await U({extension:u.G.CashTransfer.get,parameters:"_recordId=".concat(n.recordId)});eo.setFieldValue("reference",e.record.reference),ee()}}}),el=eo.values.transfers.reduce((e,a)=>{var r;return e+(parseFloat(null===(r=a.baseAmount)||void 0===r?void 0:r.toString().replace(/,/g,""))||0)},0),ed=async()=>{let{transfers:e,...a}=eo.values,r={...a};if(r.date=(0,w.ku)(r.date),r.wip=""===r.wip?1:r.wip,r.status=""===r.status?1:r.status,r.baseAmount=el,(await W({extension:u.G.CashTransfer.close,record:JSON.stringify(r)})).recordId){var n;I.ZP.success("Record Closed Successfully"),ee(),Y(!0);let e=await U({extension:u.G.CashTransfer.get,parameters:"_recordId=".concat(eo.values.recordId)});(null==e?void 0:null===(n=e.record)||void 0===n?void 0:n.status)==4&&K(!1)}},ec=async()=>{let{transfers:e,...a}=eo.values,r={...a};r.date=(0,w.ku)(r.date),r.wip=""===r.wip?1:r.wip,r.status=""===r.status?1:r.status,r.baseAmount=el,(await W({extension:u.G.CashTransfer.reopen,record:JSON.stringify(r)})).recordId&&(I.ZP.success("Record Closed Successfully"),ee(),B&&(B(),E.close()),Y(!1),K(!0))},ei=async(e,a)=>{let r=(await U({extension:u.G.CurrencyTransfer.qry,parameters:"_transferId=".concat(e)})).list.map(e=>{var a;return{...e,id:e.seqNo,amount:parseFloat(e.amount).toFixed(2),balance:null!==(a=parseFloat(null==e?void 0:e.balance).toFixed(2))&&void 0!==a?a:0}});eo.setValues({...a,transfers:r})},eu=async()=>{if(M){let e=await U({extension:u.G.CashAccount.get,parameters:"_recordId=".concat(M)});e.record&&(eo.setFieldValue("fromCARef",e.record.accountNo),eo.setFieldValue("fromCAName",e.record.name))}};(0,t.useEffect)(()=>{!async function(){if(G){let e=await U({extension:u.G.CashTransfer.get,parameters:"_recordId=".concat(G)});e.record.date=(0,w.a1)(e.record.date),Y(2===e.record.wip),K(4!==e.record.status),await ei(G,e.record)}else eu()}()},[]);let em=[{key:"WorkFlow",condition:!0,onClick:async()=>{Q({Component:_.Z,props:{functionId:y.J.CashTransfer,recordId:eo.values.recordId}})},disabled:!L},{key:"Close",condition:!X,onClick:ed,disabled:X||!L},{key:"Reopen",condition:X,onClick:ec,disabled:!X||!L||3===eo.values.releaseStatus&&3===eo.values.status},{key:"Approval",condition:!0,onClick:"onApproval",disabled:!X},{key:"Shipment",condition:!0,onClick:()=>{Q({Component:C.u,props:{recordId:eo.values.recordId,functionId:y.J.CashTransfer,editMode:X,totalBaseAmount:el}})},disabled:L&&eo.values.fromPlantId==eo.values.toPlantId||!L},{key:"Account Balance",condition:!0,onClick:"onClickAC",disabled:!1},{key:"Cash Transaction",condition:!0,onClick:"transactionClicked",disabled:!L}];return(0,n.jsx)(d.Z,{resourceId:c.i.CashTransfer,form:eo,editMode:L,maxAccess:es,functionId:y.J.CashTransfer,actions:em,disabledSubmit:X,children:(0,n.jsxs)(g.R,{children:[(0,n.jsx)(k.g,{children:(0,n.jsxs)(s.ZP,{container:!0,children:[(0,n.jsxs)(s.ZP,{container:!0,rowGap:2,xs:6,sx:{px:2},spacing:2,children:[(0,n.jsx)(s.ZP,{item:!0,xs:12,children:(0,n.jsx)(l.Z,{name:"reference",label:ea.reference,value:null==eo?void 0:null===(a=eo.values)||void 0===a?void 0:a.reference,maxAccess:es,maxLength:"15",readOnly:L,error:eo.touched.reference&&!!eo.errors.reference})}),(0,n.jsx)(s.ZP,{item:!0,xs:12,children:(0,n.jsx)(i.Z,{endpointId:f.r.Plant.qry,name:"fromPlantId",label:ea.fromPlant,values:eo.values,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],readOnly:!0,required:!0,maxAccess:es,onChange:(e,a)=>{eo&&eo.setFieldValue("fromPlantId",null==a?void 0:a.recordId)},error:eo.touched.fromPlantId&&!!eo.errors.fromPlantId})}),(0,n.jsx)(s.ZP,{item:!0,xs:12,children:(0,n.jsx)(i.Z,{endpointId:u.G.CashAccount.qry,parameters:"_type=0",name:"fromCashAccountId",label:ea.fromCashAcc,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:eo.values,readOnly:!0,required:!0,maxAccess:es,onChange:(e,a)=>{eo.setFieldValue("fromCashAccountId",(null==a?void 0:a.recordId)||null)},error:eo.touched.fromCashAccountId&&!!eo.errors.fromCashAccountId})})]}),(0,n.jsxs)(s.ZP,{container:!0,rowGap:2,xs:6,sx:{px:2},spacing:2,children:[(0,n.jsx)(s.ZP,{item:!0,xs:12,children:(0,n.jsx)(v.Z,{name:"date",required:!0,readOnly:X,label:ea.date,value:null==eo?void 0:null===(r=eo.values)||void 0===r?void 0:r.date,onChange:eo.setFieldValue,editMode:L,maxAccess:es,onClear:()=>eo.setFieldValue("date",""),error:eo.touched.date&&!!eo.errors.date})}),(0,n.jsx)(s.ZP,{item:!0,xs:12,children:(0,n.jsx)(i.Z,{endpointId:f.r.Plant.qry,name:"toPlantId",label:ea.toPlant,values:eo.values,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],required:!0,readOnly:X,maxAccess:es,onChange:(e,a)=>{eo.setFieldValue("toPlantId",a?a.recordId:null),eo.setFieldValue("toCashAccountId",null),eo.setFieldValue("toCARef",null),eo.setFieldValue("toCAName",null)},error:eo.touched.toPlantId&&!!eo.errors.toPlantId})}),(0,n.jsx)(s.ZP,{item:!0,xs:12,children:(0,n.jsx)(i.Z,{endpointId:u.G.CashAccount.qry,parameters:"_type=0",name:"toCashAccountId",label:ea.toCashAcc,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:eo.values,required:eo.values.fromPlantId===eo.values.toPlantId,filter:e=>e.plantId===eo.values.toPlantId,readOnly:!eo.values.toPlantId||X,maxAccess:es,onChange:(e,a)=>{eo.setFieldValue("toCashAccountId",(null==a?void 0:a.recordId)||null)},error:eo.touched.toCashAccountId&&!!eo.errors.toCashAccountId})})]})]})}),(0,n.jsx)(F.Q,{children:(0,n.jsx)(x._,{onChange:e=>eo.setFieldValue("transfers",e),value:eo.values.transfers,error:eo.errors.transfers,allowDelete:!X,allowAddNewLine:!X,maxAccess:es,initialValues:null==eo?void 0:null===(D=eo.initialValues)||void 0===D?void 0:null===(T=D.transfers)||void 0===T?void 0:T[0],name:"currencies",columns:[{component:"resourcecombobox",label:ea.currency,name:"currencyName",props:{disabled:X,endpointId:f.r.Currency.qry,displayField:"reference",valueField:"recordId",mapping:[{from:"recordId",to:"currencyId"},{from:"name",to:"currencyName"},{from:"reference",to:"currencyRef"}],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}]},widthDropDown:200,displayFieldWidth:2,async onChange(e){let{row:{update:a,newRow:r}}=e;if((null==r?void 0:r.currencyId)&&r.currencyId){var n,t,s;let e=await (s=null==r?void 0:r.currencyId,U({extension:N.q.Currency.get,parameters:"_currencyId=".concat(s,"&_date=").concat((0,w.Uf)(eo.values.date),"&_rateDivision=").concat(j.B.FINANCIALS)}));a({exRate:null===(n=e.record)||void 0===n?void 0:n.exRate,rateCalcMethod:null===(t=e.record)||void 0===t?void 0:t.rateCalcMethod})}}},{component:"numberfield",label:ea.amount,name:"amount",props:{readOnly:X},async onChange(e){let{row:{update:a,newRow:r}}=e;(null==r?void 0:r.amount)&&(null==r?void 0:r.amount)&&a({baseAmount:(0,q.fB)({amount:null==r?void 0:r.amount,exRate:null==r?void 0:r.exRate,baseAmount:null==r?void 0:r.baseAmount,rateCalcMethod:null==r?void 0:r.rateCalcMethod,dirtyField:q.H9}).baseAmount})}},{component:"numberfield",label:ea.baseAmount,name:"baseAmount",props:{readOnly:!0}},{component:"numberfield",name:"balance",label:ea.balance,props:{readOnly:!0}}]})}),(0,n.jsx)(k.g,{children:(0,n.jsx)(b.Z,{container:!0,rowGap:1,xs:7,style:{marginTop:"10px"},children:(0,n.jsx)(A.Z,{name:"notes",label:ea.note,value:eo.values.notes,rows:3,readOnly:X,maxLength:"100",editMode:L,maxAccess:es,onChange:e=>eo.setFieldValue("notes",e.target.value),onClear:()=>eo.setFieldValue("notes","")})})})]})})};T.width=1100,T.height=650,a.Z=T}}]);