"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[32304],{32304:function(e,a,l){l.d(a,{Z:function(){return D}});var n=l(52322),t=l(60218),d=l(2784),o=l(48601),r=l(82737),u=l(62202),i=l(65950),c=l(71987),s=l(26612),v=l(5088),m=l(80983),y=l(19473),x=l(31389),h=l(62362),p=l(89330),I=l(8661),C=l(38449),F=l(7121),f=l(84100),A=l(25870),b=l(91406),g=l(27423),Z=l(2119),V=l(21581),k=l(98345),j=l(39812),R=l(39704),P=l(61802),N=l(77595),M=l(1251),O=l(30657),w=l(26553),T=l(23361),_=l(50023),q=l(21326),S=l(69627);function D(e){var a,l,D,H,E,J,B,G;let{recordId:L,window:U}=e,{getRequest:W,postRequest:Y}=(0,d.useContext)(i.$),{platformLabels:z,defaultsData:Q,userDefaultsData:$}=(0,d.useContext)(y.l),{stack:K}=(0,P.zY)(),{labels:X,access:ee}=(0,_.Z)({datasetId:s.i.PaymentOrder,editMode:!!L}),{documentType:ea,maxAccess:el,changeDT:en}=(0,k.H)({functionId:F.J.PaymentOrder,access:ee,enabled:!L});(0,q.Z)({title:X.PaymentOrder,window:U});let et=(0,c.E)({endpointId:A.H.PaymentOrders.page2}),ed=parseInt(null==$?void 0:null===(l=$.list)||void 0===l?void 0:null===(a=l.find(e=>"plantId"===e.key))||void 0===a?void 0:a.value),eo=parseInt(null==Q?void 0:null===(H=Q.list)||void 0===H?void 0:null===(D=H.find(e=>"currencyId"===e.key))||void 0===D?void 0:D.value),er=parseInt(null==$?void 0:null===(J=$.list)||void 0===J?void 0:null===(E=J.find(e=>"cashAccountId"===e.key))||void 0===E?void 0:E.value),{formik:eu}=(0,m.c)({documentType:{key:"dtId",value:null==ea?void 0:ea.dtId,reference:null==ea?void 0:ea.reference},initialValues:{recordId:null,reference:"",accountId:"",accountType:"",currencyId:parseInt(eo),currencyName:"",paymentMethod:null,date:new Date,amount:null,notes:"",exRate:1,rateCalcMethod:1,baseAmount:null,dtId:null,status:1,releaseStatus:null,cashAccountId:parseInt(er),plantId:parseInt(ed)},maxAccess:el,validateOnChange:!0,validationSchema:o.Ry({accountType:o.Rx().required(),currencyId:o.Rx().required(),date:o.Z_().required(),paymentMethod:o.Z_().required(),amount:o.Rx().required()}),onSubmit:async e=>{let a=e.recordId,l={header:{...e,date:(0,j.ku)(e.date),recordId:a},items:[],costCenters:[]},n=await Y({extension:A.H.PaymentOrders.set2,record:JSON.stringify(l)});a?u.ZP.success(z.Edited):u.ZP.success(z.Added),eh(n.recordId),et()}}),ei=async e=>{if(!e)return null;{let{record:a}=await W({extension:Z.G.CbBankAccounts.get,parameters:"_recordId=".concat(e)});return eu.setFieldValue("cashAccountId",null==a?void 0:a.recordId),eu.setFieldValue("cashAccountRef",a.reference),eu.setFieldValue("cashAccountName",a.name),a.paymentMethod}},{labels:ec,access:es}=(0,c.J)({endpointId:M.q.Currency.get,datasetId:s.i.MultiCurrencyRate});async function ev(e,a){if(e&&a){var l,n,t,d;let o=await W({extension:M.q.Currency.get,parameters:"_currencyId=".concat(e,"&_date=").concat((0,j.Uf)(a),"&_rateDivision=").concat(w.B.FINANCIALS)}),r=(0,O.fB)({amount:eu.values.amount,exRate:null===(l=o.record)||void 0===l?void 0:l.exRate,baseAmount:0,rateCalcMethod:null===(n=o.record)||void 0===n?void 0:n.rateCalcMethod,dirtyField:O.ss});eu.setFieldValue("baseAmount",parseFloat(null==r?void 0:r.baseAmount).toFixed(2)||0),eu.setFieldValue("exRate",null===(t=o.record)||void 0===t?void 0:t.exRate),eu.setFieldValue("rateCalcMethod",null===(d=o.record)||void 0===d?void 0:d.rateCalcMethod)}}let em=-1===eu.values.status,ey=2==eu.values.wip,ex=!!eu.values.recordId;async function eh(e){let a=await W({extension:A.H.PaymentOrders.get,parameters:"_recordId=".concat(e)});eu.setValues({...a.record,date:(0,j.a1)(a.record.date)})}async function ep(e){if(e){var a,l,n;let t=await W({extension:A.H.FIDocTypeDefaults.get,parameters:"_dtId=".concat(e)});eu.setFieldValue("plantId",(null==t?void 0:null===(a=t.record)||void 0===a?void 0:a.plantId)||ed);let d=await ei((null==t?void 0:null===(l=t.record)||void 0===l?void 0:l.cashAccountId)||er);eu.setFieldValue("paymentMethod",(null==t?void 0:null===(n=t.record)||void 0===n?void 0:n.paymentMethod)||d)}}(0,d.useEffect)(()=>{var e,a;(null===(e=eu.values)||void 0===e?void 0:e.dtId)&&!L&&ep(null===(a=eu.values)||void 0===a?void 0:a.dtId)},[null===(B=eu.values)||void 0===B?void 0:B.dtId]),(0,d.useEffect)(()=>{!async function(){L?eh(L):ei(er)}()},[]);let eI=async()=>{let e=await Y({extension:A.H.PaymentOrders.cancel,record:JSON.stringify(eu.values)});(null==e?void 0:e.recordId)&&(u.ZP.success(z.Cancelled),et(),eh(e.recordId))},eC=[{key:"Cancel",condition:!0,onClick:()=>{var e,a;e=z.CancelConf,a=z.Confirmation,K({Component:T.Z,props:{DialogText:e,okButtonAction:async()=>{await eI()},fullScreen:!1,close:!0},width:400,height:150,title:a})},disabled:!ex||em},{key:"RecordRemarks",condition:!0,onClick:"onRecordRemarks",disabled:!ex},{key:"WorkFlow",condition:!0,onClick:async()=>{K({Component:R.Z,props:{functionId:F.J.PaymentOrder,recordId:eu.values.recordId}})},disabled:!ex},{key:"Attachment",condition:!0,onClick:"onClickAttachment",disabled:!ex},{key:"Close",condition:!ey,onClick:async()=>{let e=await Y({extension:A.H.PaymentOrders.close,record:JSON.stringify(eu.values)});(null==e?void 0:e.recordId)&&(u.ZP.success(z.Closed),et(),eh(e.recordId))},disabled:ey||!ex||em},{key:"Reopen",condition:ey,onClick:async()=>{let e=await Y({extension:A.H.PaymentOrders.reopen,record:JSON.stringify(eu.values)});(null==e?void 0:e.recordId)&&(u.ZP.success(z.Reopened),et(),eh(e.recordId))},disabled:!ey||em},{key:"Approval",condition:!0,onClick:"onApproval",disabled:!ey}];return(0,n.jsx)(r.Z,{resourceId:s.i.PaymentOrder,form:eu,maxAccess:el,editMode:ex,previewReport:ex,actions:eC,functionId:F.J.PaymentOrder,disabledSubmit:ey||em,children:(0,n.jsx)(x.R,{children:(0,n.jsx)(h.Q,{children:(0,n.jsxs)(t.ZP,{container:!0,spacing:2,children:[(0,n.jsx)(t.ZP,{item:!0,xs:6,children:(0,n.jsx)(I.Z,{endpointId:C.r.DocumentType.qry,parameters:"_dgId=".concat(F.J.PaymentOrder,"&_startAt=",0,"&_pageSize=",50),filter:ex?void 0:e=>1===e.activeStatus,name:"dtId",label:X.documentType,readOnly:ex,valueField:"recordId",displayField:"name",values:eu.values,onChange:async(e,a)=>{await en(a),eu.setFieldValue("dtId",(null==a?void 0:a.recordId)||null)},error:eu.touched.dtId&&!!eu.errors.dtId,maxAccess:el})}),(0,n.jsx)(t.ZP,{item:!0,xs:6,children:(0,n.jsxs)(t.ZP,{container:!0,spacing:1,alignItems:"center",children:[(0,n.jsx)(t.ZP,{item:!0,xs:8,children:(0,n.jsx)(I.Z,{endpointId:C.r.Currency.qry,name:"currencyId",label:X.currency,filter:e=>1===e.currencyType,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],required:!0,readOnly:ey||em,values:eu.values,onChange:(e,a)=>{ev(null==a?void 0:a.recordId,eu.values.date),eu.setFieldValue("currencyId",(null==a?void 0:a.recordId)||null),eu.setFieldValue("currencyName",(null==a?void 0:a.name)||"")},error:eu.touched.currencyId&&!!eu.errors.currencyId})}),(0,n.jsx)(t.ZP,{item:!0,xs:4,children:(0,n.jsx)(S.Z,{onClick:()=>{var e;return e=eu.values,void K({Component:N.Z,props:{labels:ec,maxAccess:es,data:e,onOk:e=>{eu.setValues(a=>({...a,...e}))}},width:500,height:500,title:z.MultiCurrencyRate})},image:"popup.png",tooltipText:z.MultiCurrencyRate,disabled:!eu.values.currencyId||eu.values.currencyId===eo})})]})}),(0,n.jsx)(t.ZP,{item:!0,xs:6,children:(0,n.jsx)(v.Z,{name:"reference",label:X.reference,value:eu.values.reference,readOnly:ex,maxAccess:!ex&&el,maxLength:"15",onChange:eu.handleChange,onClear:()=>eu.setFieldValue("reference",""),error:eu.touched.reference&&!!eu.errors.reference})}),(0,n.jsx)(t.ZP,{item:!0,xs:6,children:(0,n.jsx)(I.Z,{datasetId:f.v.PAYMENT_METHOD,name:"paymentMethod",label:X.paymentMethod,valueField:"key",displayField:"value",values:eu.values,required:!0,readOnly:ey||em,maxAccess:el,onChange:(e,a)=>{(null==a?void 0:a.key)||eu.setFieldValue("cashAccountId",""),eu.setFieldValue("paymentMethod",(null==a?void 0:a.key)||null)},error:eu.touched.paymentMethod&&!!eu.errors.paymentMethod})}),(0,n.jsx)(t.ZP,{item:!0,xs:6,children:(0,n.jsx)(p.Z,{name:"date",label:X.date,value:null===(G=eu.values)||void 0===G?void 0:G.date,required:!0,onChange:async(e,a)=>{eu.setFieldValue("date",a),await ev(eu.values.currencyId,a)},onClear:()=>eu.setFieldValue("date",null),readOnly:ey||em,error:eu.touched.date&&!!eu.errors.date,maxAccess:el})}),(0,n.jsx)(t.ZP,{item:!0,xs:6,children:(0,n.jsx)(I.Z,{endpointId:Z.G.CashAccount.qry,parameters:"_type=0",name:"cashAccountId",readOnly:ey||em,label:X.cashAccount,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:eu.values,maxAccess:el,onChange:(e,a)=>{eu.setFieldValue("cashAccountId",(null==a?void 0:a.recordId)||null)},error:eu.touched.cashAccountId&&!!eu.errors.cashAccountId})}),(0,n.jsx)(t.ZP,{item:!0,xs:6,children:(0,n.jsx)(I.Z,{endpointId:C.r.Plant.qry,name:"plantId",label:X.plant,valueField:"recordId",readOnly:ey||em,displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:eu.values,onChange:(e,a)=>{eu.setFieldValue("plantId",a?null==a?void 0:a.recordId:"")},error:eu.touched.plantId&&!!eu.errors.plantId})}),(0,n.jsx)(t.ZP,{item:!0,xs:6,children:(0,n.jsx)(b.Z,{name:"amount",required:!0,label:X.amount,maxLength:"10",decimalScale:2,readOnly:ey||em,value:eu.values.amount,maxAccess:el,onChange:async e=>{var a,l,n;let t=(0,O.fB)({amount:null!==(n=e.target.value)&&void 0!==n?n:0,exRate:null===(a=eu.values)||void 0===a?void 0:a.exRate,baseAmount:0,rateCalcMethod:null===(l=eu.values)||void 0===l?void 0:l.rateCalcMethod,dirtyField:O.ss});eu.setFieldValue("baseAmount",parseFloat(null==t?void 0:t.baseAmount).toFixed(2)||0),eu.setFieldValue("amount",e.target.value)},onClear:()=>{eu.setFieldValue("amount","")},error:eu.touched.amount&&!!eu.errors.amount})}),(0,n.jsx)(t.ZP,{item:!0,xs:6,children:(0,n.jsx)(I.Z,{datasetId:f.v.FI_PV_GROUP_TYPE,name:"accountType",filter:e=>1==e.key||4==e.key,label:X.accountType,valueField:"key",displayField:"value",values:eu.values,required:!0,readOnly:ey||em,maxAccess:el,onChange:(e,a)=>{(null==a?void 0:a.key)||(eu.setFieldValue("accountId",null),eu.setFieldValue("accountRef",""),eu.setFieldValue("accountName","")),eu.setFieldValue("accountType",(null==a?void 0:a.key)||null)},error:eu.touched.accountType&&!!eu.errors.accountType})}),(0,n.jsx)(t.ZP,{item:!0,xs:6,children:(0,n.jsx)(I.Z,{neverPopulate:!0,endpointId:A.H.DescriptionTemplate.qry,name:"templateId",label:X.descriptionTemplate,valueField:"recordId",displayField:"name",values:eu.values,onChange:(e,a)=>{let l=eu.values.notes||"";(null==a?void 0:a.name)&&eu.setFieldValue("notes",""===l?a.name:"".concat(l,"\n").concat(a.name)),eu.setFieldValue("templateId",(null==a?void 0:a.recordId)||null)},readOnly:ey||em,error:eu.touched.templateId&&!!eu.errors.templateId,maxAccess:el})}),(0,n.jsx)(t.ZP,{item:!0,xs:6,children:(0,n.jsx)(g.U,{endpointId:A.H.Account.snapshot,name:"accountId",readOnly:ey||em||!eu.values.accountType,label:X.accountReference,valueField:"reference",displayField:"name",valueShow:"accountRef",secondValueShow:"accountName",form:eu,columnsInDropDown:[{key:"reference",value:"Account Ref"},{key:"name",value:"Name",grid:4},{key:"keywords",value:"Keywords"}],firstFieldWidth:4,displayFieldWidth:4,filter:{type:eu.values.accountType,isInactive:e=>!0!==e},onChange:(e,a)=>{eu.setFieldValue("accountRef",(null==a?void 0:a.reference)||""),eu.setFieldValue("accountName",(null==a?void 0:a.name)||""),eu.setFieldValue("accountGroupName",(null==a?void 0:a.groupName)||""),eu.setFieldValue("accountId",(null==a?void 0:a.recordId)||null)},error:eu.touched.accountId&&!!eu.errors.accountId,maxAccess:el})}),(0,n.jsx)(t.ZP,{item:!0,xs:6,children:(0,n.jsx)(V.Z,{name:"notes",type:"text",label:X.notes,value:eu.values.notes,rows:3,readOnly:ey||em,maxAccess:el,onChange:eu.handleChange,onClear:()=>eu.setFieldValue("notes","")})})]})})})})}D.width=950,D.height=450},77595:function(e,a,l){l.d(a,{Z:function(){return f}});var n=l(52322),t=l(60218),d=l(2784),o=l(26612),r=l(5088),u=l(80983),i=l(31389),c=l(62362),s=l(91406),v=l(30657),m=l(65950),y=l(1251),x=l(39812),h=l(26553),p=l(71987),I=l(21326),C=l(19473),F=l(54074);function f(e){var a,l,f,A,b,g,Z,V,k;let{data:j,onOk:R,DatasetIdAccess:P,window:N}=e,{getRequest:M}=(0,d.useContext)(m.$),{platformLabels:O}=(0,d.useContext)(C.l);(0,I.Z)({title:O.MultiCurrencyRate,window:N});let{labels:w,access:T}=(0,p.J)({endpointId:y.q.Currency.get,DatasetIdAccess:P,datasetId:o.i.MultiCurrencyRate}),{formik:_}=(0,u.c)({initialValues:{currencyId:null==j?void 0:j.currencyId,currencyName:null==j?void 0:j.currencyName,exchangeId:null==j?void 0:j.exchangeId,exchangeName:null==j?void 0:j.exchangeName,rateCalcMethod:null==j?void 0:j.rateCalcMethod,rateCalcMethodName:null==j?void 0:j.rateCalcMethodName,rateTypeId:null==j?void 0:j.rateTypeId,exRate:(null==j?void 0:j.exRate)||null,amount:(null==j?void 0:j.amount)||0,baseAmount:null==j?void 0:j.baseAmount,rateTypeName:null==j?void 0:j.rateTypeName},maxAccess:T,validateOnChange:!0});async function q(){if((null==j?void 0:j.currencyId)&&(null==j?void 0:j.date)){var e,a,l,n,t;let d=await M({extension:y.q.Currency.get,parameters:"_currencyId=".concat(null==j?void 0:j.currencyId,"&_date=").concat((0,x.Uf)(null==j?void 0:j.date),"&_rateDivision=").concat(h.B.FINANCIALS)});_.setFieldValue("rateCalcMethod",null===(e=d.record)||void 0===e?void 0:e.rateCalcMethod),_.setFieldValue("rateCalcMethodName",null===(a=d.record)||void 0===a?void 0:a.rateCalcMethodName),_.setFieldValue("exchangeId",null===(l=d.record)||void 0===l?void 0:l.exchangeId),_.setFieldValue("exchangeName",null===(n=d.record)||void 0===n?void 0:n.exchangeName),_.setFieldValue("rateTypeName",null===(t=d.record)||void 0===t?void 0:t.rateTypeName)}}(0,d.useEffect)(()=>{!async function(){await q()}()},[]);let S=()=>{R&&(R({..._.values,exRate:_.values.exRate,baseAmount:_.values.baseAmount,amount:_.values.amount}),N.close())},D=[{key:"Ok",condition:!0,onClick:S,disabled:!1}];return(0,n.jsx)(F.Z,{onSave:S,actions:D,maxAccess:T,editMode:!1,isSaved:!1,children:(0,n.jsx)(i.R,{children:(0,n.jsx)(c.Q,{children:(0,n.jsxs)(t.ZP,{container:!0,spacing:2,children:[(0,n.jsx)(t.ZP,{item:!0,xs:12,children:(0,n.jsx)(r.Z,{name:"currencyName",value:null==_?void 0:null===(a=_.values)||void 0===a?void 0:a.currencyName,label:w.currency,readOnly:!0})}),(0,n.jsx)(t.ZP,{item:!0,xs:12,children:(0,n.jsx)(r.Z,{name:"rateTypeName",value:null==_?void 0:null===(l=_.values)||void 0===l?void 0:l.rateTypeName,label:w.rateType,readOnly:!0})}),(0,n.jsx)(t.ZP,{item:!0,xs:12,children:(0,n.jsx)(r.Z,{name:"exchangeName",value:null==_?void 0:null===(f=_.values)||void 0===f?void 0:f.exchangeName,label:w.exchangeTable,readOnly:!0})}),(0,n.jsx)(t.ZP,{item:!0,xs:12,children:(0,n.jsx)(r.Z,{name:"rateCalcMethodName",value:null==_?void 0:null===(A=_.values)||void 0===A?void 0:A.rateCalcMethodName,label:w.rateCalcMethod,readOnly:!0})}),(0,n.jsx)(t.ZP,{item:!0,xs:12,children:(0,n.jsx)(s.Z,{name:"exRate",value:null==_?void 0:null===(b=_.values)||void 0===b?void 0:b.exRate,label:w.rate,readOnly:(null==_?void 0:null===(g=_.values)||void 0===g?void 0:g.amount)==0,maxAccess:T,onClear:()=>{_.setFieldValue("baseAmount",""),_.setFieldValue("exRate","")},decimalScale:7,onChange:e=>{var a,l;let n=e.target.value;if(!n){_.setFieldValue("exRate",""),_.setFieldValue("baseAmount","");return}_.setFieldValue("exRate",n);let t=(0,v.fB)({amount:(null==j?void 0:j.amount)||0,exRate:n,baseAmount:parseFloat((null==_?void 0:null===(a=_.values)||void 0===a?void 0:a.baseAmount)||0).toFixed(2),rateCalcMethod:null==_?void 0:null===(l=_.values)||void 0===l?void 0:l.rateCalcMethod,dirtyField:v.ss});_.setValues({..._.values,...t,baseAmount:parseFloat(t.baseAmount).toFixed(2)})}})}),(0,n.jsx)(t.ZP,{item:!0,xs:12,children:(0,n.jsx)(s.Z,{name:"amount",value:null==_?void 0:null===(Z=_.values)||void 0===Z?void 0:Z.amount,label:w.amount,readOnly:!0})}),(0,n.jsx)(t.ZP,{item:!0,xs:12,children:(0,n.jsx)(s.Z,{name:"baseAmount",value:null==_?void 0:null===(V=_.values)||void 0===V?void 0:V.baseAmount,label:w.baseAmount,readOnly:(null==_?void 0:null===(k=_.values)||void 0===k?void 0:k.amount)==0,onClear:()=>{_.setFieldValue("baseAmount",""),_.setFieldValue("exRate","")},maxAccess:T,onChange:e=>{var a,l;let n=e.target.value;if(!n){_.setFieldValue("baseAmount",""),_.setFieldValue("exRate","");return}_.setFieldValue("baseAmount",n);let t=(0,v.fB)({amount:(null==j?void 0:j.amount)||0,exRate:null==_?void 0:null===(a=_.values)||void 0===a?void 0:a.exRate,baseAmount:parseFloat(n||0).toFixed(2),rateCalcMethod:null==_?void 0:null===(l=_.values)||void 0===l?void 0:l.rateCalcMethod,dirtyField:v.i5});_.setValues({..._.values,...t})}})})]})})})})}f.width=500,f.height=500}}]);