(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4447],{64581:function(e,l){"use strict";l.Z={src:"/_next/static/media/imgSerials.d1ee59bb.png",height:17,width:23,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAGCAMAAADJ2y/JAAAAIVBMVEUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABt0UjBAAAAC3RSTlMCZzsmQ6RbWbaSTwNdgTwAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAArSURBVHicY2BiZ2BgYOBiZmBmYmRjZGRhYGBg4eBkZWVDYjAzMbKDpWCKARB/AJwjPQgCAAAAAElFTkSuQmCC",blurWidth:8,blurHeight:6}},4447:function(e,l,a){"use strict";a.d(l,{Z:function(){return et}});var t=a(52322),d=a(89330),n=a(39812),i=a(60218),o=a(21429),r=a(2784),u=a(48601),s=a(82737),c=a(62202),v=a(65950),m=a(71987),h=a(5088),p=a(21581),y=a(8661),x=a(38449),I=a(65215),f=a(7121),b=a(27423),g=a(62362),A=a(76399),P=a(31389),F=a(33625),N=a(91406),k=a(2454),C=a(25870),w=a(80983),V=a(39704),j=a(61802),Z=a(19473),T=a(86626),D=a(18996),S=a(16096),O=a(1251),R=a(26553),q=a(98345),_=a(84100),M=a(61520),L=a(19568),W=a(80968),E=a(69387),U=a(26612),B=a(21326);let G=e=>{let{invoiceId:l,window:a}=e,{getRequest:d}=(0,r.useContext)(v.$),{platformLabels:n}=(0,r.useContext)(Z.l);(0,B.Z)({title:n.ItemPromotion,window:a});let{query:{data:i},labels:o,access:u}=(0,m.J)({queryFn:c,endpointId:k.y.ItemPromotion.qry,datasetId:U.i.ItemPromotion}),s=[{field:"promotionTypeName",headerName:o.promType},{field:"sku",headerName:o.sku},{field:"itemName",headerName:o.itemName},{field:"qty",headerName:o.qty,type:"number"},{field:"netUnitPrice",headerName:o.netUnitPrice,type:"number"},{field:"currentCost",headerName:o.currentCost,type:"number"},{field:"netExtendedPrice",headerName:o.netExtendedPrice,type:"number"},{field:"extendedCurrentCostInDocumentCurrency",headerName:o.extendedCurrent,type:"number"},,{field:"invoicePct",headerName:o.invoicePct,type:"number"},{field:"freeOnInvoiceUnitMarkdown",headerName:o.freeOnInvoiceUnitMarkdown,type:"number"},{field:"kitPct",headerName:o.kitPct,type:"number"},{field:"promotionUnitMarkdown",headerName:o.promotionUnitMarkdown,type:"number"}];async function c(){return await d({extension:k.y.ItemPromotion.qry,parameters:"_invoiceId=".concat(l)})}return(0,t.jsx)(P.R,{children:(0,t.jsx)(g.Q,{children:(0,t.jsx)(E.Z,{columns:s,gridData:i,rowId:["recordId"],isLoading:!1,maxAccess:u,pagination:!1})})})};G.width=1330,G.height=720;var K=a(19689),$=a(85572),J=a(96026),Q=a(30657),H=a(77595),X=a(67920),z=a(69627),Y=a(54074);function ee(e){var l;let{data:a,onOk:d,window:i}=e,o=3===a.status,{labels:r,access:u}=(0,m.J)({datasetId:U.i.Installments});(0,B.Z)({title:r.Installments,window:i});let{formik:s}=(0,w.c)({initialValues:{installments:(null==a?void 0:null===(l=a.installments)||void 0===l?void 0:l.map((e,l)=>({...e,id:l+1,dueDate:e.dueDate&&/^\/Date\(-?\d+\)\/$/.test(e.dueDate)?(0,n.a1)(e.dueDate):e.dueDate||null})))||[{id:1,dueDate:null,amount:null}]},maxAccess:u,validateOnChange:!0,onSubmit:async e=>{d&&(d({installments:e.installments.filter(e=>e.dueDate).map((e,l)=>({...e,seqNo:l+1,reference:null==a?void 0:a.reference,vendorId:null==a?void 0:a.vendorId,invoiceId:(null==a?void 0:a.recordId)||0,currencyId:null==a?void 0:a.currencyId,dueDate:(0,n.ku)(e.dueDate)}))}),i.close())}}),c=[{key:"Ok",condition:!0,onClick:s.handleSubmit,disabled:!1}],v=[{component:"date",label:r.date,name:"dueDate",props:{readOnly:o}},{component:"numberfield",label:r.amount,name:"amount",props:{maxLength:12,decimalScale:2,readOnly:o},propsReducer(e){let{row:l,props:a}=e;return{...a,readOnly:!l.dueDate}}}];return(0,t.jsx)(Y.Z,{onSave:s.handleSubmit,actions:c,isSaved:!1,isParentWindow:!1,children:(0,t.jsx)(P.R,{children:(0,t.jsx)(g.Q,{children:(0,t.jsx)(A._,{onChange:e=>s.setFieldValue("installments",e),value:s.values.installments,error:s.errors.installments,columns:v,allowDelete:!o,allowAddNewLine:!o,maxAccess:u})})})})}ee.width=600,ee.height=500;let el=e=>{var l,a;let{row:d,siteId:n,window:o,updateRow:s,disabled:c}=e,{platformLabels:v}=(0,r.useContext)(Z.l),{labels:h,access:p}=(0,m.J)({datasetId:U.i.Serial}),{schema:x,requiredFields:f}=(0,X.m)({weight:e=>!!(null==e?void 0:e.weight),srlNo:e=>!!(null==e?void 0:e.srlNo)},!0,p,"items");(0,B.Z)({title:v.serials,window:o});let{formik:k}=(0,w.c)({maxAccess:p,initialValues:{sku:null==d?void 0:d.sku,itemName:null==d?void 0:d.itemName,itemId:null==d?void 0:d.itemId,siteId:n,totalWeight:(null==d?void 0:d.qty)||0,items:(null==d?void 0:null===(l=d.serials)||void 0===l?void 0:l.map((e,l)=>({...e,id:l+1})))||[]},conditionSchema:["items"],validationSchema:u.Ry({items:u.IX().of(x)}),onSubmit:async e=>{s({changes:{serials:e.items.filter(e=>{var l;return null===(l=Object.values(f))||void 0===l?void 0:l.every(l=>l(e))}).map((e,l)=>{let{id:a,...t}=e;return{...t,srlSeqNo:l+1,srlNo:t.srlNo,seqNo:d.id}})}}),o.close()}}),C=k.values.items.reduce((e,l)=>e+(parseFloat(l.weight)||0),0),V=k.values.totalWeight-C||0,j=[{component:"textfield",name:"srlNo",label:h.serialNo},{component:"resourcecombobox",label:h.size,name:"sizeId",props:{endpointId:I.$.ItemSizes.qry,displayField:"name",valueField:"recordId",displayFieldWidth:2,mapping:[{from:"recordId",to:"sizeId"},{from:"reference",to:"sizeRef"},{from:"name",to:"sizeName"}],displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}]}},{component:"numberfield",name:"weight",label:h.weight,props:{mandatory:!0}}],T=[{key:"Ok",condition:!0,onClick:()=>k.handleSubmit(),disabled:c}];return(0,t.jsx)(Y.Z,{onSave:k.handleSubmit,isSaved:!1,actions:T,maxAccess:p,children:(0,t.jsxs)(P.R,{children:[(0,t.jsx)(F.g,{children:(0,t.jsxs)(i.ZP,{container:!0,spacing:2,children:[(0,t.jsx)(i.ZP,{item:!0,xs:12,children:(0,t.jsx)(b.U,{endpointId:I.$.Item.snapshot,name:"itemId",label:null==h?void 0:h.sku,valueField:"recordId",displayField:"sku",valueShow:"sku",secondValueShow:"itemName",form:k,readOnly:!0})}),(0,t.jsx)(i.ZP,{item:!0,xs:12,children:(0,t.jsx)(y.Z,{endpointId:I.$.Site.qry,name:"siteId",label:h.site,values:k.values,valueField:"recordId",displayField:["reference","name"],maxAccess:p,readOnly:!0})}),(0,t.jsx)(i.ZP,{item:!0,xs:12,children:(0,t.jsx)(N.Z,{name:"totalWeight",label:h.totalWeight,maxAccess:p,value:k.values.totalWeight,readOnly:!0})}),(0,t.jsx)(i.ZP,{item:!0,xs:12,children:(0,t.jsx)(N.Z,{name:"weightAssigned",label:h.weightAssigned,maxAccess:p,value:C,readOnly:!0})}),(0,t.jsx)(i.ZP,{item:!0,xs:12,children:(0,t.jsx)(N.Z,{name:"balanceWeight",label:h.balanceWeight,maxAccess:p,value:V,readOnly:!0})})]})}),(0,t.jsx)(g.Q,{children:(0,t.jsx)(A._,{onChange:e=>k.setFieldValue("items",e),value:null===(a=k.values)||void 0===a?void 0:a.items,error:k.errors.items,name:"items",columns:j,maxAccess:p,disabled:c,allowDelete:!c,allowAddNewLine:!c})})]})})};el.width=500,el.height=700;var ea=a(51235);function et(e){var l,E,B,Y,et,ed,en,ei,eo,er,eu,es,ec,ev,em,eh,ep,ey,ex,eI,ef,eb,eg,eA,eP,eF,eN,ek,eC,ew,eV,ej,eZ,eT,eD,eS,eO,eR,eq,e_,eM,eL,eW,eE,eU,eB,eG,eK,e$,eJ,eQ,eH,eX,ez,eY,e0,e1,e2,e3,e6,e5,e4,e8,e9,e7,le,ll,la,lt,ld,ln,li,lo,lr,lu,ls,lc;let{labels:lv,access:lm,recordId:lh,functionId:lp,window:ly}=e,{getRequest:lx,postRequest:lI}=(0,r.useContext)(v.$),{stack:lf}=(0,j.zY)(),{platformLabels:lb,defaultsData:lg,userDefaultsData:lA,systemChecks:lP}=(0,r.useContext)(Z.l),{getAllKvsByDataset:lF}=(0,r.useContext)(W.k),[lN,lk]=(0,r.useState)([]),lC=(0,r.useRef)([]),[lw,lV]=(0,r.useState)(),[lj,lZ]=(0,r.useState)(!1),[lT,lD]=(0,r.useState)(null),[lS,lO]=(0,r.useState)(null),[lR,lq]=(0,r.useState)(!1),{stack:l_}=(0,J.V)(),lM=null==lP?void 0:null===(l=lP.find(e=>e.checkId===ea.F.POS_JUMP_TO_NEXT_LINE))||void 0===l?void 0:l.value,[lL,lW]=(0,r.useState)({text:"%",value:2}),{documentType:lE,maxAccess:lU,changeDT:lB}=(0,q.H)({functionId:lp,access:lm,enabled:!lh,objectName:"header"}),{schema:lG,requiredFields:lK}=(0,X.m)({sku:e=>null==e?void 0:e.sku,itemName:e=>null==e?void 0:e.itemName,qty:e=>(null==e?void 0:e.qty)>0},!0,lU,"items"),l$={recordId:lh,disableSKULookup:!1,header:{dtId:null,dgId:lp,functionId:lp,recordId:null,reference:"",date:new Date,dueDate:new Date,plantId:null,vendorId:null,vendorName:"",vendorRef:"",currencyId:null,szId:null,spId:null,siteId:null,description:"",status:1,isVattable:!1,taxId:null,subtotal:0,miscAmount:0,amount:0,vatAmount:0,tdAmount:0,plId:null,ptId:null,maxDiscount:"",currentDiscount:0,exRate:1,rateCalcMethod:1,tdType:lL.value,tdPct:0,baseAmount:0,volume:0,weight:0,qty:0,isVerified:!1,contactId:null,commitItems:!1,postMetalToFinancials:!1,metalPrice:0,KGmetalPrice:0},items:[{id:1,orderId:lh||0,itemId:null,sku:"",itemName:"",seqNo:1,siteId:"",muId:null,qty:0,volume:0,weight:0,isMetal:!1,metalId:null,metalPurity:0,msId:0,muRef:"",muQty:0,baseQty:0,mdType:T.Xo,basePrice:0,baseLaborPrice:0,TotPricePerG:0,totalWeightPerG:0,mdValue:0,unitPrice:0,unitCost:0,overheadId:"",vatAmount:0,mdAmount:0,extendedPrice:0,priceType:0,applyVat:!1,taxId:null,taxDetails:null,promotionTypeName:null==lw?void 0:lw.value,promotionType:null==lw?void 0:lw.key,notes:""}],serials:[],lots:[],taxCodes:[]},lJ=(0,m.E)({endpointId:k.y.PurchaseInvoiceHeader.qry}),lQ={[f.J.PurchaseInvoice]:{set:k.y.PurchaseInvoiceHeader.set2,post:k.y.PurchaseInvoiceHeader.post,unpost:k.y.PurchaseInvoiceHeader.unpost},[f.J.PurchaseReturn]:{set:k.y.PurchaseReturnHeader.set2,post:k.y.PurchaseReturnHeader.post,unpost:k.y.PurchaseReturnHeader.unpost}},{formik:lH}=(0,w.c)({maxAccess:lU,documentType:{key:"header.dtId",value:null==lE?void 0:lE.dtId},conditionSchema:["items"],initialValues:l$,validationSchema:u.Ry({header:u.Ry({date:u.Z_().required(),dueDate:u.Z_().required(),currencyId:u.Z_().required(),vendorId:u.Z_().required(),siteId:u.Rx().transform(e=>isNaN(e)?void 0:Number(e)).nullable().test("",function(e){let{dtId:l,commitItems:a}=this.parent;return null!=l&&(!l||!0!==a)||!!e})}),items:u.IX().of(lG)}),onSubmit:async e=>{var l,a;let t=[],d=e.items.filter(e=>{var l;return null===(l=Object.values(lK))||void 0===l?void 0:l.every(l=>l(e))}).map(e=>{let{id:l,isVattable:a,taxDetails:d,...n}=e,{serials:i,...o}=n;if(i){let e=i.map((e,a)=>({...e,id:a+1,seqNo:l,srlSeqNo:0,componentSeqNo:0,invoiceId:lH.values.recordId||0,itemId:null==n?void 0:n.itemId}));t.push(...e)}return{...o,seqNo:l,invoiceId:lH.values.recordId||0,applyVat:a}}),i={header:{...e.header,date:(0,n.ku)(e.header.date),dueDate:(0,n.ku)(e.header.dueDate)},installments:null==e?void 0:null===(l=e.installments)||void 0===l?void 0:l.map((l,a)=>{var t,d,n,i;return{...l,id:a+1,seqNo:a+1,reference:null==e?void 0:null===(t=e.header)||void 0===t?void 0:t.reference,vendorId:null==e?void 0:null===(d=e.header)||void 0===d?void 0:d.vendorId,invoiceId:(null==lH?void 0:null===(n=lH.values)||void 0===n?void 0:n.recordId)||0,currencyId:null==e?void 0:null===(i=e.header)||void 0===i?void 0:i.currencyId}}),items:d,serials:t,taxCodes:[...[...e.items.filter(e=>{let{taxDetails:l}=e;return l&&(null==l?void 0:l.length)>0}).map(e=>{let{taxDetails:l,id:a}=e;return{seqNo:a,...l[0]}})].filter(l=>e.items.some(e=>e.id===l.seqNo))],...(e=>{let{header:l,items:a,taxCodes:t,serials:d,...n}=e;return n})(e)},o=await lI({extension:null===(a=lQ[lp])||void 0===a?void 0:a.set,record:JSON.stringify(i)}),r=lY?lb.Edited:lb.Added;(null==o?void 0:o.recordId)&&(await aP(o.recordId),c.ZP.success(r),lJ())}}),lX=(0,r.useRef)(null==lH?void 0:null===(E=lH.values)||void 0===E?void 0:E.items),lz=3===lH.values.header.status,lY=!!lH.values.header.recordId;async function l0(){return new Promise((e,l)=>{lF({_dataset:_.v.PROMOTION_TYPE,callback:a=>{a?e(a):l()}})})}async function l1(e){var l,a;if(!e)return;let t=null===(a=lH.values.items)||void 0===a?void 0:null===(l=a.find(l=>parseInt(l.itemId)===e))||void 0===l?void 0:l.msId,d=(null==lN?void 0:lN.filter(e=>e.msId===t))||[];lC.current=d}async function l2(e,l,a){let t=await an(null==a?void 0:a.itemId),d=await ai(null==a?void 0:a.itemId),n=(null==a?void 0:a.promotionType)==="3"||(null==a?void 0:a.promotionType)==="4"?void 0:await ar(null==a?void 0:a.itemId,lH.values.header);await as(e,l,a,t,d,n)}let l3=[{component:"resourcecombobox",name:"promotionTypeName",label:lv.promotionType,hidden:!0,props:{datasetId:_.v.PROMOTION_TYPE,valueField:"key",displayField:"value",mapping:[{from:"key",to:"promotionType"},{from:"value",to:"promotionTypeName"}]}},{component:(null==lH?void 0:null===(B=lH.values)||void 0===B?void 0:B.disableSKULookup)?"textfield":"resourcelookup",label:lv.sku,name:"sku",jumpToNextLine:lM,flex:2,...lH.values.disableSKULookup&&{updateOn:"blur"},props:{...!lH.values.disableSKULookup&&{endpointId:I.$.Item.snapshot,parameters:{_categoryId:0,_msId:0,_startAt:0,_size:1e3},displayField:"sku",valueField:"sku",mapping:[{from:"recordId",to:"itemId"},{from:"sku",to:"sku"},{from:"name",to:"itemName"},{from:"trackBy",to:"trackBy"},{from:"msId",to:"msId"},{from:"isInactive",to:"isInactive"}],columnsInDropDown:[{key:"sku",value:"SKU"},{key:"name",value:"Item Name"}],displayFieldWidth:5,minChars:2}},async onChange(e){let{row:{update:l,newRow:a,oldRow:t,addRow:d}}=e,n=e=>l({...lH.initialValues.items[0],id:e,enabled:!1});if(!lH.values.disableSKULookup){if(!(null==a?void 0:a.itemId))return n(a.id);if(a.isInactive){n(a.id),l_({message:lv.inactiveItem});return}return l2(l,d,a)}if(!(null==a?void 0:a.sku))return n(a.id);let i=await lx({extension:I.$.Items.get2,parameters:"_sku=".concat(a.sku)}),o=null==i?void 0:i.record;if(!o){n(a.id),l_({message:lv.invalidSKU});return}if(o.isInactive){n(a.id),l_({message:lv.inactiveItem});return}return l2(l,d,{...a,itemId:o.recordId})},propsReducer(e){let{row:l,props:a}=e;return{...a,imgSrc:aj(l)}}},{component:"textfield",label:lv.itemName,name:"itemName",flex:3,props:{readOnly:!0}},{component:"resourcecombobox",label:lv.site,name:"siteRef",props:{endpointId:I.$.Site.qry,displayField:"reference",valueField:"recordId",mapping:[{from:"recordId",to:"siteId"},{from:"reference",to:"siteRef"},{from:"name",to:"siteName"}],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],displayFieldWidth:5}},{component:"resourcecombobox",label:lv.mu,name:"muRef",props:{store:null==lC?void 0:lC.current,displayField:"reference",valueField:"recordId",mapping:[{from:"reference",to:"muRef"},{from:"qty",to:"muQty"},{from:"recordId",to:"muId"}]},async onChange(e){let{row:{update:l,newRow:a}}=e;if(a){let e=null==lC?void 0:lC.current.filter(e=>e.recordId===(null==a?void 0:a.muId));l({qtyInBase:(null==a?void 0:a.qty)*(null==e?void 0:e.muQty),muQty:null==a?void 0:a.muQty})}},propsReducer(e){let{row:l,props:a}=e;return{...a,store:null==lC?void 0:lC.current}}},{component:"numberfield",label:lv.quantity,name:"qty",updateOn:"blur",props:{onCondition:e=>({decimalScale:null==e?void 0:e.decimals,readOnly:!(null==e?void 0:e.itemId)})},async onChange(e){let{row:{update:l,newRow:a}}=e,t=ac(a,T.bT);l({...t,totalWeight:t.weight*a.qty})}},{component:"numberfield",label:lv.pcs,name:"pieces",updateOn:"blur"},{component:"numberfield",label:lv.volume,name:"volume",props:{decimalScale:2,readOnly:!0}},{component:"numberfield",label:lv.weight,name:"weight",props:{decimalScale:2,readOnly:!0}},{component:"numberfield",label:lv.totalWeight,name:"totalWeight",props:{readOnly:!0,decimalScale:3}},{component:"numberfield",label:lv.baseprice,name:"basePrice",updateOn:"blur",props:{decimalScale:5},async onChange(e){let{row:{update:l,newRow:a}}=e;l(ac(a,T.yO))}},{component:"numberfield",label:lv.baseLaborPrice,name:"baseLaborPrice",updateOn:"blur",async onChange(e){let{row:{update:l,newRow:a}}=e;l(ac(a,T.tV))}},{component:"numberfield",label:lv.totalPPG,name:"totalWeightPerG",updateOn:"blur",async onChange(e){let{row:{update:l,newRow:a}}=e;l(ac(a,T.kx))}},{component:"numberfield",label:lv.unitPrice,name:"unitPrice",updateOn:"blur",props:{decimalScale:3},async onChange(e){let{row:{update:l,newRow:a}}=e;l(ac(a,T.Xf))}},{component:"button",name:"costHistory",props:{imgSrc:a(32631).default.src,onCondition:e=>({disabled:!(null==e?void 0:e.itemId)})},label:lv.costHistory,onClick:(e,l)=>{lf({Component:M.Z,props:{itemId:null==l?void 0:l.itemId,obj:l}})}},{component:"numberfield",label:lv.VAT,name:"vatAmount",props:{decimalScale:2,readOnly:!0}},{component:"button",name:"taxDetailsButton",props:{onCondition:e=>e.itemId&&e.taxId?{imgSrc:a(54022).default.src,hidden:!1}:{imgSrc:"",hidden:!0}},label:lv.tax,onClick:(e,l)=>{lf({Component:L.Z,props:{taxId:null==l?void 0:l.taxId,obj:l}})}},{component:"numberfield",label:lv.markdown,name:"mdAmount",updateOn:"blur",flex:2,props:{decimalScale:2,ShowDiscountIcons:!0,iconsClicked:l5,type:"numeric",iconKey:e=>{let{value:l,data:a}=e;return((null==l?void 0:l.mdType)||(null==a?void 0:a.mdType))===T.Xo?"%":"123"}},async onChange(e){let{row:{update:l,newRow:a}}=e;l(ac(a,T.On))}},{component:"numberfield",label:lv.extendedprice,name:"extendedPrice",updateOn:"blur",props:{decimalScale:2},async onChange(e){let{row:{update:l,newRow:a}}=e;l(ac(a,T.bh))}},{component:"textfield",label:lv.notes,name:"notes"}];function l6(e,l,a){let t=parseFloat(e)||0;return l===a?(t<0||t>100)&&(t=0):t<0&&(t=0),t}async function l5(e){let{updateRow:l,value:a,data:t}=e,d=((null==a?void 0:a.mdType)||(null==t?void 0:t.mdType))===T.Xo?T.RD:T.Xo,n=l6(null==a?void 0:a.mdAmount,d,T.Xo);l({id:t.id,changes:{mdAmount:n,mdAmountPct:d,mdType:d},commitOnBlur:!0})}async function l4(){await lI({extension:k.y.PurchaseInvoiceHeader.verify,record:JSON.stringify({...lH.values.header,isVerified:!lH.values.header.isVerified})}),c.ZP.success(lH.values.header.isVerified?lb.Unverfied:lb.Verified),aP(lH.values.header.recordId),lJ()}async function l8(){let{items:e}=lH.values,l={...lH.values,serials:e.flatMap(e=>e.serials||[])};await lI({extension:k.y.Serials.sync,record:JSON.stringify(l)}),c.ZP.success(lb.syncedSuccessfully),aP(lH.values.header.recordId),lJ()}let l9=[{key:"RecordRemarks",condition:!0,onClick:"onRecordRemarks",disabled:!lY},{key:"WorkFlow",condition:!0,onClick:async function(){lf({Component:V.Z,props:{functionId:lp,recordId:lH.values.header.recordId}})},disabled:!lY},{key:"Metals",condition:!0,onClick:"onClickMetal",handleMetalClick:async()=>{var e;return(null==lX?void 0:null===(e=lX.current)||void 0===e?void 0:e.filter(e=>e.metalId).map(e=>({qty:e.qty,metalRef:"",metalId:e.metalId,metalPurity:e.metalPurity,weight:e.weight,priceType:e.priceType})))||[]}},{key:"Locked",condition:lz,onClick:"onUnpostConfirmation",onSuccess:async()=>{var e;let l=await lI({extension:null===(e=lQ[lp])||void 0===e?void 0:e.unpost,record:JSON.stringify(lH.values.header)});await aP(l.recordId),c.ZP.success(lb.Posted),lJ()},disabled:!lY},{key:"Unlocked",condition:!lz,onClick:async()=>{var e;await lI({extension:null===(e=lQ[lp])||void 0===e?void 0:e.post,record:JSON.stringify(lH.values.header)}),c.ZP.success(lb.Posted),await aP(lH.values.recordId),lJ(),ly.close()},disabled:!lY},{key:"IV",condition:!0,onClick:"onInventoryTransaction",disabled:!lY||!lz},{key:"Aging",condition:!0,onClick:"onClickAging",disabled:!lY},{key:"GL",condition:!0,onClick:"onClickGL",valuesPath:{...lH.values.header,notes:null==lH?void 0:null===(et=lH.values)||void 0===et?void 0:null===(Y=et.header)||void 0===Y?void 0:Y.description},datasetId:(e=>{switch(Number(e)){case f.J.PurchaseInvoice:return U.i.GLPurchaseInvoice;case f.J.PurchaseReturn:return U.i.GLPurchaseReturn;default:return null}})(lp),disabled:!lY},{key:"ItemPromotion",condition:!0,onClick:()=>{lf({Component:G,props:{invoiceId:lH.values.header.recordId}})},disabled:!lY},{key:"Installments",condition:!0,onClick:()=>{var e;lf({Component:ee,props:{data:{installments:lH.values.installments,reference:lH.values.header.reference,recordId:null===(e=lH.values)||void 0===e?void 0:e.recordId,status:lH.values.header.status,vendorId:lH.values.header.vendorId,currencyId:lH.values.header.currencyId},onOk:e=>{let{installments:l}=e;lH.setFieldValue("installments",l)}}})},disabled:!lY},{key:"Verify",condition:!lH.values.header.isVerified,onClick:l4,disabled:lH.values.header.isVerified||!lY||!lz},{key:"Unverify",condition:lH.values.header.isVerified,onClick:l4,disabled:!lH.values.header.isVerified},{key:"Sync",condition:!0,onClick:l8,disabled:!lY||lz},{key:"Attachment",condition:!0,onClick:"onClickAttachment",disabled:!lY}];async function l7(e){var l;let a=null==e?void 0:e.header,t=null==e?void 0:e.items,d=null==e?void 0:e.taxCodes,i=null==e?void 0:e.serials,o=null==e?void 0:e.installments,r=await ak(null==e?void 0:null===(l=e.header)||void 0===l?void 0:l.dtId);(null==a?void 0:a.tdType)===1||(null==a?void 0:a.tdType)==null?lW({text:"123",value:1}):lW({text:"%",value:2});let u=t.length?await Promise.all(null==t?void 0:t.map(async(e,l)=>{var a;let t=(null==e?void 0:e.taxId)&&await ao(e.taxId),d=[],n=(null==t?void 0:t.map(e=>{let l=null==d?void 0:d.find(l=>l.seqNo===e.taxSeqNo);return{...e,taxBase:l?l.taxBase:e.taxBase}}))||null;return{...e,id:l+1,basePrice:e.basePrice?e.basePrice:0,unitPrice:e.unitPrice?e.unitPrice:0,vatAmount:e.vatAmount?e.vatAmount:0,totalWeight:e.weight*e.qty,extendedPrice:e.extendedPrice?e.extendedPrice:0,puTrx:!0,serials:null==i?void 0:null===(a=i.filter(l=>l.seqNo==e.seqNo))||void 0===a?void 0:a.map((e,l)=>({...e,id:l})),taxDetails:null==n?void 0:n.filter(l=>l.seqNo===e.seqNo)}})):lH.initialValues.items;lH.setValues({...lH.values,recordId:a.recordId||null,dtId:a.dtId||null,disableSKULookup:r||!1,installments:null==o?void 0:o.map((e,l)=>({...e,id:l,dueDate:(0,n.a1)(e.dueDate)})),header:{...lH.values.header,...a,amount:parseFloat(null==a?void 0:a.amount).toFixed(2),currentDiscount:(null==a?void 0:a.tdType)==1||(null==a?void 0:a.tdType)==null?null==a?void 0:a.tdAmount:null==a?void 0:a.tdPct,KGmetalPrice:(null==a?void 0:a.metalPrice)*1e3},items:u,taxCodes:[...d]}),lX.current=u}async function ae(e){var l,a,t,d;let i=await lx({extension:k.y.PurchaseInvoiceHeader.get2,parameters:"_recordId=".concat(e)});return i.record.header.date=(0,n.a1)(null==i?void 0:null===(a=i.record)||void 0===a?void 0:null===(l=a.header)||void 0===l?void 0:l.date),i.record.header.dueDate=(0,n.a1)(null==i?void 0:null===(d=i.record)||void 0===d?void 0:null===(t=d.header)||void 0===t?void 0:t.dueDate),i.record}let al=async()=>await lx({extension:I.$.MeasurementUnit.qry,parameters:"_msId=0"});async function aa(e){if(e){var l;let a=await lx({extension:O.q.Currency.get,parameters:"_currencyId=".concat(e,"&_date=").concat((0,n.Uf)(lH.values.header.date),"&_rateDivision=").concat(R.B.PURCHASE)});return(null==a?void 0:null===(l=a.record)||void 0===l?void 0:l.exRate)*1e3}}async function at(){var e;let l=null==lg?void 0:null===(e=lg.list)||void 0===e?void 0:e.find(e=>{let{key:l}=e;return"baseMetalCuId"===l}),a=(null==l?void 0:l.value)?parseInt(l.value):null;if(null!=a){let e=await aa(a);null!=e?(lH.setFieldValue("header.KGmetalPrice",e),lH.setFieldValue("header.metalPrice",e/1e3)):(lH.setFieldValue("header.KGmetalPrice",0),lH.setFieldValue("header.metalPrice",0))}}async function ad(e){let l=(null==e?void 0:e.tradeDiscount)?S.a$:lH.values.header.tdType;l==S.a$&&lW({text:"%",value:2}),lH.setValues({...lH.values,header:{...lH.values.header,vendorId:null==e?void 0:e.recordId,vendorName:null==e?void 0:e.name,vendorRef:null==e?void 0:e.reference,isVattable:(null==e?void 0:e.isTaxable)||!1,tdAmount:null==e?void 0:e.tradeDiscount,tdPct:null==e?void 0:e.tradeDiscount,currentDiscount:(null==e?void 0:e.tradeDiscount)||0,tdType:l,taxId:null==e?void 0:e.taxId,paymentMethod:null==e?void 0:e.paymentMethod}})}async function an(e){let l=await lx({extension:I.$.ItemPhysProp.get,parameters:"_itemId=".concat(e)});return null==l?void 0:l.record}async function ai(e){let l=await lx({extension:I.$.Item.get,parameters:"_recordId=".concat(e)});return null==l?void 0:l.record}async function ao(e){let l=await lx({extension:C.H.TaxDetailPack.qry,parameters:"_taxId=".concat(e)});return null==l?void 0:l.list}async function ar(e,l){let a=await lx({extension:k.y.VendorPrice.get,parameters:"_itemId=".concat(e,"&_vendorId=").concat(l.vendorId,"&_currencyId=").concat(l.currencyId,"&_functionId=").concat(lp)});return null==a?void 0:a.record}function au(e){return null!=e&&""!=e&&!isNaN(e)&&0!=e}async function as(e,l,a,t,d,n){var i,o,r,u,s,c,v,m,h,p,y,x;let I=(null==t?void 0:t.weight)||0,f=null!==(m=null==t?void 0:t.metalPurity)&&void 0!==m?m:0,b=null!==(h=null==t?void 0:t.isMetal)&&void 0!==h&&h,g=null!==(p=null==t?void 0:t.metalId)&&void 0!==p?p:null,A=null!==(y=null==lH?void 0:null===(o=lH.values)||void 0===o?void 0:null===(i=o.header)||void 0===i?void 0:i.postMetalToFinancials)&&void 0!==y&&y,P=(null!==(x=null==lH?void 0:null===(u=lH.values)||void 0===u?void 0:null===(r=u.header)||void 0===r?void 0:r.KGmetalPrice)&&void 0!==x?x:0)*f/1e3,F=!1===A?P:0,N=n?n.priceList:0,k=n?n.baseLaborPrice:0,C=null,w=null;if(lH.values.header.taxId){let e=(await ao(lH.values.header.taxId)).map(e=>({invoiceId:lH.values.recordId||0,taxSeqNo:e.seqNo,taxId:lH.values.header.taxId,taxCodeId:e.taxCodeId,taxBase:e.taxBase,amount:e.amount}));C=lH.values.header.taxId,w=e}else if(d.taxId){let e=(await ao(d.taxId)).map(e=>{var l;return{invoiceId:lH.values.recordId||0,taxSeqNo:e.seqNo,taxId:d.taxId,taxCodeId:e.taxCodeId,taxBase:e.taxBase,amount:null!==(l=e.amount)&&void 0!==l?l:0}});C=d.taxId,w=e}let V=null==lN?void 0:lN.filter(e=>e.msId===(null==d?void 0:d.msId)),j=await aF(null==d?void 0:d.msId),Z={id:null==a?void 0:a.id,decimals:null==j?void 0:j.decimals,sku:(null==d?void 0:d.sku)||"",itemName:(null==d?void 0:d.name)||"",itemId:(null==d?void 0:d.recordId)||null,isMetal:b,metalId:g,metalPurity:f,volume:(null==t?void 0:t.volume)||0,weight:I,basePrice:F,baseLaborPrice:k,TotPricePerG:F+k,unitPrice:N,priceType:(null==d?void 0:d.priceType)||1,qty:1,msId:null==d?void 0:d.msId,muRef:null==V?void 0:null===(s=V[0])||void 0===s?void 0:s.reference,muId:null==V?void 0:null===(c=V[0])||void 0===c?void 0:c.recordId,muQty:null==V?void 0:null===(v=V[0])||void 0===v?void 0:v.qty,mdAmount:lH.values.header.maxDiscount?lH.values.header.maxDiscount:0,mdValue:0,mdType:T.Xo,extendedPrice:0,mdValue:0,taxId:C,taxDetails:w},D=ac(Z,T.bT),S=au(Z.baseLaborPrice)?T.tV:au(Z.unitPrice)?T.Xf:null;return(S&&(D=ac(D,S)),lH.setFieldValue("header.mdAmount",lH.values.header.currentDiscount?lH.values.header.currentDiscount:0),lM)?lH.values.disableSKULookup?l({fieldName:"sku",changes:D}):void(e(D),l()):e(D)}async function ao(e){let l=await lx({extension:C.H.TaxDetailPack.qry,parameters:"_taxId=".concat(e)});return null==l?void 0:l.list}function ac(e,l,a){var t,d,n,i;lR||lq(!0);let o=l6(null==e?void 0:e.mdAmount,null==e?void 0:e.mdType,T.Xo),r=(0,T.Ch)({priceType:null==e?void 0:e.priceType,basePrice:parseFloat(null==e?void 0:e.basePrice)||0,volume:(null==e?void 0:e.volume)||0,weight:null==e?void 0:e.weight,unitPrice:(null==e?void 0:e.unitPrice)||0,upo:0,qty:null==e?void 0:e.qty,extendedPrice:null==e?void 0:e.extendedPrice,mdAmount:o,mdType:null==e?void 0:e.mdType,mdValue:null==e?void 0:e.mdValue,baseLaborPrice:parseFloat(null==e?void 0:e.baseLaborPrice)||0,totalWeightPerG:(null==e?void 0:e.totalWeightPerG)||0,tdPct:(null==lH?void 0:null===(d=lH.values)||void 0===d?void 0:null===(t=d.header)||void 0===t?void 0:t.tdPct)||0,dirtyField:l}),u=(0,D.VW)({priceType:null==r?void 0:r.priceType,basePrice:null==r?void 0:r.basePrice,unitPrice:null==r?void 0:r.unitPrice,qty:null==r?void 0:r.qty,weight:null==r?void 0:r.weight,extendedPrice:null==r?void 0:r.extendedPrice,baseLaborPrice:null==r?void 0:r.baseLaborPrice,vatAmount:(null==r?void 0:r.vatAmount)||0,tdPct:null==lH?void 0:null===(i=lH.values)||void 0===i?void 0:null===(n=i.header)||void 0===n?void 0:n.tdPct,taxDetails:!0===lH.values.header.isVattable?e.taxDetails:null}),s=(null==r?void 0:r.qty)*(null==e?void 0:e.muQty),c={...e,id:null==e?void 0:e.id,qty:(null==r?void 0:r.qty)?null==r?void 0:r.qty:0,baseQty:s||0,volume:(null==r?void 0:r.volume)?r.volume:0,weight:(null==r?void 0:r.weight)?r.weight:0,basePrice:(null==r?void 0:r.basePrice)?r.basePrice:0,unitPrice:(null==r?void 0:r.unitPrice)?r.unitPrice:0,extendedPrice:(null==r?void 0:r.extendedPrice)?r.extendedPrice:0,mdValue:null==r?void 0:r.mdValue,mdType:null==r?void 0:r.mdType,totalWeightPerG:(null==r?void 0:r.totalWeightPerG)?null==r?void 0:r.totalWeightPerG:0,mdAmount:(null==r?void 0:r.mdAmount)?r.mdAmount:0,vatAmount:(null==u?void 0:u.vatAmount)?u.vatAmount:0};return a?{changes:c}:c}let av=null===(ed=lH.values.items)||void 0===ed?void 0:ed.filter(e=>void 0!==e.itemId).map(e=>({...e,basePrice:e.basePrice||0,unitPrice:e.unitPrice||0,vatAmount:e.vatAmount||0,weight:e.weight||0,volume:e.volume||0,extendedPrice:e.extendedPrice||0})),am=(0,S.Ww)(av),ah=0==lH.values.miscAmount?0:parseFloat(lH.values.header.miscAmount),ap=(0,S.Ot)(av,{totalQty:0,totalWeight:0,totalVolume:0,sumVat:0,sumExtended:parseFloat(am),tdAmount:parseFloat(lH.values.header.tdAmount),net:0,miscAmount:ah||0}),ay=lR?null==ap?void 0:ap.totalQty:(null===(ei=lH.values)||void 0===ei?void 0:null===(en=ei.header)||void 0===en?void 0:en.qty)||0,ax=lR?null==ap?void 0:ap.net:(null===(eo=lH.values)||void 0===eo?void 0:eo.header.amount)||0,aI=lR?null==ap?void 0:ap.totalVolume:(null===(er=lH.values)||void 0===er?void 0:er.header.volume)||0,af=lR?null==ap?void 0:ap.totalWeight:(null===(eu=lH.values)||void 0===eu?void 0:eu.header.weight)||0,ab=lR?am:(null===(es=lH.values)||void 0===es?void 0:es.header.subtotal)||0,ag=lR?null==ap?void 0:ap.sumVat:(null===(ec=lH.values)||void 0===ec?void 0:ec.header.vatAmount)||0;async function aA(e,l,a,t){var d;d=function(e,l,a,t){var d;let n=(0,S.Yi)({tdAmount:parseFloat(t),tdPlain:1==e,tdPct:2==e,tdType:e,subtotal:ab,currentDiscount:t,hiddenTdPct:l,hiddenTdAmount:parseFloat(a),typeChange:e});return lH.setFieldValue("header.tdAmount",(null==n?void 0:n.hiddenTdAmount)?null==n?void 0:null===(d=n.hiddenTdAmount)||void 0===d?void 0:d.toFixed(2):0),lH.setFieldValue("header.tdType",null==n?void 0:n.tdType),lH.setFieldValue("header.currentDiscount",(null==n?void 0:n.currentDiscount)||0),lH.setFieldValue("header.tdPct",null==n?void 0:n.hiddenTdPct),null==n?void 0:n.hiddenTdPct}(e,l,a,t),lH.values.items.map((e,l)=>{let a=(0,D.VW)({priceType:null==e?void 0:e.priceType,basePrice:null==e?void 0:e.basePrice,qty:null==e?void 0:e.qty,weight:null==e?void 0:e.weight,extendedPrice:null==e?void 0:e.extendedPrice,baseLaborPrice:parseFloat(null==e?void 0:e.baseLaborPrice),vatAmount:null==e?void 0:e.vatAmount,tdPct:d,taxDetails:!0===lH.values.header.isVattable?e.taxDetails:null});lH.setFieldValue("items[".concat(l,"].vatAmount"),null==a?void 0:a.vatAmount)})}async function aP(e){let l=await ae(e);await l7(l)}async function aF(e){let l=await lx({extension:I.$.Measurement.get,parameters:"_recordId=".concat(e)});return null==l?void 0:l.record}async function aN(e){var l,a,t,d,n;let i=await lx({extension:k.y.DocumentTypeDefault.get,parameters:"_dtId=".concat(e)});(null==i?void 0:i.record)!=null?(at(),lZ(!0)):(lH.setFieldValue("header.metalPrice",0),lH.setFieldValue("header.KGmetalPrice",0),lZ(!1)),lH.setFieldValue("header.postMetalToFinancials",null==i?void 0:null===(l=i.record)||void 0===l?void 0:l.postMetalToFinancials),lH.setFieldValue("header.plantId",(null==i?void 0:null===(a=i.record)||void 0===a?void 0:a.plantId)||(null==lS?void 0:lS.plantId)||null),lH.setFieldValue("header.spId",(null==i?void 0:null===(t=i.record)||void 0===t?void 0:t.spId)||(null==lS?void 0:lS.spId)||null),lH.setFieldValue("header.siteId",(null==i?void 0:i.record.commitItems)&&((null==i?void 0:null===(d=i.record)||void 0===d?void 0:d.siteId)||(null==lS?void 0:lS.siteId))||null),lH.setFieldValue("header.commitItems",null==i?void 0:null===(n=i.record)||void 0===n?void 0:n.commitItems),aa()}async function ak(e){var l,a;if(!e){lH.setFieldValue("disableSKULookup",!1);return}let t=await lx({extension:k.y.DocumentTypeDefault.get,parameters:"_dtId=".concat(e)});return lH.setFieldValue("disableSKULookup",(null==t?void 0:null===(l=t.record)||void 0===l?void 0:l.disableSKULookup)||!1),(null==t?void 0:null===(a=t.record)||void 0===a?void 0:a.disableSKULookup)||!1}async function aC(){var e;let l={};return(null==lg?void 0:null===(e=lg.list)||void 0===e?void 0:e.filter(e=>"baseMetalCuId"===e.key||"mc_defaultRTSA"===e.key||"plId"===e.key||"ptId"===e.key||"allowSalesNoLinesTrx"===e.key||"sdpClientName"===e.key||"sdpItemName"===e.key||"currencyId"===e.key)).forEach(e=>{l[e.key]="True"===e.value||"False"===e.value?e.value:e.value?parseInt(e.value):null}),lD(l),l}async function aw(){var e;let l={};return(null==lA?void 0:null===(e=lA.list)||void 0===e?void 0:e.filter(e=>"plantId"===e.key||"siteId"===e.key)).forEach(e=>l[e.key]=e.value?parseInt(e.value):null),lO(l),l}(0,r.useEffect)(()=>{lH.setFieldValue("header.qty",parseFloat(ay).toFixed(2)),lH.setFieldValue("header.weight",parseFloat(af).toFixed(2)),lH.setFieldValue("header.volume",parseFloat(aI).toFixed(2)),lH.setFieldValue("header.amount",parseFloat(ax).toFixed(2)),lH.setFieldValue("header.baseAmount",parseFloat(ax).toFixed(2)),lH.setFieldValue("header.subtotal",parseFloat(ab).toFixed(2)),lH.setFieldValue("header.vatAmount",parseFloat(ag).toFixed(2))},[ay,ax,aI,af,ab,ag]),(0,r.useEffect)(()=>{if(lR){let e=parseFloat(lH.values.header.tdPct)*parseFloat(ab)/100;aA(lH.values.header.tdType,lH.values.header.tdPct,e,lH.values.header.currentDiscount)}},[ab]),(0,r.useEffect)(()=>{!async function(){let e=await l0();if(e&&e.length>0){let l=e[0];lV(l),lH.setFieldValue("items",[{...lH.values.items[0],promotionType:l.key,promotionTypeName:l.value}])}}()},[]),(0,r.useEffect)(()=>{!async function(){let e=await al();lk(null==e?void 0:e.list),at(),await aC(),aw(),lh||(lW({text:"%",value:S.a$}),lH.setFieldValue("header.tdType",2))}()},[]),(0,r.useEffect)(()=>{!async function(){if(lh&&lN){let e=await ae(lh);await l7(e)}}()},[lh,lN]),(0,r.useEffect)(()=>{lT&&aV()},[lT]),(0,r.useEffect)(()=>{if(!lh){var e,l;(null===(e=lH.values)||void 0===e?void 0:e.header.dtId)&&aN(null===(l=lH.values)||void 0===l?void 0:l.header.dtId),ak(lH.values.header.dtId)}},[null===(ev=lH.values)||void 0===ev?void 0:ev.header.dtId]);let aV=()=>{lH.setFieldValue("header.currencyId",(null==lT?void 0:lT.currencyId)||null),lH.values.header.plantId||lH.setFieldValue("header.plantId",(null==lS?void 0:lS.plantId)||null),lH.values.header.spId||lH.setFieldValue("header.spId",(null==lS?void 0:lS.spId)||null),lH.values.header.siteId||lH.setFieldValue("header.siteId",(!lH.values.header.dtId||lH.values.header.dtId&&lH.values.header.commitItems)&&(null==lS?void 0:lS.siteId)||null)},aj=e=>1===e.trackBy?{imgSrc:a(64581).Z.src,hidden:!1}:{imgSrc:"",hidden:!0};async function aZ(e,l){if(e&&l){var a,t,d,i,o,r,u,s;let c=await lx({extension:O.q.Currency.get,parameters:"_currencyId=".concat(e,"&_date=").concat((0,n.Uf)(l),"&_rateDivision=").concat(R.B.FINANCIALS)}),v=(0,Q.fB)({amount:0===ax?0:null!=ax?ax:lH.values.header.amount,exRate:null===(a=c.record)||void 0===a?void 0:a.exRate,baseAmount:0,rateCalcMethod:null===(t=c.record)||void 0===t?void 0:t.rateCalcMethod,dirtyField:Q.ss});lH.setFieldValue("header.baseAmount",parseFloat(null==v?void 0:v.baseAmount).toFixed(2)||0),lH.setFieldValue("header.exRate",null===(d=c.record)||void 0===d?void 0:d.exRate),lH.setFieldValue("header.rateCalcMethod",null===(i=c.record)||void 0===i?void 0:i.rateCalcMethod),lH.setFieldValue("header.rateCalcMethodName",null===(o=c.record)||void 0===o?void 0:o.rateCalcMethodName),lH.setFieldValue("header.rateTypeName",null===(r=c.record)||void 0===r?void 0:r.rateTypeName),lH.setFieldValue("header.exchangeId",null===(u=c.record)||void 0===u?void 0:u.exchangeId),lH.setFieldValue("header.exchangeName",null===(s=c.record)||void 0===s?void 0:s.exchangeName)}}lp==f.J.PurchaseReturn&&l3.push({component:"button",name:"serials",label:lb.serials,props:{onCondition:aj},onClick:(e,l,a,t)=>{if((null==l?void 0:l.trackBy)===1){var d;lf({Component:$.u,props:{labels:lv,row:l,disabled:lz,siteId:null==lH?void 0:null===(d=lH.values)||void 0===d?void 0:d.header.siteId,maxAccess:lU,checkForSiteId:!(l.qty>=0),updateRow:t}})}}}),lp==f.J.PurchaseInvoice&&l3.push({component:"button",name:"serials",label:lb.serials,props:{onCondition:aj},onClick:(e,l,a,t)=>{if((null==l?void 0:l.trackBy)===1){var d;lf({Component:el,props:{row:l,disabled:lz,siteId:null==lH?void 0:null===(d=lH.values)||void 0===d?void 0:d.header.siteId,updateRow:t}})}}});let aT=e=>{switch(Number(e)){case f.J.PurchaseInvoice:return U.i.MCRPurchaseInvoice;case f.J.PurchaseReturn:return U.i.MCRPurchaseReturn;default:return null}};return(0,t.jsx)(s.Z,{resourceId:(e=>{switch(e){case f.J.PurchaseInvoice:return U.i.PurchaseInvoice;case f.J.PurchaseReturn:return U.i.PurchaseReturn;default:return null}})(parseInt(lp)),form:lH,functionId:lp,maxAccess:lU,previewReport:lY,actions:l9,editMode:lY,disabledSubmit:lz,children:(0,t.jsxs)(P.R,{children:[(0,t.jsx)(F.g,{children:(0,t.jsxs)(i.ZP,{container:!0,spacing:2,children:[(0,t.jsx)(i.ZP,{item:!0,xs:2.4,children:(0,t.jsx)(y.Z,{endpointId:x.r.DocumentType.qry,parameters:"_startAt=0&_pageSize=1000&_dgId=".concat(lp),name:"header.dtId",readOnly:lY||(null==lH?void 0:null===(eh=lH.values)||void 0===eh?void 0:null===(em=eh.items)||void 0===em?void 0:em.some(e=>e.sku)),label:lv.documentType,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],valueField:"recordId",displayField:["reference","name"],values:lH.values.header,maxAccess:lU,onChange:(e,l)=>{let a=l?l.recordId:null;l?lH.setFieldValue("header.dtId",a):(lH.setFieldValue("header.dtId",null),lH.setFieldValue("header.metalPrice",0),lH.setFieldValue("header.KGmetalPrice",0),lZ(!1)),lB(l)},error:(null===(ep=lH.touched.header)||void 0===ep?void 0:ep.dtId)&&!!(null===(ey=lH.errors.header)||void 0===ey?void 0:ey.dtId)})}),(0,t.jsx)(i.ZP,{item:!0,xs:2.4,children:(0,t.jsx)(d.Z,{name:"header.date",required:!0,label:lv.date,readOnly:lz,value:null==lH?void 0:null===(eI=lH.values)||void 0===eI?void 0:null===(ex=eI.header)||void 0===ex?void 0:ex.date,onChange:(e,l)=>{lH.setFieldValue("header.date",l),aZ(lH.values.header.currencyId,l)},editMode:lY,maxAccess:lU,onClear:()=>lH.setFieldValue("header.date",""),error:(null===(eb=lH.touched)||void 0===eb?void 0:null===(ef=eb.header)||void 0===ef?void 0:ef.date)&&!!(null===(eA=lH.errors)||void 0===eA?void 0:null===(eg=eA.header)||void 0===eg?void 0:eg.date)})}),(0,t.jsx)(i.ZP,{item:!0,xs:2.4,children:(0,t.jsx)(y.Z,{endpointId:x.r.Plant.qry,name:"header.plantId",label:lv.plant,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],readOnly:lz,values:lH.values.header,valueField:"recordId",displayField:["reference","name"],maxAccess:lU,onChange:(e,l)=>{lH.setFieldValue("header.plantId",l?l.recordId:null)},displayFieldWidth:2,error:(null===(eP=lH.touched.header)||void 0===eP?void 0:eP.plantId)&&!!(null===(eF=lH.errors.header)||void 0===eF?void 0:eF.plantId)})}),(0,t.jsx)(i.ZP,{item:!0,xs:2.4,children:(0,t.jsx)(y.Z,{datasetId:_.v.PAYMENT_METHOD,name:"header.paymentMethod",readOnly:lz,label:lv.paymentMethod,valueField:"key",displayField:"value",values:lH.values.header,onChange:(e,l)=>{lH.setFieldValue("header.paymentMethod",l?l.key:null)},error:(null===(eN=lH.touched.header)||void 0===eN?void 0:eN.paymentMethod)&&!!(null===(ek=lH.errors.header)||void 0===ek?void 0:ek.paymentMethod),maxAccess:lU})}),(0,t.jsx)(i.ZP,{item:!0,xs:2.4,children:(0,t.jsx)(h.Z,{name:"header.vendorDocRef",label:lv.vendorDocRef,value:null==lH?void 0:null===(ew=lH.values)||void 0===ew?void 0:null===(eC=ew.header)||void 0===eC?void 0:eC.vendorDocRef,maxAccess:lU,readOnly:lz,maxLength:"15",onChange:lH.handleChange,onClear:()=>lH.setFieldValue("header.vendorDocRef",""),error:(null===(eV=lH.touched.header)||void 0===eV?void 0:eV.vendorDocRef)&&!!(null===(ej=lH.errors.header)||void 0===ej?void 0:ej.vendorDocRef)})}),(0,t.jsx)(i.ZP,{item:!0,xs:2.4,children:(0,t.jsx)(h.Z,{name:"header.reference",label:lv.reference,value:null==lH?void 0:null===(eT=lH.values)||void 0===eT?void 0:null===(eZ=eT.header)||void 0===eZ?void 0:eZ.reference,maxAccess:!lY&&lU,readOnly:lY,onChange:lH.handleChange,onClear:()=>lH.setFieldValue("header.reference",""),error:(null===(eD=lH.touched.header)||void 0===eD?void 0:eD.reference)&&!!(null===(eS=lH.errors.header)||void 0===eS?void 0:eS.reference)})}),(0,t.jsx)(i.ZP,{item:!0,xs:2.4,children:(0,t.jsx)(d.Z,{name:"header.dueDate",required:!0,label:lv.dueDate,readOnly:lz,value:null==lH?void 0:null===(eR=lH.values)||void 0===eR?void 0:null===(eO=eR.header)||void 0===eO?void 0:eO.dueDate,onChange:(e,l)=>lH.setFieldValue("header.dueDate",l),editMode:lY,maxAccess:lU,onClear:()=>lH.setFieldValue("header.dueDate",""),error:(null===(e_=lH.touched)||void 0===e_?void 0:null===(eq=e_.header)||void 0===eq?void 0:eq.dueDate)&&!!(null===(eL=lH.errors)||void 0===eL?void 0:null===(eM=eL.header)||void 0===eM?void 0:eM.dueDate)})}),(0,t.jsx)(i.ZP,{item:!0,xs:2.4,children:(0,t.jsx)(y.Z,{endpointId:I.$.Site.qry,name:"header.siteId",label:lv.site,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:lH.values.header,valueField:"recordId",displayField:["reference","name"],maxAccess:lU,displayFieldWidth:2,readOnly:lz||(null==lH?void 0:null===(eE=lH.values)||void 0===eE?void 0:null===(eW=eE.header)||void 0===eW?void 0:eW.dtId)&&!(null==lH?void 0:null===(eB=lH.values)||void 0===eB?void 0:null===(eU=eB.header)||void 0===eU?void 0:eU.commitItems),required:!(null==lH?void 0:null===(eG=lH.values)||void 0===eG?void 0:eG.header.dtId)||(null==lH?void 0:null===(eK=lH.values)||void 0===eK?void 0:eK.header.dtId)&&(null==lH?void 0:null===(e$=lH.values)||void 0===e$?void 0:e$.header.commitItems)==!0,onChange:(e,l)=>{lH.setFieldValue("header.siteRef",(null==l?void 0:l.reference)||null),lH.setFieldValue("header.siteName",(null==l?void 0:l.name)||null),lH.setFieldValue("header.siteId",(null==l?void 0:l.recordId)||null)},error:(null===(eQ=lH.touched)||void 0===eQ?void 0:null===(eJ=eQ.header)||void 0===eJ?void 0:eJ.siteId)&&!!(null===(eX=lH.errors)||void 0===eX?void 0:null===(eH=eX.header)||void 0===eH?void 0:eH.siteId)})}),(0,t.jsx)(i.ZP,{item:!0,xs:2.4,children:(0,t.jsx)(y.Z,{endpointId:x.r.Currency.qry,name:"header.currencyId",label:lv.currency,filter:e=>1==e.currencyType,valueField:"recordId",displayField:["reference","name"],readOnly:lz,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],required:!0,values:lH.values.header,maxAccess:lU,onChange:async(e,l)=>{var a;await aZ(null==l?void 0:l.recordId,null===(a=lH.values.header)||void 0===a?void 0:a.date),lH.setFieldValue("header.currencyId",(null==l?void 0:l.recordId)||null),lH.setFieldValue("header.currencyName",null==l?void 0:l.name)},error:(null===(eY=lH.touched)||void 0===eY?void 0:null===(ez=eY.header)||void 0===ez?void 0:ez.currencyId)&&!!(null===(e1=lH.errors)||void 0===e1?void 0:null===(e0=e1.header)||void 0===e0?void 0:e0.currencyId)})}),(0,t.jsx)(i.ZP,{item:!0,xs:1,children:(0,t.jsx)(z.Z,{onClick:()=>{var e;return e=lH.values.header,void lf({Component:H.Z,props:{DatasetIdAccess:aT(lp),data:e,onOk:e=>{lH.setFieldValue("header",{...lH.values.header,...e})}}})},label:lb.add,disabled:lH.values.header.currencyId===(null==lT?void 0:lT.currencyId),image:"popup.png",color:"#231f20"})}),(0,t.jsx)(i.ZP,{item:!0,xs:4.8,children:(0,t.jsx)(b.U,{endpointId:k.y.Vendor.snapshot,name:"header.vendorId",label:lv.vendor,valueField:"reference",displayField:"name",valueShow:"vendorRef",secondValueShow:"vendorName",formObject:lH.values.header,form:lH,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"},{key:"flName",value:"FL Name"}],onChange:(e,l)=>{ad(l)},secondFieldName:"header.vendorName",onSecondValueChange:(e,l)=>{lH.setFieldValue("header.vendorName",l)},errorCheck:"header.vendorId",maxAccess:lU,required:!0,readOnly:lz||(null==lH?void 0:null===(e3=lH.values)||void 0===e3?void 0:null===(e2=e3.items)||void 0===e2?void 0:e2.length)>0&&(null==lH?void 0:null===(e5=lH.values)||void 0===e5?void 0:null===(e6=e5.items[0])||void 0===e6?void 0:e6.sku),displayFieldWidth:3,editMode:lY})}),(0,t.jsx)(i.ZP,{item:!0,xs:2.4,children:(0,t.jsx)(K.Z,{name:"header.isVattable",value:null===(e8=lH.values)||void 0===e8?void 0:null===(e4=e8.header)||void 0===e4?void 0:e4.isVattable,onChange:e=>lH.setFieldValue("header.isVattable",e.target.checked),label:lv.VAT,disabled:(null==lH?void 0:null===(e9=lH.values)||void 0===e9?void 0:e9.items)&&(null==lH?void 0:null===(le=lH.values)||void 0===le?void 0:null===(e7=le.items[0])||void 0===e7?void 0:e7.itemId),maxAccess:lU})}),(0,t.jsx)(i.ZP,{item:!0,xs:2.4,children:(0,t.jsx)(y.Z,{endpointId:C.H.TaxSchedules.qry,name:"header.taxId",label:lv.tax,valueField:"recordId",displayField:["name"],readOnly:!(null===(la=lH.values)||void 0===la?void 0:null===(ll=la.header)||void 0===ll?void 0:ll.isVattable)||(null==lH?void 0:null===(ld=lH.values)||void 0===ld?void 0:null===(lt=ld.items)||void 0===lt?void 0:lt.length)>0&&(null==lH?void 0:null===(li=lH.values)||void 0===li?void 0:null===(ln=li.items[0])||void 0===ln?void 0:ln.sku),values:lH.values.header,onChange:(e,l)=>{lH.setFieldValue("header.taxId",(null==l?void 0:l.recordId)||null)},error:(null===(lo=lH.touched.header)||void 0===lo?void 0:lo.taxId)&&!!(null===(lr=lH.errors.header)||void 0===lr?void 0:lr.taxId),maxAccess:lU})}),(0,t.jsx)(i.ZP,{item:!0,xs:2.4,children:(0,t.jsx)(N.Z,{name:"header.KGmetalPrice",label:lv.metalPrice,value:lH.values.header.KGmetalPrice,readOnly:!0,hidden:lj})})]})}),(0,t.jsx)(g.Q,{children:(0,t.jsx)(A._,{onChange:(e,l)=>{lH.setFieldValue("items",e),lX.current=e,"delete"===l&&lq(!0)},onSelectionChange:(e,l,a)=>{"muRef"==a&&l1(null==e?void 0:e.itemId)},initialValues:l$.items[0],value:null==lH?void 0:null===(lu=lH.values)||void 0===lu?void 0:lu.items,error:lH.errors.items,name:"items",columns:l3,maxAccess:lU,allowDelete:!lz,disabled:lz||!lH.values.header.vendorId||!lH.values.header.vendorId})}),(0,t.jsx)(F.g,{children:(0,t.jsxs)(i.ZP,{container:!0,spacing:2,sx:{mt:"5px"},children:[(0,t.jsx)(i.ZP,{item:!0,xs:6,children:(0,t.jsx)(p.Z,{name:"header.description",label:lv.description,value:lH.values.header.description,rows:3,editMode:lY,maxAccess:lU,onChange:e=>lH.setFieldValue("header.description",e.target.value),onClear:()=>lH.setFieldValue("header.description",""),error:(null===(ls=lH.touched.header)||void 0===ls?void 0:ls.description)&&!!(null===(lc=lH.errors.header)||void 0===lc?void 0:lc.description)})}),(0,t.jsx)(i.ZP,{item:!0,xs:3,children:(0,t.jsxs)(o.Z,{spacing:2,children:[(0,t.jsx)(N.Z,{name:"header.qty",maxAccess:lU,label:lv.totQty,value:ay,readOnly:!0}),(0,t.jsx)(N.Z,{name:"header.volume",maxAccess:lU,label:lv.totVolume,value:aI,readOnly:!0}),(0,t.jsx)(N.Z,{name:"header.weight",maxAccess:lU,label:lv.totWeight,value:af,readOnly:!0})]})}),(0,t.jsx)(i.ZP,{item:!0,xs:3,children:(0,t.jsxs)(o.Z,{spacing:2,children:[(0,t.jsx)(N.Z,{name:"header.subTotal",maxAccess:lU,label:lv.subtotal,value:ab,readOnly:!0}),(0,t.jsx)(N.Z,{name:"header.tdAmount",maxAccess:lU,label:lv.discount,value:lH.values.header.currentDiscount,displayCycleButton:!0,cycleButtonLabel:lL.text,decimalScale:2,readOnly:lz,iconKey:lL.text,handleButtonClick:()=>{let e,l,a;lq(!0),1==lL.value?(e=parseFloat(l=lH.values.header.currentDiscount<0||lH.values.header.currentDiscount>100?0:lH.values.header.currentDiscount)*parseFloat(lH.values.header.subtotal)/100,a=l,lH.setFieldValue("header.tdAmount",e),lH.setFieldValue("header.tdPct",l),lH.setFieldValue("header.currentDiscount",l)):(l=parseFloat(e=lH.values.header.currentDiscount<0||ab<lH.values.header.currentDiscount?0:lH.values.header.currentDiscount)/parseFloat(lH.values.header.subtotal)*100,a=e,lH.setFieldValue("header.tdPct",l),lH.setFieldValue("header.tdAmount",e),lH.setFieldValue("header.currentDiscount",e)),lW(t=>{let d="%"===t.text?{text:"123",value:1}:{text:"%",value:2};return lH.setFieldValue("header.tdType",d.value),aA(d.value,l,e,a),d})},ShowDiscountIcons:!0,onChange:e=>{let l=Number(e.target.value.replace(/,/g,""));lH.values.header.tdType==S.a$?((l<0||l>100)&&(l=0),lH.setFieldValue("header.tdPct",l)):((l<0||ab<l)&&(l=0),lH.setFieldValue("header.tdAmount",l)),lH.setFieldValue("header.currentDiscount",l)},onBlur:async e=>{lq(!0);let l=Number(e.target.value.replace(/,/g,"")),a=Number(e.target.value.replace(/,/g,"")),t=Number(e.target.value.replace(/,/g,""));lH.values.header.tdType==S.ER&&(a=parseFloat(l)/parseFloat(ab)*100,lH.setFieldValue("header.tdPct",a)),lH.values.header.tdType==S.a$&&(t=parseFloat(l)*parseFloat(ab)/100,lH.setFieldValue("header.tdAmount",t)),await aA(lH.values.header.tdType,a,t,l)},onClear:()=>{lH.setFieldValue("header.tdAmount",0),lH.setFieldValue("header.tdPct",0),aA(lH.values.header.tdType,0,0,0)}}),(0,t.jsx)(N.Z,{name:"header.miscAmount",maxAccess:lU,label:lv.misc,value:lH.values.header.miscAmount,decimalScale:2,readOnly:lz,onChange:e=>lH.setFieldValue("header.miscAmount",e.target.value||0),onBlur:async()=>{lq(!0)},onClear:()=>lH.setFieldValue("header.miscAmount",0)}),(0,t.jsx)(N.Z,{name:"header.vatAmount",maxAccess:lU,label:lv.VAT,value:ag,readOnly:!0}),(0,t.jsx)(N.Z,{name:"header.amount",maxAccess:lU,label:lv.net,value:ax,readOnly:!0})]})})]})})]})})}},67920:function(e,l,a){"use strict";a.d(l,{m:function(){return d}});var t=a(48601);function d(e,l,a){var d;let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"items",i={...e};return null==a||null===(d=a.record)||void 0===d||d.controls.forEach(e=>{let{controlId:l,accessLevel:a}=e,[t,d]=null==l?void 0:l.split(".");t!==n||2!==a||d in i||(i[d]=e=>(null==e?void 0:e[d])!=null),(1===a||4===a)&&d in i&&delete i[d]}),{schema:t.Ry().shape({...Object.keys(i).reduce((e,a)=>(e[a]=t.nK().nullable().test(function(e){var t;let d=this.parent,[,n]=this.path.match(/^(\w+)\[(\d+)\]/)||[],o=(null===(t=this.options.context)||void 0===t?void 0:t[n])||[];if(l||!l&&o.length>1){if(null!==d[a]&&void 0!==d[a]&&0!==d[a]&&""!==i[a]&&!i[a](d))return!1;if(!Object.entries(i).some(e=>{let[,l]=e;return!!l(d)}))return!0}return!!i[a](d)&&void 0!==e}),e),{})}),requiredFields:i}}},61520:function(e,l,a){"use strict";var t=a(52322),d=a(2784),n=a(69387),i=a(26612),o=a(71987),r=a(65950),u=a(31389),s=a(62362),c=a(2454),v=a(33625),m=a(60218),h=a(5088),p=a(19473),y=a(21326);let x=e=>{let{itemId:l,obj:a,window:x}=e,{getRequest:I}=(0,d.useContext)(r.$),{platformLabels:f}=(0,d.useContext)(p.l);(0,y.Z)({title:f.CostHistory,window:x});let{query:{data:b},labels:g,access:A}=(0,o.J)({queryFn:F,endpointId:c.y.ItemCostHistory.qry,datasetId:i.i.ItemCostHistory}),P=[{field:"date",headerName:g.date,flex:1,type:"date"},{field:"vendorName",headerName:g.vendor,flex:1},,{field:"currencyName",headerName:g.currency,flex:1},{field:"baseLaborPrice",headerName:g.baseLaborPrice,flex:1,type:"number"},{field:"unitPrice",headerName:g.unitPrice,flex:1,type:"number"},{field:"markdown",headerName:g.markdown,flex:1,type:"number"},{field:"tradeDiscount",headerName:g.tradeDiscount,flex:1,type:"number"}];async function F(){return await I({extension:c.y.ItemCostHistory.qry,parameters:"_itemId=".concat(l)})}return(0,t.jsxs)(u.R,{children:[(0,t.jsx)(v.g,{children:(0,t.jsxs)(m.ZP,{container:!0,spacing:2,sx:{p:2},children:[(0,t.jsx)(m.ZP,{item:!0,xs:5,children:(0,t.jsx)(h.Z,{label:g.sku,value:a.sku,readOnly:!0})}),(0,t.jsx)(m.ZP,{item:!0,xs:6}),(0,t.jsx)(m.ZP,{item:!0,xs:5,children:(0,t.jsx)(h.Z,{label:g.itemName,value:a.itemName,readOnly:!0})})]})}),(0,t.jsx)(s.Q,{children:(0,t.jsx)(n.Z,{columns:P,gridData:b,rowId:["recordId"],isLoading:!1,maxAccess:A,pagination:!1})})]})};x.width=1e3,l.Z=x},77595:function(e,l,a){"use strict";a.d(l,{Z:function(){return g}});var t=a(52322),d=a(60218),n=a(2784),i=a(26612),o=a(5088),r=a(80983),u=a(31389),s=a(62362),c=a(91406),v=a(30657),m=a(65950),h=a(1251),p=a(39812),y=a(26553),x=a(71987),I=a(21326),f=a(19473),b=a(54074);function g(e){var l,a,g,A,P,F,N,k,C;let{data:w,onOk:V,DatasetIdAccess:j,window:Z}=e,{getRequest:T}=(0,n.useContext)(m.$),{platformLabels:D}=(0,n.useContext)(f.l);(0,I.Z)({title:D.MultiCurrencyRate,window:Z});let{labels:S,access:O}=(0,x.J)({endpointId:h.q.Currency.get,DatasetIdAccess:j,datasetId:i.i.MultiCurrencyRate}),{formik:R}=(0,r.c)({initialValues:{currencyId:null==w?void 0:w.currencyId,currencyName:null==w?void 0:w.currencyName,exchangeId:null==w?void 0:w.exchangeId,exchangeName:null==w?void 0:w.exchangeName,rateCalcMethod:null==w?void 0:w.rateCalcMethod,rateCalcMethodName:null==w?void 0:w.rateCalcMethodName,rateTypeId:null==w?void 0:w.rateTypeId,exRate:(null==w?void 0:w.exRate)||null,amount:(null==w?void 0:w.amount)||0,baseAmount:null==w?void 0:w.baseAmount,rateTypeName:null==w?void 0:w.rateTypeName},maxAccess:O,validateOnChange:!0});async function q(){if((null==w?void 0:w.currencyId)&&(null==w?void 0:w.date)){var e,l,a,t,d;let n=await T({extension:h.q.Currency.get,parameters:"_currencyId=".concat(null==w?void 0:w.currencyId,"&_date=").concat((0,p.Uf)(null==w?void 0:w.date),"&_rateDivision=").concat(y.B.FINANCIALS)});R.setFieldValue("rateCalcMethod",null===(e=n.record)||void 0===e?void 0:e.rateCalcMethod),R.setFieldValue("rateCalcMethodName",null===(l=n.record)||void 0===l?void 0:l.rateCalcMethodName),R.setFieldValue("exchangeId",null===(a=n.record)||void 0===a?void 0:a.exchangeId),R.setFieldValue("exchangeName",null===(t=n.record)||void 0===t?void 0:t.exchangeName),R.setFieldValue("rateTypeName",null===(d=n.record)||void 0===d?void 0:d.rateTypeName)}}(0,n.useEffect)(()=>{!async function(){await q()}()},[]);let _=()=>{V&&(V({...R.values,exRate:R.values.exRate,baseAmount:R.values.baseAmount,amount:R.values.amount}),Z.close())},M=[{key:"Ok",condition:!0,onClick:_,disabled:!1}];return(0,t.jsx)(b.Z,{onSave:_,actions:M,maxAccess:O,editMode:!1,isSaved:!1,children:(0,t.jsx)(u.R,{children:(0,t.jsx)(s.Q,{children:(0,t.jsxs)(d.ZP,{container:!0,spacing:2,children:[(0,t.jsx)(d.ZP,{item:!0,xs:12,children:(0,t.jsx)(o.Z,{name:"currencyName",value:null==R?void 0:null===(l=R.values)||void 0===l?void 0:l.currencyName,label:S.currency,readOnly:!0})}),(0,t.jsx)(d.ZP,{item:!0,xs:12,children:(0,t.jsx)(o.Z,{name:"rateTypeName",value:null==R?void 0:null===(a=R.values)||void 0===a?void 0:a.rateTypeName,label:S.rateType,readOnly:!0})}),(0,t.jsx)(d.ZP,{item:!0,xs:12,children:(0,t.jsx)(o.Z,{name:"exchangeName",value:null==R?void 0:null===(g=R.values)||void 0===g?void 0:g.exchangeName,label:S.exchangeTable,readOnly:!0})}),(0,t.jsx)(d.ZP,{item:!0,xs:12,children:(0,t.jsx)(o.Z,{name:"rateCalcMethodName",value:null==R?void 0:null===(A=R.values)||void 0===A?void 0:A.rateCalcMethodName,label:S.rateCalcMethod,readOnly:!0})}),(0,t.jsx)(d.ZP,{item:!0,xs:12,children:(0,t.jsx)(c.Z,{name:"exRate",value:null==R?void 0:null===(P=R.values)||void 0===P?void 0:P.exRate,label:S.rate,readOnly:(null==R?void 0:null===(F=R.values)||void 0===F?void 0:F.amount)==0,maxAccess:O,onClear:()=>{R.setFieldValue("baseAmount",""),R.setFieldValue("exRate","")},decimalScale:7,onChange:e=>{var l,a;let t=e.target.value;if(!t){R.setFieldValue("exRate",""),R.setFieldValue("baseAmount","");return}R.setFieldValue("exRate",t);let d=(0,v.fB)({amount:(null==w?void 0:w.amount)||0,exRate:t,baseAmount:parseFloat((null==R?void 0:null===(l=R.values)||void 0===l?void 0:l.baseAmount)||0).toFixed(2),rateCalcMethod:null==R?void 0:null===(a=R.values)||void 0===a?void 0:a.rateCalcMethod,dirtyField:v.ss});R.setValues({...R.values,...d,baseAmount:parseFloat(d.baseAmount).toFixed(2)})}})}),(0,t.jsx)(d.ZP,{item:!0,xs:12,children:(0,t.jsx)(c.Z,{name:"amount",value:null==R?void 0:null===(N=R.values)||void 0===N?void 0:N.amount,label:S.amount,readOnly:!0})}),(0,t.jsx)(d.ZP,{item:!0,xs:12,children:(0,t.jsx)(c.Z,{name:"baseAmount",value:null==R?void 0:null===(k=R.values)||void 0===k?void 0:k.baseAmount,label:S.baseAmount,readOnly:(null==R?void 0:null===(C=R.values)||void 0===C?void 0:C.amount)==0,onClear:()=>{R.setFieldValue("baseAmount",""),R.setFieldValue("exRate","")},maxAccess:O,onChange:e=>{var l,a;let t=e.target.value;if(!t){R.setFieldValue("baseAmount",""),R.setFieldValue("exRate","");return}R.setFieldValue("baseAmount",t);let d=(0,v.fB)({amount:(null==w?void 0:w.amount)||0,exRate:null==R?void 0:null===(l=R.values)||void 0===l?void 0:l.exRate,baseAmount:parseFloat(t||0).toFixed(2),rateCalcMethod:null==R?void 0:null===(a=R.values)||void 0===a?void 0:a.rateCalcMethod,dirtyField:v.i5});R.setValues({...R.values,...d})}})})]})})})})}g.width=500,g.height=500},85572:function(e,l,a){"use strict";a.d(l,{u:function(){return F}});var t=a(52322),d=a(31389),n=a(62362),i=a(26612),o=a(60218),r=a(8661),u=a(80983),s=a(48601),c=a(71987),v=a(2784),m=a(65950),h=a(91406),p=a(27423),y=a(65215),x=a(76399),I=a(33625),f=a(96026),b=a(19473),g=a(51235),A=a(21326),P=a(54074);let F=e=>{var l,a,F,N,k,C;let{row:w,siteId:V,checkForSiteId:j,window:Z,updateRow:T,disabled:D}=e,{getRequest:S}=(0,v.useContext)(m.$),{stack:O}=(0,f.V)(),{platformLabels:R,systemChecks:q}=(0,v.useContext)(b.l),_=q.some(e=>e.checkId===g.F.ALLOW_INVENTORY_NEGATIVE_QTY),M=(null==q?void 0:null===(l=q.find(e=>e.checkId===g.F.POS_JUMP_TO_NEXT_LINE))||void 0===l?void 0:l.value)||!1,{labels:L,maxAccess:W}=(0,c.J)({datasetId:i.i.Serial});(0,A.Z)({title:R.serials,window:Z});let{formik:E}=(0,u.c)({maxAccess:W,initialValues:{sku:null==w?void 0:w.sku,itemName:null==w?void 0:w.itemName,itemId:null==w?void 0:w.itemId,siteId:V,totalWeight:(null==w?void 0:w.qty)||0,pieces:null,items:(null==w?void 0:w.serials)||[]},validateOnChange:!0,validationSchema:s.Ry({items:s.IX().of(s.Ry({srlNo:s.Z_().test(function(e){var l,a,t;return(null===(t=this.options.from[1])||void 0===t?void 0:null===(a=t.value)||void 0===a?void 0:null===(l=a.items)||void 0===l?void 0:l.length)===1||!!e})}))}),onSubmit:async e=>{let l=e.items.filter(e=>null==e?void 0:e.srlNo).map((e,l)=>({...e,id:l+1,srlSeqNo:l+1,srlNo:e.srlNo,seqNo:w.id}));T({changes:{serials:l,...(null==w?void 0:w.hasOwnProperty("serialCount"))&&{serialCount:(null==l?void 0:l.length)||0}}}),Z.close()}}),U=E.values.items.reduce((e,l)=>e+(parseFloat(l.weight)||0),0),B=E.values.totalWeight-U||0,G=[{component:"textfield",name:"srlNo",label:L.serialNo,jumpToNextLine:M,updateOn:"blur",onChange:async e=>{let{row:{update:l,newRow:a,oldRow:t,addRow:d}}=e;a.srlNo!==(null==t?void 0:t.srlNo)&&await J(a,l,d)}},{component:"numberfield",name:"weight",label:L.weight,props:{readOnly:!0}}],K=e=>{let l=E.values.items.map(l=>l.id===e?{...l,srlNo:"",weight:""}:l);E.setFieldValue("items",l)},$=e=>{let l=E.values.items.filter(l=>l.id!==e);0===l.length&&(l=[{id:0,srlNo:"",weight:""}]),E.setFieldValue("items",l)},J=async(e,l,a)=>{let{srlNo:t,id:d}=e;if(t){var n;let i=await S({extension:y.$.Serial.get,parameters:"_srlNo=".concat(t)});i.record?(null==i?void 0:null===(n=i.record)||void 0===n?void 0:n.itemId)!==(null==w?void 0:w.itemId)?(O({message:R.serialDoesNotBelongItem}),K(d)):j&&!_&&E.values.siteId?(await S({extension:y.$.AvailabilitySerial.get,parameters:"_srlNo=".concat(t,"&_siteId=").concat(E.values.siteId)})).record?(l({weight:i.record.weight}),a({fieldName:"srlNo",changes:{id:e.id,srlNo:e.srlNo,weight:i.record.weight}})):(O({message:L.invalidSerial}),K(d)):(l({weight:i.record.weight}),a({fieldName:"srlNo",changes:{id:e.id,srlNo:e.srlNo,weight:i.record.weight}})):(O({message:R.unknownSerial}),$(d))}},Q=[{key:"Ok",condition:!0,onClick:()=>E.handleSubmit(),disabled:D}];return(0,t.jsx)(P.Z,{onSave:E.handleSubmit,isSaved:!1,actions:Q,maxAccess:W,children:(0,t.jsxs)(d.R,{children:[(0,t.jsx)(I.g,{children:(0,t.jsxs)(o.ZP,{container:!0,spacing:2,children:[(0,t.jsx)(o.ZP,{item:!0,xs:12,children:(0,t.jsx)(p.U,{endpointId:y.$.Item.snapshot,name:"itemId",label:null==L?void 0:L.sku,valueField:"recordId",displayField:"sku",valueShow:"sku",secondValueShow:"itemName",form:E,readOnly:!0})}),(0,t.jsx)(o.ZP,{item:!0,xs:12,children:(0,t.jsx)(r.Z,{endpointId:y.$.Site.qry,name:"siteId",label:L.site,values:E.values,valueField:"recordId",displayField:["reference","name"],maxAccess:W,readOnly:!0})}),(0,t.jsx)(o.ZP,{item:!0,xs:12,children:(0,t.jsx)(h.Z,{name:"totalWeight",label:L.totalWeight,maxAccess:W,value:E.values.totalWeight,readOnly:!0})}),(0,t.jsx)(o.ZP,{item:!0,xs:12,children:(0,t.jsx)(h.Z,{name:"weightAssigned",label:L.weightAssigned,maxAccess:W,value:U,readOnly:!0})}),(0,t.jsx)(o.ZP,{item:!0,xs:12,children:(0,t.jsx)(h.Z,{name:"balanceWeight",label:L.balanceWeight,maxAccess:W,value:B,readOnly:!0})}),(0,t.jsx)(o.ZP,{item:!0,xs:12,children:(0,t.jsx)(h.Z,{name:"pieces",label:L.pieces,maxAccess:W,value:null==E?void 0:null===(N=E.values)||void 0===N?void 0:null===(F=N.items)||void 0===F?void 0:null===(a=F.filter(e=>void 0!==e.srlNo))||void 0===a?void 0:a.length,readOnly:!0})})]})}),(0,t.jsx)(n.Q,{children:(0,t.jsx)(x._,{onChange:e=>E.setFieldValue("items",e),value:null===(k=E.values)||void 0===k?void 0:k.items,error:null===(C=E.errors)||void 0===C?void 0:C.items,name:"items",columns:G,maxAccess:W,disabled:D,allowDelete:!D,allowAddNewLine:!D})})]})})};F.width=500,F.height=700},39704:function(e,l,a){"use strict";var t=a(52322),d=a(2784),n=a(22341),i=a(65950),o=a(85325),r=a(21326),u=a(19473),s=a(35656),c=a(24868),v=a.n(c);let m=e=>{let{functionId:l,recordId:a,window:c}=e,{getRequest:m}=(0,d.useContext)(i.$),{languageId:h}=(0,d.useContext)(o.V),{platformLabels:p}=(0,d.useContext)(u.l),y=a+"-"+l;(0,r.Z)({title:p.WorkFlow,window:c});let{width:x}=(0,s.d)(),I=x<=1024,f=x>1024&&x<=1280,b=I?10:f?12:14,g=I?75:f?85:95,A=I?15:f?20:25,P=async()=>{var e="_functionId=".concat(l,"&_recordId=").concat(a);let t=await m({extension:n.P.WorkFlow.graph,parameters:e});return null==t?void 0:t.record},F=e=>{let l=[],a=[],t="",d="";return e.objects.forEach(e=>{l.push({functionName:e.functionName,reference:e.reference,date:e.date})}),e.workflow.forEach(l=>{e.objects.forEach(e=>{let a=e.functionName.split(" ").join("\r\n");l.parentId===e.recordId&&l.parentFunctionId===e.functionId&&(t=e.reference+"\r\n"+e.date+"\r\n"+a,l.parentId),l.childId===e.recordId&&l.childFunctionId===e.functionId&&(d=e.reference+"\r\n"+e.date+"\r\n"+a,l.childId)}),""===t||""===d||a.push({from:t,to:d,value:1,labelText:""}),t="",d=""}),a};return(0,d.useEffect)(()=>{!async function(){var e=await P();if(e){let l=(e,l)=>{let a=document.createElement("script");a.type="text/javascript",a.src=e,a.async=!0,a.onload=l,document.head.appendChild(a)};l("https://cdn.amcharts.com/lib/4/core.js",()=>{l("https://cdn.amcharts.com/lib/4/charts.js",()=>{l("https://cdn.amcharts.com/lib/4/themes/animated.js",()=>{am4core.ready(()=>{let l=am4core.create(y,am4charts.SankeyDiagram),a=F(e);l.data=a,l.dataFields.fromName="from",l.dataFields.toName="to",l.dataFields.value="value",l.paddingRight=2===h?0:40,l.paddingLeft=2===h?40:0,l.tooltip.label.fontSize=b;let t=l.nodes.template;t.draggable=!1,t.inert=!0,t.clickable=!1,t.width=g,t.height=A,t.nameLabel.label.fontSize=b,t.nameLabel.locationX=2===h?.85:0,t.nameLabel.height=void 0,t.nameLabel.label.fontWeight="bold";let d=l.links.template;d.middleLine.strokeOpacity=.3,d.middleLine.stroke=am4core.color("#555"),d.middleLine.strokeWidth=5,d.middleLine.hoverable=!1,d.fillOpacity=0,d.hoverable=!0,d.hoverOnFocus=!0,d.fill=am4core.color("#A8C686"),d.isHover=!0,l.appear(1e3,100)})})})})}}()},[]),(0,t.jsx)("div",{id:y,className:v().root})};m.width=950,l.Z=m},16096:function(e,l,a){"use strict";a.d(l,{ER:function(){return t},Ot:function(){return u},Ww:function(){return r},Yi:function(){return i},a$:function(){return d}});let t=1,d=2,n=e=>{if(!0===e.tdPct){e.tdAmount>100?1===e.typeChange?e.tdAmount=0:e.tdAmount=e.currentDiscount:e.currentDiscount=e.tdAmount,e.hiddenTdPct=e.tdAmount;let l=e.subtotal*e.tdAmount/100;e.hiddenTdAmount=l,e.tdType=d}else if(e.tdAmount>e.subtotal)1===e.typeChange?e.tdAmount=0:e.tdAmount=e.currentDiscount;else{e.currentDiscount=e.tdAmount;let l=0===e.subtotal?0:100*e.tdAmount/e.subtotal;e.hiddenTdPct=l,e.hiddenTdAmount=e.tdAmount,e.tdType=t}return e},i=e=>e=n(e),o=(e,l)=>(e.forEach(e=>{l.totalQty+=parseFloat(e.qty),l.totalWeight+=e.qty*e.weight,l.totalVolume+=e.qty*e.volume,l.totalUpo+=e.upo,l.sumVat+=e.vatAmount}),l.net=l.sumExtended+l.sumVat+((null==l?void 0:l.miscAmount)||0)-((null==l?void 0:l.tdAmount)||0),l),r=e=>e.reduce((e,l)=>e+(Number(l.extendedPrice)||0),0),u=(e,l)=>l=o(e,l)},24868:function(e){e.exports={root:"WorkFlow_root__EINm1"}}}]);