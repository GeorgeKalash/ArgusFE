(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[61414],{61414:function(e,n,d){"use strict";d.d(n,{Z:function(){return A}});var l=d(52322),r=d(60218),o=d(2784),t=d(48601),a=d(82737),i=d(62202),s=d(76399),u=d(65950),c=d(26612),v=d(96026),m=d(5088),h=d(80983),p=d(19473),y=d(31389),I=d(62362),f=d(89330),x=d(8661),g=d(38449),b=d(7121),k=d(21581),w=d(98345),N=d(39812),F=d(33625),C=d(61802),j=d(65215),S=d(27423),Z=d(39704),q=d(2454),R=d(54074);function V(e){var n,d,a,s,c,v,I,N,C,j,Z,V,P,O,Q,_,A,D;let{labels:L,maxAccess:T,recordId:E,form:W,window:J}=e,{getRequest:$,postRequest:U}=(0,o.useContext)(u.$),{platformLabels:M,defaultsData:z}=(0,o.useContext)(p.l),{documentType:G,maxAccess:H,changeDT:B}=(0,w.H)({functionId:b.J.PurchaseInvoice,access:T,enabled:!E}),K=parseInt(null==z?void 0:null===(d=z.list)||void 0===d?void 0:null===(n=d.find(e=>"PUCurrencyId"===e.key))||void 0===n?void 0:n.value),{formik:X}=(0,h.c)({documentType:{key:"dtId",value:null==G?void 0:G.dtId},initialValues:{reference:null==W?void 0:null===(s=W.values)||void 0===s?void 0:null===(a=s.header)||void 0===a?void 0:a.reference,plantId:null==W?void 0:null===(v=W.values)||void 0===v?void 0:null===(c=v.header)||void 0===c?void 0:c.plantId,vendorId:null==W?void 0:null===(N=W.values)||void 0===N?void 0:null===(I=N.header)||void 0===I?void 0:I.vendorId,vendorRef:null==W?void 0:null===(j=W.values)||void 0===j?void 0:null===(C=j.header)||void 0===C?void 0:C.vendorRef,vendorName:null==W?void 0:null===(V=W.values)||void 0===V?void 0:null===(Z=V.header)||void 0===Z?void 0:Z.vendorName,date:new Date,dtId:null,currencyName:null,currencyId:K,plantName:null==W?void 0:null===(O=W.values)||void 0===O?void 0:null===(P=O.header)||void 0===P?void 0:P.plantName,description:"",shipments:[null==W?void 0:null===(Q=W.values)||void 0===Q?void 0:Q.recordId]},maxAccess:H,validateOnChange:!0,validationSchema:t.Ry({plantId:t.Rx().required(),dtId:t.Rx().required(),date:t.Z_().required(),currencyName:t.Z_().required()}),onSubmit:async e=>{await U({extension:q.y.PurchaseInvoiceHeader.generate,record:JSON.stringify(e)}).then(e=>{i.ZP.success(M.Saved),W.setFieldValue("header.invoiceId",e.recordId),J.close()})}});return(0,o.useEffect)(()=>{!async function(){var e,n;if(null==X?void 0:null===(e=X.values)||void 0===e?void 0:e.currencyId){let e=await $({extension:g.r.Currency.get,parameters:"_recordId=".concat(null==X?void 0:null===(n=X.values)||void 0===n?void 0:n.currencyId)});X.setFieldValue("currencyName",e.record.name)}}()},[]),(0,l.jsx)(R.Z,{onSave:X.handleSubmit,maxAccess:H,actions:[{key:"Generate Invoice",condition:!0,onClick:()=>X.handleSubmit()}],isSaved:!1,children:(0,l.jsx)(y.R,{children:(0,l.jsx)(F.g,{children:(0,l.jsxs)(r.ZP,{container:!0,spacing:2,children:[(0,l.jsx)(r.ZP,{item:!0,xs:12,children:(0,l.jsx)(x.Z,{endpointId:g.r.DocumentType.qry,parameters:"_dgId=".concat(b.J.PurchaseInvoice,"&_startAt=",0,"&_pageSize=",1e3),name:"dtId",label:L.docType,valueField:"recordId",displayField:"name",values:X.values,onChange:(e,n)=>{X.setFieldValue("dtId",(null==n?void 0:n.recordId)||null),B(n)},error:X.touched.dtId&&!!X.errors.dtId,maxAccess:H,required:!0})}),(0,l.jsx)(r.ZP,{item:!0,xs:12,children:(0,l.jsx)(f.Z,{name:"date",label:L.date,value:null===(_=X.values)||void 0===_?void 0:_.date,required:!0,onChange:X.setFieldValue,onClear:()=>X.setFieldValue("date",null),error:(null===(A=X.touched.header)||void 0===A?void 0:A.date)&&!!(null===(D=X.errors.header)||void 0===D?void 0:D.date),maxAccess:H})}),(0,l.jsx)(r.ZP,{item:!0,xs:12,children:(0,l.jsx)(x.Z,{endpointId:g.r.Plant.qry,name:"plantId",label:L.plant,valueField:"recordId",displayField:["reference","name"],values:X.values,readOnly:!0})}),(0,l.jsx)(r.ZP,{item:!0,xs:12,children:(0,l.jsx)(S.U,{endpointId:q.y.Vendor.snapshot,filter:{isInactive:!1},valueField:"reference",displayField:"name",secondFieldLabel:L.vendor,name:"vendorId",label:L.vendor,form:X,required:!0,readOnly:!0,valueShow:"vendorRef",secondValueShow:"vendorName",errorCheck:"vendorId"})}),(0,l.jsx)(r.ZP,{item:!0,xs:12,children:(0,l.jsx)(m.Z,{name:"currencyName",required:!0,label:L.currency,value:X.values.currencyName,readOnly:!0,error:X.touched.currencyName&&!!X.errors.currencyName})}),(0,l.jsx)(r.ZP,{item:!0,xs:12,children:(0,l.jsx)(m.Z,{name:"reference",label:L.shipmentRef,value:X.values.reference,readOnly:!0})}),(0,l.jsx)(r.ZP,{item:!0,xs:12,children:(0,l.jsx)(k.Z,{name:"description",label:L.description,value:X.values.description,maxAccess:H,onChange:X.handleChange,onClear:()=>X.setFieldValue("description",""),error:X.touched.description&&!!X.errors.description})})]})})})})}var P=d(91406),O=d(71987),Q=d(50023),_=d(21326);function A(e){var n,R,A,D,L,T,E,W,J,$,U,M,z,G,H,B,K,X,Y,ee,en,ed,el,er,eo,et,ea,ei,es,eu,ec,ev,em,eh,ep,ey,eI,ef,ex;let{recordId:eg,window:eb}=e,{getRequest:ek,postRequest:ew}=(0,o.useContext)(u.$),{platformLabels:eN,userDefaultsData:eF,defaultsData:eC}=(0,o.useContext)(p.l),{stack:ej}=(0,C.zY)(),eS=(0,o.useRef)([]),eZ=(0,o.useRef)([]),eq=(0,o.useRef)([]),[eR,eV]=(0,o.useState)([]),{stack:eP}=(0,v.V)(),eO=(0,O.E)({endpointId:q.y.Shipment.page}),{labels:eQ,access:e_}=(0,Q.Z)({datasetId:c.i.Shipments});(0,_.Z)({title:eQ.shipment,window:eb});let{documentType:eA,maxAccess:eD,changeDT:eL}=(0,w.H)({functionId:b.J.Shipment,access:e_,enabled:!eg,objectName:"header"}),eT=parseInt(null==eF?void 0:null===(R=eF.list)||void 0===R?void 0:null===(n=R.find(e=>"plantId"===e.key))||void 0===n?void 0:n.value)||null,eE=parseInt(null==eF?void 0:null===(D=eF.list)||void 0===D?void 0:null===(A=D.find(e=>"siteId"===e.key))||void 0===A?void 0:A.value)||null,eW=parseInt(null==eC?void 0:null===(T=eC.list)||void 0===T?void 0:null===(L=T.find(e=>"POSHPVarPct"===e.key))||void 0===L?void 0:L.value)||0,{formik:eJ}=(0,h.c)({documentType:{key:"header.dtId",value:null==eA?void 0:eA.dtId,reference:null==eA?void 0:eA.reference},initialValues:{recordId:eg||null,header:{reference:"",recordId:null,date:new Date,dtId:null,status:1,plantId:eT,siteId:eE,vendorId:null,volume:0,qty:0,weight:0,notes:"",invoiceId:null,poRef:"",vendorName:"",vendorRef:""},items:[{id:1,seqNo:1,itemId:null,sku:"",itemName:"",qty:null,pendingQty:null,shippedNowQty:null,shipmentId:null,poSeqNo:null,volume:null,weight:null,poId:eg||0,poRef:"",siteId:null,siteRef:"",siteName:"",status:null,unitCost:null,trackBy:null,lotCategoryId:null,muName:"",muId:null,muRef:"",msId:null,baseQty:0,muQty:0,shipmentId:null,lotButton:!0}]},maxAccess:eD,validateOnChange:!0,validationSchema:t.Ry({header:t.Ry({plantId:t.Rx().required(),date:t.hT().required(),siteId:t.Rx().required(),vendorId:t.Rx().required()}),items:t.IX().of(t.Ry({poRef:t.Z_().required(),sku:t.Z_().required(),itemName:t.Z_().required(),shippedNowQty:t.Rx().required(),siteName:t.Z_().required()}))}),onSubmit:async e=>{let n={header:{...e.header,date:(0,N.ku)(e.header.date)},items:eJ.values.items.map((e,n)=>{var d;return{...e,id:n+1,seqNo:n+1,qty:e.shippedNowQty,shipmentId:(null==eJ?void 0:null===(d=eJ.values)||void 0===d?void 0:d.recordId)||0}})},d=await ew({extension:q.y.Shipment.set2,record:JSON.stringify(n)});eJ.setFieldValue("recordId",d.recordId),eJ.setFieldValue("header.recordId",d.recordId),await eH(d.recordId),eg?i.ZP.success(eN.Edited):i.ZP.success(eN.Added),eO()}}),{totalQty:e$,totalVolume:eU,totalWeight:eM}=null==eJ?void 0:null===(W=eJ.values)||void 0===W?void 0:null===(E=W.items)||void 0===E?void 0:E.reduce((e,n)=>{let d=parseFloat(null==n?void 0:n.shippedNowQty)||0,l=parseFloat(null==n?void 0:n.volume)||0,r=parseFloat(null==n?void 0:n.weight)||0;return{totalQty:(null==e?void 0:e.totalQty)+d,totalVolume:(null==e?void 0:e.totalVolume)+l,totalWeight:(null==e?void 0:e.totalWeight)+r}},{totalQty:0,totalVolume:0,totalWeight:0});(0,o.useEffect)(()=>{eJ.setFieldValue("header.qty",e$),eJ.setFieldValue("header.volume",eU),eJ.setFieldValue("header.weight",eM)},[eM,eU,e$]);let ez=(null===(J=eJ.values.header)||void 0===J?void 0:J.status)===3,eG=!!(null===($=eJ.values.header)||void 0===$?void 0:$.recordId);async function eH(e){let n=await eB(e);n.record.date=(0,N.a1)(n.record.date);let d=await eK(null==n?void 0:n.record);await eX(n,d)}async function eB(e){if(e)return await ek({extension:q.y.Shipment.get,parameters:"_recordId=".concat(e)})}let eK=async e=>{if(e.recordId)return await ek({extension:q.y.ShipmentItem.qry,parameters:"_shipmentId=".concat(e.recordId)})};async function eX(e,n){let d=eJ.initialValues.items;n.list!=[]&&(d=await Promise.all(n.list.map((e,n)=>({...e,id:n+1,seqNo:n+1,date:(0,N.a1)(e.date),shippedNowQty:e.qty})))),eJ.setValues({...eJ.values,recordId:e.record.recordId,dtId:e.record.dtId,header:{...e.record},items:d}),e2(e.record.vendorId)}let eY=async()=>{await ew({extension:q.y.Shipment.post,record:JSON.stringify(eJ.values.header)}),i.ZP.success(eN.Posted),eO(),await eH(eJ.values.recordId)},e0=async()=>{await ew({extension:q.y.Shipment.unpost,record:JSON.stringify(eJ.values.header)}),i.ZP.success(eN.Unposted),eO(),await eH(eJ.values.recordId)};(0,o.useEffect)(()=>{!async function(){eg&&await eH(eg)}()},[]);let e1=[{key:"Locked",condition:ez,onClick:"onUnpostConfirmation",onSuccess:e0,disabled:!eG},{key:"Unlocked",condition:!ez,onClick:eY,disabled:!eG},{key:"WorkFlow",condition:!0,onClick:async()=>{ej({Component:Z.Z,props:{functionId:b.J.Shipment,recordId:eJ.values.header.recordId}})},disabled:!eG},{key:"generateIV",condition:!0,onClick:async function(){ej({Component:V,props:{form:eJ,labels:eQ,maxAccess:eD,recordId:eg},width:500,height:550,title:eN.GenerateInvoice})},disabled:!ez||(null==eJ?void 0:null===(M=eJ.values)||void 0===M?void 0:null===(U=M.header)||void 0===U?void 0:U.invoiceId)},{key:"GL",condition:!0,onClick:"onClickGL",valuesPath:eJ.values.header,datasetId:c.i.GLShipments,disabled:!eG},{key:"IV",condition:!0,onClick:"onInventoryTransaction",disabled:!eG||!ez},{key:"Attachment",condition:!0,onClick:"onClickAttachment",disabled:!eG},{key:"RecordRemarks",condition:!0,onClick:"onRecordRemarks",disabled:!eG}];async function e2(e){e?await ek({extension:q.y.UnpostedOrderPack.get,parameters:"_vendorId=".concat(e)}).then(e=>{eS.current=e.record}):eS.current=[]}let e4=e=>{var n,d,l;if(!(null==eS?void 0:null===(d=eS.current)||void 0===d?void 0:null===(n=d.items)||void 0===n?void 0:n.length))return[];let r=(null==eS?void 0:null===(l=eS.current)||void 0===l?void 0:l.items).filter(n=>n.poId===e).map(e=>{let{poId:n,poSeqNo:d,itemId:l,sku:r,itemName:o,qty:t,trackBy:a,lotCategoryId:i,msId:s,isInactive:u}=e;return{poId:n,poSeqNo:d,itemId:l,sku:r,itemName:o,qty:t,trackBy:a,lotCategoryId:i,msId:s,isInactive:u}});eZ.current=r};(0,o.useEffect)(()=>{!async function(){let e=await e5();eV(null==e?void 0:e.list)}()},[]);let e5=async()=>await ek({extension:j.$.MeasurementUnit.qry,parameters:"_msId=0"});async function e3(e,n){if(!e)return;let d=(null==eR?void 0:eR.filter(e=>e.msId===n))||[];eq.current=d}let e6=[{component:"resourcecombobox",label:eQ.reference,name:"poRef",props:{store:null==eS?void 0:null===(z=eS.current)||void 0===z?void 0:z.orders,displayField:"reference",valueField:"reference",readOnly:ez,mapping:[{from:"poId",to:"poId"},{from:"reference",to:"poRef"}],columnsInDropDown:[{key:"reference",value:"Reference"}],displayFieldWidth:1},async onChange(e){let{row:{newRow:n}}=e;e4(null==n?void 0:n.poId)},propsReducer(e){let{row:n,props:d}=e;return{...d,readOnly:!!n.poId}}},{component:"resourcecombobox",label:eQ.sku,name:"sku",flex:1,propsReducer(e){let{row:n,props:d}=e;return{...d,readOnly:!!n.shipmentId&&!!n.poId&&!!n.sku}},props:{store:null==eZ?void 0:eZ.current,displayField:"sku",valueField:"sku",mapping:[{from:"itemId",to:"itemId"},{from:"sku",to:"sku"},{from:"itemName",to:"itemName"},{from:"msId",to:"msId"},{from:"poSeqNo",to:"poSeqNo"},{from:"qty",to:"qty"},{from:"qty",to:"shippedNowQty"},{from:"trackBy",to:"trackBy"},{from:"lotCategoryId",to:"lotCategoryId"},{from:"isInactive",to:"isInactive"}],columnsInDropDown:[{key:"sku",value:"SKU"},{key:"itemName",value:"Item Name"}],displayFieldWidth:2},async onChange(e){var n,d,l,r,o,t,a,i;let{row:{update:s,newRow:u}}=e;if(!u.itemId){eq.current=[],s({muRef:null,muId:null,baseQty:0,muQty:0});return}if(u.isInactive){s({...eJ.initialValues.items[0],poId:null==u?void 0:u.poId,poRef:null==u?void 0:u.poRef,id:u.id}),eP({message:eQ.inactiveItem});return}e3(null==u?void 0:u.itemId,null==u?void 0:u.msId),s({muRef:(null==eq?void 0:null===(d=eq.current)||void 0===d?void 0:null===(n=d[0])||void 0===n?void 0:n.reference)||null,muId:(null==eq?void 0:null===(r=eq.current)||void 0===r?void 0:null===(l=r[0])||void 0===l?void 0:l.recordId)||null,muQty:(null==eq?void 0:null===(t=eq.current)||void 0===t?void 0:null===(o=t[0])||void 0===o?void 0:o.qty)||0,baseQty:(null==eq?void 0:null===(i=eq.current)||void 0===i?void 0:null===(a=i[0])||void 0===a?void 0:a.qty)||(null==u?void 0:u.qty)})}},{component:"textfield",label:eQ.itemName,name:"itemName",props:{readOnly:!0}},{component:"resourcecombobox",label:eQ.MU,name:"muRef",props:{readOnly:ez,store:null==eq?void 0:eq.current,displayField:"reference",valueField:"recordId",mapping:[{from:"reference",to:"muRef"},{from:"name",to:"muName"},{from:"qty",to:"muQty"},{from:"recordId",to:"muId"}]},async onChange(e){let{row:{update:n,newRow:d}}=e;d&&n(d.muId?{baseQty:(null==d?void 0:d.qty)*(null==d?void 0:d.muQty)}:{baseQty:0})},propsReducer(e){let{row:n,props:d}=e,l=[];return(null==n?void 0:n.itemId)&&(e3(null==n?void 0:n.itemId,null==n?void 0:n.msId),l=null==eq?void 0:eq.current),{...d,store:l}}},{component:"numberfield",label:eQ.qty,name:"shippedNowQty",props:{readOnly:ez},updateOn:"blur",async onChange(e){let{row:{update:n,oldRow:d,newRow:l}}=e;e8(null==l?void 0:l.shippedNowQty,l,n),n((null==l?void 0:l.muQty)?{baseQty:(null==l?void 0:l.muQty)*(null==l?void 0:l.shippedNowQty)}:{baseQty:null==l?void 0:l.shippedNowQty})}},{component:"button",hidden:!0,name:"lotButton",props:{imgSrc:d(91970).default.src},label:eQ.lot,onClick:(e,n)=>{}},{component:"resourcecombobox",label:eQ.site,name:"siteName",props:{endpointId:j.$.Site.qry,displayField:"name",valueField:"recordId",readOnly:ez,mapping:[{from:"recordId",to:"siteId"},{from:"reference",to:"siteRef"},{from:"name",to:"siteName"}],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}]}}],e8=(e,n,d)=>{if(!e)return;let l=(null==n?void 0:n.qty)*(eW/100),r=(null==n?void 0:n.qty)+l,o=(null==n?void 0:n.pendingQty)+l,t={shippedNowQty:e};(null==n?void 0:n.pendingQty)?e>o?t={shippedNowQty:0}:e<0&&(t={qty:0}):e>r?t={shippedNowQty:0}:e<0&&(t={qty:0}),d(t)};return(0,l.jsx)(a.Z,{resourceId:c.i.Shipments,form:eJ,maxAccess:eD,editMode:eG,actions:e1,functionId:b.J.Shipment,disabledSubmit:ez,previewReport:eG,children:(0,l.jsxs)(y.R,{children:[(0,l.jsx)(F.g,{children:(0,l.jsxs)(r.ZP,{container:!0,spacing:2,children:[(0,l.jsx)(r.ZP,{item:!0,xs:8,children:(0,l.jsxs)(r.ZP,{container:!0,spacing:2,children:[(0,l.jsx)(r.ZP,{item:!0,xs:6,children:(0,l.jsx)(x.Z,{endpointId:g.r.DocumentType.qry,parameters:"_dgId=".concat(b.J.Shipment,"&_startAt=0&_pageSize=1000"),name:"header.dtId",label:eQ.docType,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],readOnly:eG,valueField:"recordId",displayField:["reference","name"],values:eJ.values.header,onChange:(e,n)=>{eJ.setFieldValue("header.dtId",(null==n?void 0:n.recordId)||""),eL(n)},error:(null===(G=eJ.touched.header)||void 0===G?void 0:G.dtId)&&!!(null===(H=eJ.errors.header)||void 0===H?void 0:H.dtId),maxAccess:eD})}),(0,l.jsx)(r.ZP,{item:!0,xs:6,children:(0,l.jsx)(f.Z,{name:"header.date",label:eQ.date,value:null===(K=eJ.values)||void 0===K?void 0:null===(B=K.header)||void 0===B?void 0:B.date,onChange:eJ.setFieldValue,onClear:()=>eJ.setFieldValue("header.date",""),readOnly:ez,error:(null===(X=eJ.touched.header)||void 0===X?void 0:X.date)&&!!(null===(Y=eJ.errors.header)||void 0===Y?void 0:Y.date),maxAccess:eD,required:!0})}),(0,l.jsx)(r.ZP,{item:!0,xs:6,children:(0,l.jsx)(m.Z,{name:"header.reference",label:eQ.reference,value:null===(ee=eJ.values.header)||void 0===ee?void 0:ee.reference,readOnly:eG,maxAccess:eD,onChange:eJ.handleChange,onClear:()=>eJ.setFieldValue("header.reference",""),error:(null===(en=eJ.touched.header)||void 0===en?void 0:en.reference)&&!!(null===(ed=eJ.errors.header)||void 0===ed?void 0:ed.reference)})}),(0,l.jsx)(r.ZP,{item:!0,xs:6,children:(0,l.jsx)(x.Z,{endpointId:g.r.Plant.qry,name:"header.plantId",label:eQ.plant,valueField:"recordId",readOnly:ez,displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:eJ.values.header,onChange:(e,n)=>{eJ.setFieldValue("header.plantId",(null==n?void 0:n.recordId)||null),eJ.setFieldValue("header.plantIdTouched",null!=n&&!!n.recordId),eJ.setFieldValue("header.siteId",null)},error:(null===(er=eJ.touched)||void 0===er?void 0:null===(el=er.header)||void 0===el?void 0:el.plantId)&&!!(null===(et=eJ.errors)||void 0===et?void 0:null===(eo=et.header)||void 0===eo?void 0:eo.plantId),required:!0,maxAccess:eD})}),(0,l.jsx)(r.ZP,{item:!0,xs:12,children:(0,l.jsx)(S.U,{endpointId:q.y.Vendor.snapshot,filter:e=>!e.isInactive,valueField:"reference",displayField:"name",secondFieldLabel:eQ.vendor,name:"header.vendorId",label:eQ.vendor,formObject:eJ.values.header,form:eJ,required:!0,readOnly:eG,displayFieldWidth:2,valueShow:"vendorRef",secondValueShow:"vendorName",maxAccess:eD,secondFieldName:"header.vendorName",onSecondValueChange:(e,n)=>{eJ.setFieldValue("header.vendorName",n)},columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"},{key:"flName",value:"Foreign Language"}],onChange:async(e,n)=>{if(eJ.setFieldValue("header.vendorName",(null==n?void 0:n.name)||""),eJ.setFieldValue("header.vendorRef",(null==n?void 0:n.reference)||""),e2(null==n?void 0:n.recordId),!(null==n?void 0:n.recordId)){var d;eJ.setFieldValue("items",null==eJ?void 0:null===(d=eJ.initialValues)||void 0===d?void 0:d.items)}eJ.setFieldValue("header.vendorId",(null==n?void 0:n.recordId)||null)},errorCheck:"header.vendorId"})})]})}),(0,l.jsx)(r.ZP,{item:!0,xs:4,children:(0,l.jsxs)(r.ZP,{container:!0,spacing:2,children:[(0,l.jsx)(r.ZP,{item:!0,xs:12,children:(0,l.jsx)(x.Z,{endpointId:j.$.Site.qry,name:"header.siteId",label:eQ.site,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],filter:(null===(ei=eJ.values)||void 0===ei?void 0:null===(ea=ei.header)||void 0===ea?void 0:ea.plantIdTouched)?e=>{var n,d;return Number(e.plantId)===Number(null==eJ?void 0:null===(d=eJ.values)||void 0===d?void 0:null===(n=d.header)||void 0===n?void 0:n.plantId)}:void 0,required:!0,values:eJ.values.header,valueField:"recordId",displayField:["reference","name"],maxAccess:eD,readOnly:ez,onChange:(e,n)=>{(null==n?void 0:n.isInactive)?(eP({message:eQ.inactiveSite}),eJ.setFieldValue("header.siteId",null)):eJ.setFieldValue("header.siteId",(null==n?void 0:n.recordId)||null)},error:(null===(eu=eJ.touched)||void 0===eu?void 0:null===(es=eu.header)||void 0===es?void 0:es.siteId)&&!!(null===(ev=eJ.errors)||void 0===ev?void 0:null===(ec=ev.header)||void 0===ec?void 0:ec.siteId)})}),(0,l.jsx)(r.ZP,{item:!0,xs:12,children:(0,l.jsx)(k.Z,{name:"header.notes",label:eQ.notes,value:null===(em=eJ.values.header)||void 0===em?void 0:em.notes,readOnly:ez,maxAccess:eD,onChange:eJ.handleChange,onClear:()=>eJ.setFieldValue("header.notes",""),error:(null===(eh=eJ.touched.header)||void 0===eh?void 0:eh.notes)&&!!(null===(ep=eJ.errors.header)||void 0===ep?void 0:ep.notes)})})]})})]})}),(0,l.jsx)(I.Q,{children:(0,l.jsx)(s._,{onChange:e=>{eJ.setFieldValue("items",e)},value:null==eJ?void 0:null===(ey=eJ.values)||void 0===ey?void 0:ey.items,error:null==eJ?void 0:null===(eI=eJ.errors)||void 0===eI?void 0:eI.items,initialValues:null==eJ?void 0:null===(ex=eJ.initialValues)||void 0===ex?void 0:null===(ef=ex.items)||void 0===ef?void 0:ef[0],columns:e6,maxAccess:eD,name:"shippedItems",allowDelete:!ez,allowAddNewLine:!ez})}),(0,l.jsx)(F.g,{children:(0,l.jsxs)(r.ZP,{container:!0,spacing:2,mt:.3,children:[(0,l.jsx)(r.ZP,{item:!0,xs:3,children:(0,l.jsx)(P.Z,{name:"totalQty",label:eQ.totalQty,maxAccess:eD,value:e$,readOnly:!0})}),(0,l.jsx)(r.ZP,{item:!0,xs:3,children:(0,l.jsx)(P.Z,{name:"totalVolume",label:eQ.totalVolume,maxAccess:eD,value:eU,readOnly:!0})}),(0,l.jsx)(r.ZP,{item:!0,xs:3,children:(0,l.jsx)(P.Z,{name:"totalWeight",label:eQ.totalWeight,maxAccess:eD,value:eM,readOnly:!0})})]})})]})})}A.width=1300,A.height=700},1685:function(e,n,d){"use strict";d.d(n,{m:function(){return l}});let l=e=>{let n=window.sessionStorage.getItem(e);return n?JSON.parse(n):null}},98345:function(e,n,d){"use strict";d.d(n,{H:function(){return p},G:function(){return h}});var l=d(45300),r=d(2784),o=d(96026),t=d(38449);d(26612);var a=d(65947),i=d(1685);let s=async(e,n,d)=>{try{let l=await e({extension:n,parameters:d});return n.includes("qry")?l:l.record}catch(e){return null}},u=(e,n,d,l)=>{let r=(e=JSON.parse(JSON.stringify(e))).record.controls,o=r.find(e=>"reference"===e.controlId);return o?o.accessLevel=(null==n?void 0:n.mandatory)?a.$7:a.rr:(null==n?void 0:n.mandatory)?r.push({sgId:0,resourceId:"",controlId:"".concat(l?l+".":"","reference"),accessLevel:(null==n?void 0:n.mandatory)?a.$7:a.rr}):(null==n?void 0:n.readOnly)?r.push({sgId:0,resourceId:"",controlId:"".concat(l?l+".":"","reference"),accessLevel:(null==n?void 0:n.readOnly)?a.rr:a.$7}):r=e.record.controls.filter(e=>"reference"!=e.controlId),d&&r.push({sgId:0,resourceId:"",controlId:"".concat(l?l+".":"","dtId"),accessLevel:a.$7}),{...e,record:{...e.record,controls:r}}},c=async(e,n,d)=>{let l,r;switch(d){case"dtId":let o=(0,i.m)("userData"),a=null==o?void 0:o.userId;r="_userId=".concat(a,"&_functionId=").concat(n),l=t.r.UserFunction.get;break;case"glbSysNumberRange":r="_recordId=".concat(n),l=t.r.SystemFunction.get;break;case"DocumentType":r="_dgId=".concat(n,"&_startAt=",0,"&_pageSize=",50),l=t.r.DocumentType.qry;break;case"DcTypNumberRange":r="_recordId=".concat(n),l=t.r.DocumentType.get;break;case"isExternal":r="_recordId=".concat(n),l=t.r.NumberRange.get;break;default:return null}return await s(e,l,r)},v=async function(e){let n,d,l,r,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,t=arguments.length>2?arguments[2]:void 0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,i=!(arguments.length>4)||void 0===arguments[4]||arguments[4],s=arguments.length>5?arguments[5]:void 0,v=void 0===a&&o&&await c(e,o,"dtId"),m=null==v?void 0:v.dtId,h="",p=!0;if(v&&void 0===a||"nraId"===a){if(m){let d=await c(e,m,"DcTypNumberRange");n=null==d?void 0:d.nraId,p=!((null==d?void 0:d.activeStatus)<0),n||(h="Assign the document type to a number range")}if((!m||!p)&&i&&o){var y;let n=await c(e,o,"DocumentType");r=(null==n?void 0:null===(y=n.list)||void 0===y?void 0:y.filter(e=>(null==e?void 0:e.activeStatus)===1).length)>0}}if(("nraId"===a||void 0===a)&&o){if((!m||m)&&!n||n&&!p){let d=await c(e,o,"glbSysNumberRange");(n=null==d?void 0:d.nraId)&&r&&(r=!1),p=!0}h=n||r?"":"Assign the system Function to a number range"}a>0&&!n&&(n=a),n&&p?(d={readOnly:null==(l=await c(e,n,"isExternal"))||!l.external,mandatory:null!=l&&!!l.external},t&&(t=await u(t,d,r,s))):!n&&t&&(t=await u(t,d,r,s));let I=s?"".concat(s,".reference"):"reference";return{dtId:m,resetReference:null==d?void 0:d.readOnly,dcTypeRequired:r,reference:{fieldName:I,isEmpty:(null==l?void 0:l.external)!==void 0&&(null==l||!l.external)},errorMessage:h,maxAccess:t,selectNraId:a}};var m=d(65950);function h(e){let{functionId:n,action:d,hasDT:l}=e,{getRequest:t}=(0,r.useContext)(m.$),{stack:a}=(0,o.V)();return{proxyAction:async()=>{let e=await v(t,n,"",void 0,l);(null==e?void 0:e.errorMessage)?a({message:null==e?void 0:e.errorMessage}):await d()}}}function p(e){var n;let{functionId:d,access:t,hasDT:a,enabled:i=!0,objectName:s=""}=e,{getRequest:u}=(0,r.useContext)(m.$),{stack:c}=(0,o.V)(),[h,p]=(0,r.useState)(),y=async e=>{let n=await v(u,d,t,e,a,s);if(!n.errorMessage)return n;c({message:null==n?void 0:n.errorMessage})},I=(0,l.a)({retry:!1,staleTime:0,enabled:i,queryKey:[d,h,!!t,i],queryFn:h||"nraId"===h?()=>y(h):()=>y()});return{documentType:I.data,maxAccess:(null==I?void 0:null===(n=I.data)||void 0===n?void 0:n.maxAccess)||t,changeDT(e){p((null==e?void 0:e.nraId)||"nraId")}}}},39704:function(e,n,d){"use strict";var l=d(52322),r=d(2784),o=d(22341),t=d(65950),a=d(85325),i=d(21326),s=d(19473),u=d(35656),c=d(24868),v=d.n(c);let m=e=>{let{functionId:n,recordId:d,window:c}=e,{getRequest:m}=(0,r.useContext)(t.$),{languageId:h}=(0,r.useContext)(a.V),{platformLabels:p}=(0,r.useContext)(s.l),y=d+"-"+n;(0,i.Z)({title:p.WorkFlow,window:c});let{width:I}=(0,u.d)(),f=I<=1024,x=I>1024&&I<=1280,g=f?10:x?12:14,b=f?75:x?85:95,k=f?15:x?20:25,w=async()=>{var e="_functionId=".concat(n,"&_recordId=").concat(d);let l=await m({extension:o.P.WorkFlow.graph,parameters:e});return null==l?void 0:l.record},N=e=>{let n=[],d=[],l="",r="";return e.objects.forEach(e=>{n.push({functionName:e.functionName,reference:e.reference,date:e.date})}),e.workflow.forEach(n=>{e.objects.forEach(e=>{let d=e.functionName.split(" ").join("\r\n");n.parentId===e.recordId&&n.parentFunctionId===e.functionId&&(l=e.reference+"\r\n"+e.date+"\r\n"+d,n.parentId),n.childId===e.recordId&&n.childFunctionId===e.functionId&&(r=e.reference+"\r\n"+e.date+"\r\n"+d,n.childId)}),""===l||""===r||d.push({from:l,to:r,value:1,labelText:""}),l="",r=""}),d};return(0,r.useEffect)(()=>{!async function(){var e=await w();if(e){let n=(e,n)=>{let d=document.createElement("script");d.type="text/javascript",d.src=e,d.async=!0,d.onload=n,document.head.appendChild(d)};n("https://cdn.amcharts.com/lib/4/core.js",()=>{n("https://cdn.amcharts.com/lib/4/charts.js",()=>{n("https://cdn.amcharts.com/lib/4/themes/animated.js",()=>{am4core.ready(()=>{let n=am4core.create(y,am4charts.SankeyDiagram),d=N(e);n.data=d,n.dataFields.fromName="from",n.dataFields.toName="to",n.dataFields.value="value",n.paddingRight=2===h?0:40,n.paddingLeft=2===h?40:0,n.tooltip.label.fontSize=g;let l=n.nodes.template;l.draggable=!1,l.inert=!0,l.clickable=!1,l.width=b,l.height=k,l.nameLabel.label.fontSize=g,l.nameLabel.locationX=2===h?.85:0,l.nameLabel.height=void 0,l.nameLabel.label.fontWeight="bold";let r=n.links.template;r.middleLine.strokeOpacity=.3,r.middleLine.stroke=am4core.color("#555"),r.middleLine.strokeWidth=5,r.middleLine.hoverable=!1,r.fillOpacity=0,r.hoverable=!0,r.hoverOnFocus=!0,r.fill=am4core.color("#A8C686"),r.isHover=!0,n.appear(1e3,100)})})})})}}()},[]),(0,l.jsx)("div",{id:y,className:v().root})};m.width=950,n.Z=m},24868:function(e){e.exports={root:"WorkFlow_root__EINm1"}}}]);