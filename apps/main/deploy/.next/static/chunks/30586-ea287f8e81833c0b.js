(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[30586],{64581:function(e,t){"use strict";t.Z={src:"/_next/static/media/imgSerials.d1ee59bb.png",height:17,width:23,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAGCAMAAADJ2y/JAAAAIVBMVEUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABt0UjBAAAAC3RSTlMCZzsmQ6RbWbaSTwNdgTwAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAArSURBVHicY2BiZ2BgYOBiZmBmYmRjZGRhYGBg4eBkZWVDYjAzMbKDpWCKARB/AJwjPQgCAAAAAElFTkSuQmCC",blurWidth:8,blurHeight:6}},1685:function(e,t,l){"use strict";l.d(t,{m:function(){return n}});let n=e=>{let t=window.sessionStorage.getItem(e);return t?JSON.parse(t):null}},98345:function(e,t,l){"use strict";l.d(t,{H:function(){return I},G:function(){return f}});var n=l(45300),a=l(2784),i=l(96026),r=l(38449);l(26612);var o=l(65947),d=l(1685);let s=async(e,t,l)=>{try{let n=await e({extension:t,parameters:l});return t.includes("qry")?n:n.record}catch(e){return null}},c=(e,t,l,n)=>{let a=(e=JSON.parse(JSON.stringify(e))).record.controls,i=a.find(e=>"reference"===e.controlId);return i?i.accessLevel=(null==t?void 0:t.mandatory)?o.$7:o.rr:(null==t?void 0:t.mandatory)?a.push({sgId:0,resourceId:"",controlId:"".concat(n?n+".":"","reference"),accessLevel:(null==t?void 0:t.mandatory)?o.$7:o.rr}):(null==t?void 0:t.readOnly)?a.push({sgId:0,resourceId:"",controlId:"".concat(n?n+".":"","reference"),accessLevel:(null==t?void 0:t.readOnly)?o.rr:o.$7}):a=e.record.controls.filter(e=>"reference"!=e.controlId),l&&a.push({sgId:0,resourceId:"",controlId:"".concat(n?n+".":"","dtId"),accessLevel:o.$7}),{...e,record:{...e.record,controls:a}}},u=async(e,t,l)=>{let n,a;switch(l){case"dtId":let i=(0,d.m)("userData"),o=null==i?void 0:i.userId;a="_userId=".concat(o,"&_functionId=").concat(t),n=r.r.UserFunction.get;break;case"glbSysNumberRange":a="_recordId=".concat(t),n=r.r.SystemFunction.get;break;case"DocumentType":a="_dgId=".concat(t,"&_startAt=",0,"&_pageSize=",50),n=r.r.DocumentType.qry;break;case"DcTypNumberRange":a="_recordId=".concat(t),n=r.r.DocumentType.get;break;case"isExternal":a="_recordId=".concat(t),n=r.r.NumberRange.get;break;default:return null}return await s(e,n,a)},v=async function(e){let t,l,n,a,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,d=!(arguments.length>4)||void 0===arguments[4]||arguments[4],s=arguments.length>5?arguments[5]:void 0,v=void 0===o&&i&&await u(e,i,"dtId"),m=null==v?void 0:v.dtId,f="",I=!0;if(v&&void 0===o||"nraId"===o){if(m){let l=await u(e,m,"DcTypNumberRange");t=null==l?void 0:l.nraId,I=!((null==l?void 0:l.activeStatus)<0),t||(f="Assign the document type to a number range")}if((!m||!I)&&d&&i){var p;let t=await u(e,i,"DocumentType");a=(null==t?void 0:null===(p=t.list)||void 0===p?void 0:p.filter(e=>(null==e?void 0:e.activeStatus)===1).length)>0}}if(("nraId"===o||void 0===o)&&i){if((!m||m)&&!t||t&&!I){let l=await u(e,i,"glbSysNumberRange");(t=null==l?void 0:l.nraId)&&a&&(a=!1),I=!0}f=t||a?"":"Assign the system Function to a number range"}o>0&&!t&&(t=o),t&&I?(l={readOnly:null==(n=await u(e,t,"isExternal"))||!n.external,mandatory:null!=n&&!!n.external},r&&(r=await c(r,l,a,s))):!t&&r&&(r=await c(r,l,a,s));let y=s?"".concat(s,".reference"):"reference";return{dtId:m,resetReference:null==l?void 0:l.readOnly,dcTypeRequired:a,reference:{fieldName:y,isEmpty:(null==n?void 0:n.external)!==void 0&&(null==n||!n.external)},errorMessage:f,maxAccess:r,selectNraId:o}};var m=l(65950);function f(e){let{functionId:t,action:l,hasDT:n}=e,{getRequest:r}=(0,a.useContext)(m.$),{stack:o}=(0,i.V)();return{proxyAction:async()=>{let e=await v(r,t,"",void 0,n);(null==e?void 0:e.errorMessage)?o({message:null==e?void 0:e.errorMessage}):await l()}}}function I(e){var t;let{functionId:l,access:r,hasDT:o,enabled:d=!0,objectName:s=""}=e,{getRequest:c}=(0,a.useContext)(m.$),{stack:u}=(0,i.V)(),[f,I]=(0,a.useState)(),p=async e=>{let t=await v(c,l,r,e,o,s);if(!t.errorMessage)return t;u({message:null==t?void 0:t.errorMessage})},y=(0,n.a)({retry:!1,staleTime:0,enabled:d,queryKey:[l,f,!!r,d],queryFn:f||"nraId"===f?()=>p(f):()=>p()});return{documentType:y.data,maxAccess:(null==y?void 0:null===(t=y.data)||void 0===t?void 0:t.maxAccess)||r,changeDT(e){I((null==e?void 0:e.nraId)||"nraId")}}}},30586:function(e,t,l){"use strict";l.d(t,{Z:function(){return V}});var n=l(52322),a=l(60218),i=l(2784),r=l(48601),o=l(82737),d=l(62202),s=l(76399),c=l(65950),u=l(71987),v=l(26612),m=l(5088),f=l(80983),I=l(19473),p=l(31389),y=l(62362),h=l(89330),x=l(8661),g=l(38449),A=l(7121),w=l(21581),b=l(98345),C=l(39812),k=l(39704),j=l(61802),N=l(65215),S=l(51264),Z=l(33625),F=l(25506),D=l(96026),O=l(95982),q=l(85572),T=l(21326),P=l(50023),_=l(93878);function V(e){var t,V,R,M,$,G,J,L,E,W,B,Q,U,H;let{recordId:Y,window:z}=e,{getRequest:K,postRequest:X}=(0,i.useContext)(c.$),{platformLabels:ee,userDefaultsData:et}=(0,i.useContext)(I.l),{stack:el}=(0,j.zY)(),{stack:en}=(0,D.V)(),ea=(0,i.useRef)([]),[ei,er]=(0,i.useState)([]),eo=(0,i.useRef)([]),{labels:ed,access:es}=(0,P.Z)({datasetId:v.i.MaterialsTransfer,editMode:!!Y});(0,T.Z)({title:ed.MaterialsTransfer,window:z});let{documentType:ec,maxAccess:eu,changeDT:ev}=(0,b.H)({functionId:A.J.MaterialTransfer,access:es,enabled:!Y}),em=null==et?void 0:null===(t=et.list)||void 0===t?void 0:t.find(e=>{let{key:t}=e;return"siteId"===t}),ef=parseInt(null==et?void 0:null===(R=et.list)||void 0===R?void 0:null===(V=R.find(e=>"plantId"===e.key))||void 0===V?void 0:V.value),eI={recordId:null,functionId:A.J.MaterialTransfer,reference:"",dtId:null,oDocId:"",date:new Date,closedDate:null,receivedDate:null,fromSiteId:parseInt((null==em?void 0:em.value)||null),toSiteId:null,notes:"",status:1,plantId:ef,printStatus:null,qty:null,pcs:null,isVerified:!1,wip:1,carrierId:null,plId:null,transfers:[{id:1,transferId:Y||0,seqNo:1,sku:"",itemName:null,itemId:null,qty:null,componentSeqNo:0,qtyInBase:0,muId:null,muQty:"",muRef:"",weight:null,unitCost:0,msId:null,trackBy:null,lotCategoryId:null,metalId:null,metalRef:"",totalCost:0,priceType:null}],serials:[]},ep=(0,u.E)({endpointId:N.$.MaterialsTransfer.page});async function ey(){!ew&&(null==ec?void 0:ec.dtId)&&await ej(null==ec?void 0:ec.dtId)}async function eh(e,t,l,n){let a={recordId:e,functionId:A.J.MaterialTransfer,notificationGroupId:l.values.notificationGroupId,date:l.values.date,reference:t,status:n};await X({extension:O.y.Notification.set,record:JSON.stringify(a)})}let{formik:ex}=(0,f.c)({initialValues:eI,maxAccess:eu,documentType:{key:"dtId",value:null==ec?void 0:ec.dtId},validateOnChange:!0,validationSchema:r.Ry({date:r.hT().required(),fromSiteId:r.Z_().required(),toSiteId:r.Z_().required(),transfers:r.IX().of(r.Ry().shape({sku:r.Z_().required(),qty:r.Z_().required()})).required()}),onSubmit:async e=>{let t={...e};delete t.transfers,delete t.serials,t.date=t.date?(0,C.ku)(t.date):null,t.closedDate=t.closedDate?(0,C.ku)(t.closedDate):null,t.receivedDate=t.receivedDate?(0,C.ku)(t.receivedDate):null;let l=[],n=ex.values.transfers.map((e,t)=>{let{serials:n,...a}=e;if(n){let a=n.map((l,n)=>({...l,seqNo:t+1,id:n,srlSeqNo:0,componentSeqNo:0,itemId:null==e?void 0:e.itemId,transferId:ex.values.recordId||0}));l.push(...a)}return{...a,seqNo:t+1,transferId:ex.values.recordId||0,unitCost:parseFloat(e.unitCost),totalCost:parseFloat(e.totalCost)}});if(e.fromSiteId===e.toSiteId){en({message:ed.errorMessage});return}let a=await X({extension:N.$.MaterialsTransfer.set2,record:JSON.stringify({header:t,items:n,serials:l,lots:[]})});if(e.recordId){if(ex.values.notificationGroupId)eh(a.recordId,ex.values.reference,ex,1);else if(!ex.values.notificationGroupId&&a.recordId){let e={recordId:a.recordId,functionId:A.J.MaterialTransfer,notificationGroupId:0};await X({extension:O.y.Notification.del,record:JSON.stringify(e)})}}d.ZP.success(e.recordId?ee.Edited:ee.Added),eV(a.recordId,!0),ep()}}),eg=3===ex.values.status,eA=2===ex.values.wip,ew=!!ex.values.recordId,eb=async e=>{var t,l,n,a;let i=await K({extension:N.$.Physical.get,parameters:"_itemId=".concat(e)});return{weight:null!==(a=null==i?void 0:null===(t=i.record)||void 0===t?void 0:t.weight)&&void 0!==a?a:0,metalId:null==i?void 0:null===(l=i.record)||void 0===l?void 0:l.metalId,metalRef:null==i?void 0:null===(n=i.record)||void 0===n?void 0:n.metalRef}},eC=async e=>{var t;let l=await K({extension:N.$.CurrentCost.get,parameters:"_itemId="+e});return null==l?void 0:null===(t=l.record)||void 0===t?void 0:t.currentCost};function ek(e){return(console.log(e),1===e.priceType)?(Math.round(e.qty*e.unitCost*100)/100).toFixed(2):2===e.priceType?(Math.round(e.qty*e.unitCost*e.volume*100)/100).toFixed(2):3===e.priceType?(Math.round(e.qty*e.unitCost*e.weight*100)/100).toFixed(2):0}async function ej(e){if(e)return await K({extension:N.$.DocumentTypeDefaults.get,parameters:"_dtId=".concat(e)})}async function eN(e){if(e){var t,l,n,a,i;let r=await ej(e);ex.setFieldValue("toSiteId",(null==r?void 0:null===(t=r.record)||void 0===t?void 0:t.toSiteId)||null),ex.setFieldValue("fromSiteId",(null==r?void 0:null===(l=r.record)||void 0===l?void 0:l.siteId)?null==r?void 0:null===(n=r.record)||void 0===n?void 0:n.siteId:em||null),ex.setFieldValue("carrierId",null==r?void 0:null===(a=r.record)||void 0===a?void 0:a.carrierId),ex.setFieldValue("plantId",(null==r?void 0:null===(i=r.record)||void 0===i?void 0:i.plantId)||ef)}}let{totalQty:eS,totalCost:eZ,totalWeight:eF}=null==ex?void 0:null===($=ex.values)||void 0===$?void 0:null===(M=$.transfers)||void 0===M?void 0:M.reduce((e,t)=>{let l=parseFloat(null==t?void 0:t.qty)||0,n=parseFloat(null==t?void 0:t.totalCost)||0,a=parseFloat(null==t?void 0:t.weight)||0;return{totalQty:(null==e?void 0:e.totalQty)+l,totalCost:(Math.round((parseFloat(null==e?void 0:e.totalCost)+n)*100)/100).toFixed(2),totalWeight:(null==e?void 0:e.totalWeight)+a}},{totalQty:0,totalCost:0,totalWeight:0}),eD=async()=>await K({extension:N.$.MeasurementUnit.qry,parameters:"_msId=0"});async function eO(e){let t=await K({extension:N.$.Item.get,parameters:"_recordId=".concat(e)});return null==t?void 0:t.record}async function eq(e){var t,l;if(!e)return;let n=null===(l=ex.values.transfers)||void 0===l?void 0:null===(t=l.find(t=>parseInt(t.itemId)===e))||void 0===t?void 0:t.msId,a=(null==ei?void 0:ei.filter(e=>e.msId===n))||[];ea.current=a}let eT=e=>1===e.trackBy?{imgSrc:l(64581).Z.src,hidden:!1}:{imgSrc:"",hidden:!0},eP=[{component:"resourcelookup",label:ed.sku,name:"sku",link:{enabled:!0,popup:e=>{var t;return el({Component:_.Z,props:{itemId:null==e?void 0:e.itemId,plId:null===(t=ex.values)||void 0===t?void 0:t.plId}})}},props:{endpointId:N.$.Item.snapshot,valueField:"sku",displayField:"sku",mandatory:!0,readOnly:eA,displayFieldWidth:4,mapping:[{from:"recordId",to:"itemId"},{from:"msId",to:"msId"},{from:"trackBy",to:"trackBy"},{from:"lotCategoryId",to:"lotCategoryId"},{from:"priceType",to:"priceType"},{from:"sku",to:"sku"},{from:"name",to:"itemName"},{from:"isInactive",to:"isInactive"}],columnsInDropDown:[{key:"sku",value:"SKU"},{key:"name",value:"Name"},{key:"flName",value:"flName"}]},propsReducer(e){let{row:t,props:l}=e;return{...l,imgSrc:eT(t)}},async onChange(e){let{row:{update:t,newRow:l}}=e,n=()=>{t({...ex.initialValues.transfers[0],id:l.id})};if(!(null==l?void 0:l.itemId))return n();if(l.isInactive){n(),en({message:ed.inactiveItem});return}if(null==l?void 0:l.itemId){var a,i,r;let{weight:e,metalId:n,metalRef:o}=await eb(null==l?void 0:l.itemId),d=null!==(r=await eC(null==l?void 0:l.itemId))&&void 0!==r?r:0,s=ek(l),c=await eO(l.itemId);eq(null==l?void 0:l.itemId);let u=null==ei?void 0:ei.filter(e=>e.msId===(null==c?void 0:c.msId));t({weight:e,unitCost:d,totalCost:s,msId:null==c?void 0:c.msId,muRef:null==u?void 0:null===(a=u[0])||void 0===a?void 0:a.reference,muId:null==u?void 0:null===(i=u[0])||void 0===i?void 0:i.recordId,metalId:n,metalRef:o})}}},{component:"textfield",label:ed.itemName,name:"itemName",props:{readOnly:!0}},{component:"textfield",label:ed.metalRef,name:"metalRef",props:{readOnly:!0}},{component:"resourcecombobox",label:ed.muId,name:"muRef",props:{store:null==ea?void 0:ea.current,displayField:"reference",valueField:"recordId",readOnly:eA,mapping:[{from:"reference",to:"muRef"},{from:"qty",to:"muQty"},{from:"recordId",to:"muId"}]},async onChange(e){var t;let{row:{update:l,newRow:n}}=e,a=null==ea?void 0:ea.current.filter(e=>e.recordId===(null==n?void 0:n.muId));l({qtyInBase:(null==n?void 0:n.qty)*(null==a?void 0:a.muQty),muQty:null==n?void 0:n.muQty})},propsReducer(e){let{row:t,props:l}=e;return{...l,store:null==ea?void 0:ea.current}}},{component:"numberfield",label:ed.weight,name:"weight",props:{readOnly:!0}},{component:"numberfield",label:ed.qty,name:"qty",props:{readOnly:eA},async onChange(e){let{row:{update:t,newRow:l}}=e;if(l){var n;t({totalCost:ek(l),qtyInBase:(null==l?void 0:l.qty)*(null==l?void 0:l.muQty)})}}},{component:"numberfield",label:ed.unitCost,name:"unitCost",props:{readOnly:!0}},{component:"numberfield",label:ed.totalCost,name:"totalCost",props:{readOnly:!0}},{component:"button",name:"serials",label:ee.serials,props:{onCondition:eT},onClick:(e,t,l,n)=>{if((null==t?void 0:t.trackBy)===1){var a;el({Component:q.u,props:{labels:ed,row:t,disabled:eg||eA,siteId:null==ex?void 0:null===(a=ex.values)||void 0===a?void 0:a.fromSiteId,maxAccess:es,checkForSiteId:!0,updateRow:n}})}}}];async function e_(e){var t,l,n;let a=await K({extension:N.$.MaterialsTransfer.get,parameters:"_recordId=".concat(e)});return a.record.date=(0,C.a1)(null==a?void 0:null===(t=a.record)||void 0===t?void 0:t.date),a.record.closedDate=(0,C.a1)(null==a?void 0:null===(l=a.record)||void 0===l?void 0:l.closedDate),a.record.receivedDate=(0,C.a1)(null==a?void 0:null===(n=a.record)||void 0===n?void 0:n.receivedDate),a}async function eV(e,t){let l=await e_(e);ex.values.notificationGroupId&&eh(e,l.record.reference,ex,1);let n=await eW(e,t),a=await Promise.all(n.list.map(async e=>{var t,l,n,a;return{...e,id:e.seqNo,totalCost:ek(e),serials:null==eo?void 0:null===(n=eo.current)||void 0===n?void 0:null===(l=n.list)||void 0===l?void 0:null===(t=l.filter(t=>t.seqNo==e.seqNo))||void 0===t?void 0:t.map((e,t)=>({...e,id:t})),unitCost:null!==(a=e.unitCost)&&void 0!==a?a:0}}));ex.setValues({...l.record,recordId:e,transfers:a,notificationGroupId:ex.values.notificationGroupId})}let eR=async e=>{await X({extension:N.$.MaterialsTransfer.close,record:JSON.stringify({recordId:e})}),d.ZP.success(ee.Closed),ep(),await eV(ex.values.recordId)};async function eM(){let e={...ex.values};delete e.transfers,delete e.notificationGroupId,e.date=e.date?(0,C.ku)(e.date):null,e.closedDate=e.closedDate?(0,C.ku)(e.closedDate):null,e.receivedDate=e.receivedDate?(0,C.ku)(e.receivedDate):null,await X({extension:N.$.MaterialsTransfer.reopen,record:JSON.stringify(e)}),d.ZP.success(ee.Reopened),ep(),await eV(ex.values.recordId)}let e$=async()=>{el({Component:k.Z,props:{functionId:A.J.MaterialTransfer,recordId:ex.values.recordId}})},eG=async()=>{let e={...ex.values};if(delete e.transfers,delete e.notificationGroupId,e.date=e.date?(0,C.ku)(e.date):null,e.closedDate=e.closedDate?(0,C.ku)(e.closedDate):null,e.receivedDate=e.receivedDate?(0,C.ku)(e.receivedDate):null,await X({extension:N.$.MaterialsTransfer.post,record:JSON.stringify(e)}),ex.values.notificationGroupId)eh(ex.values.recordId,ex.values.reference,ex,3);else if(!ex.values.notificationGroupId){let e={recordId:ex.values.recordId,functionId:A.J.MaterialTransfer,notificationGroupId:0};await X({extension:O.y.Notification.del,record:JSON.stringify(e)})}d.ZP.success(ee.Posted),ep(),await eV(ex.values.recordId)},eJ=async()=>{let e={...ex.values};delete e.transfers,delete e.notificationGroupId,e.date=e.date?(0,C.ku)(e.date):null,e.closedDate=e.closedDate?(0,C.ku)(e.closedDate):null,e.receivedDate=e.receivedDate?(0,C.ku)(e.receivedDate):null,await X({extension:N.$.MaterialsTransfer.unpost,record:JSON.stringify(e)}),d.ZP.success(ee.Unposted),ep(),await eV(ex.values.recordId)},eL=[{key:"RecordRemarks",condition:!0,onClick:"onRecordRemarks",disabled:!ew},{key:"GL",condition:!0,onClick:"onClickGL",datasetId:v.i.GLMaterialsTransfer,disabled:!ew},{key:"IV",condition:!0,onClick:"onInventoryTransaction",disabled:!ew||!eg},{key:"Locked",condition:eg,onClick:"onUnpostConfirmation",onSuccess:eJ,disabled:!ew||!eA||ex.values.isVerified},{key:"Unlocked",condition:!eg,onClick:eG,disabled:!ew||!eA||ex.values.isVerified},{key:"Close",condition:!eA,onClick:()=>eR(ex.values.recordId),disabled:eA||!ew||eg},{key:"Reopen",condition:eA,onClick:eM,disabled:!eA||!ew||eg},{key:"WorkFlow",condition:!0,onClick:e$,disabled:!ew}];async function eE(e){return await K({extension:O.y.Notification.get,parameters:"_recordId=".concat(e,"&_functionId=").concat(A.J.MaterialTransfer)})}async function eW(e,t){let l=await K({extension:N.$.MaterialsTransferItems.qry,parameters:"_transferId=".concat(e,"&_functionId=").concat(A.J.MaterialTransfer)});if((null==l?void 0:l.list)&&t){let t=await eB(e);(null==t?void 0:t.count)&&(eo.current=t)}return l}async function eB(e){return await K({extension:N.$.MaterialTransferSerial.qry,parameters:"_transferId=".concat(e,"&_seqNo=",0,"&_componentSeqNo=",0)})}async function eQ(){let e={printStatus:2,recordId:ex.values.recordId};await X({extension:N.$.MaterialsTransfer.print,record:JSON.stringify(e)}),ep()}return(0,i.useEffect)(()=>{!async function(){let e=await eD();er(null==e?void 0:e.list),ey()}()},[]),(0,i.useEffect)(()=>{!async function(){if(Y){var e;let t=await e_(Y),l=await eE(Y),n=await eW(Y,!0),a=await Promise.all(n.list.map(async e=>{var t,l,n,a;return{...e,id:e.seqNo,totalCost:ek(e),serials:null==eo?void 0:null===(n=eo.current)||void 0===n?void 0:null===(l=n.list)||void 0===l?void 0:null===(t=l.filter(t=>t.seqNo==e.seqNo))||void 0===t?void 0:t.map((e,t)=>({...e,id:t})),unitCost:null!==(a=e.unitCost)&&void 0!==a?a:0}}));ex.setValues({...t.record,transfers:a,notificationGroupId:null==l?void 0:null===(e=l.record)||void 0===e?void 0:e.notificationGroupId})}}()},[]),(0,i.useEffect)(()=>{!async function(){if(ex.values.toSiteId){let e=await K({extension:N.$.Site.get,parameters:"_recordId=".concat(ex.values.toSiteId)});ex.setFieldValue("plId",e.record.plId)}}()},[Y,ei,ex.values.toSiteId]),(0,n.jsx)(o.Z,{resourceId:v.i.MaterialsTransfer,form:ex,maxAccess:eu,editMode:ew,previewReport:ew,previewBtnClicked:eQ,actions:eL,functionId:A.J.MaterialTransfer,disabledSubmit:eg||eA,children:(0,n.jsxs)(p.R,{children:[(0,n.jsxs)(y.Q,{children:[(0,n.jsxs)(a.ZP,{container:!0,spacing:2,children:[(0,n.jsxs)(a.ZP,{item:!0,xs:8,marginTop:1,children:[(0,n.jsxs)(a.ZP,{container:!0,spacing:2,children:[(0,n.jsx)(a.ZP,{item:!0,xs:6,children:(0,n.jsx)(x.Z,{endpointId:g.r.DocumentType.qry,parameters:"_dgId=".concat(A.J.MaterialTransfer,"&_startAt=0&_pageSize=1000"),filter:ew?void 0:e=>1===e.activeStatus,name:"dtId",label:ed.documentType,readOnly:eg||eA||ew,valueField:"recordId",displayField:"name",values:null==ex?void 0:ex.values,onChange:async(e,t)=>{eN(null==t?void 0:t.recordId),ex.setFieldValue("dtId",(null==t?void 0:t.recordId)||""),ev(t)},error:ex.touched.dtId&&!!ex.errors.dtId,maxAccess:eu})}),(0,n.jsx)(a.ZP,{item:!0,xs:6,children:(0,n.jsx)(h.Z,{name:"closedDate",label:ed.shippingDate,value:null==ex?void 0:null===(G=ex.values)||void 0===G?void 0:G.closedDate,onChange:ex.setFieldValue,onClear:()=>ex.setFieldValue("closedDate",""),readOnly:eg||eA,error:ex.touched.date&&!!ex.errors.closedDate,maxAccess:eu})})]}),(0,n.jsxs)(a.ZP,{container:!0,spacing:2,marginTop:.5,children:[(0,n.jsx)(a.ZP,{item:!0,xs:6,children:(0,n.jsx)(m.Z,{name:"reference",label:ed.reference,value:null==ex?void 0:null===(J=ex.values)||void 0===J?void 0:J.reference,readOnly:eg||eA||ew,maxAccess:!ew&&eu,onChange:ex.handleChange,onClear:()=>ex.setFieldValue("reference",""),error:ex.touched.reference&&!!ex.errors.reference})}),(0,n.jsx)(a.ZP,{item:!0,xs:6,children:(0,n.jsx)(h.Z,{name:"receivedDate",label:ed.receivedDate,value:null==ex?void 0:null===(L=ex.values)||void 0===L?void 0:L.receivedDate,onChange:null==ex?void 0:ex.setFieldValue,onClear:()=>ex.setFieldValue("receivedDate",""),readOnly:eg||eA,error:ex.touched.receivedDate&&!!ex.errors.receivedDate,maxAccess:eu})})]}),(0,n.jsxs)(a.ZP,{container:!0,spacing:2,marginTop:.5,children:[(0,n.jsx)(a.ZP,{item:!0,xs:6,children:(0,n.jsx)(h.Z,{name:"date",label:ed.date,value:null==ex?void 0:null===(E=ex.values)||void 0===E?void 0:E.date,required:!0,onChange:ex.setFieldValue,onClear:()=>ex.setFieldValue("date",""),readOnly:eg||eA,error:ex.touched.date&&!!ex.errors.date,maxAccess:eu})}),(0,n.jsx)(a.ZP,{item:!0,xs:6,children:(0,n.jsx)(x.Z,{endpointId:N.$.Site.qry,name:"fromSiteId",readOnly:eg||eA||(null==ex?void 0:null===(B=ex.values)||void 0===B?void 0:null===(W=B.transfers)||void 0===W?void 0:W.some(e=>e.sku)),label:ed.fromSite,values:ex.values,displayField:["reference","name"],valueField:"recordId",columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],displayFieldWidth:1,required:!0,maxAccess:eu,onChange:(e,t)=>{ex.setFieldValue("fromSiteId",(null==t?void 0:t.recordId)||null)},error:ex.touched.fromSiteId&&!!ex.errors.fromSiteId})})]}),(0,n.jsxs)(a.ZP,{container:!0,spacing:2,marginTop:.5,children:[(0,n.jsx)(a.ZP,{item:!0,xs:6,children:(0,n.jsx)(x.Z,{endpointId:S.p.LoCarrier.qry,name:"carrierId",label:ed.carrier,values:null==ex?void 0:ex.values,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],readOnly:eg||eA,maxAccess:eu,onChange:(e,t)=>{ex.setFieldValue("carrierId",t?t.recordId:"")},error:ex.touched.carrierId&&!!ex.errors.carrierId})}),(0,n.jsx)(a.ZP,{item:!0,xs:6,children:(0,n.jsx)(x.Z,{endpointId:N.$.Site.qry,name:"toSiteId",readOnly:eg||eA,label:ed.toSite,values:null==ex?void 0:ex.values,displayField:["reference","name"],valueField:"recordId",columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],displayFieldWidth:1,required:!0,maxAccess:eu,onChange:(e,t)=>{ex.setFieldValue("toSiteId",(null==t?void 0:t.recordId)||null),ex.setFieldValue("plId",(null==t?void 0:t.plId)||null),(null==t?void 0:t.plId)&&ex.setFieldValue("details",!0)},error:ex.touched.toSiteId&&!!ex.errors.toSiteId})})]})]}),(0,n.jsxs)(a.ZP,{container:!0,xs:4,spacing:2,style:{marginTop:0},children:[(0,n.jsx)(a.ZP,{item:!0,xs:12,marginLeft:2,children:(0,n.jsx)(w.Z,{name:"notes",label:ed.notes,value:null==ex?void 0:null===(Q=ex.values)||void 0===Q?void 0:Q.notes,readOnly:eg||eA,maxLength:"200",maxAccess:eu,onChange:ex.handleChange,onClear:()=>ex.setFieldValue("notes",""),error:ex.touched.notes&&!!ex.errors.notes})}),(0,n.jsx)(a.ZP,{item:!0,xs:12,marginLeft:2,children:(0,n.jsx)(x.Z,{endpointId:g.r.Plant.qry,name:"plantId",label:ed.plant,readOnly:eg||eA,valueField:"recordId",displayField:"name",columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:null==ex?void 0:ex.values,maxAccess:eu,onClear:()=>ex.setFieldValue("plantId",""),onChange:(e,t)=>{ex.setFieldValue("plantId",(null==t?void 0:t.recordId)||null)},error:ex.touched.plantId&&!!ex.errors.plantId})})]})]}),(0,n.jsx)(s._,{onChange:e=>{let t=null==e?void 0:e.map(e=>({...e,qtyInBase:0}));null==ex||ex.setFieldValue("transfers",t)},onSelectionChange:(e,t,l)=>{"muRef"==l&&eq(null==e?void 0:e.itemId)},name:"transfers",maxAccess:eu,value:null==ex?void 0:null===(U=ex.values)||void 0===U?void 0:U.transfers,error:null==ex?void 0:null===(H=ex.errors)||void 0===H?void 0:H.transfers,columns:eP,allowDelete:!eA})]}),(0,n.jsx)(Z.g,{children:(0,n.jsxs)(a.ZP,{container:!0,direction:"row",wrap:"nowrap",sx:{justifyContent:"space-between"},children:[(0,n.jsxs)(a.ZP,{container:!0,xs:3,direction:"column",wrap:"nowrap",sx:{pt:5,justifyContent:"flex-start"},children:[(0,n.jsx)(a.ZP,{item:!0,xs:3,children:(0,n.jsx)(m.Z,{name:"totalQty",maxAccess:eu,value:(0,F.bj)(Number(eS).toFixed(2)),label:ed.totalQty,readOnly:!0})}),(0,n.jsx)(a.ZP,{item:!0,xs:3,sx:{mt:2},children:(0,n.jsx)(m.Z,{name:"totalCost",maxAccess:eu,value:(0,F.bj)(Number(eZ).toFixed(2)),label:ed.totalCost,readOnly:!0})}),(0,n.jsx)(a.ZP,{item:!0,xs:3,sx:{mt:2},children:(0,n.jsx)(m.Z,{name:"totalWeight",maxAccess:eu,value:(0,F.bj)(Number(eF).toFixed(2)),label:ed.totalWeight,readOnly:!0})})]}),(0,n.jsx)(a.ZP,{item:!0,xs:6,sx:{pl:3,mt:4},children:(0,n.jsx)(x.Z,{endpointId:O.y.NotificationGroup.qry,name:"notificationGroupId",readOnly:eg||eA,label:ed.notify,values:null==ex?void 0:ex.values,displayField:"name",maxAccess:eu,onChange:(e,t)=>{ex.setFieldValue("notificationGroupId",null==t?void 0:t.recordId)},error:ex.touched.notificationGroupId&&!!ex.errors.notificationGroupId})})]})})]})})}V.width=1e3,V.height=680},93878:function(e,t,l){"use strict";l.d(t,{Z:function(){return I}});var n=l(52322),a=l(60218),i=l(2784),r=l(65950),o=l(5088),d=l(80983),s=l(31389),c=l(62362),u=l(65215),v=l(26612),m=l(50023),f=l(21326);function I(e){var t,l,I,p,y,h,x;let{plId:g,itemId:A,window:w}=e,{getRequest:b}=(0,i.useContext)(r.$),{labels:C,access:k}=(0,m.Z)({datasetId:v.i.ItemDetails});(0,f.Z)({title:C.itemQuickView,window:w});let{formik:j}=(0,d.c)({maxAccess:k,initialValues:{recordId:A,sku:"",name:"",weight:null,volume:null,qtyOnHand:null,currentCost:null,defaultSalePrice:null}});return(0,i.useEffect)(()=>{!async function(){var e,t;if(!A)return;let l=await b({extension:u.$.Item.quickView,parameters:"_itemId=".concat(A,"&_plId=").concat(g||0)});j.setValues({...l.record,currentCost:(null==l?void 0:null===(e=l.record)||void 0===e?void 0:e.hideCost)?"**":null==l?void 0:null===(t=l.record)||void 0===t?void 0:t.currentCost})}()},[]),(0,n.jsx)(s.R,{children:(0,n.jsx)(c.Q,{children:(0,n.jsxs)(a.ZP,{container:!0,spacing:3,p:2,children:[(0,n.jsx)(a.ZP,{item:!0,xs:12,children:(0,n.jsx)(o.Z,{name:"sku",value:null==j?void 0:null===(t=j.values)||void 0===t?void 0:t.sku,label:C.sku,readOnly:!0,maxAccess:k})}),(0,n.jsx)(a.ZP,{item:!0,xs:12,children:(0,n.jsx)(o.Z,{name:"name",value:null==j?void 0:null===(l=j.values)||void 0===l?void 0:l.name,label:C.name,readOnly:!0,maxAccess:k})}),(0,n.jsx)(a.ZP,{item:!0,xs:12,children:(0,n.jsx)(o.Z,{name:"weight",value:null==j?void 0:null===(I=j.values)||void 0===I?void 0:I.weight,label:C.weight,readOnly:!0,maxAccess:k})}),(0,n.jsx)(a.ZP,{item:!0,xs:12,children:(0,n.jsx)(o.Z,{name:"volume",value:null==j?void 0:null===(p=j.values)||void 0===p?void 0:p.volume,label:C.volume,readOnly:!0,maxAccess:k})}),(0,n.jsx)(a.ZP,{item:!0,xs:12,children:(0,n.jsx)(o.Z,{name:"qtyOnHand",value:null==j?void 0:null===(y=j.values)||void 0===y?void 0:y.qtyOnHand,label:C.qtyOnHand,readOnly:!0,maxAccess:k})}),(0,n.jsx)(a.ZP,{item:!0,xs:12,children:(0,n.jsx)(o.Z,{name:"currentCost",value:null==j?void 0:null===(h=j.values)||void 0===h?void 0:h.currentCost,label:C.currentCost,readOnly:!0,maxAccess:k})}),(0,n.jsx)(a.ZP,{item:!0,xs:12,children:(0,n.jsx)(o.Z,{name:"defaultSalePrice",value:null==j?void 0:null===(x=j.values)||void 0===x?void 0:x.defaultSalePrice,label:C.defaultSalePrice,readOnly:!0,maxAccess:k})})]})})})}I.width=700,I.height=500},85572:function(e,t,l){"use strict";l.d(t,{u:function(){return C}});var n=l(52322),a=l(31389),i=l(62362),r=l(26612),o=l(60218),d=l(8661),s=l(80983),c=l(48601),u=l(71987),v=l(2784),m=l(65950),f=l(91406),I=l(27423),p=l(65215),y=l(76399),h=l(33625),x=l(96026),g=l(19473),A=l(51235),w=l(21326),b=l(54074);let C=e=>{var t,l,C,k,j,N;let{row:S,siteId:Z,checkForSiteId:F,window:D,updateRow:O,disabled:q}=e,{getRequest:T}=(0,v.useContext)(m.$),{stack:P}=(0,x.V)(),{platformLabels:_,systemChecks:V}=(0,v.useContext)(g.l),R=V.some(e=>e.checkId===A.F.ALLOW_INVENTORY_NEGATIVE_QTY),M=(null==V?void 0:null===(t=V.find(e=>e.checkId===A.F.POS_JUMP_TO_NEXT_LINE))||void 0===t?void 0:t.value)||!1,{labels:$,maxAccess:G}=(0,u.J)({datasetId:r.i.Serial});(0,w.Z)({title:_.serials,window:D});let{formik:J}=(0,s.c)({maxAccess:G,initialValues:{sku:null==S?void 0:S.sku,itemName:null==S?void 0:S.itemName,itemId:null==S?void 0:S.itemId,siteId:Z,totalWeight:(null==S?void 0:S.qty)||0,pieces:null,items:(null==S?void 0:S.serials)||[]},validateOnChange:!0,validationSchema:c.Ry({items:c.IX().of(c.Ry({srlNo:c.Z_().test(function(e){var t,l,n;return(null===(n=this.options.from[1])||void 0===n?void 0:null===(l=n.value)||void 0===l?void 0:null===(t=l.items)||void 0===t?void 0:t.length)===1||!!e})}))}),onSubmit:async e=>{let t=e.items.filter(e=>null==e?void 0:e.srlNo).map((e,t)=>({...e,id:t+1,srlSeqNo:t+1,srlNo:e.srlNo,seqNo:S.id}));O({changes:{serials:t,...(null==S?void 0:S.hasOwnProperty("serialCount"))&&{serialCount:(null==t?void 0:t.length)||0}}}),D.close()}}),L=J.values.items.reduce((e,t)=>e+(parseFloat(t.weight)||0),0),E=J.values.totalWeight-L||0,W=[{component:"textfield",name:"srlNo",label:$.serialNo,jumpToNextLine:M,updateOn:"blur",onChange:async e=>{let{row:{update:t,newRow:l,oldRow:n,addRow:a}}=e;l.srlNo!==(null==n?void 0:n.srlNo)&&await U(l,t,a)}},{component:"numberfield",name:"weight",label:$.weight,props:{readOnly:!0}}],B=e=>{let t=J.values.items.map(t=>t.id===e?{...t,srlNo:"",weight:""}:t);J.setFieldValue("items",t)},Q=e=>{let t=J.values.items.filter(t=>t.id!==e);0===t.length&&(t=[{id:0,srlNo:"",weight:""}]),J.setFieldValue("items",t)},U=async(e,t,l)=>{let{srlNo:n,id:a}=e;if(n){var i;let r=await T({extension:p.$.Serial.get,parameters:"_srlNo=".concat(n)});r.record?(null==r?void 0:null===(i=r.record)||void 0===i?void 0:i.itemId)!==(null==S?void 0:S.itemId)?(P({message:_.serialDoesNotBelongItem}),B(a)):F&&!R&&J.values.siteId?(await T({extension:p.$.AvailabilitySerial.get,parameters:"_srlNo=".concat(n,"&_siteId=").concat(J.values.siteId)})).record?(t({weight:r.record.weight}),l({fieldName:"srlNo",changes:{id:e.id,srlNo:e.srlNo,weight:r.record.weight}})):(P({message:$.invalidSerial}),B(a)):(t({weight:r.record.weight}),l({fieldName:"srlNo",changes:{id:e.id,srlNo:e.srlNo,weight:r.record.weight}})):(P({message:_.unknownSerial}),Q(a))}},H=[{key:"Ok",condition:!0,onClick:()=>J.handleSubmit(),disabled:q}];return(0,n.jsx)(b.Z,{onSave:J.handleSubmit,isSaved:!1,actions:H,maxAccess:G,children:(0,n.jsxs)(a.R,{children:[(0,n.jsx)(h.g,{children:(0,n.jsxs)(o.ZP,{container:!0,spacing:2,children:[(0,n.jsx)(o.ZP,{item:!0,xs:12,children:(0,n.jsx)(I.U,{endpointId:p.$.Item.snapshot,name:"itemId",label:null==$?void 0:$.sku,valueField:"recordId",displayField:"sku",valueShow:"sku",secondValueShow:"itemName",form:J,readOnly:!0})}),(0,n.jsx)(o.ZP,{item:!0,xs:12,children:(0,n.jsx)(d.Z,{endpointId:p.$.Site.qry,name:"siteId",label:$.site,values:J.values,valueField:"recordId",displayField:["reference","name"],maxAccess:G,readOnly:!0})}),(0,n.jsx)(o.ZP,{item:!0,xs:12,children:(0,n.jsx)(f.Z,{name:"totalWeight",label:$.totalWeight,maxAccess:G,value:J.values.totalWeight,readOnly:!0})}),(0,n.jsx)(o.ZP,{item:!0,xs:12,children:(0,n.jsx)(f.Z,{name:"weightAssigned",label:$.weightAssigned,maxAccess:G,value:L,readOnly:!0})}),(0,n.jsx)(o.ZP,{item:!0,xs:12,children:(0,n.jsx)(f.Z,{name:"balanceWeight",label:$.balanceWeight,maxAccess:G,value:E,readOnly:!0})}),(0,n.jsx)(o.ZP,{item:!0,xs:12,children:(0,n.jsx)(f.Z,{name:"pieces",label:$.pieces,maxAccess:G,value:null==J?void 0:null===(k=J.values)||void 0===k?void 0:null===(C=k.items)||void 0===C?void 0:null===(l=C.filter(e=>void 0!==e.srlNo))||void 0===l?void 0:l.length,readOnly:!0})})]})}),(0,n.jsx)(i.Q,{children:(0,n.jsx)(y._,{onChange:e=>J.setFieldValue("items",e),value:null===(j=J.values)||void 0===j?void 0:j.items,error:null===(N=J.errors)||void 0===N?void 0:N.items,name:"items",columns:W,maxAccess:G,disabled:q,allowDelete:!q,allowAddNewLine:!q})})]})})};C.width=500,C.height=700},39704:function(e,t,l){"use strict";var n=l(52322),a=l(2784),i=l(22341),r=l(65950),o=l(85325),d=l(21326),s=l(19473),c=l(35656),u=l(24868),v=l.n(u);let m=e=>{let{functionId:t,recordId:l,window:u}=e,{getRequest:m}=(0,a.useContext)(r.$),{languageId:f}=(0,a.useContext)(o.V),{platformLabels:I}=(0,a.useContext)(s.l),p=l+"-"+t;(0,d.Z)({title:I.WorkFlow,window:u});let{width:y}=(0,c.d)(),h=y<=1024,x=y>1024&&y<=1280,g=h?10:x?12:14,A=h?75:x?85:95,w=h?15:x?20:25,b=async()=>{var e="_functionId=".concat(t,"&_recordId=").concat(l);let n=await m({extension:i.P.WorkFlow.graph,parameters:e});return null==n?void 0:n.record},C=e=>{let t=[],l=[],n="",a="";return e.objects.forEach(e=>{t.push({functionName:e.functionName,reference:e.reference,date:e.date})}),e.workflow.forEach(t=>{e.objects.forEach(e=>{let l=e.functionName.split(" ").join("\r\n");t.parentId===e.recordId&&t.parentFunctionId===e.functionId&&(n=e.reference+"\r\n"+e.date+"\r\n"+l,t.parentId),t.childId===e.recordId&&t.childFunctionId===e.functionId&&(a=e.reference+"\r\n"+e.date+"\r\n"+l,t.childId)}),""===n||""===a||l.push({from:n,to:a,value:1,labelText:""}),n="",a=""}),l};return(0,a.useEffect)(()=>{!async function(){var e=await b();if(e){let t=(e,t)=>{let l=document.createElement("script");l.type="text/javascript",l.src=e,l.async=!0,l.onload=t,document.head.appendChild(l)};t("https://cdn.amcharts.com/lib/4/core.js",()=>{t("https://cdn.amcharts.com/lib/4/charts.js",()=>{t("https://cdn.amcharts.com/lib/4/themes/animated.js",()=>{am4core.ready(()=>{let t=am4core.create(p,am4charts.SankeyDiagram),l=C(e);t.data=l,t.dataFields.fromName="from",t.dataFields.toName="to",t.dataFields.value="value",t.paddingRight=2===f?0:40,t.paddingLeft=2===f?40:0,t.tooltip.label.fontSize=g;let n=t.nodes.template;n.draggable=!1,n.inert=!0,n.clickable=!1,n.width=A,n.height=w,n.nameLabel.label.fontSize=g,n.nameLabel.locationX=2===f?.85:0,n.nameLabel.height=void 0,n.nameLabel.label.fontWeight="bold";let a=t.links.template;a.middleLine.strokeOpacity=.3,a.middleLine.stroke=am4core.color("#555"),a.middleLine.strokeWidth=5,a.middleLine.hoverable=!1,a.fillOpacity=0,a.hoverable=!0,a.hoverOnFocus=!0,a.fill=am4core.color("#A8C686"),a.isHover=!0,t.appear(1e3,100)})})})})}}()},[]),(0,n.jsx)("div",{id:p,className:v().root})};m.width=950,t.Z=m},24868:function(e){e.exports={root:"WorkFlow_root__EINm1"}}}]);