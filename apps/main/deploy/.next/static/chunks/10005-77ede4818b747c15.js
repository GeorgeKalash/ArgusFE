(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[10005],{10005:function(e,d,l){"use strict";l.d(d,{Z:function(){return R}});var n=l(52322),r=l(60218),a=l(2784),t=l(48601),s=l(82737),i=l(62202),o=l(76399),c=l(65950),u=l(71987),v=l(26612),m=l(96026),I=l(5088),y=l(80983),p=l(19473),f=l(31389),h=l(62362),x=l(89330),g=l(8661),w=l(38449),b=l(7121),F=l(21581),j=l(98345),k=l(39812),Z=l(30043),N=l(22341),C=l(33625),O=l(61802),S=l(65215),P=l(27423),A=l(39704),_=l(75163),D=l(54074);function q(e){var d,l,s,o,v,h,k,O,S;let{labels:A,maxAccess:_,recordId:q,form:V,refetchForm:R,window:E}=e,{getRequest:T,postRequest:U}=(0,a.useContext)(c.$),{platformLabels:L,defaultsData:z}=(0,a.useContext)(p.l),{stack:J}=(0,m.V)(),{documentType:Q,maxAccess:W,changeDT:$}=(0,j.H)({functionId:b.J.SalesInvoice,access:_,enabled:!q}),M=(0,u.E)({endpointId:Z.U.DeliveriesOrders.qry}),H=()=>{var e;let d={},l=null==z?void 0:null===(e=z.list)||void 0===e?void 0:e.filter(e=>"currencyId"===e.key||"PUCurrencyId"===e.key);null==l||l.forEach(e=>d[e.key]=e.value?parseInt(e.value):null),-1!==d.currencyId&&-1!==d.PUCurrencyId?B.setFieldValue("currencyId",d.currencyId):J({message:A.puSettingError})};(0,a.useEffect)(()=>{H()},[]);let{formik:B}=(0,y.c)({documentType:{key:"dtId",value:null==Q?void 0:Q.dtId},initialValues:{reference:null==V?void 0:null===(d=V.values)||void 0===d?void 0:d.reference,plantId:null==V?void 0:null===(l=V.values)||void 0===l?void 0:l.plantId,clientId:null==V?void 0:null===(s=V.values)||void 0===s?void 0:s.clientId,applyVAT:!1,spId:null==V?void 0:null===(o=V.values)||void 0===o?void 0:o.spId,clientRef:null==V?void 0:null===(v=V.values)||void 0===v?void 0:v.clientRef,clientName:null==V?void 0:null===(h=V.values)||void 0===h?void 0:h.clientName,date:new Date,dtId:null,currency:null,dtName:"",ptId:null,plantName:null==V?void 0:null===(k=V.values)||void 0===k?void 0:k.plantName,description:"",deliveryOrderId:null==V?void 0:null===(O=V.values)||void 0===O?void 0:O.recordId},maxAccess:W,validateOnChange:!0,validationSchema:t.Ry({plantId:t.Rx().required()}),onSubmit:async e=>{let d=await U({extension:Z.U.Invoice.generate,record:JSON.stringify(e)});await R(q),M(),E.close(),d.recordId?i.ZP.success(L.Edited):i.ZP.success(L.Added)}});return(0,a.useEffect)(()=>{!async function(){var e,d,l;if(null==B?void 0:null===(e=B.values)||void 0===e?void 0:e.currencyId){let e=await T({extension:w.r.Currency.get,parameters:"_recordId=".concat(null==B?void 0:null===(d=B.values)||void 0===d?void 0:d.currencyId,"&_doId=").concat(null==B?void 0:null===(l=B.values)||void 0===l?void 0:l.deliveryOrderId)});B.setFieldValue("currencyName",e.record.name)}}()},[]),(0,n.jsx)(D.Z,{onSave:B.handleSubmit,maxAccess:W,actions:[{key:"Generate Invoice",condition:!0,onClick:()=>B.handleSubmit()}],isSaved:!1,children:(0,n.jsx)(f.R,{children:(0,n.jsx)(C.g,{children:(0,n.jsxs)(r.ZP,{container:!0,spacing:2,children:[(0,n.jsx)(r.ZP,{item:!0,xs:12,children:(0,n.jsx)(g.Z,{endpointId:w.r.DocumentType.qry,parameters:"_dgId=".concat(b.J.SalesInvoice,"&_startAt=",0,"&_pageSize=",1e3),name:"dtId",label:A.docType,valueField:"recordId",displayField:"name",values:B.values,onChange:(e,d)=>{B.setFieldValue("dtId",(null==d?void 0:d.recordId)||""),$(d)},error:B.touched.dtId&&!!B.errors.dtId,maxAccess:W})}),(0,n.jsx)(r.ZP,{item:!0,xs:12,children:(0,n.jsx)(x.Z,{name:"date",label:A.date,value:null===(S=B.values)||void 0===S?void 0:S.date,readOnly:!0})}),(0,n.jsx)(r.ZP,{item:!0,xs:12,children:(0,n.jsx)(g.Z,{endpointId:w.r.Plant.qry,name:"plantId",label:A.plant,valueField:"recordId",displayField:["reference","name"],values:B.values,readOnly:!0})}),(0,n.jsx)(r.ZP,{item:!0,xs:12,children:(0,n.jsx)(P.U,{endpointId:N.P.Client.snapshot,valueField:"reference",displayField:"name",secondFieldLabel:A.client,name:"clientId",label:A.client,form:B,required:!0,readOnly:!0,valueShow:"clientRef",secondValueShow:"clientName"})}),(0,n.jsx)(r.ZP,{item:!0,xs:12,children:(0,n.jsx)(I.Z,{name:"currencyName",label:A.currency,value:B.values.currencyName,readOnly:!0})}),(0,n.jsx)(r.ZP,{item:!0,xs:12,children:(0,n.jsx)(I.Z,{name:"reference",label:A.deliveryOrderReference,value:B.values.reference,readOnly:!0})}),(0,n.jsx)(r.ZP,{item:!0,xs:12,children:(0,n.jsx)(F.Z,{name:"description",label:A.description,value:B.values.description,maxAccess:W,onChange:e=>B.setFieldValue("description",e.target.value),onClear:()=>B.setFieldValue("description",""),error:B.touched.description&&!!B.errors.description})})]})})})})}var V=l(19689);function R(e){var d,l,D,R,E,T,U,L,z,J,Q;let{labels:W,maxAccess:$,recordId:M,refresh:H=!0,...B}=e,{getRequest:G,postRequest:K}=(0,a.useContext)(c.$),{platformLabels:X,userDefaultsData:Y}=(0,a.useContext)(p.l),{stack:ee}=(0,O.zY)(),{stack:ed}=(0,m.V)(),{documentType:el,maxAccess:en,changeDT:er}=(0,j.H)({functionId:b.J.DeliveryOrder,access:$,enabled:!M}),ea=parseInt(null==Y?void 0:null===(l=Y.list)||void 0===l?void 0:null===(d=l.find(e=>"plantId"===e.key))||void 0===d?void 0:d.value),et=parseInt(null==Y?void 0:null===(R=Y.list)||void 0===R?void 0:null===(D=R.find(e=>"siteId"===e.key))||void 0===D?void 0:D.value),es=(0,u.E)(H&&{endpointId:Z.U.DeliveriesOrders.qry}),ei=[{id:1,doId:null,doSeqNo:null,seqNo:1,soSeqNo:null,soRef:null,itemId:null,soId:null,soDate:null,sku:null,itemName:null,qty:null,pendingQty:null,placeHolder:null,siteId:null,siteName:"",isEditMode:!1,deliveredNowQty:null,deliveredQty:null,mwFunctionId:null,muId:null,muRef:"",muName:"",mwId:null,mwRef:"",mwSeqNo:null}],{formik:eo}=(0,y.c)({documentType:{key:"dtId",value:null==el?void 0:el.dtId},initialValues:{recordId:null,reference:"",plantId:ea,saleOrderId:null,clientRef:"",clientName:"",clientId:null,vehicleId:null,driverId:null,date:new Date,notes:"",dtId:null,status:1,statusName:"",printStatusName:"",printStatus:null,invoiceStatus:null,dtName:"",plantName:"",vehicleName:"",driverName:"",exWorks:!1,addressId:null,szName:"",szId:null,spName:"",spId:null,volume:null,qty:null,siteId:et,address:"",orders:ei},maxAccess:en,validateOnChange:!0,validationSchema:t.Ry({plantId:t.Rx().required(),siteId:t.Z_().required(),orders:t.IX().of(t.Ry({mwRef:t.Z_().required(),siteName:t.Z_().required()}))}),onSubmit:async e=>{let d={...e};delete d.orders,d.date=(0,k.ku)(d.date);let l=eo.values.orders.map((e,d)=>({...e,doId:M||0,doSeqNo:d+1,id:d+1,reference:e.mwRef})),n=await K({extension:Z.U.DeliveriesOrders.set2,record:JSON.stringify({header:d,items:l})});eo.setFieldValue("recordId",n.recordId),await eI(n.recordId),eo.values.recordId?i.ZP.success(X.Edited):i.ZP.success(X.Added),es()}}),ec=eo.values.orders.reduce((e,d)=>e+(parseFloat(d.qty)||0),0),eu=3===eo.values.status,ev=-1==eo.values.status,em=!!eo.values.recordId;async function eI(e){let d=await ey(e);d.record.date=(0,k.a1)(d.record.date);let l=await ef(null==d?void 0:d.record);await eh(d,l)}async function ey(e){return await G({extension:Z.U.DeliveriesOrders.get,parameters:"_doId=".concat(e,"&_recordId=").concat(e)})}async function ep(e){var d;if(!e)return null;let l=await G({extension:w.r.Address.format,parameters:"_addressId=".concat(e)});return null==l?void 0:null===(d=l.record)||void 0===d?void 0:d.formattedAddress.replace(/(\r\n|\r|\n)+/g,"\r\n")}let ef=async e=>await G({extension:Z.U.OrderItem.qry,parameters:"_tripId=".concat(e.recordId,"&_doId=").concat(e.recordId)});async function eh(e,d){var l;let n=await ep(null==e?void 0:null===(l=e.record)||void 0===l?void 0:l.addressId),r=ei;d.list!=[]&&(r=await Promise.all(d.list.map((e,d)=>({...e,id:d+1,soDate:(0,k.a1)(e.soDate)})))),eo.setValues({...null==e?void 0:e.record,plantId:B.plantId||(null==e?void 0:e.record.plantId),dtId:B.dtId||(null==e?void 0:e.record.dtId),address:n,orders:r})}let ex=async()=>{await K({extension:Z.U.DeliveriesOrders.post,record:JSON.stringify(eo.values)}),i.ZP.success(X.Posted),es(),await eI(eo.values.recordId)},eg=async()=>{await K({extension:Z.U.DeliveriesOrders.unpost,record:JSON.stringify(eo.values)}),i.ZP.success(X.Unposted),es(),await eI(eo.values.recordId)},ew=async()=>{await K({extension:Z.U.DeliveriesOrders.cancel,record:JSON.stringify(eo.values)}),M&&i.ZP.success(X.Cancelled),es(),await eI(eo.values.recordId)};(0,a.useEffect)(()=>{!async function(){M&&await eI(M)}()},[]);let eb=[{key:"Locked",condition:eu,onClick:"onUnpostConfirmation",onSuccess:eg,disabled:!em||ev},{key:"Unlocked",condition:!eu,onClick:ex,disabled:!em||ev},{key:"Cancel",condition:!0,onClick:ew,disabled:!em||!eu||ev},{key:"WorkFlow",condition:!0,onClick:async()=>{ee({Component:A.Z,props:{functionId:b.J.DeliveryOrder,recordId:eo.values.recordId}})},disabled:!em},{key:"generateIV",condition:!0,onClick:async function(){var e;let d=await G({extension:N.P.Client.get,parameters:"_recordId=".concat(eo.values.clientId,"&_doId=").concat(eo.values.recordId)});(null==d?void 0:null===(e=d.record)||void 0===e?void 0:e.ptId)===null?ed({message:X.paymentTermError}):ee({Component:q,props:{form:eo,labels:W,maxAccess:en,recordId:M,refetchForm:eI},width:500,height:550,title:X.GenerateInvoice})},disabled:!eu&&!ev||!!eo.values.invoiceId}],eF=[{component:"resourcecombobox",label:W.reference,name:"mwRef",props:{endpointId:(null==eo?void 0:null===(E=eo.values)||void 0===E?void 0:E.clientId)&&Z.U.MW.qry,parameters:(null==eo?void 0:null===(T=eo.values)||void 0===T?void 0:T.clientId)&&"_clientId=".concat(null==eo?void 0:null===(U=eo.values)||void 0===U?void 0:U.clientId),displayField:"reference",valueField:"itemName",readOnly:eu||ev,mapping:[{from:"reference",to:"reference"},{from:"itemName",to:"itemName"},{from:"seqNo",to:"mwSeqNo"},{from:"qty",to:"qty"},{from:"muName",to:"muName"},{from:"muRef",to:"muRef"},{from:"muId",to:"muId"},{from:"functionId",to:"mwFunctionId"},{from:"reference",to:"mwRef"},{from:"itemId",to:"itemId"},{from:"recordId",to:"mwId"},{from:"dropDownQty",to:"deliveredNowQty"},{from:"dropDownQty",to:"pendingQty"},{from:"sku",to:"sku"},{from:"doId",to:"doId"}],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"itemName",value:"Name"},{key:"sku",value:"SKU"},{key:"qty",value:"Qty"}],displayFieldWidth:3},propsReducer(e){let{row:d,props:l}=e;return{...l,readOnly:!!d.mwId}}},{component:"textfield",label:W.sku,name:"sku",props:{readOnly:!0}},{component:"textfield",label:W.itemName,name:"itemName",props:{readOnly:!0}},{component:"numberfield",label:W.qty,name:"qty",props:{readOnly:eu||ev,allowNegative:!1},async onChange(e){let{row:{update:d,oldRow:l,newRow:n}}=e;n.qty&&n.qty>l.qty&&d({qty:l.qty})}},{component:"textfield",label:W.mu,name:"muName",props:{readOnly:!0}},{component:"resourcecombobox",label:W.site,name:"siteName",props:{endpointId:S.$.Site.qry,displayField:"name",valueField:"recordId",readOnly:eu||ev,mapping:[{from:"recordId",to:"siteId"},{from:"name",to:"siteName"}]}}];async function ej(){let e={printStatus:2,recordId:eo.values.recordId};await K({extension:Z.U.DeliveriesOrders.flag,record:JSON.stringify(e)}),es()}function ek(e){Object.entries(e).forEach(e=>{let[d,l]=e;eo.setFieldValue(d,l)})}return(0,n.jsx)(s.Z,{resourceId:v.i.DeliveriesOrders,form:eo,maxAccess:en,editMode:em,actions:eb,previewBtnClicked:ej,functionId:b.J.DeliveryTrip,disabledSubmit:eu||ev,previewReport:em,children:(0,n.jsxs)(f.R,{children:[(0,n.jsx)(C.g,{children:(0,n.jsxs)(r.ZP,{container:!0,spacing:2,children:[(0,n.jsx)(r.ZP,{item:!0,xs:8,children:(0,n.jsxs)(r.ZP,{container:!0,spacing:2,children:[(0,n.jsx)(r.ZP,{item:!0,xs:4,children:(0,n.jsx)(g.Z,{endpointId:w.r.DocumentType.qry,parameters:"_dgId=".concat(b.J.DeliveryOrder,"&_startAt=",0,"&_pageSize=",1e3),filter:em?void 0:e=>1===e.activeStatus,name:"dtId",label:W.docType,readOnly:em||ev,valueField:"recordId",displayField:"name",values:eo.values,onChange:(e,d)=>{eo.setFieldValue("dtId",(null==d?void 0:d.recordId)||""),er(d)},error:eo.touched.dtId&&!!eo.errors.dtId,maxAccess:en})}),(0,n.jsx)(r.ZP,{item:!0,xs:4,children:(0,n.jsx)(g.Z,{endpointId:w.r.Plant.qry,name:"plantId",label:W.plant,valueField:"recordId",readOnly:eu||ev,displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:eo.values,onChange:(e,d)=>{eo.setFieldValue("plantId",d?null==d?void 0:d.recordId:"")},error:eo.touched.plantId&&!!eo.errors.plantId,required:!0,maxAccess:en})}),(0,n.jsx)(r.ZP,{item:!0,xs:4,children:(0,n.jsx)(x.Z,{name:"date",label:W.date,value:null===(L=eo.values)||void 0===L?void 0:L.date,onChange:eo.setFieldValue,onClear:()=>eo.setFieldValue("date",""),readOnly:eu||ev,error:eo.touched.date&&!!eo.errors.date,maxAccess:en})}),(0,n.jsx)(r.ZP,{item:!0,xs:4,children:(0,n.jsx)(I.Z,{name:"reference",label:W.reference,value:eo.values.reference,readOnly:em||ev,maxAccess:en,onChange:eo.handleChange,onClear:()=>eo.setFieldValue("reference",""),error:eo.touched.reference&&!!eo.errors.reference})}),(0,n.jsx)(r.ZP,{item:!0,xs:4,children:(0,n.jsx)(g.Z,{endpointId:S.$.Site.qry,name:"siteId",label:W.site,required:!0,values:eo.values,displayField:"name",maxAccess:en,readOnly:eu||ev,onChange:(e,d)=>{eo.setFieldValue("siteId",(null==d?void 0:d.recordId)||"")},error:eo.touched.siteId&&!!eo.errors.siteId})}),(0,n.jsx)(r.ZP,{item:!0,xs:4,children:(0,n.jsx)(g.Z,{endpointId:Z.U.Driver.qry,name:"driverId",label:W.driver,valueField:"recordId",readOnly:eu||ev,displayField:"name",values:eo.values,onChange:(e,d)=>{eo.setFieldValue("driverId",d?null==d?void 0:d.recordId:"")},maxAccess:en,error:eo.touched.driverId&&!!eo.errors.driverId})}),(0,n.jsx)(r.ZP,{item:!0,xs:8,children:(0,n.jsx)(P.U,{endpointId:N.P.Client.snapshot,valueField:"reference",displayField:"name",secondFieldLabel:W.client,name:"clientId",label:W.client,form:eo,required:!0,readOnly:ev||em,displayFieldWidth:2,valueShow:"clientRef",secondValueShow:"clientName",maxAccess:en,editMode:em,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"},{key:"szName",value:"Sales Zone"}],onChange:async(e,d)=>{eo.setFieldValue("clientId",null==d?void 0:d.recordId),eo.setFieldValue("clientName",null==d?void 0:d.name),eo.setFieldValue("clientRef",null==d?void 0:d.reference),(null==d?void 0:d.recordId)||(eo.setFieldValue("orders",ei),eo.setFieldValue("addressId",null),eo.setFieldValue("address",""))},errorCheck:"clientId"})}),(0,n.jsx)(r.ZP,{item:!0,xs:4,children:(0,n.jsx)(g.Z,{endpointId:Z.U.Vehicle.qry,name:"vehicleId",label:W.vehicle,valueField:"recordId",readOnly:eu||ev,displayField:"name",maxAccess:en,values:eo.values,onChange:(e,d)=>{eo.setFieldValue("vehicleId",d?null==d?void 0:d.recordId:"")},error:eo.touched.vehicleId&&!!eo.errors.vehicleId})}),(0,n.jsx)(r.ZP,{item:!0,xs:8,children:(0,n.jsx)(V.Z,{name:"exWorks",value:null===(z=eo.values)||void 0===z?void 0:z.exWorks,onChange:e=>eo.setFieldValue("exWorks",e.target.checked),label:W.exWorks,maxAccess:en,readOnly:!0,disabled:!0})}),(0,n.jsx)(r.ZP,{item:!0,xs:4,children:(0,n.jsx)(g.Z,{endpointId:N.P.SalesZone.qry,parameters:'_startAt=0&_pageSize=1000&_sortField="recordId"&_filter=',name:"szId",label:W.saleZone,readOnly:eu||ev,valueField:"recordId",displayField:"name",values:eo.values,maxAccess:en,onChange:(e,d)=>{eo.setFieldValue("szId",d?d.recordId:null)},error:eo.touched.szId&&!!eo.errors.szId})})]})}),(0,n.jsx)(r.ZP,{item:!0,xs:4,children:(0,n.jsxs)(r.ZP,{container:!0,spacing:2,children:[(0,n.jsx)(r.ZP,{item:!0,xs:12,children:(0,n.jsx)(I.Z,{name:"salePerson",label:W.salePerson,value:eo.values.salePerson,onChange:eo.handleChange,readOnly:!0,maxAccess:en})}),(0,n.jsx)(r.ZP,{item:!0,xs:12,children:(0,n.jsx)(F.Z,{name:"address",label:W.address,value:eo.values.address,rows:3.5,maxLength:"100",readOnly:ev||eu,maxAccess:en,viewDropDown:eo.values.clientId&&!ev&&!eu,onChange:e=>eo.setFieldValue("address",e.target.value),onClear:()=>eo.setFieldValue("address",""),onDropDown:()=>{ee({Component:_.Z,props:{maxAccess:en,labels:W,deliveryOrder:!0,form:eo.values,handleAddressValues:ek,checkedAddressId:eo.values.addressId}})}})}),(0,n.jsx)(r.ZP,{item:!0,xs:12,children:(0,n.jsx)(F.Z,{name:"notes",label:W.notes,value:eo.values.notes,readOnly:eu||ev,maxAccess:en,onChange:e=>eo.setFieldValue("notes",e.target.value),onClear:()=>eo.setFieldValue("notes",""),error:eo.touched.notes&&!!eo.errors.notes})})]})})]})}),(0,n.jsx)(h.Q,{children:(0,n.jsx)(o._,{onChange:e=>{eo.setFieldValue("orders",e)},value:null==eo?void 0:null===(J=eo.values)||void 0===J?void 0:J.orders,error:null==eo?void 0:null===(Q=eo.errors)||void 0===Q?void 0:Q.orders,columns:eF,maxAccess:en,name:"orders",allowDelete:!eu&&!ev,allowAddNewLine:!eu&&!ev})}),(0,n.jsx)(C.g,{children:(0,n.jsx)(r.ZP,{container:!0,spacing:2,mt:.3,children:(0,n.jsx)(r.ZP,{item:!0,xs:3,children:(0,n.jsx)(I.Z,{name:"totalQty",label:W.totalQty,maxAccess:en,value:ec,maxLength:"30",readOnly:!0,error:eo.touched.totalQty&&!!eo.errors.totalQty,helperText:eo.touched.totalQty&&eo.errors.totalQty})})})})]})})}},1685:function(e,d,l){"use strict";l.d(d,{m:function(){return n}});let n=e=>{let d=window.sessionStorage.getItem(e);return d?JSON.parse(d):null}},98345:function(e,d,l){"use strict";l.d(d,{H:function(){return y},G:function(){return I}});var n=l(45300),r=l(2784),a=l(96026),t=l(38449);l(26612);var s=l(65947),i=l(1685);let o=async(e,d,l)=>{try{let n=await e({extension:d,parameters:l});return d.includes("qry")?n:n.record}catch(e){return null}},c=(e,d,l,n)=>{let r=(e=JSON.parse(JSON.stringify(e))).record.controls,a=r.find(e=>"reference"===e.controlId);return a?a.accessLevel=(null==d?void 0:d.mandatory)?s.$7:s.rr:(null==d?void 0:d.mandatory)?r.push({sgId:0,resourceId:"",controlId:"".concat(n?n+".":"","reference"),accessLevel:(null==d?void 0:d.mandatory)?s.$7:s.rr}):(null==d?void 0:d.readOnly)?r.push({sgId:0,resourceId:"",controlId:"".concat(n?n+".":"","reference"),accessLevel:(null==d?void 0:d.readOnly)?s.rr:s.$7}):r=e.record.controls.filter(e=>"reference"!=e.controlId),l&&r.push({sgId:0,resourceId:"",controlId:"".concat(n?n+".":"","dtId"),accessLevel:s.$7}),{...e,record:{...e.record,controls:r}}},u=async(e,d,l)=>{let n,r;switch(l){case"dtId":let a=(0,i.m)("userData"),s=null==a?void 0:a.userId;r="_userId=".concat(s,"&_functionId=").concat(d),n=t.r.UserFunction.get;break;case"glbSysNumberRange":r="_recordId=".concat(d),n=t.r.SystemFunction.get;break;case"DocumentType":r="_dgId=".concat(d,"&_startAt=",0,"&_pageSize=",50),n=t.r.DocumentType.qry;break;case"DcTypNumberRange":r="_recordId=".concat(d),n=t.r.DocumentType.get;break;case"isExternal":r="_recordId=".concat(d),n=t.r.NumberRange.get;break;default:return null}return await o(e,n,r)},v=async function(e){let d,l,n,r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,t=arguments.length>2?arguments[2]:void 0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,i=!(arguments.length>4)||void 0===arguments[4]||arguments[4],o=arguments.length>5?arguments[5]:void 0,v=void 0===s&&a&&await u(e,a,"dtId"),m=null==v?void 0:v.dtId,I="",y=!0;if(v&&void 0===s||"nraId"===s){if(m){let l=await u(e,m,"DcTypNumberRange");d=null==l?void 0:l.nraId,y=!((null==l?void 0:l.activeStatus)<0),d||(I="Assign the document type to a number range")}if((!m||!y)&&i&&a){var p;let d=await u(e,a,"DocumentType");r=(null==d?void 0:null===(p=d.list)||void 0===p?void 0:p.filter(e=>(null==e?void 0:e.activeStatus)===1).length)>0}}if(("nraId"===s||void 0===s)&&a){if((!m||m)&&!d||d&&!y){let l=await u(e,a,"glbSysNumberRange");(d=null==l?void 0:l.nraId)&&r&&(r=!1),y=!0}I=d||r?"":"Assign the system Function to a number range"}s>0&&!d&&(d=s),d&&y?(l={readOnly:null==(n=await u(e,d,"isExternal"))||!n.external,mandatory:null!=n&&!!n.external},t&&(t=await c(t,l,r,o))):!d&&t&&(t=await c(t,l,r,o));let f=o?"".concat(o,".reference"):"reference";return{dtId:m,resetReference:null==l?void 0:l.readOnly,dcTypeRequired:r,reference:{fieldName:f,isEmpty:(null==n?void 0:n.external)!==void 0&&(null==n||!n.external)},errorMessage:I,maxAccess:t,selectNraId:s}};var m=l(65950);function I(e){let{functionId:d,action:l,hasDT:n}=e,{getRequest:t}=(0,r.useContext)(m.$),{stack:s}=(0,a.V)();return{proxyAction:async()=>{let e=await v(t,d,"",void 0,n);(null==e?void 0:e.errorMessage)?s({message:null==e?void 0:e.errorMessage}):await l()}}}function y(e){var d;let{functionId:l,access:t,hasDT:s,enabled:i=!0,objectName:o=""}=e,{getRequest:c}=(0,r.useContext)(m.$),{stack:u}=(0,a.V)(),[I,y]=(0,r.useState)(),p=async e=>{let d=await v(c,l,t,e,s,o);if(!d.errorMessage)return d;u({message:null==d?void 0:d.errorMessage})},f=(0,n.a)({retry:!1,staleTime:0,enabled:i,queryKey:[l,I,!!t,i],queryFn:I||"nraId"===I?()=>p(I):()=>p()});return{documentType:f.data,maxAccess:(null==f?void 0:null===(d=f.data)||void 0===d?void 0:d.maxAccess)||t,changeDT(e){y((null==e?void 0:e.nraId)||"nraId")}}}},75163:function(e,d,l){"use strict";l.d(d,{Z:function(){return F}});var n=l(52322),r=l(69387),a=l(60218),t=l(80983),s=l(8661),i=l(31389),o=l(62362),c=l(2784),u=l(65950),v=l(38449),m=l(22341),I=l(33625),y=l(27423),p=l(5088),f=l(19473),h=l(21326),x=l(54074),g=l(69627),w=l(71987),b=l(26612);function F(e){let{labels:d,shipment:l=!1,bill:F=!1,deliveryOrder:j=!1,form:k,handleAddressValues:Z,checkedAddressId:N,window:C}=e,{getRequest:O}=(0,c.useContext)(u.$),{platformLabels:S}=(0,c.useContext)(f.l);(0,h.Z)({title:S.AddressFilter,window:C});let{formik:P}=(0,t.c)({initialValues:{search:"",cityId:null,countryId:null},validateOnChange:!0,onSubmit:async()=>{var e;let d=null==D?void 0:null===(e=D.list)||void 0===e?void 0:e.find(e=>e.checked);if(!(null==d?void 0:d.addressId)){Z({shipAddress:"",BillAddress:"",address:""}),C.close();return}if(l||F||j){let e=await A(null==d?void 0:d.addressId);l&&Z({shipAddress:e,shipAddressId:null==d?void 0:d.addressId,shipToAddressId:null==d?void 0:d.addressId}),F&&Z({billAddress:e,billAddressId:null==d?void 0:d.addressId,billToAddressId:null==d?void 0:d.addressId}),j&&Z({address:e,addressId:null==d?void 0:d.addressId})}C.close()}});async function A(e){var d;if(!e)return;let l=await O({extension:v.r.Address.format,parameters:"_addressId=".concat(e)});return null==l?void 0:null===(d=l.record)||void 0===d?void 0:d.formattedAddress.replace(/(\r\n|\r|\n)+/g,"\r\n")}let _=async function(){var e;let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{_startAt:l=0,_pageSize:n=50}=d,r=!!P.values.search&&!!P.values.countryId&&!!P.values.cityId&&!!k.clientId,a=await O({extension:r?m.P.FilterAddress.snapshot:m.P.Address.page,parameters:r?"_countryId=".concat(P.values.countryId,"&_cityId=").concat(P.values.cityId,"&_clientId=").concat(k.clientId,"&_filter=").concat(P.values.search):"_startAt=".concat(l,"&_pageSize=").concat(n,"&_params=1|").concat(k.clientId)}),t=(null==a?void 0:null===(e=a.list)||void 0===e?void 0:e.map(e=>{var d;return{addressId:e.addressId||e.recordId,address:null!==(d=e.formattedAddress)&&void 0!==d?d:"".concat(e.name||"",", ").concat(e.street1||"",", ").concat(e.street2||"",", ").concat(e.city||"",", ").concat(e.phone||"",",").concat(e.phone2||"",",").concat(e.email1||""),checked:(e.addressId||e.recordId)===N}}))||[];return{list:t,_startAt:l,count:t.length}},{query:{data:D},paginationParameters:q,refetch:V}=(0,w.J)({queryFn:_,endpointId:m.P.Address.page,datasetId:b.i.Address});async function R(){var e;let d=await O({extension:v.r.Defaults.get,parameters:"_filter=&_key=countryId"});P.setFieldValue("countryId",parseInt(null==d?void 0:null===(e=d.record)||void 0===e?void 0:e.value))}return(0,c.useEffect)(()=>{!async function(){await R()}()},[]),(0,n.jsx)(x.Z,{onSave:P.handleSubmit,children:(0,n.jsxs)(i.R,{children:[(0,n.jsx)(I.g,{children:(0,n.jsxs)(a.ZP,{container:!0,spacing:2,children:[(0,n.jsx)(a.ZP,{item:!0,xs:12,children:(0,n.jsx)(s.Z,{endpointId:v.r.Country.qry,name:"countryId",label:d.country,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:P.values,onChange:(e,d)=>{P.setFieldValue("cityId",""),P.setFieldValue("countryId",(null==d?void 0:d.recordId)||null)}})}),(0,n.jsx)(a.ZP,{item:!0,xs:12,children:(0,n.jsx)(y.U,{endpointId:v.r.City.snapshot,parameters:{_countryId:P.values.countryId,_stateId:0},valueField:"name",displayField:"name",name:"city",label:d.city,form:P,secondDisplayField:!1,onChange:(e,d)=>{P.setFieldValue("cityId",(null==d?void 0:d.recordId)||null),P.setFieldValue("city",(null==d?void 0:d.name)||null)}})}),(0,n.jsx)(a.ZP,{item:!0,xs:6,children:(0,n.jsx)(p.Z,{name:"search",value:P.values.search,label:d.search,onClear:()=>{P.setFieldValue("search","")},onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),e.stopPropagation())},onChange:P.handleChange})}),(0,n.jsx)(a.ZP,{item:!0,xs:2,children:(0,n.jsx)(g.Z,{label:d.apply,onClick:V,disabled:!(P.values.countryId&&P.values.cityId)})})]})}),(0,n.jsx)(o.Q,{children:(0,n.jsx)(r.Z,{name:"addressFilterTable",columns:[{field:"address",headerName:"",flex:6}],gridData:D,rowId:["addressId"],pageSize:50,paginationType:"api",paginationParameters:q,checkTitle:"",checkboxFlex:1,rowSelection:"single",showCheckboxColumn:!0,viewCheckButtons:!0})})]})})}F.width=950,F.height=600},39704:function(e,d,l){"use strict";var n=l(52322),r=l(2784),a=l(22341),t=l(65950),s=l(85325),i=l(21326),o=l(19473),c=l(35656),u=l(24868),v=l.n(u);let m=e=>{let{functionId:d,recordId:l,window:u}=e,{getRequest:m}=(0,r.useContext)(t.$),{languageId:I}=(0,r.useContext)(s.V),{platformLabels:y}=(0,r.useContext)(o.l),p=l+"-"+d;(0,i.Z)({title:y.WorkFlow,window:u});let{width:f}=(0,c.d)(),h=f<=1024,x=f>1024&&f<=1280,g=h?10:x?12:14,w=h?75:x?85:95,b=h?15:x?20:25,F=async()=>{var e="_functionId=".concat(d,"&_recordId=").concat(l);let n=await m({extension:a.P.WorkFlow.graph,parameters:e});return null==n?void 0:n.record},j=e=>{let d=[],l=[],n="",r="";return e.objects.forEach(e=>{d.push({functionName:e.functionName,reference:e.reference,date:e.date})}),e.workflow.forEach(d=>{e.objects.forEach(e=>{let l=e.functionName.split(" ").join("\r\n");d.parentId===e.recordId&&d.parentFunctionId===e.functionId&&(n=e.reference+"\r\n"+e.date+"\r\n"+l,d.parentId),d.childId===e.recordId&&d.childFunctionId===e.functionId&&(r=e.reference+"\r\n"+e.date+"\r\n"+l,d.childId)}),""===n||""===r||l.push({from:n,to:r,value:1,labelText:""}),n="",r=""}),l};return(0,r.useEffect)(()=>{!async function(){var e=await F();if(e){let d=(e,d)=>{let l=document.createElement("script");l.type="text/javascript",l.src=e,l.async=!0,l.onload=d,document.head.appendChild(l)};d("https://cdn.amcharts.com/lib/4/core.js",()=>{d("https://cdn.amcharts.com/lib/4/charts.js",()=>{d("https://cdn.amcharts.com/lib/4/themes/animated.js",()=>{am4core.ready(()=>{let d=am4core.create(p,am4charts.SankeyDiagram),l=j(e);d.data=l,d.dataFields.fromName="from",d.dataFields.toName="to",d.dataFields.value="value",d.paddingRight=2===I?0:40,d.paddingLeft=2===I?40:0,d.tooltip.label.fontSize=g;let n=d.nodes.template;n.draggable=!1,n.inert=!0,n.clickable=!1,n.width=w,n.height=b,n.nameLabel.label.fontSize=g,n.nameLabel.locationX=2===I?.85:0,n.nameLabel.height=void 0,n.nameLabel.label.fontWeight="bold";let r=d.links.template;r.middleLine.strokeOpacity=.3,r.middleLine.stroke=am4core.color("#555"),r.middleLine.strokeWidth=5,r.middleLine.hoverable=!1,r.fillOpacity=0,r.hoverable=!0,r.hoverOnFocus=!0,r.fill=am4core.color("#A8C686"),r.isHover=!0,d.appear(1e3,100)})})})})}}()},[]),(0,n.jsx)("div",{id:p,className:v().root})};m.width=950,d.Z=m},24868:function(e){e.exports={root:"WorkFlow_root__EINm1"}}}]);