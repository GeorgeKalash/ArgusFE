(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[53491],{75163:function(e,n,l){"use strict";l.d(n,{Z:function(){return F}});var t=l(52322),d=l(69387),a=l(60218),i=l(80983),s=l(8661),r=l(31389),o=l(62362),c=l(2784),u=l(65950),m=l(38449),h=l(22341),v=l(33625),I=l(27423),p=l(5088),f=l(19473),y=l(21326),x=l(54074),g=l(69627),b=l(71987),A=l(26612);function F(e){let{labels:n,shipment:l=!1,bill:F=!1,deliveryOrder:j=!1,form:C,handleAddressValues:w,checkedAddressId:k,window:Z}=e,{getRequest:T}=(0,c.useContext)(u.$),{platformLabels:P}=(0,c.useContext)(f.l);(0,y.Z)({title:P.AddressFilter,window:Z});let{formik:V}=(0,i.c)({initialValues:{search:"",cityId:null,countryId:null},validateOnChange:!0,onSubmit:async()=>{var e;let n=null==S?void 0:null===(e=S.list)||void 0===e?void 0:e.find(e=>e.checked);if(!(null==n?void 0:n.addressId)){w({shipAddress:"",BillAddress:"",address:""}),Z.close();return}if(l||F||j){let e=await N(null==n?void 0:n.addressId);l&&w({shipAddress:e,shipAddressId:null==n?void 0:n.addressId,shipToAddressId:null==n?void 0:n.addressId}),F&&w({billAddress:e,billAddressId:null==n?void 0:n.addressId,billToAddressId:null==n?void 0:n.addressId}),j&&w({address:e,addressId:null==n?void 0:n.addressId})}Z.close()}});async function N(e){var n;if(!e)return;let l=await T({extension:m.r.Address.format,parameters:"_addressId=".concat(e)});return null==l?void 0:null===(n=l.record)||void 0===n?void 0:n.formattedAddress.replace(/(\r\n|\r|\n)+/g,"\r\n")}let _=async function(){var e;let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{_startAt:l=0,_pageSize:t=50}=n,d=!!V.values.search&&!!V.values.countryId&&!!V.values.cityId&&!!C.clientId,a=await T({extension:d?h.P.FilterAddress.snapshot:h.P.Address.page,parameters:d?"_countryId=".concat(V.values.countryId,"&_cityId=").concat(V.values.cityId,"&_clientId=").concat(C.clientId,"&_filter=").concat(V.values.search):"_startAt=".concat(l,"&_pageSize=").concat(t,"&_params=1|").concat(C.clientId)}),i=(null==a?void 0:null===(e=a.list)||void 0===e?void 0:e.map(e=>{var n;return{addressId:e.addressId||e.recordId,address:null!==(n=e.formattedAddress)&&void 0!==n?n:"".concat(e.name||"",", ").concat(e.street1||"",", ").concat(e.street2||"",", ").concat(e.city||"",", ").concat(e.phone||"",",").concat(e.phone2||"",",").concat(e.email1||""),checked:(e.addressId||e.recordId)===k}}))||[];return{list:i,_startAt:l,count:i.length}},{query:{data:S},paginationParameters:D,refetch:L}=(0,b.J)({queryFn:_,endpointId:h.P.Address.page,datasetId:A.i.Address});async function E(){var e;let n=await T({extension:m.r.Defaults.get,parameters:"_filter=&_key=countryId"});V.setFieldValue("countryId",parseInt(null==n?void 0:null===(e=n.record)||void 0===e?void 0:e.value))}return(0,c.useEffect)(()=>{!async function(){await E()}()},[]),(0,t.jsx)(x.Z,{onSave:V.handleSubmit,children:(0,t.jsxs)(r.R,{children:[(0,t.jsx)(v.g,{children:(0,t.jsxs)(a.ZP,{container:!0,spacing:2,children:[(0,t.jsx)(a.ZP,{item:!0,xs:12,children:(0,t.jsx)(s.Z,{endpointId:m.r.Country.qry,name:"countryId",label:n.country,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:V.values,onChange:(e,n)=>{V.setFieldValue("cityId",""),V.setFieldValue("countryId",(null==n?void 0:n.recordId)||null)}})}),(0,t.jsx)(a.ZP,{item:!0,xs:12,children:(0,t.jsx)(I.U,{endpointId:m.r.City.snapshot,parameters:{_countryId:V.values.countryId,_stateId:0},valueField:"name",displayField:"name",name:"city",label:n.city,form:V,secondDisplayField:!1,onChange:(e,n)=>{V.setFieldValue("cityId",(null==n?void 0:n.recordId)||null),V.setFieldValue("city",(null==n?void 0:n.name)||null)}})}),(0,t.jsx)(a.ZP,{item:!0,xs:6,children:(0,t.jsx)(p.Z,{name:"search",value:V.values.search,label:n.search,onClear:()=>{V.setFieldValue("search","")},onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),e.stopPropagation())},onChange:V.handleChange})}),(0,t.jsx)(a.ZP,{item:!0,xs:2,children:(0,t.jsx)(g.Z,{label:n.apply,onClick:L,disabled:!(V.values.countryId&&V.values.cityId)})})]})}),(0,t.jsx)(o.Q,{children:(0,t.jsx)(d.Z,{name:"addressFilterTable",columns:[{field:"address",headerName:"",flex:6}],gridData:S,rowId:["addressId"],pageSize:50,paginationType:"api",paginationParameters:D,checkTitle:"",checkboxFlex:1,rowSelection:"single",showCheckboxColumn:!0,viewCheckButtons:!0})})]})})}F.width=950,F.height=600},72747:function(e,n,l){"use strict";l.d(n,{Z:function(){return F}});var t=l(52322),d=l(60218),a=l(26612),i=l(8661),s=l(71987),r=l(31389),o=l(82737),c=l(48601),u=l(5088),m=l(89330),h=l(21581),v=l(27423),I=l(25870),p=l(22341),f=l(19689),y=l(80983),x=l(96026),g=l(19473),b=l(21326),A=l(2784);function F(e){let{formValues:n,onSubmit:l,window:F}=e,{stack:j}=(0,x.V)(),{platformLabels:C}=(0,A.useContext)(g.l);(0,b.Z)({title:C.ChangeClient,window:F});let{labels:w,access:k}=(0,s.J)({datasetId:a.i.ChangeClient}),{formik:Z}=(0,y.c)({maxAccess:k,initialValues:{changeToId:null,changeToRef:"",changeToName:"",changeBillAddressId:null,changeBill:"",changeSzId:null},validateOnChange:!0,validationSchema:c.Ry({changeToId:c.Z_().required()}),onSubmit:async e=>{e.changeToId&&(l({clientId:e.changeToId,clientName:e.changeToName,clientRef:e.changeToRef,billAddressId:e.changeBillAddressId,billAddress:e.changeBill,szId:e.changeSzId}),F.close())}});return(0,t.jsx)(o.Z,{resourceId:a.i.ChangeClient,form:Z,isInfo:!1,isCleared:!1,maxAccess:k,children:(0,t.jsx)(r.R,{children:(0,t.jsxs)(d.ZP,{container:!0,spacing:2,children:[(0,t.jsx)(d.ZP,{item:!0,xs:12,children:(0,t.jsx)(u.Z,{name:"reference",label:w.reference,value:null==n?void 0:n.reference,readOnly:!0})}),(0,t.jsx)(d.ZP,{item:!0,xs:12,children:(0,t.jsx)(m.Z,{name:"date",label:w.date,value:null==n?void 0:n.date,readOnly:!0})}),(0,t.jsx)(d.ZP,{item:!0,xs:12,children:(0,t.jsx)(h.Z,{name:"billAddress",label:w.billAddress,value:null==n?void 0:n.billAddress,rows:3,maxLength:"100",readOnly:!0})}),(0,t.jsx)(d.ZP,{item:!0,xs:12,children:(0,t.jsx)(i.Z,{endpointId:p.P.PriceLevel.qry,name:"plId",label:w.priceLevel,readOnly:!0,valueField:"recordId",displayField:["reference","name"],values:n})}),(0,t.jsx)(d.ZP,{item:!0,xs:9,children:(0,t.jsx)(f.Z,{name:"isVattable",value:null==n?void 0:n.isVattable,label:w.vat,disabled:!0})}),(0,t.jsx)(d.ZP,{item:!0,xs:12,children:(0,t.jsx)(i.Z,{endpointId:I.H.TaxSchedules.qry,name:"taxId",label:w.taxSchedule,valueField:"recordId",displayField:["reference","name"],readOnly:!0,values:n})}),(0,t.jsx)(d.ZP,{item:!0,xs:12,children:(0,t.jsx)(v.U,{endpointId:p.P.Client.snapshot,valueField:"reference",displayField:"name",secondFieldLabel:w.name,name:"clientId",label:w.client,form:{values:n},readOnly:!0,displayFieldWidth:4,valueShow:"clientRef",secondValueShow:"clientName"})}),(0,t.jsx)(d.ZP,{item:!0,xs:12,children:(0,t.jsx)(v.U,{endpointId:p.P.Client.snapshot,filter:{isInactive:!1},valueField:"reference",displayField:"name",secondFieldLabel:w.name,name:"changeToId",label:w.changeTo,form:Z,displayFieldWidth:3,valueShow:"changeToRef",secondValueShow:"changeToName",maxAccess:k,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"},{key:"flName",value:"FlName"},{key:"keywords",value:"Keywords"},{key:"cgName",value:"Client Group"}],required:!0,onChange:(e,l)=>{let t=l?(null==n?void 0:n.plId)!=(null==l?void 0:l.plId)?(j({message:w.mismatchPrice}),!1):(null==n?void 0:n.isVattable)!=(null==l?void 0:l.isSubjectToVAT)?(j({message:w.mismatchVat}),!1):(null==n?void 0:n.taxId)!=(null==l?void 0:l.taxId)?(j({message:w.mismatchTax}),!1):!(((null==n?void 0:n.maxDiscount)||0)<((null==l?void 0:l.maxDiscount)||0))||(j({message:w.mismatchDiscount}),!1):null;Z.setFieldValue("changeToId",t?null==l?void 0:l.recordId:null),Z.setFieldValue("changeToName",t?null==l?void 0:l.name:""),Z.setFieldValue("changeToRef",t?null==l?void 0:l.reference:null),Z.setFieldValue("changeBillId",t?null==l?void 0:l.billAddressId:null),Z.setFieldValue("changeBill",t?null==l?void 0:l.billAddress:""),Z.setFieldValue("changeSzId",t?null==l?void 0:l.szId:null)},errorCheck:"changeToId"})})]})})})}F.width=500,F.height=570},39704:function(e,n,l){"use strict";var t=l(52322),d=l(2784),a=l(22341),i=l(65950),s=l(85325),r=l(21326),o=l(19473),c=l(35656),u=l(24868),m=l.n(u);let h=e=>{let{functionId:n,recordId:l,window:u}=e,{getRequest:h}=(0,d.useContext)(i.$),{languageId:v}=(0,d.useContext)(s.V),{platformLabels:I}=(0,d.useContext)(o.l),p=l+"-"+n;(0,r.Z)({title:I.WorkFlow,window:u});let{width:f}=(0,c.d)(),y=f<=1024,x=f>1024&&f<=1280,g=y?10:x?12:14,b=y?75:x?85:95,A=y?15:x?20:25,F=async()=>{var e="_functionId=".concat(n,"&_recordId=").concat(l);let t=await h({extension:a.P.WorkFlow.graph,parameters:e});return null==t?void 0:t.record},j=e=>{let n=[],l=[],t="",d="";return e.objects.forEach(e=>{n.push({functionName:e.functionName,reference:e.reference,date:e.date})}),e.workflow.forEach(n=>{e.objects.forEach(e=>{let l=e.functionName.split(" ").join("\r\n");n.parentId===e.recordId&&n.parentFunctionId===e.functionId&&(t=e.reference+"\r\n"+e.date+"\r\n"+l,n.parentId),n.childId===e.recordId&&n.childFunctionId===e.functionId&&(d=e.reference+"\r\n"+e.date+"\r\n"+l,n.childId)}),""===t||""===d||l.push({from:t,to:d,value:1,labelText:""}),t="",d=""}),l};return(0,d.useEffect)(()=>{!async function(){var e=await F();if(e){let n=(e,n)=>{let l=document.createElement("script");l.type="text/javascript",l.src=e,l.async=!0,l.onload=n,document.head.appendChild(l)};n("https://cdn.amcharts.com/lib/4/core.js",()=>{n("https://cdn.amcharts.com/lib/4/charts.js",()=>{n("https://cdn.amcharts.com/lib/4/themes/animated.js",()=>{am4core.ready(()=>{let n=am4core.create(p,am4charts.SankeyDiagram),l=j(e);n.data=l,n.dataFields.fromName="from",n.dataFields.toName="to",n.dataFields.value="value",n.paddingRight=2===v?0:40,n.paddingLeft=2===v?40:0,n.tooltip.label.fontSize=g;let t=n.nodes.template;t.draggable=!1,t.inert=!0,t.clickable=!1,t.width=b,t.height=A,t.nameLabel.label.fontSize=g,t.nameLabel.locationX=2===v?.85:0,t.nameLabel.height=void 0,t.nameLabel.label.fontWeight="bold";let d=n.links.template;d.middleLine.strokeOpacity=.3,d.middleLine.stroke=am4core.color("#555"),d.middleLine.strokeWidth=5,d.middleLine.hoverable=!1,d.fillOpacity=0,d.hoverable=!0,d.hoverOnFocus=!0,d.fill=am4core.color("#A8C686"),d.isHover=!0,n.appear(1e3,100)})})})})}}()},[]),(0,t.jsx)("div",{id:p,className:m().root})};h.width=950,n.Z=h},16096:function(e,n,l){"use strict";l.d(n,{ER:function(){return t},Ot:function(){return o},Ww:function(){return r},Yi:function(){return i},a$:function(){return d}});let t=1,d=2,a=e=>{if(!0===e.tdPct){e.tdAmount>100?1===e.typeChange?e.tdAmount=0:e.tdAmount=e.currentDiscount:e.currentDiscount=e.tdAmount,e.hiddenTdPct=e.tdAmount;let n=e.subtotal*e.tdAmount/100;e.hiddenTdAmount=n,e.tdType=d}else if(e.tdAmount>e.subtotal)1===e.typeChange?e.tdAmount=0:e.tdAmount=e.currentDiscount;else{e.currentDiscount=e.tdAmount;let n=0===e.subtotal?0:100*e.tdAmount/e.subtotal;e.hiddenTdPct=n,e.hiddenTdAmount=e.tdAmount,e.tdType=t}return e},i=e=>e=a(e),s=(e,n)=>(e.forEach(e=>{n.totalQty+=parseFloat(e.qty),n.totalWeight+=e.qty*e.weight,n.totalVolume+=e.qty*e.volume,n.totalUpo+=e.upo,n.sumVat+=e.vatAmount}),n.net=n.sumExtended+n.sumVat+((null==n?void 0:n.miscAmount)||0)-((null==n?void 0:n.tdAmount)||0),n),r=e=>e.reduce((e,n)=>e+(Number(n.extendedPrice)||0),0),o=(e,n)=>n=s(e,n)},24868:function(e){e.exports={root:"WorkFlow_root__EINm1"}}}]);