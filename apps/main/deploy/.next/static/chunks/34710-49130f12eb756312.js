(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[34710],{93736:function(e,l,i){"use strict";i.d(l,{K:function(){return n}});let a="RG.FI.asmx/",n={FiOpeningBalance:{gen:a+"genOBA"},FiAging:{qry:a+"FI404"},AccountSummary:{AccFI405b:a+"FI405b"},DocumentAging:{AgingFI406a:a+"FI406a",AgingFI406b:a+"FI406b"},TrialBalance:{FI402View:a+"FI402o",FI401o2:a+"FI401o2"}}},16463:function(e,l,i){"use strict";i.d(l,{Z:function(){return w}});var a=i(52322),n=i(2784),d=i(49864),o=i(65950),t=i(27423),r=i(26612),s=i(71987),u=i(33625),c=i(62362),v=i(31389),m=i(8661),p=i(25870),I=i(69627),x=i(84100),f=i(19473),h=i(80983),y=i(38449),g=i(69387),F=i(93736),b=i(21326);function w(e){let{accountId:l,moduleId:i,window:w}=e,{getRequest:P}=(0,n.useContext)(o.$),{platformLabels:N}=(0,n.useContext)(f.l),[j,Z]=(0,n.useState)([]);(0,b.Z)({title:N.AccountSummary,window:w});let{labels:k,access:C}=(0,s.J)({datasetId:r.i.AccountSummary}),A=[{field:"days",headerName:k.days,flex:1,type:"number"}],[V,S]=(0,n.useState)(A),{formik:D}=(0,h.c)({maxAccess:C,initialValues:{accountId:null,accountRef:"",accountName:"",agpId:null,moduleId:i}});async function R(){var e,l,a,n;let d;let o=2,t=[...A],r=await P({extension:y.r.Currency.qry,parameters:"_filter="});if(1==i?d=null==r?void 0:null===(e=r.list)||void 0===e?void 0:e.filter(e=>e.sale):2==i&&(d=null==r?void 0:null===(l=r.list)||void 0===l?void 0:l.filter(e=>e.purchase)),0==d.length)return;null==d||d.forEach((e,l)=>{t.push({field:"column".concat(l+1),headerName:e.reference,flex:1,type:"number"})}),S(t);let s=await P({extension:p.H.AgingLeg.qry,parameters:"_agpId=".concat(D.values.agpId)}),u=null==s?void 0:null===(a=s.list)||void 0===a?void 0:a.map(e=>{let l=Array(d.length+2).fill(0);return l[0]=null,l[1]=e.days,l}),c=(d||[]).map(e=>P({extension:F.K.AccountSummary.AccFI405b,parameters:"_agpId=".concat(D.values.agpId,"&_currencyId=").concat(e.recordId,"&_accountId=").concat(D.values.accountId)}).then(e=>({summaryRes:e})));(await Promise.all(c)).forEach(e=>{var l;let{summaryRes:i}=e;null==i||null===(l=i.list)||void 0===l||l.forEach(e=>{null==u||u.forEach(l=>{l[1]==e.seqDays&&(l[o]=e.amount)})}),o++});let v=Array(d.length+2).fill(null);for(let e=2;e<d.length+2;e++){let l=0;null==u||u.map(i=>{l+=Number(i[e]||0)}),v[e]=l}let m=u.filter(e=>null!==e[1]).map(e=>{let[l,i,...a]=e,n={days:i};return a.forEach((e,l)=>{n["column".concat(l+1)]=e.toFixed(2)}),n}),I={};for(let e=0;e<d.length;e++)I["column".concat(e+1)]=null!==(n=v[e+2].toFixed(2))&&void 0!==n?n:0;m.push(I),Z({list:m})}return(0,n.useEffect)(()=>{!async function(){if(l&&i){var e,a,n;let i=await P({extension:p.H.Account.get,parameters:"_recordId=".concat(l)});D.setFieldValue("accountId",null==i?void 0:null===(e=i.record)||void 0===e?void 0:e.recordId),D.setFieldValue("accountRef",null==i?void 0:null===(a=i.record)||void 0===a?void 0:a.reference),D.setFieldValue("accountName",null==i?void 0:null===(n=i.record)||void 0===n?void 0:n.name)}}()},[]),(0,a.jsxs)(v.R,{children:[(0,a.jsx)(u.g,{children:(0,a.jsxs)(d.Z,{container:!0,spacing:2,p:2,children:[(0,a.jsx)(d.Z,{item:!0,xs:12,children:(0,a.jsx)(t.U,{endpointId:p.H.Account.snapshot,name:"accountId",label:k.account,valueField:"reference",displayField:"name",valueShow:"accountRef",secondValueShow:"accountName",form:D,readOnly:D.values.accountId&&D.values.moduleId,required:!0,maxAccess:C,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],onChange:async(e,l)=>{D.setFieldValue("accountId",(null==l?void 0:l.recordId)||null),D.setFieldValue("accountName",(null==l?void 0:l.name)||""),D.setFieldValue("accountRef",(null==l?void 0:l.reference)||"")}})}),(0,a.jsx)(d.Z,{item:!0,xs:6,children:(0,a.jsx)(m.Z,{endpointId:p.H.AgingProfile.qry,parameters:"_startAt=0&_pageSize=1000&filter=",name:"agpId",label:k.agingProfile,values:D.values,valueField:"recordId",displayField:"name",maxAccess:C,required:!0,onChange:(e,l)=>{D.setFieldValue("agpId",(null==l?void 0:l.recordId)||null),(null==l?void 0:l.recordId)||Z({list:[]})}})}),(0,a.jsx)(d.Z,{item:!0,xs:5,children:(0,a.jsx)(m.Z,{datasetId:x.v.FI_AGING_MODULE,label:k.module,name:"moduleId",values:D.values,valueField:"key",displayField:"value",maxAccess:C,required:!0,readOnly:D.values.moduleId,onChange:(e,l)=>{D.setFieldValue("moduleId",(null==l?void 0:l.key)||null)}})}),(0,a.jsx)(d.Z,{item:!0,xs:1,children:(0,a.jsx)(I.Z,{onClick:R,image:"preview.png",disabled:!D.values.agpId||!D.values.moduleId||!D.values.accountId,tooltipText:N.Preview})})]})}),(0,a.jsx)(c.Q,{children:(0,a.jsx)(g.Z,{columns:V,gridData:j,isLoading:!1,pagination:!1})})]})}w.width=1e3,w.height=500},34710:function(e,l,i){"use strict";i.d(l,{Z:function(){return W}});var a=i(52322),n=i(89330),d=i(39812),o=i(60218),t=i(2784),r=i(48601),s=i(82737),u=i(62202),c=i(65950);i(71987);var v=i(26612),m=i(5088),p=i(21581),I=i(8661),x=i(38449),f=i(65215),h=i(7121),y=i(27423),g=i(62362),F=i(76399),b=i(31389),w=i(33625),P=i(91406),N=i(22341),j=i(25870),Z=i(80983),k=i(39704),C=i(61802),A=i(19473),V=i(18996),S=i(98345),D=i(69387),R=i(19568),O=i(81330),q=i(86626),_=i(51235),T=i(96026),L=i(69627),E=i(16463);function W(e){var l,W,J,G,H,B,z,M,X,$,U,K,Q,Y,ee,el,ei,ea,en,ed,eo,et,er,es,eu,ec,ev,em,ep,eI,ex,ef,eh,ey,eg,eF,eb;let{labels:ew,access:eP,recordId:eN,invalidate:ej}=e,{getRequest:eZ,postRequest:ek}=(0,t.useContext)(c.$),{stack:eC}=(0,C.zY)(),{stack:eA}=(0,T.V)(),{platformLabels:eV,defaultsData:eS,userDefaultsData:eD,systemChecks:eR}=(0,t.useContext)(A.l),[eO,eq]=(0,t.useState)(!1),{documentType:e_,maxAccess:eT,changeDT:eL}=(0,S.H)({functionId:h.J.DraftInvoiceReturn,access:eP,enabled:!eN});(0,t.useEffect)(()=>{(null==e_?void 0:e_.dtId)&&lo(e_.dtId)},[null==e_?void 0:e_.dtId]);let eE=parseInt(null==eS?void 0:null===(W=eS.list)||void 0===W?void 0:null===(l=W.find(e=>"currencyId"===e.key))||void 0===l?void 0:l.value),eW=parseInt(null==eS?void 0:null===(G=eS.list)||void 0===G?void 0:null===(J=G.find(e=>"plId"===e.key))||void 0===J?void 0:J.value),eJ=parseInt(null==eD?void 0:null===(B=eD.list)||void 0===B?void 0:null===(H=B.find(e=>"spId"===e.key))||void 0===H?void 0:H.value),eG=parseInt(null==eD?void 0:null===(M=eD.list)||void 0===M?void 0:null===(z=M.find(e=>"siteId"===e.key))||void 0===z?void 0:z.value),{formik:eH}=(0,Z.c)({maxAccess:eT,documentType:{key:"dtId",value:null==e_?void 0:e_.dtId},initialValues:{recordId:eN,dtId:null,reference:"",date:new Date,plantId:null,clientId:null,currencyId:eE||null,spId:eJ||null,siteId:eG||null,description:"",status:1,wip:1,isVattable:!1,taxId:null,subTotal:0,amount:0,vatAmount:0,plId:eW,ptId:null,weight:0,disSkuLookup:!1,invoiceId:null,invoiceRef:"",returnReasonId:null,search:"",serials:[{id:1,returnId:eN||0,srlNo:"",metalId:"",designId:"",itemId:"",sku:"",itemName:"",seqNo:1,extendedPrice:0,baseLaborPrice:0,weight:0,metalRef:"",designRef:"",vatAmount:0,vatPct:0,unitPrice:0,taxId:null,taxDetails:null,priceType:0,volume:0,invoiceReference:"",invoiceTrxId:null,invoiceSeqNo:1,invoiceComponentSeqNo:0}],metalGridData:[],itemGridData:[],taxDetailsStore:[]},validateOnChange:!0,validationSchema:r.Ry({date:r.Z_().required(),currencyId:r.Z_().required(),clientId:r.Z_().required(),spId:r.Z_().required(),siteId:r.Z_().required(),serials:r.IX().of(r.Ry().shape({srlNo:r.Z_().test({name:"srlNo-first-row-check",test(e,l){let{parent:i}=l;return(null==i?void 0:i.id)==1||(!((null==i?void 0:i.id)>1)||!!e)&&e}})}))}),onSubmit:async e=>{var l;let{taxDetailsStore:i,itemGridData:a,metalGridData:n,search:o,disSkuLookup:t,serials:r,date:s,...c}=e,v={...c,pcs:r.length,date:(0,d.ku)(s)},m=null==eH?void 0:null===(l=eH.values)||void 0===l?void 0:l.serials.filter(e=>e.srlNo).map((e,l)=>{let{taxDetails:i,recordId:a,...n}=e;return{...n,seqNo:l+1,returnId:a||0}});ek({extension:N.P.DraftReturn.set2,record:JSON.stringify({header:v,items:m})}).then(async e=>{u.ZP.success(eK?eV.Edited:eV.Added),await eB(e.recordId),ej()})}});async function eB(e){let l=await ez(e),i=await eM(e);await li(l,i)}async function ez(e){var l;let i=await eZ({extension:N.P.DraftReturn.get,parameters:"_recordId=".concat(e)}),a=await eZ({extension:N.P.Client.get,parameters:"_recordId=".concat(i.record.clientId)});return i.record.date=(0,d.a1)(null==i?void 0:null===(l=i.record)||void 0===l?void 0:l.date),i.record.accountId=a.record.accountId,i}async function eM(e){return await eZ({extension:N.P.DraftReturnSerial.qry,parameters:"_returnId=".concat(e)})}async function eX(){let e=await eZ({extension:j.H.TaxDetailPack.qry,parameters:"_taxId=0"});eH.setFieldValue("taxDetailsStore",null==e?void 0:e.list)}function e$(e,l){eO||eq(!0);let i=(0,q.Ch)({priceType:3,basePrice:0,volume:parseFloat((null==e?void 0:e.volume)||0),weight:1,unitPrice:parseFloat(null==e?void 0:e.baseLaborPrice),upo:0,qty:parseFloat(null==e?void 0:e.weight),extendedPrice:parseFloat(null==e?void 0:e.unitPrice).toFixed(2),mdAmount:0,mdType:0,baseLaborPrice:0,totalWeightPerG:0,mdValue:0,tdPct:0,dirtyField:l}),a=(0,V.VW)({priceType:null==i?void 0:i.priceType,basePrice:0,qty:parseFloat(null==e?void 0:e.weight),weight:parseFloat(null==e?void 0:e.weight),extendedPrice:parseFloat(null==i?void 0:i.extendedPrice),tdPct:0,baseLaborPrice:0,taxDetails:parseFloat(null==e?void 0:e.taxDetails)});return{unitPrice:parseFloat(null==i?void 0:i.extendedPrice).toFixed(2),baseLaborPrice:parseFloat(null==i?void 0:i.unitPrice).toFixed(2),vatAmount:parseFloat(null==a?void 0:a.vatAmount).toFixed(2)}}let eU=null==eR?void 0:null===(X=eR.find(e=>e.checkId===_.F.POS_JUMP_TO_NEXT_LINE))||void 0===X?void 0:X.value,eK=!!eH.values.recordId,eQ=2===eH.values.wip,eY=e=>{if(e.length){let l=null==e?void 0:e.map(e=>{var l;return null!=e.taxId?{...e,extendedPrice:e.unitPrice,taxDetails:e0(null==eH?void 0:null===(l=eH.values)||void 0===l?void 0:l.taxDetailsStore,e.taxId)}:e});eH.setFieldValue("serials",l)}},e0=(e,l)=>{var i;return(null==e?void 0:null===(i=e.data)||void 0===i?void 0:i.items)?e.data.items.map(e=>e.data).filter(e=>e.taxId===l):[]},e2=async e=>{var l;if(!(null==e?void 0:e.returnId)||!(null==e?void 0:e.itemId))return!0;let i={returnId:null==eH?void 0:null===(l=eH.values)||void 0===l?void 0:l.recordId,lineItem:e};return await ek({extension:N.P.DraftReturnSerial.del,record:JSON.stringify(i)}),!0};async function e1(e,l,i){if(null==l?void 0:l.srlNo)return e4(e,l,i)}async function e4(e,l,i){l.returnId=(null==e?void 0:e.recordId)||i,e.recordId=(null==e?void 0:e.recordId)||i,delete e.serials;let a=await ek({extension:N.P.DraftReturnSerial.append,record:JSON.stringify({header:e,lineItem:l}),noHandleError:!0});return null==a||!a.error||(eA({message:null==a?void 0:a.error}),!1)}async function e3(e,l){if(null==l?void 0:l.srlNo)return!!e4(e,l)&&(u.ZP.success(eV.Saved),!0)}async function e6(e,l){var i,a;let{taxDetailsStore:n,itemGridData:o,metalGridData:t,search:r,disSkuLookup:s,serials:c,date:v,...m}=null==eH?void 0:eH.values,p={header:{...m,pcs:0,date:(0,d.ku)(v)},items:[]};delete p.header.serials;let I=await ek({extension:N.P.DraftReturn.set2,record:JSON.stringify(p)}),x=await ez(I.recordId);if(eH.setFieldValue("recordId",I.recordId),eH.setFieldValue("reference",null==x?void 0:null===(i=x.record)||void 0===i?void 0:i.reference),eH.setFieldValue("date",null==x?void 0:null===(a=x.record)||void 0===a?void 0:a.date),!("import"===l?await e1(null==x?void 0:x.record,e):await e3(null==x?void 0:x.record,e)))return!1;{u.ZP.success(eV.Saved);let e=await ez(I.recordId),l=await eM(I.recordId);return await li(e,l),ej(),!0}}let e8=[{component:"textfield",label:ew.srlNo,name:"srlNo",flex:1.2,updateOn:"blur",jumpToNextLine:eU,disableDuplicate:!0,propsReducer(e){let{row:l,props:i}=e;return{...i,readOnly:null==l?void 0:l.srlNo}},async onChange(e){let{row:{update:l,newRow:i,oldRow:a,addRow:n}}=e;if((null==i?void 0:i.srlNo)&&(null==i?void 0:i.srlNo)&&i.srlNo!==(null==a?void 0:a.srlNo)){var d,o,t,r,s,u,c,v,m,p,I,x,f,h,y,g,F,b,w,P,j,Z,k,C,A,V,S,D,R,O,_;let e=await eZ({extension:N.P.LastSerialInvoice.get,parameters:"_currencyId=".concat(null==eH?void 0:null===(d=eH.values)||void 0===d?void 0:d.currencyId,"&_clientId=").concat(null==eH?void 0:null===(o=eH.values)||void 0===o?void 0:o.clientId,"&_srlNo=").concat(null==i?void 0:i.srlNo)}),a={fieldName:"srlNo",changes:{id:i.id,seqNo:i.id,invoiceSeqNo:i.id,invoiceComponentSeqNo:(null==e?void 0:null===(t=e.record)||void 0===t?void 0:t.invoiceComponentSeqNo)||0,returnId:null==eH?void 0:null===(r=eH.values)||void 0===r?void 0:r.recordId,srlNo:null==e?void 0:null===(s=e.record)||void 0===s?void 0:s.srlNo,sku:null==e?void 0:null===(u=e.record)||void 0===u?void 0:u.sku,itemName:null==e?void 0:null===(c=e.record)||void 0===c?void 0:c.itemName,weight:(null==e?void 0:null===(v=e.record)||void 0===v?void 0:v.weight)||0,itemId:null==e?void 0:null===(m=e.record)||void 0===m?void 0:m.itemId,priceType:(null==e?void 0:null===(p=e.record)||void 0===p?void 0:p.priceType)||0,metalId:null==e?void 0:null===(I=e.record)||void 0===I?void 0:I.metalId,metalRef:null==e?void 0:null===(x=e.record)||void 0===x?void 0:x.metalRef,designId:null==e?void 0:null===(f=e.record)||void 0===f?void 0:f.designId,designRef:null==e?void 0:null===(h=e.record)||void 0===h?void 0:h.designRef,categoryName:null==e?void 0:null===(y=e.record)||void 0===y?void 0:y.categoryName,invoiceReference:null==e?void 0:null===(g=e.record)||void 0===g?void 0:g.invoiceRef,volume:(null==e?void 0:null===(F=e.record)||void 0===F?void 0:F.volume)||0,baseLaborPrice:(null==e?void 0:null===(b=e.record)||void 0===b?void 0:b.laborPrice)||0,unitPrice:parseFloat(null==e?void 0:null===(w=e.record)||void 0===w?void 0:w.unitPrice).toFixed(2)||0,vatPct:(null==e?void 0:null===(P=e.record)||void 0===P?void 0:P.vatPct)||0,vatAmount:parseFloat(null==e?void 0:null===(j=e.record)||void 0===j?void 0:j.vatAmount).toFixed(2)||0,invoiceTrxId:(null==e?void 0:null===(Z=e.record)||void 0===Z?void 0:Z.trxId)||0,...(null==e?void 0:null===(k=e.record)||void 0===k?void 0:k.taxId)&&{taxId:(null===(C=eH.values)||void 0===C?void 0:C.taxId)||(null==e?void 0:null===(A=e.record)||void 0===A?void 0:A.taxId),taxDetails:await e0(null==eH?void 0:null===(V=eH.values)||void 0===V?void 0:V.taxDetailsStore,(null===(S=eH.values)||void 0===S?void 0:S.taxId)||(null==e?void 0:null===(D=e.record)||void 0===D?void 0:D.taxId))}}},{unitPrice:T,baseLaborPrice:L}=e$(a.changes,q.Xf);a.changes.unitPrice=T,a.changes.baseLaborPrice=L,null!=a.changes.taxId&&(a.changes.extendedPrice=T,a.changes.taxDetails=e0(null==eH?void 0:null===(O=eH.values)||void 0===O?void 0:O.taxDetailsStore,a.changes.taxId)),((null==eH?void 0:null===(R=eH.values)||void 0===R?void 0:R.recordId)?await e3(null==eH?void 0:eH.values,a.changes):await e6(a.changes))?await n(a):l({...null==eH?void 0:null===(_=eH.initialValues)||void 0===_?void 0:_.serials,id:null==i?void 0:i.id,srlNo:""})}}},{component:"textfield",label:ew.sku,name:"sku",props:{readOnly:!0}},{component:"textfield",label:ew.itemDesc,name:"itemName",flex:2,props:{readOnly:!0}},{component:"textfield",label:ew.metalRef,name:"metalRef",flex:.6,props:{readOnly:!0}},{component:"textfield",label:ew.invoiceNo,name:"invoiceReference",props:{readOnly:!0}},{component:"numberfield",label:ew.weight,name:"weight",props:{readOnly:!0}},{component:"numberfield",label:ew.vatAmount,name:"vatAmount",props:{readOnly:!0}},{component:"button",name:"taxDetailsButton",flex:.75,props:{onCondition:e=>e.itemId&&e.taxId?{imgSrc:i(54022).default.src,hidden:!1}:{imgSrc:"",hidden:!0}},label:ew.tax,onClick:(e,l)=>{l.qty=l.weight,l.basePrice=0,eC({Component:R.Z,props:{taxId:null==l?void 0:l.taxId,obj:l}})}},{component:"numberfield",label:ew.baseLaborPrice,name:"baseLaborPrice",updateOn:"blur",props:{decimalScale:2,readOnly:!0}},{component:"numberfield",label:ew.unitPrice,name:"unitPrice",props:{readOnly:!0}}];async function e5(){let{serials:e,...l}=eH.values;await ek({extension:N.P.DraftReturn.reopen,record:JSON.stringify({...l,date:(0,d.ku)(eH.values.date)})}).then(()=>{var e;u.ZP.success(eV.Reopened),ej(),eB(null==eH?void 0:null===(e=eH.values)||void 0===e?void 0:e.recordId)})}async function e7(){eC({Component:k.Z,props:{functionId:h.J.DraftInvoiceReturn,recordId:eH.values.recordId}})}async function e9(){var e;eC({Component:O.Z,props:{endPoint:N.P.DraftReturnSerial.batch,header:{draftId:null==eH?void 0:null===(e=eH.values)||void 0===e?void 0:e.recordId},onCloseimport:ll,maxAccess:eT}})}let le=[{key:"Close",condition:!eQ,onClick:async function(){let{serials:e,...l}=eH.values;await ek({extension:N.P.DraftReturn.close,record:JSON.stringify({...l,date:(0,d.ku)(eH.values.date)})}).then(()=>{var e;u.ZP.success(eV.Closed),ej(),eB(null==eH?void 0:null===(e=eH.values)||void 0===e?void 0:e.recordId)})},disabled:eQ||!eK||!(null==eH?void 0:null===(K=eH.values)||void 0===K?void 0:null===(U=K.serials)||void 0===U?void 0:null===($=U[0])||void 0===$?void 0:$.srlNo)},{key:"Reopen",condition:eQ,onClick:e5,disabled:!eQ||3==eH.values.status||!eK},{key:"WorkFlow",condition:!0,onClick:e7,disabled:!eK},{key:"Import",condition:!0,onClick:e9,disabled:!eK||1!=eH.values.status||eQ},{key:"AccountSummary",condition:!0,onClick:()=>{eC({Component:E.Z,props:{accountId:parseInt(eH.values.accountId),moduleId:1}})},disabled:!eH.values.clientId}];async function ll(){var e,l,i,a,n,d,o,t,r;let s=await ez(null==eH?void 0:null===(e=eH.values)||void 0===e?void 0:e.recordId),u=await eM(null==eH?void 0:null===(l=eH.values)||void 0===l?void 0:l.recordId),c=await Promise.all(null===(i=u.list)||void 0===i?void 0:i.map(async(e,l)=>{var i;let a=(null==s?void 0:null===(i=s.record)||void 0===i?void 0:i.isVattable)?await la(e.taxId):null;return{...e,id:l+1,baseLaborPrice:parseFloat(e.baseLaborPrice).toFixed(2),unitPrice:parseFloat(e.unitPrice).toFixed(2),vatAmount:parseFloat(e.vatAmount).toFixed(2),amount:parseFloat(e.amount).toFixed(2),taxDetails:a}}));await eH.setValues({...eH.values,...s.record,plId:eW||(null==eH?void 0:null===(a=eH.values)||void 0===a?void 0:a.plId),amount:null==s?void 0:null===(n=s.record)||void 0===n?void 0:n.amount,vatAmount:null==s?void 0:null===(d=s.record)||void 0===d?void 0:d.vatAmount,subTotal:null==s?void 0:null===(o=s.record)||void 0===o?void 0:o.subTotal,weight:null==s?void 0:null===(t=s.record)||void 0===t?void 0:t.weight,serials:c.length?c:null==eH?void 0:null===(r=eH.initialValues)||void 0===r?void 0:r.serials}),eY(c)}async function li(e,l){var i,a,n,d,o,t,r;let s=await Promise.all(null==l?void 0:null===(i=l.list)||void 0===i?void 0:i.map(async(l,i)=>{var a;let n=(null==e?void 0:null===(a=e.record)||void 0===a?void 0:a.isVattable)?await la(l.taxId):null;return{...l,id:l.seqNo,baseLaborPrice:parseFloat(l.baseLaborPrice).toFixed(2),unitPrice:parseFloat(l.unitPrice).toFixed(2),vatAmount:parseFloat(l.vatAmount).toFixed(2),amount:parseFloat(l.amount).toFixed(2),taxDetails:n}}));await eH.setValues({...eH.values,...e.record,plId:eW||(null==eH?void 0:null===(a=eH.values)||void 0===a?void 0:a.plId),amount:null==e?void 0:null===(n=e.record)||void 0===n?void 0:n.amount,vatAmount:null==e?void 0:null===(d=e.record)||void 0===d?void 0:d.vatAmount,subTotal:null==e?void 0:null===(o=e.record)||void 0===o?void 0:o.subTotal,weight:null==e?void 0:null===(t=e.record)||void 0===t?void 0:t.weight,serials:s.length?s:null==eH?void 0:null===(r=eH.initialValues)||void 0===r?void 0:r.serials}),eY(s)}async function la(e){if(!e)return;let l=await eZ({extension:j.H.TaxDetailPack.qry,parameters:"_taxId=".concat(e)});return null==l?void 0:l.list}let ln=eH.values.search?eH.values.serials.filter(e=>{var l,i,a,n,d,o,t,r,s,u;return(null===(i=e.srlNo)||void 0===i?void 0:null===(l=i.toString())||void 0===l?void 0:l.includes(eH.values.search.toLowerCase()))||(null===(d=e.sku)||void 0===d?void 0:null===(n=d.toString())||void 0===n?void 0:null===(a=n.toLowerCase())||void 0===a?void 0:a.includes(eH.values.search.toLowerCase()))||(null===(r=e.itemName)||void 0===r?void 0:null===(t=r.toString())||void 0===t?void 0:null===(o=t.toLowerCase())||void 0===o?void 0:o.includes(eH.values.search.toLowerCase()))||(null===(u=e.weight)||void 0===u?void 0:null===(s=u.toString())||void 0===s?void 0:s.includes(eH.values.search))}):eH.values.serials,ld=(e,l,i)=>{if("delete"===l){let e=eH.values.serials;e=e.filter(e=>e.id!==i.id),eH.setFieldValue("serials",e),eq(!0)}else eH.setFieldValue("serials",e)};async function lo(e){if(e){var l,i,a;let n=await eZ({extension:N.P.DocumentTypeDefault.get,parameters:"_dtId=".concat(e)});eH.setFieldValue("plantId",(null==n?void 0:null===(l=n.record)||void 0===l?void 0:l.plantId)||null),eH.setFieldValue("spId",(null==n?void 0:null===(i=n.record)||void 0===i?void 0:i.spId)||eJ||null),eH.setFieldValue("siteId",(null==n?void 0:null===(a=n.record)||void 0===a?void 0:a.siteId)||eG||null)}}(0,t.useEffect)(()=>{var e,l;if(null==eH?void 0:null===(l=eH.values)||void 0===l?void 0:null===(e=l.serials)||void 0===e?void 0:e.length){let e=null==eH?void 0:null===(i=eH.values)||void 0===i?void 0:i.serials,l=e.reduce((e,l)=>{let{metalId:i,weight:a,metalRef:n}=l;return i&&(e[i]||(e[i]={metal:n,pcs:0,totalWeight:0}),e[i].pcs+=1,e[i].totalWeight+=parseFloat(a||0)),e},{});Object.keys(l).forEach(e=>{l[e].totalWeight=parseFloat(l[e].totalWeight.toFixed(2))}),eH.setFieldValue("metalGridData",Object.values(l));var i,a=0;let n=e.reduce((e,l)=>{let{sku:i,itemId:n,itemName:d,weight:o,categoryName:t}=l;return n&&(e[n]||(a++,e[n]={sku:i,pcs:0,weight:0,itemName:d,seqNo:a,categoryName:t}),e[n].pcs+=1,e[n].weight=parseFloat((e[n].weight+parseFloat(o||0)).toFixed(2))),e},{});eH.setFieldValue("itemGridData",Object.values(n).sort((e,l)=>e.seqNo-l.seqNo))}},[null==eH?void 0:null===(Q=eH.values)||void 0===Q?void 0:Q.serials]);let{subTotal:lt,vatAmount:lr,weight:ls,amount:lu}=null==eH?void 0:null===(ee=eH.values)||void 0===ee?void 0:null===(Y=ee.serials)||void 0===Y?void 0:Y.reduce((e,l)=>{var i,a,n,d;let o=parseFloat(null==l?void 0:l.unitPrice)||0,t=parseFloat(null==l?void 0:l.vatAmount)||0,r=parseFloat(null==l?void 0:l.weight)||0;return{subTotal:eO?parseFloat(((null==e?void 0:e.subTotal)+o).toFixed(2)):(null===(i=eH.values)||void 0===i?void 0:i.subTotal)||0,vatAmount:eO?parseFloat(((null==e?void 0:e.vatAmount)+t).toFixed(2)):(null===(a=eH.values)||void 0===a?void 0:a.vatAmount)||0,weight:eO?(null==e?void 0:e.weight)+r:(null===(n=eH.values)||void 0===n?void 0:n.weight)||0,amount:eO?parseFloat(((null==e?void 0:e.subTotal)+o+(null==e?void 0:e.vatAmount)+t).toFixed(2)):(null===(d=eH.values)||void 0===d?void 0:d.amount)||0}},{subTotal:0,vatAmount:0,weight:0,amount:0});async function lc(){var e,l,i,a,n,d,o;if(!await lv())return;let t=[...eH.values.serials],r=await eZ({extension:N.P.LastSerialInvoice.import,parameters:"_invoiceId=".concat(null==eH?void 0:null===(e=eH.values)||void 0===e?void 0:e.invoiceId)}),s=t.length?t[t.length-1].id:0;if(r.count>0){for(let e of(t=t.filter(e=>e.srlNo),r.list)){let u={srlNo:e.srlNo,itemId:e.itemId,sku:e.sku,itemName:e.itemName,invoiceReference:null==eH?void 0:null===(l=eH.values)||void 0===l?void 0:l.invoiceRef,invoiceTrxId:e.trxId,invoiceSeqNo:e.seqNo,invoiceComponentSeqNo:e.componentSeqNo,weight:e.weight,metalId:e.metalId,baseLaborPrice:e.laborPrice,unitPrice:e.unitPrice,vatAmount:e.vatAmount,metalRef:e.metalRef,categoryName:e.categoryName,seqNo:s+1,id:s+1,...(null==r?void 0:null===(i=r.record)||void 0===i?void 0:i.taxId)&&{taxId:(null===(a=eH.values)||void 0===a?void 0:a.taxId)||(null==r?void 0:null===(n=r.record)||void 0===n?void 0:n.taxId)}},{unitPrice:c,baseLaborPrice:v}=e$(u,q.Xf);u.unitPrice=c,u.baseLaborPrice=v,null!=u.taxId&&(u.extendedPrice=c);let{taxDetailsStore:m,metalGridData:p,itemGridData:I,...x}=null==eH?void 0:eH.values;((null==eH?void 0:null===(d=eH.values)||void 0===d?void 0:d.recordId)||t.length>0?await e1(x,u,null==t?void 0:null===(o=t[0])||void 0===o?void 0:o.returnId):await e6(u,"import"))&&(s++,eH.setFieldValue("serials",[...t,u]),t.push(u))}u.ZP.success(eV.Saved)}}async function lv(){if(Object.keys(await eH.validateForm()).length){let e=Object.keys(await eH.validateForm()).reduce((e,l)=>(eH.touched[l]||(e[l]=!0),e),{});return Object.keys(e).length&&eH.setTouched(e,!0),!1}return!0}return(0,t.useEffect)(()=>{eH.setFieldValue("subTotal",lt),eH.setFieldValue("vatAmount",lr),eH.setFieldValue("weight",ls),eH.setFieldValue("amount",lu)},[ls,lt,lr,lu]),(0,t.useEffect)(()=>{!async function(){var e,l;eW||eA({message:ew.noSelectedplId}),eX(),(null==eH?void 0:null===(e=eH.values)||void 0===e?void 0:e.recordId)&&await eB(null==eH?void 0:null===(l=eH.values)||void 0===l?void 0:l.recordId)}()},[]),(0,a.jsx)(s.Z,{resourceId:v.i.DraftSerialReturns,functionId:h.J.DraftInvoiceReturn,form:eH,maxAccess:eT,previewReport:eK,isClosed:eQ,actions:le,editMode:eK,disabledSubmit:eQ&&!eK,disabledSavedClear:eQ&&!eK,children:(0,a.jsxs)(b.R,{children:[(0,a.jsx)(w.g,{children:(0,a.jsxs)(o.ZP,{container:!0,spacing:2,children:[(0,a.jsx)(o.ZP,{item:!0,xs:4,children:(0,a.jsx)(I.Z,{endpointId:x.r.DocumentType.qry,parameters:"_startAt=0&_pageSize=1000&_dgId=".concat(h.J.DraftInvoiceReturn),name:"dtId",label:ew.documentType,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],readOnly:eK,required:!0,valueField:"recordId",displayField:["reference","name"],values:eH.values,maxAccess:eT,onChange:async(e,l)=>{eH.setFieldValue("dtId",null==l?void 0:l.recordId),await lo(null==l?void 0:l.recordId),eL(l)},error:eH.touched.dtId&&!!eH.errors.dtId})}),(0,a.jsx)(o.ZP,{item:!0,xs:4,children:(0,a.jsx)(I.Z,{endpointId:f.$.Site.qry,name:"siteId",readOnly:eQ,label:ew.site,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:eH.values,required:!0,valueField:"recordId",displayField:["reference","name"],maxAccess:eT,onChange:(e,l)=>{(null==l?void 0:l.isInactive)?(eH.setFieldValue("siteId",null),eA({message:ew.inactiveSite})):eH.setFieldValue("siteId",(null==l?void 0:l.recordId)||null)},error:eH.touched.siteId&&!!eH.errors.siteId})}),(0,a.jsx)(o.ZP,{item:!0,xs:2,children:(0,a.jsx)(I.Z,{endpointId:x.r.Currency.qry,name:"currencyId",filter:e=>1===e.currencyType,label:ew.currency,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],required:!0,readOnly:eK,values:eH.values,maxAccess:eT,onChange:(e,l)=>{eH.setFieldValue("invoiceId",null),eH.setFieldValue("invoiceRef",""),eH.setFieldValue("currencyId",(null==l?void 0:l.recordId)||null)},error:eH.touched.currencyId&&!!eH.errors.currencyId})}),(0,a.jsx)(o.ZP,{item:!0,xs:2,children:(0,a.jsx)(m.Z,{name:"search",value:eH.values.search,label:eV.Search,onClear:()=>{eH.setFieldValue("search","")},onChange:e=>{let{value:l}=e.target;eH.setFieldValue("search",l)},onSearch:e=>eH.setFieldValue("search",e),search:!0})}),(0,a.jsx)(o.ZP,{item:!0,xs:12,children:(0,a.jsxs)(o.ZP,{container:!0,spacing:2,children:[(0,a.jsx)(o.ZP,{item:!0,xs:4,children:(0,a.jsx)(m.Z,{name:"reference",label:ew.reference,value:null==eH?void 0:null===(el=eH.values)||void 0===el?void 0:el.reference,maxAccess:!eK&&eT,readOnly:eK,onChange:eH.handleChange,onClear:()=>eH.setFieldValue("reference",""),error:eH.touched.reference&&!!eH.errors.reference})}),(0,a.jsx)(o.ZP,{item:!0,xs:4,children:(0,a.jsx)(I.Z,{endpointId:x.r.Plant.qry,name:"plantId",label:ew.plant,readOnly:!0,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:eH.values,valueField:"recordId",displayField:["reference","name"],maxAccess:eT,onChange:(e,l)=>{eH.setFieldValue("plantId",null==l?void 0:l.recordId)},error:eH.touched.plantId&&!!eH.errors.plantId})}),(0,a.jsx)(o.ZP,{item:!0,xs:4,children:(0,a.jsx)(I.Z,{endpointId:(null==eH?void 0:null===(ei=eH.values)||void 0===ei?void 0:ei.clientId)&&N.P.Contact.contact,parameters:"_clientId=".concat(eH.values.clientId),name:"contactId",label:ew.contact,readOnly:eQ,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:eH.values,valueField:"recordId",displayField:["reference","name"],maxAccess:eT,onChange:(e,l)=>{eH.setFieldValue("contactId",l?l.recordId:null)},error:eH.touched.contactId&&!!eH.errors.contactId})}),(0,a.jsx)(o.ZP,{item:!0,xs:4,children:(0,a.jsx)(n.Z,{name:"date",required:!0,label:ew.postingDate,value:null==eH?void 0:null===(ea=eH.values)||void 0===ea?void 0:ea.date,onChange:(e,l)=>{eH.setFieldValue("date",l),eH.setFieldValue("invoiceId",null),eH.setFieldValue("invoiceRef","")},editMode:eK,readOnly:eQ,maxAccess:eT,onClear:()=>eH.setFieldValue("date",""),error:eH.touched.date&&!!eH.errors.date})}),(0,a.jsx)(o.ZP,{item:!0,xs:4,children:(0,a.jsx)(I.Z,{endpointId:N.P.SalesPerson.qry,name:"spId",required:!0,label:ew.salesPerson,columnsInDropDown:[{key:"spRef",value:"Reference"},{key:"name",value:"Name"}],readOnly:eQ,valueField:"recordId",displayField:"name",values:eH.values,onChange:(e,l)=>{eH.setFieldValue("spId",l?l.recordId:null)},error:eH.touched.spId&&!!eH.errors.spId})}),(0,a.jsx)(o.ZP,{item:!0,xs:4,children:(0,a.jsx)(I.Z,{endpointId:j.H.TaxSchedules.qry,name:"taxId",label:ew.tax,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],readOnly:!0,values:eH.values,maxAccess:eT,onChange:(e,l)=>{eH.setFieldValue("taxId",(null==l?void 0:l.recordId)||null)},error:eH.touched.taxId&&!!eH.errors.taxId})})]})}),(0,a.jsx)(o.ZP,{item:!0,xs:8,children:(0,a.jsxs)(o.ZP,{container:!0,spacing:2,children:[(0,a.jsx)(o.ZP,{item:!0,xs:12,children:(0,a.jsx)(y.U,{endpointId:N.P.Client.snapshot,filter:{isInactive:!1},valueField:"reference",displayField:"name",secondFieldLabel:ew.name,name:"clientId",label:ew.client,form:eH,required:!0,readOnly:eQ,displayFieldWidth:2,firstFieldWidth:3,valueShow:"clientRef",secondValueShow:"clientName",maxAccess:eT,editMode:eK,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"},{key:"szName",value:"Sales Zone"},{key:"keywords",value:"Keywords"},{key:"cgName",value:"Client Group"}],onChange:async(e,l)=>{eH.setFieldValue("clientName",(null==l?void 0:l.name)||null),eH.setFieldValue("clientRef",(null==l?void 0:l.reference)||null),eH.setFieldValue("accountId",(null==l?void 0:l.accountId)||null),eH.setFieldValue("isVattable",(null==l?void 0:l.isSubjectToVAT)||!1),eH.setFieldValue("taxId",(null==l?void 0:l.taxId)||null),eH.setFieldValue("invoiceId",null),eH.setFieldValue("invoiceRef",""),eH.setFieldValue("clientId",(null==l?void 0:l.recordId)||null)},errorCheck:"clientId"})}),(0,a.jsx)(o.ZP,{item:!0,xs:5.2,children:(0,a.jsx)(I.Z,{endpointId:(null==eH?void 0:null===(en=eH.values)||void 0===en?void 0:en.clientId)&&(null==eH?void 0:null===(ed=eH.values)||void 0===ed?void 0:ed.date)&&N.P.ReturnOnInvoice.balance,parameters:"_clientId=".concat(null==eH?void 0:null===(eo=eH.values)||void 0===eo?void 0:eo.clientId,"&_returnDate=").concat(null==eH?void 0:null===(er=eH.values)||void 0===er?void 0:null===(et=er.date)||void 0===et?void 0:et.toISOString()),filter:e=>{var l;return e.currencyId==(null==eH?void 0:null===(l=eH.values)||void 0===l?void 0:l.currencyId)},name:"invoiceId",label:ew.salesInv,valueField:"recordId",displayField:"reference",displayFieldWidth:1,readOnly:eQ,values:eH.values,maxAccess:eT,onChange:(e,l)=>{eH.setFieldValue("invoiceId",(null==l?void 0:l.recordId)||null),eH.setFieldValue("invoiceRef",(null==l?void 0:l.reference)||"")},error:eH.touched.invoiceId&&!!eH.errors.invoiceId},"".concat(eH.values.clientId,"-").concat(null===(es=eH.values.date)||void 0===es?void 0:es.toISOString(),"-").concat(eH.values.currencyId))}),(0,a.jsx)(o.ZP,{item:!0,xs:1,children:(0,a.jsx)(L.Z,{onClick:lc,label:eV.import,image:"import.png",color:"#000",disabled:!(null==eH?void 0:null===(eu=eH.values)||void 0===eu?void 0:eu.invoiceId)||eQ})}),(0,a.jsx)(o.ZP,{item:!0,xs:5.8,children:(0,a.jsx)(I.Z,{endpointId:N.P.ReturnReasons.qry,name:"returnReasonId",label:ew.reason,valueField:"recordId",displayField:"name",readOnly:eQ,values:eH.values,maxAccess:eT,onChange:(e,l)=>{eH.setFieldValue("returnReasonId",(null==l?void 0:l.recordId)||null)},error:eH.touched.returnReasonId&&!!eH.errors.returnReasonId})})]})}),(0,a.jsx)(o.ZP,{item:!0,xs:4,children:(0,a.jsx)(p.Z,{name:"description",label:ew.description,value:eH.values.description,rows:2.4,editMode:eK,readOnly:eQ,maxAccess:eT,onChange:e=>eH.setFieldValue("description",e.target.value),onClear:()=>eH.setFieldValue("description",""),error:eH.touched.description&&!!eH.errors.description})})]})}),(0,a.jsx)(g.Q,{children:(0,a.jsx)(F._,{onChange:(e,l,i)=>ld(e,l,i),value:ln||[],error:eH.errors.serials,initialValues:null==eH?void 0:null===(ev=eH.initialValues)||void 0===ev?void 0:null===(ec=ev.serials)||void 0===ec?void 0:ec[0],columns:e8,name:"serials",maxAccess:eT,disabled:eQ||Object.entries((null==eH?void 0:eH.errors)||{}).filter(e=>{let[l]=e;return"serials"!==l}).length>0,allowDelete:!eQ,allowAddNewLine:!(null==eH?void 0:null===(em=eH.values)||void 0===em?void 0:em.search)&&((null===(eI=eH.values)||void 0===eI?void 0:null===(ep=eI.serials)||void 0===ep?void 0:ep.length)===0||!!(null===(eg=eH.values)||void 0===eg?void 0:null===(ey=eg.serials)||void 0===ey?void 0:null===(ex=ey[(null===(eh=eH.values)||void 0===eh?void 0:null===(ef=eh.serials)||void 0===ef?void 0:ef.length)-1])||void 0===ex?void 0:ex.srlNo)),autoDelete:e2,onValidationRequired:lv})}),(0,a.jsxs)(o.ZP,{container:!0,spacing:2,children:[(0,a.jsx)(o.ZP,{item:!0,xs:6.5,sx:{display:"flex",flex:1},children:(0,a.jsx)(D.Z,{name:"item",columns:[{field:"seqNo",headerName:ew.seqNo,type:"number",flex:.75},{field:"sku",headerName:ew.sku,flex:1},{field:"itemName",headerName:ew.itemDesc,flex:2},{field:"categoryName",headerName:ew.category,flex:2},{field:"pcs",headerName:ew.pcs,type:"number",flex:1},{field:"weight",headerName:ew.weight,type:"number",flex:1}],gridData:{count:1,list:null==eH?void 0:null===(eF=eH.values)||void 0===eF?void 0:eF.itemGridData},rowId:["sku"],maxAccess:eP,pagination:!1})}),(0,a.jsx)(o.ZP,{item:!0,xs:3,sx:{display:"flex",flex:1},children:(0,a.jsx)(D.Z,{name:"metal",gridData:{count:1,list:null==eH?void 0:null===(eb=eH.values)||void 0===eb?void 0:eb.metalGridData},maxAccess:eP,columns:[{field:"metal",headerName:ew.metal,flex:1},{field:"pcs",headerName:ew.pcs,type:"number",flex:1},{field:"totalWeight",headerName:ew.totalWeight,type:"number",flex:1}],rowId:["metal"],pagination:!1})}),(0,a.jsx)(o.ZP,{item:!0,xs:.5}),(0,a.jsx)(o.ZP,{item:!0,xs:2,children:(0,a.jsxs)(o.ZP,{container:!0,spacing:2,children:[(0,a.jsx)(o.ZP,{item:!0,xs:12}),(0,a.jsx)(o.ZP,{item:!0,xs:12,children:(0,a.jsx)(P.Z,{name:"weight",maxAccess:eT,label:ew.totalWeight,value:ls,readOnly:!0})}),(0,a.jsx)(o.ZP,{item:!0,xs:12}),(0,a.jsx)(o.ZP,{item:!0,xs:12,children:(0,a.jsx)(P.Z,{name:"subTotal",maxAccess:eT,label:ew.subtotal,value:lt,readOnly:!0})}),(0,a.jsx)(o.ZP,{item:!0,xs:12,children:(0,a.jsx)(P.Z,{name:"vatAmount",maxAccess:eT,label:ew.vat,value:lr,readOnly:!0})}),(0,a.jsx)(o.ZP,{item:!0,xs:12,children:(0,a.jsx)(P.Z,{name:"total",maxAccess:lu,label:ew.total,value:lu,readOnly:!0})})]})})]})]})})}},81330:function(e,l,i){"use strict";i.d(l,{Z:function(){return F}});var a=i(52322),n=i(2784),d=i(60218),o=i(31389),t=i(5088),r=i(21581),s=i(78711),u=i(19473),c=i(23361),v=i(21326);let m=e=>{let{window:l,onConfirm:i,fullScreen:d,open:o,dialogText:t}=e,{platformLabels:r}=(0,n.useContext)(u.l);return(0,v.Z)({title:r.import,window:l}),(0,a.jsx)(c.Z,{open:(null==o?void 0:o.flag)||!1,DialogText:t,okButtonAction:()=>{"function"==typeof i&&i(),l.close()},fullScreen:d,cancelButtonAction:()=>l.close(),height:"140px"})};m.width=470,m.height=170;var p=i(61802),I=i(65950),x=i(62202),f=i(62362),h=i(69627),y=i(54074);let g=e=>{var l,i;let{endPoint:c,header:g,onCloseimport:F,maxAccess:b,window:w}=e,{stack:P}=(0,p.zY)(),{platformLabels:N}=(0,n.useContext)(u.l),j=(0,n.useRef)(null),[Z,k]=(0,n.useState)(null),[C,A]=(0,n.useState)([]),{postRequest:V}=(0,n.useContext)(I.$);(0,v.Z)({title:N.importSerials,window:w});let S=(0,s.TA)({initialValues:{serials:"",serialCount:0}}),D=e=>{let l=e.split("\n").filter(e=>""!==e.trim()).length;S.setFieldValue("serialCount",l)},R=async()=>{P({Component:m,props:{open:{flag:!0},fullScreen:!1,onConfirm:O,dialogText:N.importConfirmation}})},O=async()=>{var e;let l=null===(e=S.values.serials)||void 0===e?void 0:e.replace(/\n/g,",\r\n"),i={...g,serials:l||C};await V({extension:c,record:JSON.stringify(i)}),x.ZP.success(N.Imported),F(),w.close()},q=[{key:"Import",condition:!0,onClick:R,disabled:!(null==Z?void 0:Z.name)&&!(null==S?void 0:null===(l=S.values)||void 0===l?void 0:l.serials)}];return(0,a.jsx)(y.Z,{actions:q,onSave:()=>R(),disabledSubmit:!(null==Z?void 0:Z.name)&&!(null==S?void 0:null===(i=S.values)||void 0===i?void 0:i.serials),isSaved:!1,children:(0,a.jsxs)(o.R,{children:[(0,a.jsx)(f.Q,{children:(0,a.jsxs)(d.ZP,{container:!0,spacing:2,children:[(0,a.jsx)(d.ZP,{item:!0,xs:7,children:(0,a.jsx)(t.Z,{name:"name",label:N.SelectCSV,value:null==Z?void 0:Z.name,disabled:S.values.serials||!!(null==Z?void 0:Z.name),readOnly:!0,maxAccess:b})}),(0,a.jsx)(d.ZP,{item:!0,xs:3,children:(0,a.jsx)(h.Z,{onClick:()=>{j.current.click()},label:"".concat(N.Browse,"..."),color:"primary",disabled:!!(null==Z?void 0:Z.name)||S.values.serials})}),(0,a.jsx)(d.ZP,{item:!0,xs:2,children:(0,a.jsx)(h.Z,{image:"clear.png",onClick:()=>{k(null),A([]),j.current.value=null},label:N.Clear,color:"#f44336"})}),(0,a.jsxs)(d.ZP,{item:!0,xs:12,children:[S.values.serialCount>0&&(0,a.jsxs)("label",{style:{marginBottom:"8px",display:"block"},maxAccess:b,children:[N.serials," ( ",S.values.serialCount," )"]}),(0,a.jsx)(r.Z,{name:"serials",label:N.serials,value:S.values.serials,rows:3,readOnly:null==Z?void 0:Z.name,onChange:e=>{S.setFieldValue("serials",e.target.value),D(e.target.value)},onClear:()=>{S.setFieldValue("serials",""),S.setFieldValue("serialCount",0)},error:S.touched.serials&&!!S.errors.serials,maxAccess:b})]})]})}),(0,a.jsx)("input",{type:"file",accept:".csv",ref:j,style:{display:"none"},onChange:e=>{let l=e.target.files[0];if(k(l),l){let e=new FileReader;e.onload=e=>{A(e.target.result)},e.readAsText(l)}}})]})})};g.width=550,g.height=270;var F=g},39704:function(e,l,i){"use strict";var a=i(52322),n=i(2784),d=i(22341),o=i(65950),t=i(85325),r=i(21326),s=i(19473),u=i(35656),c=i(24868),v=i.n(c);let m=e=>{let{functionId:l,recordId:i,window:c}=e,{getRequest:m}=(0,n.useContext)(o.$),{languageId:p}=(0,n.useContext)(t.V),{platformLabels:I}=(0,n.useContext)(s.l),x=i+"-"+l;(0,r.Z)({title:I.WorkFlow,window:c});let{width:f}=(0,u.d)(),h=f<=1024,y=f>1024&&f<=1280,g=h?10:y?12:14,F=h?75:y?85:95,b=h?15:y?20:25,w=async()=>{var e="_functionId=".concat(l,"&_recordId=").concat(i);let a=await m({extension:d.P.WorkFlow.graph,parameters:e});return null==a?void 0:a.record},P=e=>{let l=[],i=[],a="",n="";return e.objects.forEach(e=>{l.push({functionName:e.functionName,reference:e.reference,date:e.date})}),e.workflow.forEach(l=>{e.objects.forEach(e=>{let i=e.functionName.split(" ").join("\r\n");l.parentId===e.recordId&&l.parentFunctionId===e.functionId&&(a=e.reference+"\r\n"+e.date+"\r\n"+i,l.parentId),l.childId===e.recordId&&l.childFunctionId===e.functionId&&(n=e.reference+"\r\n"+e.date+"\r\n"+i,l.childId)}),""===a||""===n||i.push({from:a,to:n,value:1,labelText:""}),a="",n=""}),i};return(0,n.useEffect)(()=>{!async function(){var e=await w();if(e){let l=(e,l)=>{let i=document.createElement("script");i.type="text/javascript",i.src=e,i.async=!0,i.onload=l,document.head.appendChild(i)};l("https://cdn.amcharts.com/lib/4/core.js",()=>{l("https://cdn.amcharts.com/lib/4/charts.js",()=>{l("https://cdn.amcharts.com/lib/4/themes/animated.js",()=>{am4core.ready(()=>{let l=am4core.create(x,am4charts.SankeyDiagram),i=P(e);l.data=i,l.dataFields.fromName="from",l.dataFields.toName="to",l.dataFields.value="value",l.paddingRight=2===p?0:40,l.paddingLeft=2===p?40:0,l.tooltip.label.fontSize=g;let a=l.nodes.template;a.draggable=!1,a.inert=!0,a.clickable=!1,a.width=F,a.height=b,a.nameLabel.label.fontSize=g,a.nameLabel.locationX=2===p?.85:0,a.nameLabel.height=void 0,a.nameLabel.label.fontWeight="bold";let n=l.links.template;n.middleLine.strokeOpacity=.3,n.middleLine.stroke=am4core.color("#555"),n.middleLine.strokeWidth=5,n.middleLine.hoverable=!1,n.fillOpacity=0,n.hoverable=!0,n.hoverOnFocus=!0,n.fill=am4core.color("#A8C686"),n.isHover=!0,l.appear(1e3,100)})})})})}}()},[]),(0,a.jsx)("div",{id:x,className:v().root})};m.width=950,l.Z=m},24868:function(e){e.exports={root:"WorkFlow_root__EINm1"}}}]);