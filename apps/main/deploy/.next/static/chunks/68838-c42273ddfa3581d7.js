(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[68838],{68838:function(e,l,t){"use strict";t.d(l,{Z:function(){return B}});var a=t(52322),n=t(89330),d=t(39812),i=t(60218),o=t(2784),r=t(48601),u=t(82737),s=t(62202),c=t(65950),v=t(71987),m=t(26612),p=t(5088),y=t(21581),x=t(8661),h=t(38449),F=t(65215),I=t(7121),f=t(27423),P=t(62362),b=t(76399),g=t(31389),D=t(33625),V=t(91406),A=t(25870),w=t(80983),j=t(39704),q=t(61802),k=t(19473),Z=t(86626),C=t(18996),T=t(16096),O=t(96026),R=t(98345),N=t(19689),S=t(67920),_=t(2454),Q=t(69627),L=t(84100),M=t(19568),E=t(21326),W=t(50023);function B(e){var l,B,X,J,$,z,H,U,K,Y,G,ee,el,et,ea,en,ed,ei,eo,er,eu,es,ec,ev,em,ep;let{recordId:ey,window:ex}=e,{getRequest:eh,postRequest:eF}=(0,o.useContext)(c.$),{stack:eI}=(0,q.zY)(),{stack:ef}=(0,O.V)(),{platformLabels:eP,defaultsData:eb,userDefaultsData:eg}=(0,o.useContext)(k.l),[eD,eV]=(0,o.useState)({text:"%",value:2}),eA=(0,o.useRef)([]),[ew,ej]=(0,o.useState)([]),[eq,ek]=(0,o.useState)(!1),eZ=parseInt(null==eg?void 0:null===(B=eg.list)||void 0===B?void 0:null===(l=B.find(e=>{let{key:l}=e;return"plantId"===l}))||void 0===l?void 0:l.value),eC=parseInt(null==eb?void 0:null===(J=eb.list)||void 0===J?void 0:null===(X=J.find(e=>{let{key:l}=e;return"currencyId"===l}))||void 0===X?void 0:X.value),{labels:eT,access:eO}=(0,W.Z)({datasetId:m.i.PurchaseQuotations,editMode:!!ey});(0,E.Z)({title:eT.quotations,window:ex});let{documentType:eR,maxAccess:eN,changeDT:eS}=(0,R.H)({functionId:I.J.PurchaseQuotation,access:eO,enabled:!ey}),e_={recordId:null,dtId:null,reference:"",status:1,date:new Date,plantId:eZ,vendorId:null,vendorRef:"",vendorName:"",deliveryMethodId:null,currencyId:eC,vendorDocRef:null,subtotal:0,tdPct:0,tdAmount:0,tdType:2,paymentMethod:null,miscAmount:0,amount:0,description:"",isVattable:!1,vatAmount:0,qty:0,mdValue:0,mdPct:0,deliveryDate:null,weight:0,volume:0,items:[{id:1,quotationId:ey||0,itemId:null,sku:"",itemName:"",seqNo:1,siteId:null,muId:null,qty:0,volume:0,weight:1,msId:0,muQty:0,baseQty:0,mdType:1,basePrice:0,mdValue:0,unitPrice:0,vatAmount:0,mdAmount:0,upo:0,extendedPrice:0,mdAmountPct:null,priceType:1,applyVat:!1,taxId:null,taxDetails:null,notes:null}]},eQ=(0,v.E)({endpointId:_.y.PurchaseQuotation.page}),{schema:eL,requiredFields:eM}=(0,S.m)({sku:e=>null==e?void 0:e.sku,qty:e=>(null==e?void 0:e.qty)>0},!0,eN,"items"),{formik:eE}=(0,w.c)({maxAccess:eN,documentType:{key:"dtId",value:null==eR?void 0:eR.dtId,reference:null==eR?void 0:eR.reference},conditionSchema:["items"],initialValues:e_,validateOnChange:!0,validationSchema:r.Ry({currencyId:r.Rx().required(),vendorId:r.Rx().required(),date:r.hT().required(),items:r.IX().of(eL)}),onSubmit:async e=>{let l={...e,date:(0,d.ku)(e.date),deliveryDate:e.deliveryDate?(0,d.ku)(e.deliveryDate):null,miscAmount:e.miscAmount||0};delete l.items;let t=e.items.filter(e=>{var l;return null===(l=Object.values(eM))||void 0===l?void 0:l.every(l=>l(e))}).map((l,t)=>({...l,seqNo:t+1,deliveryDate:(null==l?void 0:l.deliveryDate)?(0,d.ku)(l.deliveryDate):null,lastPurchaseDate:(null==l?void 0:l.lastPurchaseDate)?(0,d.ku)(l.lastPurchaseDate):null,applyVat:e.isVattable||!1})),a=await eF({extension:_.y.PurchaseQuotation.set2,record:JSON.stringify({header:l,items:t})});s.ZP.success(e.recordId?eP.Edited:eP.Added),await ld(a.recordId),eQ()}}),eW=!!eE.values.recordId,eB=1==eE.values.status;async function eX(e){var l,t;let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!e)return;let n=null===(t=eE.values.items)||void 0===t?void 0:null===(l=t.find(l=>parseInt(l.itemId)===e))||void 0===l?void 0:l.msId,d=n||a||n,i=(null==ew?void 0:ew.filter(e=>e.msId==d))||[];eA.current=i}let eJ=[{component:"resourcelookup",label:eT.sku,name:"sku",flex:2,props:{endpointId:F.$.Item.snapshot,parameters:{_categoryId:0,_msId:0,_startAt:0,_size:1e3},displayField:"sku",valueField:"sku",mapping:[{from:"recordId",to:"itemId"},{from:"sku",to:"sku"},{from:"name",to:"itemName"}],columnsInDropDown:[{key:"sku",value:"SKU"},{key:"name",value:"Item Name"},{key:"flName",value:"FL Name"}],displayFieldWidth:5,filter:{purchaseItem:!0}},async onChange(e){var l,t,a,n;let{row:{update:d,newRow:i}}=e;if(!i.itemId)return;let o=await eG(i.itemId),r=await e0(i.itemId),u=null,s=null;if(eE.values.taxId){let e=(await e2(eE.values.taxId)).map(e=>({taxId:eE.values.taxId,taxCodeId:e.taxCodeId,taxBase:e.taxBase,amount:e.amount}));u=eE.values.taxId,s=e}else if(null==r?void 0:r.taxId){let e=(await e2(r.taxId)).map(e=>({taxId:r.taxId,taxCodeId:e.taxCodeId,taxBase:e.taxBase,amount:e.amount}));u=r.taxId,s=e}let c=null==ew?void 0:ew.filter(e=>e.msId===(null==r?void 0:r.msId));eX(null==i?void 0:i.itemId,null==r?void 0:r.msId);let v=null==eA?void 0:null===(l=eA.current)||void 0===l?void 0:l.filter(e=>e.recordId===(null==i?void 0:i.muId));d({volume:parseFloat(null==o?void 0:o.volume)||0,weight:parseFloat((null==o?void 0:o.weight)||0).toFixed(2),vatAmount:parseFloat((null==r?void 0:r.vatPct)||0).toFixed(2),basePrice:0,unitPrice:0,priceType:(null==r?void 0:r.priceType)||1,mdAmount:0,qty:0,msId:null==r?void 0:r.msId,muRef:null==c?void 0:null===(t=c[0])||void 0===t?void 0:t.reference,muId:null==c?void 0:null===(a=c[0])||void 0===a?void 0:a.recordId,mdValue:0,taxId:u,taxDetails:s||null,baseQty:(null==v?void 0:null===(n=v[0])||void 0===n?void 0:n.qty)*(null==i?void 0:i.qty)})}},{component:"textfield",label:eT.itemName,name:"itemName",flex:3,props:{readOnly:!0}},{component:"resourcecombobox",label:eT.mu,name:"muRef",props:{store:null==eA?void 0:eA.current,displayField:"reference",valueField:"recordId",mapping:[{from:"reference",to:"muRef"},{from:"qty",to:"muQty"},{from:"recordId",to:"muId"}]},async onChange(e){var l;let{row:{update:t,newRow:a}}=e,n=null==eA?void 0:eA.current.filter(e=>e.recordId==(null==a?void 0:a.muId));t({baseQty:(null==a?void 0:a.qty)*(null==n?void 0:null===(l=n[0])||void 0===l?void 0:l.qty)})},propsReducer(e){let{row:l,props:t}=e;return{...t,store:null==eA?void 0:eA.current}}},{component:"numberfield",label:eT.quantity,name:"qty",updateOn:"blur",onChange(e){var l;let{row:{update:t,newRow:a}}=e,n=e3(a,Z.bT);eX(null==a?void 0:a.itemId,null==a?void 0:a.msId);let d=null==eA?void 0:eA.current.filter(e=>e.recordId===(null==a?void 0:a.muId));t({...n,baseQty:(null==d?void 0:null===(l=d[0])||void 0===l?void 0:l.qty)*(null==a?void 0:a.qty)})}},{component:"numberfield",label:eT.volume,name:"volume",props:{readOnly:!0}},{component:"numberfield",label:eT.weight,name:"weight",props:{readOnly:!0}},{component:"numberfield",label:eT.baseprice,name:"basePrice",props:{decimalScale:5},updateOn:"blur",async onChange(e){let{row:{update:l,newRow:t}}=e;l(e3(t,Z.yO))}},{component:"textfield",label:eT.requestRef,name:"requestRef",flex:2,props:{readOnly:!0}},{component:"numberfield",label:eT.unitCost,name:"unitPrice",props:{decimalScale:5},updateOn:"blur",async onChange(e){let{row:{update:l,newRow:t}}=e;l(e3(t,Z.Xf))}},{component:"numberfield",label:eT.VAT,name:"vatAmount",props:{readOnly:!0}},{component:"button",name:"taxDetailsButton",props:{onCondition:e=>({imgSrc:e.itemId&&e.taxId?t(54022).default.src:"",hidden:!(e.itemId&&e.taxId)})},label:eT.tax,onClick:(e,l)=>{eI({Component:M.Z,props:{taxId:null==l?void 0:l.taxId,obj:l}})}},{component:"numberfield",label:eT.markdown,name:"mdAmount",updateOn:"blur",flex:2,props:{ShowDiscountIcons:!0,iconsClicked:e$,type:"numeric",iconKey:e=>{let{value:l,data:t}=e;return((null==l?void 0:l.mdType)||(null==t?void 0:t.mdType))===Z.Xo?"%":"123"}},async onChange(e){let{row:{update:l,newRow:t}}=e;l(e3(t,Z.On))}},{component:"numberfield",label:eT.extendedprice,name:"extendedPrice",updateOn:"blur",async onChange(e){let{row:{update:l,newRow:t}}=e;l(e3(t,Z.bh))}},{component:"textfield",label:eT.notes,name:"notes",flex:2},{component:"date",label:eT.deliveryDate,name:"deliveryDate",flex:2}];async function e$(e){let{updateRow:l,value:t,data:a}=e,n=((null==t?void 0:t.mdType)||(null==a?void 0:a.mdType))===Z.Xo?Z.RD:Z.Xo,d=e1(null==t?void 0:t.mdAmount,n);l({id:a.id,changes:{mdAmount:d,mdAmountPct:n,mdType:n},commitOnBlur:!0})}let ez=[{key:"RecordRemarks",condition:!0,onClick:"onRecordRemarks",disabled:!eW},{key:"WorkFlow",condition:!0,onClick:async function(){eI({Component:j.Z,props:{functionId:I.J.PurchaseQuotation,recordId:eE.values.recordId}})},disabled:!eW},{key:"Order",condition:!0,onClick:async function(){let e={...eE.values};delete e.items,e.date=(0,d.ku)(e.date),e.deliveryDate=e.deliveryDate?(0,d.ku)(e.deliveryDate):null,await eF({extension:_.y.GeneratePOPRPack.gen2,record:JSON.stringify(e)}),s.ZP.success(eP.Order),eQ(),ex.close()},disabled:!(eW&&eB)},{key:"Attachment",condition:!0,onClick:"onClickAttachment",disabled:!eW}];async function eH(e,l){var t,a,n,i,o,r,u,s;(null==e?void 0:null===(t=e.record)||void 0===t?void 0:t.tdType)==1||(null==e?void 0:null===(a=e.record)||void 0===a?void 0:a.tdType)==null?eV({text:"123",value:1}):eV({text:"%",value:2});let c=(null==l?void 0:l.list.length)!=0?await Promise.all(null===(n=l.list)||void 0===n?void 0:n.map(async(l,t)=>{var a;let n=(null==e?void 0:null===(a=e.record)||void 0===a?void 0:a.isVattable)?await e2(l.taxId):null;return{...l,id:t+1,basePrice:parseFloat(l.basePrice).toFixed(5),unitPrice:parseFloat(l.unitPrice).toFixed(3),upo:parseFloat(l.upo).toFixed(2),vatAmount:parseFloat(l.vatAmount).toFixed(2),extendedPrice:parseFloat(l.extendedPrice).toFixed(2),deliveryDate:(null==l?void 0:l.deliveryDate)?(0,d.a1)(l.deliveryDate):null,lastPurchaseDate:(null==l?void 0:l.lastPurchaseDate)?(0,d.a1)(l.lastPurchaseDate):null,taxDetails:n}})):eE.values.items;eE.setValues({...e.record,currentDiscount:(null==e?void 0:null===(i=e.record)||void 0===i?void 0:i.tdType)==1||(null==e?void 0:null===(o=e.record)||void 0===o?void 0:o.tdType)==null?null==e?void 0:null===(r=e.record)||void 0===r?void 0:r.tdAmount:null==e?void 0:null===(u=e.record)||void 0===u?void 0:u.tdPct,amount:parseFloat(null==e?void 0:null===(s=e.record)||void 0===s?void 0:s.amount).toFixed(2),items:c})}async function eU(e){var l,t;let a=await eh({extension:_.y.PurchaseQuotation.get,parameters:"_recordId=".concat(e)});return a.record.date=(0,d.a1)(null==a?void 0:null===(l=a.record)||void 0===l?void 0:l.date),a.record.deliveryDate=(0,d.a1)(null==a?void 0:null===(t=a.record)||void 0===t?void 0:t.deliveryDate),a}async function eK(e){return await eh({extension:_.y.QuotationItem.qry,parameters:"_quotationId=".concat(e)})}async function eY(e){eE.setFieldValue("isVattable",(null==e?void 0:e.isTaxable)||!1),eE.setFieldValue("tdAmount",(null==e?void 0:e.tradeDiscount)||0),eE.setFieldValue("currentDiscount",(null==e?void 0:e.tradeDiscount)||0),eE.setFieldValue("tdType",(null==e?void 0:e.tradeDiscount)?2:eE.values.tdType),eE.setFieldValue("taxId",(null==e?void 0:e.taxId)||null),eE.setFieldValue("vendorName",(null==e?void 0:e.name)||""),eE.setFieldValue("vendorRef",(null==e?void 0:e.reference)||""),eE.setFieldValue("vendorId",(null==e?void 0:e.recordId)||null)}async function eG(e){let l=await eh({extension:F.$.ItemPhysProp.get,parameters:"_itemId=".concat(e)});return null==l?void 0:l.record}async function e0(e){let l=await eh({extension:F.$.Item.get,parameters:"_recordId=".concat(e)});return null==l?void 0:l.record}async function e2(e){if(!e)return;let l=await eh({extension:A.H.TaxDetailPack.qry,parameters:"_taxId=".concat(e)});return null==l?void 0:l.list}function e1(e,l){let t=parseFloat(e)||0;return l===Z.Xo?(t<0||t>100)&&(t=0):t<0&&(t=0),t}function e3(e,l,t){var a,n;eq||ek(!0);let d=e1(null==e?void 0:e.mdAmount,null==e?void 0:e.mdType),i=(0,Z.Ch)({priceType:(null==e?void 0:e.priceType)||0,basePrice:parseFloat(null==e?void 0:e.basePrice)||0,volume:parseFloat(null==e?void 0:e.volume)||0,weight:parseFloat(null==e?void 0:e.weight),unitPrice:parseFloat((null==e?void 0:e.unitPrice)||0),upo:parseFloat(null==e?void 0:e.upo)?parseFloat(null==e?void 0:e.upo):0,qty:parseFloat(null==e?void 0:e.qty),extendedPrice:parseFloat(null==e?void 0:e.extendedPrice),mdAmount:d,mdType:null==e?void 0:e.mdType,baseLaborPrice:0,totalWeightPerG:0,mdValue:parseFloat(null==e?void 0:e.mdValue),tdPct:(null==eE?void 0:null===(a=eE.values)||void 0===a?void 0:a.tdPct)||0,dirtyField:l}),o=(0,C.VW)({priceType:null==i?void 0:i.priceType,weight:parseFloat(null==i?void 0:i.weight),basePrice:null==i?void 0:i.basePrice,qty:null==i?void 0:i.qty,extendedPrice:parseFloat(null==i?void 0:i.extendedPrice),baseLaborPrice:null==i?void 0:i.baseLaborPrice,vatAmount:parseFloat(null==i?void 0:i.vatAmount),tdPct:null==eE?void 0:null===(n=eE.values)||void 0===n?void 0:n.tdPct,taxDetails:eE.values.isVattable?e.taxDetails:null}),r={...e,id:null==e?void 0:e.id,qty:(null==i?void 0:i.qty)?parseFloat(null==i?void 0:i.qty).toFixed(2):0,volume:(null==i?void 0:i.volume)?parseFloat(i.volume).toFixed(4):0,weight:parseFloat(null==i?void 0:i.weight).toFixed(2),basePrice:(null==i?void 0:i.basePrice)?parseFloat(i.basePrice).toFixed(5):0,unitPrice:(null==i?void 0:i.unitPrice)?parseFloat(i.unitPrice).toFixed(3):0,extendedPrice:(null==i?void 0:i.extendedPrice)?parseFloat(i.extendedPrice).toFixed(2):0,upo:parseFloat(null==i?void 0:i.upo).toFixed(2),mdValue:null==i?void 0:i.mdValue,mdType:null==i?void 0:i.mdType,mdAmount:(null==i?void 0:i.mdAmount)?parseFloat(i.mdAmount).toFixed(2):0,vatAmount:(null==o?void 0:o.vatAmount)?parseFloat(o.vatAmount).toFixed(2):0};return t?{changes:r}:r}let e6=null===($=eE.values.items)||void 0===$?void 0:$.filter(e=>void 0!==e.itemId).map(e=>({...e,basePrice:parseFloat(e.basePrice)||0,unitPrice:parseFloat(e.unitPrice)||0,upo:parseFloat(e.upo)||0,vatAmount:parseFloat(e.vatAmount)||0,weight:parseFloat(e.weight)||0,volume:parseFloat(e.volume)||0,extendedPrice:parseFloat(e.extendedPrice)||0})),e8=(0,T.Ww)(e6),e5=0==eE.values.miscAmount?0:parseFloat(eE.values.miscAmount),e4=(0,T.Ot)(e6,{totalQty:0,totalWeight:0,totalVolume:0,totalUpo:0,sumVat:0,sumExtended:parseFloat(e8),tdAmount:parseFloat(eE.values.tdAmount),net:0,miscAmount:e5}),e9=eq?null==e4?void 0:e4.totalQty:(null===(z=eE.values)||void 0===z?void 0:z.qty)||0,e7=eq?null==e4?void 0:e4.net:(null===(H=eE.values)||void 0===H?void 0:H.amount)||0,le=eq?null==e4?void 0:e4.totalVolume:(null===(U=eE.values)||void 0===U?void 0:U.volume)||0,ll=eq?null==e4?void 0:e4.totalWeight:(null===(K=eE.values)||void 0===K?void 0:K.weight)||0,lt=eq?e8:(null===(Y=eE.values)||void 0===Y?void 0:Y.subtotal)||0,la=eq?null==e4?void 0:e4.sumVat:(null===(G=eE.values)||void 0===G?void 0:G.vatAmount)||0;function ln(e,l,t,a){!function(e,l,t,a){var n;let d=(0,T.Yi)({tdAmount:parseFloat(a),tdPlain:1==e,tdPct:2==e,tdType:e,subtotal:lt,currentDiscount:a,hiddenTdPct:l,hiddenTdAmount:parseFloat(t),typeChange:e});eE.setFieldValue("tdAmount",(null==d?void 0:d.hiddenTdAmount)?null==d?void 0:null===(n=d.hiddenTdAmount)||void 0===n?void 0:n.toFixed(2):0),eE.setFieldValue("tdType",null==d?void 0:d.tdType),eE.setFieldValue("currentDiscount",(null==d?void 0:d.currentDiscount)||0),eE.setFieldValue("tdPct",(null==d?void 0:d.hiddenTdPct)||0)}(e,l,t,a),eE.values.items.map((e,t)=>{let a=(0,C.VW)({priceType:null==e?void 0:e.priceType,weight:parseFloat(null==e?void 0:e.weight),basePrice:parseFloat(null==e?void 0:e.basePrice),qty:null==e?void 0:e.qty,extendedPrice:parseFloat(null==e?void 0:e.extendedPrice),baseLaborPrice:parseFloat(null==e?void 0:e.baseLaborPrice),vatAmount:parseFloat(null==e?void 0:e.vatAmount),tdPct:l,taxDetails:eE.values.isVattable?e.taxDetails:null});eE.setFieldValue("items[".concat(t,"].vatAmount"),parseFloat(null==a?void 0:a.vatAmount).toFixed(2))})}async function ld(e){let l=await eU(e),t=await eK(e);await eH(l,t)}let li=async()=>await eh({extension:F.$.MeasurementUnit.qry,parameters:"_msId=0"});async function lo(){var e,l,t,a;let n=await lu(null===(e=eE.values)||void 0===e?void 0:e.requestId);if((null==n?void 0:null===(l=n.list)||void 0===l?void 0:l.length)==0){ef({message:eT.noItemsToImport});return}if(null==n?void 0:null===(t=n.list)||void 0===t?void 0:t.every(e=>{var l;return null===(l=eE.values.items)||void 0===l?void 0:l.some(l=>l.requestId===(null==e?void 0:e.trxId)&&l.requestSeqNo===(null==e?void 0:e.seqNo))})){ef({message:eT.allItemsImported});return}let i=await Promise.all(null==n?void 0:null===(a=n.list)||void 0===a?void 0:a.filter(e=>{var l;return!(null===(l=eE.values.items)||void 0===l?void 0:l.some(l=>l.requestId===(null==e?void 0:e.trxId)&&l.requestSeqNo===(null==e?void 0:e.seqNo)))}).map(async e=>{let{unitCost:l,...t}=e,a=await lr({...t,deliveryDate:(null==t?void 0:t.deliveryDate)?(0,d.a1)(t.deliveryDate):null,lastPurchaseDate:(null==t?void 0:t.lastPurchaseDate)?(0,d.a1)(t.lastPurchaseDate):null,requestId:null==t?void 0:t.trxId,requestSeqNo:null==t?void 0:t.seqNo,requestRef:eE.values.requestRef,mdType:1,qty:parseFloat((null==t?void 0:t.qty)||0).toFixed(2),notes:null==t?void 0:t.justification}),n=(0,C.VW)({priceType:null==a?void 0:a.priceType,weight:parseFloat(null==a?void 0:a.weight),basePrice:parseFloat(null==a?void 0:a.basePrice),qty:null==a?void 0:a.qty,extendedPrice:parseFloat(null==a?void 0:a.extendedPrice),baseLaborPrice:parseFloat(null==a?void 0:a.baseLaborPrice),vatAmount:parseFloat(null==a?void 0:a.vatAmount),tdPct:eE.values.tdPct||0,taxDetails:(null==a?void 0:a.taxDetails)||[]});return{...a,vatAmount:parseFloat((null==n?void 0:n.vatAmount)||0).toFixed(2)}})),o=[...eE.values.items||null,...i].filter(e=>null==e?void 0:e.itemId).map((e,l)=>({...e,id:l+1}));eE.setFieldValue("items",o),ek(!0)}async function lr(e){let[l,t]=await Promise.all([e0(null==e?void 0:e.itemId),eG(null==e?void 0:e.itemId)]),a=eE.values.isVattable?await e2(null==l?void 0:l.taxId):null;return{...e,volume:(null==t?void 0:t.volume)||0,weight:(null==t?void 0:t.weight)||0,priceType:(null==t?void 0:t.priceType)||1,vatPct:(null==t?void 0:t.vatpct)||0,basePrice:0,unitPrice:0,extendedPrice:0,mdValue:0,mdAmount:0,msId:(null==l?void 0:l.msId)||null,taxId:(null==l?void 0:l.taxId)||null,baseQty:parseFloat((null==e?void 0:e.baseQty)||(null==e?void 0:e.qty)).toFixed(2),taxDetails:a}}async function lu(e){if(e)return await eh({extension:_.y.RequisitionDetail.qry,parameters:"_trxId=".concat(e)})}return(0,o.useEffect)(()=>{eE.setFieldValue("qty",parseFloat(e9).toFixed(2)),eE.setFieldValue("amount",parseFloat(e7).toFixed(2)),eE.setFieldValue("volume",parseFloat(le).toFixed(4)),eE.setFieldValue("weight",parseFloat(ll).toFixed(2)),eE.setFieldValue("subtotal",parseFloat(lt).toFixed(2)),eE.setFieldValue("vatAmount",parseFloat(la).toFixed(2))},[e9,e7,le,ll,lt,la]),(0,o.useEffect)(()=>{if(eq){let e=parseFloat(eE.values.tdPct)*parseFloat(lt)/100;ln(eE.values.tdType,eE.values.tdPct,e,eE.values.currentDiscount)}},[lt]),(0,o.useEffect)(()=>{!async function(){let e=await li();ej(null==e?void 0:e.list),ey&&await ld(ey)}()},[]),(0,a.jsx)(u.Z,{resourceId:m.i.PurchaseQuotations,functionId:I.J.PurchaseQuotation,form:eE,maxAccess:eN,previewReport:eW,actions:ez,editMode:eW,disabledSubmit:!eB,children:(0,a.jsxs)(g.R,{children:[(0,a.jsx)(D.g,{children:(0,a.jsxs)(i.ZP,{container:!0,spacing:2,children:[(0,a.jsxs)(i.ZP,{container:!0,spacing:2,xs:6,sx:{pt:2},children:[(0,a.jsx)(i.ZP,{item:!0,xs:6,children:(0,a.jsxs)(i.ZP,{container:!0,direction:"column",spacing:2,children:[(0,a.jsx)(i.ZP,{item:!0,children:(0,a.jsx)(x.Z,{endpointId:h.r.DocumentType.qry,parameters:"_startAt=0&_pageSize=1000&_dgId=".concat(I.J.PurchaseQuotation),name:"dtId",label:eT.documentType,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],readOnly:eW,valueField:"recordId",displayField:["reference","name"],values:eE.values,maxAccess:eN,onChange:async(e,l)=>{await eS(l),eE.setFieldValue("dtId",(null==l?void 0:l.recordId)||null)},error:eE.touched.dtId&&!!eE.errors.dtId})}),(0,a.jsx)(i.ZP,{item:!0,children:(0,a.jsx)(p.Z,{name:"reference",label:eT.reference,value:null==eE?void 0:null===(ee=eE.values)||void 0===ee?void 0:ee.reference,maxAccess:!eW&&eN,readOnly:eW,onChange:eE.handleChange,onClear:()=>eE.setFieldValue("reference",null),error:eE.touched.reference&&!!eE.errors.reference})})]})}),(0,a.jsx)(i.ZP,{item:!0,xs:6,children:(0,a.jsxs)(i.ZP,{container:!0,direction:"column",spacing:2,children:[(0,a.jsx)(i.ZP,{item:!0,children:(0,a.jsx)(n.Z,{name:"date",required:!0,label:eT.date,value:null==eE?void 0:null===(el=eE.values)||void 0===el?void 0:el.date,onChange:eE.setFieldValue,readOnly:!eB,max:new Date,maxAccess:eN,onClear:()=>eE.setFieldValue("date",null),error:eE.touched.date&&!!eE.errors.date})}),(0,a.jsx)(i.ZP,{item:!0,children:(0,a.jsx)(x.Z,{endpointId:h.r.Currency.qry,name:"currencyId",label:eT.currency,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],required:!0,readOnly:null==eE?void 0:null===(ea=eE.values)||void 0===ea?void 0:null===(et=ea.items)||void 0===et?void 0:et.some(e=>e.itemId),values:eE.values,maxAccess:eN,onChange:(e,l)=>{eE.setFieldValue("items",eE.initialValues.items),eE.setFieldValue("currencyId",(null==l?void 0:l.recordId)||null)},error:eE.touched.currencyId&&!!eE.errors.currencyId})})]})}),(0,a.jsx)(i.ZP,{item:!0,xs:12,children:(0,a.jsx)(f.U,{endpointId:_.y.Vendor.snapshot,valueField:"reference",displayField:"name",secondFieldLabel:eT.name,name:"vendorId",label:eT.vendor,form:eE,readOnly:null==eE?void 0:null===(ed=eE.values)||void 0===ed?void 0:null===(en=ed.items)||void 0===en?void 0:en.some(e=>e.itemId),displayFieldWidth:2,valueShow:"vendorRef",secondValueShow:"vendorName",maxAccess:eN,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"},{key:"flName",value:"FL Name"}],onChange:(e,l)=>{eY(l)},errorCheck:"vendorId"})}),(0,a.jsx)(i.ZP,{item:!0,xs:6,children:(0,a.jsx)(f.U,{endpointId:_.y.PurchaseRequisition.snapshot,filter:{status:4},valueField:"reference",displayField:"reference",name:"requestRef",label:eT.request,form:eE,readOnly:!eB,secondDisplayField:!1,maxAccess:eN,onChange:async(e,l)=>{eE.setFieldValue("requestRef",null==l?void 0:l.reference),eE.setFieldValue("requestId",null==l?void 0:l.recordId)},errorCheck:"requestId"})}),(0,a.jsx)(i.ZP,{item:!0,xs:2,children:(0,a.jsx)(Q.Z,{onClick:()=>lo(),tooltipText:eP.import,image:"import.png",disabled:!eB||!eE.values.requestId||!eE.values.currencyId||!eE.values.vendorId})})]}),(0,a.jsx)(i.ZP,{item:!0,xs:3,children:(0,a.jsxs)(i.ZP,{container:!0,spacing:2,children:[(0,a.jsx)(i.ZP,{item:!0,xs:12,children:(0,a.jsx)(x.Z,{endpointId:h.r.Plant.qry,name:"plantId",label:eT.plant,readOnly:!eB,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:eE.values,valueField:"recordId",displayField:["reference","name"],maxAccess:eN,onChange:(e,l)=>{eE.setFieldValue("plantId",(null==l?void 0:l.recordId)||null)},displayFieldWidth:2,error:eE.touched.plantId&&!!eE.errors.plantId})}),(0,a.jsx)(i.ZP,{item:!0,xs:12,children:(0,a.jsx)(x.Z,{datasetId:L.v.PAYMENT_METHOD,name:"paymentMethod",readOnly:!eB,label:eT.paymentMethod,valueField:"key",displayField:"value",values:eE.values,onChange:(e,l)=>{eE.setFieldValue("paymentMethod",(null==l?void 0:l.key)||null)},error:(null===(ei=eE.touched)||void 0===ei?void 0:ei.paymentMethod)&&!!(null===(eo=eE.errors)||void 0===eo?void 0:eo.paymentMethod),maxAccess:eN})}),(0,a.jsx)(i.ZP,{item:!0,xs:12,children:(0,a.jsx)(x.Z,{endpointId:A.H.TaxSchedules.qry,name:"taxId",label:eT.tax,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],readOnly:!0,values:eE.values,onChange:(e,l)=>{eE.setFieldValue("taxId",(null==l?void 0:l.recordId)||null)},error:eE.touched.taxId&&!!eE.errors.taxId,maxAccess:eN})}),(0,a.jsx)(i.ZP,{item:!0,xs:12,children:(0,a.jsx)(p.Z,{name:"vendorDocRef",label:eT.vendorDocRef,value:null==eE?void 0:null===(er=eE.values)||void 0===er?void 0:er.vendorDocRef,maxAccess:eN,readOnly:!eB,maxLength:"15",onChange:eE.handleChange,onClear:()=>eE.setFieldValue("vendorDocRef",""),error:eE.touched.vendorDocRef&&!!eE.errors.vendorDocRef})})]})}),(0,a.jsx)(i.ZP,{item:!0,xs:3,children:(0,a.jsxs)(i.ZP,{container:!0,spacing:2,children:[(0,a.jsx)(i.ZP,{item:!0,xs:12,children:(0,a.jsx)(n.Z,{name:"deliveryDate",label:eT.deliveryDate,value:null==eE?void 0:null===(eu=eE.values)||void 0===eu?void 0:eu.deliveryDate,onChange:eE.setFieldValue,readOnly:!eB,maxAccess:eN,onClear:()=>eE.setFieldValue("deliveryDate",null),error:eE.touched.deliveryDate&&!!eE.errors.deliveryDate})}),(0,a.jsx)(i.ZP,{item:!0,xs:12,children:(0,a.jsx)(x.Z,{endpointId:_.y.DeliveryMethods.qry,name:"deliveryMethodId",label:eT.deliveryMethod,readOnly:!eB,valueField:"recordId",displayField:"name",values:eE.values,onChange:(e,l)=>{eE.setFieldValue("deliveryMethodId",(null==l?void 0:l.recordId)||null)},error:(null===(es=eE.touched)||void 0===es?void 0:es.deliveryMethodId)&&!!(null===(ec=eE.errors)||void 0===ec?void 0:ec.deliveryMethodId),maxAccess:eN})}),(0,a.jsx)(i.ZP,{item:!0,xs:12,children:(0,a.jsx)(N.Z,{name:"isVattable",value:null===(ev=eE.values)||void 0===ev?void 0:ev.isVattable,onChange:e=>eE.setFieldValue("isVattable",e.target.checked),label:eT.VAT,disabled:!0,maxAccess:eN})})]})})]})}),(0,a.jsx)(P.Q,{children:(0,a.jsx)(b._,{onChange:(e,l)=>{eE.setFieldValue("items",e),"delete"===l&&ek(!0)},onSelectionChange:(e,l,t)=>{"muRef"==t&&eX(null==e?void 0:e.itemId,null==e?void 0:e.msId)},initialValues:null==eE?void 0:null===(ep=eE.initialValues)||void 0===ep?void 0:null===(em=ep.items)||void 0===em?void 0:em[0],value:eE.values.items,error:eE.errors.items,columns:eJ,name:"items",maxAccess:eN,disabled:!eE.values.vendorId||!eE.values.currencyId||!eB,allowDelete:eB})}),(0,a.jsx)(D.g,{children:(0,a.jsxs)(i.ZP,{container:!0,spacing:2,sx:{pt:2},children:[(0,a.jsx)(i.ZP,{item:!0,xs:6,children:(0,a.jsx)(i.ZP,{item:!0,xs:12,children:(0,a.jsx)(y.Z,{name:"description",label:eT.description,value:eE.values.description,rows:3,readOnly:!eB,maxAccess:eN,onChange:e=>eE.setFieldValue("description",e.target.value),onClear:()=>eE.setFieldValue("description",null),error:eE.touched.description&&!!eE.errors.description})})}),(0,a.jsx)(i.ZP,{item:!0,xs:3,children:(0,a.jsxs)(i.ZP,{container:!0,spacing:2,children:[(0,a.jsx)(i.ZP,{item:!0,xs:12,children:(0,a.jsx)(V.Z,{name:"totalVolume",maxAccess:eN,label:eT.totVolume,value:le,readOnly:!0})}),(0,a.jsx)(i.ZP,{item:!0,xs:12,children:(0,a.jsx)(V.Z,{name:"totalQTY",label:eT.totQty,value:e9,readOnly:!0})})]})}),(0,a.jsx)(i.ZP,{item:!0,xs:3,children:(0,a.jsxs)(i.ZP,{container:!0,spacing:2,children:[(0,a.jsx)(i.ZP,{item:!0,xs:12,children:(0,a.jsx)(V.Z,{name:"subTotal",maxAccess:eN,label:eT.subtotal,value:lt,readOnly:!0})}),(0,a.jsx)(i.ZP,{item:!0,xs:12,children:(0,a.jsx)(V.Z,{name:"discount",maxAccess:eN,label:eT.discount,value:eE.values.currentDiscount,displayCycleButton:!0,readOnly:!eB,iconKey:eD.text,cycleButtonLabel:eD.text,decimalScale:2,handleButtonClick:()=>{let e,l,t;ek(!0),1==eD.value?(e=parseFloat(l=eE.values.currentDiscount<0||eE.values.currentDiscount>100?0:eE.values.currentDiscount)*parseFloat(lt)/100,t=l,eE.setFieldValue("tdAmount",e),eE.setFieldValue("tdPct",l),eE.setFieldValue("currentDiscount",l)):(l=parseFloat(e=eE.values.currentDiscount<0||lt<eE.values.currentDiscount?0:eE.values.currentDiscount)/parseFloat(lt)*100,t=e,eE.setFieldValue("tdPct",l),eE.setFieldValue("tdAmount",e),eE.setFieldValue("currentDiscount",e)),eV(a=>{let n="%"===a.text?{text:"123",value:1}:{text:"%",value:2};return eE.setFieldValue("tdType",n.value),ln(n.value,l,e,t),n})},ShowDiscountIcons:!0,onChange:e=>{let l=Number(e.target.value.replace(/,/g,""));1==eE.values.tdType?((l<0||lt<l)&&(l=0),eE.setFieldValue("tdAmount",l)):((l<0||l>100)&&(l=0),eE.setFieldValue("tdPct",l)),eE.setFieldValue("currentDiscount",l)},onBlur:async e=>{ek(!0);let l=Number(e.target.value.replace(/,/g,"")),t=Number(e.target.value.replace(/,/g,"")),a=Number(e.target.value.replace(/,/g,""));1==eE.values.tdType&&(t=parseFloat(l)/parseFloat(lt)*100,eE.setFieldValue("tdPct",t)),2==eE.values.tdType&&(a=parseFloat(l)*parseFloat(lt)/100,eE.setFieldValue("tdAmount",a)),ln(eE.values.tdType,t,a,l)},onClear:()=>{eE.setFieldValue("tdAmount",0),eE.setFieldValue("tdPct",0),ln(eE.values.tdType,0,0,0)}})}),(0,a.jsx)(i.ZP,{item:!0,xs:12,children:(0,a.jsx)(V.Z,{name:"miscAmount",maxAccess:eN,label:eT.misc,value:eE.values.miscAmount||0,decimalScale:2,readOnly:!eB,onChange:e=>eE.setFieldValue("miscAmount",e.target.value),onBlur:async()=>{ek(!0)},onClear:()=>{eE.setFieldValue("miscAmount",0)}})}),(0,a.jsx)(i.ZP,{item:!0,xs:12,children:(0,a.jsx)(V.Z,{name:"vatAmount",maxAccess:eN,label:eT.VAT,value:la,readOnly:!0})}),(0,a.jsx)(i.ZP,{item:!0,xs:12,children:(0,a.jsx)(V.Z,{name:"amount",maxAccess:eN,label:eT.net,value:e7,readOnly:!0})})]})})]})})]})})}B.width=1300,B.height=730},67920:function(e,l,t){"use strict";t.d(l,{m:function(){return n}});var a=t(48601);function n(e,l,t){var n;let d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"items",i={...e};return null==t||null===(n=t.record)||void 0===n||n.controls.forEach(e=>{let{controlId:l,accessLevel:t}=e,[a,n]=null==l?void 0:l.split(".");a!==d||2!==t||n in i||(i[n]=e=>(null==e?void 0:e[n])!=null),(1===t||4===t)&&n in i&&delete i[n]}),{schema:a.Ry().shape({...Object.keys(i).reduce((e,t)=>(e[t]=a.nK().nullable().test(function(e){var a;let n=this.parent,[,d]=this.path.match(/^(\w+)\[(\d+)\]/)||[],o=(null===(a=this.options.context)||void 0===a?void 0:a[d])||[];if(l||!l&&o.length>1){if(null!==n[t]&&void 0!==n[t]&&0!==n[t]&&""!==i[t]&&!i[t](n))return!1;if(!Object.entries(i).some(e=>{let[,l]=e;return!!l(n)}))return!0}return!!i[t](n)&&void 0!==e}),e),{})}),requiredFields:i}}},39704:function(e,l,t){"use strict";var a=t(52322),n=t(2784),d=t(22341),i=t(65950),o=t(85325),r=t(21326),u=t(19473),s=t(35656),c=t(24868),v=t.n(c);let m=e=>{let{functionId:l,recordId:t,window:c}=e,{getRequest:m}=(0,n.useContext)(i.$),{languageId:p}=(0,n.useContext)(o.V),{platformLabels:y}=(0,n.useContext)(u.l),x=t+"-"+l;(0,r.Z)({title:y.WorkFlow,window:c});let{width:h}=(0,s.d)(),F=h<=1024,I=h>1024&&h<=1280,f=F?10:I?12:14,P=F?75:I?85:95,b=F?15:I?20:25,g=async()=>{var e="_functionId=".concat(l,"&_recordId=").concat(t);let a=await m({extension:d.P.WorkFlow.graph,parameters:e});return null==a?void 0:a.record},D=e=>{let l=[],t=[],a="",n="";return e.objects.forEach(e=>{l.push({functionName:e.functionName,reference:e.reference,date:e.date})}),e.workflow.forEach(l=>{e.objects.forEach(e=>{let t=e.functionName.split(" ").join("\r\n");l.parentId===e.recordId&&l.parentFunctionId===e.functionId&&(a=e.reference+"\r\n"+e.date+"\r\n"+t,l.parentId),l.childId===e.recordId&&l.childFunctionId===e.functionId&&(n=e.reference+"\r\n"+e.date+"\r\n"+t,l.childId)}),""===a||""===n||t.push({from:a,to:n,value:1,labelText:""}),a="",n=""}),t};return(0,n.useEffect)(()=>{!async function(){var e=await g();if(e){let l=(e,l)=>{let t=document.createElement("script");t.type="text/javascript",t.src=e,t.async=!0,t.onload=l,document.head.appendChild(t)};l("https://cdn.amcharts.com/lib/4/core.js",()=>{l("https://cdn.amcharts.com/lib/4/charts.js",()=>{l("https://cdn.amcharts.com/lib/4/themes/animated.js",()=>{am4core.ready(()=>{let l=am4core.create(x,am4charts.SankeyDiagram),t=D(e);l.data=t,l.dataFields.fromName="from",l.dataFields.toName="to",l.dataFields.value="value",l.paddingRight=2===p?0:40,l.paddingLeft=2===p?40:0,l.tooltip.label.fontSize=f;let a=l.nodes.template;a.draggable=!1,a.inert=!0,a.clickable=!1,a.width=P,a.height=b,a.nameLabel.label.fontSize=f,a.nameLabel.locationX=2===p?.85:0,a.nameLabel.height=void 0,a.nameLabel.label.fontWeight="bold";let n=l.links.template;n.middleLine.strokeOpacity=.3,n.middleLine.stroke=am4core.color("#555"),n.middleLine.strokeWidth=5,n.middleLine.hoverable=!1,n.fillOpacity=0,n.hoverable=!0,n.hoverOnFocus=!0,n.fill=am4core.color("#A8C686"),n.isHover=!0,l.appear(1e3,100)})})})})}}()},[]),(0,a.jsx)("div",{id:x,className:v().root})};m.width=950,l.Z=m},24868:function(e){e.exports={root:"WorkFlow_root__EINm1"}}}]);