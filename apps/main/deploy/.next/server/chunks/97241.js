"use strict";exports.id=97241,exports.ids=[97241],exports.modules={97241:(e,a,n)=>{n.a(e,async(e,r)=>{try{n.d(a,{Z:()=>T});var t=n(20997),c=n(99155),d=n.n(c),l=n(16689),s=n(75609),o=n(80582),u=n(86201),i=n(29352),m=n(38509),y=n(6416),h=n(44619),I=n(95965),p=n(60520),x=n(18611),v=n(23385),f=n(27736),k=n(71278),g=n(68728),F=n(66198),V=n(91184),C=n(61274);n(61932);var b=n(65980),A=n(86794),j=n(79390),R=n(70638),N=n(677),w=n(78630),Z=n(4902),P=n(43991),O=n(19138),S=n(81313),q=n(38782),H=n(96119),M=n(70755),D=e([o,u,i,m,p,k,C,A,R,N,w,S,q]);function T({recordId:e,window:a}){let{getRequest:n,postRequest:r}=(0,l.useContext)(i.$),{platformLabels:c,defaultsData:D,userDefaultsData:T}=(0,l.useContext)(p.l),{stack:$}=(0,N.zY)(),{labels:_,access:L}=(0,q.Z)({datasetId:y.i.PaymentVouchers,editMode:!!e}),{documentType:G,maxAccess:J,changeDT:U}=(0,A.H)({functionId:g.J.PaymentVoucher,access:L,enabled:!e}),B=(0,m.E)({endpointId:F.H.PaymentVouchers.page3});(0,H.Z)({title:_.paymentVoucher,window:a});let E=parseInt(T?.list?.find(e=>"plantId"===e.key)?.value),K=parseInt(D?.list?.find(e=>"currencyId"===e.key)?.value),W=parseInt(T?.list?.find(e=>"cashAccountId"===e.key)?.value),{formik:z}=(0,I.c)({documentType:{key:"dtId",value:G?.dtId},initialValues:{recordId:null,reference:"",accountId:"",accountType:"",currencyId:parseInt(K),currencyName:"",paymentMethod:null,date:new Date,glId:null,amount:null,checkNo:"",checkbookId:null,decimals:null,notes:"",exRate:1,rateCalcMethod:1,baseAmount:null,cashAccountId:parseInt(W),dtId:null,status:1,releaseStatus:null,plantId:parseInt(E),contactId:null,isVerified:!1,sourceReference:"",paymentReasonId:null},maxAccess:J,validateOnChange:!0,validationSchema:s.object({accountType:s.string().required(),currencyId:s.number().required(),date:s.string().required(),paymentMethod:s.string().required(),cashAccountId:s.string().required(),checkNo:s.string().test("check-no-required-if-payment-method-3","Check number is required when payment method is 3.",function(e){let{paymentMethod:a}=this.parent;return 3!=a||e&&""!==e.trim()}),amount:s.number().required()}),onSubmit:async e=>{let a=e.recordId,n={header:{...e,date:(0,j.ku)(e.date),recordId:a},items:[],costCenters:[]},t=await r({extension:F.H.PaymentVouchers.set2,record:JSON.stringify(n)});a?u.default.success(c.Edited):u.default.success(c.Added);let d=await en(t.recordId);d.record.date=(0,j.a1)(d.record.date),z.setValues(d.record),B()}});async function Q(e,a,r,t){if(e&&a&&r){let c=await n({extension:Z.q.Currency.get,parameters:`_currencyId=${e}&_date=${(0,j.Uf)(a)}&_rateDivision=${r}`}),d=(0,P.fB)({amount:0===t?0:t??z.values.amount,exRate:c.record?.exRate,baseAmount:0,rateCalcMethod:c.record?.rateCalcMethod,dirtyField:P.ss});z.setFieldValue("baseAmount",parseFloat(d?.baseAmount).toFixed(2)||0),z.setFieldValue("exRate",c.record?.exRate),z.setFieldValue("rateCalcMethod",c.record?.rateCalcMethod)}}let Y=3===z.values.status,X=-1===z.values.status,ee=!!z.values.recordId,ea=z.values.isVerified;async function en(e){return await n({extension:F.H.PaymentVouchers.get,parameters:`_recordId=${e}`})}let er=async()=>{let e=await r({extension:F.H.PaymentVouchers.post,record:JSON.stringify(z.values)});if(e?.recordId){u.default.success(c.Posted),B();let a=await en(e.recordId);a.record.date=(0,j.a1)(a.record.date),z.setValues(a.record)}},et=async()=>{let e=await r({extension:F.H.PaymentVouchers.unpost,record:JSON.stringify(z.values)});if(e?.recordId){u.default.success(c.Unposted),B();let a=await en(e.recordId);a.record.date=(0,j.a1)(a.record.date),z.setValues(a.record)}},ec=async()=>{$({Component:R.Z,props:{functionId:g.J.PaymentVoucher,recordId:z.values.recordId}})},ed=async()=>{let e=await r({extension:F.H.PaymentVouchers.cancel,record:JSON.stringify(z.values)});if(e?.recordId){u.default.success(c.Cancelled),B();let a=await en(e.recordId);a.record.date=(0,j.a1)(a.record.date),z.setValues(a.record)}},el=async()=>{await r({extension:F.H.PaymentVouchers.verify,record:JSON.stringify(z.values)})&&(u.default.success(ea?c.Unverfied:c.Verified),B(),a.close())},es=async()=>{let e={header:{...z.values,date:(0,j.ku)(z.values.date),recordId:z.values.recordId},items:[],costCenters:[]};await r({extension:F.H.ResetGL_PV.reset,record:JSON.stringify(e)})},eo=[{key:"Locked",condition:Y,onClick:"onUnpostConfirmation",onSuccess:et,disabled:!ee||X||ea},{key:"Unlocked",condition:!Y,onClick:er,disabled:!ee||X},{key:"Verify",condition:!ea,onClick:el,disabled:!Y},{key:"Unverify",condition:ea,onClick:el,disabled:!Y},{key:"Cancel",condition:!0,onClick:ed,disabled:!ee||Y||X},{key:"FI Trx",condition:!0,onClick:"onClickIT",disabled:!ee},{key:"Aging",condition:!0,onClick:"onClickAging",disabled:!ee},{key:"GL",condition:!0,onClick:"onClickGL",datasetId:y.i.GLPaymentVouchers,onReset:es,disabled:!ee},{key:"RecordRemarks",condition:!0,onClick:"onRecordRemarks",disabled:!ee},{key:"WorkFlow",condition:!0,onClick:ec,disabled:!ee},{key:"AccountSummary",condition:!0,onClick:()=>{$({Component:S.Z,props:{accountId:parseInt(z.values.accountId),moduleId:1}})},disabled:!z.values.accountId}];return t.jsx(o.Z,{resourceId:y.i.PaymentVouchers,form:z,maxAccess:J,editMode:ee,previewReport:ee,actions:eo,functionId:g.J.PaymentVoucher,disabledSubmit:Y||X,children:t.jsx(x.R,{children:t.jsx(v.Q,{children:(0,t.jsxs)(d(),{container:!0,spacing:2,children:[t.jsx(d(),{item:!0,xs:6,children:t.jsx(k.Z,{endpointId:F.H.PaymentVouchers.pack,reducer:e=>e?.record?.documentTypes,filter:ee?void 0:e=>1===e.activeStatus,name:"dtId",label:_.documentType,readOnly:ee,valueField:"recordId",displayField:"name",values:z.values,onChange:async(e,a)=>{z.setFieldValue("dtId",a?.recordId||null),U(a)},error:z.touched.dtId&&!!z.errors.dtId,maxAccess:J})}),t.jsx(d(),{item:!0,xs:6,children:t.jsx(f.Z,{name:"date",label:_.date,value:z.values?.date,required:!0,onChange:async(e,a)=>{z.setFieldValue("date",a),await Q(z.values.currencyId,a,O.B.FINANCIALS)},onClear:()=>z.setFieldValue("date",null),readOnly:Y||X,error:z.touched.date&&!!z.errors.date,maxAccess:J})}),t.jsx(d(),{item:!0,xs:6,children:t.jsx(h.Z,{name:"reference",label:_.reference,value:z.values.reference,readOnly:ee,maxAccess:!ee&&J,maxLength:"15",onChange:z.handleChange,onClear:()=>z.setFieldValue("reference",""),error:z.touched.reference&&!!z.errors.reference})}),t.jsx(d(),{item:!0,xs:6,children:t.jsx(k.Z,{endpointId:F.H.PaymentVouchers.pack,reducer:e=>e?.record?.plants,name:"plantId",label:_.plant,valueField:"recordId",readOnly:Y||X,displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:z.values,onChange:(e,a)=>{z.setFieldValue("plantId",a?.recordId||null)},error:z.touched.plantId&&!!z.errors.plantId})}),t.jsx(d(),{item:!0,xs:6,children:t.jsx(k.Z,{endpointId:F.H.PaymentVouchers.pack,reducer:e=>e?.record?.groupTypes,name:"accountType",filter:e=>1==e.key||4==e.key,label:_.accountType,valueField:"key",displayField:"value",values:z.values,required:!0,readOnly:Y||X,maxAccess:J,onChange:(e,a)=>{z.setFieldValue("accountType",a?.key||null),a?.key||(z.setFieldValue("accountId",null),z.setFieldValue("accountRef",""),z.setFieldValue("accountName",""))},error:z.touched.accountType&&!!z.errors.accountType})}),t.jsx(d(),{item:!0,xs:6,children:t.jsx(k.Z,{endpointId:z.values?.accountId&&F.H.Contact.qry,parameters:z.values?.accountId&&`_accountId=${z.values?.accountId}`,name:"contactId",readOnly:Y||X,label:_.contact,valueField:"recordId",displayField:"name",columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:z.values,maxAccess:J,onChange:(e,a)=>{z.setFieldValue("contactId",a?.recordId||null)},error:z.touched.contactId&&!!z.errors.contactId})}),t.jsx(d(),{item:!0,xs:6,children:t.jsx(C.U,{endpointId:F.H.Account.snapshot,name:"accountId",readOnly:Y||X||!z.values.accountType,label:_.accountReference,valueField:"reference",displayField:"name",valueShow:"accountRef",secondValueShow:"accountName",form:z,columnsInDropDown:[{key:"reference",value:"Account Ref"},{key:"name",value:"Name",grid:4},{key:"keywords",value:"Keywords"}],firstFieldWidth:4,displayFieldWidth:4,filter:{type:z.values.accountType,isInactive:e=>!0!==e},onChange:(e,a)=>{z.setFieldValue("accountId",a?.recordId||""),z.setFieldValue("accountRef",a?.reference||""),z.setFieldValue("accountName",a?.name||""),z.setFieldValue("accountGroupName",a?.groupName||"")},error:z.touched.accountId&&!!z.errors.accountId,maxAccess:J})}),t.jsx(d(),{item:!0,xs:6,children:t.jsx(h.Z,{name:"accountGroupName",label:_.accountGroup,value:z.values.accountGroupName,readOnly:!0})}),t.jsx(d(),{item:!0,xs:6,children:t.jsx(k.Z,{endpointId:F.H.PaymentVouchers.pack,reducer:e=>e?.record?.cashAccounts,name:"cashAccountId",readOnly:X||Y,required:!0,label:_.cashAccount,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:z.values,maxAccess:J,onChange:async(e,a)=>{z.setFieldValue("cashAccountId",a?.recordId||null)},error:z.touched.cashAccountId&&!!z.errors.cashAccountId})}),t.jsx(d(),{item:!0,xs:6,children:(0,t.jsxs)(d(),{container:!0,spacing:1,alignItems:"center",children:[t.jsx(d(),{item:!0,xs:8,children:t.jsx(k.Z,{endpointId:F.H.PaymentVouchers.pack,reducer:e=>e?.record?.currencies,name:"currencyId",label:_.currency,filter:e=>1===e.currencyType,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],required:!0,readOnly:Y||X,values:z.values,onChange:async(e,a)=>{await Q(a?.recordId,z.values.date,O.B.FINANCIALS),z.setFieldValue("currencyId",a?a?.recordId:null),z.setFieldValue("currencyName",a?.name)},error:z.touched.currencyId&&!!z.errors.currencyId})}),t.jsx(d(),{item:!0,xs:4,children:t.jsx(M.Z,{onClick:()=>{var e;return e=z.values,void $({Component:w.Z,props:{DatasetIdAccess:y.i.MCRFIPaymentVoucher,data:e,onOk:e=>{z.setValues(a=>({...a,...e}))}}})},image:"popup.png",tooltipText:c.add,disabled:!z.values.currencyId||z.values.currencyId===K})})]})}),t.jsx(d(),{item:!0,xs:6,children:t.jsx(k.Z,{endpointId:F.H.PaymentVouchers.pack,reducer:e=>e?.record?.paymentMethods,name:"paymentMethod",label:_.paymentMethod,valueField:"key",displayField:"value",values:z.values,required:!0,readOnly:Y||X,maxAccess:J,onChange:(e,a)=>{z.setFieldValue("paymentMethod",a?.key||null),a?.key||(z.setFieldValue("checkNo",""),z.setFieldValue("checkbookId",null))},error:z.touched.paymentMethod&&!!z.errors.paymentMethod})}),t.jsx(d(),{item:!0,xs:6,children:t.jsx(V.Z,{name:"amount",required:!0,label:_.amount,maxLength:14,decimalScale:2,readOnly:Y||X,value:z.values.amount,maxAccess:J,onChange:async e=>{let a=(0,P.fB)({amount:e.target.value??0,exRate:z.values?.exRate,baseAmount:0,rateCalcMethod:z.values?.rateCalcMethod,dirtyField:P.ss});z.setFieldValue("baseAmount",parseFloat(a?.baseAmount).toFixed(2)||0),z.setFieldValue("amount",e.target.value)},onClear:async()=>{z.setFieldValue("amount",0)},error:z.touched.amount&&!!z.errors.amount})}),t.jsx(d(),{item:!0,xs:6,children:t.jsx(h.Z,{name:"checkNo",label:_.checkNo,value:z.values.checkNo,maxAccess:J,onChange:z.handleChange,onClear:()=>z.setFieldValue("checkNo",""),error:z.touched.checkNo&&!!z.errors.checkNo,disabled:3!=z.values.paymentMethod,required:3==z.values.paymentMethod})}),t.jsx(d(),{item:!0,xs:6,children:t.jsx(k.Z,{endpointId:F.H.PaymentVouchers.pack,reducer:e=>e?.record?.checkBooks,name:"checkbookId",label:_.checkbook,valueField:"recordId",displayField:"firstCheckNo",values:z.values,onChange:(e,a)=>{z.setFieldValue("checkbookId",a?.recordId||null)},error:z.touched.checkbookId&&!!z.errors.checkbookId,disabled:3!=z.values.paymentMethod})}),t.jsx(d(),{item:!0,xs:6,children:t.jsx(k.Z,{neverPopulate:!0,endpointId:F.H.PaymentVouchers.pack,reducer:e=>e?.record?.descriptionTemplates,name:"templateId",label:_.descriptionTemplate,readOnly:Y||X,valueField:"recordId",displayField:"name",values:z.values,onChange:(e,a)=>{let n=z.values.notes||"";a?.name&&z.setFieldValue("notes",""===n?a.name:`${n}
${a.name}`),z.setFieldValue("templateId",a?.recordId||null)},error:z.touched.templateId&&!!z.errors.templateId,maxAccess:J})}),t.jsx(d(),{item:!0,xs:6,children:t.jsx(h.Z,{name:"sourceReference",label:_.sourceReference,value:z.values.sourceReference,onChange:z.handleChange,onClear:()=>z.setFieldValue("sourceReference",""),maxLength:"20",readOnly:Y||X,maxAccess:J,error:z.touched.sourceReference&&!!z.errors.sourceReference})}),t.jsx(d(),{item:!0,xs:6,children:t.jsx(b.Z,{name:"notes",type:"text",label:_.notes,value:z.values.notes,readOnly:Y||X,rows:3,maxAccess:J,onChange:e=>z.setFieldValue("notes",e.target.value),onClear:()=>z.setFieldValue("notes",""),error:z.touched.notes&&!!z.errors.notes})}),t.jsx(d(),{item:!0,xs:6,children:t.jsx(k.Z,{endpointId:F.H.PaymentVouchers.pack,reducer:e=>e?.record?.paymentReasons,name:"paymentReasonId",readOnly:Y||X,label:_.paymentReasons,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:z.values,maxAccess:J,onChange:(e,a)=>{z.setFieldValue("paymentReasonId",a?.recordId||null)},error:z.touched.paymentReasonId&&!!z.errors.paymentReasonId})})]})})})})}[o,u,i,m,p,k,C,A,R,N,w,S,q]=D.then?(await D)():D,T.width=1250,T.height=550,r()}catch(e){r(e)}})},72172:(e,a,n)=>{n.d(a,{K:()=>t});let r="RG.FI.asmx/",t={FiOpeningBalance:{gen:r+"genOBA"},FiAging:{qry:r+"FI404"},AccountSummary:{AccFI405b:r+"FI405b"},DocumentAging:{AgingFI406a:r+"FI406a",AgingFI406b:r+"FI406b"},TrialBalance:{FI402View:r+"FI402o",FI401o2:r+"FI401o2"}}},81313:(e,a,n)=>{n.a(e,async(e,r)=>{try{n.d(a,{Z:()=>A});var t=n(20997),c=n(16689),d=n(87316),l=n.n(d),s=n(29352),o=n(61274),u=n(6416),i=n(38509),m=n(42020),y=n(23385),h=n(18611),I=n(71278),p=n(66198),x=n(70755),v=n(97969),f=n(60520),k=n(95965),g=n(79660),F=n(40711),V=n(72172),C=n(96119),b=e([s,o,i,I,f,F]);function A({accountId:e,moduleId:a,window:n}){let{getRequest:r}=(0,c.useContext)(s.$),{platformLabels:d}=(0,c.useContext)(f.l),[b,A]=(0,c.useState)([]);(0,C.Z)({title:d.AccountSummary,window:n});let{labels:j,access:R}=(0,i.J)({datasetId:u.i.AccountSummary}),N=[{field:"days",headerName:j.days,flex:1,type:"number"}],[w,Z]=(0,c.useState)(N),{formik:P}=(0,k.c)({maxAccess:R,initialValues:{accountId:null,accountRef:"",accountName:"",agpId:null,moduleId:a}});async function O(){let e;let n=2,t=[...N],c=await r({extension:g.r.Currency.qry,parameters:"_filter="});if(1==a?e=c?.list?.filter(e=>e.sale):2==a&&(e=c?.list?.filter(e=>e.purchase)),0==e.length)return;e?.forEach((e,a)=>{t.push({field:`column${a+1}`,headerName:e.reference,flex:1,type:"number"})}),Z(t);let d=await r({extension:p.H.AgingLeg.qry,parameters:`_agpId=${P.values.agpId}`}),l=d?.list?.map(a=>{let n=Array(e.length+2).fill(0);return n[0]=null,n[1]=a.days,n}),s=(e||[]).map(e=>r({extension:V.K.AccountSummary.AccFI405b,parameters:`_agpId=${P.values.agpId}&_currencyId=${e.recordId}&_accountId=${P.values.accountId}`}).then(e=>({summaryRes:e})));(await Promise.all(s)).forEach(({summaryRes:e})=>{e?.list?.forEach(e=>{l?.forEach(a=>{a[1]==e.seqDays&&(a[n]=e.amount)})}),n++});let o=Array(e.length+2).fill(null);for(let a=2;a<e.length+2;a++){let e=0;l?.map(n=>{e+=Number(n[a]||0)}),o[a]=e}let u=l.filter(e=>null!==e[1]).map(e=>{let[a,n,...r]=e,t={days:n};return r.forEach((e,a)=>{t[`column${a+1}`]=e.toFixed(2)}),t}),i={};for(let a=0;a<e.length;a++)i[`column${a+1}`]=o[a+2].toFixed(2)??0;u.push(i),A({list:u})}return(0,t.jsxs)(h.R,{children:[t.jsx(m.g,{children:(0,t.jsxs)(l(),{container:!0,spacing:2,p:2,children:[t.jsx(l(),{item:!0,xs:12,children:t.jsx(o.U,{endpointId:p.H.Account.snapshot,name:"accountId",label:j.account,valueField:"reference",displayField:"name",valueShow:"accountRef",secondValueShow:"accountName",form:P,readOnly:P.values.accountId&&P.values.moduleId,required:!0,maxAccess:R,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],onChange:async(e,a)=>{P.setFieldValue("accountId",a?.recordId||null),P.setFieldValue("accountName",a?.name||""),P.setFieldValue("accountRef",a?.reference||"")}})}),t.jsx(l(),{item:!0,xs:6,children:t.jsx(I.Z,{endpointId:p.H.AgingProfile.qry,parameters:"_startAt=0&_pageSize=1000&filter=",name:"agpId",label:j.agingProfile,values:P.values,valueField:"recordId",displayField:"name",maxAccess:R,required:!0,onChange:(e,a)=>{P.setFieldValue("agpId",a?.recordId||null),a?.recordId||A({list:[]})}})}),t.jsx(l(),{item:!0,xs:5,children:t.jsx(I.Z,{datasetId:v.v.FI_AGING_MODULE,label:j.module,name:"moduleId",values:P.values,valueField:"key",displayField:"value",maxAccess:R,required:!0,readOnly:P.values.moduleId,onChange:(e,a)=>{P.setFieldValue("moduleId",a?.key||null)}})}),t.jsx(l(),{item:!0,xs:1,children:t.jsx(x.Z,{onClick:O,image:"preview.png",disabled:!P.values.agpId||!P.values.moduleId||!P.values.accountId,tooltipText:d.Preview})})]})}),t.jsx(y.Q,{children:t.jsx(F.Z,{columns:w,gridData:b,isLoading:!1,pagination:!1})})]})}[s,o,i,I,f,F]=b.then?(await b)():b,A.width=1e3,A.height=500,r()}catch(e){r(e)}})}};