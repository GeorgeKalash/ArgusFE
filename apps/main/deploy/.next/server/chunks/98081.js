"use strict";exports.id=98081,exports.ids=[98081],exports.modules={76061:(e,a,t)=>{t.a(e,async(e,n)=>{try{t.d(a,{Z:()=>I});var s=t(20997),o=t(99155),l=t.n(o),r=t(17581),c=t.n(r),i=t(47501),d=t.n(i),u=t(68931),p=t.n(u),m=t(16689),h=t(91184),x=t(65980),y=t(44619),f=t(23385),v=t(61274),A=t(29352),b=t(95965),g=t(61932),F=t(60520),C=t(99648),S=t(677),j=t(5581),O=t(75609),k=t(70305),R=t(18687),w=e([v,A,F,C,S,j,k,R]);function I({labels:e,data:a,maxAccess:t,amount:n}){let{getRequestFullEndPoint:o,getRequest:r}=(0,m.useContext)(A.$),{userDefaultsData:i}=(0,m.useContext)(F.l);parseInt(i?.list?.find(e=>"cashAccountId"===e.key)?.value);let[u,w]=(0,m.useState)(!1),{stack:I}=(0,S.zY)(),{stack:P}=(0,k.V)(),{formik:_}=(0,b.c)({maxAccess:t,initialValues:{msgid:null,ecrno:process.env.NEXT_PUBLIC_ECRNO,ecR_RCPT:a?.reference,amount:(100*n).toString(),a1:"E",a2:"",a3:"",a4:"",a5:"",ipaddressOrPort:process.env.NEXT_PUBLIC_POS_PORT,log:1,posSelected:1,cashAccountId:null,cashAccountRef:null,cashAccountName:null},validateOnChange:!0,validationSchema:O.object({cashAccountId:O.number().required(),posRef:O.string().required()})}),N=[{key:"Received",condition:!0,onClick:T,viewLoader:u,disabled:a?.viewPosButtons},{key:"Cancel",condition:!0,onClick:Z,disabled:a?.viewPosButtons}];async function T(){try{let e=await _.validateForm();if(_.setTouched({cashAccountId:!0,posRef:!0}),Object.keys(e).length>0)return;w(!0);let a=await C.default.post(`${process.env.NEXT_PUBLIC_POS_URL}/api/Ingenico/start_PUR`,_.values);if(a.data){w(!1);let e=a.data.replace(/ /g,"\n");I({Component:j.Z,props:{DialogText:e},expandable:!1,closable:!1})}}catch(e){w(!1),P({message:e?.message})}}async function Z(){try{let e=await _.validateForm();if(_.setTouched({cashAccountId:!0,posRef:!0}),Object.keys(e).length>0)return;w(!1),await C.default.get(`${process.env.NEXT_PUBLIC_POS_URL}/api/Ingenico/cancelTransaction`)}catch(e){P({message:e?.message})}}return s.jsx(R.Z,{isSaved:!1,onSave:()=>T(),actions:N,disabledSubmit:a?.viewPosButtons,children:s.jsx(f.Q,{children:(0,s.jsxs)(l(),{container:!0,spacing:2,children:[s.jsx(l(),{item:!0,xs:12,children:s.jsx(y.Z,{name:"reference",readOnly:!0,label:e?.reference,maxAccess:t,value:a?.reference})}),(0,s.jsxs)(l(),{item:!0,container:!0,spacing:2,children:[s.jsx(l(),{item:!0,xs:6,children:s.jsx(y.Z,{name:"clientName",readOnly:!0,label:e?.client,value:a?.clientName,maxAccess:t})}),s.jsx(l(),{item:!0,xs:6,children:s.jsx(y.Z,{name:"beneficiaryName",readOnly:!0,label:e?.beneficiary,value:a?.beneficiaryName,maxAccess:t})})]}),s.jsx(l(),{item:!0,xs:12,children:(0,s.jsxs)(c(),{row:!0,value:_.values.posSelected,defaultValue:1,children:[s.jsx(d(),{value:1,control:s.jsx(p(),{}),label:e.manualPOS,disabled:2==_.values.posSelected}),s.jsx(d(),{value:2,control:s.jsx(p(),{}),label:e.apiPOS,disabled:1==_.values.posSelected})]})}),s.jsx(l(),{item:!0,xs:12,children:s.jsx(v.U,{endpointId:g.G.CashAccount.snapshot,parameters:{_type:2},valueField:"reference",displayField:"name",name:"cashAccountId",label:e.posAccount,form:_,readOnly:2==_.values.posSelected,displayFieldWidth:2,valueShow:"cashAccountRef",secondValueShow:"cashAccountName",editMode:!0,maxAccess:t,errorCheck:"cashAccountId",onChange:(e,a)=>{_.setFieldValue("cashAccountRef",a?.reference),_.setFieldValue("cashAccountName",a?.name),_.setFieldValue("cashAccountId",a?.recordId||null)}})}),s.jsx(l(),{item:!0,xs:12,children:s.jsx(h.Z,{name:"amount",label:e.amount,value:_?.values?.amount,maxAccess:t,readOnly:!0,error:_.touched?.amount&&!!_.errors?.amount})}),s.jsx(l(),{item:!0,xs:12,children:s.jsx(y.Z,{name:"posRef",label:e?.posRef,value:_?.posRef,maxAccess:t,readOnly:2==_.values.posSelected,onChange:_.handleChange,error:_.touched.posRef&&!!_.errors.posRef})}),s.jsx(l(),{item:!0,xs:12,children:s.jsx(x.Z,{name:"remarks",label:e.remarks,value:_.values.remarks,rows:3,maxAccess:t,editMode:!0,onChange:e=>_.setFieldValue("remarks",e.target.value),onClear:()=>_.setFieldValue("remarks",""),error:_.touched?.remarks&&!!_.errors.remarks})})]})})})}[v,A,F,C,S,j,k,R]=w.then?(await w)():w,n()}catch(e){n(e)}})},98081:(e,a,t)=>{t.a(e,async(e,n)=>{try{t.d(a,{Z:()=>p});var s=t(20997);t(16689);var o=t(97969),l=t(15051),r=t(6416);t(75609);var c=t(677),i=t(76061),d=t(38782),u=e([l,c,i,d]);function p({isPosted:e,value:a,amount:n,...u}){let p=!!u.data.recordId,{labels:m,access:h}=(0,d.Z)({datasetId:r.i?.POSPayment,editMode:p}),{stack:x}=(0,c.zY)(),y=e=>{let t=e.reduce((e,a)=>e+parseFloat(a.paidAmount||0),0),s=a?.find(e=>e?.type==="2")?.paidAmount,o=n+parseFloat(s||0)-parseFloat(t||0),l=e.map(e=>"2"===e.type?{...e,returnedAmount:(parseFloat(t||0)-parseFloat(n)).toFixed(2),amount:o}:e);u.onChange(l)},f=[{component:"resourcecombobox",label:m.type,name:"type",props:{datasetId:o.v.CA_CASH_ACCOUNT_TYPE,displayField:"value",valueField:"key",mapping:[{from:"key",to:"type"},{from:"value",to:"typeName"}],readOnly:e},propsReducer:({row:e,props:a})=>({...a,readOnly:e.paidAmount>0}),async onChange({row:{update:e,newRow:t}}){let s=a.slice(0,-1).reduce((e,a)=>{let t=parseFloat(a.amount.toString().replace(/,/g,""))||0;return e+t},0),o=(parseFloat(n)-parseFloat(s)).toFixed(2);e({amount:o})}},{component:"numberfield",name:"paidAmount",label:m?.paidAmount,async onChange({row:{update:e,newRow:t,updateRow:s}}){let o=a?.reduce((e,a)=>a.id!==t.id?e+parseFloat(a.paidAmount||0):e,0)?.toFixed(2)||0,l=(parseFloat(t.paidAmount||0)+parseFloat(o||0)-parseFloat(n||0)).toFixed(2);if(t?.type!=="2"){e({returnedAmount:0,amount:t.paidAmount});let r=a?.find(e=>e?.type==="2")?.id,c=a?.find(e=>e?.type==="2")?.paidAmount;s({id:r,changes:{returnedAmount:l||0,amount:n+parseFloat(c||0)-parseFloat(o||0)-parseFloat(t.paidAmount||0)}})}else e({returnedAmount:l||0,amount:(parseFloat(n||0)-parseFloat(o||0)).toFixed(2)})}},{component:"numberfield",name:"returnedAmount",label:m.returnedAmount,props:{readOnly:!0}},{component:"numberfield",name:"amount",label:m?.Amount,props:{readOnly:e}},{component:"numberfield",header:m.bankFees,name:"bankFees",label:m?.bankFees,props:{readOnly:e}},{component:"textfield",header:m?.receiptRef,name:"receiptRef",label:m?.receiptRef,props:{readOnly:e}},{component:"resourcecombobox",label:m?.posStatus,name:"posStatusName",props:{readOnly:!0,datasetId:o.v.RT_POSSTATUS,displayField:"value",valueField:"key",mapping:[{from:"value",to:"posStatusName"},{from:"key",to:"posStatus"}]}},{component:"button",name:"pos",props:{onCondition:e=>3==e.type?{imgSrc:t(94199).default.src,hidden:!1,disabled:!p||3!=e.type}:{imgSrc:"",hidden:!0,disabled:!p||3!=e.type}},label:m.pos,onClick:(e,a)=>{x({Component:i.Z,props:{labels:m,data:u.data,amount:a?.amount,maxAccess:h},width:700,title:m?.pos})}}];return s.jsx(l._,{...u,columns:f,maxAccess:h,onChange:(e,a)=>{u.onChange(e,a),"delete"===a&&Array.isArray(e)&&y(e)},value:a,initialValues:{id:1,seqNo:1,cashAccountId:null,cashAccount:"",posStatus:1,posStatusName:"",type:"",amount:"",paidAmount:"",returnedAmount:0,bankFees:"",receiptRef:""},allowDelete:!u.disabled})}[l,c,i,d]=u.then?(await u)():u,n()}catch(e){n(e)}})},5581:(e,a,t)=>{t.a(e,async(e,n)=>{try{t.d(a,{Z:()=>m});var s=t(20997),o=t(30343),l=t.n(o),r=t(2092),c=t.n(r),i=t(60520),d=t(16689),u=e([i]);i=(u.then?(await u)():u)[0];let p=({DialogText:e,window:a})=>{let{platformLabels:t}=(0,d.useContext)(i.l);return(0,s.jsxs)(l(),{sx:{display:"flex",flexDirection:"column",height:"100%",maxHeight:"100vh",p:3,boxSizing:"border-box",overflow:"hidden"},children:[s.jsx(l(),{sx:{flexGrow:1,overflowY:"auto",minHeight:0},children:e}),s.jsx(l(),{sx:{display:"flex",justifyContent:"flex-end",pt:2,flexShrink:0},children:s.jsx(c(),{onClick:()=>a.close(),color:"primary",children:t.OK})})]})};p.width=550,p.height=250;let m=p;n()}catch(e){n(e)}})}};