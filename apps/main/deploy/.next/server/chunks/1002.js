exports.id=1002,exports.ids=[1002],exports.modules={3:e=>{e.exports={root:"WorkFlow_root__EINm1"}},5102:(e,r,a)=>{"use strict";a.a(e,async(e,d)=>{try{a.d(r,{Z:()=>U});var t=a(20997),n=a(99155),s=a.n(n),l=a(16689),i=a(75609),o=a(80582),c=a(86201),u=a(15051),m=a(29352),I=a(38509),y=a(6416),p=a(70305),v=a(44619),h=a(95965),x=a(60520),f=a(18611),g=a(23385),b=a(27736),w=a(71278),F=a(79660),j=a(68728),k=a(65980),N=a(86794),C=a(79390),O=a(45649),S=a(97996),A=a(42020),q=a(677),D=a(54242),$=a(61274),V=a(70638),_=a(70208),Z=a(75039),R=a(67906),T=e([o,c,u,m,I,p,x,w,N,q,$,V,_,Z]);function U({labels:e,maxAccess:r,recordId:a,refresh:d=!0,...n}){let{getRequest:T,postRequest:U}=(0,l.useContext)(m.$),{platformLabels:L,userDefaultsData:E}=(0,l.useContext)(x.l),{stack:P}=(0,q.zY)(),{stack:Q}=(0,p.V)(),{documentType:z,maxAccess:J,changeDT:W}=(0,N.H)({functionId:j.J.DeliveryOrder,access:r,enabled:!a}),M=parseInt(E?.list?.find(e=>"plantId"===e.key)?.value),H=parseInt(E?.list?.find(e=>"siteId"===e.key)?.value),B=(0,I.E)(d&&{endpointId:O.U.DeliveriesOrders.qry}),G=[{id:1,doId:null,doSeqNo:null,seqNo:1,soSeqNo:null,soRef:null,itemId:null,soId:null,soDate:null,sku:null,itemName:null,qty:null,pendingQty:null,placeHolder:null,siteId:null,siteName:"",isEditMode:!1,deliveredNowQty:null,deliveredQty:null,mwFunctionId:null,muId:null,muRef:"",muName:"",mwId:null,mwRef:"",mwSeqNo:null}],{formik:K}=(0,h.c)({documentType:{key:"dtId",value:z?.dtId},initialValues:{recordId:null,reference:"",plantId:M,saleOrderId:null,clientRef:"",clientName:"",clientId:null,vehicleId:null,driverId:null,date:new Date,notes:"",dtId:null,status:1,statusName:"",printStatusName:"",printStatus:null,invoiceStatus:null,dtName:"",plantName:"",vehicleName:"",driverName:"",exWorks:!1,addressId:null,szName:"",szId:null,spName:"",spId:null,volume:null,qty:null,siteId:H,address:"",orders:G},maxAccess:J,validateOnChange:!0,validationSchema:i.object({plantId:i.number().required(),siteId:i.string().required(),orders:i.array().of(i.object({mwRef:i.string().required(),siteName:i.string().required()}))}),onSubmit:async e=>{let r={...e};delete r.orders,r.date=(0,C.ku)(r.date);let d=K.values.orders.map((e,r)=>({...e,doId:a||0,doSeqNo:r+1,id:r+1,reference:e.mwRef})),t=await U({extension:O.U.DeliveriesOrders.set2,record:JSON.stringify({header:r,items:d})});K.setFieldValue("recordId",t.recordId),await ea(t.recordId),K.values.recordId?c.default.success(L.Edited):c.default.success(L.Added),B()}}),X=K.values.orders.reduce((e,r)=>{let a=parseFloat(r.qty)||0;return e+a},0),Y=3===K.values.status,ee=-1==K.values.status,er=!!K.values.recordId;async function ea(e){let r=await ed(e);r.record.date=(0,C.a1)(r.record.date);let a=await en(r?.record);await es(r,a)}async function ed(e){return await T({extension:O.U.DeliveriesOrders.get,parameters:`_doId=${e}&_recordId=${e}`})}async function et(e){if(!e)return null;let r=await T({extension:F.r.Address.format,parameters:`_addressId=${e}`});return r?.record?.formattedAddress.replace(/(\r\n|\r|\n)+/g,"\r\n")}let en=async e=>await T({extension:O.U.OrderItem.qry,parameters:`_tripId=${e.recordId}&_doId=${e.recordId}`});async function es(e,r){let a=await et(e?.record?.addressId),d=G;r.list!=[]&&(d=await Promise.all(r.list.map((e,r)=>({...e,id:r+1,soDate:(0,C.a1)(e.soDate)})))),K.setValues({...e?.record,plantId:n.plantId||e?.record.plantId,dtId:n.dtId||e?.record.dtId,address:a,orders:d})}let el=async()=>{await U({extension:O.U.DeliveriesOrders.post,record:JSON.stringify(K.values)}),c.default.success(L.Posted),B(),await ea(K.values.recordId)},ei=async()=>{await U({extension:O.U.DeliveriesOrders.unpost,record:JSON.stringify(K.values)}),c.default.success(L.Unposted),B(),await ea(K.values.recordId)},eo=async()=>{await U({extension:O.U.DeliveriesOrders.cancel,record:JSON.stringify(K.values)}),a&&c.default.success(L.Cancelled),B(),await ea(K.values.recordId)},ec=async()=>{P({Component:V.Z,props:{functionId:j.J.DeliveryOrder,recordId:K.values.recordId}})};async function eu(){let r=await T({extension:S.P.Client.get,parameters:`_recordId=${K.values.clientId}&_doId=${K.values.recordId}`});r?.record?.ptId===null?Q({message:L.paymentTermError}):P({Component:Z.Z,props:{form:K,labels:e,maxAccess:J,recordId:a,refetchForm:ea},width:500,height:550,title:L.GenerateInvoice})}let em=[{key:"Locked",condition:Y,onClick:"onUnpostConfirmation",onSuccess:ei,disabled:!er||ee},{key:"Unlocked",condition:!Y,onClick:el,disabled:!er||ee},{key:"Cancel",condition:!0,onClick:eo,disabled:!er||!Y||ee},{key:"WorkFlow",condition:!0,onClick:ec,disabled:!er},{key:"generateIV",condition:!0,onClick:eu,disabled:!Y&&!ee||!!K.values.invoiceId}],eI=[{component:"resourcecombobox",label:e.reference,name:"mwRef",props:{endpointId:K?.values?.clientId&&O.U.MW.qry,parameters:K?.values?.clientId&&`_clientId=${K?.values?.clientId}`,displayField:"reference",valueField:"itemName",readOnly:Y||ee,mapping:[{from:"reference",to:"reference"},{from:"itemName",to:"itemName"},{from:"seqNo",to:"mwSeqNo"},{from:"qty",to:"qty"},{from:"muName",to:"muName"},{from:"muRef",to:"muRef"},{from:"muId",to:"muId"},{from:"functionId",to:"mwFunctionId"},{from:"reference",to:"mwRef"},{from:"itemId",to:"itemId"},{from:"recordId",to:"mwId"},{from:"dropDownQty",to:"deliveredNowQty"},{from:"dropDownQty",to:"pendingQty"},{from:"sku",to:"sku"},{from:"doId",to:"doId"}],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"itemName",value:"Name"},{key:"sku",value:"SKU"},{key:"qty",value:"Qty"}],displayFieldWidth:3},propsReducer:({row:e,props:r})=>({...r,readOnly:!!e.mwId})},{component:"textfield",label:e.sku,name:"sku",props:{readOnly:!0}},{component:"textfield",label:e.itemName,name:"itemName",props:{readOnly:!0}},{component:"numberfield",label:e.qty,name:"qty",props:{readOnly:Y||ee,allowNegative:!1},async onChange({row:{update:e,oldRow:r,newRow:a}}){a.qty&&a.qty>r.qty&&e({qty:r.qty})}},{component:"textfield",label:e.mu,name:"muName",props:{readOnly:!0}},{component:"resourcecombobox",label:e.site,name:"siteName",props:{endpointId:D.$.Site.qry,displayField:"name",valueField:"recordId",readOnly:Y||ee,mapping:[{from:"recordId",to:"siteId"},{from:"name",to:"siteName"}]}}];async function ey(){let e={printStatus:2,recordId:K.values.recordId};await U({extension:O.U.DeliveriesOrders.flag,record:JSON.stringify(e)}),B()}function ep(e){Object.entries(e).forEach(([e,r])=>{K.setFieldValue(e,r)})}return t.jsx(o.Z,{resourceId:y.i.DeliveriesOrders,form:K,maxAccess:J,editMode:er,actions:em,previewBtnClicked:ey,functionId:j.J.DeliveryTrip,disabledSubmit:Y||ee,previewReport:er,children:(0,t.jsxs)(f.R,{children:[t.jsx(A.g,{children:(0,t.jsxs)(s(),{container:!0,spacing:2,children:[t.jsx(s(),{item:!0,xs:8,children:(0,t.jsxs)(s(),{container:!0,spacing:2,children:[t.jsx(s(),{item:!0,xs:4,children:t.jsx(w.Z,{endpointId:F.r.DocumentType.qry,parameters:`_dgId=${j.J.DeliveryOrder}&_startAt=0&_pageSize=1000`,filter:er?void 0:e=>1===e.activeStatus,name:"dtId",label:e.docType,readOnly:er||ee,valueField:"recordId",displayField:"name",values:K.values,onChange:(e,r)=>{K.setFieldValue("dtId",r?.recordId||""),W(r)},error:K.touched.dtId&&!!K.errors.dtId,maxAccess:J})}),t.jsx(s(),{item:!0,xs:4,children:t.jsx(w.Z,{endpointId:F.r.Plant.qry,name:"plantId",label:e.plant,valueField:"recordId",readOnly:Y||ee,displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:K.values,onChange:(e,r)=>{K.setFieldValue("plantId",r?r?.recordId:"")},error:K.touched.plantId&&!!K.errors.plantId,required:!0,maxAccess:J})}),t.jsx(s(),{item:!0,xs:4,children:t.jsx(b.Z,{name:"date",label:e.date,value:K.values?.date,onChange:K.setFieldValue,onClear:()=>K.setFieldValue("date",""),readOnly:Y||ee,error:K.touched.date&&!!K.errors.date,maxAccess:J})}),t.jsx(s(),{item:!0,xs:4,children:t.jsx(v.Z,{name:"reference",label:e.reference,value:K.values.reference,readOnly:er||ee,maxAccess:J,onChange:K.handleChange,onClear:()=>K.setFieldValue("reference",""),error:K.touched.reference&&!!K.errors.reference})}),t.jsx(s(),{item:!0,xs:4,children:t.jsx(w.Z,{endpointId:D.$.Site.qry,name:"siteId",label:e.site,required:!0,values:K.values,displayField:"name",maxAccess:J,readOnly:Y||ee,onChange:(e,r)=>{K.setFieldValue("siteId",r?.recordId||"")},error:K.touched.siteId&&!!K.errors.siteId})}),t.jsx(s(),{item:!0,xs:4,children:t.jsx(w.Z,{endpointId:O.U.Driver.qry,name:"driverId",label:e.driver,valueField:"recordId",readOnly:Y||ee,displayField:"name",values:K.values,onChange:(e,r)=>{K.setFieldValue("driverId",r?r?.recordId:"")},maxAccess:J,error:K.touched.driverId&&!!K.errors.driverId})}),t.jsx(s(),{item:!0,xs:8,children:t.jsx($.U,{endpointId:S.P.Client.snapshot,valueField:"reference",displayField:"name",secondFieldLabel:e.client,name:"clientId",label:e.client,form:K,required:!0,readOnly:ee||er,displayFieldWidth:2,valueShow:"clientRef",secondValueShow:"clientName",maxAccess:J,editMode:er,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"},{key:"szName",value:"Sales Zone"}],onChange:async(e,r)=>{K.setFieldValue("clientId",r?.recordId),K.setFieldValue("clientName",r?.name),K.setFieldValue("clientRef",r?.reference),r?.recordId||(K.setFieldValue("orders",G),K.setFieldValue("addressId",null),K.setFieldValue("address",""))},errorCheck:"clientId"})}),t.jsx(s(),{item:!0,xs:4,children:t.jsx(w.Z,{endpointId:O.U.Vehicle.qry,name:"vehicleId",label:e.vehicle,valueField:"recordId",readOnly:Y||ee,displayField:"name",maxAccess:J,values:K.values,onChange:(e,r)=>{K.setFieldValue("vehicleId",r?r?.recordId:"")},error:K.touched.vehicleId&&!!K.errors.vehicleId})}),t.jsx(s(),{item:!0,xs:8,children:t.jsx(R.Z,{name:"exWorks",value:K.values?.exWorks,onChange:e=>K.setFieldValue("exWorks",e.target.checked),label:e.exWorks,maxAccess:J,readOnly:!0,disabled:!0})}),t.jsx(s(),{item:!0,xs:4,children:t.jsx(w.Z,{endpointId:S.P.SalesZone.qry,parameters:'_startAt=0&_pageSize=1000&_sortField="recordId"&_filter=',name:"szId",label:e.saleZone,readOnly:Y||ee,valueField:"recordId",displayField:"name",values:K.values,maxAccess:J,onChange:(e,r)=>{K.setFieldValue("szId",r?r.recordId:null)},error:K.touched.szId&&!!K.errors.szId})})]})}),t.jsx(s(),{item:!0,xs:4,children:(0,t.jsxs)(s(),{container:!0,spacing:2,children:[t.jsx(s(),{item:!0,xs:12,children:t.jsx(v.Z,{name:"salePerson",label:e.salePerson,value:K.values.salePerson,onChange:K.handleChange,readOnly:!0,maxAccess:J})}),t.jsx(s(),{item:!0,xs:12,children:t.jsx(k.Z,{name:"address",label:e.address,value:K.values.address,rows:3.5,maxLength:"100",readOnly:ee||Y,maxAccess:J,viewDropDown:K.values.clientId&&!ee&&!Y,onChange:e=>K.setFieldValue("address",e.target.value),onClear:()=>K.setFieldValue("address",""),onDropDown:()=>{P({Component:_.Z,props:{maxAccess:J,labels:e,deliveryOrder:!0,form:K.values,handleAddressValues:ep,checkedAddressId:K.values.addressId}})}})}),t.jsx(s(),{item:!0,xs:12,children:t.jsx(k.Z,{name:"notes",label:e.notes,value:K.values.notes,readOnly:Y||ee,maxAccess:J,onChange:e=>K.setFieldValue("notes",e.target.value),onClear:()=>K.setFieldValue("notes",""),error:K.touched.notes&&!!K.errors.notes})})]})})]})}),t.jsx(g.Q,{children:t.jsx(u._,{onChange:e=>{K.setFieldValue("orders",e)},value:K?.values?.orders,error:K?.errors?.orders,columns:eI,maxAccess:J,name:"orders",allowDelete:!Y&&!ee,allowAddNewLine:!Y&&!ee})}),t.jsx(A.g,{children:t.jsx(s(),{container:!0,spacing:2,mt:.3,children:t.jsx(s(),{item:!0,xs:3,children:t.jsx(v.Z,{name:"totalQty",label:e.totalQty,maxAccess:J,value:X,maxLength:"30",readOnly:!0,error:K.touched.totalQty&&!!K.errors.totalQty,helperText:K.touched.totalQty&&K.errors.totalQty})})})})]})})}[o,c,u,m,I,p,x,w,N,q,$,V,_,Z]=T.then?(await T)():T,d()}catch(e){d(e)}})},75039:(e,r,a)=>{"use strict";a.a(e,async(e,d)=>{try{a.d(r,{Z:()=>S});var t=a(20997),n=a(99155),s=a.n(n),l=a(16689),i=a(75609),o=a(86201),c=a(29352);a(6416);var u=a(44619),m=a(95965),I=a(60520),y=a(18611),p=a(27736),v=a(71278),h=a(79660),x=a(68728),f=a(65980),g=a(86794),b=a(45649),w=a(97996),F=a(42020),j=a(61274),k=a(70305),N=a(18687),C=a(38509),O=e([o,c,I,v,g,j,k,N,C]);function S({labels:e,maxAccess:r,recordId:a,form:d,refetchForm:n,window:O}){let{getRequest:S,postRequest:A}=(0,l.useContext)(c.$),{platformLabels:q,defaultsData:D}=(0,l.useContext)(I.l),{stack:$}=(0,k.V)(),{documentType:V,maxAccess:_,changeDT:Z}=(0,g.H)({functionId:x.J.SalesInvoice,access:r,enabled:!a}),R=(0,C.E)({endpointId:b.U.DeliveriesOrders.qry}),{formik:T}=(0,m.c)({documentType:{key:"dtId",value:V?.dtId},initialValues:{reference:d?.values?.reference,plantId:d?.values?.plantId,clientId:d?.values?.clientId,applyVAT:!1,spId:d?.values?.spId,clientRef:d?.values?.clientRef,clientName:d?.values?.clientName,date:new Date,dtId:null,currency:null,dtName:"",ptId:null,plantName:d?.values?.plantName,description:"",deliveryOrderId:d?.values?.recordId},maxAccess:_,validateOnChange:!0,validationSchema:i.object({plantId:i.number().required()}),onSubmit:async e=>{let r=await A({extension:b.U.Invoice.generate,record:JSON.stringify(e)});await n(a),R(),O.close(),r.recordId?o.default.success(q.Edited):o.default.success(q.Added)}});return t.jsx(N.Z,{onSave:T.handleSubmit,maxAccess:_,actions:[{key:"Generate Invoice",condition:!0,onClick:()=>T.handleSubmit()}],isSaved:!1,children:t.jsx(y.R,{children:t.jsx(F.g,{children:(0,t.jsxs)(s(),{container:!0,spacing:2,children:[t.jsx(s(),{item:!0,xs:12,children:t.jsx(v.Z,{endpointId:h.r.DocumentType.qry,parameters:`_dgId=${x.J.SalesInvoice}&_startAt=0&_pageSize=1000`,name:"dtId",label:e.docType,valueField:"recordId",displayField:"name",values:T.values,onChange:(e,r)=>{T.setFieldValue("dtId",r?.recordId||""),Z(r)},error:T.touched.dtId&&!!T.errors.dtId,maxAccess:_})}),t.jsx(s(),{item:!0,xs:12,children:t.jsx(p.Z,{name:"date",label:e.date,value:T.values?.date,readOnly:!0})}),t.jsx(s(),{item:!0,xs:12,children:t.jsx(v.Z,{endpointId:h.r.Plant.qry,name:"plantId",label:e.plant,valueField:"recordId",displayField:["reference","name"],values:T.values,readOnly:!0})}),t.jsx(s(),{item:!0,xs:12,children:t.jsx(j.U,{endpointId:w.P.Client.snapshot,valueField:"reference",displayField:"name",secondFieldLabel:e.client,name:"clientId",label:e.client,form:T,required:!0,readOnly:!0,valueShow:"clientRef",secondValueShow:"clientName"})}),t.jsx(s(),{item:!0,xs:12,children:t.jsx(u.Z,{name:"currencyName",label:e.currency,value:T.values.currencyName,readOnly:!0})}),t.jsx(s(),{item:!0,xs:12,children:t.jsx(u.Z,{name:"reference",label:e.deliveryOrderReference,value:T.values.reference,readOnly:!0})}),t.jsx(s(),{item:!0,xs:12,children:t.jsx(f.Z,{name:"description",label:e.description,value:T.values.description,maxAccess:_,onChange:e=>T.setFieldValue("description",e.target.value),onClear:()=>T.setFieldValue("description",""),error:T.touched.description&&!!T.errors.description})})]})})})})}[o,c,I,v,g,j,k,N,C]=O.then?(await O)():O,d()}catch(e){d(e)}})},68624:(e,r,a)=>{"use strict";a.d(r,{Z:()=>o});var d=a(79660);a(6416);var t=a(82204),n=a(75281);let s=async(e,r,a)=>{try{let d=await e({extension:r,parameters:a});return r.includes("qry")?d:d.record}catch(e){return null}},l=(e,r,a,d)=>{let n=(e=JSON.parse(JSON.stringify(e))).record.controls,s=n.find(e=>"reference"===e.controlId);return s?s.accessLevel=r?.mandatory?t.$7:t.rr:r?.mandatory?n.push({sgId:0,resourceId:"",controlId:`${d?d+".":""}reference`,accessLevel:r?.mandatory?t.$7:t.rr}):r?.readOnly?n.push({sgId:0,resourceId:"",controlId:`${d?d+".":""}reference`,accessLevel:r?.readOnly?t.rr:t.$7}):n=e.record.controls.filter(e=>"reference"!=e.controlId),a&&n.push({sgId:0,resourceId:"",controlId:`${d?d+".":""}dtId`,accessLevel:t.$7}),{...e,record:{...e.record,controls:n}}},i=async(e,r,a)=>{let t,l;switch(a){case"dtId":let i=(0,n.m)("userData"),o=i?.userId;l=`_userId=${o}&_functionId=${r}`,t=d.r.UserFunction.get;break;case"glbSysNumberRange":l=`_recordId=${r}`,t=d.r.SystemFunction.get;break;case"DocumentType":l=`_dgId=${r}&_startAt=0&_pageSize=50`,t=d.r.DocumentType.qry;break;case"DcTypNumberRange":l=`_recordId=${r}`,t=d.r.DocumentType.get;break;case"isExternal":l=`_recordId=${r}`,t=d.r.NumberRange.get;break;default:return null}return await s(e,t,l)},o=async(e,r,a,d,t=!0,n)=>{let s,o,c,u;let m=void 0===d&&r&&await i(e,r,"dtId"),I=m?.dtId,y="",p=!0;if(m&&void 0===d||"nraId"===d){if(I){let r=await i(e,I,"DcTypNumberRange");s=r?.nraId,p=!(r?.activeStatus<0),s||(y="Assign the document type to a number range")}if((!I||!p)&&t&&r){let a=await i(e,r,"DocumentType");u=a?.list?.filter(e=>e?.activeStatus===1).length>0}}if(("nraId"===d||void 0===d)&&r){if((!I||I)&&!s||s&&!p){let a=await i(e,r,"glbSysNumberRange");(s=a?.nraId)&&u&&(u=!1),p=!0}y=s||u?"":"Assign the system Function to a number range"}d>0&&!s&&(s=d),s&&p?(c=await i(e,s,"isExternal"),o={readOnly:!c?.external,mandatory:!!c?.external},a&&(a=await l(a,o,u,n))):!s&&a&&(a=await l(a,o,u,n));let v=n?`${n}.reference`:"reference";return{dtId:I,resetReference:o?.readOnly,dcTypeRequired:u,reference:{fieldName:v,isEmpty:!(c?.external===void 0||c?.external)},errorMessage:y,maxAccess:a,selectNraId:d}}},75281:(e,r,a)=>{"use strict";a.d(r,{m:()=>d});let d=e=>{let r=window.sessionStorage.getItem(e);return r?JSON.parse(r):null}},86794:(e,r,a)=>{"use strict";a.a(e,async(e,d)=>{try{a.d(r,{G:()=>c,H:()=>u});var t=a(49752),n=a(16689),s=a(70305),l=a(68624),i=a(29352),o=e([t,s,i]);function c({functionId:e,action:r,hasDT:a}){let{getRequest:d}=(0,n.useContext)(i.$),{stack:t}=(0,s.V)();return{proxyAction:async()=>{let n=await (0,l.Z)(d,e,"",void 0,a);n?.errorMessage?t({message:n?.errorMessage}):await r()}}}function u({functionId:e,access:r,hasDT:a,enabled:d=!0,objectName:o=""}){let{getRequest:c}=(0,n.useContext)(i.$),{stack:u}=(0,s.V)(),[m,I]=(0,n.useState)(),y=async d=>{let t=await (0,l.Z)(c,e,r,d,a,o);if(!t.errorMessage)return t;u({message:t?.errorMessage})},p=(0,t.useQuery)({retry:!1,staleTime:0,enabled:d,queryKey:[e,m,!!r,d],queryFn:m||"nraId"===m?()=>y(m):()=>y()});return{documentType:p.data,maxAccess:p?.data?.maxAccess||r,changeDT(e){I(e?.nraId||"nraId")}}}[t,s,i]=o.then?(await o)():o,d()}catch(e){d(e)}})},70208:(e,r,a)=>{"use strict";a.a(e,async(e,d)=>{try{a.d(r,{Z:()=>N});var t=a(20997),n=a(40711),s=a(99155),l=a.n(s),i=a(95965),o=a(71278),c=a(18611),u=a(23385),m=a(16689),I=a(29352),y=a(79660),p=a(97996),v=a(42020),h=a(61274),x=a(44619),f=a(60520),g=a(96119),b=a(18687),w=a(70755),F=a(38509),j=a(6416),k=e([n,o,I,h,f,b,F]);function N({labels:e,shipment:r=!1,bill:a=!1,deliveryOrder:d=!1,form:s,handleAddressValues:k,checkedAddressId:N,window:C}){let{getRequest:O}=(0,m.useContext)(I.$),{platformLabels:S}=(0,m.useContext)(f.l);(0,g.Z)({title:S.AddressFilter,window:C});let{formik:A}=(0,i.c)({initialValues:{search:"",cityId:null,countryId:null},validateOnChange:!0,onSubmit:async()=>{let e=$?.list?.find(e=>e.checked);if(!e?.addressId){k({shipAddress:"",BillAddress:"",address:""}),C.close();return}if(r||a||d){let t=await q(e?.addressId);r&&k({shipAddress:t,shipAddressId:e?.addressId,shipToAddressId:e?.addressId}),a&&k({billAddress:t,billAddressId:e?.addressId,billToAddressId:e?.addressId}),d&&k({address:t,addressId:e?.addressId})}C.close()}});async function q(e){if(!e)return;let r=await O({extension:y.r.Address.format,parameters:`_addressId=${e}`});return r?.record?.formattedAddress.replace(/(\r\n|\r|\n)+/g,"\r\n")}let D=async(e={})=>{let{_startAt:r=0,_pageSize:a=50}=e,d=!!A.values.search&&!!A.values.countryId&&!!A.values.cityId&&!!s.clientId,t=await O({extension:d?p.P.FilterAddress.snapshot:p.P.Address.page,parameters:d?`_countryId=${A.values.countryId}&_cityId=${A.values.cityId}&_clientId=${s.clientId}&_filter=${A.values.search}`:`_startAt=${r}&_pageSize=${a}&_params=1|${s.clientId}`}),n=t?.list?.map(e=>({addressId:e.addressId||e.recordId,address:e.formattedAddress??`${e.name||""}, ${e.street1||""}, ${e.street2||""}, ${e.city||""}, ${e.phone||""},${e.phone2||""},${e.email1||""}`,checked:(e.addressId||e.recordId)===N}))||[];return{list:n,_startAt:r,count:n.length}},{query:{data:$},paginationParameters:V,refetch:_}=(0,F.J)({queryFn:D,endpointId:p.P.Address.page,datasetId:j.i.Address});return t.jsx(b.Z,{onSave:A.handleSubmit,children:(0,t.jsxs)(c.R,{children:[t.jsx(v.g,{children:(0,t.jsxs)(l(),{container:!0,spacing:2,children:[t.jsx(l(),{item:!0,xs:12,children:t.jsx(o.Z,{endpointId:y.r.Country.qry,name:"countryId",label:e.country,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:A.values,onChange:(e,r)=>{A.setFieldValue("cityId",""),A.setFieldValue("countryId",r?.recordId||null)}})}),t.jsx(l(),{item:!0,xs:12,children:t.jsx(h.U,{endpointId:y.r.City.snapshot,parameters:{_countryId:A.values.countryId,_stateId:0},valueField:"name",displayField:"name",name:"city",label:e.city,form:A,secondDisplayField:!1,onChange:(e,r)=>{A.setFieldValue("cityId",r?.recordId||null),A.setFieldValue("city",r?.name||null)}})}),t.jsx(l(),{item:!0,xs:6,children:t.jsx(x.Z,{name:"search",value:A.values.search,label:e.search,onClear:()=>{A.setFieldValue("search","")},onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),e.stopPropagation())},onChange:A.handleChange})}),t.jsx(l(),{item:!0,xs:2,children:t.jsx(w.Z,{label:e.apply,onClick:_,disabled:!(A.values.countryId&&A.values.cityId)})})]})}),t.jsx(u.Q,{children:t.jsx(n.Z,{name:"addressFilterTable",columns:[{field:"address",headerName:"",flex:6}],gridData:$,rowId:["addressId"],pageSize:50,paginationType:"api",paginationParameters:V,checkTitle:"",checkboxFlex:1,rowSelection:"single",showCheckboxColumn:!0,viewCheckButtons:!0})})]})})}[n,o,I,h,f,b,F]=k.then?(await k)():k,N.width=950,N.height=600,d()}catch(e){d(e)}})},70638:(e,r,a)=>{"use strict";a.a(e,async(e,d)=>{try{a.d(r,{Z:()=>v});var t=a(20997),n=a(16689),s=a(97996),l=a(29352),i=a(73846),o=a(96119),c=a(60520),u=a(20562),m=a(3),I=a.n(m),y=e([l,i,c]);[l,i,c]=y.then?(await y)():y;let p=({functionId:e,recordId:r,window:a})=>{let{getRequest:d}=(0,n.useContext)(l.$),{languageId:m}=(0,n.useContext)(i.V),{platformLabels:y}=(0,n.useContext)(c.l),p=r+"-"+e;(0,o.Z)({title:y.WorkFlow,window:a});let{width:v}=(0,u.d)(),h=v<=1024,x=v>1024&&v<=1280,f=h?10:x?12:14,g=h?75:x?85:95,b=h?15:x?20:25,w=async()=>{var a=`_functionId=${e}&_recordId=${r}`;let t=await d({extension:s.P.WorkFlow.graph,parameters:a});return t?.record},F=e=>{let r=[],a=[],d="",t="";return e.objects.forEach(e=>{r.push({functionName:e.functionName,reference:e.reference,date:e.date})}),e.workflow.forEach(r=>{e.objects.forEach(e=>{let a=e.functionName.split(" ").join("\r\n");r.parentId===e.recordId&&r.parentFunctionId===e.functionId&&(d=e.reference+"\r\n"+e.date+"\r\n"+a,r.parentId),r.childId===e.recordId&&r.childFunctionId===e.functionId&&(t=e.reference+"\r\n"+e.date+"\r\n"+a,r.childId)}),""===d||""===t||a.push({from:d,to:t,value:1,labelText:""}),d="",t=""}),a};return(0,n.useEffect)(()=>{!async function(){var e=await w();if(e){let r=(e,r)=>{let a=document.createElement("script");a.type="text/javascript",a.src=e,a.async=!0,a.onload=r,document.head.appendChild(a)};r("https://cdn.amcharts.com/lib/4/core.js",()=>{r("https://cdn.amcharts.com/lib/4/charts.js",()=>{r("https://cdn.amcharts.com/lib/4/themes/animated.js",()=>{am4core.ready(()=>{let r=am4core.create(p,am4charts.SankeyDiagram),a=F(e);r.data=a,r.dataFields.fromName="from",r.dataFields.toName="to",r.dataFields.value="value",r.paddingRight=2===m?0:40,r.paddingLeft=2===m?40:0,r.tooltip.label.fontSize=f;let d=r.nodes.template;d.draggable=!1,d.inert=!0,d.clickable=!1,d.width=g,d.height=b,d.nameLabel.label.fontSize=f,d.nameLabel.locationX=2===m?.85:0,d.nameLabel.height=void 0,d.nameLabel.label.fontWeight="bold";let t=r.links.template;t.middleLine.strokeOpacity=.3,t.middleLine.stroke=am4core.color("#555"),t.middleLine.strokeWidth=5,t.middleLine.hoverable=!1,t.fillOpacity=0,t.hoverable=!0,t.hoverOnFocus=!0,t.fill=am4core.color("#A8C686"),t.isHover=!0,r.appear(1e3,100)})})})})}}()},[]),t.jsx("div",{id:p,className:I().root})};p.width=950;let v=p;d()}catch(e){d(e)}})}};