"use strict";exports.id=4676,exports.ids=[4676],exports.modules={91664:(e,r,a)=>{var t=a(71600);r.Z=void 0;var l=t(a(84198)),s=a(20997);r.Z=(0,l.default)([(0,s.jsx)("path",{d:"M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2M12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8"},"0"),(0,s.jsx)("path",{d:"M12.5 7H11v6l5.25 3.15.75-1.23-4.5-2.67z"},"1")],"AccessTime")},4676:(e,r,a)=>{a.a(e,async(e,t)=>{try{a.d(r,{Z:()=>Z});var l=a(20997),s=a(99155),n=a.n(s),d=a(16689),i=a(75609),o=a(80582),c=a(86201),u=a(15051),m=a(29352),p=a(38509),x=a(6416),v=a(44619),h=a(95965),y=a(60520),I=a(18611),f=a(23385),g=a(27736),T=a(71278),F=a(79660),j=a(68728),b=a(65980),w=a(86794),N=a(79390),O=a(45649),C=a(97996),V=a(42020),S=a(20757),k=a(1635),A=a.n(k),D=e([o,c,u,m,p,y,T,w]);function Z({labels:e,maxAccess:r,recordId:a}){let{getRequest:t,postRequest:s}=(0,d.useContext)(m.$),{platformLabels:k,userDefaultsData:D}=(0,d.useContext)(y.l),{documentType:Z,maxAccess:$,changeDT:R}=(0,w.H)({functionId:j.J.DeliveryTrip,access:r,enabled:!a}),U=(0,p.E)({endpointId:O.U.Trip.page}),{formik:q}=(0,h.c)({initialValues:{recordId:null,reference:"",plantId:null,vehicleId:null,driverId:null,date:new Date,departureTime:new Date,departureTimeField:null,arrivalTime:null,arrivalTimeField:null,notes:"",dtId:null,status:1,statusName:"",printStatusName:"",dtName:"",plantName:"",vehName:"",driverName:"",capacityVolume:null,wip:1,wipName:"",orders:[{id:1,soRef:null,soId:null,soDate:null,clientName:null,soVolume:null,soWipStatusName:null}]},maxAccess:$,documentType:{key:"dtId",value:Z?.dtId},validateOnChange:!0,validationSchema:i.object({departureTime:i.string().required(),plantId:i.number().required()}),onSubmit:async e=>{let r={...e};delete r.orders,r.date=(0,N.ku)(r.date);let a=W(r.departureTime,r.departureTimeField);if(r.departureTime=(0,N.ku)(a),r.arrivalTime){let e=W(r.arrivalTime,r.arrivalTimeField);r.arrivalTime=(0,N.ku)(e)}let t=await s({extension:O.U.Trip.set,record:JSON.stringify(r)});q.setFieldValue("recordId",t.recordId);let l=q.values.orders.filter(e=>""!==e.soId&&void 0!==e.soId),n=new Set,d=!1;for(let e of l){if(n.has(e.soId)){d=!0;break}n.add(e.soId)}if(d)return;l=l?.some(e=>e.soId)?l.map((e,r)=>({...e,tripId:t.recordId||0,id:r+1})):[];let i={tripId:t.recordId||0,tripOrders:l};await s({extension:O.U.TripOrderPack2.set2,record:JSON.stringify(i)}),await B(t.recordId),q.values.recordId?c.default.success(k.Edited):c.default.success(k.Added),U()}});function W(e,r){let a=A()(e).startOf("day"),t=a;if(null!=r){let e=A()(r,"hh:mm A");t=a.set("hour",e.hour()).set("minute",e.minute())}return t}let _=q.values.orders.reduce((e,r)=>{let a=parseFloat(r.soVolume)||0;return e+a},0),J=q.values.orders.reduce((e,r)=>{let a=parseFloat(r.soWeight)||0;return e+a},0),P=3===q.values.status,L=2===q.values.wip,z=!!q.values.recordId;async function B(e){let r=await M(e),a=(0,N.a1)(r.record.departureTime),t=(0,N.a1)(r.record.arrivalTime);r.record.date=(0,N.a1)(r.record.date),r.record.departureTime=a,a&&(r.record.departureTimeField=A()(A()(a),"hh:mm A")),r.record.arrivalTime=t,t&&(r.record.arrivalTimeField=A()(A()(t),"hh:mm A")),await E(r.record)}async function M(e){return await t({extension:O.U.Trip.get,parameters:`_recordId=${e}`})}let E=async e=>{let r=await t({extension:O.U.TripOrder.qry,parameters:`_tripId=${e.recordId}`}),a=[];r.list!=[]&&(a=await Promise.all(r.list.map((e,r)=>({...e,id:r+1,soDate:(0,N.a1)(e.soDate)})))),q.setValues({...e,orders:a})},H=async()=>{await s({extension:O.U.Trip.post,record:JSON.stringify(q.values)}),c.default.success(k.Posted),U(),await B(q.values.recordId)},G=async()=>{await s({extension:O.U.Trip.unpost,record:JSON.stringify(q.values)}),c.default.success(k.Unposted),U(),await B(q.values.recordId)},Q=async()=>{await s({extension:O.U.Trip.close,record:JSON.stringify(q.values)}),a&&c.default.success(k.Closed),U(),await B(q.values.recordId)},K=async()=>{await s({extension:O.U.Trip.reopen,record:JSON.stringify(q.values)}),a&&c.default.success(k.Reopened),U(),await B(q.values.recordId)},X=[{key:"Locked",condition:P,onClick:"onUnpostConfirmation",onSuccess:G,disabled:!z||!L},{key:"Unlocked",condition:!P,onClick:H,disabled:!z||!L},{key:"Close",condition:!L,onClick:()=>Q(q.values.recordId),disabled:P||L||!z},{key:"Reopen",condition:L,onClick:K,disabled:!L||P}],Y=[{component:"resourcelookup",label:e.reference,name:"soRef",props:{valueField:"reference",displayField:"reference",displayFieldWidth:1,endpointId:C.P.SalesOrder.snapshot,mapping:[{from:"recordId",to:"soId"},{from:"reference",to:"soRef"},{from:"date",to:"soDate"},{from:"clientId",to:"clientId"},{from:"clientRef",to:"clientRef"},{from:"clientName",to:"clientName"},{from:"volume",to:"soVolume"},{from:"szName",to:"szName"},{from:"wipName",to:"soWipStatusName"}],columnsInDropDown:[{key:"reference",value:"Reference"}],readOnly:P||L},onChange({row:{update:e,newRow:r}}){let a=r?.soDate?(0,N.a1)(r?.soDate):"";e({soDate:a})}},{component:"date",name:"soDate",label:e.date,props:{readOnly:!0}},{component:"textfield",label:e.client,name:"clientName",props:{readOnly:!0}},{component:"textfield",label:e.szName,name:"szName",props:{readOnly:!0}},{component:"textfield",label:e.volume,name:"soVolume",props:{readOnly:!0}},{component:"textfield",label:e.wip,name:"soWipStatusName",props:{readOnly:!0}}];async function ee(){let e={printStatus:2,recordId:q.values.recordId};await s({extension:O.U.TRP.flag,record:JSON.stringify(e)}),U()}return l.jsx(o.Z,{resourceId:x.i.Trip,form:q,maxAccess:$,editMode:z,actions:X,previewBtnClicked:ee,functionId:j.J.DeliveryTrip,disabledSubmit:P||L,previewReport:z,children:(0,l.jsxs)(I.R,{children:[l.jsx(V.g,{children:(0,l.jsxs)(n(),{container:!0,spacing:2,children:[l.jsx(n(),{item:!0,xs:12,children:(0,l.jsxs)(n(),{container:!0,xs:12,spacing:2,children:[l.jsx(n(),{item:!0,xs:4,children:l.jsx(T.Z,{endpointId:F.r.DocumentType.qry,parameters:`_dgId=${j.J.DeliveryTrip}&_startAt=0&_pageSize=1000`,filter:z?void 0:e=>1===e.activeStatus,name:"dtId",label:e.docType,readOnly:z,valueField:"recordId",displayField:"name",values:q.values,onChange:async(e,r)=>{q.setFieldValue("dtId",r?.recordId||""),R(r)},error:q.touched.dtId&&!!q.errors.dtId,maxAccess:$})}),l.jsx(n(),{item:!0,xs:4,children:l.jsx(g.Z,{name:"departureTime",label:e.departureDate,value:q.values?.departureTime,onChange:q.setFieldValue,onClear:()=>q.setFieldValue("departureTime",""),readOnly:P||L,error:q.touched.departureTime&&!!q.errors.departureTime,maxAccess:$,required:!0})}),l.jsx(n(),{item:!0,xs:4,children:l.jsx(T.Z,{endpointId:F.r.Plant.qry,name:"plantId",label:e.plant,valueField:"recordId",readOnly:P||L,displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:q.values,onChange:(e,r)=>{q.setFieldValue("plantId",r?r?.recordId:"")},error:q.touched.plantId&&!!q.errors.plantId,required:!0})})]})}),l.jsx(n(),{item:!0,xs:12,children:(0,l.jsxs)(n(),{container:!0,xs:12,spacing:2,children:[l.jsx(n(),{item:!0,xs:4,children:l.jsx(v.Z,{name:"reference",label:e.reference,value:q.values.reference,readOnly:z,maxAccess:$,onChange:q.handleChange,onClear:()=>q.setFieldValue("reference",""),error:q.touched.reference&&!!q.errors.reference})}),l.jsx(n(),{item:!0,xs:4,children:l.jsx(S.Z,{label:e.departureTime,name:"departureTimeField",value:q.values?.departureTimeField,onChange:q.setFieldValue,onClear:()=>q.setFieldValue("departureTimeField",""),readOnly:P||L,error:q.touched.departureTimeField&&!!q.errors.departureTimeField,maxAccess:$})}),l.jsx(n(),{item:!0,xs:4,children:l.jsx(T.Z,{endpointId:O.U.Driver.qry,name:"driverId",label:e.driver,valueField:"recordId",readOnly:P||L,displayField:"name",values:q.values,onChange:(e,r)=>{q.setFieldValue("driverId",r?r?.recordId:"")},error:q.touched.driverId&&!!q.errors.driverId})})]})}),l.jsx(n(),{item:!0,xs:12,children:(0,l.jsxs)(n(),{container:!0,xs:12,spacing:2,children:[l.jsx(n(),{item:!0,xs:4,children:l.jsx(g.Z,{name:"date",label:e.date,value:q.values?.date,onChange:q.setFieldValue,onClear:()=>q.setFieldValue("date",""),readOnly:P||L,error:q.touched.date&&!!q.errors.date,maxAccess:$})}),l.jsx(n(),{item:!0,xs:4,children:l.jsx(g.Z,{name:"arrivalTime",label:e.arrivalDate,value:q.values?.arrivalTime,onChange:(e,r)=>{q.setFieldValue("arrivalTime",r),r||q.setFieldValue("arrivalTimeField","")},onClear:()=>q.setFieldValue("arrivalTime",""),readOnly:P||L,error:q.touched.arrivalTime&&!!q.errors.arrivalTime,maxAccess:$})}),l.jsx(n(),{item:!0,xs:4,children:l.jsx(T.Z,{endpointId:O.U.Vehicle.qry,name:"vehicleId",label:e.vehicle,valueField:"recordId",readOnly:P||L,displayField:"name",values:q.values,onChange:(e,r)=>{q.setFieldValue("vehicleId",r?r?.recordId:"")},error:q.touched.vehicleId&&!!q.errors.vehicleId})})]})}),l.jsx(n(),{item:!0,xs:12,children:(0,l.jsxs)(n(),{container:!0,xs:12,spacing:2,children:[l.jsx(n(),{item:!0,xs:4}),l.jsx(n(),{item:!0,xs:4,children:l.jsx(S.Z,{label:e.arrivalTime,name:"arrivalTimeField",value:q.values?.arrivalTimeField,onChange:q.setFieldValue,onClear:()=>q.setFieldValue("arrivalTimeField",""),readOnly:P||L||!q.values?.arrivalTime,error:q.touched.arrivalTimeField&&!!q.errors.arrivalTimeField,maxAccess:$})}),l.jsx(n(),{item:!0,xs:4,children:l.jsx(b.Z,{name:"notes",type:"text",label:e.notes,value:q.values.notes,readOnly:P||L,rows:3,maxAccess:$,onChange:e=>q.setFieldValue("notes",e.target.value),onClear:()=>q.setFieldValue("notes",""),error:q.touched.notes&&!!q.errors.notes})})]})})]})}),l.jsx(f.Q,{children:l.jsx(u._,{onChange:e=>{q.setFieldValue("orders",e)},value:q?.values?.orders,error:q?.errors?.orders,columns:Y,allowDelete:!P&&!L,allowAddNewLine:!P&&!L})}),l.jsx(V.g,{children:(0,l.jsxs)(n(),{container:!0,rowGap:1,xs:10,spacing:2,pt:2,children:[l.jsx(n(),{item:!0,xs:5,children:l.jsx(v.Z,{name:"totalVolume",label:e.totVol,maxAccess:$,value:_,maxLength:"30",readOnly:!0,error:q.touched.totalVolume&&!!q.errors.totalVolume,helperText:q.touched.totalVolume&&q.errors.totalVolume})}),l.jsx(n(),{item:!0,xs:5,children:l.jsx(v.Z,{name:"totalWeight",label:e.totalWeight,maxAccess:$,value:J,maxLength:"30",readOnly:!0,error:q.touched.totalWeight&&!!q.errors.totalWeight,helperText:q.touched.totalWeight&&q.errors.totalWeight})})]})})]})})}[o,c,u,m,p,y,T,w]=D.then?(await D)():D,t()}catch(e){t(e)}})},68624:(e,r,a)=>{a.d(r,{Z:()=>o});var t=a(79660);a(6416);var l=a(82204),s=a(75281);let n=async(e,r,a)=>{try{let t=await e({extension:r,parameters:a});return r.includes("qry")?t:t.record}catch(e){return null}},d=(e,r,a,t)=>{let s=(e=JSON.parse(JSON.stringify(e))).record.controls,n=s.find(e=>"reference"===e.controlId);return n?n.accessLevel=r?.mandatory?l.$7:l.rr:r?.mandatory?s.push({sgId:0,resourceId:"",controlId:`${t?t+".":""}reference`,accessLevel:r?.mandatory?l.$7:l.rr}):r?.readOnly?s.push({sgId:0,resourceId:"",controlId:`${t?t+".":""}reference`,accessLevel:r?.readOnly?l.rr:l.$7}):s=e.record.controls.filter(e=>"reference"!=e.controlId),a&&s.push({sgId:0,resourceId:"",controlId:`${t?t+".":""}dtId`,accessLevel:l.$7}),{...e,record:{...e.record,controls:s}}},i=async(e,r,a)=>{let l,d;switch(a){case"dtId":let i=(0,s.m)("userData"),o=i?.userId;d=`_userId=${o}&_functionId=${r}`,l=t.r.UserFunction.get;break;case"glbSysNumberRange":d=`_recordId=${r}`,l=t.r.SystemFunction.get;break;case"DocumentType":d=`_dgId=${r}&_startAt=0&_pageSize=50`,l=t.r.DocumentType.qry;break;case"DcTypNumberRange":d=`_recordId=${r}`,l=t.r.DocumentType.get;break;case"isExternal":d=`_recordId=${r}`,l=t.r.NumberRange.get;break;default:return null}return await n(e,l,d)},o=async(e,r,a,t,l=!0,s)=>{let n,o,c,u;let m=void 0===t&&r&&await i(e,r,"dtId"),p=m?.dtId,x="",v=!0;if(m&&void 0===t||"nraId"===t){if(p){let r=await i(e,p,"DcTypNumberRange");n=r?.nraId,v=!(r?.activeStatus<0),n||(x="Assign the document type to a number range")}if((!p||!v)&&l&&r){let a=await i(e,r,"DocumentType");u=a?.list?.filter(e=>e?.activeStatus===1).length>0}}if(("nraId"===t||void 0===t)&&r){if((!p||p)&&!n||n&&!v){let a=await i(e,r,"glbSysNumberRange");(n=a?.nraId)&&u&&(u=!1),v=!0}x=n||u?"":"Assign the system Function to a number range"}t>0&&!n&&(n=t),n&&v?(c=await i(e,n,"isExternal"),o={readOnly:!c?.external,mandatory:!!c?.external},a&&(a=await d(a,o,u,s))):!n&&a&&(a=await d(a,o,u,s));let h=s?`${s}.reference`:"reference";return{dtId:p,resetReference:o?.readOnly,dcTypeRequired:u,reference:{fieldName:h,isEmpty:!(c?.external===void 0||c?.external)},errorMessage:x,maxAccess:a,selectNraId:t}}},75281:(e,r,a)=>{a.d(r,{m:()=>t});let t=e=>{let r=window.sessionStorage.getItem(e);return r?JSON.parse(r):null}},86794:(e,r,a)=>{a.a(e,async(e,t)=>{try{a.d(r,{G:()=>c,H:()=>u});var l=a(49752),s=a(16689),n=a(70305),d=a(68624),i=a(29352),o=e([l,n,i]);function c({functionId:e,action:r,hasDT:a}){let{getRequest:t}=(0,s.useContext)(i.$),{stack:l}=(0,n.V)();return{proxyAction:async()=>{let s=await (0,d.Z)(t,e,"",void 0,a);s?.errorMessage?l({message:s?.errorMessage}):await r()}}}function u({functionId:e,access:r,hasDT:a,enabled:t=!0,objectName:o=""}){let{getRequest:c}=(0,s.useContext)(i.$),{stack:u}=(0,n.V)(),[m,p]=(0,s.useState)(),x=async t=>{let l=await (0,d.Z)(c,e,r,t,a,o);if(!l.errorMessage)return l;u({message:l?.errorMessage})},v=(0,l.useQuery)({retry:!1,staleTime:0,enabled:t,queryKey:[e,m,!!r,t],queryFn:m||"nraId"===m?()=>x(m):()=>x()});return{documentType:v.data,maxAccess:v?.data?.maxAccess||r,changeDT(e){p(e?.nraId||"nraId")}}}[l,n,i]=o.then?(await o)():o,t()}catch(e){t(e)}})},20757:(e,r,a)=>{a.d(r,{Z:()=>f});var t=a(20997),l=a(16689),s=a(38361),n=a.n(s),d=a(92189),i=a.n(d),o=a(85753),c=a(88851),u=a(91664),m=a(81290),p=a(37918),x=a(10298),v=a(99535),h=a(66829),y=a(86085),I=a.n(y);let f=({name:e,label:r,value:a,onChange:s,error:d=!1,helperText:y="",disabledRangeTime:f={},variant:g="outlined",size:T="small",fullWidth:F=!0,required:j=!1,autoFocus:b=!1,disabled:w=!1,disabledTime:N=null,readOnly:O=!1,editMode:C=!1,hasBorder:V=!0,hidden:S=!1,use24Hour:k=!1,min:A=null,max:D=null,...Z})=>{let[$,R]=(0,l.useState)(!1),[U,q]=(0,l.useState)(!1),{_readOnly:W,_required:_,_hidden:J}=(0,h.W)(e,Z.maxAccess,j,O,S);return J?t.jsx(t.Fragment,{}):t.jsx(o.LocalizationProvider,{dateAdapter:x.AdapterDayjs,children:t.jsx(p.TimePicker,{variant:g,size:T,value:a,label:r,fullWidth:F,ampm:!k,minTime:A,maxTime:D,onFocus:()=>q(!0),onBlur:()=>q(!1),autoFocus:b,onChange:r=>s(e,r),onClose:()=>R(!1),open:$,disabled:w,readOnly:W,clearable:!0,slotProps:{textField:{required:_,size:T,fullWidth:F,error:!!d,helperText:"string"==typeof d?d:y,InputProps:{classes:{root:I().outlinedRoot,notchedOutline:V?I().outlinedFieldset:I().outlinedNoBorder,input:I().inputBase},endAdornment:!(W||w)&&(0,t.jsxs)(n(),{position:"end",className:I().inputAdornment,children:[a&&t.jsx(i(),{tabIndex:-1,className:I().iconButton,onClick:()=>s(e,null),children:t.jsx(c.Z,{className:I().icon})}),t.jsx(i(),{tabIndex:-1,className:I().iconButton,onClick:()=>R(!0),children:t.jsx(u.Z,{className:I().icon})})]})},InputLabelProps:{className:U||a?I().inputLabelShrink:I().inputLabel}},actionBar:{actions:["accept"]}},slots:{actionBar:e=>t.jsx(m.PickersActionBar,{...e,actions:["accept"]}),popper:e=>t.jsx(v.Z,{...e,matchAnchorWidth:!1,isDateTimePicker:!0})},...Z})})}}};