"use strict";exports.id=45516,exports.ids=[45516],exports.modules={45516:(e,n,r)=>{r.a(e,async(e,t)=>{try{r.d(n,{Z:()=>W});var a=r(20997),l=r(27736),d=r(79390),o=r(99155),i=r.n(o),s=r(16689),c=r(75609),u=r(80582),m=r(86201),p=r(29352),f=r(38509),y=r(6416),h=r(44619),g=r(65980),I=r(71278),x=r(79660),v=r(54242),b=r(68728),w=r(15051),k=r(18611),C=r(42020),j=r(23385),N=r(95965),F=r(60520),O=r(86794),R=r(59636),S=r(91184),D=r(99912),P=r(677),Z=r(97996),A=r(66559),q=r(93105),L=r(70638),$=r(38782),V=r(96119),J=e([u,m,p,f,I,w,F,O,D,P,A,L,$]);function W({recordId:e,window:n}){let{getRequest:r,postRequest:t}=(0,s.useContext)(p.$),{platformLabels:o,userDefaultsData:J}=(0,s.useContext)(F.l),{stack:W}=(0,P.zY)(),{labels:T,access:z}=(0,$.Z)({datasetId:y.i.ProductionOrder}),{documentType:E,maxAccess:_,changeDT:Q}=(0,O.H)({functionId:b.J.ProductionOrder,access:z,enabled:!e});(0,V.Z)({title:T.ProductionOrder,window:n});let U=parseInt(J?.list?.find(e=>"plantId"===e.key)?.value),G=(0,f.E)({endpointId:R.u.ProductionOrder.page}),{schema:M,requiredFields:B}=(0,q.m)({sku:e=>e?.sku,qty:e=>e?.qty!=null,jobCount:e=>e?.jobCount!=null,itemName:e=>e?.itemName},!0,_,"rows"),{formik:H}=(0,N.c)({maxAccess:_,documentType:{key:"dtId",value:E?.dtId},conditionSchema:["rows"],initialValues:{recordId:e,dtId:null,reference:"",plantId:U,lineId:null,notes:"",date:new Date,status:1,rows:[{id:1,poId:e,sku:"",itemName:"",qty:null,pcs:null,designId:null,jobCount:null,notes:"",seqNo:"",lineId:null,lineRef:""}]},validateOnChange:!0,validationSchema:c.object({date:c.date().required(),rows:c.array().of(M)}),onSubmit:async n=>{let{rows:r,date:a,...l}=n,i={...l,date:(0,d.ku)(a)},s=r?.filter(e=>Object.values(B)?.every(n=>n(e))).map((n,r)=>({...n,poId:e??0,deliveryDate:n.deliveryDate?d.ku(n.deliveryDate):null,seqNo:r+1})),c=await t({extension:R.u.ProductionOrder.set2,record:JSON.stringify({header:i,items:s})}),u=n.recordId?o.Edited:o.Added;m.default.success(u),G(),ea(c?.recordId)}}),K=!!H.values.recordId,Y=3===H.values.status,X=2===H.values.wip,ee=H.values?.rows?.reduce((e,n)=>{let r=parseFloat(n.qty)||0;return e+r},0).toFixed(2);async function en(){let e=await H.validateForm();Object.keys(e).length>0||(await t({extension:R.u.ProductionOrder.post,record:JSON.stringify({...H.values,date:(0,d.ku)(H.values.date)})}),m.default.success(o.Posted),n.close(),G())}async function er(){let e=await t({extension:R.u.Assembly.generate,record:JSON.stringify({poId:H.values.recordId})});W({Component:D.Z,props:{DialogText:e?.recordId||o.NoAssembliesGenerated,fullScreen:!1,close:!0,okButtonAction:()=>n.close()},width:500,height:150,title:e?.recordId?o.Success:o.Error})}let et=[{component:"resourcelookup",label:T.sku,name:"sku",width:100,props:{endpointId:v.$.Item.snapshot,valueField:"sku",displayField:"sku",mapping:[{from:"recordId",to:"itemId"},{from:"sku",to:"sku"},{from:"name",to:"itemName"}],columnsInDropDown:[{key:"sku",value:"SKU"},{key:"name",value:"Name"}],displayFieldWidth:3},async onChange({row:{update:e,newRow:n}}){let t,a;if(n?.itemId){let e=await r({extension:v.$.ItemProduction.get,parameters:`_recordId=${n.itemId}`});if(t=e?.record,t?.designId){let n=await r({extension:R.u.Design.get,parameters:`_recordId=${e.record?.designId}`});a=n?.record}}e({designId:t?.designId||null,designRef:t?.designRef||"",lineId:t?.lineId||null,lineRef:t?.lineRef||"",itemWeight:a?.stdWeight||null,routingId:a?.routingId||null,routingRef:a?.routingRef||"",routingName:a?.routingName||"",jobCount:1})}},{component:"textfield",label:T.itemName,name:"itemName",width:200,props:{readOnly:!0}},{component:"textfield",label:T.design,name:"designRef",width:200,props:{readOnly:!0}},{component:"numberfield",label:T.jobCount,name:"jobCount",width:100},{component:"resourcecombobox",label:T.prodLine,name:"lineId",props:{endpointId:R.u.ProductionLine.qry,valueField:"recordId",displayField:"reference",displayFieldWidth:2,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],mapping:[{from:"reference",to:"lineRef"},{from:"recordId",to:"lineId"},{from:"name",to:"lineName"}]},width:150},{component:"date",name:"deliveryDate",width:150,label:T?.deliveryDate},{component:"resourcelookup",label:T.routing,name:"routingName",width:150,props:{valueField:"reference",displayField:"reference",displayFieldWidth:2,endpointId:R.u.Routing.snapshot,mapping:[{from:"recordId",to:"routingId"},{from:"name",to:"routingName"},{from:"reference",to:"routingRef"}],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}]}},{component:"numberfield",name:"itemWeight",label:T.stdWeight,width:100,props:{maxLength:12,decimalScale:3,readOnly:!0},async onChange({row:{update:e,newRow:n}}){e({qty:n?.itemWeight*n?.pcs||0})}},{component:"numberfield",name:"pcs",label:T.ExPcs,width:100,props:{maxLength:4,decimalScale:0},async onChange({row:{update:e,newRow:n}}){e({qty:n?.itemWeight*n?.pcs||0})}},{component:"numberfield",name:"qty",width:100,label:T.ExQty,props:{maxLength:12,decimalScale:2}},{component:"resourcelookup",label:T.sizeRef,name:"sizeName",width:100,props:{endpointId:v.$.ItemSizes.snapshot,displayField:"reference",valueField:"reference",minChars:2,mapping:[{from:"recordId",to:"sizeId"},{from:"reference",to:"sizeRef"},{from:"name",to:"sizeName"}],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],displayFieldWidth:2}},{component:"resourcecombobox",label:T.jobCategory,name:"jobCategoryId",width:150,props:{endpointId:R.u.JobCategory.qry,valueField:"recordId",displayField:"name",displayFieldWidth:1.5,mapping:[{from:"name",to:"jobCategoryName"},{from:"recordId",to:"jobCategoryId"}]}},{component:"resourcelookup",label:T.client,name:"clientName",width:100,props:{endpointId:Z.P.Client.snapshot,displayField:"reference",valueField:"reference",displayFieldWidth:3,minChars:2,mapping:[{from:"recordId",to:"clientId"},{from:"reference",to:"clientRef"},{from:"name",to:"clientName"}],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}]}},{component:"textfield",label:T.notes,width:200,name:"notes"}];async function ea(e){let n=await r({extension:R.u.ProductionOrder.get2,parameters:`_recordId=${e}`}),t=n?.record?.items?.length?n?.record?.items?.map((e,n)=>({...e,deliveryDate:d.a1(e.deliveryDate),id:n+1})):H.initialValues.rows;return H.setValues({...n?.record?.header,date:(0,d.a1)(n?.record?.header?.date),rows:t}),n?.record}async function el(){W({Component:A.Z,props:{resourceId:y.i.ImportProductionOrder,access:_,staticColumns:[{field:"poRef",value:H.values.reference}],onSuccess:async()=>{e&&ea(e)}}})}let ed=async()=>{let e=await H.validateForm();Object.keys(e).length>0||(await t({extension:R.u.ProductionOrder.close,record:JSON.stringify(H.values)}),m.default.success(o.Closed),ea(H.values.recordId),G())},eo=async()=>{W({Component:L.Z,props:{functionId:b.J.ProductionOrder,recordId:H.values.recordId}})},ei=[{key:"RecordRemarks",condition:!0,onClick:"onRecordRemarks",disabled:!K},{key:"WorkFlow",condition:!0,onClick:eo,disabled:!K},{key:"Unlocked",condition:!Y,onClick:en,disabled:!K||!X},{key:"Locked",condition:Y,onClick:"onUnpostConfirmation",disabled:!0},{key:"Close",condition:!0,onClick:ed,disabled:X||!K},{key:"generate",condition:!0,onClick:er,disabled:!K},{key:"GenerateJob",condition:!0,onClick:es,disabled:!Y},{key:"Import",condition:!0,onClick:el,disabled:!K||Y||X},{key:"Refresh",condition:!0,onClick:ec,disabled:Y}];async function es(){let{rows:e,rsName:n,statusName:r,wipName:a,batchId:l,date:i,plantRef:s,plantName:c,isVerified:u,...p}=H.values;await t({extension:R.u.JobOrder.gen,record:JSON.stringify({...p,date:(0,d.ku)(i)})}),m.default.success(o.Generated)}async function ec(){await t({extension:R.u.RefreshPoItem.refresh,record:JSON.stringify(H.values)}),m.default.success(o.Refresh),ea(H.values.recordId)}return a.jsx(u.Z,{resourceId:y.i.ProductionOrder,functionId:b.J.ProductionOrder,form:H,maxAccess:_,actions:ei,editMode:K,previewReport:K,disabledSubmit:Y||X,children:(0,a.jsxs)(k.R,{children:[a.jsx(C.g,{children:(0,a.jsxs)(i(),{container:!0,spacing:2,children:[a.jsx(i(),{item:!0,xs:6,children:(0,a.jsxs)(i(),{container:!0,spacing:2,children:[a.jsx(i(),{item:!0,xs:12,children:a.jsx(I.Z,{endpointId:x.r.DocumentType.qry,parameters:`_startAt=0&_pageSize=1000&_dgId=${b.J.ProductionOrder}`,name:"dtId",label:T.documentType,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],readOnly:K,valueField:"recordId",displayField:["reference","name"],values:H.values,maxAccess:_,onChange:(e,n)=>{H.setFieldValue("dtId",n?.recordId||null),Q(n)},error:H.touched.dtId&&!!H.errors.dtId})}),a.jsx(i(),{item:!0,xs:12,children:a.jsx(h.Z,{name:"reference",label:T.reference,value:H?.values?.reference,maxAccess:!K&&_,maxLength:"30",readOnly:K,onChange:H.handleChange,onClear:()=>H.setFieldValue("reference",""),error:H.touched.reference&&!!H.errors.reference})}),a.jsx(i(),{item:!0,xs:12,children:a.jsx(l.Z,{name:"date",label:T.date,readOnly:Y||X,value:H?.values?.date,onChange:H.setFieldValue,required:!0,maxAccess:_,onClear:()=>H.setFieldValue("date",null),error:H.touched.date&&!!H.errors.date})})]})}),a.jsx(i(),{item:!0,xs:6,children:(0,a.jsxs)(i(),{container:!0,spacing:2,children:[a.jsx(i(),{item:!0,xs:12,children:a.jsx(I.Z,{endpointId:x.r.Plant.qry,name:"plantId",label:T.plant,readOnly:Y||X,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:H.values,valueField:"recordId",displayField:["reference","name"],maxAccess:_,onChange:(e,n)=>{H.setFieldValue("plantId",n?.recordId)},error:H.touched.plantId&&!!H.errors.plantId})}),a.jsx(i(),{item:!0,xs:12,children:a.jsx(I.Z,{endpointId:R.u.ProductionLine.qry,name:"lineId",label:T.prodLine,readOnly:Y||X,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:H.values,valueField:"recordId",displayField:["reference","name"],maxAccess:_,onChange:(e,n)=>{H.setFieldValue("lineId",n?.recordId)},error:H.touched.lineId&&!!H.errors.lineId})}),a.jsx(i(),{item:!0,xs:12,children:a.jsx(g.Z,{name:"notes",label:T.description,value:H?.values?.notes,rows:2.5,readOnly:Y||X,maxAccess:_,onChange:H.handleChange,onClear:()=>H.setFieldValue("notes",""),error:H.touched.notes&&!!H.errors.notes})})]})})]})}),a.jsx(j.Q,{children:a.jsx(w._,{onChange:e=>H.setFieldValue("rows",e),value:H.values.rows,error:H.errors.rows,name:"rows",maxAccess:_,initialValues:H?.initialValues?.rows?.[0],columns:et,allowAddNewLine:!Y&&!X,allowDelete:!Y&&!X,disabled:Y||X})}),a.jsx(C.g,{children:a.jsx(i(),{container:!0,xs:6,children:a.jsx(S.Z,{name:"totalQty",label:T.totalQty,maxAccess:_,value:ee,maxLength:"30",readOnly:!0,error:H.touched.totalQty&&!!H.errors.totalQty})})})]})})}[u,m,p,f,I,w,F,O,D,P,A,L,$]=J.then?(await J)():J,W.width=1200,W.height=680,t()}catch(e){t(e)}})},66559:(e,n,r)=>{r.a(e,async(e,t)=>{try{r.d(n,{Z:()=>S});var a=r(20997),l=r(16689),d=r(99155),o=r.n(d),i=r(86201),s=r(42020),c=r(23385),u=r(18611),m=r(24644),p=r(44619),f=r(40711),y=r(79390),h=r(29352),g=r(79660),I=r(70305),x=r(96119),v=r(60520),b=r(18687),w=r(70755),k=e([i,m,f,h,I,v,b]);[i,m,f,h,I,v,b]=k.then?(await k)():k;let C=e=>{let[n,r,t]=e.split("/").map(e=>parseInt(e,10));return new Date(Date.UTC(t<100?2e3+t:t,r-1,n,0,0,0)).toISOString().split(".")[0]+"Z"},j=(e,n,r=!1)=>{if(""===e)return e;switch(n){case 2:return parseInt(e,10);case 3:return parseFloat(e);case 5:return r?C(e):(0,y.L6)((0,y.p6)(e));default:return e}},N=(e,n,r=[])=>{let t=e.split("\n").filter(e=>e.trim());if(!t.length)return{count:0,list:[]};let a=t[0].split(",").map(e=>e.trim()),l=n.reduce((e,n)=>(e[n.headerName]=n,e),{}),d=a.map(e=>l[e]),o=t.slice(1).map((e,n)=>{let t=e.split(",").map(e=>e.trim()),l=d.reduce((e,n,r)=>{let l=a[r];return n?e[n.field]=j(t[r],n.dataType):e[l]=t[r],e},{recordId:n+1});return r.forEach(e=>{a.includes(e.field),l[e.field]=e.value}),l.minPrice&&(l.minPrice=parseFloat(l.minPrice)||0),l});return{count:o.length,list:o}},F=(e,n,r)=>{let t=n.filter(e=>e.mandatory),a=e.flatMap(e=>t.filter(n=>null===e[n.field]||void 0===e[n.field]||""===e[n.field]).map(e=>e.headerName)),l=[...new Set(a)];return!l.length||(r({message:`${l.join(", ")} ${l.length>1?"are":"is"} mandatory.`}),!1)},O=(e,n,r)=>{let t=n.filter(e=>e.mandatory),a=e.list.flatMap(e=>t.filter(n=>null===e[n.field]||void 0===e[n.field]||""===e[n.field]).map(e=>e.headerName));if(a.length>0){let e=[...new Set(a)];r({message:`${e.join(", ")} ${e.length>1?"are":"is"} mandatory field${e.length>1?"s":""}.`})}return e.list.map(e=>Object.keys(e).reduce((r,t)=>{let a=n.find(e=>e.field===t),l=e[t];return l=""===l?null:l,r[t]=a?j(l,a.dataType,!0):l,r},{}))},R=({staticColumns:e=[],onSuccess:n,resourceId:r,access:t,window:d})=>{let{stack:y}=(0,I.V)(),{getRequest:k,postRequest:C}=(0,l.useContext)(h.$),{platformLabels:j}=(0,l.useContext)(v.l),[R,S]=(0,l.useState)(null),[D,P]=(0,l.useState)({count:0,list:[]}),[Z,A]=(0,l.useState)(null),q=(0,l.useRef)(null);if((0,x.Z)({title:j.import,window:d}),(0,l.useEffect)(()=>{r&&k({extension:g.r.ETL.get,parameters:`_resourceId=${r}`}).then(e=>{e.record&&S(e)})},[r]),!R?.record)return null;let L=R.record.fields?.map(({name:e,dataType:n,format:r,...t})=>({field:e,headerName:e,width:130,type:2===n&&"1"===r||3===n?"number":void 0,dataType:n,...t}))||[],$=L.map(e=>e.field),V=[...e.filter(e=>!$.includes(e.field)).map(e=>({field:e.field,headerName:e.field,width:130,dataType:1,readOnly:!0})),...L],J=R.record.objectName,W=R.record.endPoint,T=async()=>{let e=F(D.list,V,y),r=O(D,V,y);if(!e)return;let t=await C({extension:W,record:JSON.stringify({[J]:r})});n?.(t),i.default.success(j.Imported),d&&d.close()},z=[{key:"Import",condition:!0,onClick:T,disabled:!Z?.name}];return a.jsx(b.Z,{onSave:T,disabledSubmit:!Z?.name,isSaved:!1,actions:z,maxAccess:t,isParentWindow:!1,children:(0,a.jsxs)(u.R,{children:[a.jsx(s.g,{children:a.jsx(m.Z,{leftSection:a.jsx(o(),{container:!0,spacing:2,alignItems:"center",children:a.jsx(o(),{item:!0,xs:4,children:(0,a.jsxs)(o(),{item:!0,sx:{display:"flex",mr:2},children:[a.jsx(p.Z,{name:"name",label:j?.SelectCSV,value:Z?.name,readOnly:!0,disabled:!!Z?.name}),a.jsx(w.Z,{label:`${j?.Browse}...`,disabled:!!Z?.name,onClick:()=>q.current.click(),style:{marginLeft:2}}),a.jsx("input",{type:"file",accept:".csv",ref:q,style:{display:"none"},onChange:n=>{let r=n.target.files[0];if(A(r),r){let n=new FileReader;n.onload=n=>{let r=N(n.target.result,V,e);P(r)},n.readAsText(r)}}}),a.jsx(w.Z,{image:"clear.png",tooltipText:j?.Clear,onClick:()=>{A(null),P({count:0,list:[]}),q.current&&(q.current.value=null)},style:{marginLeft:2,backgroundColor:"#f44336",padding:0}})]})})})})}),a.jsx(c.Q,{children:a.jsx(f.Z,{name:"import",columns:[{field:"recordId",headerName:"",width:130},...V],gridData:D,rowId:["recordId"],isLoading:!1,pageSize:50,paginationType:"api",pagination:!1,maxAccess:t,textTransform:!0})})]})})};R.width=1e3,R.height=600;let S=R;t()}catch(e){t(e)}})}};