"use strict";exports.id=30295,exports.ids=[30295],exports.modules={30295:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.d(t,{Z:()=>G});var d=a(20997),l=a(27736),n=a(79390),s=a(99155),i=a.n(s),o=a(86049),u=a(16689),c=a(75609),m=a(80582),h=a(86201),y=a(29352),v=a(38509),p=a(6416),x=a(44619),I=a(65980),b=a(71278),f=a(79660),g=a(54242),P=a(68728),A=a(61274),F=a(23385),j=a(15051),k=a(18611),V=a(42020),q=a(91184),C=a(13567),D=a(66198),w=a(95965),T=a(70638),O=a(677),N=a(60520),S=a(82173),R=a(57629),Z=a(42614),$=a(86794),M=a(97969),_=a(33150),Q=a(24356),W=a(67906),L=a(70755),B=a(70305),H=a(99912),E=a(93105),J=a(96119),X=a(38782),U=e([m,h,y,v,b,A,j,T,O,N,$,_,Q,B,H,X]);function G({recordId:e,window:t}){let{getRequest:r,postRequest:s}=(0,u.useContext)(y.$),{stack:U}=(0,O.zY)(),{platformLabels:G,defaultsData:Y,userDefaultsData:z}=(0,u.useContext)(N.l),[K,ee]=(0,u.useState)([]),et=(0,u.useRef)([]),[ea,er]=(0,u.useState)(!1),ed=P.J.PurchaseOrder,{stack:el}=(0,B.V)(),{labels:en,access:es}=(0,X.Z)({datasetId:p.i.PurchaseTransactions,editMode:!!e});(0,J.Z)({title:en.purchaseOrder,window:t});let ei=parseInt(z?.list?.find(e=>"plantId"===e.key)?.value),eo=parseInt(Y?.list?.find(e=>"currencyId"===e.key)?.value),[eu,ec]=(0,u.useState)({text:"%",value:2}),{documentType:em,maxAccess:eh}=(0,$.H)({functionId:ed,access:es,enabled:!e,objectName:"header"}),ey={recordId:e,requestId:null,requestRef:null,currentDiscount:0,import:!1,header:{status:1,wip:1,releaseStatus:null,dtId:null,functionId:ed,recordId:null,date:new Date,deliveryDate:null,reference:"",isVattable:!1,currencyId:eo,plantId:ei,subtotal:0,vatAmount:0,miscAmount:0,amount:0,description:"",tdType:eu.value,tdPct:0,tdAmount:0,volume:0,weight:0,qty:0,vendorId:null,vendorName:"",vendorRef:"",paymentMethod:null,exWorks:!1,deliveryStatus:null,vendorDocRef:"",deliveryMethodId:null,ptId:null,taxId:null},items:[{id:1,poSeqNo:"",poId:0,seqNo:null,componentSeqNo:null,itemId:null,sku:"",itemName:"",trackingStatusId:null,trackingStatusName:"",muId:null,spId:null,qty:0,baseQty:0,unitPrice:null,baseLaborPrice:0,isMetal:!1,metalId:null,metalPurity:0,basePrice:0,mdType:S.Xo,mdValue:0,mdAmount:0,pieces:0,extendedPrice:0,applyVat:!1,vatAmount:0,vatPct:0,unitCost:0,priceType:0,weight:0,volume:0,notes:"",upo:0,poRef:"",trackBy:"",lotCategoryId:null,taxId:null,deliveryDate:null,requestId:null,requestRef:"",requestSeqNo:null,receivedQty:0,invoicedQty:0,msId:null,muRef:"",muQty:0,netUnitPrice:0,netUnitPriceVariation:0}]},ev=(0,v.E)({endpointId:C.y.PurchaseOrder.page}),{schema:ep,requiredFields:ex}=(0,E.m)({sku:e=>e?.sku,itemName:e=>e?.itemName,qty:e=>e?.qty>0},!0,eh,"items"),{formik:eI}=(0,w.c)({maxAccess:eh,documentType:{key:"header.dtId",value:em?.dtId},conditionSchema:["items"],initialValues:ey,validateOnChange:!0,validationSchema:c.object({header:c.object({date:c.date().required(),currencyId:c.number().required(),vendorId:c.number().required()}),items:c.array().of(ep)}),onSubmit:async e=>{let t={header:{...e.header,date:(0,n.ku)(e.header.date),tdPct:e.header.tdPct||0,tdAmount:e.header.tdAmount||0},items:e.items.filter(e=>Object.values(ex)?.every(t=>t(e))).map(({id:e,isVattable:t,taxDetails:a,...r})=>({...r,seqNo:e,applyVat:t,deliveryDate:r.deliveryDate?(0,n.ku)(r.deliveryDate):null}))},a=await s({extension:C.y.PurchaseOrder.set2,record:JSON.stringify(t)});h.default.success(e?.recordId?G.Edited:G.Added),await eY(a.recordId),ev()}}),eb=!!eI.values.header.recordId;async function ef(e,t){if(!e)return;let a=K?.filter(e=>e.msId===t)||[];et.current=a}let eg=[{component:"resourcelookup",label:en.sku,name:"sku",flex:2,props:{endpointId:g.$.Item.snapshot,parameters:{_categoryId:0,_msId:0,_startAt:0,_size:1e3},filter:{purchaseItem:!0},displayField:"sku",valueField:"sku",mapping:[{from:"recordId",to:"itemId"},{from:"sku",to:"sku"},{from:"name",to:"itemName"},{from:"msId",to:"msId"},{from:"isInactive",to:"isInactive"}],columnsInDropDown:[{key:"sku",value:"SKU"},{key:"name",value:"Name"},{key:"flName",value:"FL Name"}],displayFieldWidth:5,minChars:2},async onChange({row:{update:e,newRow:t}}){if(!t?.itemId){e({enabled:!1});return}if(t.isInactive){e({...eI.initialValues.items[0],id:t.id}),el({message:en.inactiveItem});return}ef(t?.itemId,t?.msId);let a=await eM(t.itemId);e(a)}},{component:"textfield",label:en.itemName,name:"itemName",flex:3,props:{readOnly:!0}},{component:"resourcecombobox",label:en.mu,name:"muRef",props:{store:et?.current,displayField:"reference",valueField:"recordId",mapping:[{from:"reference",to:"muRef"},{from:"qty",to:"muQty"},{from:"recordId",to:"muId"}]},async onChange({row:{update:e,newRow:t}}){if(t){let a=et?.current.filter(e=>e.recordId===t?.muId),r=t?.qty*a?.muQty;e({qtyInBase:r,muQty:t?.muQty})}},propsReducer:({props:e})=>({...e,store:et?.current})},{component:"numberfield",label:en.quantity,name:"qty",updateOn:"blur",props:{decimalScale:3},async onChange({row:{update:e,newRow:t}}){let a=e_(t,S.bT);e(a)}},{component:"numberfield",label:en.volume,name:"volume",props:{decimalScale:2,readOnly:!0}},{component:"numberfield",label:en.weight,name:"weight",props:{decimalScale:2,readOnly:!0}},{component:"numberfield",label:en.baseprice,name:"basePrice",updateOn:"blur",props:{decimalScale:5},async onChange({row:{update:e,newRow:t}}){let a=e_(t,S.yO);e(a)}},{component:"textfield",label:en.requestRef,name:"requestRef",props:{readOnly:!0}},{component:"numberfield",label:en.unitCost,name:"unitPrice",updateOn:"blur",props:{decimalScale:3},async onChange({row:{update:e,newRow:t}}){let a=e_(t,S.Xf);e(a)}},{component:"button",name:"costHistory",props:{imgSrc:a(98570).default.src,onCondition:e=>({disabled:!e.itemId})},label:en.costHistory,onClick:(e,t)=>{U({Component:_.Z,props:{itemId:t?.itemId,obj:t}})}},{component:"numberfield",label:en.VAT,name:"vatAmount",props:{decimalScale:2,readOnly:!0}},{component:"button",name:"taxDetails",props:{onCondition:e=>e.itemId&&e.taxId?{imgSrc:a(36778).default.src,hidden:!1}:{imgSrc:"",hidden:!0}},label:en.tax,onClick:(e,t)=>{U({Component:Q.Z,props:{taxId:t?.taxId,obj:t}})}},{component:"numberfield",label:en.markdown,name:"mdAmount",updateOn:"blur",flex:2,props:{decimalScale:2,ShowDiscountIcons:!0,iconsClicked:eA,type:"numeric",iconKey:({value:e,data:t})=>(e?.mdType||t?.mdType)===S.Xo?"%":"123"},async onChange({row:{update:e,newRow:t}}){let a=e_(t,S.On);e(a)}},{component:"numberfield",label:en.extendedCost,name:"extendedPrice",updateOn:"blur",props:{decimalScale:2},async onChange({row:{update:e,newRow:t}}){let a=e_(t,S.bh);e(a)}},{component:"textfield",label:en.notes,name:"notes"},{component:"date",label:en.deliveryDate,name:"deliveryDate"}];function eP(e,t,a){let r=parseFloat(e)||0;return t===a?(r<0||r>100)&&(r=0):r<0&&(r=0),r}async function eA({updateRow:e,value:t,data:a}){let r=(t?.mdType||a?.mdType)===S.Xo?S.RD:S.Xo,d=eP(t?.mdAmount,r,S.Xo);e({id:a.id,changes:{mdAmount:d,mdAmountPct:r,mdType:r},commitOnBlur:!0})}console.log(eI);let eF=async()=>{await s({extension:C.y.PurchaseOrder.transfer,record:JSON.stringify({...eI.values.header,date:(0,n.ku)(eI.values.header.date)})}).then(()=>{h.default.success(G.Posted),ev(),eY(eI?.values?.header.recordId)})},ej=async()=>{await s({extension:C.y.PurchaseOrder.terminate,record:JSON.stringify({...eI.values.header,date:(0,n.ku)(eI.values.header.date)})}).then(()=>{h.default.success(G.Saved),ev(),eY(eI?.values?.header.recordId)})},ek=async()=>{await s({extension:C.y.PurchaseOrder.close,record:JSON.stringify({...eI.values.header,date:(0,n.ku)(eI.values.header.date)})}).then(()=>{h.default.success(G.Closed),ev(),eY(eI?.values?.header.recordId)})},eV=async()=>{await s({extension:C.y.PurchaseOrder.reopen,record:JSON.stringify({...eI.values.header,date:(0,n.ku)(eI.values.header.date)})}).then(()=>{h.default.success(G.Reopened),ev(),eY(eI?.values?.header.recordId)})};async function eq(){let e=await eI.validateForm();if(Object.keys(e).length){let t=Object.keys(e?.header||{}).reduce((e,t)=>((eI.touched.header||{})[t]||(e[t]=!0),e),{}),a=e?.items?.reduce((e,t,a)=>((eI.touched.items||[])[a]||(e[a]=!0),e),{});a&&(Object.keys(t).length||Object.keys(a).length)&&eI.setTouched({...eI.touched,header:t,items:a},!0)}}let eC=2===eI.values.header.wip,eD=[{key:"RecordRemarks",condition:!0,onClick:"onRecordRemarks",disabled:!eb},{key:"WorkFlow",condition:!0,onClick:()=>{U({Component:T.Z,props:{functionId:ed,recordId:eI.values.header.recordId}})},disabled:!eb},{key:"Terminate",condition:!0,onClick:()=>{U({Component:H.Z,props:{DialogText:G.terminateConfirmation,okButtonAction:async()=>{await ej()},fullScreen:!1,close:!0},width:500,height:150,title:G.Confirmation})},disabled:!((2==eI.values.header.deliveryStatus||1==eI.values.header.deliveryStatus)&&4==eI.values.header.status)},{key:"Invoice",condition:!0,onClick:eF,disabled:!(3!==eI.values.header.status&&eC&&4===eI.values.header.status)},{key:"Close",condition:!eC,onClick:ek,disabled:eC||!eb},{key:"Reopen",condition:eC,onClick:eV,disabled:!eC||4===eI.values.header.deliveryStatus||3==eI.values.header.status||!eb},{key:"Attachment",condition:!0,onClick:"onClickAttachment",disabled:!eb},{key:"Approval",condition:!0,onClick:"onApproval",disabled:!eC}];async function ew(e){let t=e?.header,a=e?.items;t?.tdType===1||t?.tdType==null?ec({text:"123",value:1}):ec({text:"%",value:2});let r=await Promise.all(a?.map(async(e,t)=>{let a=e?.taxId&&await eR(e.taxId);return{...e,id:t+1,basePrice:e.basePrice?e.basePrice:0,unitPrice:e.unitPrice?e.unitPrice:0,vatAmount:e.vatAmount?e.vatAmount:0,extendedPrice:e.extendedPrice?e.extendedPrice:0,deliveryDate:n.a1(e.deliveryDate),puTrx:!0,taxDetails:a}}));eI.setValues({recordId:t.recordId||null,dtId:t.dtId||null,currentDiscount:t?.tdType==1||t?.tdType==null?t?.tdAmount:t?.tdPct,header:{...eI.values.header,...t,amount:parseFloat(t?.amount).toFixed(2),date:(0,n.a1)(t?.date),deliveryDate:t?.deliveryDate&&(0,n.a1)(t?.deliveryDate)},items:r.length>0?r:eI?.initialValues?.items})}async function eT(e){return(await r({extension:C.y.PurchaseOrder.get2,parameters:`_poId=${e}`})).record}async function eO(e){let t=e?.tradeDiscount?Z.a$:eI.values.header.tdType;t==Z.a$&&ec({text:"%",value:2}),eI.setValues({...eI.values,currentDiscount:e?.tradeDiscount||0,header:{...eI.values.header,vendorId:e?.recordId,vendorName:e?.name,vendorRef:e?.reference,isVattable:e?.isTaxable||!1,tdAmount:e?.tradeDiscount,tdPct:e?.tradeDiscount,tdType:t,taxId:e?.taxId,paymentMethod:e?.paymentMethod}})}async function eN(e){let t=await r({extension:g.$.ItemPhysProp.get,parameters:`_itemId=${e}`});return t?.record}async function eS(e){let t=await r({extension:g.$.Item.get,parameters:`_recordId=${e}`});return t?.record}async function eR(e){let t=await r({extension:D.H.TaxDetailPack.qry,parameters:`_taxId=${e}`});return t?.list}async function eZ(e){let{vendorId:t,currencyId:a}=eI.values.header,d=await r({extension:C.y.VendorPrice.get,parameters:`_itemId=${e}&_vendorId=${t}&_currencyId=${a}&_functionId=${ed}`});return d?.record}async function e$(e,t,a){let r=e?.weight||0,d=e?.metalPurity??0,l=e?.isMetal??!1,n=e?.metalId??null,s=a?a.priceList:0,i=a?a.baseLaborPrice:0,o=null,u=null;if(eI.values.header.taxId){let e=(await eR(eI.values.header.taxId)).map(e=>({invoiceId:eI.values.recordId||0,taxSeqNo:e.seqNo,taxId:eI.values.header.taxId,taxCodeId:e.taxCodeId,taxBase:e.taxBase,amount:e.amount}));o=eI.values.header.taxId,u=e}else if(t.taxId){let e=(await eR(t.taxId)).map(e=>({invoiceId:eI.values.recordId||0,taxSeqNo:e.seqNo,taxId:t.taxId,taxCodeId:e.taxCodeId,taxBase:e.taxBase,amount:e.amount}));o=t.taxId,u=e}let c=K?.filter(e=>e.msId===t?.msId);return{sku:t?.sku||"",itemName:t?.name||"",itemId:t?.recordId||null,isMetal:l,metalId:n,metalPurity:d,volume:e?.volume||0,weight:r,basePrice:0,baseLaborPrice:i,TotPricePerG:i,unitPrice:s,priceType:t?.priceType||1,qty:0,msId:t?.msId,muRef:c?.[0]?.reference,muId:c?.[0]?.recordId,muQty:c?.[0]?.qty,mdAmount:0,mdValue:0,mdType:1,extendedPrice:0,mdValue:0,taxId:o,taxDetails:u}}async function eM(e,t){let a=await eN(e),r=await eS(e),d=t?"":await eZ(e);return await e$(a,r,d)}async function eR(e){let t=await r({extension:D.H.TaxDetailPack.qry,parameters:`_taxId=${e}`});return t?.list}function e_(e,t,a){ea||er(!0);let r=eP(e?.mdAmount,e?.mdType,S.Xo),d=(0,S.Ch)({priceType:e?.priceType,basePrice:e?.basePrice||0,volume:e?.volume||0,weight:e?.weight,unitPrice:e?.unitPrice||0,upo:0,qty:e?.qty,extendedPrice:e?.extendedPrice,mdAmount:r,mdType:e?.mdType,mdValue:e?.mdValue,baseLaborPrice:0,totalWeightPerG:e?.totalWeightPerG||0,tdPct:eI?.values?.header?.tdPct||0,dirtyField:t});e?.taxDetails?.length>0&&(e.taxDetails=[e.taxDetails[0]]);let l=(0,R.VW)({priceType:d?.priceType,basePrice:d?.basePrice,unitPrice:d?.unitPrice,qty:d?.qty,weight:d?.weight,extendedPrice:d?.extendedPrice,baseLaborPrice:d?.baseLaborPrice,vatAmount:d?.vatAmount||0,tdPct:eI?.values?.header?.tdPct,taxDetails:!0===eI.values.header.isVattable?e.taxDetails:null}),n=d?.qty*e?.muQty,s={...e,id:e?.id,qty:d?.qty?d?.qty:0,baseQty:n||0,volume:d?.volume?d.volume:0,weight:d?.weight?d.weight:0,basePrice:d?.basePrice?d.basePrice:0,unitPrice:d?.unitPrice?d.unitPrice:0,extendedPrice:d?.extendedPrice?d.extendedPrice:0,mdValue:d?.mdValue,mdType:d?.mdType,mdAmount:d?.mdAmount?d.mdAmount:0,vatAmount:l?.vatAmount?l.vatAmount:0};return a?{changes:s}:s}let eQ=eI.values.items?.filter(e=>void 0!==e.itemId).map(e=>({...e,basePrice:e.basePrice||0,unitPrice:e.unitPrice||0,vatAmount:e?.vatAmount?e.vatAmount:0,weight:e.weight||0,volume:e.volume||0,extendedPrice:e.extendedPrice||0})),eW=(0,Z.Ww)(eQ),eL=0==eI.values.miscAmount?0:parseFloat(eI.values.header.miscAmount),eB=(0,Z.Ot)(eQ,{totalQty:0,totalWeight:0,totalVolume:0,sumVat:0,sumExtended:parseFloat(eW),tdAmount:parseFloat(eI.values.header.tdAmount),net:0,miscAmount:eL||0}),eH=ea?eB?.totalQty:eI.values?.header?.qty||0,eE=ea?eB?.net:eI.values?.header.amount||0,eJ=ea?eB?.totalVolume:eI.values?.header.volume||0;ea?eB?.totalWeight:eI.values?.header.weight;let eX=ea?eW:eI.values?.header.subtotal||0,eU=ea?eB?.sumVat:eI.values?.header.vatAmount||0;async function eG(e,t,a,r){var d;d=function(e,t,a,r){let d=(0,Z.Yi)({tdAmount:parseFloat(r),tdPlain:1==e,tdPct:2==e,tdType:e,subtotal:eX,currentDiscount:r,hiddenTdPct:t,hiddenTdAmount:parseFloat(a),typeChange:e});return eI.setFieldValue("header.tdAmount",d?.hiddenTdAmount?d?.hiddenTdAmount?.toFixed(2):0),eI.setFieldValue("header.tdType",d?.tdType),eI.setFieldValue("currentDiscount",d?.currentDiscount||0),eI.setFieldValue("header.tdPct",d?.hiddenTdPct||0),d?.hiddenTdPct}(e,t,a,r),eI.values.items.map((e,t)=>{if(e?.taxDetails?.length>0&&(e.taxDetails=[e.taxDetails[0]]),!e.requestId){let a=(0,R.VW)({priceType:e?.priceType,basePrice:e?.basePrice,qty:e?.qty,weight:e?.weight,extendedPrice:e?.extendedPrice,baseLaborPrice:parseFloat(e?.baseLaborPrice),vatAmount:e?.vatAmount,tdPct:d,taxDetails:!0===eI.values.header.isVattable?e.taxDetails:null});eI.setFieldValue(`items[${t}].vatAmount`,a?.vatAmount)}})}async function eY(e){let t=await eT(e);t&&ew(t)}let ez=async()=>{let e=await r({extension:C.y.QuotationItem.preview,parameters:`_requestId=${eI.values.requestId}&_vendorId=${eI.values.header.vendorId}`}),t=e.list?.reduce((e,t)=>(e[t.requestSeqNo]={unitPrice:parseFloat(t.unitPrice)?.toFixed(2),basePrice:parseFloat(t.unitPrice)?.toFixed(2)},e),{});eI.values.items.forEach((e,a)=>{let{unitPrice:r,basePrice:d}=t[e?.requestSeqNo]||{};void 0!==r&&(eI.setFieldValue(`items[${a}].unitPrice`,r),eI.setFieldValue(`items[${a}].basePrice`,d),eI.setFieldValue(`items[${a}].vatAmount`,0),eI.setFieldValue(`items[${a}].extendedPrice`,r*e.qty||0))})},eK=async()=>{if(eq(),Object.entries(eI?.errors.header||{}).filter(([e])=>e).length>0)return;if(!eI.values.header.vendorId){eI.setFieldTouched("header.vendorId",!0);return}let e=await r({extension:C.y.RequisitionDetail.qry,parameters:`_trxId=${eI.values.requestId}`});if(e.list.length<1){el({message:en.noItemsToImport});return}if(eI.values.items.find(e=>e.requestId==eI.values.requestId)){el({message:en.allItemsAreImported});return}eI.setFieldValue("import",!0);let t=eI.values.items.length&&eI.values.items[0]?.sku?eI.values.items?.length+1:1,a=await Promise.all(e.list.map(async e=>{let a=await eM(e.itemId,!0),r=["muId","isMetal","metalPurity","msId","muRef","muQty","metalId","baseLaborPrice","TotPricePerG"],d=Object.keys(a).filter(e=>!r.includes(e)).reduce((e,t)=>(e[t]=a[t],e),{});return{id:t++,...d,qty:e.baseQty,requestRef:eI.values.requestRef,requestId:eI.values.requestId,deliveryDate:(0,n.a1)(e.deliveryDate),requestSeqNo:e.seqNo,unitPrice:0,vatAmount:0,baseQty:0,mdAmountPct:1}}));eI.setFieldValue("items",eI.values.items?.length>0&&eI.values.items[0]?.sku?[...eI.values.items,...a]:a)};return d.jsx(m.Z,{resourceId:p.i.PurchaseTransactions,form:eI,functionId:ed,maxAccess:eh,previewReport:eb,actions:eD,editMode:eb,disabledSubmit:eC,children:(0,d.jsxs)(k.R,{children:[d.jsx(V.g,{children:(0,d.jsxs)(i(),{container:!0,spacing:2,children:[d.jsx(i(),{item:!0,xs:3,children:(0,d.jsxs)(i(),{container:!0,spacing:2,children:[d.jsx(i(),{item:!0,xs:12,children:d.jsx(b.Z,{endpointId:f.r.DocumentType.qry,parameters:`_startAt=0&_pageSize=1000&_dgId=${P.J.PurchaseOrder}`,name:"header.dtId",readOnly:eb,label:en.documentType,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],valueField:"recordId",displayField:["reference","name"],values:eI.values.header,maxAccess:eh,onChange:(e,t)=>{t?.recordId&&eI.setFieldTouched("header.dtId",!1),eI.setFieldValue("header.dtId",t?.recordId||null)},error:eI.touched.header?.dtId&&!!eI.errors.header?.dtId})}),d.jsx(i(),{item:!0,xs:12,children:d.jsx(x.Z,{name:"header.reference",label:en.reference,value:eI?.values?.header?.reference,maxAccess:!eb&&eh,readOnly:eb,onChange:eI.handleChange,onClear:()=>eI.setFieldValue("header.reference",""),error:eI.touched.header?.reference&&!!eI.errors.header?.reference})}),d.jsx(i(),{item:!0,xs:12,children:d.jsx(A.U,{endpointId:C.y.Vendor.snapshot,name:"header.vendorId",label:en.vendor,valueField:"reference",displayField:"name",valueShow:"vendorRef",secondValueShow:"vendorName",formObject:eI.values.header,form:eI,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"},{key:"flName",value:"FL Name"}],onChange:(e,t)=>eO(t),secondFieldName:"header.vendorName",onSecondValueChange:(e,t)=>eI.setFieldValue("header.vendorName",t),errorCheck:"header.vendorId",maxAccess:eh,required:!0,readOnly:eC||eI?.values?.items?.length>0&&eI?.values?.items[0]?.sku,displayFieldWidth:3})}),d.jsx(i(),{item:!0,xs:12,children:d.jsx(A.U,{endpointId:C.y.PurchaseRequisition.snapshot,name:"requestId",label:en.requisition,filter:{status:4},valueField:"reference",valueShow:"requestRef",formObject:eI.values,form:eI,secondDisplayField:!1,onChange:(e,t)=>{eI.setFieldValue("requestId",t?.recordId||null),eI.setFieldValue("requestRef",t?.reference||"")},errorCheck:"requestId",maxAccess:eh,readOnly:eC})})]})}),d.jsx(i(),{item:!0,xs:3,children:(0,d.jsxs)(i(),{container:!0,spacing:2,children:[d.jsx(i(),{item:!0,xs:12,children:d.jsx(l.Z,{name:"header.date",required:!0,label:en.date,readOnly:eC,value:eI?.values?.header?.date,onChange:(e,t)=>eI.setFieldValue("header.date",t),editMode:eb,maxAccess:eh,onClear:()=>eI.setFieldValue("header.date",null),error:eI.touched?.header?.date&&!!eI.errors?.header?.date})}),d.jsx(i(),{item:!0,xs:12,children:d.jsx(b.Z,{endpointId:f.r.Currency.qry,name:"header.currencyId",label:en.currency,valueField:"recordId",displayField:["reference","name"],readOnly:eC,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],required:!0,values:eI.values.header,maxAccess:eh,onChange:(e,t)=>eI.setFieldValue("header.currencyId",t?.recordId||null),error:eI.touched?.header?.currencyId&&!!eI.errors?.header?.currencyId})}),d.jsx(i(),{item:!0,xs:12}),d.jsx(i(),{item:!0,xs:12}),d.jsx(i(),{item:!0,xs:12}),d.jsx(i(),{item:!0,xs:12}),d.jsx(i(),{item:!0,xs:12}),d.jsx(i(),{item:!0,xs:2,children:d.jsx(L.Z,{onClick:()=>eK(),color:"#231f20",tooltipText:G.import,disabled:!eI.values.requestId,image:"import.png"})}),d.jsx(i(),{item:!0,xs:2,children:d.jsx(L.Z,{onClick:()=>ez(),color:"#3D6186",tooltipText:G.Preview,disabled:!eI.values.import||!eI.values.requestId,image:"quotation-icon.png"})}),d.jsx(i(),{item:!0,xs:8})]})}),d.jsx(i(),{item:!0,xs:3,children:(0,d.jsxs)(i(),{container:!0,spacing:2,children:[d.jsx(i(),{item:!0,xs:12,children:d.jsx(b.Z,{endpointId:f.r.Plant.qry,name:"header.plantId",label:en.plant,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],readOnly:eC,values:eI.values.header,valueField:"recordId",displayField:["reference","name"],maxAccess:eh,onChange:(e,t)=>eI.setFieldValue("header.plantId",t?.recordId||null),displayFieldWidth:2,error:eI.touched.header?.plantId&&!!eI.errors.header?.plantId})}),d.jsx(i(),{item:!0,xs:12,children:d.jsx(b.Z,{datasetId:M.v.PAYMENT_METHOD,name:"header.paymentMethod",readOnly:eC,label:en.paymentMethod,valueField:"key",displayField:"value",values:eI.values.header,onChange:(e,t)=>eI.setFieldValue("header.paymentMethod",t?.key||null),error:eI.touched.header?.paymentMethod&&!!eI.errors.header?.paymentMethod,maxAccess:eh})}),d.jsx(i(),{item:!0,xs:12,children:d.jsx(b.Z,{endpointId:D.H.TaxSchedules.qry,name:"header.taxId",label:en.tax,valueField:"recordId",displayField:["name"],readOnly:!eI.values?.header?.isVattable||eI?.values?.items?.length>0&&eI?.values?.items[0]?.sku,values:eI.values.header,onChange:(e,t)=>eI.setFieldValue("header.taxId",t?.recordId||null),error:eI.touched.header?.taxId&&!!eI.errors.header?.taxId,maxAccess:eh})}),d.jsx(i(),{item:!0,xs:12,children:d.jsx(x.Z,{name:"header.vendorDocRef",label:en.vendorDocRef,value:eI?.values?.header?.vendorDocRef,maxAccess:eh,readOnly:eC,maxLength:"15",onChange:eI.handleChange,onClear:()=>eI.setFieldValue("header.vendorDocRef",""),error:eI.touched.header?.vendorDocRef&&!!eI.errors.header?.vendorDocRef})})]})}),d.jsx(i(),{item:!0,xs:3,children:(0,d.jsxs)(i(),{container:!0,spacing:2,children:[d.jsx(i(),{item:!0,xs:12,children:d.jsx(l.Z,{name:"header.deliveryDate",label:en.deliveryDate,readOnly:eC,value:eI?.values?.header?.deliveryDate,onChange:(e,t)=>eI.setFieldValue("header.deliveryDate",t),editMode:eb,maxAccess:eh,onClear:()=>eI.setFieldValue("header.deliveryDate",""),error:eI.touched?.header?.deliveryDate&&!!eI.errors?.header?.deliveryDate})}),d.jsx(i(),{item:!0,xs:12,children:d.jsx(b.Z,{endpointId:C.y.DeliveryMethods.qry,name:"header.deliveryMethodId",label:en.deliveryMethod,readOnly:eC,valueField:"recordId",displayField:["name"],values:eI.values.header,onChange:(e,t)=>eI.setFieldValue("header.deliveryMethodId",t?.recordId||null),error:eI.touched.header?.deliveryMethodId&&!!eI.errors.header?.deliveryMethodId,maxAccess:eh})}),d.jsx(i(),{item:!0,xs:12,children:d.jsx(b.Z,{endpointId:C.y.PaymentTerms.qry,name:"header.ptId",label:en.paymentTerms,readOnly:eC,valueField:"recordId",displayField:["name"],values:eI.values.header,onChange:(e,t)=>eI.setFieldValue("header.ptId",t?.recordId||null),error:eI.touched.header?.ptId&&!!eI.errors.header?.ptId,maxAccess:eh})}),d.jsx(i(),{item:!0,xs:6,children:d.jsx(W.Z,{name:"header.isVattable",value:eI.values?.header?.isVattable,onChange:e=>eI.setFieldValue("header.isVattable",e.target.checked),label:en.VAT,disabled:eI?.values?.items&&eI?.values?.items[0]?.itemId,maxAccess:eh})}),d.jsx(i(),{item:!0,xs:6,children:d.jsx(W.Z,{name:"header.exWorks",value:eI.values?.header?.exWorks,onChange:e=>eI.setFieldValue("header.exWorks",e.target.checked),label:en.exWorks,disabled:eC,maxAccess:eh})})]})})]})}),d.jsx(F.Q,{children:d.jsx(j._,{onChange:(e,t)=>{eI.setFieldValue("items",e),"delete"===t&&er(!0)},onSelectionChange:(e,t,a)=>{"muRef"==a&&ef(e?.itemId,e?.msId)},value:eI?.values?.items,initialValues:eI.initialValues.items[0],error:eI.errors.items,allowDelete:!eC,name:"items",columns:eg,maxAccess:eh,disabled:eC||!eI.values.header.vendorId||!eI.values.header.vendorId||Object.entries(eI?.errors||{}).filter(([e])=>"items"!==e).length>0,onValidationRequired:eq})}),d.jsx(V.g,{children:(0,d.jsxs)(i(),{container:!0,spacing:2,sx:{mt:"5px"},children:[d.jsx(i(),{item:!0,xs:6,children:d.jsx(I.Z,{name:"header.description",label:en.description,value:eI.values.header.description,rows:3,readOnly:eC,maxAccess:eh,onChange:e=>eI.setFieldValue("header.description",e.target.value),onClear:()=>eI.setFieldValue("header.description",""),error:eI.touched.header?.description&&!!eI.errors.header?.description})}),d.jsx(i(),{item:!0,xs:3,children:(0,d.jsxs)(o.default,{spacing:2,children:[d.jsx(q.Z,{name:"header.volume",maxAccess:eh,label:en.totVolume,value:eJ,readOnly:!0}),d.jsx(q.Z,{name:"header.qty",maxAccess:eh,label:en.totQty,value:eH,readOnly:!0})]})}),d.jsx(i(),{item:!0,xs:3,children:(0,d.jsxs)(o.default,{spacing:2,children:[d.jsx(q.Z,{name:"header.subTotal",maxAccess:eh,label:en.subtotal,value:eX,readOnly:!0}),d.jsx(q.Z,{name:"header.tdAmount",maxAccess:eh,label:en.discount,value:eI.values.currentDiscount,displayCycleButton:!0,cycleButtonLabel:eu.text,decimalScale:2,readOnly:eC,iconKey:eu.text,handleButtonClick:()=>{let e,t,a;er(!0);let r=eI.values.currentDiscount;1==eu.value?(t=r<0||r>100?0:r,e=parseFloat(t)*parseFloat(eX)/100,a=t,eI.setFieldValue("header.tdAmount",e),eI.setFieldValue("header.tdPct",t),eI.setFieldValue("currentDiscount",t)):(e=r<0||eX<r?0:r,t=parseFloat(e)/parseFloat(eX)*100,a=e,eI.setFieldValue("header.tdPct",t),eI.setFieldValue("header.tdAmount",e),eI.setFieldValue("currentDiscount",e)),ec(r=>{let d="%"===r.text?{text:"123",value:1}:{text:"%",value:2};return eI.setFieldValue("tdType",d.value),eG(d.value,t,e,a),d})},ShowDiscountIcons:!0,onChange:e=>{let t=Number(e.target.value.replace(/,/g,""));eI.values.header.tdType==Z.a$?((t<0||t>100)&&(t=0),eI.setFieldValue("header.tdPct",t)):((t<0||eI.values.header.subtotal<t)&&(t=0),eI.setFieldValue("header.tdAmount",t)),eI.setFieldValue("currentDiscount",t)},onBlur:async e=>{let t=Number(e.target.value.replace(/,/g,"")),a=Number(e.target.value.replace(/,/g,"")),r=Number(e.target.value.replace(/,/g,""));eI.values.header.tdType==Z.ER&&(a=parseFloat(t)/parseFloat(eX)*100,eI.setFieldValue("header.tdPct",a)),eI.values.header.tdType==Z.a$&&(r=parseFloat(t)*parseFloat(eX)/100,eI.setFieldValue("header.tdAmount",r)),er(!0),await eG(eI.values.header.tdType,a,r,t)},onClear:()=>{eI.setFieldValue("header.tdAmount",0),eI.setFieldValue("header.tdPct",0),eG(eI.values.header.tdType,0,0,0)}}),d.jsx(q.Z,{name:"header.miscAmount",maxAccess:eh,label:en.misc,value:eI.values.header.miscAmount,decimalScale:2,readOnly:eC,onChange:e=>eI.setFieldValue("header.miscAmount",e.target.value||0),onBlur:async()=>{er(!0)},onClear:()=>eI.setFieldValue("header.miscAmount",0)}),d.jsx(q.Z,{name:"header.vatAmount",maxAccess:eh,label:en.VAT,value:eU,readOnly:!0}),d.jsx(q.Z,{name:"header.amount",maxAccess:eh,label:en.net,value:eE,readOnly:!0})]})})]})})]})})}[m,h,y,v,b,A,j,T,O,N,$,_,Q,B,H,X]=U.then?(await U)():U,G.width=1330,G.height=720,r()}catch(e){r(e)}})},33150:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.d(t,{Z:()=>g});var d=a(20997),l=a(16689),n=a(40711),s=a(6416),i=a(38509),o=a(29352),u=a(18611),c=a(23385),m=a(13567),h=a(42020),y=a(99155),v=a.n(y),p=a(44619),x=a(60520),I=a(96119),b=e([n,i,o,x]);[n,i,o,x]=b.then?(await b)():b;let f=e=>{let{itemId:t,obj:a,window:r}=e,{getRequest:y}=(0,l.useContext)(o.$),{platformLabels:b}=(0,l.useContext)(x.l);(0,I.Z)({title:b.CostHistory,window:r});let{query:{data:f},labels:g,access:P}=(0,i.J)({queryFn:F,endpointId:m.y.ItemCostHistory.qry,datasetId:s.i.ItemCostHistory}),A=[{field:"date",headerName:g.date,flex:1,type:"date"},{field:"vendorName",headerName:g.vendor,flex:1},,{field:"currencyName",headerName:g.currency,flex:1},{field:"baseLaborPrice",headerName:g.baseLaborPrice,flex:1,type:"number"},{field:"unitPrice",headerName:g.unitPrice,flex:1,type:"number"},{field:"markdown",headerName:g.markdown,flex:1,type:"number"},{field:"tradeDiscount",headerName:g.tradeDiscount,flex:1,type:"number"}];async function F(){return await y({extension:m.y.ItemCostHistory.qry,parameters:`_itemId=${t}`})}return(0,d.jsxs)(u.R,{children:[d.jsx(h.g,{children:(0,d.jsxs)(v(),{container:!0,spacing:2,sx:{p:2},children:[d.jsx(v(),{item:!0,xs:5,children:d.jsx(p.Z,{label:g.sku,value:a.sku,readOnly:!0})}),d.jsx(v(),{item:!0,xs:6}),d.jsx(v(),{item:!0,xs:5,children:d.jsx(p.Z,{label:g.itemName,value:a.itemName,readOnly:!0})})]})}),d.jsx(c.Q,{children:d.jsx(n.Z,{columns:A,gridData:f,rowId:["recordId"],isLoading:!1,maxAccess:P,pagination:!1})})]})};f.width=1e3;let g=f;r()}catch(e){r(e)}})},42614:(e,t,a)=>{a.d(t,{ER:()=>r,Ot:()=>o,Ww:()=>i,Yi:()=>n,a$:()=>d});let r=1,d=2,l=e=>{if(!0===e.tdPct){e.tdAmount>100?1===e.typeChange?e.tdAmount=0:e.tdAmount=e.currentDiscount:e.currentDiscount=e.tdAmount,e.hiddenTdPct=e.tdAmount;let t=e.subtotal*e.tdAmount/100;e.hiddenTdAmount=t,e.tdType=d}else if(e.tdAmount>e.subtotal)1===e.typeChange?e.tdAmount=0:e.tdAmount=e.currentDiscount;else{e.currentDiscount=e.tdAmount;let t=0===e.subtotal?0:100*e.tdAmount/e.subtotal;e.hiddenTdPct=t,e.hiddenTdAmount=e.tdAmount,e.tdType=r}return e},n=e=>e=l(e),s=(e,t)=>(e.forEach(e=>{t.totalQty+=parseFloat(e.qty),t.totalWeight+=e.qty*e.weight,t.totalVolume+=e.qty*e.volume,t.totalUpo+=e.upo,t.sumVat+=e.vatAmount}),t.net=t.sumExtended+t.sumVat+(t?.miscAmount||0)-(t?.tdAmount||0),t),i=e=>e.reduce((e,t)=>e+(Number(t.extendedPrice)||0),0),o=(e,t)=>t=s(e,t)}};