exports.id=52461,exports.ids=[52461],exports.modules={3:e=>{e.exports={root:"WorkFlow_root__EINm1"}},8041:(e,a,t)=>{"use strict";t.d(a,{Z:()=>r});let r={src:"/_next/static/media/imgSerials.d1ee59bb.png",height:17,width:23,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAGCAMAAADJ2y/JAAAAIVBMVEUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABt0UjBAAAAC3RSTlMCZzsmQ6RbWbaSTwNdgTwAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAArSURBVHicY2BiZ2BgYOBiZmBmYmRjZGRhYGBg4eBkZWVDYjAzMbKDpWCKARB/AJwjPQgCAAAAAElFTkSuQmCC",blurWidth:8,blurHeight:6}},52461:(e,a,t)=>{"use strict";t.a(e,async(e,r)=>{try{t.d(a,{Z:()=>er});var n=t(20997),d=t(27736),l=t(79390),s=t(99155),i=t.n(s),o=t(86049),u=t(16689),c=t(75609),m=t(80582),h=t(86201),p=t(29352),y=t(38509),v=t(44619),x=t(65980),I=t(71278),b=t(79660),f=t(54242),g=t(68728),A=t(61274),N=t(23385),P=t(15051),k=t(18611),w=t(42020),F=t(91184),C=t(13567),j=t(66198),V=t(95965),D=t(70638),S=t(677),T=t(60520),O=t(82173),R=t(57629),q=t(42614),Z=t(4902),M=t(19138),L=t(86794),W=t(97969),$=t(33150),_=t(24356),B=t(47014),U=t(49398),E=t(67906),J=t(49466),G=t(70305),Q=t(43991),K=t(78630),H=t(93105),z=t(70755),X=t(6416),Y=t(95818),ee=t(47203),ea=t(60349),et=e([m,h,p,y,I,A,P,D,S,T,L,$,_,B,U,J,G,K,Y,ee]);function er({labels:e,access:a,recordId:r,functionId:s,window:et}){let{getRequest:er,postRequest:en}=(0,u.useContext)(p.$),{stack:ed}=(0,S.zY)(),{platformLabels:el,defaultsData:es,userDefaultsData:ei,systemChecks:eo}=(0,u.useContext)(T.l),{getAllKvsByDataset:eu}=(0,u.useContext)(B.k),[ec,em]=(0,u.useState)([]),eh=(0,u.useRef)([]),[ep,ey]=(0,u.useState)(),[ev,ex]=(0,u.useState)(!1),[eI,eb]=(0,u.useState)(null),[ef,eg]=(0,u.useState)(null),[eA,eN]=(0,u.useState)(!1),{stack:eP}=(0,G.V)(),ek=eo?.find(e=>e.checkId===ea.F.POS_JUMP_TO_NEXT_LINE)?.value,[ew,eF]=(0,u.useState)({text:"%",value:2}),{documentType:eC,maxAccess:ej,changeDT:eV}=(0,L.H)({functionId:s,access:a,enabled:!r,objectName:"header"}),{schema:eD,requiredFields:eS}=(0,H.m)({sku:e=>e?.sku,itemName:e=>e?.itemName,qty:e=>e?.qty>0},!0,ej,"items"),eT={recordId:r,disableSKULookup:!1,header:{dtId:null,dgId:s,functionId:s,recordId:null,reference:"",date:new Date,dueDate:new Date,plantId:null,vendorId:null,vendorName:"",vendorRef:"",currencyId:null,szId:null,spId:null,siteId:null,description:"",status:1,isVattable:!1,taxId:null,subtotal:0,miscAmount:0,amount:0,vatAmount:0,tdAmount:0,plId:null,ptId:null,maxDiscount:"",currentDiscount:0,exRate:1,rateCalcMethod:1,tdType:ew.value,tdPct:0,baseAmount:0,volume:0,weight:0,qty:0,isVerified:!1,contactId:null,commitItems:!1,postMetalToFinancials:!1,metalPrice:0,KGmetalPrice:0},items:[{id:1,orderId:r||0,itemId:null,sku:"",itemName:"",seqNo:1,siteId:"",muId:null,qty:0,volume:0,weight:0,isMetal:!1,metalId:null,metalPurity:0,msId:0,muRef:"",muQty:0,baseQty:0,mdType:O.Xo,basePrice:0,baseLaborPrice:0,TotPricePerG:0,totalWeightPerG:0,mdValue:0,unitPrice:0,unitCost:0,overheadId:"",vatAmount:0,mdAmount:0,extendedPrice:0,priceType:0,applyVat:!1,taxId:null,taxDetails:null,promotionTypeName:ep?.value,promotionType:ep?.key,notes:""}],serials:[],lots:[],taxCodes:[]},eO=(0,y.E)({endpointId:C.y.PurchaseInvoiceHeader.qry}),eR={[g.J.PurchaseInvoice]:{set:C.y.PurchaseInvoiceHeader.set2,post:C.y.PurchaseInvoiceHeader.post,unpost:C.y.PurchaseInvoiceHeader.unpost},[g.J.PurchaseReturn]:{set:C.y.PurchaseReturnHeader.set2,post:C.y.PurchaseReturnHeader.post,unpost:C.y.PurchaseReturnHeader.unpost}},{formik:eq}=(0,V.c)({maxAccess:ej,documentType:{key:"header.dtId",value:eC?.dtId},conditionSchema:["items"],initialValues:eT,validationSchema:c.object({header:c.object({date:c.string().required(),dueDate:c.string().required(),currencyId:c.string().required(),vendorId:c.string().required(),siteId:c.number().transform(e=>isNaN(e)?void 0:Number(e)).nullable().test("",function(e){let{dtId:a,commitItems:t}=this.parent;return null!=a&&(!a||!0!==t)||!!e})}),items:c.array().of(eD)}),onSubmit:async e=>{let a=[],t=e.items.filter(e=>Object.values(eS)?.every(a=>a(e))).map(({id:e,isVattable:t,taxDetails:r,...n})=>{let{serials:d,...l}=n;if(d){let t=d.map((a,t)=>({...a,id:t+1,seqNo:e,srlSeqNo:0,componentSeqNo:0,invoiceId:eq.values.recordId||0,itemId:n?.itemId}));a.push(...t)}return{...l,seqNo:e,invoiceId:eq.values.recordId||0,applyVat:t}}),r={header:{...e.header,date:(0,l.ku)(e.header.date),dueDate:(0,l.ku)(e.header.dueDate)},installments:e?.installments?.map((a,t)=>({...a,id:t+1,seqNo:t+1,reference:e?.header?.reference,vendorId:e?.header?.vendorId,invoiceId:eq?.values?.recordId||0,currencyId:e?.header?.currencyId})),items:t,serials:a,taxCodes:[...[...e.items.filter(({taxDetails:e})=>e&&e?.length>0).map(({taxDetails:e,id:a})=>({seqNo:a,...e[0]}))].filter(a=>e.items.some(e=>e.id===a.seqNo))],...(({header:e,items:a,taxCodes:t,serials:r,...n})=>n)(e)},n=await en({extension:eR[s]?.set,record:JSON.stringify(r)}),d=eL?el.Edited:el.Added;n?.recordId&&(await ao(n.recordId),h.default.success(d),eO())}}),eZ=(0,u.useRef)(eq?.values?.items),eM=3===eq.values.header.status,eL=!!eq.values.header.recordId;async function eW(e){if(!e)return;let a=eq.values.items?.find(a=>parseInt(a.itemId)===e)?.msId,t=ec?.filter(e=>e.msId===a)||[];eh.current=t}async function e$(e,a,t){let r=await e1(t?.itemId),n=await e2(t?.itemId),d=t?.promotionType==="3"||t?.promotionType==="4"?void 0:await e6(t?.itemId,eq.values.header);await e4(e,a,t,r,n,d)}let e_=[{component:"resourcecombobox",name:"promotionTypeName",label:e.promotionType,hidden:!0,props:{datasetId:W.v.PROMOTION_TYPE,valueField:"key",displayField:"value",mapping:[{from:"key",to:"promotionType"},{from:"value",to:"promotionTypeName"}]}},{component:eq?.values?.disableSKULookup?"textfield":"resourcelookup",label:e.sku,name:"sku",jumpToNextLine:ek,flex:2,...eq.values.disableSKULookup&&{updateOn:"blur"},props:{...!eq.values.disableSKULookup&&{endpointId:f.$.Item.snapshot,parameters:{_categoryId:0,_msId:0,_startAt:0,_size:1e3},displayField:"sku",valueField:"sku",mapping:[{from:"recordId",to:"itemId"},{from:"sku",to:"sku"},{from:"name",to:"itemName"},{from:"trackBy",to:"trackBy"},{from:"msId",to:"msId"},{from:"isInactive",to:"isInactive"}],columnsInDropDown:[{key:"sku",value:"SKU"},{key:"name",value:"Item Name"}],displayFieldWidth:5,minChars:2}},async onChange({row:{update:a,newRow:t,oldRow:r,addRow:n}}){let d=e=>a({...eq.initialValues.items[0],id:e,enabled:!1});if(!eq.values.disableSKULookup){if(!t?.itemId)return d(t.id);if(t.isInactive){d(t.id),eP({message:e.inactiveItem});return}return e$(a,n,t)}if(!t?.sku)return d(t.id);let l=await er({extension:f.$.Items.get2,parameters:`_sku=${t.sku}`}),s=l?.record;if(!s){d(t.id),eP({message:e.invalidSKU});return}if(s.isInactive){d(t.id),eP({message:e.inactiveItem});return}return e$(a,n,{...t,itemId:s.recordId})},propsReducer:({row:e,props:a})=>({...a,imgSrc:am(e)})},{component:"textfield",label:e.itemName,name:"itemName",flex:3,props:{readOnly:!0}},{component:"resourcecombobox",label:e.site,name:"siteRef",props:{endpointId:f.$.Site.qry,displayField:"reference",valueField:"recordId",mapping:[{from:"recordId",to:"siteId"},{from:"reference",to:"siteRef"},{from:"name",to:"siteName"}],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],displayFieldWidth:5}},{component:"resourcecombobox",label:e.mu,name:"muRef",props:{store:eh?.current,displayField:"reference",valueField:"recordId",mapping:[{from:"reference",to:"muRef"},{from:"qty",to:"muQty"},{from:"recordId",to:"muId"}]},async onChange({row:{update:e,newRow:a}}){if(a){let t=eh?.current.filter(e=>e.recordId===a?.muId),r=a?.qty*t?.muQty;e({qtyInBase:r,muQty:a?.muQty})}},propsReducer:({row:e,props:a})=>({...a,store:eh?.current})},{component:"numberfield",label:e.quantity,name:"qty",updateOn:"blur",props:{onCondition:e=>({decimalScale:e?.decimals,readOnly:!e?.itemId})},async onChange({row:{update:e,newRow:a}}){let t=e3(a,O.bT);e({...t,totalWeight:t.weight*a.qty})}},{component:"numberfield",label:e.pcs,name:"pieces",updateOn:"blur"},{component:"numberfield",label:e.volume,name:"volume",props:{decimalScale:2,readOnly:!0}},{component:"numberfield",label:e.weight,name:"weight",props:{decimalScale:2,readOnly:!0}},{component:"numberfield",label:e.totalWeight,name:"totalWeight",props:{readOnly:!0,decimalScale:3}},{component:"numberfield",label:e.baseprice,name:"basePrice",updateOn:"blur",props:{decimalScale:5},async onChange({row:{update:e,newRow:a}}){let t=e3(a,O.yO);e(t)}},{component:"numberfield",label:e.baseLaborPrice,name:"baseLaborPrice",updateOn:"blur",async onChange({row:{update:e,newRow:a}}){let t=e3(a,O.tV);e(t)}},{component:"numberfield",label:e.totalPPG,name:"totalWeightPerG",updateOn:"blur",async onChange({row:{update:e,newRow:a}}){let t=e3(a,O.kx);e(t)}},{component:"numberfield",label:e.unitPrice,name:"unitPrice",updateOn:"blur",props:{decimalScale:3},async onChange({row:{update:e,newRow:a}}){let t=e3(a,O.Xf);e(t)}},{component:"button",name:"costHistory",props:{imgSrc:t(98570).default.src,onCondition:e=>({disabled:!e?.itemId})},label:e.costHistory,onClick:(e,a)=>{ed({Component:$.Z,props:{itemId:a?.itemId,obj:a}})}},{component:"numberfield",label:e.VAT,name:"vatAmount",props:{decimalScale:2,readOnly:!0}},{component:"button",name:"taxDetailsButton",props:{onCondition:e=>e.itemId&&e.taxId?{imgSrc:t(36778).default.src,hidden:!1}:{imgSrc:"",hidden:!0}},label:e.tax,onClick:(e,a)=>{ed({Component:_.Z,props:{taxId:a?.taxId,obj:a}})}},{component:"numberfield",label:e.markdown,name:"mdAmount",updateOn:"blur",flex:2,props:{decimalScale:2,ShowDiscountIcons:!0,iconsClicked:eU,type:"numeric",iconKey:({value:e,data:a})=>(e?.mdType||a?.mdType)===O.Xo?"%":"123"},async onChange({row:{update:e,newRow:a}}){let t=e3(a,O.On);e(t)}},{component:"numberfield",label:e.extendedprice,name:"extendedPrice",updateOn:"blur",props:{decimalScale:2},async onChange({row:{update:e,newRow:a}}){let t=e3(a,O.bh);e(t)}},{component:"textfield",label:e.notes,name:"notes"}];function eB(e,a,t){let r=parseFloat(e)||0;return a===t?(r<0||r>100)&&(r=0):r<0&&(r=0),r}async function eU({updateRow:e,value:a,data:t}){let r=(a?.mdType||t?.mdType)===O.Xo?O.RD:O.Xo,n=eB(a?.mdAmount,r,O.Xo);e({id:t.id,changes:{mdAmount:n,mdAmountPct:r,mdType:r},commitOnBlur:!0})}async function eE(){ed({Component:D.Z,props:{functionId:s,recordId:eq.values.header.recordId}})}let eJ=async()=>{await en({extension:eR[s]?.post,record:JSON.stringify(eq.values.header)}),h.default.success(el.Posted),await ao(eq.values.recordId),eO(),et.close()},eG=async()=>{let e=await en({extension:eR[s]?.unpost,record:JSON.stringify(eq.values.header)});await ao(e.recordId),h.default.success(el.Posted),eO()},eQ=async()=>eZ?.current?.filter(e=>e.metalId).map(e=>({qty:e.qty,metalRef:"",metalId:e.metalId,metalPurity:e.metalPurity,weight:e.weight,priceType:e.priceType}))||[];async function eK(){await en({extension:C.y.PurchaseInvoiceHeader.verify,record:JSON.stringify({...eq.values.header,isVerified:!eq.values.header.isVerified})}),h.default.success(eq.values.header.isVerified?el.Unverfied:el.Verified),ao(eq.values.header.recordId),eO()}async function eH(){let{items:e}=eq.values,a={...eq.values,serials:e.flatMap(e=>e.serials||[])};await en({extension:C.y.Serials.sync,record:JSON.stringify(a)}),h.default.success(el.syncedSuccessfully),ao(eq.values.header.recordId),eO()}let ez=[{key:"RecordRemarks",condition:!0,onClick:"onRecordRemarks",disabled:!eL},{key:"WorkFlow",condition:!0,onClick:eE,disabled:!eL},{key:"Metals",condition:!0,onClick:"onClickMetal",handleMetalClick:eQ},{key:"Locked",condition:eM,onClick:"onUnpostConfirmation",onSuccess:eG,disabled:!eL},{key:"Unlocked",condition:!eM,onClick:eJ,disabled:!eL},{key:"IV",condition:!0,onClick:"onInventoryTransaction",disabled:!eL||!eM},{key:"Aging",condition:!0,onClick:"onClickAging",disabled:!eL},{key:"GL",condition:!0,onClick:"onClickGL",valuesPath:{...eq.values.header,notes:eq?.values?.header?.description},datasetId:(e=>{switch(Number(e)){case g.J.PurchaseInvoice:return X.i.GLPurchaseInvoice;case g.J.PurchaseReturn:return X.i.GLPurchaseReturn;default:return null}})(s),disabled:!eL},{key:"ItemPromotion",condition:!0,onClick:()=>{ed({Component:U.Z,props:{invoiceId:eq.values.header.recordId}})},disabled:!eL},{key:"Installments",condition:!0,onClick:()=>{ed({Component:Y.Z,props:{data:{installments:eq.values.installments,reference:eq.values.header.reference,recordId:eq.values?.recordId,status:eq.values.header.status,vendorId:eq.values.header.vendorId,currencyId:eq.values.header.currencyId},onOk:({installments:e})=>{eq.setFieldValue("installments",e)}}})},disabled:!eL},{key:"Verify",condition:!eq.values.header.isVerified,onClick:eK,disabled:eq.values.header.isVerified||!eL||!eM},{key:"Unverify",condition:eq.values.header.isVerified,onClick:eK,disabled:!eq.values.header.isVerified},{key:"Sync",condition:!0,onClick:eH,disabled:!eL||eM},{key:"Attachment",condition:!0,onClick:"onClickAttachment",disabled:!eL}];async function eX(e){let a=e?.header,t=e?.items,r=e?.taxCodes,n=e?.serials,d=e?.installments,s=await ac(e?.header?.dtId);a?.tdType===1||a?.tdType==null?eF({text:"123",value:1}):eF({text:"%",value:2});let i=t.length?await Promise.all(t?.map(async(e,a)=>{let t=e?.taxId&&await e9(e.taxId),r=[],d=t?.map(e=>{let a=r?.find(a=>a.seqNo===e.taxSeqNo);return{...e,taxBase:a?a.taxBase:e.taxBase}})||null;return{...e,id:a+1,basePrice:e.basePrice?e.basePrice:0,unitPrice:e.unitPrice?e.unitPrice:0,vatAmount:e.vatAmount?e.vatAmount:0,totalWeight:e.weight*e.qty,extendedPrice:e.extendedPrice?e.extendedPrice:0,puTrx:!0,serials:n?.filter(a=>a.seqNo==e.seqNo)?.map((e,a)=>({...e,id:a})),taxDetails:d?.filter(a=>a.seqNo===e.seqNo)}})):eq.initialValues.items;eq.setValues({...eq.values,recordId:a.recordId||null,dtId:a.dtId||null,disableSKULookup:s||!1,installments:d?.map((e,a)=>({...e,id:a,dueDate:l.a1(e.dueDate)})),header:{...eq.values.header,...a,amount:parseFloat(a?.amount).toFixed(2),currentDiscount:a?.tdType==1||a?.tdType==null?a?.tdAmount:a?.tdPct,KGmetalPrice:a?.metalPrice*1e3},items:i,taxCodes:[...r]}),eZ.current=i}async function eY(e){let a=await er({extension:C.y.PurchaseInvoiceHeader.get2,parameters:`_recordId=${e}`});return a.record.header.date=(0,l.a1)(a?.record?.header?.date),a.record.header.dueDate=(0,l.a1)(a?.record?.header?.dueDate),a.record}async function e0(e){let a=e?.tradeDiscount?q.a$:eq.values.header.tdType;a==q.a$&&eF({text:"%",value:2}),eq.setValues({...eq.values,header:{...eq.values.header,vendorId:e?.recordId,vendorName:e?.name,vendorRef:e?.reference,isVattable:e?.isTaxable||!1,tdAmount:e?.tradeDiscount,tdPct:e?.tradeDiscount,currentDiscount:e?.tradeDiscount||0,tdType:a,taxId:e?.taxId,paymentMethod:e?.paymentMethod}})}async function e1(e){let a=await er({extension:f.$.ItemPhysProp.get,parameters:`_itemId=${e}`});return a?.record}async function e2(e){let a=await er({extension:f.$.Item.get,parameters:`_recordId=${e}`});return a?.record}async function e9(e){let a=await er({extension:j.H.TaxDetailPack.qry,parameters:`_taxId=${e}`});return a?.list}async function e6(e,a){let t=await er({extension:C.y.VendorPrice.get,parameters:`_itemId=${e}&_vendorId=${a.vendorId}&_currencyId=${a.currencyId}&_functionId=${s}`});return t?.record}function e5(e){return null!=e&&""!=e&&!isNaN(e)&&0!=e}async function e4(e,a,t,r,n,d){let l=r?.weight||0,s=r?.metalPurity??0,i=r?.isMetal??!1,o=r?.metalId??null,u=eq?.values?.header?.postMetalToFinancials??!1,c=(eq?.values?.header?.KGmetalPrice??0)*s/1e3,m=!1===u?c:0,h=d?d.priceList:0,p=d?d.baseLaborPrice:0,y=null,v=null;if(eq.values.header.taxId){let e=(await e9(eq.values.header.taxId)).map(e=>({invoiceId:eq.values.recordId||0,taxSeqNo:e.seqNo,taxId:eq.values.header.taxId,taxCodeId:e.taxCodeId,taxBase:e.taxBase,amount:e.amount}));y=eq.values.header.taxId,v=e}else if(n.taxId){let e=(await e9(n.taxId)).map(e=>({invoiceId:eq.values.recordId||0,taxSeqNo:e.seqNo,taxId:n.taxId,taxCodeId:e.taxCodeId,taxBase:e.taxBase,amount:e.amount??0}));y=n.taxId,v=e}let x=ec?.filter(e=>e.msId===n?.msId),I=await au(n?.msId),b={id:t?.id,decimals:I?.decimals,sku:n?.sku||"",itemName:n?.name||"",itemId:n?.recordId||null,isMetal:i,metalId:o,metalPurity:s,volume:r?.volume||0,weight:l,basePrice:m,baseLaborPrice:p,TotPricePerG:m+p,unitPrice:h,priceType:n?.priceType||1,qty:1,msId:n?.msId,muRef:x?.[0]?.reference,muId:x?.[0]?.recordId,muQty:x?.[0]?.qty,mdAmount:eq.values.header.maxDiscount?eq.values.header.maxDiscount:0,mdValue:0,mdType:O.Xo,extendedPrice:0,mdValue:0,taxId:y,taxDetails:v},f=e3(b,O.bT),g=e5(b.baseLaborPrice)?O.tV:e5(b.unitPrice)?O.Xf:null;return(g&&(f=e3(f,g)),eq.setFieldValue("header.mdAmount",eq.values.header.currentDiscount?eq.values.header.currentDiscount:0),ek)?eq.values.disableSKULookup?a({fieldName:"sku",changes:f}):void(e(f),a()):e(f)}async function e9(e){let a=await er({extension:j.H.TaxDetailPack.qry,parameters:`_taxId=${e}`});return a?.list}function e3(e,a,t){eA||eN(!0);let r=eB(e?.mdAmount,e?.mdType,O.Xo),n=(0,O.Ch)({priceType:e?.priceType,basePrice:parseFloat(e?.basePrice)||0,volume:e?.volume||0,weight:e?.weight,unitPrice:e?.unitPrice||0,upo:0,qty:e?.qty,extendedPrice:e?.extendedPrice,mdAmount:r,mdType:e?.mdType,mdValue:e?.mdValue,baseLaborPrice:parseFloat(e?.baseLaborPrice)||0,totalWeightPerG:e?.totalWeightPerG||0,tdPct:eq?.values?.header?.tdPct||0,dirtyField:a}),d=(0,R.VW)({priceType:n?.priceType,basePrice:n?.basePrice,unitPrice:n?.unitPrice,qty:n?.qty,weight:n?.weight,extendedPrice:n?.extendedPrice,baseLaborPrice:n?.baseLaborPrice,vatAmount:n?.vatAmount||0,tdPct:eq?.values?.header?.tdPct,taxDetails:!0===eq.values.header.isVattable?e.taxDetails:null}),l=n?.qty*e?.muQty,s={...e,id:e?.id,qty:n?.qty?n?.qty:0,baseQty:l||0,volume:n?.volume?n.volume:0,weight:n?.weight?n.weight:0,basePrice:n?.basePrice?n.basePrice:0,unitPrice:n?.unitPrice?n.unitPrice:0,extendedPrice:n?.extendedPrice?n.extendedPrice:0,mdValue:n?.mdValue,mdType:n?.mdType,totalWeightPerG:n?.totalWeightPerG?n?.totalWeightPerG:0,mdAmount:n?.mdAmount?n.mdAmount:0,vatAmount:d?.vatAmount?d.vatAmount:0};return t?{changes:s}:s}let e8=eq.values.items?.filter(e=>void 0!==e.itemId).map(e=>({...e,basePrice:e.basePrice||0,unitPrice:e.unitPrice||0,vatAmount:e.vatAmount||0,weight:e.weight||0,volume:e.volume||0,extendedPrice:e.extendedPrice||0})),e7=(0,q.Ww)(e8),ae=0==eq.values.miscAmount?0:parseFloat(eq.values.header.miscAmount),aa=(0,q.Ot)(e8,{totalQty:0,totalWeight:0,totalVolume:0,sumVat:0,sumExtended:parseFloat(e7),tdAmount:parseFloat(eq.values.header.tdAmount),net:0,miscAmount:ae||0}),at=eA?aa?.totalQty:eq.values?.header?.qty||0,ar=eA?aa?.net:eq.values?.header.amount||0,an=eA?aa?.totalVolume:eq.values?.header.volume||0,ad=eA?aa?.totalWeight:eq.values?.header.weight||0,al=eA?e7:eq.values?.header.subtotal||0,as=eA?aa?.sumVat:eq.values?.header.vatAmount||0;async function ai(e,a,t,r){var n;n=function(e,a,t,r){let n=(0,q.Yi)({tdAmount:parseFloat(r),tdPlain:1==e,tdPct:2==e,tdType:e,subtotal:al,currentDiscount:r,hiddenTdPct:a,hiddenTdAmount:parseFloat(t),typeChange:e});return eq.setFieldValue("header.tdAmount",n?.hiddenTdAmount?n?.hiddenTdAmount?.toFixed(2):0),eq.setFieldValue("header.tdType",n?.tdType),eq.setFieldValue("header.currentDiscount",n?.currentDiscount||0),eq.setFieldValue("header.tdPct",n?.hiddenTdPct),n?.hiddenTdPct}(e,a,t,r),eq.values.items.map((e,a)=>{let t=(0,R.VW)({priceType:e?.priceType,basePrice:e?.basePrice,qty:e?.qty,weight:e?.weight,extendedPrice:e?.extendedPrice,baseLaborPrice:parseFloat(e?.baseLaborPrice),vatAmount:e?.vatAmount,tdPct:n,taxDetails:!0===eq.values.header.isVattable?e.taxDetails:null});eq.setFieldValue(`items[${a}].vatAmount`,t?.vatAmount)})}async function ao(e){let a=await eY(e);await eX(a)}async function au(e){let a=await er({extension:f.$.Measurement.get,parameters:`_recordId=${e}`});return a?.record}async function ac(e){if(!e){eq.setFieldValue("disableSKULookup",!1);return}let a=await er({extension:C.y.DocumentTypeDefault.get,parameters:`_dtId=${e}`});return eq.setFieldValue("disableSKULookup",a?.record?.disableSKULookup||!1),a?.record?.disableSKULookup||!1}let am=e=>1===e.trackBy?{imgSrc:t(8041).Z.src,hidden:!1}:{imgSrc:"",hidden:!0};async function ah(e,a){if(e&&a){let t=await er({extension:Z.q.Currency.get,parameters:`_currencyId=${e}&_date=${(0,l.Uf)(a)}&_rateDivision=${M.B.FINANCIALS}`}),r=(0,Q.fB)({amount:0===ar?0:ar??eq.values.header.amount,exRate:t.record?.exRate,baseAmount:0,rateCalcMethod:t.record?.rateCalcMethod,dirtyField:Q.ss});eq.setFieldValue("header.baseAmount",parseFloat(r?.baseAmount).toFixed(2)||0),eq.setFieldValue("header.exRate",t.record?.exRate),eq.setFieldValue("header.rateCalcMethod",t.record?.rateCalcMethod),eq.setFieldValue("header.rateCalcMethodName",t.record?.rateCalcMethodName),eq.setFieldValue("header.rateTypeName",t.record?.rateTypeName),eq.setFieldValue("header.exchangeId",t.record?.exchangeId),eq.setFieldValue("header.exchangeName",t.record?.exchangeName)}}s==g.J.PurchaseReturn&&e_.push({component:"button",name:"serials",label:el.serials,props:{onCondition:am},onClick:(a,t,r,n)=>{t?.trackBy===1&&ed({Component:J.u,props:{labels:e,row:t,disabled:eM,siteId:eq?.values?.header.siteId,maxAccess:ej,checkForSiteId:!(t.qty>=0),updateRow:n}})}}),s==g.J.PurchaseInvoice&&e_.push({component:"button",name:"serials",label:el.serials,props:{onCondition:am},onClick:(e,a,t,r)=>{a?.trackBy===1&&ed({Component:ee.k,props:{row:a,disabled:eM,siteId:eq?.values?.header.siteId,updateRow:r}})}});let ap=e=>{switch(Number(e)){case g.J.PurchaseInvoice:return X.i.MCRPurchaseInvoice;case g.J.PurchaseReturn:return X.i.MCRPurchaseReturn;default:return null}};return n.jsx(m.Z,{resourceId:(e=>{switch(e){case g.J.PurchaseInvoice:return X.i.PurchaseInvoice;case g.J.PurchaseReturn:return X.i.PurchaseReturn;default:return null}})(parseInt(s)),form:eq,functionId:s,maxAccess:ej,previewReport:eL,actions:ez,editMode:eL,disabledSubmit:eM,children:(0,n.jsxs)(k.R,{children:[n.jsx(w.g,{children:(0,n.jsxs)(i(),{container:!0,spacing:2,children:[n.jsx(i(),{item:!0,xs:2.4,children:n.jsx(I.Z,{endpointId:b.r.DocumentType.qry,parameters:`_startAt=0&_pageSize=1000&_dgId=${s}`,name:"header.dtId",readOnly:eL||eq?.values?.items?.some(e=>e.sku),label:e.documentType,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],valueField:"recordId",displayField:["reference","name"],values:eq.values.header,maxAccess:ej,onChange:(e,a)=>{let t=a?a.recordId:null;a?eq.setFieldValue("header.dtId",t):(eq.setFieldValue("header.dtId",null),eq.setFieldValue("header.metalPrice",0),eq.setFieldValue("header.KGmetalPrice",0),ex(!1)),eV(a)},error:eq.touched.header?.dtId&&!!eq.errors.header?.dtId})}),n.jsx(i(),{item:!0,xs:2.4,children:n.jsx(d.Z,{name:"header.date",required:!0,label:e.date,readOnly:eM,value:eq?.values?.header?.date,onChange:(e,a)=>{eq.setFieldValue("header.date",a),ah(eq.values.header.currencyId,a)},editMode:eL,maxAccess:ej,onClear:()=>eq.setFieldValue("header.date",""),error:eq.touched?.header?.date&&!!eq.errors?.header?.date})}),n.jsx(i(),{item:!0,xs:2.4,children:n.jsx(I.Z,{endpointId:b.r.Plant.qry,name:"header.plantId",label:e.plant,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],readOnly:eM,values:eq.values.header,valueField:"recordId",displayField:["reference","name"],maxAccess:ej,onChange:(e,a)=>{eq.setFieldValue("header.plantId",a?a.recordId:null)},displayFieldWidth:2,error:eq.touched.header?.plantId&&!!eq.errors.header?.plantId})}),n.jsx(i(),{item:!0,xs:2.4,children:n.jsx(I.Z,{datasetId:W.v.PAYMENT_METHOD,name:"header.paymentMethod",readOnly:eM,label:e.paymentMethod,valueField:"key",displayField:"value",values:eq.values.header,onChange:(e,a)=>{eq.setFieldValue("header.paymentMethod",a?a.key:null)},error:eq.touched.header?.paymentMethod&&!!eq.errors.header?.paymentMethod,maxAccess:ej})}),n.jsx(i(),{item:!0,xs:2.4,children:n.jsx(v.Z,{name:"header.vendorDocRef",label:e.vendorDocRef,value:eq?.values?.header?.vendorDocRef,maxAccess:ej,readOnly:eM,maxLength:"15",onChange:eq.handleChange,onClear:()=>eq.setFieldValue("header.vendorDocRef",""),error:eq.touched.header?.vendorDocRef&&!!eq.errors.header?.vendorDocRef})}),n.jsx(i(),{item:!0,xs:2.4,children:n.jsx(v.Z,{name:"header.reference",label:e.reference,value:eq?.values?.header?.reference,maxAccess:!eL&&ej,readOnly:eL,onChange:eq.handleChange,onClear:()=>eq.setFieldValue("header.reference",""),error:eq.touched.header?.reference&&!!eq.errors.header?.reference})}),n.jsx(i(),{item:!0,xs:2.4,children:n.jsx(d.Z,{name:"header.dueDate",required:!0,label:e.dueDate,readOnly:eM,value:eq?.values?.header?.dueDate,onChange:(e,a)=>eq.setFieldValue("header.dueDate",a),editMode:eL,maxAccess:ej,onClear:()=>eq.setFieldValue("header.dueDate",""),error:eq.touched?.header?.dueDate&&!!eq.errors?.header?.dueDate})}),n.jsx(i(),{item:!0,xs:2.4,children:n.jsx(I.Z,{endpointId:f.$.Site.qry,name:"header.siteId",label:e.site,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:eq.values.header,valueField:"recordId",displayField:["reference","name"],maxAccess:ej,displayFieldWidth:2,readOnly:eM||eq?.values?.header?.dtId&&!eq?.values?.header?.commitItems,required:!eq?.values?.header.dtId||eq?.values?.header.dtId&&eq?.values?.header.commitItems==!0,onChange:(e,a)=>{eq.setFieldValue("header.siteRef",a?.reference||null),eq.setFieldValue("header.siteName",a?.name||null),eq.setFieldValue("header.siteId",a?.recordId||null)},error:eq.touched?.header?.siteId&&!!eq.errors?.header?.siteId})}),n.jsx(i(),{item:!0,xs:2.4,children:n.jsx(I.Z,{endpointId:b.r.Currency.qry,name:"header.currencyId",label:e.currency,filter:e=>1==e.currencyType,valueField:"recordId",displayField:["reference","name"],readOnly:eM,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],required:!0,values:eq.values.header,maxAccess:ej,onChange:async(e,a)=>{await ah(a?.recordId,eq.values.header?.date),eq.setFieldValue("header.currencyId",a?.recordId||null),eq.setFieldValue("header.currencyName",a?.name)},error:eq.touched?.header?.currencyId&&!!eq.errors?.header?.currencyId})}),n.jsx(i(),{item:!0,xs:1,children:n.jsx(z.Z,{onClick:()=>{var e;return e=eq.values.header,void ed({Component:K.Z,props:{DatasetIdAccess:ap(s),data:e,onOk:e=>{eq.setFieldValue("header",{...eq.values.header,...e})}}})},label:el.add,disabled:eq.values.header.currencyId===eI?.currencyId,image:"popup.png",color:"#231f20"})}),n.jsx(i(),{item:!0,xs:4.8,children:n.jsx(A.U,{endpointId:C.y.Vendor.snapshot,name:"header.vendorId",label:e.vendor,valueField:"reference",displayField:"name",valueShow:"vendorRef",secondValueShow:"vendorName",formObject:eq.values.header,form:eq,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"},{key:"flName",value:"FL Name"}],onChange:(e,a)=>{e0(a)},secondFieldName:"header.vendorName",onSecondValueChange:(e,a)=>{eq.setFieldValue("header.vendorName",a)},errorCheck:"header.vendorId",maxAccess:ej,required:!0,readOnly:eM||eq?.values?.items?.length>0&&eq?.values?.items[0]?.sku,displayFieldWidth:3,editMode:eL})}),n.jsx(i(),{item:!0,xs:2.4,children:n.jsx(E.Z,{name:"header.isVattable",value:eq.values?.header?.isVattable,onChange:e=>eq.setFieldValue("header.isVattable",e.target.checked),label:e.VAT,disabled:eq?.values?.items&&eq?.values?.items[0]?.itemId,maxAccess:ej})}),n.jsx(i(),{item:!0,xs:2.4,children:n.jsx(I.Z,{endpointId:j.H.TaxSchedules.qry,name:"header.taxId",label:e.tax,valueField:"recordId",displayField:["name"],readOnly:!eq.values?.header?.isVattable||eq?.values?.items?.length>0&&eq?.values?.items[0]?.sku,values:eq.values.header,onChange:(e,a)=>{eq.setFieldValue("header.taxId",a?.recordId||null)},error:eq.touched.header?.taxId&&!!eq.errors.header?.taxId,maxAccess:ej})}),n.jsx(i(),{item:!0,xs:2.4,children:n.jsx(F.Z,{name:"header.KGmetalPrice",label:e.metalPrice,value:eq.values.header.KGmetalPrice,readOnly:!0,hidden:ev})})]})}),n.jsx(N.Q,{children:n.jsx(P._,{onChange:(e,a)=>{eq.setFieldValue("items",e),eZ.current=e,"delete"===a&&eN(!0)},onSelectionChange:(e,a,t)=>{"muRef"==t&&eW(e?.itemId)},initialValues:eT.items[0],value:eq?.values?.items,error:eq.errors.items,name:"items",columns:e_,maxAccess:ej,allowDelete:!eM,disabled:eM||!eq.values.header.vendorId||!eq.values.header.vendorId})}),n.jsx(w.g,{children:(0,n.jsxs)(i(),{container:!0,spacing:2,sx:{mt:"5px"},children:[n.jsx(i(),{item:!0,xs:6,children:n.jsx(x.Z,{name:"header.description",label:e.description,value:eq.values.header.description,rows:3,editMode:eL,maxAccess:ej,onChange:e=>eq.setFieldValue("header.description",e.target.value),onClear:()=>eq.setFieldValue("header.description",""),error:eq.touched.header?.description&&!!eq.errors.header?.description})}),n.jsx(i(),{item:!0,xs:3,children:(0,n.jsxs)(o.default,{spacing:2,children:[n.jsx(F.Z,{name:"header.qty",maxAccess:ej,label:e.totQty,value:at,readOnly:!0}),n.jsx(F.Z,{name:"header.volume",maxAccess:ej,label:e.totVolume,value:an,readOnly:!0}),n.jsx(F.Z,{name:"header.weight",maxAccess:ej,label:e.totWeight,value:ad,readOnly:!0})]})}),n.jsx(i(),{item:!0,xs:3,children:(0,n.jsxs)(o.default,{spacing:2,children:[n.jsx(F.Z,{name:"header.subTotal",maxAccess:ej,label:e.subtotal,value:al,readOnly:!0}),n.jsx(F.Z,{name:"header.tdAmount",maxAccess:ej,label:e.discount,value:eq.values.header.currentDiscount,displayCycleButton:!0,cycleButtonLabel:ew.text,decimalScale:2,readOnly:eM,iconKey:ew.text,handleButtonClick:()=>{let e,a,t;eN(!0),1==ew.value?(a=eq.values.header.currentDiscount<0||eq.values.header.currentDiscount>100?0:eq.values.header.currentDiscount,e=parseFloat(a)*parseFloat(eq.values.header.subtotal)/100,t=a,eq.setFieldValue("header.tdAmount",e),eq.setFieldValue("header.tdPct",a),eq.setFieldValue("header.currentDiscount",a)):(e=eq.values.header.currentDiscount<0||al<eq.values.header.currentDiscount?0:eq.values.header.currentDiscount,a=parseFloat(e)/parseFloat(eq.values.header.subtotal)*100,t=e,eq.setFieldValue("header.tdPct",a),eq.setFieldValue("header.tdAmount",e),eq.setFieldValue("header.currentDiscount",e)),eF(r=>{let n="%"===r.text?{text:"123",value:1}:{text:"%",value:2};return eq.setFieldValue("header.tdType",n.value),ai(n.value,a,e,t),n})},ShowDiscountIcons:!0,onChange:e=>{let a=Number(e.target.value.replace(/,/g,""));eq.values.header.tdType==q.a$?((a<0||a>100)&&(a=0),eq.setFieldValue("header.tdPct",a)):((a<0||al<a)&&(a=0),eq.setFieldValue("header.tdAmount",a)),eq.setFieldValue("header.currentDiscount",a)},onBlur:async e=>{eN(!0);let a=Number(e.target.value.replace(/,/g,"")),t=Number(e.target.value.replace(/,/g,"")),r=Number(e.target.value.replace(/,/g,""));eq.values.header.tdType==q.ER&&(t=parseFloat(a)/parseFloat(al)*100,eq.setFieldValue("header.tdPct",t)),eq.values.header.tdType==q.a$&&(r=parseFloat(a)*parseFloat(al)/100,eq.setFieldValue("header.tdAmount",r)),await ai(eq.values.header.tdType,t,r,a)},onClear:()=>{eq.setFieldValue("header.tdAmount",0),eq.setFieldValue("header.tdPct",0),ai(eq.values.header.tdType,0,0,0)}}),n.jsx(F.Z,{name:"header.miscAmount",maxAccess:ej,label:e.misc,value:eq.values.header.miscAmount,decimalScale:2,readOnly:eM,onChange:e=>eq.setFieldValue("header.miscAmount",e.target.value||0),onBlur:async()=>{eN(!0)},onClear:()=>eq.setFieldValue("header.miscAmount",0)}),n.jsx(F.Z,{name:"header.vatAmount",maxAccess:ej,label:e.VAT,value:as,readOnly:!0}),n.jsx(F.Z,{name:"header.amount",maxAccess:ej,label:e.net,value:ar,readOnly:!0})]})})]})})]})})}[m,h,p,y,I,A,P,D,S,T,L,$,_,B,U,J,G,K,Y,ee]=et.then?(await et)():et,r()}catch(e){r(e)}})},93105:(e,a,t)=>{"use strict";t.d(a,{m:()=>n});var r=t(75609);function n(e,a,t,n="items"){let d={...e};return t?.record?.controls.forEach(({controlId:e,accessLevel:a})=>{let[t,r]=e?.split(".");t!==n||2!==a||r in d||(d[r]=e=>e?.[r]!=null),(1===a||4===a)&&r in d&&delete d[r]}),{schema:r.object().shape({...Object.keys(d).reduce((e,t)=>(e[t]=r.mixed().nullable().test(function(e){let r=this.parent,[,n]=this.path.match(/^(\w+)\[(\d+)\]/)||[],l=this.options.context?.[n]||[];if(a||!a&&l.length>1){if(null!==r[t]&&void 0!==r[t]&&0!==r[t]&&""!==d[t]&&!d[t](r))return!1;if(!Object.entries(d).some(([,e])=>!!e(r)))return!0}return!!d[t](r)&&void 0!==e}),e),{})}),requiredFields:d}}},95818:(e,a,t)=>{"use strict";t.a(e,async(e,r)=>{try{t.d(a,{Z:()=>y});var n=t(20997),d=t(6416),l=t(95965),s=t(18611),i=t(23385),o=t(38509),u=t(96119),c=t(15051),m=t(79390),h=t(18687),p=e([o,c,h]);function y({data:e,onOk:a,window:t}){let r=3===e.status,{labels:p,access:y}=(0,o.J)({datasetId:d.i.Installments});(0,u.Z)({title:p.Installments,window:t});let{formik:v}=(0,l.c)({initialValues:{installments:e?.installments?.map((e,a)=>({...e,id:a+1,dueDate:e.dueDate&&/^\/Date\(-?\d+\)\/$/.test(e.dueDate)?m.a1(e.dueDate):e.dueDate||null}))||[{id:1,dueDate:null,amount:null}]},maxAccess:y,validateOnChange:!0,onSubmit:async r=>{if(a){let n=r.installments.filter(e=>e.dueDate).map((a,t)=>({...a,seqNo:t+1,reference:e?.reference,vendorId:e?.vendorId,invoiceId:e?.recordId||0,currencyId:e?.currencyId,dueDate:(0,m.ku)(a.dueDate)}));a({installments:n}),t.close()}}}),x=[{key:"Ok",condition:!0,onClick:v.handleSubmit,disabled:!1}],I=[{component:"date",label:p.date,name:"dueDate",props:{readOnly:r}},{component:"numberfield",label:p.amount,name:"amount",props:{maxLength:12,decimalScale:2,readOnly:r},propsReducer:({row:e,props:a})=>({...a,readOnly:!e.dueDate})}];return n.jsx(h.Z,{onSave:v.handleSubmit,actions:x,isSaved:!1,isParentWindow:!1,children:n.jsx(s.R,{children:n.jsx(i.Q,{children:n.jsx(c._,{onChange:e=>v.setFieldValue("installments",e),value:v.values.installments,error:v.errors.installments,columns:I,allowDelete:!r,allowAddNewLine:!r,maxAccess:y})})})})}[o,c,h]=p.then?(await p)():p,y.width=600,y.height=500,r()}catch(e){r(e)}})},33150:(e,a,t)=>{"use strict";t.a(e,async(e,r)=>{try{t.d(a,{Z:()=>g});var n=t(20997),d=t(16689),l=t(40711),s=t(6416),i=t(38509),o=t(29352),u=t(18611),c=t(23385),m=t(13567),h=t(42020),p=t(99155),y=t.n(p),v=t(44619),x=t(60520),I=t(96119),b=e([l,i,o,x]);[l,i,o,x]=b.then?(await b)():b;let f=e=>{let{itemId:a,obj:t,window:r}=e,{getRequest:p}=(0,d.useContext)(o.$),{platformLabels:b}=(0,d.useContext)(x.l);(0,I.Z)({title:b.CostHistory,window:r});let{query:{data:f},labels:g,access:A}=(0,i.J)({queryFn:P,endpointId:m.y.ItemCostHistory.qry,datasetId:s.i.ItemCostHistory}),N=[{field:"date",headerName:g.date,flex:1,type:"date"},{field:"vendorName",headerName:g.vendor,flex:1},,{field:"currencyName",headerName:g.currency,flex:1},{field:"baseLaborPrice",headerName:g.baseLaborPrice,flex:1,type:"number"},{field:"unitPrice",headerName:g.unitPrice,flex:1,type:"number"},{field:"markdown",headerName:g.markdown,flex:1,type:"number"},{field:"tradeDiscount",headerName:g.tradeDiscount,flex:1,type:"number"}];async function P(){return await p({extension:m.y.ItemCostHistory.qry,parameters:`_itemId=${a}`})}return(0,n.jsxs)(u.R,{children:[n.jsx(h.g,{children:(0,n.jsxs)(y(),{container:!0,spacing:2,sx:{p:2},children:[n.jsx(y(),{item:!0,xs:5,children:n.jsx(v.Z,{label:g.sku,value:t.sku,readOnly:!0})}),n.jsx(y(),{item:!0,xs:6}),n.jsx(y(),{item:!0,xs:5,children:n.jsx(v.Z,{label:g.itemName,value:t.itemName,readOnly:!0})})]})}),n.jsx(c.Q,{children:n.jsx(l.Z,{columns:N,gridData:f,rowId:["recordId"],isLoading:!1,maxAccess:A,pagination:!1})})]})};f.width=1e3;let g=f;r()}catch(e){r(e)}})},49398:(e,a,t)=>{"use strict";t.a(e,async(e,r)=>{try{t.d(a,{Z:()=>x});var n=t(20997),d=t(16689),l=t(40711),s=t(6416),i=t(38509),o=t(29352),u=t(18611),c=t(23385),m=t(13567),h=t(60520),p=t(96119),y=e([l,i,o,h]);[l,i,o,h]=y.then?(await y)():y;let v=e=>{let{invoiceId:a,window:t}=e,{getRequest:r}=(0,d.useContext)(o.$),{platformLabels:y}=(0,d.useContext)(h.l);(0,p.Z)({title:y.ItemPromotion,window:t});let{query:{data:v},labels:x,access:I}=(0,i.J)({queryFn:f,endpointId:m.y.ItemPromotion.qry,datasetId:s.i.ItemPromotion}),b=[{field:"promotionTypeName",headerName:x.promType},{field:"sku",headerName:x.sku},{field:"itemName",headerName:x.itemName},{field:"qty",headerName:x.qty,type:"number"},{field:"netUnitPrice",headerName:x.netUnitPrice,type:"number"},{field:"currentCost",headerName:x.currentCost,type:"number"},{field:"netExtendedPrice",headerName:x.netExtendedPrice,type:"number"},{field:"extendedCurrentCostInDocumentCurrency",headerName:x.extendedCurrent,type:"number"},,{field:"invoicePct",headerName:x.invoicePct,type:"number"},{field:"freeOnInvoiceUnitMarkdown",headerName:x.freeOnInvoiceUnitMarkdown,type:"number"},{field:"kitPct",headerName:x.kitPct,type:"number"},{field:"promotionUnitMarkdown",headerName:x.promotionUnitMarkdown,type:"number"}];async function f(){return await r({extension:m.y.ItemPromotion.qry,parameters:`_invoiceId=${a}`})}return n.jsx(u.R,{children:n.jsx(c.Q,{children:n.jsx(l.Z,{columns:b,gridData:v,rowId:["recordId"],isLoading:!1,maxAccess:I,pagination:!1})})})};v.width=1330,v.height=720;let x=v;r()}catch(e){r(e)}})},78630:(e,a,t)=>{"use strict";t.a(e,async(e,r)=>{try{t.d(a,{Z:()=>A});var n=t(20997),d=t(99155),l=t.n(d),s=t(16689),i=t(6416),o=t(44619),u=t(95965),c=t(18611),m=t(23385),h=t(91184),p=t(43991),y=t(29352),v=t(4902);t(79390),t(19138);var x=t(38509),I=t(96119),b=t(60520),f=t(18687),g=e([y,x,b,f]);function A({data:e,onOk:a,DatasetIdAccess:t,window:r}){let{getRequest:d}=(0,s.useContext)(y.$),{platformLabels:g}=(0,s.useContext)(b.l);(0,I.Z)({title:g.MultiCurrencyRate,window:r});let{labels:A,access:N}=(0,x.J)({endpointId:v.q.Currency.get,DatasetIdAccess:t,datasetId:i.i.MultiCurrencyRate}),{formik:P}=(0,u.c)({initialValues:{currencyId:e?.currencyId,currencyName:e?.currencyName,exchangeId:e?.exchangeId,exchangeName:e?.exchangeName,rateCalcMethod:e?.rateCalcMethod,rateCalcMethodName:e?.rateCalcMethodName,rateTypeId:e?.rateTypeId,exRate:e?.exRate||null,amount:e?.amount||0,baseAmount:e?.baseAmount,rateTypeName:e?.rateTypeName},maxAccess:N,validateOnChange:!0}),k=()=>{if(a){let e={...P.values,exRate:P.values.exRate,baseAmount:P.values.baseAmount,amount:P.values.amount};a(e),r.close()}},w=[{key:"Ok",condition:!0,onClick:k,disabled:!1}];return n.jsx(f.Z,{onSave:k,actions:w,maxAccess:N,editMode:!1,isSaved:!1,children:n.jsx(c.R,{children:n.jsx(m.Q,{children:(0,n.jsxs)(l(),{container:!0,spacing:2,children:[n.jsx(l(),{item:!0,xs:12,children:n.jsx(o.Z,{name:"currencyName",value:P?.values?.currencyName,label:A.currency,readOnly:!0})}),n.jsx(l(),{item:!0,xs:12,children:n.jsx(o.Z,{name:"rateTypeName",value:P?.values?.rateTypeName,label:A.rateType,readOnly:!0})}),n.jsx(l(),{item:!0,xs:12,children:n.jsx(o.Z,{name:"exchangeName",value:P?.values?.exchangeName,label:A.exchangeTable,readOnly:!0})}),n.jsx(l(),{item:!0,xs:12,children:n.jsx(o.Z,{name:"rateCalcMethodName",value:P?.values?.rateCalcMethodName,label:A.rateCalcMethod,readOnly:!0})}),n.jsx(l(),{item:!0,xs:12,children:n.jsx(h.Z,{name:"exRate",value:P?.values?.exRate,label:A.rate,readOnly:P?.values?.amount==0,maxAccess:N,onClear:()=>{P.setFieldValue("baseAmount",""),P.setFieldValue("exRate","")},decimalScale:7,onChange:a=>{let t=a.target.value;if(!t){P.setFieldValue("exRate",""),P.setFieldValue("baseAmount","");return}P.setFieldValue("exRate",t);let r=(0,p.fB)({amount:e?.amount||0,exRate:t,baseAmount:parseFloat(P?.values?.baseAmount||0).toFixed(2),rateCalcMethod:P?.values?.rateCalcMethod,dirtyField:p.ss});P.setValues({...P.values,...r,baseAmount:parseFloat(r.baseAmount).toFixed(2)})}})}),n.jsx(l(),{item:!0,xs:12,children:n.jsx(h.Z,{name:"amount",value:P?.values?.amount,label:A.amount,readOnly:!0})}),n.jsx(l(),{item:!0,xs:12,children:n.jsx(h.Z,{name:"baseAmount",value:P?.values?.baseAmount,label:A.baseAmount,readOnly:P?.values?.amount==0,onClear:()=>{P.setFieldValue("baseAmount",""),P.setFieldValue("exRate","")},maxAccess:N,onChange:a=>{let t=a.target.value;if(!t){P.setFieldValue("baseAmount",""),P.setFieldValue("exRate","");return}P.setFieldValue("baseAmount",t);let r=(0,p.fB)({amount:e?.amount||0,exRate:P?.values?.exRate,baseAmount:parseFloat(t||0).toFixed(2),rateCalcMethod:P?.values?.rateCalcMethod,dirtyField:p.i5});P.setValues({...P.values,...r})}})})]})})})})}[y,x,b,f]=g.then?(await g)():g,A.width=500,A.height=500,r()}catch(e){r(e)}})},47203:(e,a,t)=>{"use strict";t.a(e,async(e,r)=>{try{t.d(a,{k:()=>k});var n=t(20997),d=t(18611),l=t(23385),s=t(6416),i=t(99155),o=t.n(i),u=t(71278),c=t(95965),m=t(75609),h=t(38509),p=t(16689),y=t(91184),v=t(61274),x=t(54242),I=t(15051),b=t(42020),f=t(60520),g=t(96119),A=t(18687),N=t(93105),P=e([u,h,v,I,f,A]);[u,h,v,I,f,A]=P.then?(await P)():P;let k=({row:e,siteId:a,window:t,updateRow:r,disabled:i})=>{let{platformLabels:P}=(0,p.useContext)(f.l),{labels:k,access:w}=(0,h.J)({datasetId:s.i.Serial}),{schema:F,requiredFields:C}=(0,N.m)({weight:e=>!!e?.weight,srlNo:e=>!!e?.srlNo},!0,w,"items");(0,g.Z)({title:P.serials,window:t});let{formik:j}=(0,c.c)({maxAccess:w,initialValues:{sku:e?.sku,itemName:e?.itemName,itemId:e?.itemId,siteId:a,totalWeight:e?.qty||0,items:e?.serials?.map((e,a)=>({...e,id:a+1}))||[]},conditionSchema:["items"],validationSchema:m.object({items:m.array().of(F)}),onSubmit:async a=>{let n=a.items.filter(e=>Object.values(C)?.every(a=>a(e))).map(({id:a,...t},r)=>({...t,srlSeqNo:r+1,srlNo:t.srlNo,seqNo:e.id}));r({changes:{serials:n}}),t.close()}}),V=j.values.items.reduce((e,a)=>{let t=parseFloat(a.weight)||0;return e+t},0),D=j.values.totalWeight-V||0,S=[{component:"textfield",name:"srlNo",label:k.serialNo},{component:"resourcecombobox",label:k.size,name:"sizeId",props:{endpointId:x.$.ItemSizes.qry,displayField:"name",valueField:"recordId",displayFieldWidth:2,mapping:[{from:"recordId",to:"sizeId"},{from:"reference",to:"sizeRef"},{from:"name",to:"sizeName"}],displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}]}},{component:"numberfield",name:"weight",label:k.weight,props:{mandatory:!0}}],T=[{key:"Ok",condition:!0,onClick:()=>j.handleSubmit(),disabled:i}];return n.jsx(A.Z,{onSave:j.handleSubmit,isSaved:!1,actions:T,maxAccess:w,children:(0,n.jsxs)(d.R,{children:[n.jsx(b.g,{children:(0,n.jsxs)(o(),{container:!0,spacing:2,children:[n.jsx(o(),{item:!0,xs:12,children:n.jsx(v.U,{endpointId:x.$.Item.snapshot,name:"itemId",label:k?.sku,valueField:"recordId",displayField:"sku",valueShow:"sku",secondValueShow:"itemName",form:j,readOnly:!0})}),n.jsx(o(),{item:!0,xs:12,children:n.jsx(u.Z,{endpointId:x.$.Site.qry,name:"siteId",label:k.site,values:j.values,valueField:"recordId",displayField:["reference","name"],maxAccess:w,readOnly:!0})}),n.jsx(o(),{item:!0,xs:12,children:n.jsx(y.Z,{name:"totalWeight",label:k.totalWeight,maxAccess:w,value:j.values.totalWeight,readOnly:!0})}),n.jsx(o(),{item:!0,xs:12,children:n.jsx(y.Z,{name:"weightAssigned",label:k.weightAssigned,maxAccess:w,value:V,readOnly:!0})}),n.jsx(o(),{item:!0,xs:12,children:n.jsx(y.Z,{name:"balanceWeight",label:k.balanceWeight,maxAccess:w,value:D,readOnly:!0})})]})}),n.jsx(l.Q,{children:n.jsx(I._,{onChange:e=>j.setFieldValue("items",e),value:j.values?.items,error:j.errors.items,name:"items",columns:S,maxAccess:w,disabled:i,allowDelete:!i,allowAddNewLine:!i})})]})})};k.width=500,k.height=700,r()}catch(e){r(e)}})},49466:(e,a,t)=>{"use strict";t.a(e,async(e,r)=>{try{t.d(a,{u:()=>F});var n=t(20997),d=t(18611),l=t(23385),s=t(6416),i=t(99155),o=t.n(i),u=t(71278),c=t(95965),m=t(75609),h=t(38509),p=t(16689),y=t(29352),v=t(91184),x=t(61274),I=t(54242),b=t(15051),f=t(42020),g=t(70305),A=t(60520),N=t(60349),P=t(96119),k=t(18687),w=e([u,h,y,x,b,g,A,k]);[u,h,y,x,b,g,A,k]=w.then?(await w)():w;let F=({row:e,siteId:a,checkForSiteId:t,window:r,updateRow:i,disabled:w})=>{let{getRequest:F}=(0,p.useContext)(y.$),{stack:C}=(0,g.V)(),{platformLabels:j,systemChecks:V}=(0,p.useContext)(A.l),D=V.some(e=>e.checkId===N.F.ALLOW_INVENTORY_NEGATIVE_QTY),S=V?.find(e=>e.checkId===N.F.POS_JUMP_TO_NEXT_LINE)?.value||!1,{labels:T,maxAccess:O}=(0,h.J)({datasetId:s.i.Serial});(0,P.Z)({title:j.serials,window:r});let{formik:R}=(0,c.c)({maxAccess:O,initialValues:{sku:e?.sku,itemName:e?.itemName,itemId:e?.itemId,siteId:a,totalWeight:e?.qty||0,pieces:null,items:e?.serials||[]},validateOnChange:!0,validationSchema:m.object({items:m.array().of(m.object({srlNo:m.string().test(function(e){return this.options.from[1]?.value?.items?.length===1||!!e})}))}),onSubmit:async a=>{let t=a.items.filter(e=>e?.srlNo).map((a,t)=>({...a,id:t+1,srlSeqNo:t+1,srlNo:a.srlNo,seqNo:e.id}));i({changes:{serials:t,...e?.hasOwnProperty("serialCount")&&{serialCount:t?.length||0}}}),r.close()}}),q=R.values.items.reduce((e,a)=>{let t=parseFloat(a.weight)||0;return e+t},0),Z=R.values.totalWeight-q||0,M=[{component:"textfield",name:"srlNo",label:T.serialNo,jumpToNextLine:S,updateOn:"blur",onChange:async({row:{update:e,newRow:a,oldRow:t,addRow:r}})=>{a.srlNo!==t?.srlNo&&await $(a,e,r)}},{component:"numberfield",name:"weight",label:T.weight,props:{readOnly:!0}}],L=e=>{let a=R.values.items.map(a=>a.id===e?{...a,srlNo:"",weight:""}:a);R.setFieldValue("items",a)},W=e=>{let a=R.values.items.filter(a=>a.id!==e);0===a.length&&(a=[{id:0,srlNo:"",weight:""}]),R.setFieldValue("items",a)},$=async(a,r,n)=>{let{srlNo:d,id:l}=a;if(d){let s=await F({extension:I.$.Serial.get,parameters:`_srlNo=${d}`});s.record?s?.record?.itemId!==e?.itemId?(C({message:j.serialDoesNotBelongItem}),L(l)):t&&!D&&R.values.siteId?(await F({extension:I.$.AvailabilitySerial.get,parameters:`_srlNo=${d}&_siteId=${R.values.siteId}`})).record?(r({weight:s.record.weight}),n({fieldName:"srlNo",changes:{id:a.id,srlNo:a.srlNo,weight:s.record.weight}})):(C({message:T.invalidSerial}),L(l)):(r({weight:s.record.weight}),n({fieldName:"srlNo",changes:{id:a.id,srlNo:a.srlNo,weight:s.record.weight}})):(C({message:j.unknownSerial}),W(l))}},_=[{key:"Ok",condition:!0,onClick:()=>R.handleSubmit(),disabled:w}];return n.jsx(k.Z,{onSave:R.handleSubmit,isSaved:!1,actions:_,maxAccess:O,children:(0,n.jsxs)(d.R,{children:[n.jsx(f.g,{children:(0,n.jsxs)(o(),{container:!0,spacing:2,children:[n.jsx(o(),{item:!0,xs:12,children:n.jsx(x.U,{endpointId:I.$.Item.snapshot,name:"itemId",label:T?.sku,valueField:"recordId",displayField:"sku",valueShow:"sku",secondValueShow:"itemName",form:R,readOnly:!0})}),n.jsx(o(),{item:!0,xs:12,children:n.jsx(u.Z,{endpointId:I.$.Site.qry,name:"siteId",label:T.site,values:R.values,valueField:"recordId",displayField:["reference","name"],maxAccess:O,readOnly:!0})}),n.jsx(o(),{item:!0,xs:12,children:n.jsx(v.Z,{name:"totalWeight",label:T.totalWeight,maxAccess:O,value:R.values.totalWeight,readOnly:!0})}),n.jsx(o(),{item:!0,xs:12,children:n.jsx(v.Z,{name:"weightAssigned",label:T.weightAssigned,maxAccess:O,value:q,readOnly:!0})}),n.jsx(o(),{item:!0,xs:12,children:n.jsx(v.Z,{name:"balanceWeight",label:T.balanceWeight,maxAccess:O,value:Z,readOnly:!0})}),n.jsx(o(),{item:!0,xs:12,children:n.jsx(v.Z,{name:"pieces",label:T.pieces,maxAccess:O,value:R?.values?.items?.filter(e=>void 0!==e.srlNo)?.length,readOnly:!0})})]})}),n.jsx(l.Q,{children:n.jsx(b._,{onChange:e=>R.setFieldValue("items",e),value:R.values?.items,error:R.errors?.items,name:"items",columns:M,maxAccess:O,disabled:w,allowDelete:!w,allowAddNewLine:!w})})]})})};F.width=500,F.height=700,r()}catch(e){r(e)}})},70638:(e,a,t)=>{"use strict";t.a(e,async(e,r)=>{try{t.d(a,{Z:()=>v});var n=t(20997),d=t(16689),l=t(97996),s=t(29352),i=t(73846),o=t(96119),u=t(60520),c=t(20562),m=t(3),h=t.n(m),p=e([s,i,u]);[s,i,u]=p.then?(await p)():p;let y=({functionId:e,recordId:a,window:t})=>{let{getRequest:r}=(0,d.useContext)(s.$),{languageId:m}=(0,d.useContext)(i.V),{platformLabels:p}=(0,d.useContext)(u.l),y=a+"-"+e;(0,o.Z)({title:p.WorkFlow,window:t});let{width:v}=(0,c.d)(),x=v<=1024,I=v>1024&&v<=1280,b=x?10:I?12:14,f=x?75:I?85:95,g=x?15:I?20:25,A=async()=>{var t=`_functionId=${e}&_recordId=${a}`;let n=await r({extension:l.P.WorkFlow.graph,parameters:t});return n?.record},N=e=>{let a=[],t=[],r="",n="";return e.objects.forEach(e=>{a.push({functionName:e.functionName,reference:e.reference,date:e.date})}),e.workflow.forEach(a=>{e.objects.forEach(e=>{let t=e.functionName.split(" ").join("\r\n");a.parentId===e.recordId&&a.parentFunctionId===e.functionId&&(r=e.reference+"\r\n"+e.date+"\r\n"+t,a.parentId),a.childId===e.recordId&&a.childFunctionId===e.functionId&&(n=e.reference+"\r\n"+e.date+"\r\n"+t,a.childId)}),""===r||""===n||t.push({from:r,to:n,value:1,labelText:""}),r="",n=""}),t};return(0,d.useEffect)(()=>{!async function(){var e=await A();if(e){let a=(e,a)=>{let t=document.createElement("script");t.type="text/javascript",t.src=e,t.async=!0,t.onload=a,document.head.appendChild(t)};a("https://cdn.amcharts.com/lib/4/core.js",()=>{a("https://cdn.amcharts.com/lib/4/charts.js",()=>{a("https://cdn.amcharts.com/lib/4/themes/animated.js",()=>{am4core.ready(()=>{let a=am4core.create(y,am4charts.SankeyDiagram),t=N(e);a.data=t,a.dataFields.fromName="from",a.dataFields.toName="to",a.dataFields.value="value",a.paddingRight=2===m?0:40,a.paddingLeft=2===m?40:0,a.tooltip.label.fontSize=b;let r=a.nodes.template;r.draggable=!1,r.inert=!0,r.clickable=!1,r.width=f,r.height=g,r.nameLabel.label.fontSize=b,r.nameLabel.locationX=2===m?.85:0,r.nameLabel.height=void 0,r.nameLabel.label.fontWeight="bold";let n=a.links.template;n.middleLine.strokeOpacity=.3,n.middleLine.stroke=am4core.color("#555"),n.middleLine.strokeWidth=5,n.middleLine.hoverable=!1,n.fillOpacity=0,n.hoverable=!0,n.hoverOnFocus=!0,n.fill=am4core.color("#A8C686"),n.isHover=!0,a.appear(1e3,100)})})})})}}()},[]),n.jsx("div",{id:y,className:h().root})};y.width=950;let v=y;r()}catch(e){r(e)}})},42614:(e,a,t)=>{"use strict";t.d(a,{ER:()=>r,Ot:()=>o,Ww:()=>i,Yi:()=>l,a$:()=>n});let r=1,n=2,d=e=>{if(!0===e.tdPct){e.tdAmount>100?1===e.typeChange?e.tdAmount=0:e.tdAmount=e.currentDiscount:e.currentDiscount=e.tdAmount,e.hiddenTdPct=e.tdAmount;let a=e.subtotal*e.tdAmount/100;e.hiddenTdAmount=a,e.tdType=n}else if(e.tdAmount>e.subtotal)1===e.typeChange?e.tdAmount=0:e.tdAmount=e.currentDiscount;else{e.currentDiscount=e.tdAmount;let a=0===e.subtotal?0:100*e.tdAmount/e.subtotal;e.hiddenTdPct=a,e.hiddenTdAmount=e.tdAmount,e.tdType=r}return e},l=e=>e=d(e),s=(e,a)=>(e.forEach(e=>{a.totalQty+=parseFloat(e.qty),a.totalWeight+=e.qty*e.weight,a.totalVolume+=e.qty*e.volume,a.totalUpo+=e.upo,a.sumVat+=e.vatAmount}),a.net=a.sumExtended+a.sumVat+(a?.miscAmount||0)-(a?.tdAmount||0),a),i=e=>e.reduce((e,a)=>e+(Number(a.extendedPrice)||0),0),o=(e,a)=>a=s(e,a)}};