exports.id=68703,exports.ids=[68703],exports.modules={3:e=>{e.exports={root:"WorkFlow_root__EINm1"}},72172:(e,a,t)=>{"use strict";t.d(a,{K:()=>l});let r="RG.FI.asmx/",l={FiOpeningBalance:{gen:r+"genOBA"},FiAging:{qry:r+"FI404"},AccountSummary:{AccFI405b:r+"FI405b"},DocumentAging:{AgingFI406a:r+"FI406a",AgingFI406b:r+"FI406b"},TrialBalance:{FI402View:r+"FI402o",FI401o2:r+"FI401o2"}}},81313:(e,a,t)=>{"use strict";t.a(e,async(e,r)=>{try{t.d(a,{Z:()=>C});var l=t(20997),n=t(16689),i=t(87316),s=t.n(i),d=t(29352),o=t(61274),c=t(6416),u=t(38509),m=t(42020),p=t(23385),I=t(18611),x=t(71278),v=t(66198),h=t(70755),f=t(97969),y=t(60520),g=t(95965),F=t(79660),b=t(40711),w=t(72172),j=t(96119),N=e([d,o,u,x,y,b]);function C({accountId:e,moduleId:a,window:t}){let{getRequest:r}=(0,n.useContext)(d.$),{platformLabels:i}=(0,n.useContext)(y.l),[N,C]=(0,n.useState)([]);(0,j.Z)({title:i.AccountSummary,window:t});let{labels:k,access:P}=(0,u.J)({datasetId:c.i.AccountSummary}),A=[{field:"days",headerName:k.days,flex:1,type:"number"}],[S,V]=(0,n.useState)(A),{formik:R}=(0,g.c)({maxAccess:P,initialValues:{accountId:null,accountRef:"",accountName:"",agpId:null,moduleId:a}});async function D(){let e;let t=2,l=[...A],n=await r({extension:F.r.Currency.qry,parameters:"_filter="});if(1==a?e=n?.list?.filter(e=>e.sale):2==a&&(e=n?.list?.filter(e=>e.purchase)),0==e.length)return;e?.forEach((e,a)=>{l.push({field:`column${a+1}`,headerName:e.reference,flex:1,type:"number"})}),V(l);let i=await r({extension:v.H.AgingLeg.qry,parameters:`_agpId=${R.values.agpId}`}),s=i?.list?.map(a=>{let t=Array(e.length+2).fill(0);return t[0]=null,t[1]=a.days,t}),d=(e||[]).map(e=>r({extension:w.K.AccountSummary.AccFI405b,parameters:`_agpId=${R.values.agpId}&_currencyId=${e.recordId}&_accountId=${R.values.accountId}`}).then(e=>({summaryRes:e})));(await Promise.all(d)).forEach(({summaryRes:e})=>{e?.list?.forEach(e=>{s?.forEach(a=>{a[1]==e.seqDays&&(a[t]=e.amount)})}),t++});let o=Array(e.length+2).fill(null);for(let a=2;a<e.length+2;a++){let e=0;s?.map(t=>{e+=Number(t[a]||0)}),o[a]=e}let c=s.filter(e=>null!==e[1]).map(e=>{let[a,t,...r]=e,l={days:t};return r.forEach((e,a)=>{l[`column${a+1}`]=e.toFixed(2)}),l}),u={};for(let a=0;a<e.length;a++)u[`column${a+1}`]=o[a+2].toFixed(2)??0;c.push(u),C({list:c})}return(0,l.jsxs)(I.R,{children:[l.jsx(m.g,{children:(0,l.jsxs)(s(),{container:!0,spacing:2,p:2,children:[l.jsx(s(),{item:!0,xs:12,children:l.jsx(o.U,{endpointId:v.H.Account.snapshot,name:"accountId",label:k.account,valueField:"reference",displayField:"name",valueShow:"accountRef",secondValueShow:"accountName",form:R,readOnly:R.values.accountId&&R.values.moduleId,required:!0,maxAccess:P,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],onChange:async(e,a)=>{R.setFieldValue("accountId",a?.recordId||null),R.setFieldValue("accountName",a?.name||""),R.setFieldValue("accountRef",a?.reference||"")}})}),l.jsx(s(),{item:!0,xs:6,children:l.jsx(x.Z,{endpointId:v.H.AgingProfile.qry,parameters:"_startAt=0&_pageSize=1000&filter=",name:"agpId",label:k.agingProfile,values:R.values,valueField:"recordId",displayField:"name",maxAccess:P,required:!0,onChange:(e,a)=>{R.setFieldValue("agpId",a?.recordId||null),a?.recordId||C({list:[]})}})}),l.jsx(s(),{item:!0,xs:5,children:l.jsx(x.Z,{datasetId:f.v.FI_AGING_MODULE,label:k.module,name:"moduleId",values:R.values,valueField:"key",displayField:"value",maxAccess:P,required:!0,readOnly:R.values.moduleId,onChange:(e,a)=>{R.setFieldValue("moduleId",a?.key||null)}})}),l.jsx(s(),{item:!0,xs:1,children:l.jsx(h.Z,{onClick:D,image:"preview.png",disabled:!R.values.agpId||!R.values.moduleId||!R.values.accountId,tooltipText:i.Preview})})]})}),l.jsx(p.Q,{children:l.jsx(b.Z,{columns:S,gridData:N,isLoading:!1,pagination:!1})})]})}[d,o,u,x,y,b]=N.then?(await N)():N,C.width=1e3,C.height=500,r()}catch(e){r(e)}})},68703:(e,a,t)=>{"use strict";t.a(e,async(e,r)=>{try{t.d(a,{Z:()=>B});var l=t(20997),n=t(27736),i=t(79390),s=t(99155),d=t.n(s),o=t(16689),c=t(75609),u=t(80582),m=t(86201),p=t(29352),I=t(38509),x=t(6416),v=t(44619),h=t(65980),f=t(71278),y=t(79660),g=t(54242),F=t(68728),b=t(61274),w=t(23385),j=t(15051),N=t(18611),C=t(42020),k=t(91184),P=t(97996),A=t(66198),S=t(95965),V=t(70638),R=t(677),D=t(60520),O=t(57629),q=t(86794),Z=t(40711),T=t(24356),L=t(13893),_=t(82173),$=t(60349),E=t(70305),W=t(70755),J=t(81313),G=e([u,m,p,I,f,b,j,V,R,D,q,Z,T,L,E,J]);function B({labels:e,access:a,recordId:r,invalidate:s}){let{getRequest:I,postRequest:G}=(0,o.useContext)(p.$),{stack:B}=(0,R.zY)(),{stack:H}=(0,E.V)(),{platformLabels:z,defaultsData:M,userDefaultsData:U,systemChecks:X}=(0,o.useContext)(D.l),[K,Q]=(0,o.useState)(!1),{documentType:Y,maxAccess:ee,changeDT:ea}=(0,q.H)({functionId:F.J.DraftInvoiceReturn,access:a,enabled:!r}),et=parseInt(M?.list?.find(e=>"currencyId"===e.key)?.value),er=parseInt(M?.list?.find(e=>"plId"===e.key)?.value),el=parseInt(U?.list?.find(e=>"spId"===e.key)?.value),en=parseInt(U?.list?.find(e=>"siteId"===e.key)?.value),{formik:ei}=(0,S.c)({maxAccess:ee,documentType:{key:"dtId",value:Y?.dtId},initialValues:{recordId:r,dtId:null,reference:"",date:new Date,plantId:null,clientId:null,currencyId:et||null,spId:el||null,siteId:en||null,description:"",status:1,wip:1,isVattable:!1,taxId:null,subTotal:0,amount:0,vatAmount:0,plId:er,ptId:null,weight:0,disSkuLookup:!1,invoiceId:null,invoiceRef:"",returnReasonId:null,search:"",serials:[{id:1,returnId:r||0,srlNo:"",metalId:"",designId:"",itemId:"",sku:"",itemName:"",seqNo:1,extendedPrice:0,baseLaborPrice:0,weight:0,metalRef:"",designRef:"",vatAmount:0,vatPct:0,unitPrice:0,taxId:null,taxDetails:null,priceType:0,volume:0,invoiceReference:"",invoiceTrxId:null,invoiceSeqNo:1,invoiceComponentSeqNo:0}],metalGridData:[],itemGridData:[],taxDetailsStore:[]},validateOnChange:!0,validationSchema:c.object({date:c.string().required(),currencyId:c.string().required(),clientId:c.string().required(),spId:c.string().required(),siteId:c.string().required(),serials:c.array().of(c.object().shape({srlNo:c.string().test({name:"srlNo-first-row-check",test(e,a){let{parent:t}=a;return t?.id==1||(!(t?.id>1)||!!e)&&e}})}))}),onSubmit:async e=>{let{taxDetailsStore:a,itemGridData:t,metalGridData:r,search:l,disSkuLookup:n,serials:d,date:o,...c}=e,u={...c,pcs:d.length,date:(0,i.ku)(o)},p=ei?.values?.serials.filter(e=>e.srlNo).map(({taxDetails:e,recordId:a,...t},r)=>({...t,seqNo:r+1,returnId:a||0}));G({extension:P.P.DraftReturn.set2,record:JSON.stringify({header:u,items:p})}).then(async e=>{m.default.success(em?z.Edited:z.Added),await es(e.recordId),s()})}});async function es(e){let a=await ed(e),t=await eo(e);await eP(a,t)}async function ed(e){let a=await I({extension:P.P.DraftReturn.get,parameters:`_recordId=${e}`}),t=await I({extension:P.P.Client.get,parameters:`_recordId=${a.record.clientId}`});return a.record.date=(0,i.a1)(a?.record?.date),a.record.accountId=t.record.accountId,a}async function eo(e){return await I({extension:P.P.DraftReturnSerial.qry,parameters:`_returnId=${e}`})}function ec(e,a){K||Q(!0);let t=(0,_.Ch)({priceType:3,basePrice:0,volume:parseFloat(e?.volume||0),weight:1,unitPrice:parseFloat(e?.baseLaborPrice),upo:0,qty:parseFloat(e?.weight),extendedPrice:parseFloat(e?.unitPrice).toFixed(2),mdAmount:0,mdType:0,baseLaborPrice:0,totalWeightPerG:0,mdValue:0,tdPct:0,dirtyField:a}),r=(0,O.VW)({priceType:t?.priceType,basePrice:0,qty:parseFloat(e?.weight),weight:parseFloat(e?.weight),extendedPrice:parseFloat(t?.extendedPrice),tdPct:0,baseLaborPrice:0,taxDetails:parseFloat(e?.taxDetails)});return{unitPrice:parseFloat(t?.extendedPrice).toFixed(2),baseLaborPrice:parseFloat(t?.unitPrice).toFixed(2),vatAmount:parseFloat(r?.vatAmount).toFixed(2)}}let eu=X?.find(e=>e.checkId===$.F.POS_JUMP_TO_NEXT_LINE)?.value,em=!!ei.values.recordId,ep=2===ei.values.wip,eI=e=>{if(e.length){let a=e?.map(e=>null!=e.taxId?{...e,extendedPrice:e.unitPrice,taxDetails:ex(ei?.values?.taxDetailsStore,e.taxId)}:e);ei.setFieldValue("serials",a)}},ex=(e,a)=>e?.data?.items?e.data.items.map(e=>e.data).filter(e=>e.taxId===a):[],ev=async e=>{if(!e?.returnId||!e?.itemId)return!0;let a={returnId:ei?.values?.recordId,lineItem:e};return await G({extension:P.P.DraftReturnSerial.del,record:JSON.stringify(a)}),!0};async function eh(e,a,t){if(a?.srlNo)return ef(e,a,t)}async function ef(e,a,t){a.returnId=e?.recordId||t,e.recordId=e?.recordId||t,delete e.serials;let r=await G({extension:P.P.DraftReturnSerial.append,record:JSON.stringify({header:e,lineItem:a}),noHandleError:!0});return!r?.error||(H({message:r?.error}),!1)}async function ey(e,a){if(a?.srlNo)return!!ef(e,a)&&(m.default.success(z.Saved),!0)}async function eg(e,a){let{taxDetailsStore:t,itemGridData:r,metalGridData:l,search:n,disSkuLookup:d,serials:o,date:c,...u}=ei?.values,p={header:{...u,pcs:0,date:(0,i.ku)(c)},items:[]};delete p.header.serials;let I=await G({extension:P.P.DraftReturn.set2,record:JSON.stringify(p)}),x=await ed(I.recordId);if(ei.setFieldValue("recordId",I.recordId),ei.setFieldValue("reference",x?.record?.reference),ei.setFieldValue("date",x?.record?.date),!("import"===a?await eh(x?.record,e):await ey(x?.record,e)))return!1;{m.default.success(z.Saved);let e=await ed(I.recordId),a=await eo(I.recordId);return await eP(e,a),s(),!0}}let eF=[{component:"textfield",label:e.srlNo,name:"srlNo",flex:1.2,updateOn:"blur",jumpToNextLine:eu,disableDuplicate:!0,propsReducer:({row:e,props:a})=>({...a,readOnly:e?.srlNo}),async onChange({row:{update:e,newRow:a,oldRow:t,addRow:r}}){if(a?.srlNo&&a?.srlNo&&a.srlNo!==t?.srlNo){let t=await I({extension:P.P.LastSerialInvoice.get,parameters:`_currencyId=${ei?.values?.currencyId}&_clientId=${ei?.values?.clientId}&_srlNo=${a?.srlNo}`}),l={fieldName:"srlNo",changes:{id:a.id,seqNo:a.id,invoiceSeqNo:a.id,invoiceComponentSeqNo:t?.record?.invoiceComponentSeqNo||0,returnId:ei?.values?.recordId,srlNo:t?.record?.srlNo,sku:t?.record?.sku,itemName:t?.record?.itemName,weight:t?.record?.weight||0,itemId:t?.record?.itemId,priceType:t?.record?.priceType||0,metalId:t?.record?.metalId,metalRef:t?.record?.metalRef,designId:t?.record?.designId,designRef:t?.record?.designRef,categoryName:t?.record?.categoryName,invoiceReference:t?.record?.invoiceRef,volume:t?.record?.volume||0,baseLaborPrice:t?.record?.laborPrice||0,unitPrice:parseFloat(t?.record?.unitPrice).toFixed(2)||0,vatPct:t?.record?.vatPct||0,vatAmount:parseFloat(t?.record?.vatAmount).toFixed(2)||0,invoiceTrxId:t?.record?.trxId||0,...t?.record?.taxId&&{taxId:ei.values?.taxId||t?.record?.taxId,taxDetails:await ex(ei?.values?.taxDetailsStore,ei.values?.taxId||t?.record?.taxId)}}},{unitPrice:n,baseLaborPrice:i}=ec(l.changes,_.Xf);l.changes.unitPrice=n,l.changes.baseLaborPrice=i,null!=l.changes.taxId&&(l.changes.extendedPrice=n,l.changes.taxDetails=ex(ei?.values?.taxDetailsStore,l.changes.taxId)),(ei?.values?.recordId?await ey(ei?.values,l.changes):await eg(l.changes))?await r(l):e({...ei?.initialValues?.serials,id:a?.id,srlNo:""})}}},{component:"textfield",label:e.sku,name:"sku",props:{readOnly:!0}},{component:"textfield",label:e.itemDesc,name:"itemName",flex:2,props:{readOnly:!0}},{component:"textfield",label:e.metalRef,name:"metalRef",flex:.6,props:{readOnly:!0}},{component:"textfield",label:e.invoiceNo,name:"invoiceReference",props:{readOnly:!0}},{component:"numberfield",label:e.weight,name:"weight",props:{readOnly:!0}},{component:"numberfield",label:e.vatAmount,name:"vatAmount",props:{readOnly:!0}},{component:"button",name:"taxDetailsButton",flex:.75,props:{onCondition:e=>e.itemId&&e.taxId?{imgSrc:t(36778).default.src,hidden:!1}:{imgSrc:"",hidden:!0}},label:e.tax,onClick:(e,a)=>{a.qty=a.weight,a.basePrice=0,B({Component:T.Z,props:{taxId:a?.taxId,obj:a}})}},{component:"numberfield",label:e.baseLaborPrice,name:"baseLaborPrice",updateOn:"blur",props:{decimalScale:2,readOnly:!0}},{component:"numberfield",label:e.unitPrice,name:"unitPrice",props:{readOnly:!0}}];async function eb(){let{serials:e,...a}=ei.values;await G({extension:P.P.DraftReturn.close,record:JSON.stringify({...a,date:(0,i.ku)(ei.values.date)})}).then(()=>{m.default.success(z.Closed),s(),es(ei?.values?.recordId)})}async function ew(){let{serials:e,...a}=ei.values;await G({extension:P.P.DraftReturn.reopen,record:JSON.stringify({...a,date:(0,i.ku)(ei.values.date)})}).then(()=>{m.default.success(z.Reopened),s(),es(ei?.values?.recordId)})}async function ej(){B({Component:V.Z,props:{functionId:F.J.DraftInvoiceReturn,recordId:ei.values.recordId}})}async function eN(){B({Component:L.Z,props:{endPoint:P.P.DraftReturnSerial.batch,header:{draftId:ei?.values?.recordId},onCloseimport:ek,maxAccess:ee}})}let eC=[{key:"Close",condition:!ep,onClick:eb,disabled:ep||!em||!ei?.values?.serials?.[0]?.srlNo},{key:"Reopen",condition:ep,onClick:ew,disabled:!ep||3==ei.values.status||!em},{key:"WorkFlow",condition:!0,onClick:ej,disabled:!em},{key:"Import",condition:!0,onClick:eN,disabled:!em||1!=ei.values.status||ep},{key:"AccountSummary",condition:!0,onClick:()=>{B({Component:J.Z,props:{accountId:parseInt(ei.values.accountId),moduleId:1}})},disabled:!ei.values.clientId}];async function ek(){let e=await ed(ei?.values?.recordId),a=await eo(ei?.values?.recordId),t=await Promise.all(a.list?.map(async(a,t)=>{let r=e?.record?.isVattable?await eA(a.taxId):null;return{...a,id:t+1,baseLaborPrice:parseFloat(a.baseLaborPrice).toFixed(2),unitPrice:parseFloat(a.unitPrice).toFixed(2),vatAmount:parseFloat(a.vatAmount).toFixed(2),amount:parseFloat(a.amount).toFixed(2),taxDetails:r}}));await ei.setValues({...ei.values,...e.record,plId:er||ei?.values?.plId,amount:e?.record?.amount,vatAmount:e?.record?.vatAmount,subTotal:e?.record?.subTotal,weight:e?.record?.weight,serials:t.length?t:ei?.initialValues?.serials}),eI(t)}async function eP(e,a){let t=await Promise.all(a?.list?.map(async(a,t)=>{let r=e?.record?.isVattable?await eA(a.taxId):null;return{...a,id:a.seqNo,baseLaborPrice:parseFloat(a.baseLaborPrice).toFixed(2),unitPrice:parseFloat(a.unitPrice).toFixed(2),vatAmount:parseFloat(a.vatAmount).toFixed(2),amount:parseFloat(a.amount).toFixed(2),taxDetails:r}}));await ei.setValues({...ei.values,...e.record,plId:er||ei?.values?.plId,amount:e?.record?.amount,vatAmount:e?.record?.vatAmount,subTotal:e?.record?.subTotal,weight:e?.record?.weight,serials:t.length?t:ei?.initialValues?.serials}),eI(t)}async function eA(e){if(!e)return;let a=await I({extension:A.H.TaxDetailPack.qry,parameters:`_taxId=${e}`});return a?.list}let eS=ei.values.search?ei.values.serials.filter(e=>e.srlNo?.toString()?.includes(ei.values.search.toLowerCase())||e.sku?.toString()?.toLowerCase()?.includes(ei.values.search.toLowerCase())||e.itemName?.toString()?.toLowerCase()?.includes(ei.values.search.toLowerCase())||e.weight?.toString()?.includes(ei.values.search)):ei.values.serials,eV=(e,a,t)=>{if("delete"===a){let e=ei.values.serials;e=e.filter(e=>e.id!==t.id),ei.setFieldValue("serials",e),Q(!0)}else ei.setFieldValue("serials",e)};async function eR(e){if(e){let a=await I({extension:P.P.DocumentTypeDefault.get,parameters:`_dtId=${e}`});ei.setFieldValue("plantId",a?.record?.plantId||null),ei.setFieldValue("spId",a?.record?.spId||el||null),ei.setFieldValue("siteId",a?.record?.siteId||en||null)}}let{subTotal:eD,vatAmount:eO,weight:eq,amount:eZ}=ei?.values?.serials?.reduce((e,a)=>{let t=parseFloat(a?.unitPrice)||0,r=parseFloat(a?.vatAmount)||0,l=parseFloat(a?.weight)||0;return{subTotal:K?parseFloat((e?.subTotal+t).toFixed(2)):ei.values?.subTotal||0,vatAmount:K?parseFloat((e?.vatAmount+r).toFixed(2)):ei.values?.vatAmount||0,weight:K?e?.weight+l:ei.values?.weight||0,amount:K?parseFloat((e?.subTotal+t+e?.vatAmount+r).toFixed(2)):ei.values?.amount||0}},{subTotal:0,vatAmount:0,weight:0,amount:0});async function eT(){if(!await eL())return;let e=[...ei.values.serials],a=await I({extension:P.P.LastSerialInvoice.import,parameters:`_invoiceId=${ei?.values?.invoiceId}`}),t=e.length?e[e.length-1].id:0;if(a.count>0){for(let r of(e=e.filter(e=>e.srlNo),a.list)){let l={srlNo:r.srlNo,itemId:r.itemId,sku:r.sku,itemName:r.itemName,invoiceReference:ei?.values?.invoiceRef,invoiceTrxId:r.trxId,invoiceSeqNo:r.seqNo,invoiceComponentSeqNo:r.componentSeqNo,weight:r.weight,metalId:r.metalId,baseLaborPrice:r.laborPrice,unitPrice:r.unitPrice,vatAmount:r.vatAmount,metalRef:r.metalRef,categoryName:r.categoryName,seqNo:t+1,id:t+1,...a?.record?.taxId&&{taxId:ei.values?.taxId||a?.record?.taxId}},{unitPrice:n,baseLaborPrice:i}=ec(l,_.Xf);l.unitPrice=n,l.baseLaborPrice=i,null!=l.taxId&&(l.extendedPrice=n);let{taxDetailsStore:s,metalGridData:d,itemGridData:o,...c}=ei?.values;(ei?.values?.recordId||e.length>0?await eh(c,l,e?.[0]?.returnId):await eg(l,"import"))&&(t++,ei.setFieldValue("serials",[...e,l]),e.push(l))}m.default.success(z.Saved)}}async function eL(){if(Object.keys(await ei.validateForm()).length){let e=await ei.validateForm(),a=Object.keys(e).reduce((e,a)=>(ei.touched[a]||(e[a]=!0),e),{});return Object.keys(a).length&&ei.setTouched(a,!0),!1}return!0}return l.jsx(u.Z,{resourceId:x.i.DraftSerialReturns,functionId:F.J.DraftInvoiceReturn,form:ei,maxAccess:ee,previewReport:em,isClosed:ep,actions:eC,editMode:em,disabledSubmit:ep&&!em,disabledSavedClear:ep&&!em,children:(0,l.jsxs)(N.R,{children:[l.jsx(C.g,{children:(0,l.jsxs)(d(),{container:!0,spacing:2,children:[l.jsx(d(),{item:!0,xs:4,children:l.jsx(f.Z,{endpointId:y.r.DocumentType.qry,parameters:`_startAt=0&_pageSize=1000&_dgId=${F.J.DraftInvoiceReturn}`,name:"dtId",label:e.documentType,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],readOnly:em,required:!0,valueField:"recordId",displayField:["reference","name"],values:ei.values,maxAccess:ee,onChange:async(e,a)=>{ei.setFieldValue("dtId",a?.recordId),await eR(a?.recordId),ea(a)},error:ei.touched.dtId&&!!ei.errors.dtId})}),l.jsx(d(),{item:!0,xs:4,children:l.jsx(f.Z,{endpointId:g.$.Site.qry,name:"siteId",readOnly:ep,label:e.site,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:ei.values,required:!0,valueField:"recordId",displayField:["reference","name"],maxAccess:ee,onChange:(a,t)=>{t?.isInactive?(ei.setFieldValue("siteId",null),H({message:e.inactiveSite})):ei.setFieldValue("siteId",t?.recordId||null)},error:ei.touched.siteId&&!!ei.errors.siteId})}),l.jsx(d(),{item:!0,xs:2,children:l.jsx(f.Z,{endpointId:y.r.Currency.qry,name:"currencyId",filter:e=>1===e.currencyType,label:e.currency,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],required:!0,readOnly:em,values:ei.values,maxAccess:ee,onChange:(e,a)=>{ei.setFieldValue("invoiceId",null),ei.setFieldValue("invoiceRef",""),ei.setFieldValue("currencyId",a?.recordId||null)},error:ei.touched.currencyId&&!!ei.errors.currencyId})}),l.jsx(d(),{item:!0,xs:2,children:l.jsx(v.Z,{name:"search",value:ei.values.search,label:z.Search,onClear:()=>{ei.setFieldValue("search","")},onChange:e=>{let{value:a}=e.target;ei.setFieldValue("search",a)},onSearch:e=>ei.setFieldValue("search",e),search:!0})}),l.jsx(d(),{item:!0,xs:12,children:(0,l.jsxs)(d(),{container:!0,spacing:2,children:[l.jsx(d(),{item:!0,xs:4,children:l.jsx(v.Z,{name:"reference",label:e.reference,value:ei?.values?.reference,maxAccess:!em&&ee,readOnly:em,onChange:ei.handleChange,onClear:()=>ei.setFieldValue("reference",""),error:ei.touched.reference&&!!ei.errors.reference})}),l.jsx(d(),{item:!0,xs:4,children:l.jsx(f.Z,{endpointId:y.r.Plant.qry,name:"plantId",label:e.plant,readOnly:!0,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:ei.values,valueField:"recordId",displayField:["reference","name"],maxAccess:ee,onChange:(e,a)=>{ei.setFieldValue("plantId",a?.recordId)},error:ei.touched.plantId&&!!ei.errors.plantId})}),l.jsx(d(),{item:!0,xs:4,children:l.jsx(f.Z,{endpointId:ei?.values?.clientId&&P.P.Contact.contact,parameters:`_clientId=${ei.values.clientId}`,name:"contactId",label:e.contact,readOnly:ep,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:ei.values,valueField:"recordId",displayField:["reference","name"],maxAccess:ee,onChange:(e,a)=>{ei.setFieldValue("contactId",a?a.recordId:null)},error:ei.touched.contactId&&!!ei.errors.contactId})}),l.jsx(d(),{item:!0,xs:4,children:l.jsx(n.Z,{name:"date",required:!0,label:e.postingDate,value:ei?.values?.date,onChange:(e,a)=>{ei.setFieldValue("date",a),ei.setFieldValue("invoiceId",null),ei.setFieldValue("invoiceRef","")},editMode:em,readOnly:ep,maxAccess:ee,onClear:()=>ei.setFieldValue("date",""),error:ei.touched.date&&!!ei.errors.date})}),l.jsx(d(),{item:!0,xs:4,children:l.jsx(f.Z,{endpointId:P.P.SalesPerson.qry,name:"spId",required:!0,label:e.salesPerson,columnsInDropDown:[{key:"spRef",value:"Reference"},{key:"name",value:"Name"}],readOnly:ep,valueField:"recordId",displayField:"name",values:ei.values,onChange:(e,a)=>{ei.setFieldValue("spId",a?a.recordId:null)},error:ei.touched.spId&&!!ei.errors.spId})}),l.jsx(d(),{item:!0,xs:4,children:l.jsx(f.Z,{endpointId:A.H.TaxSchedules.qry,name:"taxId",label:e.tax,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],readOnly:!0,values:ei.values,maxAccess:ee,onChange:(e,a)=>{ei.setFieldValue("taxId",a?.recordId||null)},error:ei.touched.taxId&&!!ei.errors.taxId})})]})}),l.jsx(d(),{item:!0,xs:8,children:(0,l.jsxs)(d(),{container:!0,spacing:2,children:[l.jsx(d(),{item:!0,xs:12,children:l.jsx(b.U,{endpointId:P.P.Client.snapshot,filter:{isInactive:!1},valueField:"reference",displayField:"name",secondFieldLabel:e.name,name:"clientId",label:e.client,form:ei,required:!0,readOnly:ep,displayFieldWidth:2,firstFieldWidth:3,valueShow:"clientRef",secondValueShow:"clientName",maxAccess:ee,editMode:em,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"},{key:"szName",value:"Sales Zone"},{key:"keywords",value:"Keywords"},{key:"cgName",value:"Client Group"}],onChange:async(e,a)=>{ei.setFieldValue("clientName",a?.name||null),ei.setFieldValue("clientRef",a?.reference||null),ei.setFieldValue("accountId",a?.accountId||null),ei.setFieldValue("isVattable",a?.isSubjectToVAT||!1),ei.setFieldValue("taxId",a?.taxId||null),ei.setFieldValue("invoiceId",null),ei.setFieldValue("invoiceRef",""),ei.setFieldValue("clientId",a?.recordId||null)},errorCheck:"clientId"})}),l.jsx(d(),{item:!0,xs:5.2,children:l.jsx(f.Z,{endpointId:ei?.values?.clientId&&ei?.values?.date&&P.P.ReturnOnInvoice.balance,parameters:`_clientId=${ei?.values?.clientId}&_returnDate=${ei?.values?.date?.toISOString()}`,filter:e=>e.currencyId==ei?.values?.currencyId,name:"invoiceId",label:e.salesInv,valueField:"recordId",displayField:"reference",displayFieldWidth:1,readOnly:ep,values:ei.values,maxAccess:ee,onChange:(e,a)=>{ei.setFieldValue("invoiceId",a?.recordId||null),ei.setFieldValue("invoiceRef",a?.reference||"")},error:ei.touched.invoiceId&&!!ei.errors.invoiceId},`${ei.values.clientId}-${ei.values.date?.toISOString()}-${ei.values.currencyId}`)}),l.jsx(d(),{item:!0,xs:1,children:l.jsx(W.Z,{onClick:eT,label:z.import,image:"import.png",color:"#000",disabled:!ei?.values?.invoiceId||ep})}),l.jsx(d(),{item:!0,xs:5.8,children:l.jsx(f.Z,{endpointId:P.P.ReturnReasons.qry,name:"returnReasonId",label:e.reason,valueField:"recordId",displayField:"name",readOnly:ep,values:ei.values,maxAccess:ee,onChange:(e,a)=>{ei.setFieldValue("returnReasonId",a?.recordId||null)},error:ei.touched.returnReasonId&&!!ei.errors.returnReasonId})})]})}),l.jsx(d(),{item:!0,xs:4,children:l.jsx(h.Z,{name:"description",label:e.description,value:ei.values.description,rows:2.4,editMode:em,readOnly:ep,maxAccess:ee,onChange:e=>ei.setFieldValue("description",e.target.value),onClear:()=>ei.setFieldValue("description",""),error:ei.touched.description&&!!ei.errors.description})})]})}),l.jsx(w.Q,{children:l.jsx(j._,{onChange:(e,a,t)=>eV(e,a,t),value:eS||[],error:ei.errors.serials,initialValues:ei?.initialValues?.serials?.[0],columns:eF,name:"serials",maxAccess:ee,disabled:ep||Object.entries(ei?.errors||{}).filter(([e])=>"serials"!==e).length>0,allowDelete:!ep,allowAddNewLine:!ei?.values?.search&&(ei.values?.serials?.length===0||!!ei.values?.serials?.[ei.values?.serials?.length-1]?.srlNo),autoDelete:ev,onValidationRequired:eL})}),(0,l.jsxs)(d(),{container:!0,spacing:2,children:[l.jsx(d(),{item:!0,xs:6.5,sx:{display:"flex",flex:1},children:l.jsx(Z.Z,{name:"item",columns:[{field:"seqNo",headerName:e.seqNo,type:"number",flex:.75},{field:"sku",headerName:e.sku,flex:1},{field:"itemName",headerName:e.itemDesc,flex:2},{field:"categoryName",headerName:e.category,flex:2},{field:"pcs",headerName:e.pcs,type:"number",flex:1},{field:"weight",headerName:e.weight,type:"number",flex:1}],gridData:{count:1,list:ei?.values?.itemGridData},rowId:["sku"],maxAccess:a,pagination:!1})}),l.jsx(d(),{item:!0,xs:3,sx:{display:"flex",flex:1},children:l.jsx(Z.Z,{name:"metal",gridData:{count:1,list:ei?.values?.metalGridData},maxAccess:a,columns:[{field:"metal",headerName:e.metal,flex:1},{field:"pcs",headerName:e.pcs,type:"number",flex:1},{field:"totalWeight",headerName:e.totalWeight,type:"number",flex:1}],rowId:["metal"],pagination:!1})}),l.jsx(d(),{item:!0,xs:.5}),l.jsx(d(),{item:!0,xs:2,children:(0,l.jsxs)(d(),{container:!0,spacing:2,children:[l.jsx(d(),{item:!0,xs:12}),l.jsx(d(),{item:!0,xs:12,children:l.jsx(k.Z,{name:"weight",maxAccess:ee,label:e.totalWeight,value:eq,readOnly:!0})}),l.jsx(d(),{item:!0,xs:12}),l.jsx(d(),{item:!0,xs:12,children:l.jsx(k.Z,{name:"subTotal",maxAccess:ee,label:e.subtotal,value:eD,readOnly:!0})}),l.jsx(d(),{item:!0,xs:12,children:l.jsx(k.Z,{name:"vatAmount",maxAccess:ee,label:e.vat,value:eO,readOnly:!0})}),l.jsx(d(),{item:!0,xs:12,children:l.jsx(k.Z,{name:"total",maxAccess:eZ,label:e.total,value:eZ,readOnly:!0})})]})})]})]})})}[u,m,p,I,f,b,j,V,R,D,q,Z,T,L,E,J]=G.then?(await G)():G,r()}catch(e){r(e)}})},7801:(e,a,t)=>{"use strict";t.a(e,async(e,r)=>{try{t.d(a,{Z:()=>u});var l=t(20997),n=t(60520),i=t(99912),s=t(16689),d=t(96119),o=e([n,i]);[n,i]=o.then?(await o)():o;let c=({window:e,onConfirm:a,fullScreen:t,open:r,dialogText:o})=>{let{platformLabels:c}=(0,s.useContext)(n.l);return(0,d.Z)({title:c.import,window:e}),l.jsx(i.Z,{open:r?.flag||!1,DialogText:o,okButtonAction:()=>{"function"==typeof a&&a(),e.close()},fullScreen:t,cancelButtonAction:()=>e.close(),height:"140px"})};c.width=470,c.height=170;let u=c;r()}catch(e){r(e)}})},13893:(e,a,t)=>{"use strict";t.a(e,async(e,r)=>{try{t.d(a,{Z:()=>w});var l=t(20997),n=t(16689),i=t(99155),s=t.n(i),d=t(18611),o=t(44619),c=t(65980),u=t(2296),m=t(60520),p=t(7801),I=t(677),x=t(29352),v=t(86201),h=t(23385),f=t(70755),y=t(96119),g=t(18687),F=e([m,p,I,x,v,g]);[m,p,I,x,v,g]=F.then?(await F)():F;let b=({endPoint:e,header:a,onCloseimport:t,maxAccess:r,window:i})=>{let{stack:F}=(0,I.zY)(),{platformLabels:b}=(0,n.useContext)(m.l),w=(0,n.useRef)(null),[j,N]=(0,n.useState)(null),[C,k]=(0,n.useState)([]),{postRequest:P}=(0,n.useContext)(x.$);(0,y.Z)({title:b.importSerials,window:i});let A=(0,u.useFormik)({initialValues:{serials:"",serialCount:0}}),S=e=>{let a=e.split("\n").filter(e=>""!==e.trim()).length;A.setFieldValue("serialCount",a)},V=async()=>{F({Component:p.Z,props:{open:{flag:!0},fullScreen:!1,onConfirm:R,dialogText:b.importConfirmation}})},R=async()=>{let r=A.values.serials?.replace(/\n/g,",\r\n"),l={...a,serials:r||C};await P({extension:e,record:JSON.stringify(l)}),v.default.success(b.Imported),t(),i.close()},D=[{key:"Import",condition:!0,onClick:V,disabled:!j?.name&&!A?.values?.serials}];return l.jsx(g.Z,{actions:D,onSave:()=>V(),disabledSubmit:!j?.name&&!A?.values?.serials,isSaved:!1,children:(0,l.jsxs)(d.R,{children:[l.jsx(h.Q,{children:(0,l.jsxs)(s(),{container:!0,spacing:2,children:[l.jsx(s(),{item:!0,xs:7,children:l.jsx(o.Z,{name:"name",label:b.SelectCSV,value:j?.name,disabled:A.values.serials||!!j?.name,readOnly:!0,maxAccess:r})}),l.jsx(s(),{item:!0,xs:3,children:l.jsx(f.Z,{onClick:()=>{w.current.click()},label:`${b.Browse}...`,color:"primary",disabled:!!j?.name||A.values.serials})}),l.jsx(s(),{item:!0,xs:2,children:l.jsx(f.Z,{image:"clear.png",onClick:()=>{N(null),k([]),w.current.value=null},label:b.Clear,color:"#f44336"})}),(0,l.jsxs)(s(),{item:!0,xs:12,children:[A.values.serialCount>0&&(0,l.jsxs)("label",{style:{marginBottom:"8px",display:"block"},maxAccess:r,children:[b.serials," ( ",A.values.serialCount," )"]}),l.jsx(c.Z,{name:"serials",label:b.serials,value:A.values.serials,rows:3,readOnly:j?.name,onChange:e=>{A.setFieldValue("serials",e.target.value),S(e.target.value)},onClear:()=>{A.setFieldValue("serials",""),A.setFieldValue("serialCount",0)},error:A.touched.serials&&!!A.errors.serials,maxAccess:r})]})]})}),l.jsx("input",{type:"file",accept:".csv",ref:w,style:{display:"none"},onChange:e=>{let a=e.target.files[0];if(N(a),a){let e=new FileReader;e.onload=e=>{let a=e.target.result;k(a)},e.readAsText(a)}}})]})})};b.width=550,b.height=270;let w=b;r()}catch(e){r(e)}})},70638:(e,a,t)=>{"use strict";t.a(e,async(e,r)=>{try{t.d(a,{Z:()=>v});var l=t(20997),n=t(16689),i=t(97996),s=t(29352),d=t(73846),o=t(96119),c=t(60520),u=t(20562),m=t(3),p=t.n(m),I=e([s,d,c]);[s,d,c]=I.then?(await I)():I;let x=({functionId:e,recordId:a,window:t})=>{let{getRequest:r}=(0,n.useContext)(s.$),{languageId:m}=(0,n.useContext)(d.V),{platformLabels:I}=(0,n.useContext)(c.l),x=a+"-"+e;(0,o.Z)({title:I.WorkFlow,window:t});let{width:v}=(0,u.d)(),h=v<=1024,f=v>1024&&v<=1280,y=h?10:f?12:14,g=h?75:f?85:95,F=h?15:f?20:25,b=async()=>{var t=`_functionId=${e}&_recordId=${a}`;let l=await r({extension:i.P.WorkFlow.graph,parameters:t});return l?.record},w=e=>{let a=[],t=[],r="",l="";return e.objects.forEach(e=>{a.push({functionName:e.functionName,reference:e.reference,date:e.date})}),e.workflow.forEach(a=>{e.objects.forEach(e=>{let t=e.functionName.split(" ").join("\r\n");a.parentId===e.recordId&&a.parentFunctionId===e.functionId&&(r=e.reference+"\r\n"+e.date+"\r\n"+t,a.parentId),a.childId===e.recordId&&a.childFunctionId===e.functionId&&(l=e.reference+"\r\n"+e.date+"\r\n"+t,a.childId)}),""===r||""===l||t.push({from:r,to:l,value:1,labelText:""}),r="",l=""}),t};return(0,n.useEffect)(()=>{!async function(){var e=await b();if(e){let a=(e,a)=>{let t=document.createElement("script");t.type="text/javascript",t.src=e,t.async=!0,t.onload=a,document.head.appendChild(t)};a("https://cdn.amcharts.com/lib/4/core.js",()=>{a("https://cdn.amcharts.com/lib/4/charts.js",()=>{a("https://cdn.amcharts.com/lib/4/themes/animated.js",()=>{am4core.ready(()=>{let a=am4core.create(x,am4charts.SankeyDiagram),t=w(e);a.data=t,a.dataFields.fromName="from",a.dataFields.toName="to",a.dataFields.value="value",a.paddingRight=2===m?0:40,a.paddingLeft=2===m?40:0,a.tooltip.label.fontSize=y;let r=a.nodes.template;r.draggable=!1,r.inert=!0,r.clickable=!1,r.width=g,r.height=F,r.nameLabel.label.fontSize=y,r.nameLabel.locationX=2===m?.85:0,r.nameLabel.height=void 0,r.nameLabel.label.fontWeight="bold";let l=a.links.template;l.middleLine.strokeOpacity=.3,l.middleLine.stroke=am4core.color("#555"),l.middleLine.strokeWidth=5,l.middleLine.hoverable=!1,l.fillOpacity=0,l.hoverable=!0,l.hoverOnFocus=!0,l.fill=am4core.color("#A8C686"),l.isHover=!0,a.appear(1e3,100)})})})})}}()},[]),l.jsx("div",{id:x,className:p().root})};x.width=950;let v=x;r()}catch(e){r(e)}})}};