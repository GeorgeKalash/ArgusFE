"use strict";exports.id=57617,exports.ids=[57617],exports.modules={57617:(e,a,t)=>{t.a(e,async(e,n)=>{try{t.d(a,{Z:()=>$});var r=t(20997),l=t(99155),d=t.n(l),s=t(16689),c=t(75609),o=t(80582),u=t(86201),i=t(29352),m=t(38509),y=t(6416),x=t(44619),h=t(95965),p=t(60520),v=t(18611),I=t(23385),C=t(27736),F=t(71278),f=t(79660),b=t(68728),A=t(97969),g=t(66198),j=t(91184),k=t(61274),V=t(61932),R=t(65980),O=t(86794),M=t(79390),N=t(70638),Z=t(677),w=t(78630),T=t(4902),P=t(43991),q=t(19138),S=t(99912),D=t(38782),_=t(96119),H=t(70755),J=e([o,u,i,m,p,F,k,O,N,Z,w,S,D]);function $({recordId:e,window:a}){let{getRequest:t,postRequest:n}=(0,s.useContext)(i.$),{platformLabels:l,defaultsData:J,userDefaultsData:$}=(0,s.useContext)(p.l),{stack:B}=(0,Z.zY)(),{labels:E,access:G}=(0,D.Z)({datasetId:y.i.PaymentOrder,editMode:!!e}),{documentType:L,maxAccess:U,changeDT:W}=(0,O.H)({functionId:b.J.PaymentOrder,access:G,enabled:!e});(0,_.Z)({title:E.PaymentOrder,window:a});let Y=(0,m.E)({endpointId:g.H.PaymentOrders.page2}),z=parseInt($?.list?.find(e=>"plantId"===e.key)?.value),Q=parseInt(J?.list?.find(e=>"currencyId"===e.key)?.value),K=parseInt($?.list?.find(e=>"cashAccountId"===e.key)?.value),{formik:X}=(0,h.c)({documentType:{key:"dtId",value:L?.dtId,reference:L?.reference},initialValues:{recordId:null,reference:"",accountId:"",accountType:"",currencyId:parseInt(Q),currencyName:"",paymentMethod:null,date:new Date,amount:null,notes:"",exRate:1,rateCalcMethod:1,baseAmount:null,dtId:null,status:1,releaseStatus:null,cashAccountId:parseInt(K),plantId:parseInt(z)},maxAccess:U,validateOnChange:!0,validationSchema:c.object({accountType:c.number().required(),currencyId:c.number().required(),date:c.string().required(),paymentMethod:c.string().required(),amount:c.number().required()}),onSubmit:async e=>{let a=e.recordId,t={header:{...e,date:(0,M.ku)(e.date),recordId:a},items:[],costCenters:[]},r=await n({extension:g.H.PaymentOrders.set2,record:JSON.stringify(t)});a?u.default.success(l.Edited):u.default.success(l.Added),ed(r.recordId),Y()}}),{labels:ee,access:ea}=(0,m.J)({endpointId:T.q.Currency.get,datasetId:y.i.MultiCurrencyRate});async function et(e,a){if(e&&a){let n=await t({extension:T.q.Currency.get,parameters:`_currencyId=${e}&_date=${(0,M.Uf)(a)}&_rateDivision=${q.B.FINANCIALS}`}),r=(0,P.fB)({amount:X.values.amount,exRate:n.record?.exRate,baseAmount:0,rateCalcMethod:n.record?.rateCalcMethod,dirtyField:P.ss});X.setFieldValue("baseAmount",parseFloat(r?.baseAmount).toFixed(2)||0),X.setFieldValue("exRate",n.record?.exRate),X.setFieldValue("rateCalcMethod",n.record?.rateCalcMethod)}}let en=-1===X.values.status,er=2==X.values.wip,el=!!X.values.recordId;async function ed(e){let a=await t({extension:g.H.PaymentOrders.get,parameters:`_recordId=${e}`});X.setValues({...a.record,date:(0,M.a1)(a.record.date)})}let es=async()=>{B({Component:N.Z,props:{functionId:b.J.PaymentOrder,recordId:X.values.recordId}})},ec=async()=>{let e=await n({extension:g.H.PaymentOrders.cancel,record:JSON.stringify(X.values)});e?.recordId&&(u.default.success(l.Cancelled),Y(),ed(e.recordId))},eo=async()=>{let e=await n({extension:g.H.PaymentOrders.close,record:JSON.stringify(X.values)});e?.recordId&&(u.default.success(l.Closed),Y(),ed(e.recordId))},eu=async()=>{let e=await n({extension:g.H.PaymentOrders.reopen,record:JSON.stringify(X.values)});e?.recordId&&(u.default.success(l.Reopened),Y(),ed(e.recordId))},ei=[{key:"Cancel",condition:!0,onClick:()=>{var e,a;e=l.CancelConf,a=l.Confirmation,B({Component:S.Z,props:{DialogText:e,okButtonAction:async()=>{await ec()},fullScreen:!1,close:!0},width:400,height:150,title:a})},disabled:!el||en},{key:"RecordRemarks",condition:!0,onClick:"onRecordRemarks",disabled:!el},{key:"WorkFlow",condition:!0,onClick:es,disabled:!el},{key:"Attachment",condition:!0,onClick:"onClickAttachment",disabled:!el},{key:"Close",condition:!er,onClick:eo,disabled:er||!el||en},{key:"Reopen",condition:er,onClick:eu,disabled:!er||en},{key:"Approval",condition:!0,onClick:"onApproval",disabled:!er}];return r.jsx(o.Z,{resourceId:y.i.PaymentOrder,form:X,maxAccess:U,editMode:el,previewReport:el,actions:ei,functionId:b.J.PaymentOrder,disabledSubmit:er||en,children:r.jsx(v.R,{children:r.jsx(I.Q,{children:(0,r.jsxs)(d(),{container:!0,spacing:2,children:[r.jsx(d(),{item:!0,xs:6,children:r.jsx(F.Z,{endpointId:f.r.DocumentType.qry,parameters:`_dgId=${b.J.PaymentOrder}&_startAt=0&_pageSize=50`,filter:el?void 0:e=>1===e.activeStatus,name:"dtId",label:E.documentType,readOnly:el,valueField:"recordId",displayField:"name",values:X.values,onChange:async(e,a)=>{await W(a),X.setFieldValue("dtId",a?.recordId||null)},error:X.touched.dtId&&!!X.errors.dtId,maxAccess:U})}),r.jsx(d(),{item:!0,xs:6,children:(0,r.jsxs)(d(),{container:!0,spacing:1,alignItems:"center",children:[r.jsx(d(),{item:!0,xs:8,children:r.jsx(F.Z,{endpointId:f.r.Currency.qry,name:"currencyId",label:E.currency,filter:e=>1===e.currencyType,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],required:!0,readOnly:er||en,values:X.values,onChange:(e,a)=>{et(a?.recordId,X.values.date),X.setFieldValue("currencyId",a?.recordId||null),X.setFieldValue("currencyName",a?.name||"")},error:X.touched.currencyId&&!!X.errors.currencyId})}),r.jsx(d(),{item:!0,xs:4,children:r.jsx(H.Z,{onClick:()=>{var e;return e=X.values,void B({Component:w.Z,props:{labels:ee,maxAccess:ea,data:e,onOk:e=>{X.setValues(a=>({...a,...e}))}},width:500,height:500,title:l.MultiCurrencyRate})},image:"popup.png",tooltipText:l.MultiCurrencyRate,disabled:!X.values.currencyId||X.values.currencyId===Q})})]})}),r.jsx(d(),{item:!0,xs:6,children:r.jsx(x.Z,{name:"reference",label:E.reference,value:X.values.reference,readOnly:el,maxAccess:!el&&U,maxLength:"15",onChange:X.handleChange,onClear:()=>X.setFieldValue("reference",""),error:X.touched.reference&&!!X.errors.reference})}),r.jsx(d(),{item:!0,xs:6,children:r.jsx(F.Z,{datasetId:A.v.PAYMENT_METHOD,name:"paymentMethod",label:E.paymentMethod,valueField:"key",displayField:"value",values:X.values,required:!0,readOnly:er||en,maxAccess:U,onChange:(e,a)=>{a?.key||X.setFieldValue("cashAccountId",""),X.setFieldValue("paymentMethod",a?.key||null)},error:X.touched.paymentMethod&&!!X.errors.paymentMethod})}),r.jsx(d(),{item:!0,xs:6,children:r.jsx(C.Z,{name:"date",label:E.date,value:X.values?.date,required:!0,onChange:async(e,a)=>{X.setFieldValue("date",a),await et(X.values.currencyId,a)},onClear:()=>X.setFieldValue("date",null),readOnly:er||en,error:X.touched.date&&!!X.errors.date,maxAccess:U})}),r.jsx(d(),{item:!0,xs:6,children:r.jsx(F.Z,{endpointId:V.G.CashAccount.qry,parameters:"_type=0",name:"cashAccountId",readOnly:er||en,label:E.cashAccount,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:X.values,maxAccess:U,onChange:(e,a)=>{X.setFieldValue("cashAccountId",a?.recordId||null)},error:X.touched.cashAccountId&&!!X.errors.cashAccountId})}),r.jsx(d(),{item:!0,xs:6,children:r.jsx(F.Z,{endpointId:f.r.Plant.qry,name:"plantId",label:E.plant,valueField:"recordId",readOnly:er||en,displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:X.values,onChange:(e,a)=>{X.setFieldValue("plantId",a?a?.recordId:"")},error:X.touched.plantId&&!!X.errors.plantId})}),r.jsx(d(),{item:!0,xs:6,children:r.jsx(j.Z,{name:"amount",required:!0,label:E.amount,maxLength:"10",decimalScale:2,readOnly:er||en,value:X.values.amount,maxAccess:U,onChange:async e=>{let a=(0,P.fB)({amount:e.target.value??0,exRate:X.values?.exRate,baseAmount:0,rateCalcMethod:X.values?.rateCalcMethod,dirtyField:P.ss});X.setFieldValue("baseAmount",parseFloat(a?.baseAmount).toFixed(2)||0),X.setFieldValue("amount",e.target.value)},onClear:()=>{X.setFieldValue("amount","")},error:X.touched.amount&&!!X.errors.amount})}),r.jsx(d(),{item:!0,xs:6,children:r.jsx(F.Z,{datasetId:A.v.FI_PV_GROUP_TYPE,name:"accountType",filter:e=>1==e.key||4==e.key,label:E.accountType,valueField:"key",displayField:"value",values:X.values,required:!0,readOnly:er||en,maxAccess:U,onChange:(e,a)=>{a?.key||(X.setFieldValue("accountId",null),X.setFieldValue("accountRef",""),X.setFieldValue("accountName","")),X.setFieldValue("accountType",a?.key||null)},error:X.touched.accountType&&!!X.errors.accountType})}),r.jsx(d(),{item:!0,xs:6,children:r.jsx(F.Z,{neverPopulate:!0,endpointId:g.H.DescriptionTemplate.qry,name:"templateId",label:E.descriptionTemplate,valueField:"recordId",displayField:"name",values:X.values,onChange:(e,a)=>{let t=X.values.notes||"";a?.name&&X.setFieldValue("notes",""===t?a.name:`${t}
${a.name}`),X.setFieldValue("templateId",a?.recordId||null)},readOnly:er||en,error:X.touched.templateId&&!!X.errors.templateId,maxAccess:U})}),r.jsx(d(),{item:!0,xs:6,children:r.jsx(k.U,{endpointId:g.H.Account.snapshot,name:"accountId",readOnly:er||en||!X.values.accountType,label:E.accountReference,valueField:"reference",displayField:"name",valueShow:"accountRef",secondValueShow:"accountName",form:X,columnsInDropDown:[{key:"reference",value:"Account Ref"},{key:"name",value:"Name",grid:4},{key:"keywords",value:"Keywords"}],firstFieldWidth:4,displayFieldWidth:4,filter:{type:X.values.accountType,isInactive:e=>!0!==e},onChange:(e,a)=>{X.setFieldValue("accountRef",a?.reference||""),X.setFieldValue("accountName",a?.name||""),X.setFieldValue("accountGroupName",a?.groupName||""),X.setFieldValue("accountId",a?.recordId||null)},error:X.touched.accountId&&!!X.errors.accountId,maxAccess:U})}),r.jsx(d(),{item:!0,xs:6,children:r.jsx(R.Z,{name:"notes",type:"text",label:E.notes,value:X.values.notes,rows:3,readOnly:er||en,maxAccess:U,onChange:X.handleChange,onClear:()=>X.setFieldValue("notes","")})})]})})})})}[o,u,i,m,p,F,k,O,N,Z,w,S,D]=J.then?(await J)():J,$.width=950,$.height=450,n()}catch(e){n(e)}})},78630:(e,a,t)=>{t.a(e,async(e,n)=>{try{t.d(a,{Z:()=>b});var r=t(20997),l=t(99155),d=t.n(l),s=t(16689),c=t(6416),o=t(44619),u=t(95965),i=t(18611),m=t(23385),y=t(91184),x=t(43991),h=t(29352),p=t(4902);t(79390),t(19138);var v=t(38509),I=t(96119),C=t(60520),F=t(18687),f=e([h,v,C,F]);function b({data:e,onOk:a,DatasetIdAccess:t,window:n}){let{getRequest:l}=(0,s.useContext)(h.$),{platformLabels:f}=(0,s.useContext)(C.l);(0,I.Z)({title:f.MultiCurrencyRate,window:n});let{labels:b,access:A}=(0,v.J)({endpointId:p.q.Currency.get,DatasetIdAccess:t,datasetId:c.i.MultiCurrencyRate}),{formik:g}=(0,u.c)({initialValues:{currencyId:e?.currencyId,currencyName:e?.currencyName,exchangeId:e?.exchangeId,exchangeName:e?.exchangeName,rateCalcMethod:e?.rateCalcMethod,rateCalcMethodName:e?.rateCalcMethodName,rateTypeId:e?.rateTypeId,exRate:e?.exRate||null,amount:e?.amount||0,baseAmount:e?.baseAmount,rateTypeName:e?.rateTypeName},maxAccess:A,validateOnChange:!0}),j=()=>{if(a){let e={...g.values,exRate:g.values.exRate,baseAmount:g.values.baseAmount,amount:g.values.amount};a(e),n.close()}},k=[{key:"Ok",condition:!0,onClick:j,disabled:!1}];return r.jsx(F.Z,{onSave:j,actions:k,maxAccess:A,editMode:!1,isSaved:!1,children:r.jsx(i.R,{children:r.jsx(m.Q,{children:(0,r.jsxs)(d(),{container:!0,spacing:2,children:[r.jsx(d(),{item:!0,xs:12,children:r.jsx(o.Z,{name:"currencyName",value:g?.values?.currencyName,label:b.currency,readOnly:!0})}),r.jsx(d(),{item:!0,xs:12,children:r.jsx(o.Z,{name:"rateTypeName",value:g?.values?.rateTypeName,label:b.rateType,readOnly:!0})}),r.jsx(d(),{item:!0,xs:12,children:r.jsx(o.Z,{name:"exchangeName",value:g?.values?.exchangeName,label:b.exchangeTable,readOnly:!0})}),r.jsx(d(),{item:!0,xs:12,children:r.jsx(o.Z,{name:"rateCalcMethodName",value:g?.values?.rateCalcMethodName,label:b.rateCalcMethod,readOnly:!0})}),r.jsx(d(),{item:!0,xs:12,children:r.jsx(y.Z,{name:"exRate",value:g?.values?.exRate,label:b.rate,readOnly:g?.values?.amount==0,maxAccess:A,onClear:()=>{g.setFieldValue("baseAmount",""),g.setFieldValue("exRate","")},decimalScale:7,onChange:a=>{let t=a.target.value;if(!t){g.setFieldValue("exRate",""),g.setFieldValue("baseAmount","");return}g.setFieldValue("exRate",t);let n=(0,x.fB)({amount:e?.amount||0,exRate:t,baseAmount:parseFloat(g?.values?.baseAmount||0).toFixed(2),rateCalcMethod:g?.values?.rateCalcMethod,dirtyField:x.ss});g.setValues({...g.values,...n,baseAmount:parseFloat(n.baseAmount).toFixed(2)})}})}),r.jsx(d(),{item:!0,xs:12,children:r.jsx(y.Z,{name:"amount",value:g?.values?.amount,label:b.amount,readOnly:!0})}),r.jsx(d(),{item:!0,xs:12,children:r.jsx(y.Z,{name:"baseAmount",value:g?.values?.baseAmount,label:b.baseAmount,readOnly:g?.values?.amount==0,onClear:()=>{g.setFieldValue("baseAmount",""),g.setFieldValue("exRate","")},maxAccess:A,onChange:a=>{let t=a.target.value;if(!t){g.setFieldValue("baseAmount",""),g.setFieldValue("exRate","");return}g.setFieldValue("baseAmount",t);let n=(0,x.fB)({amount:e?.amount||0,exRate:g?.values?.exRate,baseAmount:parseFloat(t||0).toFixed(2),rateCalcMethod:g?.values?.rateCalcMethod,dirtyField:x.i5});g.setValues({...g.values,...n})}})})]})})})})}[h,v,C,F]=f.then?(await f)():f,b.width=500,b.height=500,n()}catch(e){n(e)}})}};