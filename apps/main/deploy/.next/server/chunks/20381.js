exports.id=20381,exports.ids=[20381],exports.modules={3:e=>{e.exports={root:"WorkFlow_root__EINm1"}},20381:(e,t,a)=>{"use strict";a.a(e,async(e,l)=>{try{a.d(t,{Z:()=>X});var r=a(20997),n=a(27736),d=a(79390),s=a(99155),i=a.n(s),o=a(16689),u=a(75609),c=a(80582),m=a(86201),p=a(29352),y=a(38509),x=a(6416),v=a(44619),h=a(65980),I=a(71278),F=a(79660),f=a(54242),b=a(68728),P=a(61274),g=a(23385),D=a(15051),A=a(18611),V=a(42020),w=a(91184),j=a(66198),q=a(95965),k=a(70638),C=a(677),T=a(60520),O=a(82173),N=a(57629),R=a(42614),S=a(70305),Z=a(86794),Q=a(67906),L=a(93105),_=a(13567),M=a(70755),W=a(97969),$=a(24356),E=a(96119),B=a(38782),J=e([c,m,p,y,I,P,D,k,C,T,S,Z,$,B]);function X({recordId:e,window:t}){let{getRequest:l,postRequest:s}=(0,o.useContext)(p.$),{stack:J}=(0,C.zY)(),{stack:X}=(0,S.V)(),{platformLabels:z,defaultsData:H,userDefaultsData:U}=(0,o.useContext)(T.l),[Y,K]=(0,o.useState)({text:"%",value:2}),G=(0,o.useRef)([]),[ee,et]=(0,o.useState)([]),[ea,el]=(0,o.useState)(!1),er=parseInt(U?.list?.find(({key:e})=>"plantId"===e)?.value),en=parseInt(H?.list?.find(({key:e})=>"currencyId"===e)?.value),{labels:ed,access:es}=(0,B.Z)({datasetId:x.i.PurchaseQuotations,editMode:!!e});(0,E.Z)({title:ed.quotations,window:t});let{documentType:ei,maxAccess:eo,changeDT:eu}=(0,Z.H)({functionId:b.J.PurchaseQuotation,access:es,enabled:!e}),ec={recordId:null,dtId:null,reference:"",status:1,date:new Date,plantId:er,vendorId:null,vendorRef:"",vendorName:"",deliveryMethodId:null,currencyId:en,vendorDocRef:null,subtotal:0,tdPct:0,tdAmount:0,tdType:2,paymentMethod:null,miscAmount:0,amount:0,description:"",isVattable:!1,vatAmount:0,qty:0,mdValue:0,mdPct:0,deliveryDate:null,weight:0,volume:0,items:[{id:1,quotationId:e||0,itemId:null,sku:"",itemName:"",seqNo:1,siteId:null,muId:null,qty:0,volume:0,weight:1,msId:0,muQty:0,baseQty:0,mdType:1,basePrice:0,mdValue:0,unitPrice:0,vatAmount:0,mdAmount:0,upo:0,extendedPrice:0,mdAmountPct:null,priceType:1,applyVat:!1,taxId:null,taxDetails:null,notes:null}]},em=(0,y.E)({endpointId:_.y.PurchaseQuotation.page}),{schema:ep,requiredFields:ey}=(0,L.m)({sku:e=>e?.sku,qty:e=>e?.qty>0},!0,eo,"items"),{formik:ex}=(0,q.c)({maxAccess:eo,documentType:{key:"dtId",value:ei?.dtId,reference:ei?.reference},conditionSchema:["items"],initialValues:ec,validateOnChange:!0,validationSchema:u.object({currencyId:u.number().required(),vendorId:u.number().required(),date:u.date().required(),items:u.array().of(ep)}),onSubmit:async e=>{let t={...e,date:(0,d.ku)(e.date),deliveryDate:e.deliveryDate?(0,d.ku)(e.deliveryDate):null,miscAmount:e.miscAmount||0};delete t.items;let a=e.items.filter(e=>Object.values(ey)?.every(t=>t(e))).map((t,a)=>({...t,seqNo:a+1,deliveryDate:t?.deliveryDate?(0,d.ku)(t.deliveryDate):null,lastPurchaseDate:t?.lastPurchaseDate?(0,d.ku)(t.lastPurchaseDate):null,applyVat:e.isVattable||!1})),l=await s({extension:_.y.PurchaseQuotation.set2,record:JSON.stringify({header:t,items:a})});m.default.success(e.recordId?z.Edited:z.Added),await e$(l.recordId),em()}}),ev=!!ex.values.recordId,eh=1==ex.values.status;async function eI(e,t=null){if(!e)return;let a=ex.values.items?.find(t=>parseInt(t.itemId)===e)?.msId,l=a||t||a,r=ee?.filter(e=>e.msId==l)||[];G.current=r}let eF=[{component:"resourcelookup",label:ed.sku,name:"sku",flex:2,props:{endpointId:f.$.Item.snapshot,parameters:{_categoryId:0,_msId:0,_startAt:0,_size:1e3},displayField:"sku",valueField:"sku",mapping:[{from:"recordId",to:"itemId"},{from:"sku",to:"sku"},{from:"name",to:"itemName"}],columnsInDropDown:[{key:"sku",value:"SKU"},{key:"name",value:"Item Name"},{key:"flName",value:"FL Name"}],displayFieldWidth:5,filter:{purchaseItem:!0}},async onChange({row:{update:e,newRow:t}}){if(!t.itemId)return;let a=await ej(t.itemId),l=await eq(t.itemId),r=null,n=null;if(ex.values.taxId){let e=(await ek(ex.values.taxId)).map(e=>({taxId:ex.values.taxId,taxCodeId:e.taxCodeId,taxBase:e.taxBase,amount:e.amount}));r=ex.values.taxId,n=e}else if(l?.taxId){let e=(await ek(l.taxId)).map(e=>({taxId:l.taxId,taxCodeId:e.taxCodeId,taxBase:e.taxBase,amount:e.amount}));r=l.taxId,n=e}let d=ee?.filter(e=>e.msId===l?.msId);eI(t?.itemId,l?.msId);let s=G?.current?.filter(e=>e.recordId===t?.muId);e({volume:parseFloat(a?.volume)||0,weight:parseFloat(a?.weight||0).toFixed(2),vatAmount:parseFloat(l?.vatPct||0).toFixed(2),basePrice:0,unitPrice:0,priceType:l?.priceType||1,mdAmount:0,qty:0,msId:l?.msId,muRef:d?.[0]?.reference,muId:d?.[0]?.recordId,mdValue:0,taxId:r,taxDetails:n||null,baseQty:s?.[0]?.qty*t?.qty})}},{component:"textfield",label:ed.itemName,name:"itemName",flex:3,props:{readOnly:!0}},{component:"resourcecombobox",label:ed.mu,name:"muRef",props:{store:G?.current,displayField:"reference",valueField:"recordId",mapping:[{from:"reference",to:"muRef"},{from:"qty",to:"muQty"},{from:"recordId",to:"muId"}]},async onChange({row:{update:e,newRow:t}}){let a=G?.current.filter(e=>e.recordId==t?.muId);e({baseQty:t?.qty*a?.[0]?.qty})},propsReducer:({row:e,props:t})=>({...t,store:G?.current})},{component:"numberfield",label:ed.quantity,name:"qty",updateOn:"blur",onChange({row:{update:e,newRow:t}}){let a=eT(t,O.bT);eI(t?.itemId,t?.msId);let l=G?.current.filter(e=>e.recordId===t?.muId);e({...a,baseQty:l?.[0]?.qty*t?.qty})}},{component:"numberfield",label:ed.volume,name:"volume",props:{readOnly:!0}},{component:"numberfield",label:ed.weight,name:"weight",props:{readOnly:!0}},{component:"numberfield",label:ed.baseprice,name:"basePrice",props:{decimalScale:5},updateOn:"blur",async onChange({row:{update:e,newRow:t}}){let a=eT(t,O.yO);e(a)}},{component:"textfield",label:ed.requestRef,name:"requestRef",flex:2,props:{readOnly:!0}},{component:"numberfield",label:ed.unitCost,name:"unitPrice",props:{decimalScale:5},updateOn:"blur",async onChange({row:{update:e,newRow:t}}){let a=eT(t,O.Xf);e(a)}},{component:"numberfield",label:ed.VAT,name:"vatAmount",props:{readOnly:!0}},{component:"button",name:"taxDetailsButton",props:{onCondition:e=>({imgSrc:e.itemId&&e.taxId?a(36778).default.src:"",hidden:!(e.itemId&&e.taxId)})},label:ed.tax,onClick:(e,t)=>{J({Component:$.Z,props:{taxId:t?.taxId,obj:t}})}},{component:"numberfield",label:ed.markdown,name:"mdAmount",updateOn:"blur",flex:2,props:{ShowDiscountIcons:!0,iconsClicked:ef,type:"numeric",iconKey:({value:e,data:t})=>(e?.mdType||t?.mdType)===O.Xo?"%":"123"},async onChange({row:{update:e,newRow:t}}){let a=eT(t,O.On);e(a)}},{component:"numberfield",label:ed.extendedprice,name:"extendedPrice",updateOn:"blur",async onChange({row:{update:e,newRow:t}}){let a=eT(t,O.bh);e(a)}},{component:"textfield",label:ed.notes,name:"notes",flex:2},{component:"date",label:ed.deliveryDate,name:"deliveryDate",flex:2}];async function ef({updateRow:e,value:t,data:a}){let l=(t?.mdType||a?.mdType)===O.Xo?O.RD:O.Xo,r=eC(t?.mdAmount,l);e({id:a.id,changes:{mdAmount:r,mdAmountPct:l,mdType:l},commitOnBlur:!0})}async function eb(){let e={...ex.values};delete e.items,e.date=(0,d.ku)(e.date),e.deliveryDate=e.deliveryDate?(0,d.ku)(e.deliveryDate):null,await s({extension:_.y.GeneratePOPRPack.gen2,record:JSON.stringify(e)}),m.default.success(z.Order),em(),t.close()}async function eP(){J({Component:k.Z,props:{functionId:b.J.PurchaseQuotation,recordId:ex.values.recordId}})}let eg=[{key:"RecordRemarks",condition:!0,onClick:"onRecordRemarks",disabled:!ev},{key:"WorkFlow",condition:!0,onClick:eP,disabled:!ev},{key:"Order",condition:!0,onClick:eb,disabled:!(ev&&eh)},{key:"Attachment",condition:!0,onClick:"onClickAttachment",disabled:!ev}];async function eD(e,t){e?.record?.tdType==1||e?.record?.tdType==null?K({text:"123",value:1}):K({text:"%",value:2});let a=t?.list.length!=0?await Promise.all(t.list?.map(async(t,a)=>{let l=e?.record?.isVattable?await ek(t.taxId):null;return{...t,id:a+1,basePrice:parseFloat(t.basePrice).toFixed(5),unitPrice:parseFloat(t.unitPrice).toFixed(3),upo:parseFloat(t.upo).toFixed(2),vatAmount:parseFloat(t.vatAmount).toFixed(2),extendedPrice:parseFloat(t.extendedPrice).toFixed(2),deliveryDate:t?.deliveryDate?d.a1(t.deliveryDate):null,lastPurchaseDate:t?.lastPurchaseDate?d.a1(t.lastPurchaseDate):null,taxDetails:l}})):ex.values.items;ex.setValues({...e.record,currentDiscount:e?.record?.tdType==1||e?.record?.tdType==null?e?.record?.tdAmount:e?.record?.tdPct,amount:parseFloat(e?.record?.amount).toFixed(2),items:a})}async function eA(e){let t=await l({extension:_.y.PurchaseQuotation.get,parameters:`_recordId=${e}`});return t.record.date=(0,d.a1)(t?.record?.date),t.record.deliveryDate=(0,d.a1)(t?.record?.deliveryDate),t}async function eV(e){return await l({extension:_.y.QuotationItem.qry,parameters:`_quotationId=${e}`})}async function ew(e){ex.setFieldValue("isVattable",e?.isTaxable||!1),ex.setFieldValue("tdAmount",e?.tradeDiscount||0),ex.setFieldValue("currentDiscount",e?.tradeDiscount||0),ex.setFieldValue("tdType",e?.tradeDiscount?2:ex.values.tdType),ex.setFieldValue("taxId",e?.taxId||null),ex.setFieldValue("vendorName",e?.name||""),ex.setFieldValue("vendorRef",e?.reference||""),ex.setFieldValue("vendorId",e?.recordId||null)}async function ej(e){let t=await l({extension:f.$.ItemPhysProp.get,parameters:`_itemId=${e}`});return t?.record}async function eq(e){let t=await l({extension:f.$.Item.get,parameters:`_recordId=${e}`});return t?.record}async function ek(e){if(!e)return;let t=await l({extension:j.H.TaxDetailPack.qry,parameters:`_taxId=${e}`});return t?.list}function eC(e,t){let a=parseFloat(e)||0;return t===O.Xo?(a<0||a>100)&&(a=0):a<0&&(a=0),a}function eT(e,t,a){ea||el(!0);let l=eC(e?.mdAmount,e?.mdType),r=(0,O.Ch)({priceType:e?.priceType||0,basePrice:parseFloat(e?.basePrice)||0,volume:parseFloat(e?.volume)||0,weight:parseFloat(e?.weight),unitPrice:parseFloat(e?.unitPrice||0),upo:parseFloat(e?.upo)?parseFloat(e?.upo):0,qty:parseFloat(e?.qty),extendedPrice:parseFloat(e?.extendedPrice),mdAmount:l,mdType:e?.mdType,baseLaborPrice:0,totalWeightPerG:0,mdValue:parseFloat(e?.mdValue),tdPct:ex?.values?.tdPct||0,dirtyField:t}),n=(0,N.VW)({priceType:r?.priceType,weight:parseFloat(r?.weight),basePrice:r?.basePrice,qty:r?.qty,extendedPrice:parseFloat(r?.extendedPrice),baseLaborPrice:r?.baseLaborPrice,vatAmount:parseFloat(r?.vatAmount),tdPct:ex?.values?.tdPct,taxDetails:ex.values.isVattable?e.taxDetails:null}),d={...e,id:e?.id,qty:r?.qty?parseFloat(r?.qty).toFixed(2):0,volume:r?.volume?parseFloat(r.volume).toFixed(4):0,weight:parseFloat(r?.weight).toFixed(2),basePrice:r?.basePrice?parseFloat(r.basePrice).toFixed(5):0,unitPrice:r?.unitPrice?parseFloat(r.unitPrice).toFixed(3):0,extendedPrice:r?.extendedPrice?parseFloat(r.extendedPrice).toFixed(2):0,upo:parseFloat(r?.upo).toFixed(2),mdValue:r?.mdValue,mdType:r?.mdType,mdAmount:r?.mdAmount?parseFloat(r.mdAmount).toFixed(2):0,vatAmount:n?.vatAmount?parseFloat(n.vatAmount).toFixed(2):0};return a?{changes:d}:d}let eO=ex.values.items?.filter(e=>void 0!==e.itemId).map(e=>({...e,basePrice:parseFloat(e.basePrice)||0,unitPrice:parseFloat(e.unitPrice)||0,upo:parseFloat(e.upo)||0,vatAmount:parseFloat(e.vatAmount)||0,weight:parseFloat(e.weight)||0,volume:parseFloat(e.volume)||0,extendedPrice:parseFloat(e.extendedPrice)||0})),eN=(0,R.Ww)(eO),eR=0==ex.values.miscAmount?0:parseFloat(ex.values.miscAmount),eS=(0,R.Ot)(eO,{totalQty:0,totalWeight:0,totalVolume:0,totalUpo:0,sumVat:0,sumExtended:parseFloat(eN),tdAmount:parseFloat(ex.values.tdAmount),net:0,miscAmount:eR}),eZ=ea?eS?.totalQty:ex.values?.qty||0,eQ=ea?eS?.net:ex.values?.amount||0,eL=ea?eS?.totalVolume:ex.values?.volume||0;ea?eS?.totalWeight:ex.values?.weight;let e_=ea?eN:ex.values?.subtotal||0,eM=ea?eS?.sumVat:ex.values?.vatAmount||0;function eW(e,t,a,l){(function(e,t,a,l){let r=(0,R.Yi)({tdAmount:parseFloat(l),tdPlain:1==e,tdPct:2==e,tdType:e,subtotal:e_,currentDiscount:l,hiddenTdPct:t,hiddenTdAmount:parseFloat(a),typeChange:e});ex.setFieldValue("tdAmount",r?.hiddenTdAmount?r?.hiddenTdAmount?.toFixed(2):0),ex.setFieldValue("tdType",r?.tdType),ex.setFieldValue("currentDiscount",r?.currentDiscount||0),ex.setFieldValue("tdPct",r?.hiddenTdPct||0)})(e,t,a,l),ex.values.items.map((e,a)=>{let l=(0,N.VW)({priceType:e?.priceType,weight:parseFloat(e?.weight),basePrice:parseFloat(e?.basePrice),qty:e?.qty,extendedPrice:parseFloat(e?.extendedPrice),baseLaborPrice:parseFloat(e?.baseLaborPrice),vatAmount:parseFloat(e?.vatAmount),tdPct:t,taxDetails:ex.values.isVattable?e.taxDetails:null});ex.setFieldValue(`items[${a}].vatAmount`,parseFloat(l?.vatAmount).toFixed(2))})}async function e$(e){let t=await eA(e),a=await eV(e);await eD(t,a)}async function eE(){let e=await eJ(ex.values?.requestId);if(e?.list?.length==0){X({message:ed.noItemsToImport});return}if(e?.list?.every(e=>ex.values.items?.some(t=>t.requestId===e?.trxId&&t.requestSeqNo===e?.seqNo))){X({message:ed.allItemsImported});return}let t=await Promise.all(e?.list?.filter(e=>!ex.values.items?.some(t=>t.requestId===e?.trxId&&t.requestSeqNo===e?.seqNo)).map(async({unitCost:e,...t})=>{let a=await eB({...t,deliveryDate:t?.deliveryDate?d.a1(t.deliveryDate):null,lastPurchaseDate:t?.lastPurchaseDate?d.a1(t.lastPurchaseDate):null,requestId:t?.trxId,requestSeqNo:t?.seqNo,requestRef:ex.values.requestRef,mdType:1,qty:parseFloat(t?.qty||0).toFixed(2),notes:t?.justification}),l=N.VW({priceType:a?.priceType,weight:parseFloat(a?.weight),basePrice:parseFloat(a?.basePrice),qty:a?.qty,extendedPrice:parseFloat(a?.extendedPrice),baseLaborPrice:parseFloat(a?.baseLaborPrice),vatAmount:parseFloat(a?.vatAmount),tdPct:ex.values.tdPct||0,taxDetails:a?.taxDetails||[]});return{...a,vatAmount:parseFloat(l?.vatAmount||0).toFixed(2)}})),a=[...ex.values.items||null,...t].filter(e=>e?.itemId).map((e,t)=>({...e,id:t+1}));ex.setFieldValue("items",a),el(!0)}async function eB(e){let[t,a]=await Promise.all([eq(e?.itemId),ej(e?.itemId)]),l=ex.values.isVattable?await ek(t?.taxId):null;return{...e,volume:a?.volume||0,weight:a?.weight||0,priceType:a?.priceType||1,vatPct:a?.vatpct||0,basePrice:0,unitPrice:0,extendedPrice:0,mdValue:0,mdAmount:0,msId:t?.msId||null,taxId:t?.taxId||null,baseQty:parseFloat(e?.baseQty||e?.qty).toFixed(2),taxDetails:l}}async function eJ(e){if(e)return await l({extension:_.y.RequisitionDetail.qry,parameters:`_trxId=${e}`})}return r.jsx(c.Z,{resourceId:x.i.PurchaseQuotations,functionId:b.J.PurchaseQuotation,form:ex,maxAccess:eo,previewReport:ev,actions:eg,editMode:ev,disabledSubmit:!eh,children:(0,r.jsxs)(A.R,{children:[r.jsx(V.g,{children:(0,r.jsxs)(i(),{container:!0,spacing:2,children:[(0,r.jsxs)(i(),{container:!0,spacing:2,xs:6,sx:{pt:2},children:[r.jsx(i(),{item:!0,xs:6,children:(0,r.jsxs)(i(),{container:!0,direction:"column",spacing:2,children:[r.jsx(i(),{item:!0,children:r.jsx(I.Z,{endpointId:F.r.DocumentType.qry,parameters:`_startAt=0&_pageSize=1000&_dgId=${b.J.PurchaseQuotation}`,name:"dtId",label:ed.documentType,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],readOnly:ev,valueField:"recordId",displayField:["reference","name"],values:ex.values,maxAccess:eo,onChange:async(e,t)=>{await eu(t),ex.setFieldValue("dtId",t?.recordId||null)},error:ex.touched.dtId&&!!ex.errors.dtId})}),r.jsx(i(),{item:!0,children:r.jsx(v.Z,{name:"reference",label:ed.reference,value:ex?.values?.reference,maxAccess:!ev&&eo,readOnly:ev,onChange:ex.handleChange,onClear:()=>ex.setFieldValue("reference",null),error:ex.touched.reference&&!!ex.errors.reference})})]})}),r.jsx(i(),{item:!0,xs:6,children:(0,r.jsxs)(i(),{container:!0,direction:"column",spacing:2,children:[r.jsx(i(),{item:!0,children:r.jsx(n.Z,{name:"date",required:!0,label:ed.date,value:ex?.values?.date,onChange:ex.setFieldValue,readOnly:!eh,max:new Date,maxAccess:eo,onClear:()=>ex.setFieldValue("date",null),error:ex.touched.date&&!!ex.errors.date})}),r.jsx(i(),{item:!0,children:r.jsx(I.Z,{endpointId:F.r.Currency.qry,name:"currencyId",label:ed.currency,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],required:!0,readOnly:ex?.values?.items?.some(e=>e.itemId),values:ex.values,maxAccess:eo,onChange:(e,t)=>{ex.setFieldValue("items",ex.initialValues.items),ex.setFieldValue("currencyId",t?.recordId||null)},error:ex.touched.currencyId&&!!ex.errors.currencyId})})]})}),r.jsx(i(),{item:!0,xs:12,children:r.jsx(P.U,{endpointId:_.y.Vendor.snapshot,valueField:"reference",displayField:"name",secondFieldLabel:ed.name,name:"vendorId",label:ed.vendor,form:ex,readOnly:ex?.values?.items?.some(e=>e.itemId),displayFieldWidth:2,valueShow:"vendorRef",secondValueShow:"vendorName",maxAccess:eo,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"},{key:"flName",value:"FL Name"}],onChange:(e,t)=>{ew(t)},errorCheck:"vendorId"})}),r.jsx(i(),{item:!0,xs:6,children:r.jsx(P.U,{endpointId:_.y.PurchaseRequisition.snapshot,filter:{status:4},valueField:"reference",displayField:"reference",name:"requestRef",label:ed.request,form:ex,readOnly:!eh,secondDisplayField:!1,maxAccess:eo,onChange:async(e,t)=>{ex.setFieldValue("requestRef",t?.reference),ex.setFieldValue("requestId",t?.recordId)},errorCheck:"requestId"})}),r.jsx(i(),{item:!0,xs:2,children:r.jsx(M.Z,{onClick:()=>eE(),tooltipText:z.import,image:"import.png",disabled:!eh||!ex.values.requestId||!ex.values.currencyId||!ex.values.vendorId})})]}),r.jsx(i(),{item:!0,xs:3,children:(0,r.jsxs)(i(),{container:!0,spacing:2,children:[r.jsx(i(),{item:!0,xs:12,children:r.jsx(I.Z,{endpointId:F.r.Plant.qry,name:"plantId",label:ed.plant,readOnly:!eh,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:ex.values,valueField:"recordId",displayField:["reference","name"],maxAccess:eo,onChange:(e,t)=>{ex.setFieldValue("plantId",t?.recordId||null)},displayFieldWidth:2,error:ex.touched.plantId&&!!ex.errors.plantId})}),r.jsx(i(),{item:!0,xs:12,children:r.jsx(I.Z,{datasetId:W.v.PAYMENT_METHOD,name:"paymentMethod",readOnly:!eh,label:ed.paymentMethod,valueField:"key",displayField:"value",values:ex.values,onChange:(e,t)=>{ex.setFieldValue("paymentMethod",t?.key||null)},error:ex.touched?.paymentMethod&&!!ex.errors?.paymentMethod,maxAccess:eo})}),r.jsx(i(),{item:!0,xs:12,children:r.jsx(I.Z,{endpointId:j.H.TaxSchedules.qry,name:"taxId",label:ed.tax,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],readOnly:!0,values:ex.values,onChange:(e,t)=>{ex.setFieldValue("taxId",t?.recordId||null)},error:ex.touched.taxId&&!!ex.errors.taxId,maxAccess:eo})}),r.jsx(i(),{item:!0,xs:12,children:r.jsx(v.Z,{name:"vendorDocRef",label:ed.vendorDocRef,value:ex?.values?.vendorDocRef,maxAccess:eo,readOnly:!eh,maxLength:"15",onChange:ex.handleChange,onClear:()=>ex.setFieldValue("vendorDocRef",""),error:ex.touched.vendorDocRef&&!!ex.errors.vendorDocRef})})]})}),r.jsx(i(),{item:!0,xs:3,children:(0,r.jsxs)(i(),{container:!0,spacing:2,children:[r.jsx(i(),{item:!0,xs:12,children:r.jsx(n.Z,{name:"deliveryDate",label:ed.deliveryDate,value:ex?.values?.deliveryDate,onChange:ex.setFieldValue,readOnly:!eh,maxAccess:eo,onClear:()=>ex.setFieldValue("deliveryDate",null),error:ex.touched.deliveryDate&&!!ex.errors.deliveryDate})}),r.jsx(i(),{item:!0,xs:12,children:r.jsx(I.Z,{endpointId:_.y.DeliveryMethods.qry,name:"deliveryMethodId",label:ed.deliveryMethod,readOnly:!eh,valueField:"recordId",displayField:"name",values:ex.values,onChange:(e,t)=>{ex.setFieldValue("deliveryMethodId",t?.recordId||null)},error:ex.touched?.deliveryMethodId&&!!ex.errors?.deliveryMethodId,maxAccess:eo})}),r.jsx(i(),{item:!0,xs:12,children:r.jsx(Q.Z,{name:"isVattable",value:ex.values?.isVattable,onChange:e=>ex.setFieldValue("isVattable",e.target.checked),label:ed.VAT,disabled:!0,maxAccess:eo})})]})})]})}),r.jsx(g.Q,{children:r.jsx(D._,{onChange:(e,t)=>{ex.setFieldValue("items",e),"delete"===t&&el(!0)},onSelectionChange:(e,t,a)=>{"muRef"==a&&eI(e?.itemId,e?.msId)},initialValues:ex?.initialValues?.items?.[0],value:ex.values.items,error:ex.errors.items,columns:eF,name:"items",maxAccess:eo,disabled:!ex.values.vendorId||!ex.values.currencyId||!eh,allowDelete:eh})}),r.jsx(V.g,{children:(0,r.jsxs)(i(),{container:!0,spacing:2,sx:{pt:2},children:[r.jsx(i(),{item:!0,xs:6,children:r.jsx(i(),{item:!0,xs:12,children:r.jsx(h.Z,{name:"description",label:ed.description,value:ex.values.description,rows:3,readOnly:!eh,maxAccess:eo,onChange:e=>ex.setFieldValue("description",e.target.value),onClear:()=>ex.setFieldValue("description",null),error:ex.touched.description&&!!ex.errors.description})})}),r.jsx(i(),{item:!0,xs:3,children:(0,r.jsxs)(i(),{container:!0,spacing:2,children:[r.jsx(i(),{item:!0,xs:12,children:r.jsx(w.Z,{name:"totalVolume",maxAccess:eo,label:ed.totVolume,value:eL,readOnly:!0})}),r.jsx(i(),{item:!0,xs:12,children:r.jsx(w.Z,{name:"totalQTY",label:ed.totQty,value:eZ,readOnly:!0})})]})}),r.jsx(i(),{item:!0,xs:3,children:(0,r.jsxs)(i(),{container:!0,spacing:2,children:[r.jsx(i(),{item:!0,xs:12,children:r.jsx(w.Z,{name:"subTotal",maxAccess:eo,label:ed.subtotal,value:e_,readOnly:!0})}),r.jsx(i(),{item:!0,xs:12,children:r.jsx(w.Z,{name:"discount",maxAccess:eo,label:ed.discount,value:ex.values.currentDiscount,displayCycleButton:!0,readOnly:!eh,iconKey:Y.text,cycleButtonLabel:Y.text,decimalScale:2,handleButtonClick:()=>{let e,t,a;el(!0),1==Y.value?(t=ex.values.currentDiscount<0||ex.values.currentDiscount>100?0:ex.values.currentDiscount,e=parseFloat(t)*parseFloat(e_)/100,a=t,ex.setFieldValue("tdAmount",e),ex.setFieldValue("tdPct",t),ex.setFieldValue("currentDiscount",t)):(e=ex.values.currentDiscount<0||e_<ex.values.currentDiscount?0:ex.values.currentDiscount,t=parseFloat(e)/parseFloat(e_)*100,a=e,ex.setFieldValue("tdPct",t),ex.setFieldValue("tdAmount",e),ex.setFieldValue("currentDiscount",e)),K(l=>{let r="%"===l.text?{text:"123",value:1}:{text:"%",value:2};return ex.setFieldValue("tdType",r.value),eW(r.value,t,e,a),r})},ShowDiscountIcons:!0,onChange:e=>{let t=Number(e.target.value.replace(/,/g,""));1==ex.values.tdType?((t<0||e_<t)&&(t=0),ex.setFieldValue("tdAmount",t)):((t<0||t>100)&&(t=0),ex.setFieldValue("tdPct",t)),ex.setFieldValue("currentDiscount",t)},onBlur:async e=>{el(!0);let t=Number(e.target.value.replace(/,/g,"")),a=Number(e.target.value.replace(/,/g,"")),l=Number(e.target.value.replace(/,/g,""));1==ex.values.tdType&&(a=parseFloat(t)/parseFloat(e_)*100,ex.setFieldValue("tdPct",a)),2==ex.values.tdType&&(l=parseFloat(t)*parseFloat(e_)/100,ex.setFieldValue("tdAmount",l)),eW(ex.values.tdType,a,l,t)},onClear:()=>{ex.setFieldValue("tdAmount",0),ex.setFieldValue("tdPct",0),eW(ex.values.tdType,0,0,0)}})}),r.jsx(i(),{item:!0,xs:12,children:r.jsx(w.Z,{name:"miscAmount",maxAccess:eo,label:ed.misc,value:ex.values.miscAmount||0,decimalScale:2,readOnly:!eh,onChange:e=>ex.setFieldValue("miscAmount",e.target.value),onBlur:async()=>{el(!0)},onClear:()=>{ex.setFieldValue("miscAmount",0)}})}),r.jsx(i(),{item:!0,xs:12,children:r.jsx(w.Z,{name:"vatAmount",maxAccess:eo,label:ed.VAT,value:eM,readOnly:!0})}),r.jsx(i(),{item:!0,xs:12,children:r.jsx(w.Z,{name:"amount",maxAccess:eo,label:ed.net,value:eQ,readOnly:!0})})]})})]})})]})})}[c,m,p,y,I,P,D,k,C,T,S,Z,$,B]=J.then?(await J)():J,X.width=1300,X.height=730,l()}catch(e){l(e)}})},93105:(e,t,a)=>{"use strict";a.d(t,{m:()=>r});var l=a(75609);function r(e,t,a,r="items"){let n={...e};return a?.record?.controls.forEach(({controlId:e,accessLevel:t})=>{let[a,l]=e?.split(".");a!==r||2!==t||l in n||(n[l]=e=>e?.[l]!=null),(1===t||4===t)&&l in n&&delete n[l]}),{schema:l.object().shape({...Object.keys(n).reduce((e,a)=>(e[a]=l.mixed().nullable().test(function(e){let l=this.parent,[,r]=this.path.match(/^(\w+)\[(\d+)\]/)||[],d=this.options.context?.[r]||[];if(t||!t&&d.length>1){if(null!==l[a]&&void 0!==l[a]&&0!==l[a]&&""!==n[a]&&!n[a](l))return!1;if(!Object.entries(n).some(([,e])=>!!e(l)))return!0}return!!n[a](l)&&void 0!==e}),e),{})}),requiredFields:n}}},70638:(e,t,a)=>{"use strict";a.a(e,async(e,l)=>{try{a.d(t,{Z:()=>v});var r=a(20997),n=a(16689),d=a(97996),s=a(29352),i=a(73846),o=a(96119),u=a(60520),c=a(20562),m=a(3),p=a.n(m),y=e([s,i,u]);[s,i,u]=y.then?(await y)():y;let x=({functionId:e,recordId:t,window:a})=>{let{getRequest:l}=(0,n.useContext)(s.$),{languageId:m}=(0,n.useContext)(i.V),{platformLabels:y}=(0,n.useContext)(u.l),x=t+"-"+e;(0,o.Z)({title:y.WorkFlow,window:a});let{width:v}=(0,c.d)(),h=v<=1024,I=v>1024&&v<=1280,F=h?10:I?12:14,f=h?75:I?85:95,b=h?15:I?20:25,P=async()=>{var a=`_functionId=${e}&_recordId=${t}`;let r=await l({extension:d.P.WorkFlow.graph,parameters:a});return r?.record},g=e=>{let t=[],a=[],l="",r="";return e.objects.forEach(e=>{t.push({functionName:e.functionName,reference:e.reference,date:e.date})}),e.workflow.forEach(t=>{e.objects.forEach(e=>{let a=e.functionName.split(" ").join("\r\n");t.parentId===e.recordId&&t.parentFunctionId===e.functionId&&(l=e.reference+"\r\n"+e.date+"\r\n"+a,t.parentId),t.childId===e.recordId&&t.childFunctionId===e.functionId&&(r=e.reference+"\r\n"+e.date+"\r\n"+a,t.childId)}),""===l||""===r||a.push({from:l,to:r,value:1,labelText:""}),l="",r=""}),a};return(0,n.useEffect)(()=>{!async function(){var e=await P();if(e){let t=(e,t)=>{let a=document.createElement("script");a.type="text/javascript",a.src=e,a.async=!0,a.onload=t,document.head.appendChild(a)};t("https://cdn.amcharts.com/lib/4/core.js",()=>{t("https://cdn.amcharts.com/lib/4/charts.js",()=>{t("https://cdn.amcharts.com/lib/4/themes/animated.js",()=>{am4core.ready(()=>{let t=am4core.create(x,am4charts.SankeyDiagram),a=g(e);t.data=a,t.dataFields.fromName="from",t.dataFields.toName="to",t.dataFields.value="value",t.paddingRight=2===m?0:40,t.paddingLeft=2===m?40:0,t.tooltip.label.fontSize=F;let l=t.nodes.template;l.draggable=!1,l.inert=!0,l.clickable=!1,l.width=f,l.height=b,l.nameLabel.label.fontSize=F,l.nameLabel.locationX=2===m?.85:0,l.nameLabel.height=void 0,l.nameLabel.label.fontWeight="bold";let r=t.links.template;r.middleLine.strokeOpacity=.3,r.middleLine.stroke=am4core.color("#555"),r.middleLine.strokeWidth=5,r.middleLine.hoverable=!1,r.fillOpacity=0,r.hoverable=!0,r.hoverOnFocus=!0,r.fill=am4core.color("#A8C686"),r.isHover=!0,t.appear(1e3,100)})})})})}}()},[]),r.jsx("div",{id:x,className:p().root})};x.width=950;let v=x;l()}catch(e){l(e)}})}};