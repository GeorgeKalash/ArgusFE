"use strict";exports.id=45942,exports.ids=[45942],exports.modules={45942:(e,a,n)=>{n.a(e,async(e,t)=>{try{n.d(a,{Z:()=>M});var r=n(20997),l=n(99155),s=n.n(l),o=n(16689),d=n(75609),c=n(80582),u=n(86201),i=n(29352),m=n(38509),p=n(6416),y=n(44619),x=n(95965),h=n(60520),v=n(18611),I=n(27736),f=n(71278),b=n(79660),C=n(68728),F=n(97969),A=n(66198),g=n(91184),O=n(61932),k=n(65980),j=n(86794),T=n(79390),w=n(70638),V=n(677),P=n(43991),q=n(42020),N=n(15051),Z=n(93484),R=n(99912),S=n(38782),D=n(96119),_=e([c,u,i,m,h,f,j,w,V,N,Z,R,S]);function M({recordId:e,window:a}){let{getRequest:t,postRequest:l}=(0,o.useContext)(i.$),{platformLabels:_,defaultsData:M,userDefaultsData:H}=(0,o.useContext)(h.l),{stack:E}=(0,V.zY)(),{labels:J,access:$}=(0,S.Z)({datasetId:p.i.PaymentOrderExpenses,editMode:!!e}),{documentType:L,maxAccess:W,changeDT:Y}=(0,j.H)({functionId:C.J.PaymentOrder,access:$,enabled:!e});(0,D.Z)({title:J.PaymentOrderExpenses,window:a});let z=(0,m.E)({endpointId:A.H.PaymentOrders.page3}),B=parseInt(H?.list?.find(e=>"plantId"===e.key)?.value),G=parseInt(M?.list?.find(e=>"currencyId"===e.key)?.value),U=parseInt(H?.list?.find(e=>"cashAccountId"===e.key)?.value),{formik:K}=(0,x.c)({documentType:{key:"dtId",value:L?.dtId,reference:L?.reference},initialValues:{recordId:null,reference:"",accountType:3,currencyId:parseInt(G),paymentMethod:null,date:new Date,amount:null,notes:"",subTotal:null,exRate:1,rateCalcMethod:1,baseAmount:null,dtId:null,status:1,releaseStatus:null,cashAccountId:parseInt(U),plantId:parseInt(B),expenses:[{id:1,pvId:e||0,seqNo:1,etId:"",subTotal:null,vatAmount:null,amount:null,supplierName:"",taxRef:"",notes:"",isVAT:!1,hasCostCenters:!1,costCenters:[]}]},maxAccess:W,validateOnChange:!0,validationSchema:d.object({accountType:d.number().required(),currencyId:d.number().required(),date:d.date().required(),paymentMethod:d.number().required(),expenses:d.array().of(d.object().shape({etId:d.number().required(),amount:d.number().required()})).required()}),onSubmit:async e=>{let a=[],n=K.values.expenses.map((e,n)=>{let{costCenters:t,...r}=e;return t&&a.push(...t),{...r,seqNo:n+1,pvId:K.values.recordId||0}}),t={header:{...e,date:(0,T.ku)(e.date),amount:Q,baseAmount:Q},items:n,costCenters:a},r=await l({extension:A.H.PaymentOrders.set2,record:JSON.stringify(t)});e.recordId?u.default.success(_.Edited):u.default.success(_.Added),en(r.recordId),z()}}),Q=K.values?.expenses?.reduce((e,a)=>{let n=parseFloat(a.amount?.toString().replace(/,/g,""))||0;return e+n},0),X=-1===K.values.status,ee=2==K.values.wip,ea=!!K.values.recordId;async function en(e){let a=await t({extension:A.H.PaymentOrders.get,parameters:`_recordId=${e}`}),n=await t({extension:A.H.PaymentOrdersExpenses.qry2,parameters:`_poId=${e}`}),r=await Promise.all(n?.list?.map(async a=>{let n=await ed(e,a.seqNo);return{...a,id:a.seqNo,isVAT:0!=a.vatAmount,hasCostCenters:!1,costCenters:n}}));return K.setValues({...a.record,date:(0,T.a1)(a.record.date),expenses:r}),a.record}let et=async()=>{E({Component:w.Z,props:{functionId:C.J.PaymentOrder,recordId:K.values.recordId},width:950,title:J.WorkFlow})},er=async()=>{let e=await l({extension:A.H.PaymentOrders.cancel,record:JSON.stringify(K.values)});u.default.success(_.Cancelled),z(),en(e.recordId)},el=async()=>{let e=await l({extension:A.H.PaymentOrders.close,record:JSON.stringify(K.values)});u.default.success(_.Closed),z(),en(e.recordId)},es=K.values?.expenses?.reduce((e,a)=>{let n=parseFloat(a.subTotal?.toString().replace(/,/g,""))||0;return e+n},0),eo=async()=>{let e=await l({extension:A.H.PaymentOrders.reopen,record:JSON.stringify(K.values)});u.default.success(_.Reopened),z(),en(e.recordId)},ed=async(e,a)=>{let n=await t({extension:A.H.PaymentOrdersCostCenters.qry,parameters:`_poId=${e}&_seqNo=${a}`});return n?.list?.map(e=>({...e,id:e.ccSeqNo}))},ec=[{key:"Cancel",condition:!0,onClick:function(){E({Component:R.Z,props:{DialogText:_.CancelConf,okButtonAction:er,fullScreen:!1,close:!0},width:400,height:150,title:_.Confirmation})},disabled:!ea||X||ee},{key:"RecordRemarks",condition:!0,onClick:"onRecordRemarks",disabled:!ea},{key:"WorkFlow",condition:!0,onClick:et,disabled:!ea},{key:"Attachment",condition:!0,onClick:"onClickAttachment",disabled:!ea},{key:"Close",condition:!ee,onClick:el,disabled:ee||!ea||X},{key:"Reopen",condition:ee,onClick:eo,disabled:!ee||X},{key:"Approval",condition:!0,onClick:"onApproval",disabled:!ee}],eu=K?.values?.expenses?.reduce((e,a)=>{let n=parseFloat(a.vatAmount?.toString().replace(/,/g,""))||0;return e+n},0);async function ei(){let e=await t({extension:b.r.Defaults.get,parameters:"_filter=&_key=vatPct"});return K.setFieldValue("vatPct",parseInt(e.record.value)??0),parseInt(e.record.value)??0}let em=[{component:"resourcelookup",label:J.expenseType,name:"reference",props:{valueField:"reference",displayField:"reference",displayFieldWidth:4,endpointId:A.H.ExpenseTypes.snapshot,mapping:[{from:"recordId",to:"etId"},{from:"name",to:"etName"},{from:"reference",to:"etRef"}],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],readOnly:X||ee}},{component:"textfield",label:J.expenseName,name:"etName",props:{readOnly:!0}},{component:"checkbox",label:J.isVAT,name:"isVAT",props:{disabled:X||ee},async onChange({row:{update:e,newRow:a}}){if(a.isVAT){let n=await ei();if(!a.amount)return;let t=(a?.amount||0)*(100/(100+(n||0)))||0;e({subTotal:parseFloat(t||0).toFixed(2),vatAmount:(parseFloat(a?.amount||0)-parseFloat(t||0)).toFixed(2)})}else e({subTotal:parseFloat(a.amount||0),vatAmount:0})}},{component:"numberfield",label:J.amount,name:"amount",props:{readOnly:X},async onChange({row:{update:e,newRow:a}}){if(a.isVAT){let n=parseFloat(a.amount||0)*(100/(100+K.values.vatPct||0));e({subTotal:parseFloat(n||0).toFixed(2),vatAmount:(parseFloat(a.amount||0)-parseFloat(n||0)).toFixed(2)})}else e({subTotal:parseFloat(a.amount||0),vatAmount:0})}},{component:"numberfield",label:J.vat,name:"vatAmount",props:{readOnly:!0}},{component:"numberfield",label:J.subtotal,name:"subTotal",props:{readOnly:!0}},{component:"textfield",label:J.vendorName,name:"supplierName",props:{readOnly:X}},{component:"numberfield",label:J.vatNo,name:"taxRef",props:{readOnly:X}},{component:"textfield",label:J.notes,name:"notes",props:{readOnly:X}},{component:"button",name:"hasCostCenters",props:{imgSrc:n(54471).default.src},label:J.costCenter,onClick:(a,n,t,r)=>{E({Component:Z.Z,props:{maxAccess:W,labels:J,recordId:e,row:n,updateRow:r,readOnly:X||ee},width:700,height:600,title:J.costCenter})}}];return r.jsx(c.Z,{resourceId:p.i.PaymentOrderExpenses,form:K,maxAccess:W,editMode:ea,previewReport:ea,actions:ec,functionId:C.J.PaymentOrder,disabledSubmit:X||ee,children:(0,r.jsxs)(v.R,{children:[r.jsx(q.g,{children:(0,r.jsxs)(s(),{container:!0,spacing:2,children:[r.jsx(s(),{item:!0,xs:6,children:(0,r.jsxs)(s(),{container:!0,spacing:2,children:[r.jsx(s(),{item:!0,xs:6,children:r.jsx(f.Z,{endpointId:b.r.DocumentType.qry,parameters:`_dgId=${C.J.PaymentOrder}&_startAt=0&_pageSize=50`,filter:ea?void 0:e=>1===e.activeStatus,name:"dtId",label:J.documentType,readOnly:ea,valueField:"recordId",displayField:"name",values:K.values,onChange:async(e,a)=>{await Y(a),K.setFieldValue("dtId",a?.recordId||null)},error:K.touched.dtId&&!!K.errors.dtId,maxAccess:W})}),r.jsx(s(),{item:!0,xs:6,children:r.jsx(f.Z,{endpointId:b.r.Currency.qry,name:"currencyId",label:J.currency,filter:e=>1===e.currencyType,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],required:!0,readOnly:ee||X,values:K.values,onChange:(e,a)=>{K.setFieldValue("currencyId",a?.recordId||null)},error:K.touched.currencyId&&!!K.errors.currencyId})}),r.jsx(s(),{item:!0,xs:6,children:r.jsx(f.Z,{datasetId:F.v.FI_PV_GROUP_TYPE,name:"accountType",filter:e=>3==e.key,label:J.accountType,valueField:"key",displayField:"value",values:K.values,required:!0,readOnly:!0,maxAccess:W,onChange:(e,a)=>{K.setFieldValue("accountType",a?.key||null)},error:K.touched.accountType&&!!K.errors.accountType})}),r.jsx(s(),{item:!0,xs:6,children:r.jsx(I.Z,{name:"date",label:J.date,value:K.values.date,required:!0,onChange:(e,a)=>{K.setFieldValue("date",a)},onClear:()=>K.setFieldValue("date",null),readOnly:ee||X,error:K.touched.date&&!!K.errors.date,maxAccess:W})}),r.jsx(s(),{item:!0,xs:6,children:r.jsx(f.Z,{datasetId:F.v.PAYMENT_METHOD,name:"paymentMethod",label:J.paymentMethod,valueField:"key",displayField:"value",values:K.values,required:!0,readOnly:ee||X,maxAccess:W,onChange:(e,a)=>{a?.key||K.setFieldValue("cashAccountId",""),K.setFieldValue("paymentMethod",a?.key||null)},error:K.touched.paymentMethod&&!!K.errors.paymentMethod})}),r.jsx(s(),{item:!0,xs:6,children:r.jsx(f.Z,{endpointId:b.r.Plant.qry,name:"plantId",label:J.plant,valueField:"recordId",readOnly:ee||X,displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:K.values,onChange:(e,a)=>{K.setFieldValue("plantId",a?.recordId||null)},error:K.touched.plantId&&!!K.errors.plantId})}),r.jsx(s(),{item:!0,xs:12,children:r.jsx(f.Z,{endpointId:O.G.CashAccount.qry,parameters:"_type=0",name:"cashAccountId",readOnly:ee||X,label:J.cashAccount,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:K.values,maxAccess:W,onChange:(e,a)=>{K.setFieldValue("cashAccountId",a?.recordId||null)},error:K.touched.cashAccountId&&!!K.errors.cashAccountId})})]})}),r.jsx(s(),{item:!0,xs:6,children:(0,r.jsxs)(s(),{container:!0,spacing:2,children:[r.jsx(s(),{item:!0,xs:6,children:r.jsx(y.Z,{name:"reference",label:J.reference,value:K.values.reference,readOnly:ea,maxAccess:!ea&&W,maxLength:"15",onChange:K.handleChange,onClear:()=>K.setFieldValue("reference",""),error:K.touched.reference&&!!K.errors.reference})}),r.jsx(s(),{item:!0,xs:6,children:r.jsx(g.Z,{name:"vatAmount",label:J.vat,value:eu,readOnly:!0,maxAccess:W,onChange:K.handleChange,onClear:()=>K.setFieldValue("vatAmount",""),error:K.touched.vatAmount&&!!K.errors.vatAmount})}),r.jsx(s(),{item:!0,xs:6,children:r.jsx(g.Z,{name:"subTotal",label:J.subtotal,value:es,readOnly:!0,maxAccess:W,onChange:K.handleChange,onClear:()=>K.setFieldValue("subTotal",""),error:K.touched.subTotal&&!!K.errors.subTotal})}),r.jsx(s(),{item:!0,xs:6,children:r.jsx(g.Z,{name:"amount",label:J.amount,maxLength:"10",decimalScale:2,readOnly:!0,value:Q,maxAccess:W,onChange:async e=>{let a=(0,P.fB)({amount:e.target.value??0,exRate:K.values?.exRate,baseAmount:0,rateCalcMethod:K.values?.rateCalcMethod,dirtyField:P.ss});K.setFieldValue("baseAmount",parseFloat(a?.baseAmount).toFixed(2)||0),K.setFieldValue("amount",e.target.value)},onClear:()=>{K.setFieldValue("amount","")},error:K.touched.amount&&!!K.errors.amount})}),r.jsx(s(),{item:!0,xs:12,children:r.jsx(f.Z,{neverPopulate:!0,endpointId:A.H.DescriptionTemplate.qry,name:"templateId",label:J.descriptionTemplate,valueField:"recordId",displayField:"name",values:K.values,onChange:(e,a)=>{let n=K.values.notes||"";a?.name&&K.setFieldValue("notes",""===n?a.name:`${n}
${a.name}`),K.setFieldValue("templateId",a?.recordId||null)},readOnly:ee||X,error:K.touched.templateId&&!!K.errors.templateId,maxAccess:W})}),r.jsx(s(),{item:!0,xs:12,children:r.jsx(k.Z,{name:"notes",type:"text",label:J.notes,value:K.values.notes,rows:3,readOnly:ee||X,maxAccess:W,onChange:K.handleChange,onClear:()=>K.setFieldValue("notes","")})})]})})]})}),r.jsx(N._,{onChange:e=>K.setFieldValue("expenses",e),value:K.values.expenses,error:K.errors.expenses,initialValues:K?.initialValues?.expenses[0],columns:em,allowDelete:!ee&&!X,allowAddNewLine:!ee&&!X})]})})}[c,u,i,m,h,f,j,w,V,N,Z,R,S]=_.then?(await _)():_,M.width=1300,M.height=700,t()}catch(e){t(e)}})}};