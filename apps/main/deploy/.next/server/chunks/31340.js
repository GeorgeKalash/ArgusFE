"use strict";exports.id=31340,exports.ids=[31340],exports.modules={8041:(e,a,t)=>{t.d(a,{Z:()=>r});let r={src:"/_next/static/media/imgSerials.d1ee59bb.png",height:17,width:23,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAGCAMAAADJ2y/JAAAAIVBMVEUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABt0UjBAAAAC3RSTlMCZzsmQ6RbWbaSTwNdgTwAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAArSURBVHicY2BiZ2BgYOBiZmBmYmRjZGRhYGBg4eBkZWVDYjAzMbKDpWCKARB/AJwjPQgCAAAAAElFTkSuQmCC",blurWidth:8,blurHeight:6}},72172:(e,a,t)=>{t.d(a,{K:()=>l});let r="RG.FI.asmx/",l={FiOpeningBalance:{gen:r+"genOBA"},FiAging:{qry:r+"FI404"},AccountSummary:{AccFI405b:r+"FI405b"},DocumentAging:{AgingFI406a:r+"FI406a",AgingFI406b:r+"FI406b"},TrialBalance:{FI402View:r+"FI402o",FI401o2:r+"FI401o2"}}},93105:(e,a,t)=>{t.d(a,{m:()=>l});var r=t(75609);function l(e,a,t,l="items"){let d={...e};return t?.record?.controls.forEach(({controlId:e,accessLevel:a})=>{let[t,r]=e?.split(".");t!==l||2!==a||r in d||(d[r]=e=>e?.[r]!=null),(1===a||4===a)&&r in d&&delete d[r]}),{schema:r.object().shape({...Object.keys(d).reduce((e,t)=>(e[t]=r.mixed().nullable().test(function(e){let r=this.parent,[,l]=this.path.match(/^(\w+)\[(\d+)\]/)||[],n=this.options.context?.[l]||[];if(a||!a&&n.length>1){if(null!==r[t]&&void 0!==r[t]&&0!==r[t]&&""!==d[t]&&!d[t](r))return!1;if(!Object.entries(d).some(([,e])=>!!e(r)))return!0}return!!d[t](r)&&void 0!==e}),e),{})}),requiredFields:d}}},81313:(e,a,t)=>{t.a(e,async(e,r)=>{try{t.d(a,{Z:()=>w});var l=t(20997),d=t(16689),n=t(87316),s=t.n(n),i=t(29352),o=t(61274),c=t(6416),u=t(38509),m=t(42020),h=t(23385),p=t(18611),x=t(71278),I=t(66198),v=t(70755),y=t(97969),b=t(60520),g=t(95965),A=t(79660),f=t(40711),F=t(72172),C=t(96119),P=e([i,o,u,x,b,f]);function w({accountId:e,moduleId:a,window:t}){let{getRequest:r}=(0,d.useContext)(i.$),{platformLabels:n}=(0,d.useContext)(b.l),[P,w]=(0,d.useState)([]);(0,C.Z)({title:n.AccountSummary,window:t});let{labels:V,access:j}=(0,u.J)({datasetId:c.i.AccountSummary}),N=[{field:"days",headerName:V.days,flex:1,type:"number"}],[k,S]=(0,d.useState)(N),{formik:T}=(0,g.c)({maxAccess:j,initialValues:{accountId:null,accountRef:"",accountName:"",agpId:null,moduleId:a}});async function O(){let e;let t=2,l=[...N],d=await r({extension:A.r.Currency.qry,parameters:"_filter="});if(1==a?e=d?.list?.filter(e=>e.sale):2==a&&(e=d?.list?.filter(e=>e.purchase)),0==e.length)return;e?.forEach((e,a)=>{l.push({field:`column${a+1}`,headerName:e.reference,flex:1,type:"number"})}),S(l);let n=await r({extension:I.H.AgingLeg.qry,parameters:`_agpId=${T.values.agpId}`}),s=n?.list?.map(a=>{let t=Array(e.length+2).fill(0);return t[0]=null,t[1]=a.days,t}),i=(e||[]).map(e=>r({extension:F.K.AccountSummary.AccFI405b,parameters:`_agpId=${T.values.agpId}&_currencyId=${e.recordId}&_accountId=${T.values.accountId}`}).then(e=>({summaryRes:e})));(await Promise.all(i)).forEach(({summaryRes:e})=>{e?.list?.forEach(e=>{s?.forEach(a=>{a[1]==e.seqDays&&(a[t]=e.amount)})}),t++});let o=Array(e.length+2).fill(null);for(let a=2;a<e.length+2;a++){let e=0;s?.map(t=>{e+=Number(t[a]||0)}),o[a]=e}let c=s.filter(e=>null!==e[1]).map(e=>{let[a,t,...r]=e,l={days:t};return r.forEach((e,a)=>{l[`column${a+1}`]=e.toFixed(2)}),l}),u={};for(let a=0;a<e.length;a++)u[`column${a+1}`]=o[a+2].toFixed(2)??0;c.push(u),w({list:c})}return(0,l.jsxs)(p.R,{children:[l.jsx(m.g,{children:(0,l.jsxs)(s(),{container:!0,spacing:2,p:2,children:[l.jsx(s(),{item:!0,xs:12,children:l.jsx(o.U,{endpointId:I.H.Account.snapshot,name:"accountId",label:V.account,valueField:"reference",displayField:"name",valueShow:"accountRef",secondValueShow:"accountName",form:T,readOnly:T.values.accountId&&T.values.moduleId,required:!0,maxAccess:j,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],onChange:async(e,a)=>{T.setFieldValue("accountId",a?.recordId||null),T.setFieldValue("accountName",a?.name||""),T.setFieldValue("accountRef",a?.reference||"")}})}),l.jsx(s(),{item:!0,xs:6,children:l.jsx(x.Z,{endpointId:I.H.AgingProfile.qry,parameters:"_startAt=0&_pageSize=1000&filter=",name:"agpId",label:V.agingProfile,values:T.values,valueField:"recordId",displayField:"name",maxAccess:j,required:!0,onChange:(e,a)=>{T.setFieldValue("agpId",a?.recordId||null),a?.recordId||w({list:[]})}})}),l.jsx(s(),{item:!0,xs:5,children:l.jsx(x.Z,{datasetId:y.v.FI_AGING_MODULE,label:V.module,name:"moduleId",values:T.values,valueField:"key",displayField:"value",maxAccess:j,required:!0,readOnly:T.values.moduleId,onChange:(e,a)=>{T.setFieldValue("moduleId",a?.key||null)}})}),l.jsx(s(),{item:!0,xs:1,children:l.jsx(v.Z,{onClick:O,image:"preview.png",disabled:!T.values.agpId||!T.values.moduleId||!T.values.accountId,tooltipText:n.Preview})})]})}),l.jsx(h.Q,{children:l.jsx(f.Z,{columns:k,gridData:P,isLoading:!1,pagination:!1})})]})}[i,o,u,x,b,f]=P.then?(await P)():P,w.width=1e3,w.height=500,r()}catch(e){r(e)}})},44719:(e,a,t)=>{t.a(e,async(e,r)=>{try{t.d(a,{Z:()=>h});var l=t(20997),d=t(79660),n=t(30081),s=t(16689),i=t(29352),o=t(60520),c=t(96119),u=e([n,i,o]);[n,i,o]=u.then?(await u)():u;let m=({recordId:e,editMode:a,onSubmit:t=()=>{},window:r,actions:u=[],address:m,setAddress:h,required:p=!0,...x})=>{let{getRequest:I,postRequest:v}=(0,s.useContext)(i.$),{platformLabels:y}=(0,s.useContext)(o.l),[b,g]=(0,s.useState)(e||null),[A,f]=(0,s.useState)(null),F=!!m&&!!h,C=F?m:A,P=F?h:f;(0,c.Z)({title:y.Address,window:r});let w=async e=>{if(!p){P(e),t(e,r);return}let a={...e,recordId:b||C?.recordId||null},l=await v({extension:d.r.Address.set,record:JSON.stringify(a)}),n=l?.recordId||b||null,s={...a,recordId:n,addressId:n};g(n),P(s),t(s,r)};return(0,s.useEffect)(()=>{!F&&b&&(async()=>{let e=await I({extension:d.r.Address.get,parameters:`_filter=&_recordId=${b}`});f(e?.record||null)})()},[b,F]),l.jsx(n.O,{editMode:a,setAddress:P,address:C,onSubmit:w,actions:u,window:r,...x})};m.width=600,m.height=500;let h=m;r()}catch(e){r(e)}})},30081:(e,a,t)=>{t.a(e,async(e,r)=>{try{t.d(a,{O:()=>h});var l=t(20997),d=t(16689),n=t(80582),s=t(89354),i=t(95965),o=t(18611),c=t(42020),u=t(75609),m=e([n,s]);[n,s]=m.then?(await m)():m;let h=({setAddress:e,address:a,editMode:t,window:r,readOnly:m,allowPost:h=!0,optional:p=!1,onSubmit:x,isSavedClear:I=!0,isCleared:v=!0,changeClear:y=!1,actions:b=[],...g})=>{let[A,f]=(0,d.useState)(!p),[F,C]=(0,d.useState)({}),{formik:P}=(0,i.c)({maxAccess:F.maxAccess,initialValues:{recordId:null,name:"",countryId:null,countryName:"",stateId:null,stateName:"",cityId:null,city:"",street1:"",street2:"",email1:"",email2:"",phone:"",phone2:"",phone3:"",addressId:null,postalCode:"",cityDistrictId:null,cityDistrict:"",bldgNo:"",unitNo:"",subNo:"",poBox:""},validateOnChange:!0,validateOnBlur:!0,validationSchema:u.object({...F.validate}),onSubmit:a=>{e(a),h?x(a,r):r.close()}});return(0,d.useEffect)(()=>{p&&(P.values.name||P.values.street1||P.values.countryId||P.values.cityId)&&f(!0),!p||P.values.name||P.values.street1||P.values.countryId||P.values.cityId||f(!1)},[P.values]),l.jsx(n.Z,{form:P,maxAccess:F.maxAccess,isInfo:!1,disabledSubmit:m,editMode:t,isSavedClear:I,isCleared:v,onClear:y?()=>{P.resetForm({values:P.initialValues})}:void 0,actions:b,...g,children:l.jsx(o.R,{children:l.jsx(c.g,{children:l.jsx(s.Z,{addressValidation:P,readOnly:m,required:A,setFormik:C,address:a,...g})})})})};r()}catch(e){r(e)}})},31340:(e,a,t)=>{t.a(e,async(e,r)=>{try{t.d(a,{Z:()=>ea});var l=t(20997),d=t(27736),n=t(79390),s=t(99155),i=t.n(s),o=t(16689),c=t(75609),u=t(80582),m=t(86201),h=t(29352),p=t(38509),x=t(44619),I=t(65980),v=t(71278),y=t(54242),b=t(61274),g=t(23385),A=t(15051),f=t(18611),F=t(42020),C=t(91184),P=t(97996),w=t(66198),V=t(95965),j=t(70638),N=t(75217),k=t(677),S=t(60520),T=t(82173),O=t(57629),D=t(42614),R=t(70208),Z=t(4902),$=t(19138),q=t(70305),_=t(86794),M=t(9972),W=t(67906),L=t(6416),B=t(78630),G=t(43991),E=t(24356),Q=t(49466),U=t(81313),J=t(44719),z=t(93105),K=t(68728),X=t(12048),Y=t(70755),H=t(9737),ee=e([u,m,h,p,v,b,A,j,N,k,S,R,q,_,B,E,Q,U,J,H]);function ea({labels:e,access:a,recordId:r,functionId:s,window:ee,lockRecord:ea,getResourceId:et,getGLResource:er}){let{getRequest:el,postRequest:ed}=(0,o.useContext)(h.$),{addLockedScreen:en}=(0,o.useContext)(X.Z),{stack:es}=(0,q.V)(),{stack:ei}=(0,k.zY)(),{platformLabels:eo,defaultsData:ec,userDefaultsData:eu}=(0,o.useContext)(S.l),[em,eh]=(0,o.useState)({text:"%",value:D.a$}),[ep,ex]=(0,o.useState)([]),[eI,ev]=(0,o.useState)({}),[ey,eb]=(0,o.useState)(!1),[eg,eA]=(0,o.useState)(null),[ef,eF]=(0,o.useState)(null),[eC,eP]=(0,o.useState)(!1),ew=(0,o.useRef)([]),eV=(0,o.useRef)({}),{documentType:ej,maxAccess:eN}=(0,_.H)({functionId:s,access:a,enabled:!r,objectName:"header"}),ek=(0,p.E)({endpointId:P.P.SalesTransaction.qry}),eS=ec?.list?.find(({key:e})=>"allowSalesNoLinesTrx"===e)?.value=="true",{schema:eT,requiredFields:eO}=(0,z.m)({sku:e=>e?.sku,itemName:e=>e?.itemName,qty:e=>e?.qty>0},eS);async function eD(e){if(!e)return null;let a=await el({extension:P.P.SalesPerson.get,parameters:`_recordId=${e}`}),t=a?.record;return!t||t.isInactive?null:e}let{formik:eR}=(0,V.c)({maxAccess:eN,documentType:{key:"header.dtId",value:ej?.dtId},initialValues:{recordId:r||null,search:"",header:{dgId:s,recordId:null,dtId:null,reference:"",date:new Date,dueDate:new Date,plantId:null,clientId:null,clientName:"",clientRef:"",currencyId:null,currencyName:"",szId:null,spId:null,siteId:null,description:"",status:1,isVattable:!1,taxId:null,subtotal:0,miscAmount:0,amount:0,vatAmount:0,tdAmount:0,plId:null,ptId:null,billAddressId:null,billAddress:"",maxDiscount:"",currentDiscount:0,exRate:1,rateCalcMethod:1,tdType:D.a$,tdPct:0,baseAmount:0,volume:0,weight:0,qty:0,isVerified:!1,contactId:null,commitItems:!1,postMetalToFinancials:!1,metalPrice:0,KGmetalPrice:0,balance:0,accountId:0},items:[{id:1,orderId:r||0,barcode:"",itemId:"",sku:"",itemName:"",seqNo:1,siteId:null,muId:null,qty:0,defaultQty:null,volume:0,weight:0,isMetal:!1,metalId:null,metalPurity:0,msId:0,muRef:"",muQty:0,minPrice:0,baseQty:0,mdType:T.Xo,basePrice:0,baseLaborPrice:0,totalWeightPerG:0,mdValue:0,unitPrice:0,unitCost:0,overheadId:"",vatAmount:0,mdAmount:0,upo:0,extendedPrice:0,priceType:0,applyVat:!1,taxId:null,taxDetails:null,notes:"",totalWeight:0}],serials:[],lots:[],taxes:[]},validateOnChange:!0,validationSchema:c.object({header:c.object({date:c.string().required(),currencyId:c.string().required(),clientId:c.string().required(),siteId:c.string().nullable().test(function(e){let{dtId:a,commitItems:t}=this.parent;return!!a&&(!a||!t)||!!e})}),items:c.array().of(eT)}),onSubmit:async e=>{if(e.header.serializedAddress){let a={clientId:e.header.clientId,address:eI},t=await ed({extension:P.P.Address.set,record:JSON.stringify(a)});e.header.billAddressId=t.recordId}let a=[],t=e.items.filter(e=>Object.values(eO)?.every(a=>a(e))).map(({id:e,isVattable:t,taxDetails:r,...l})=>{let{serials:d,...n}=l;if(d){let t=d.map((a,t)=>({...a,srlSeqNo:0,id:t,componentSeqNo:0,trxId:eR.values.recordId||0,itemId:l?.itemId,seqNo:e}));a=[...a,...t]}return{...n,seqNo:e,applyVat:t}}),r={header:{...e.header,date:(0,n.ku)(e.header.date),dueDate:(0,n.ku)(e.header.dueDate)},items:t,serials:a,taxes:Object.values([...e.taxes,...e.items.filter(({taxDetails:e})=>e&&e.length>0).map(({taxDetails:e,id:a})=>({seqNo:a,...e[0]}))].reduce((a,t)=>(e.items.some(e=>e.id===t.seqNo)&&(a[t.seqNo]=t),a),{})),...(({header:e,items:a,taxes:t,serials:r,...l})=>l)(e)},l=await ed({extension:P.P.SalesTransaction.set2,record:JSON.stringify(r)}),d=e_?eo.Edited:eo.Added;m.default.success(d),await ax(l.recordId),ek()}}),eZ=(0,o.useRef)(eR?.values?.items),e$=e=>{switch(Number(e)){case K.J.SalesInvoice:return L.i.MCRSalesInvoice;case K.J.SalesReturn:return L.i.MCRSalesReturn;case K.J.ConsignmentIn:return L.i.MCRClientGOCIn;case K.J.ConsignmentOut:return L.i.MCRClientGOCOut;default:return null}},eq=3===eR.values.header.status,e_=!!eR.values.header.recordId;async function eM(e,a,t,r,l,d,n){let s,i={},o=r?.weight||0,c=r?.metalPurity??0,u=r?.isMetal??!1,m=r?.metalId??null,h=t?.baseLaborPrice??0,p=await eH(a?.msId),x=eR?.values?.header?.postMetalToFinancials??!1,I=(eR?.values?.header?.KGmetalPrice??0)*c/1e3,v=!1===x?I:0,b=v+h,g=t?.priceType===3?o*b:t?.unitPrice||0,A=parseFloat(t?.minPrice||0).toFixed(3),f=null,F=null;if(eR.values.header.taxId){let e=await e7(eR.values.header.taxId),a=e?.map(e=>({invoiceId:eR.values.recordId,taxSeqNo:e.seqNo,taxId:eR.values.header.taxId,taxCodeId:e.taxCodeId,taxBase:e.taxBase,amount:e.amount}));f=eR.values.header.taxId,F=a}else if(l?.taxId){let e=await e7(l.taxId),a=e?.map(e=>({invoiceId:eR.values.recordId,taxSeqNo:e.seqNo,taxId:l.taxId,taxCodeId:e.taxCodeId,taxBase:e.taxBase,amount:e.amount??0}));f=l.taxId,F=a}if(parseFloat(g)<parseFloat(A)&&ap(A,g),d&&(i={...i,sku:t?.sku,barcode:t?.barcode,itemName:t?.itemName,itemId:t?.itemId}),l.categoryId){let e=await el({extension:y.$.Category.get,parameters:`_recordId=${l.categoryId}`});s=e?.record?.name}eR.setFieldValue("header.mdAmount",eR.values.header.currentDiscount?eR.values.header.currentDiscount:0),i={...i,qty:0,decimals:p?.decimals,isMetal:u,metalId:m,metalPurity:c,metalRef:r?.metalRef||"",volume:r?.volume||0,weight:o,basePrice:!1===u?t?.basePrice||0:c>0?v:0,baseLaborPrice:h,totalWeightPerG:b,unitPrice:g,upo:t?.upo||0,priceType:t?.priceType||1,msId:l?.msId,categoryId:l.categoryId,categoryName:s,muRef:n?.reference||"",muId:n?.recordId||null,mdAmount:eR.values.header.maxDiscount?eR.values.header.maxDiscount:0,mdValue:0,mdType:T.Xo,extendedPrice:0,mdValue:0,taxId:f,minPrice:A,siteId:eR.values?.header?.siteId||null,siteRef:eR.values?.header?.siteRef||null,taxDetails:F,taxDetailsButton:!0};let C=ae({...i,id:a?.id,qty:a?.defaultQty||1},T.bT),P=eB(i.basePrice)?T.yO:eB(i.unitPrice)?T.Xf:null;P&&(C=ae(C,P)),e({...C,priceWithVAT:aa(C,F?.[0],T.yO)})}async function eW(e,a,t,r){if(e&&a&&t){let l=await el({extension:Z.q.Currency.get,parameters:`_currencyId=${e}&_date=${(0,n.Uf)(a)}&_rateDivision=${t}`}),d=(0,G.fB)({amount:0===r?0:r??eR.values.header.amount,exRate:l.record?.exRate,baseAmount:0,rateCalcMethod:l.record?.rateCalcMethod,dirtyField:G.ss});eR.setFieldValue("header.baseAmount",parseFloat(d?.baseAmount).toFixed(2)||0),eR.setFieldValue("header.exRate",l.record?.exRate),eR.setFieldValue("header.rateCalcMethod",l.record?.rateCalcMethod),eR.setFieldValue("header.rateCalcMethodName",l.record?.rateCalcMethodName),eR.setFieldValue("header.rateTypeName",l.record?.rateTypeName),eR.setFieldValue("header.exchangeId",l.record?.exchangeId),eR.setFieldValue("header.exchangeName",l.record?.exchangeName)}}let eL=e=>1===e.trackBy?{imgSrc:t(8041).Z.src,hidden:!1}:{imgSrc:"",hidden:!0};function eB(e){return null!=e&&""!=e&&!isNaN(e)&&0!=e}let eG=[{component:"textfield",label:e.barcode,name:"barcode",updateOn:"blur",async onChange({row:{update:e,newRow:a}}){if(!a?.barcode)return;let t=await e8(a);if(t){let r=await e3(t?.itemId),l=await e5(t?.itemId);at(l?.itemId,l?.msId);let d=ep?.filter(e=>e.recordId===l?.defSaleMUId)?.[0];await eM(e,a,t,r,l,!0,d)}else e({barcode:null})}},{component:"resourcelookup",label:e.sku,name:"sku",flex:2,props:{endpointId:y.$.Item.snapshot,parameters:{_categoryId:0,_msId:0,_startAt:0,_size:1e3},displayField:"sku",valueField:"sku",mapping:[{from:"recordId",to:"itemId"},{from:"sku",to:"sku"},{from:"name",to:"itemName"},{from:"trackBy",to:"trackBy"},{from:"msId",to:"msId"}],columnsInDropDown:[{key:"sku",value:"SKU"},{key:"name",value:"Item Name"}],displayFieldWidth:5},async onChange({row:{update:e,newRow:a}}){if(!a.itemId)return;let t=await e3(a.itemId),r=await e5(a.itemId);at(a?.itemId,a?.msId);let l=ep?.filter(e=>e.recordId===r?.defSaleMUId)?.[0],d=await e4(a.itemId,l?.recordId);await eM(e,a,d,t,r,!1,l)},propsReducer:({row:e,props:a})=>({...a,imgSrc:eL(e)})},{component:"textfield",label:e.itemName,name:"itemName",flex:3,props:{readOnly:!0}},{component:"resourcecombobox",label:e.category,name:"categoryName",flex:3,props:{endpointId:y.$.Category.qry,parameters:"_pagesize=100&_startAt=0&_name=",displayField:"name",valueField:"recordId",mapping:[{from:"recordId",to:"categoryId"},{from:"name",to:"categoryName"}],readOnly:!0}},{component:"resourcecombobox",label:e.site,name:"siteRef",props:{endpointId:y.$.Site.qry,displayField:"reference",valueField:"recordId",mapping:[{from:"recordId",to:"siteId"},{from:"reference",to:"siteRef"},{from:"name",to:"siteName"}],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],displayFieldWidth:3}},{component:"resourcecombobox",label:e.measurementUnit,name:"muRef",props:{store:ew?.current,displayField:"reference",valueField:"recordId",mapping:[{from:"reference",to:"muRef"},{from:"qty",to:"muQty"},{from:"recordId",to:"muId"}]},async onChange({row:{update:e,newRow:a}}){a?.muId||e({baseQty:0});let t=await e4(a?.itemId,a?.muId),r=ew?.current.filter(e=>e.recordId===a?.muId),l=a?.qty*r?.muQty,d=t?.priceType===3?(a?.weight||0)*((eR?.values?.header?.postMetalToFinancials?0:t?.basePrice)+(t?.baseLaborPrice||0)):t?.unitPrice||0,n=eR?.values?.header?.postMetalToFinancials??!1,s=(eR?.values?.header?.KGmetalPrice||0)*(a?.metalPurity||0)/1e3,i=ae({...a,qtyInBase:l,muQty:a?.muQty,unitPrice:d,minPrice:t?.minPrice||0,upo:t?.upo||0,priceType:t?.priceType||1,basePrice:a?.isMetal===!1?t?.basePrice||0:a?.metalPurity>0&&!1===n?s:0},T.bT);e(i)},propsReducer:({row:e,props:a})=>({...a,store:ew?.current})},{component:"numberfield",label:e.quantity,name:"qty",updateOn:"blur",props:{onCondition:e=>({decimalScale:e?.decimals,readOnly:!e?.itemId})},async onChange({row:{update:e,newRow:a}}){let t=ae(a,T.bT);e({...t,totalWeight:(t.weight||0)*(a.qty||0)})}},{component:"numberfield",label:e.volume,name:"volume",props:{decimalScale:2,readOnly:!0}},{component:"numberfield",label:e.weight,name:"weight",props:{decimalScale:2,readOnly:!0}},{component:"numberfield",label:e.totalWeight,name:"totalWeight",props:{readOnly:!0}},{component:"textfield",label:e.metal,name:"metalRef",props:{readOnly:!0}},{component:"numberfield",label:e.baseprice,name:"basePrice",updateOn:"blur",props:{decimalScale:5},async onChange({row:{update:e,newRow:a}}){let t=ae(a,T.yO);e(t)}},{component:"numberfield",label:e.baseLaborPrice,name:"baseLaborPrice",updateOn:"blur",async onChange({row:{update:e,newRow:a}}){let t=ae(a,T.tV);e(t)}},{component:"numberfield",label:e.totalPPG,name:"totalWeightPerG",updateOn:"blur",async onChange({row:{update:e,newRow:a}}){let t=ae(a,T.kx);e(t)}},{component:"numberfield",label:e.unitPrice,name:"unitPrice",updateOn:"blur",props:{decimalScale:3},async onChange({row:{update:e,oldRow:a,newRow:t}}){let r=parseFloat(t.unitPrice||0).toFixed(3),l=parseFloat(a?.minPrice||0).toFixed(3);parseFloat(l)>0&&parseFloat(r)<parseFloat(l)&&ap(l,r);let d=ae(t,T.Xf);e(d)}},{component:"numberfield",label:e.priceWithVAT,name:"priceWithVAT"},{component:"numberfield",label:e.upo,name:"upo",updateOn:"blur",props:{decimalScale:2},async onChange({row:{update:e,newRow:a}}){let t=ae(a,T.zL);e(t)}},{component:"numberfield",label:e.VAT,name:"vatAmount",props:{decimalScale:2,readOnly:!0}},{component:"button",name:"taxDetails",props:{onCondition:e=>e.itemId&&e.taxId?{imgSrc:t(36778).default.src,hidden:!1}:{imgSrc:"",hidden:!0}},label:e.tax,onClick:(e,a)=>{ei({Component:E.Z,props:{taxId:a?.taxId,obj:a}})}},{component:"numberfield",label:e.markdown,name:"mdAmount",updateOn:"blur",flex:2,props:{decimalScale:2,ShowDiscountIcons:!0,iconsClicked:eQ,type:"numeric",iconKey:({value:e,data:a})=>(e?.mdType||a?.mdType)===T.Xo?"%":"123"},async onChange({row:{update:a,newRow:t}}){let r=ae(t,T.On);a(r),function(a,t){let r=a.unitPrice*(eR.values.header.maxDiscount/100);eR.values.header.maxDiscount&&(a.mdType==T.Xo?a.mdAmount>eR.values.header.maxDiscount&&function(a,t,r,l){if(a>t){eR.setFieldValue("header.mdType",2),eR.setFieldValue("header.mdAmount",t),r.mdType=2,r.mdAmount=t;let a=ae(r,T.On);(void 0)(a),es({message:e.clientMaxDiscount+" "+t})}}(eR.values.header.maxDiscount,a,t):a.mdAmount>r&&function(a,t,r,l){if(a>t){eR.setFieldValue("header.mdAmount",t),r.mdAmount=t;let a=ae(r,T.On);l(a),es({message:e.clientMaxPctDiscount+" "+t+"%"})}}(a.mdAmount,r,a,t))}(t,a)}},{component:"button",name:"saTrx",props:{imgSrc:t(98570).default.src,onCondition:e=>({disabled:!e.itemId})},label:e.salesTrx,onClick:(e,a,t,r)=>{ei({Component:N.Z,props:{recordId:0,functionId:s,itemId:a?.itemId,clientId:eR?.values?.header?.clientId}})}},{component:"numberfield",label:e.extendedprice,name:"extendedPrice",updateOn:"blur",props:{decimalScale:2},async onChange({row:{update:e,newRow:a}}){let t=ae(a,T.bh);e(t)}},{component:"textfield",label:e.notes,name:"notes"},{component:"button",name:"serials",label:eo.serials,props:{onCondition:eL},onClick:(a,t,r,l)=>{t?.trackBy===1&&ei({Component:Q.u,props:{labels:e,row:t,disabled:eq,siteId:eR?.values?.header.siteId,maxAccess:eN,checkForSiteId:!0,updateRow:l}})}}];function eE(e,a,t){let r=parseFloat(e)||0;return a===t?(r<0||r>100)&&(r=0):r<0&&(r=0),r}async function eQ({updateRow:e,value:a,data:t}){let r=(a?.mdType||t?.mdType)===T.Xo?T.RD:T.Xo,l=eE(a?.mdAmount,r,T.Xo);e({id:t.id,changes:{mdAmount:l,mdAmountPct:r,mdType:r},commitOnBlur:!0})}async function eU(){ei({Component:j.Z,props:{functionId:s,recordId:eR.values.header.recordId}})}let eJ=async()=>{await ed({extension:P.P.SaleTransaction.post,record:JSON.stringify(eR.values.header)}),m.default.success(eo.Posted),ek(),ee.close()},ez=async()=>{await ed({extension:P.P.SaleTransaction.unpost,record:JSON.stringify(eR.values.header)}).then(e=>{m.default.success(eo.Posted),ea({recordId:e.recordId,reference:eR.values.header.reference,resourceId:et(parseInt(s)),onSuccess:()=>{en({resourceId:et(parseInt(s)),recordId:r,reference:eR.values.header.reference}),ax(e.recordId)},isAlreadyLocked:e=>{ee.close(),ei({Component:M.Z,props:{DialogText:`${eo.RecordLocked} ${e}`,title:eo.Dialog},title:eo.Dialog})}}),ek()})},eK=async()=>eZ?.current?.filter(e=>e.metalId).map(e=>({qty:e.qty,metalRef:"",metalId:e.metalId,metalPurity:e.metalPurity,weight:e.weight,priceType:e.priceType}))||[];async function eX(){let e={...eR.values.header,isVerified:!eR.values.header.isVerified};delete e.items,await ed({extension:P.P.SalesTransaction.verify,record:JSON.stringify(e)}),m.default.success(eR.values.header.isVerified?eo.Unverfied:eo.Verified),ax(eR.values.header.recordId),ek()}let eY=[{key:"RecordRemarks",condition:!0,onClick:"onRecordRemarks",disabled:!e_},{key:"WorkFlow",condition:!0,onClick:eU,disabled:!e_},{key:"FI Trx",condition:!0,onClick:"onClickIT",disabled:!e_},{key:"SA Trx",condition:!0,onClick:"onClickSATRX",disabled:!e_},{key:"Aging",condition:!0,onClick:"onClickAging",disabled:!e_},{key:"GL",condition:!0,onClick:"onClickGL",valuesPath:{...eR.values.header,notes:eR.values.header.description},datasetId:er(s),disabled:!e_},{key:"Metals",condition:!0,onClick:"onClickMetal",handleMetalClick:eK},{key:"Locked",condition:eq,onClick:"onUnpostConfirmation",onSuccess:ez,disabled:!eq||eR.values.header.isVerified},{key:"Unlocked",condition:!eq,onClick:eJ,disabled:!e_},{key:"ClientSalesTransaction",condition:!0,onClick:"onClientSalesTransaction",disabled:!eR.values.header?.clientId},{key:"AccountSummary",condition:!0,onClick:()=>{ei({Component:U.Z,props:{accountId:parseInt(eR.values.header.accountId),moduleId:1}})},disabled:!eR.values.header.clientId},{key:"Verify",condition:!eR.values.header.isVerified,onClick:eX,disabled:eR.values.header.isVerified||!e_||!eq},{key:"Unverify",condition:eR.values.header.isVerified,onClick:eX,disabled:!eR.values.header.isVerified}];async function eH(e){let a=await el({extension:y.$.Measurement.get,parameters:`_recordId=${e}`});return a?.record}async function e0(e,a){let t=e?.header,r=e?.items,l=e?.taxes,d=e?.accountBalance?.balance,n=e?.client?.accountId,i=e?.client?.maxDiscount,o=e?.formattedAddress;t?.tdType===1||t?.tdType==null?eh({text:"123",value:1}):eh({text:"%",value:2});let c=t.isVattable?eV.current:{},u=await Promise.all(r?.map(async(a,r)=>({...a,id:r+1,basePrice:a.basePrice,unitPrice:a.unitPrice,upo:a.upo,vatAmount:a.vatAmount,extendedPrice:a.extendedPrice,totalWeight:(a.weight||0)*(a.qty||0),serials:e?.serials?.filter(e=>e.seqNo==a.seqNo).map((e,a)=>({...e,id:a})),priceWithVAT:aa(a,c?.[0],T.yO),totalWeightPerG:function(e,a,t){let r=(0,T.Ch)({priceType:a?.priceType,basePrice:parseFloat(a?.basePrice||0),volume:parseFloat(a?.volume)||0,weight:parseFloat(a?.weight),unitPrice:parseFloat(a?.unitPrice||0),upo:0,qty:parseFloat(a?.qty)||0,extendedPrice:parseFloat(a?.extendedPrice),mdAmount:e?.mdAmount||0,mdType:a?.mdType||1,baseLaborPrice:a?.baseLaborPrice||0,totalWeightPerG:a?.TotPricePerG,mdValue:parseFloat(a?.mdValue),tdPct:0,dirtyField:t});return r?.totalWeightPerG?parseFloat(r.totalWeightPerG).toFixed(2):0}(t,a,T.yO),taxDetails:c[a.taxId]||null})));eZ.current=u,eR.setValues({...eR.values,recordId:t.recordId||null,header:{...eR.values.header,...t,amount:parseFloat(t?.amount).toFixed(2)??0,billAddress:o,currentDiscount:t?.tdType==1||t?.tdType==null?t?.tdAmount:t?.tdPct,KGmetalPrice:t?.metalPrice*1e3,subtotal:t?.subtotal.toFixed(2),accountId:n,commitItems:a?.record?.commitItems,postMetalToFinancials:a?.record?.postMetalToFinancials,maxDiscount:i||0,balance:d},items:u,taxes:[...l]}),eR.values.recordId||ea({recordId:t.recordId,reference:t.reference,resourceId:et(parseInt(s)),onSuccess:()=>{en({resourceId:et(parseInt(s)),recordId:t.recordId,reference:t.reference})}})}async function e1(e){let a=await el({extension:P.P.SalesTransaction.get2,parameters:`_recordId=${e}`});return a.record.header.date=(0,n.a1)(a?.record?.header?.date),a.record.header.dueDate=(0,n.a1)(a?.record?.header?.dueDate),a.record}async function e2(e,a){let t=await el({extension:w.H.AccountCreditLimit.get,parameters:`_accountId=${a}&_currencyId=${e}`});return t?.record}async function e9(a){if(!a?.recordId){eR.setFieldValue("header.clientId",null),eR.setFieldValue("header.clientName",null),eR.setFieldValue("header.clientRef",null);return}let t=await eD(a.spId),r=a.accountId,l=a.currencyId??eR.values.header.currencyId??null;if(!l){es({message:e.NoCurrencyAvailable});return}let d=await e2(l,r),n=await e6(a?.accountId,eR.values.header.currencyId,a.billAddressId);eR.setValues({...eR.values,header:{...eR.values.header,clientId:a?.recordId,clientName:a?.name,clientRef:a?.reference,isVattable:a?.isSubjectToVAT||!1,maxDiscount:a?.maxDiscount,taxId:a?.taxId,currencyId:l,spId:t,ptId:a.ptId??eg.ptId,plId:a.plId??eg.plId,szId:a.szId,billAddressId:a.billAddressId,billAddress:n?.address,creditLimit:d?.limit??0,accountId:a?.accountId,balance:n?.accountBalance?.balance}})}async function e6(e,a,t){let r=await el({extension:P.P.Client.pack,parameters:`_accountId=${e}&_currencyId=${a}&_addressId=${t||0}`});return r?.record}async function e3(e){let a=await el({extension:y.$.ItemPhysProp.get,parameters:`_itemId=${e}`});return a?.record}async function e5(e){let a=await el({extension:y.$.Item.get,parameters:`_recordId=${e}`});return a?.record}async function e7(e){return e&&eV.current[e]?eV.current[e]:[]}async function e4(e,a){let t=await el({extension:P.P.ItemConvertPrice.get,parameters:`_itemId=${e}&_clientId=${eR.values.header.clientId}&_currencyId=${eR.values.header.currencyId}&_plId=${eR.values.header.plId}&_muId=${a||0}`});return t?.record}async function e8(e){let a=await el({extension:P.P.ItemConvertPrice.get2,parameters:`_barcode=${e?.barcode}&_clientId=${eR.values.header.clientId}&_currencyId=${eR.values.header.currencyId}&_plId=${eR.values.header.plId}&_exRate=${eR.values.header.exRate}&_rateCalcMethod=${eR.values.header.rateCalcMethod}`});return a?.record}function ae(e,a,t){eC||eP(!0);let r=eE(e?.mdAmount,e?.mdType,T.Xo),l=(0,T.Ch)({priceType:e?.priceType,basePrice:parseFloat(e?.basePrice||0),volume:e?.volume||0,weight:e?.weight,unitPrice:parseFloat(e?.unitPrice)||0,upo:parseFloat(e?.upo)||0,qty:parseFloat(e?.qty||0),extendedPrice:parseFloat(e?.extendedPrice),mdAmount:r,mdType:e?.mdType,mdValue:e?.mdValue,baseLaborPrice:parseFloat(e?.baseLaborPrice||0),totalWeightPerG:e?.totalWeightPerG||0,tdPct:eR?.values?.header?.tdPct||0,dirtyField:a});e?.taxDetails?.length>0&&(e.taxDetails=[e.taxDetails[0]]);let d=(0,O.VW)({priceType:l?.priceType,basePrice:l?.basePrice,unitPrice:l?.unitPrice,qty:l?.qty,weight:l?.weight,extendedPrice:l?.extendedPrice,baseLaborPrice:l?.baseLaborPrice,vatAmount:l?.vatAmount||0,tdPct:eR?.values?.header?.tdPct,taxDetails:eR.values.header?.isVattable?e.taxDetails:null}),n={...e,id:e?.id,qty:l?.qty?l?.qty:0,volume:l?.volume?l.volume:0,weight:l?.weight?l.weight:0,basePrice:l?.basePrice?l.basePrice:0,unitPrice:l?.unitPrice?l.unitPrice:0,extendedPrice:l?.extendedPrice?l.extendedPrice:0,upo:l?.upo,mdValue:l?.mdValue,mdType:l?.mdType,baseLaborPrice:l?.baseLaborPrice?parseFloat(l.baseLaborPrice).toFixed(2):0,totalWeightPerG:l?.totalWeightPerG?parseFloat(l.totalWeightPerG).toFixed(2):0,mdAmount:l?.mdAmount?l.mdAmount:0,vatAmount:d?.vatAmount?d.vatAmount:0,priceWithVAT:aa(e,e?.taxDetails?.[0],T.yO)};return t?{changes:n}:n}function aa(e={},a=null,t){let r=e?.unitPrice??0,l=e?.priceWithVAT??0;if(!a)return(l?Math.abs(l-r):r).toFixed(2);let{amount:d=0,taxBase:n}=a;switch(t){case T.yO:return(r*(1+d/100)).toFixed(2);case T.Xf:if(1==n)return(l/(1+d/100)).toFixed(2);if(2==n)return l.toFixed(2);return(l-r).toFixed(2);default:return}}async function at(e,a){if(!e)return;let t=ep?.filter(e=>e.msId===a)||[];ew.current=t}let ar=eR.values.items?.filter(e=>void 0!==e.itemId).map(e=>({...e,basePrice:e.basePrice||0,unitPrice:e.unitPrice||0,upo:e.upo||0,vatAmount:e.vatAmount||0,weight:e.weight||0,volume:e.volume||0,extendedPrice:e.extendedPrice||0})),al=(0,D.Ww)(ar),ad=0==eR.values.miscAmount?0:parseFloat(eR.values.header.miscAmount)||0,an=(0,D.Ot)(ar,{totalQty:0,totalWeight:0,totalVolume:0,totalUpo:0,sumVat:0,sumExtended:parseFloat(al),tdAmount:parseFloat(eR.values.header.tdAmount),net:0,miscAmount:ad||0}),as=eC?an?.totalQty:eR.values?.header?.qty||0,ai=eC?an?.net:eR.values?.header.amount||0,ao=eC?an?.totalVolume:eR.values?.header.volume||0,ac=eC?an?.totalWeight:eR.values?.header.weight||0,au=eC?al.toFixed(2):eR.values?.header.subtotal||0,am=eC?an?.sumVat:eR.values?.header.vatAmount||0;async function ah(e,a,t,r){var l;l=function(e,a,t,r){let l=(0,D.Yi)({tdAmount:parseFloat(r)||0,tdPlain:1==e,tdPct:2==e,tdType:e,subtotal:au,currentDiscount:r,hiddenTdPct:a||0,hiddenTdAmount:parseFloat(t)||0,typeChange:e});return eR.setFieldValue("header.tdAmount",l?.hiddenTdAmount?l?.hiddenTdAmount?.toFixed(2):0),eR.setFieldValue("header.tdType",l?.tdType),eR.setFieldValue("header.currentDiscount",l?.currentDiscount||0),eR.setFieldValue("header.tdPct",l?.hiddenTdPct),l?.hiddenTdPct}(e,a,t,r),eR.values.items.map((e,a)=>{e?.taxDetails?.length>0&&(e.taxDetails=[e.taxDetails[0]]);let t=(0,O.VW)({priceType:e?.priceType,basePrice:e?.basePrice,qty:e?.qty,weight:e?.weight,extendedPrice:e?.extendedPrice,baseLaborPrice:parseFloat(e?.baseLaborPrice),vatAmount:e?.vatAmount,tdPct:l,taxDetails:eR.values.header?.isVattable?e.taxDetails:null});eR.setFieldValue(`items[${a}].vatAmount`,t?.vatAmount)})}function ap(a,t){parseFloat(a)>0&&parseFloat(t)<parseFloat(a)&&es({message:`${e.minPriceError}: ${a}`})}async function ax(e,a){let t={},r=await e1(e);a&&(t=await function(e){if(e)return el({extension:P.P.DocumentTypeDefault.get,parameters:`_dtId=${e}`})}(r.header.dtId)),await e0(r,t)}function aI(e){Object.entries(e).forEach(([e,a])=>{eR.setFieldValue(`header.${e}`,a)})}let av=(0,o.useMemo)(()=>{if(eR?.values?.search){let e=eR.values.items.filter(e=>e.barcode?.toString()?.includes(eR.values.search)||e.sku?.toString()?.toLowerCase()?.includes(eR.values.search.toLowerCase())||e.itemName?.toString()?.toLowerCase()?.includes(eR.values.search.toLowerCase())||e.qty?.toString()?.includes(eR.values.search));return e.length>0?e:[]}return eR.values.items},[eR.values.search,eR.values.items]);async function ay(){let e={printStatus:2,recordId:eR.values.header.recordId};await ed({extension:P.P.FlagTR,record:JSON.stringify(e)}),ek()}async function ab(e){Object.entries(e).forEach(([e,a])=>{eR.setFieldValue(`header.${e}`,a)})}return l.jsx(u.Z,{resourceId:et(parseInt(s)),form:eR,functionId:s,maxAccess:eN,previewReport:e_,previewBtnClicked:ay,actions:eY,editMode:e_,disabledSubmit:eq,children:(0,l.jsxs)(f.R,{children:[l.jsx(F.g,{children:(0,l.jsxs)(i(),{container:!0,spacing:2,children:[l.jsx(i(),{item:!0,xs:3,children:l.jsx(v.Z,{endpointId:P.P.SaleTransaction.pack,parameters:`_functionId=${s}`,reducer:e=>e?.record?.documentTypes,name:"header.dtId",readOnly:e_||eR.values.items?.some(e=>e.sku),label:e.documentType,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],valueField:"recordId",displayField:["reference","name"],values:eR.values.header,maxAccess:eN,onChange:async(e,a)=>{let t=a?a.recordId:null;await eR.setFieldValue("header.dtId",t),a||(eR.setFieldValue("header.dtId",null),eR.setFieldValue("header.siteId",null),eR.setFieldValue("header.metalPrice",0),eR.setFieldValue("header.KGmetalPrice",0),eb(!1))},error:eR?.touched?.header?.dtId&&!!eR?.errors?.header?.dtId})}),l.jsx(i(),{item:!0,xs:3,children:l.jsx(v.Z,{endpointId:P.P.SaleTransaction.pack,parameters:`_functionId=${s}`,reducer:e=>e?.record?.salesPeople,name:"header.spId",readOnly:eq,label:e.salesPerson,filter:e_?void 0:e=>!e.isInactive,columnsInDropDown:[{key:"spRef",value:"Reference"},{key:"name",value:"Name"}],valueField:"recordId",displayField:"name",values:eR.values.header,maxAccess:eN,displayFieldWidth:1.5,onChange:(e,a)=>{eR.setFieldValue("header.spId",a?a.recordId:null)},error:eR?.touched?.header?.spId&&!!eR?.errors?.header?.spId})}),l.jsx(i(),{item:!0,xs:3,children:l.jsx(v.Z,{endpointId:P.P.SaleTransaction.pack,parameters:`_functionId=${s}`,reducer:e=>e?.record?.plants,name:"header.plantId",label:e.plant,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],readOnly:eq,values:eR.values.header,valueField:"recordId",displayField:["reference","name"],maxAccess:eN,onChange:(e,a)=>{eR.setFieldValue("header.plantId",a?a.recordId:null)},displayFieldWidth:2,error:eR?.touched?.header?.plantId&&!!eR?.errors?.header?.plantId})}),l.jsx(i(),{item:!0,xs:2,children:l.jsx(v.Z,{endpointId:P.P.SaleTransaction.pack,parameters:`_functionId=${s}`,reducer:e=>e?.record?.currencies,name:"header.currencyId",label:e.currency,filter:e=>1==e.currencyType,valueField:"recordId",displayField:["reference","name"],readOnly:eq,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],required:!0,values:eR.values.header,maxAccess:eN,onChange:async(e,a)=>{await eW(a?.recordId,eR.values.header?.date,$.B.FINANCIALS),eR.setFieldValue("header.currencyId",a?.recordId||null),eR.setFieldValue("header.currencyName",a?.name)},error:eR.touched?.header?.currencyId&&!!eR.errors?.header?.currencyId})}),l.jsx(i(),{item:!0,xs:1,children:l.jsx(Y.Z,{image:"popup.png",tooltipText:eo.add,onClick:()=>{var e;return e=eR.values.header,void ei({Component:B.Z,props:{DatasetIdAccess:e$(s),data:e,onOk:e=>{eR.setFieldValue("header",{...eR.values.header,...e})}}})},disabled:eR.values.header.currencyId===eg?.currencyId})}),l.jsx(i(),{item:!0,xs:2,children:l.jsx(x.Z,{name:"header.reference",label:e.reference,value:eR?.values?.header?.reference,maxAccess:!e_&&eN,readOnly:e_,onChange:eR.handleChange,onClear:()=>eR.setFieldValue("header.reference",""),error:eR?.touched?.header?.reference&&!!eR?.errors?.header?.reference})}),l.jsx(i(),{item:!0,xs:2,children:l.jsx(d.Z,{name:"header.date",required:!0,label:e.date,readOnly:eq,value:eR?.values?.header?.date,onChange:async(e,a)=>{eR.setFieldValue("header.date",a),await eW(eR.values.header.currencyId,a,$.B.FINANCIALS)},editMode:e_,maxAccess:eN,onClear:()=>eR.setFieldValue("header.date",null),error:eR.touched?.header?.date&&!!eR.errors?.header?.date})}),l.jsx(i(),{item:!0,xs:4,children:l.jsx(v.Z,{endpointId:P.P.SaleTransaction.pack,parameters:`_functionId=${s}`,reducer:e=>e?.record?.sites,name:"header.siteId",label:e.site,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:eR.values.header,valueField:"recordId",displayField:["reference","name"],maxAccess:eN,readOnly:eq||eR.values.items?.some(e=>e.sku)||eR?.values?.header?.dtId&&!eR?.values?.header?.commitItems,required:!eR?.values?.header.dtId||eR?.values?.header.dtId&&eR?.values?.header.commitItems==!0,onChange:(e,a)=>{eR.setFieldValue("header.siteId",a?a.recordId:null),eR.setFieldValue("header.siteRef",a?a.reference:null),eR.setFieldValue("header.siteName",a?a.name:null)},error:eR?.touched?.header?.siteId&&!!eR.errors?.header?.siteId})}),l.jsx(i(),{item:!0,xs:2,children:l.jsx(C.Z,{name:"header.creditLimit",maxAccess:eN,label:e.creditLimit,value:eR.values.header.creditLimit,readOnly:!0})}),l.jsx(i(),{item:!0,xs:2,children:l.jsx(v.Z,{endpointId:P.P.SaleTransaction.pack,parameters:`_functionId=${s}`,reducer:e=>e?.record?.saleZones,name:"header.szId",label:e.saleZone,readOnly:eq,columnsInDropDown:[{key:"name",value:"Name"}],valueField:"recordId",displayField:"name",values:eR.values.header,maxAccess:eN,onChange:(e,a)=>{eR.setFieldValue("header.szId",a?a.recordId:null)},error:eR?.touched?.header?.szId&&!!eR?.errors?.header?.szId})}),l.jsx(i(),{item:!0,xs:4,children:l.jsx(b.U,{endpointId:P.P.Client.snapshot,name:"header.clientId",label:e.client,valueField:"reference",displayField:"name",valueShow:"clientRef",secondValueShow:"clientName",formObject:eR.values.header,form:eR,firstFieldWidth:4,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name",grid:8},{key:"szName",value:"Sales Zone"},{key:"keywords",value:"Keywords"},{key:"cgName",value:"Client Group"}],onChange:(e,a)=>{e9(a)},secondField:{name:"header.clientName",editable:!0,onChange:(e,a)=>{eR.setFieldValue("header.clientName",a)}},maxAccess:eN,required:!0,autoSelectFistValue:!eR.values.clientId,readOnly:eR.values.items.length>0&&eR.values.items[0].sku,displayFieldWidth:5,editMode:e_,error:eR.touched?.header?.clientId&&!!eR.errors?.header?.clientId})}),l.jsx(i(),{item:!0,xs:1,children:l.jsx(Y.Z,{onClick:()=>{ei({Component:H.Z,props:{formValues:eR.values.header,onSubmit:e=>ab(e)}})},image:"popup.png",disabled:!(e_&&!eq&&eR.values.header.clientId||!e_&&eR.values.header.clientId&&eR.values.items?.length>0&&eR.values.items?.some(e=>e?.itemId)),tooltipText:eo.editClient})}),l.jsx(i(),{item:!0,xs:1,children:l.jsx(W.Z,{name:"header.isVattable",value:eR.values?.header?.isVattable,onChange:e=>eR.setFieldValue("header.isVattable",e.target.checked),label:e.VAT,maxAccess:eN,disabled:eR?.values?.items&&eR?.values?.items[0]?.itemId})}),l.jsx(i(),{item:!0,xs:2,children:l.jsx(v.Z,{endpointId:P.P.SaleTransaction.pack,parameters:`_functionId=${s}`,reducer:e=>e?.record?.taxSchedules,name:"header.taxId",label:e.tax,valueField:"recordId",displayField:["name"],readOnly:!0,values:eR.values.header,error:eR?.touched?.header?.taxId&&!!eR?.errors?.header?.taxId,maxAccess:eN})}),l.jsx(i(),{item:!0,xs:2,children:l.jsx(v.Z,{endpointId:eR?.values?.header?.clientId&&P.P.Contact.qry,parameters:`_clientId=${eR?.values?.header?.clientId}`,name:"header.contactId",label:e.contact,valueField:"recordId",readOnly:eq,displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:eR.values.header,maxAccess:eN,onChange:(e,a)=>{eR.setFieldValue("header.contactId",a?.recordId||null)},error:eR?.touched?.header?.contactId&&!!eR?.errors?.header?.contactId})}),l.jsx(i(),{item:!0,xs:2,children:l.jsx(x.Z,{name:"search",value:eR.values.search,label:eo.Search,onClear:()=>{eR.setFieldValue("search","")},onChange:e=>{let{value:a}=e.target;eR.setFieldValue("search",a)}})}),l.jsx(i(),{item:!0,xs:3,children:ey&&l.jsx(C.Z,{name:"header.KGmetalPrice",label:e.metalPrice,value:eR.values.header.KGmetalPrice,maxAccess:eN,readOnly:!0})})]})}),l.jsx(g.Q,{children:l.jsx(A._,{onChange:(e,a,t)=>{let r=e;if(eR.values.search){let e=eR.values.items.map(e=>{let a=r.find(a=>a.id===e.id);return a?{...e,...a}:e});eR.setFieldValue("items",e),eZ.current=e}else eR.setFieldValue("items",r),eZ.current=r;if("delete"===a){let a=eR.values.items.filter(e=>e.id!==t.id);r=e.filter(e=>e.id!==t.id),eR.setFieldValue("items",a),eP(!0)}},value:av,error:eR.errors.items,initialValues:eR?.initialValues?.items[0],onSelectionChange:(e,a,t)=>{"muRef"==t&&at(e?.itemId,e?.msId)},name:"items",columns:eG,maxAccess:eN,allowDelete:!eq,allowAddNewLine:!eR.values.search,disabled:eq||!eR.values?.header?.currencyId||!eR.values?.header?.clientId||!(eR.values?.header?.dtId&&!eR.values?.header?.commitItems)&&!eR.values?.header?.siteId})}),l.jsx(F.g,{children:(0,l.jsxs)(i(),{container:!0,spacing:2,sx:{pt:2},children:[l.jsx(i(),{item:!0,xs:4,children:(0,l.jsxs)(i(),{container:!0,spacing:2,children:[l.jsx(i(),{item:!0,xs:12,children:l.jsx(I.Z,{name:"header.billAddress",label:e.billTo,value:eR.values.header.billAddress,rows:3,maxLength:"100",readOnly:!eR.values.header.clientId||eq,maxAccess:eN,viewDropDown:eR.values.header.clientId,viewAdd:eR.values.header.clientId&&!e_,onChange:e=>eR.setFieldValue("header.billAddress",e.target.value),onClear:()=>eR.setFieldValue("header.billAddress",""),onDropDown:()=>void ei({Component:R.Z,props:{maxAccess:eN,labels:e,bill:!0,form:eR.values.header,checkedAddressId:eR.values?.header?.billAddressId,handleAddressValues:aI}}),handleAddAction:()=>void ei({Component:J.Z,props:{address:eI,setAddress:ev,isCleared:!1,datasetId:L.i.ADDSalesTransaction}}),error:eR?.touched?.header?.billAddress&&!!eR?.errors?.header?.billAddress})}),l.jsx(i(),{item:!0,xs:12,children:l.jsx(I.Z,{name:"header.description",label:e.description,value:eR.values.header.description,rows:3,readOnly:eq,maxAccess:eN,onChange:e=>eR.setFieldValue("header.description",e.target.value),onClear:()=>eR.setFieldValue("header.description",""),error:eR?.touched?.header?.description&&!!eR?.errors?.header?.description})})]})}),l.jsx(i(),{item:!0,xs:2}),l.jsx(i(),{item:!0,xs:3,children:(0,l.jsxs)(i(),{container:!0,spacing:2,children:[l.jsx(i(),{item:!0,xs:12,children:l.jsx(C.Z,{name:"header.qty",maxAccess:eN,label:e.totQty,value:as,readOnly:!0})}),l.jsx(i(),{item:!0,xs:12,children:l.jsx(C.Z,{name:"header.volume",maxAccess:eN,label:e.totVolume,value:ao,readOnly:!0})}),l.jsx(i(),{item:!0,xs:12,children:l.jsx(C.Z,{name:"header.weight",maxAccess:eN,label:e.totWeight,value:ac,readOnly:!0})}),l.jsx(i(),{item:!0,xs:12,children:l.jsx(C.Z,{name:"header.balance",maxAccess:eN,label:e.balance,value:eR.values.header.balance,readOnly:!0})})]})}),l.jsx(i(),{item:!0,xs:3,children:(0,l.jsxs)(i(),{container:!0,spacing:2,children:[l.jsx(i(),{item:!0,xs:12,children:l.jsx(C.Z,{name:"header.subTotal",maxAccess:eN,label:e.subtotal,value:au,readOnly:!0})}),l.jsx(i(),{item:!0,xs:12,children:l.jsx(C.Z,{name:"header.discount",maxAccess:eN,label:e.discount,value:eR.values.header.currentDiscount,displayCycleButton:!0,cycleButtonLabel:em.text,decimalScale:2,readOnly:eq,handleButtonClick:()=>{let e,a,t;eP(!0),1==em.value?(a=eR.values.header.currentDiscount<0||eR.values.header.currentDiscount>100?0:eR.values.header.currentDiscount,e=parseFloat(a)*parseFloat(eR.values.header.subtotal)/100,t=a,eR.setFieldValue("header.tdAmount",e),eR.setFieldValue("header.tdPct",a),eR.setFieldValue("header.currentDiscount",a)):(e=eR.values.header.currentDiscount<0||eR.values.header.subtotal<eR.values.header.currentDiscount?0:eR.values.header.currentDiscount,a=parseFloat(e)/parseFloat(eR.values.header.subtotal)*100,t=e,eR.setFieldValue("header.tdPct",a),eR.setFieldValue("header.tdAmount",e),eR.setFieldValue("currentDiscount",e)),eh(r=>{let l="%"===r.text?{text:"123",value:1}:{text:"%",value:2};return eR.setFieldValue("header.tdType",l.value),ah(l.value,a,e,t),l})},iconKey:em.text,ShowDiscountIcons:!0,onChange:e=>{let a=Number(e.target.value.replace(/,/g,""));eR.values.header.tdType==D.a$?((a<0||a>100)&&(a=0),eR.setFieldValue("header.tdPct",a)):((a<0||eR.values.header.subtotal<a)&&(a=0),eR.setFieldValue("header.tdAmount",a)),eR.setFieldValue("header.currentDiscount",a)},onBlur:async e=>{let a=Number(e.target.value.replace(/,/g,"")),t=Number(e.target.value.replace(/,/g,"")),r=Number(e.target.value.replace(/,/g,""));eR.values.header.tdType==D.ER&&(t=parseFloat(a)/parseFloat(au)*100,eR.setFieldValue("header.tdPct",t)),eR.values.header.tdType==D.a$&&(r=parseFloat(a)*parseFloat(au)/100,eR.setFieldValue("header.tdAmount",r)),eP(!0),await ah(eR.values.header.tdType,t,r,a)},onClear:()=>{eR.setFieldValue("header.tdAmount",0),eR.setFieldValue("header.tdPct",0),ah(eR.values.header.tdType,0,0,0)}})}),l.jsx(i(),{item:!0,xs:12,children:l.jsx(C.Z,{name:"header.miscAmount",maxAccess:eN,label:e.misc,value:eR.values.header.miscAmount,decimalScale:2,readOnly:eq,onChange:e=>{eR.setFieldValue("header.miscAmount",e.target.value);let a=(0,G.fB)({amount:e.target.value??0,exRate:eR.values?.exRate,baseAmount:0,rateCalcMethod:eR.values?.rateCalcMethod,dirtyField:G.ss});eR.setFieldValue("header.baseAmount",parseFloat(a?.baseAmount).toFixed(2)||0)},onBlur:async()=>{eP(!0)},onClear:()=>eR.setFieldValue("header.miscAmount",0),error:eR?.touched?.header?.miscAmount&&!!eR?.errors?.header?.miscAmount})}),l.jsx(i(),{item:!0,xs:12,children:l.jsx(C.Z,{name:"header.vatAmount",maxAccess:eN,label:e.VAT,value:am,readOnly:!0})}),l.jsx(i(),{item:!0,xs:12,children:l.jsx(C.Z,{name:"header.amount",maxAccess:eN,label:e.net,value:ai,readOnly:!0})})]})})]})})]})})}[u,m,h,p,v,b,A,j,N,k,S,R,q,_,B,E,Q,U,J,H]=ee.then?(await ee)():ee,ea.width=1330,ea.height=720,r()}catch(e){r(e)}})},78630:(e,a,t)=>{t.a(e,async(e,r)=>{try{t.d(a,{Z:()=>f});var l=t(20997),d=t(99155),n=t.n(d),s=t(16689),i=t(6416),o=t(44619),c=t(95965),u=t(18611),m=t(23385),h=t(91184),p=t(43991),x=t(29352),I=t(4902);t(79390),t(19138);var v=t(38509),y=t(96119),b=t(60520),g=t(18687),A=e([x,v,b,g]);function f({data:e,onOk:a,DatasetIdAccess:t,window:r}){let{getRequest:d}=(0,s.useContext)(x.$),{platformLabels:A}=(0,s.useContext)(b.l);(0,y.Z)({title:A.MultiCurrencyRate,window:r});let{labels:f,access:F}=(0,v.J)({endpointId:I.q.Currency.get,DatasetIdAccess:t,datasetId:i.i.MultiCurrencyRate}),{formik:C}=(0,c.c)({initialValues:{currencyId:e?.currencyId,currencyName:e?.currencyName,exchangeId:e?.exchangeId,exchangeName:e?.exchangeName,rateCalcMethod:e?.rateCalcMethod,rateCalcMethodName:e?.rateCalcMethodName,rateTypeId:e?.rateTypeId,exRate:e?.exRate||null,amount:e?.amount||0,baseAmount:e?.baseAmount,rateTypeName:e?.rateTypeName},maxAccess:F,validateOnChange:!0}),P=()=>{if(a){let e={...C.values,exRate:C.values.exRate,baseAmount:C.values.baseAmount,amount:C.values.amount};a(e),r.close()}},w=[{key:"Ok",condition:!0,onClick:P,disabled:!1}];return l.jsx(g.Z,{onSave:P,actions:w,maxAccess:F,editMode:!1,isSaved:!1,children:l.jsx(u.R,{children:l.jsx(m.Q,{children:(0,l.jsxs)(n(),{container:!0,spacing:2,children:[l.jsx(n(),{item:!0,xs:12,children:l.jsx(o.Z,{name:"currencyName",value:C?.values?.currencyName,label:f.currency,readOnly:!0})}),l.jsx(n(),{item:!0,xs:12,children:l.jsx(o.Z,{name:"rateTypeName",value:C?.values?.rateTypeName,label:f.rateType,readOnly:!0})}),l.jsx(n(),{item:!0,xs:12,children:l.jsx(o.Z,{name:"exchangeName",value:C?.values?.exchangeName,label:f.exchangeTable,readOnly:!0})}),l.jsx(n(),{item:!0,xs:12,children:l.jsx(o.Z,{name:"rateCalcMethodName",value:C?.values?.rateCalcMethodName,label:f.rateCalcMethod,readOnly:!0})}),l.jsx(n(),{item:!0,xs:12,children:l.jsx(h.Z,{name:"exRate",value:C?.values?.exRate,label:f.rate,readOnly:C?.values?.amount==0,maxAccess:F,onClear:()=>{C.setFieldValue("baseAmount",""),C.setFieldValue("exRate","")},decimalScale:7,onChange:a=>{let t=a.target.value;if(!t){C.setFieldValue("exRate",""),C.setFieldValue("baseAmount","");return}C.setFieldValue("exRate",t);let r=(0,p.fB)({amount:e?.amount||0,exRate:t,baseAmount:parseFloat(C?.values?.baseAmount||0).toFixed(2),rateCalcMethod:C?.values?.rateCalcMethod,dirtyField:p.ss});C.setValues({...C.values,...r,baseAmount:parseFloat(r.baseAmount).toFixed(2)})}})}),l.jsx(n(),{item:!0,xs:12,children:l.jsx(h.Z,{name:"amount",value:C?.values?.amount,label:f.amount,readOnly:!0})}),l.jsx(n(),{item:!0,xs:12,children:l.jsx(h.Z,{name:"baseAmount",value:C?.values?.baseAmount,label:f.baseAmount,readOnly:C?.values?.amount==0,onClear:()=>{C.setFieldValue("baseAmount",""),C.setFieldValue("exRate","")},maxAccess:F,onChange:a=>{let t=a.target.value;if(!t){C.setFieldValue("baseAmount",""),C.setFieldValue("exRate","");return}C.setFieldValue("baseAmount",t);let r=(0,p.fB)({amount:e?.amount||0,exRate:C?.values?.exRate,baseAmount:parseFloat(t||0).toFixed(2),rateCalcMethod:C?.values?.rateCalcMethod,dirtyField:p.i5});C.setValues({...C.values,...r})}})})]})})})})}[x,v,b,g]=A.then?(await A)():A,f.width=500,f.height=500,r()}catch(e){r(e)}})},9972:(e,a,t)=>{t.d(a,{Z:()=>o});var r=t(20997),l=t(30343),d=t.n(l),n=t(18611),s=t(23385);let i=({DialogText:e,bottomSection:a})=>(0,r.jsxs)(n.R,{children:[r.jsx(s.Q,{children:r.jsx(d(),{sx:{p:12},textAlign:"center",children:e})}),a]});i.width=600,i.height=200;let o=i},49466:(e,a,t)=>{t.a(e,async(e,r)=>{try{t.d(a,{u:()=>V});var l=t(20997),d=t(18611),n=t(23385),s=t(6416),i=t(99155),o=t.n(i),c=t(71278),u=t(95965),m=t(75609),h=t(38509),p=t(16689),x=t(29352),I=t(91184),v=t(61274),y=t(54242),b=t(15051),g=t(42020),A=t(70305),f=t(60520),F=t(60349),C=t(96119),P=t(18687),w=e([c,h,x,v,b,A,f,P]);[c,h,x,v,b,A,f,P]=w.then?(await w)():w;let V=({row:e,siteId:a,checkForSiteId:t,window:r,updateRow:i,disabled:w})=>{let{getRequest:V}=(0,p.useContext)(x.$),{stack:j}=(0,A.V)(),{platformLabels:N,systemChecks:k}=(0,p.useContext)(f.l),S=k.some(e=>e.checkId===F.F.ALLOW_INVENTORY_NEGATIVE_QTY),T=k?.find(e=>e.checkId===F.F.POS_JUMP_TO_NEXT_LINE)?.value||!1,{labels:O,maxAccess:D}=(0,h.J)({datasetId:s.i.Serial});(0,C.Z)({title:N.serials,window:r});let{formik:R}=(0,u.c)({maxAccess:D,initialValues:{sku:e?.sku,itemName:e?.itemName,itemId:e?.itemId,siteId:a,totalWeight:e?.qty||0,pieces:null,items:e?.serials||[]},validateOnChange:!0,validationSchema:m.object({items:m.array().of(m.object({srlNo:m.string().test(function(e){return this.options.from[1]?.value?.items?.length===1||!!e})}))}),onSubmit:async a=>{let t=a.items.filter(e=>e?.srlNo).map((a,t)=>({...a,id:t+1,srlSeqNo:t+1,srlNo:a.srlNo,seqNo:e.id}));i({changes:{serials:t,...e?.hasOwnProperty("serialCount")&&{serialCount:t?.length||0}}}),r.close()}}),Z=R.values.items.reduce((e,a)=>{let t=parseFloat(a.weight)||0;return e+t},0),$=R.values.totalWeight-Z||0,q=[{component:"textfield",name:"srlNo",label:O.serialNo,jumpToNextLine:T,updateOn:"blur",onChange:async({row:{update:e,newRow:a,oldRow:t,addRow:r}})=>{a.srlNo!==t?.srlNo&&await W(a,e,r)}},{component:"numberfield",name:"weight",label:O.weight,props:{readOnly:!0}}],_=e=>{let a=R.values.items.map(a=>a.id===e?{...a,srlNo:"",weight:""}:a);R.setFieldValue("items",a)},M=e=>{let a=R.values.items.filter(a=>a.id!==e);0===a.length&&(a=[{id:0,srlNo:"",weight:""}]),R.setFieldValue("items",a)},W=async(a,r,l)=>{let{srlNo:d,id:n}=a;if(d){let s=await V({extension:y.$.Serial.get,parameters:`_srlNo=${d}`});s.record?s?.record?.itemId!==e?.itemId?(j({message:N.serialDoesNotBelongItem}),_(n)):t&&!S&&R.values.siteId?(await V({extension:y.$.AvailabilitySerial.get,parameters:`_srlNo=${d}&_siteId=${R.values.siteId}`})).record?(r({weight:s.record.weight}),l({fieldName:"srlNo",changes:{id:a.id,srlNo:a.srlNo,weight:s.record.weight}})):(j({message:O.invalidSerial}),_(n)):(r({weight:s.record.weight}),l({fieldName:"srlNo",changes:{id:a.id,srlNo:a.srlNo,weight:s.record.weight}})):(j({message:N.unknownSerial}),M(n))}},L=[{key:"Ok",condition:!0,onClick:()=>R.handleSubmit(),disabled:w}];return l.jsx(P.Z,{onSave:R.handleSubmit,isSaved:!1,actions:L,maxAccess:D,children:(0,l.jsxs)(d.R,{children:[l.jsx(g.g,{children:(0,l.jsxs)(o(),{container:!0,spacing:2,children:[l.jsx(o(),{item:!0,xs:12,children:l.jsx(v.U,{endpointId:y.$.Item.snapshot,name:"itemId",label:O?.sku,valueField:"recordId",displayField:"sku",valueShow:"sku",secondValueShow:"itemName",form:R,readOnly:!0})}),l.jsx(o(),{item:!0,xs:12,children:l.jsx(c.Z,{endpointId:y.$.Site.qry,name:"siteId",label:O.site,values:R.values,valueField:"recordId",displayField:["reference","name"],maxAccess:D,readOnly:!0})}),l.jsx(o(),{item:!0,xs:12,children:l.jsx(I.Z,{name:"totalWeight",label:O.totalWeight,maxAccess:D,value:R.values.totalWeight,readOnly:!0})}),l.jsx(o(),{item:!0,xs:12,children:l.jsx(I.Z,{name:"weightAssigned",label:O.weightAssigned,maxAccess:D,value:Z,readOnly:!0})}),l.jsx(o(),{item:!0,xs:12,children:l.jsx(I.Z,{name:"balanceWeight",label:O.balanceWeight,maxAccess:D,value:$,readOnly:!0})}),l.jsx(o(),{item:!0,xs:12,children:l.jsx(I.Z,{name:"pieces",label:O.pieces,maxAccess:D,value:R?.values?.items?.filter(e=>void 0!==e.srlNo)?.length,readOnly:!0})})]})}),l.jsx(n.Q,{children:l.jsx(b._,{onChange:e=>R.setFieldValue("items",e),value:R.values?.items,error:R.errors?.items,name:"items",columns:q,maxAccess:D,disabled:w,allowDelete:!w,allowAddNewLine:!w})})]})})};V.width=500,V.height=700,r()}catch(e){r(e)}})}};