"use strict";exports.id=16330,exports.ids=[16330],exports.modules={16330:(e,a,r)=>{r.a(e,async(e,t)=>{try{r.d(a,{Z:()=>$});var d=r(20997),s=r(99155),n=r.n(s),l=r(16689),o=r(75609),c=r(80582),i=r(86201),u=r(29352),h=r(38509),m=r(6416),p=r(65305),I=r(79660),f=r(61274),v=r(95965),x=r(91184),w=r(44619),y=r(27736),R=r(68728),V=r(18611),g=r(86794),j=r(75281),C=r(79390),b=r(60520),N=r(42020),k=r(677),O=r(9972),F=r(27559),S=r(98081),P=r(94177),Z=r(15511),A=r(23385),D=r(38782),J=r(96119),L=e([c,i,u,h,f,g,b,k,F,S,P,Z,D]);[c,i,u,h,f,g,b,k,F,S,P,Z,D]=L.then?(await L)():L;let T=({recordId:e,cashAccountId:a,form:r=null,window:t})=>{let{getRequest:s,postRequest:L}=(0,l.useContext)(u.$),{platformLabels:T}=(0,l.useContext)(b.l),{stack:$}=(0,k.zY)(),[q,G]=(0,l.useState)({}),[_,E]=(0,l.useState)(null),{labels:M,access:Q}=(0,D.Z)({datasetId:m.i.RemittanceReceiptVoucher,editMode:!!e});(0,J.Z)({title:M.receiptVoucher,window:t});let{documentType:U,maxAccess:z}=(0,g.H)({functionId:R.J.RemittanceReceiptVoucher,access:Q,enabled:!e,objectName:"header"}),B=(0,h.E)({endpointId:p.N.ReceiptVouchers.page}),{formik:H}=(0,v.c)({maxAccess:z,documentType:{key:"header.dtId",value:U?.dtId},validateOnChange:!0,initialValues:{recordId:e,header:{recordId:e,plantId:null,reference:"",accountId:null,date:new Date,dtId:null,amount:null,owoId:null,owoRef:"",status:1,wip:null,otpVerified:!1,clientId:null,cellPhone:null},cash:q.initialValuePayment||[]},validationSchema:o.object({header:o.object({owoId:o.string().required()}),cash:q?.paymentValidation}),onSubmit:async e=>{let t=H.values.cash.map((e,r)=>({...e,id:r+1,seqNo:r+1,posStatus:1,cashAccountId:a})),d={header:H.values.header,cash:t};if(H.values.cash.reduce((e,a)=>e+parseFloat(a.amount||0),0).toFixed(2)!==H.values.header.amount.toFixed(2)){i.default.error("The total amount does not match the sum of amounts in the grid.");return}await L({extension:p.N.ReceiptVouchers.set2,record:JSON.stringify(d)}).then(async a=>{if(e.header.recordId)i.default.success(T.Edited);else{i.default.success(T.Added);let e=await ed(a?.recordId);ee(e)}}),r||B()}}),Y=!!e||!!H?.values?.header?.recordId,K=H?.values?.header?.status===3,W=H?.values?.header?.wip===2,X=H?.values?.header?.otpVerified;function ee(e){let a=e?.recordId||H.values.header.recordId;$({Component:F.Z,props:{values:e||H.values.header,recordId:a,deviceId:(e?.cellPhone||H?.values?.header?.cellPhone)?.replace(/^\+/,"")||null,functionId:R.J.RemittanceReceiptVoucher,onSuccess:()=>{ea(a)}}})}let ea=e=>{let a=e||H.values.header.recordId;L({extension:p.N.ReceiptVouchers.close,record:JSON.stringify({recordId:a})}).then(async e=>{if(e?.recordId){i.default.success(T.Closed),B();let a=await ed(e?.recordId);4===a.status&&er(a)}})},er=async e=>{let a=e||H.values.header,r=await L({extension:p.N.ReceiptVouchers.post,record:JSON.stringify(a)});r&&(i.default.success(T.Posted),function(e){let a=e.split(","),r=a[0],t=a[1];$({Component:O.Z,props:{DialogText:`${T.Posted} ${t}`,bottomSection:d.jsx(N.g,{children:d.jsx(P.Z,{previewReport:!0,onGenerateReport:()=>$({Component:Z.Z,props:{selectedReport:_,recordId:r,functionId:R.J.OutwardsTransfer,resourceId:m.i.OutwardsTransfer}}),recordId:r,resourceId:m.i.OutwardsTransfer,setSelectedReport:E})}),title:T.Post}})}(r.recordId),B(),ed())},et=async()=>{let e=(0,j.m)("userData").userId,{record:a}=await s({extension:I.r.UserDefaults.get,parameters:`_userId=${e}&_key=plantId`});a&&H.setFieldValue("header.plantId",parseInt(a.value))};async function ed(a){let r=a||e||H.values.header.recordId;if(r){let e=await s({extension:p.N.ReceiptVouchers.get,parameters:`_recordId=${r}`}),t=await s({extension:p.N.OutwardsCash.qry,parameters:`_receiptId=${r}`});return H.setValues({recordId:a,header:{...e.record,date:(0,C.a1)(e?.record?.date)},cash:t?.list?.length!=0?t.list.map((e,a)=>({id:a+1,pos:e?.type!=3,...e})):H.initialValues.cash}),e.record}}async function es(){let e=H.values;await L({extension:p.N.ReceiptVouchers.reopen,record:JSON.stringify(H.values.header)}).then(a=>{a.recordId&&(i.default.success(T.Reopened),B(),ed(e?.recordId))})}(0,l.useEffect)(()=>{(async()=>{await et(),e?await ed(e):r&&H.setValues(e=>({...e,header:{...e.header,amount:r.amount,owoId:r.recordId,owoRef:r.reference,clientId:r.clientId,cellPhone:r.cellPhone,plantId:r.plantId}}))})()},[e,r]);let en=[{key:"Locked",condition:!0,onClick:e=>er(e.target.value),disabled:K||!Y||!X||!W},{key:"Close",condition:!W,onClick:e=>ea(e.target.value),disabled:W||!Y},{key:"Reopen",condition:W,onClick:es,disabled:!W||!Y||H?.values?.header?.releaseStatus===3},{key:"OTP",condition:!0,onClick:()=>{ee(null)},disabled:!Y||H?.values?.header?.status==3},{key:"GL",condition:!0,onClick:"onClickGL",datasetId:m.i.GLRemittanceReceiptVoucher,valuesPath:H.values.header,disabled:!Y}];return d.jsx(c.Z,{resourceId:m.i.RemittanceReceiptVoucher,functionId:R.J.RemittanceReceiptVoucher,form:H,actions:en,maxAccess:z,editMode:Y,disabledSubmit:K||W,previewReport:Y,children:(0,d.jsxs)(V.R,{children:[d.jsx(N.g,{children:(0,d.jsxs)(n(),{container:!0,spacing:2,children:[d.jsx(n(),{item:!0,xs:12,children:(0,d.jsxs)(n(),{container:!0,spacing:2,children:[d.jsx(n(),{item:!0,xs:6,children:d.jsx(w.Z,{name:"header.reference",label:M.reference,value:H?.values?.header?.reference,readOnly:Y,maxAccess:!Y&&z,maxLength:"30",onChange:H.handleChange,onClear:()=>H.setFieldValue("header.reference",""),error:H.touched.header?.reference&&!!H.errors.header?.reference})}),d.jsx(n(),{item:!0,xs:6,children:d.jsx(y.Z,{name:"header.date",label:M.date,readOnly:!0,value:H?.values?.header?.date,maxAccess:z,error:H.touched.header?.date&&!!H.errors.header?.date})})]})}),d.jsx(n(),{item:!0,xs:12,children:(0,d.jsxs)(n(),{container:!0,spacing:2,children:[d.jsx(n(),{item:!0,xs:6,children:d.jsx(f.U,{endpointId:p.N.OutwardsOrder.snapshot,valueField:"reference",name:"header.owoId",label:M.outwards,form:H,secondDisplayField:!1,valueShow:"owoRef",formObject:H.values.header,readOnly:K,required:!0,maxAccess:z,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"amount",value:"Amount"}],onChange:(e,a)=>{H.setFieldValue("header.owoId",a?a.recordId:""),H.setFieldValue("header.owoRef",a?a.reference:""),H.setFieldValue("header.amount",a?a.amount:""),H.setFieldValue("header.clientId",a?a.clientId:"")},errorCheck:"header.owoId"})}),d.jsx(n(),{item:!0,xs:6,children:d.jsx(x.Z,{name:"header.amount",label:M.amount,value:H?.values?.header?.amount,readOnly:!0,maxAccess:z,onChange:e=>H.setFieldValue("header.amount",e.target.value),onClear:()=>{H.setFieldValue("header.amount",""),H?.values?.header?.fcAmount||(handleSelectedProduct(null,!0),H.setFieldValue("header.products",[]))},error:H.touched.header?.amount&&!!H.errors.header?.amount,maxLength:10})})]})})]})}),d.jsx(A.Q,{children:d.jsx(S.Z,{onChange:e=>H.setFieldValue("cash",e),value:H.values.cash,error:H.errors.cash,allowDelete:!K,allowAddNewLine:!K,amount:H.values.header.amount,setFormik:G,data:{recordId:H.values.header.recordId,reference:H.values.header.reference,clientName:H.values.header.clientName,beneficiaryName:H.values.header.beneficiaryName,viewPosButtons:H?.values?.header?.wip===2},name:"cash"})})]})})};T.width=1e3;let $=T;t()}catch(e){t(e)}})},9972:(e,a,r)=>{r.d(a,{Z:()=>c});var t=r(20997),d=r(30343),s=r.n(d),n=r(18611),l=r(23385);let o=({DialogText:e,bottomSection:a})=>(0,t.jsxs)(n.R,{children:[t.jsx(l.Q,{children:t.jsx(s(),{sx:{p:12},textAlign:"center",children:e})}),a]});o.width=600,o.height=200;let c=o}};