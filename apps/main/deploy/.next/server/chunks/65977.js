exports.id=65977,exports.ids=[65977],exports.modules={44982:e=>{e.exports={container:"ImageUpload_container__I2BWx",previewBox:"ImageUpload_previewBox__JogCN",previewImage:"ImageUpload_previewImage___eqQX",bottomSection:"ImageUpload_bottomSection__jpph8"}},528:(e,r,d)=>{"use strict";d.a(e,async(e,l)=>{try{d.d(r,{Z:()=>v});var a=d(20997),n=d(30343),t=d.n(n),s=d(16689),i=d(95965),o=d(29352),c=d(79660),u=d(60520),m=d(20562),I=d(44982),p=d.n(I),x=d(70755),h=e([o,u]);[o,u]=h.then?(await h)():h;let v=(0,s.forwardRef)(({resourceId:e,error:r,seqNo:l,recordId:n,width:I=140,height:h=140,customWidth:v,customHeight:y,disabled:f=!1,isAbsolutePath:g=!1,parentImage:F},j)=>{let C=(0,s.useRef)(null),k=(0,s.useRef)(null),S=(0,s.useRef)({}),{getRequest:w,postRequest:b}=(0,s.useContext)(o.$),{platformLabels:N}=(0,s.useContext)(u.l),[A,_]=(0,s.useState)(""),O=F?.recordId,V=F?.resourceId,{formik:q}=(0,i.c)({initialValues:{}}),{width:Z}=(0,m.d)(),$=Z>=1680?1:Z>=1600?.9:Z<=1024?.7:.7+(Z-1024)/576*.22000000000000008;(0,s.useImperativeHandle)(j,()=>({submit:D}));let D=()=>{if(f)return;let r=j?.current?.value||n;if(g){if(q.values?.file?.name||q.values.url){let d={...q.values,fileName:q.values.file?.name||q.values.url,resourceId:e,recordId:r};return b({extension:c.r.Attachment.set2,record:JSON.stringify(d),file:q.values?.file}).then(()=>R(r))}return!A&&S.current?.fileName&&!q.values?.fileName?b({extension:c.r.Attachment.del,record:JSON.stringify(S.current)}).then(()=>R(r)):void 0}if(q.values?.file){let e={...q.values,recordId:r};return b({extension:c.r.Attachment.set,record:JSON.stringify(e),file:q.values?.file}).then(()=>R(r))}if(!A&&S.current?.url&&!q.values?.url)return b({extension:c.r.Attachment.del,record:JSON.stringify(S.current),file:S.current?.url}).then(()=>R(r))},G=()=>{_(""),q.setValues({})},R=async r=>{let d=r||n;if(!e)return;if(g&&d){let r=await w({extension:c.r.Attachment.get2,parameters:`_resourceId=${e}&_seqNo=${l}&_recordId=${d}`}),a=r?.record||{};q.setValues({...a,resourceId:e}),S.current={...a,resourceId:e},_(a?.fileName?`${a.fileName}?t=${Date.now()}`:"");return}let a=V||e,t=O||d;if(!t)return;let s=await w({extension:c.r.Attachment.get,parameters:`_resourceId=${a}&_seqNo=${l}&_recordId=${t}`}),i=s?.record||{};q.setValues({...i,resourceId:a}),S.current={...i,resourceId:a},_(i?.url?`${i.url}?t=${Date.now()}`:"")};return(0,s.useEffect)(()=>{O||n?R():G()},[O,n]),(0,a.jsxs)(t(),{className:p().container,children:[a.jsx(t(),{className:p().previewBox,style:{width:"100%",maxWidth:(v||I)*$,height:(y||h)*$},onClick:()=>{f||C.current.click()},children:a.jsx("img",{src:A||d(13063).default.src,alt:"",className:p().previewImage,style:{border:r?"2px solid #F44336":"none"},onError:e=>{e.currentTarget.src=d(13063).default.src}})}),(0,a.jsxs)(t(),{className:p().bottomSection,children:[a.jsx("input",{hidden:!0,type:"file",accept:"image/png, image/jpeg, image/jpg",ref:C,onChange:r=>{let d=r?.target?.files?.[0];if(!d)return;if(Math.round(d.size/1024)>500){alert(N.MaxFileSize);return}let l=new Date(d.lastModifiedDate),a=`${l.getDate()}/${l.getMonth()+1}/${l.getFullYear()}`;q.setValues({resourceId:e,recordId:n,seqNo:0,fileName:d.name,folderId:null,folderName:null,date:a,url:null,file:d});let t=new FileReader;k.current=t,t.onloadend=e=>_(e.target.result),t.readAsDataURL(d)},disabled:f}),a.jsx(x.Z,{onClick:G,image:"clear.png",tooltipText:N.Clear,color:"#F44336",border:"none",disabled:f})]})]})});l()}catch(e){l(e)}})},65977:(e,r,d)=>{"use strict";d.a(e,async(e,l)=>{try{d.d(r,{Z:()=>q});var a=d(20997),n=d(99155),t=d.n(n),s=d(16689),i=d(75609),o=d(80582),c=d(528),u=d(86201),m=d(29352),I=d(6416),p=d(44619),x=d(95965),h=d(60520),v=d(18611),y=d(27736),f=d(71278),g=d(79660),F=d(68728),j=d(65980),C=d(86794),k=d(79390),S=d(54242),w=d(42020),b=d(96995),N=d(97969),A=d(59636),_=d(38782),O=d(96119),V=e([o,c,u,m,h,f,C,_]);function q({recordId:e,invalidate:r,window:d}){let{getRequest:l,postRequest:n}=(0,s.useContext)(m.$),{platformLabels:V}=(0,s.useContext)(h.l),q=(0,s.useRef)(null),Z=F.J.Sketch,{labels:$,access:D}=(0,_.Z)({datasetId:I.i.Sketch,editMode:!!e});(0,O.Z)({title:$?.Sketch,window:d});let{documentType:G,maxAccess:R,changeDT:z}=(0,C.H)({functionId:Z,access:D,enabled:!e});function J(){r&&r()}let{formik:L}=(0,x.c)({documentType:{key:"dtId",value:G?.dtId},initialValues:{recordId:null,reference:"",dtId:null,date:new Date,designerId:null,itemGroupId:null,productionClassId:null,productionStandardId:null,designGroupId:null,designFamilyId:null,metalId:null,collectionId:null,source:null,statusName:"",notes:"",status:1,wip:1},maxAccess:R,validateOnChange:!0,validationSchema:i.object({date:i.date().required(),itemGroupId:i.string().required(),source:i.string().required(),productionLineId:i.number().required()}),onSubmit:async e=>{let r={...e,date:(0,k.ku)(e?.date)},d=await n({extension:b.z.Sketch.set,record:JSON.stringify(r)});q.current&&(q.current.value=d.recordId,await q.current.submit()),await E(d.recordId),J(),u.default.success(T?V.Edited:V.Added)}}),U=2===L.values.wip,M=3===L.values.status,T=!!L.values.recordId;async function E(e){let r=await l({extension:b.z.Sketch.get,parameters:`_recordId=${e}`});r.record.date=(0,k.a1)(r?.record?.date),L.setValues({...r.record})}let P=async()=>{await n({extension:b.z.Sketch.close,record:JSON.stringify({recordId:L.values.recordId})}),await E(L.values.recordId),u.default.success(V.Closed),J()},B=async()=>{let e={...L.values,date:(0,k.ku)(L.values?.date)};await n({extension:b.z.Sketch.reopen,record:JSON.stringify(e)}),await E(L.values.recordId),u.default.success(V.Reopened),J()},W=async()=>{let e={...L.values,date:(0,k.ku)(L.values?.date)};await n({extension:b.z.Sketch.post,record:JSON.stringify(e)}),await E(L.values.recordId),u.default.success(V.Posted),J()},H=[{key:"Approval",condition:!0,onClick:"onApproval",disabled:!U},{key:"Locked",condition:M,onClick:"onUnpostConfirmation",disabled:!0},{key:"Unlocked",condition:!M,onClick:W,disabled:!T||!U},{key:"Close",condition:!U,onClick:P,disabled:!T||M},{key:"Reopen",condition:U,onClick:B,disabled:!T||M}];return a.jsx(o.Z,{resourceId:I.i.Sketch,form:L,maxAccess:R,editMode:T,actions:H,functionId:Z,disabledSubmit:U||M,children:a.jsx(v.R,{children:a.jsx(w.g,{children:(0,a.jsxs)(t(),{container:!0,spacing:2,children:[a.jsx(t(),{item:!0,xs:6,children:(0,a.jsxs)(t(),{container:!0,spacing:2,children:[a.jsx(t(),{item:!0,xs:12,children:a.jsx(f.Z,{endpointId:g.r.DocumentType.qry,parameters:`_dgId=${Z}&_startAt=0&_pageSize=50`,filter:T?void 0:e=>1===e.activeStatus,name:"dtId",label:$.documentType,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],valueField:"recordId",displayField:["reference","name"],readOnly:T,values:L?.values,onChange:async(e,r)=>{L.setFieldValue("dtId",r?.recordId||null),z(r),r?.recordId||L.setFieldValue("productionLineId",null)},error:L.touched.dtId&&!!L.errors.dtId,maxAccess:R})}),a.jsx(t(),{item:!0,xs:12,children:a.jsx(p.Z,{name:"reference",label:$.reference,value:L?.values?.reference,readOnly:T,maxAccess:!T&&R,onChange:L.handleChange,onClear:()=>L.setFieldValue("reference",""),error:L.touched.reference&&!!L.errors.reference})}),a.jsx(t(),{item:!0,xs:12,children:a.jsx(f.Z,{datasetId:N.v.SKETCH_SOURCE,name:"source",label:$.sketchSource,valueField:"key",displayField:"value",required:!0,values:L.values,onChange:(e,r)=>{L.setFieldValue("source",r?.key||null)},readOnly:M||U,maxAccess:R,error:L.touched.source&&!!L.errors.source})}),a.jsx(t(),{item:!0,xs:12,children:a.jsx(f.Z,{endpointId:b.z.Designer.qry,name:"designerId",label:$.designer,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name",width:4},{key:"typeName",value:"Type"}],displayFieldWidth:2,readOnly:U,maxAccess:R,values:L.values,onChange:(e,r)=>{L.setFieldValue("designerId",r?.recordId||null)},error:L.touched.designerId&&!!L.errors.designerId})}),a.jsx(t(),{item:!0,xs:12,children:a.jsx(f.Z,{endpointId:A.u.DesignFamily.qry,name:"designFamilyId",label:$.familyGroup,valueField:"recordId",displayField:"name",values:L.values,readOnly:M||U,onChange:(e,r)=>L.setFieldValue("designFamilyId",r?.recordId||null),error:L?.touched?.designFamilyId&&!!L?.errors?.designFamilyId,maxAccess:R})}),a.jsx(t(),{item:!0,xs:12,children:a.jsx(f.Z,{endpointId:A.u.DesignGroup.qry,name:"designGroupId",label:$.designGroup,valueField:"recordId",displayField:"name",values:L.values,readOnly:M||U,onChange:(e,r)=>{L.setFieldValue("designGroupId",r?.recordId||null)},error:L?.touched?.designGroupId&&!!L?.errors?.designGroupId,maxAccess:R})}),a.jsx(t(),{item:!0,xs:12,children:a.jsx(y.Z,{name:"date",label:$.date,value:L?.values?.date,required:!0,onChange:L.setFieldValue,onClear:()=>L.setFieldValue("date",null),readOnly:M||U,error:L.touched.date&&!!L.errors.date,maxAccess:R})}),a.jsx(t(),{item:!0,xs:12,children:a.jsx(f.Z,{endpointId:S.$.Metals.qry,name:"metalId",label:$.purity,valueField:"recordId",displayField:["reference"],values:L.values,onChange:(e,r)=>{L.setFieldValue("metalId",r?.recordId||null),L.setFieldValue("metalPurity",r?.purity||null)},readOnly:M||U,error:L.touched.metalId&&!!L.errors.metalId,maxAccess:R})}),a.jsx(t(),{item:!0,xs:12,children:a.jsx(f.Z,{endpointId:S.$.Group.qry,parameters:"_startAt=0&_pageSize=1000",values:L.values,name:"itemGroupId",required:!0,label:$.itemGroup,valueField:"recordId",displayField:["reference","name"],displayFieldWidth:1,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],readOnly:M||U,maxAccess:R,onChange:(e,r)=>{L.setFieldValue("itemGroupId",r?.recordId||null)},error:L.touched.itemGroupId&&L.errors.itemGroupId})}),a.jsx(t(),{item:!0,xs:12,children:a.jsx(f.Z,{endpointId:A.u.ProductionClass.qry,values:L.values,name:"productionClassId",label:$.productionClass,valueField:"recordId",displayField:"name",maxAccess:R,readOnly:M||U,onChange:(e,r)=>{L.setFieldValue("productionClassId",r?.recordId||null)},error:L.touched.productionClassId&&!!L.errors.productionClassId})}),a.jsx(t(),{item:!0,xs:12,children:a.jsx(f.Z,{endpointId:A.u.ProductionStandard.qry,values:L.values,name:"productionStandardId",label:$.productionStandard,valueField:"recordId",displayField:"reference",maxAccess:R,readOnly:M||U,onChange:(e,r)=>{L.setFieldValue("productionStandardId",r?.recordId||null)},error:L.touched.productionStandardId&&!!L.errors.productionStandardId})}),a.jsx(t(),{item:!0,xs:12,children:a.jsx(f.Z,{endpointId:S.$.Collections.qry,name:"collectionId",label:$.collection,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],maxAccess:R,readOnly:M||U,values:L.values,onChange:(e,r)=>{L.setFieldValue("collectionId",r?.recordId||null)},error:L.touched.collectionId&&!!L.errors.collectionId})})]})}),a.jsx(t(),{item:!0,xs:6,children:(0,a.jsxs)(t(),{container:!0,spacing:2,children:[a.jsx(t(),{item:!0,xs:12,children:a.jsx(c.Z,{ref:q,resourceId:I.i.Sketch,seqNo:0,recordId:e,height:250})}),a.jsx(t(),{item:!0,xs:12,children:a.jsx(f.Z,{endpointId:A.u.ProductionLine.qry,parameters:"_startAt=0&_pageSize=1000",values:L.values,name:"productionLineId",label:$.productionLine,valueField:"recordId",displayField:["reference","name"],maxAccess:R,required:!0,onChange:(e,r)=>{L.setFieldValue("productionLineId",r?.recordId||null)},readOnly:!0,error:L.touched.productionLineId&&L.errors.productionLineId})}),a.jsx(t(),{item:!0,xs:12,children:a.jsx(p.Z,{name:"statusName",label:$.status,readOnly:!0,value:L.values.statusName})}),a.jsx(t(),{item:!0,xs:12,children:a.jsx(j.Z,{name:"notes",type:"text",label:$.notes,value:L.values.notes,readOnly:M||U,rows:3,maxAccess:R,onChange:e=>L.setFieldValue("notes",e.target.value||null),onClear:()=>L.setFieldValue("notes",""),error:L.touched.notes&&!!L.errors.notes})})]})})]})})})})}[o,c,u,m,h,f,C,_]=V.then?(await V)():V,l()}catch(e){l(e)}})}};