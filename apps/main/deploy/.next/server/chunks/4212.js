exports.id=4212,exports.ids=[4212],exports.modules={51613:e=>{e.exports={tabPanel:"CustomTabPanel_tabPanel__80Dfu",active:"CustomTabPanel_active___6Uvb",hidden:"CustomTabPanel_hidden__y9566"}},75716:e=>{e.exports={customTabPanel:"CustomTabs_customTabPanel__Ztocv",hidden:"CustomTabs_hidden__lZpM7",tabsContainer:"CustomTabs_tabsContainer__28Syi",tabsWrapper:"CustomTabs_tabsWrapper__mlxxj",tabs:"CustomTabs_tabs__25pli",tabName:"CustomTabs_tabName__XzMCn",tabRoot:"CustomTabs_tabRoot__WVR1E",tabDisabled:"CustomTabs_tabDisabled__VauYR",selectedTab:"CustomTabs_selectedTab__sZzwF",tabsIndicator:"CustomTabs_tabsIndicator__89Lek",refreshButton:"CustomTabs_refreshButton__P2mzl",refreshIcon:"CustomTabs_refreshIcon__ADVWF"}},25178:(e,a,t)=>{"use strict";t.d(a,{J:()=>n});let s="CO.asmx/",n={CACostTypes:{qry:s+"qryTYP",page:s+"pageTYP",get:s+"getTYP",set:s+"setTYP",del:s+"delTYP"},PuCostAllocations:{qry:s+"qryTRX",page:s+"pageTRX",get:s+"getTRX",set:s+"setTRX",del:s+"delTRX",post:s+"postTRX",unpost:s+"unpostTRX",close:s+"closeTRX",reopen:s+"reopenTRX",snapshot:s+"snapshotTRX"},TrxCostType:{qry:s+"qryTCT",page:s+"pageTCT",get:s+"getTCT",set:s+"setTCT",del:s+"delTCT"},Invoice:{qry:s+"qryIVC",set2:s+"set2IVC"},TrxDstribution:{qry:s+"qryICT"},InvoicesItems:{qry:s+"qryITM"}}},34698:(e,a,t)=>{"use strict";t.d(a,{Z:()=>m});var s=t(20997);t(16689);var n=t(30343),r=t.n(n),l=t(580),o=t.n(l),d=t(51613),c=t.n(d),i=t(82204);let u=e=>{let{children:a,value:t,index:n,maxAccess:l,...o}=e,d=`${e.name||"tab"}.${n}`,{accessLevel:u}=(l?.record?.controls??[]).find(e=>e.controlId===d)??{accessLevel:0};if(u===i.A1)return null;let m=t===n;return s.jsx(r(),{role:"tabpanel",hidden:!m,id:`simple-tabpanel-${n}`,"aria-labelledby":`simple-tab-${n}`,className:`${c().tabPanel} ${m?c().active:c().hidden}`,...o,children:a})};u.propTypes={children:o().node,index:o().number.isRequired,value:o().number.isRequired};let m=u},21061:(e,a,t)=>{"use strict";t.d(a,{Y:()=>y});var s=t(20997),n=t(30343),r=t.n(n),l=t(66800),o=t.n(l),d=t(68514),c=t.n(d),i=t(92189),u=t.n(i),m=t(16689),x=t(49822),f=t(75716),b=t.n(f);let y=({tabs:e,activeTab:a,setActiveTab:t,maxAccess:n,name:l="tab"})=>{let d=n?.record?.controls?.filter(e=>4===e.accessLevel&&e.controlId?.startsWith(`${l}.`)).map(e=>e.controlId.split(".")[1])||[],i=e?.map((e,a)=>({...e,id:a}))?.filter((e,a)=>!d.includes(String(a))),f=i[a]?.id,y=i[a]?.disabled;return(0,m.useEffect)(()=>{f>=0&&!y&&a!=f&&t(f)},[]),s.jsx(r(),{className:b().tabsContainer,children:s.jsx(r(),{className:b().tabsWrapper,children:s.jsx(o(),{value:a,onChange:(e,a)=>t(a),variant:"scrollable",scrollButtons:i.length>3?"auto":"off","aria-label":"scrollable tabs",classes:{indicator:b().tabsIndicator},className:b().tabs,children:i?.map(e=>s.jsx(c(),{value:e.id,disabled:e?.disabled,className:`${b().tabName} ${e.disabled?b().tabDisabled:""}`,classes:{root:b().tabRoot,selected:b().selectedTab},label:s.jsxs(r(),{display:"flex",alignItems:"center",children:[s.jsx("span",{children:e.label}),e.id===a&&e?.onRefetch&&s.jsx(u(),{size:"small",className:b().refreshButton,onClick:a=>{a.stopPropagation(),e.onRefetch()},children:s.jsx(x.Z,{className:b().refreshIcon})})]})},e.id))})})})}},61600:(e,a,t)=>{"use strict";t.a(e,async(e,s)=>{try{t.d(a,{Z:()=>f});var n=t(20997),r=t(16689),l=t(29352),o=t(25178),d=t(40711),c=t(18611),i=t(23385),u=t(38509),m=t(6416),x=e([l,d,u]);[l,d,u]=x.then?(await x)():x;let f=({store:e,labels:a,access:t})=>{let{recordId:s}=e,{getRequest:x}=(0,r.useContext)(l.$),f=[{field:"costTypeRef",headerName:a.costTypeRef,flex:1},{field:"costTypeName",headerName:a.costTypeName,flex:1},{field:"sku",headerName:a.sku,flex:1},{field:"itemName",headerName:a.itemName,flex:1},{field:"baseAmount",headerName:a.baseAmount,flex:1,type:"number"}];async function b(){return await x({extension:o.J.TrxDstribution.qry,parameters:`_recordId=${s}`})}let{query:{data:y}}=(0,u.J)({queryFn:b,endpointId:o.J.TrxDstribution.qry,datasetId:m.i.PuCostAllocation,enabled:!!s});return n.jsx(c.R,{children:n.jsx(i.Q,{children:n.jsx(d.Z,{name:"distributionTable",columns:f,gridData:y,rowId:["recordId"],isLoading:!1,maxAccess:t,pagination:!1})})})};s()}catch(e){s(e)}})},67033:(e,a,t)=>{"use strict";t.a(e,async(e,s)=>{try{t.d(a,{Z:()=>v});var n=t(20997),r=t(16689),l=t(15051),o=t(29352),d=t(86201),c=t(18611),i=t(23385),u=t(95965),m=t(25178),x=t(79390),f=t(13567),b=t(60520),y=t(18687),h=t(93105),I=t(75609),p=e([l,o,d,b,y]);[l,o,d,b,y]=p.then?(await p)():p;let v=({store:e,setStore:a,maxAccess:t,labels:s,editMode:p})=>{let{recordId:v,isPosted:C,isClosed:A}=e,{getRequest:T,postRequest:j}=(0,r.useContext)(o.$),{platformLabels:g}=(0,r.useContext)(b.l),{schema:N,requiredFields:_}=(0,h.m)({invoiceId:e=>e?.invoiceId},!0,t,"items"),{formik:q}=(0,u.c)({validateOnChange:!0,maxAccess:t,conditionSchema:["items"],initialValues:{caId:v,items:[{id:1,caId:v,invoiceId:null,invoiceRef:"",currencyRef:null,date:null,amount:null,baseAmount:null,vendorName:""}]},validationSchema:I.object({items:I.array().of(N)}),onSubmit:async e=>{let t=e.items.filter(e=>Object.values(_)?.every(a=>a(e))).map(({id:e,...a})=>({...a,caId:v,date:(0,x.ku)(a.date)}));await j({extension:m.J.Invoice.set2,record:JSON.stringify({caId:v,items:t})}).then(e=>{d.default.success(g.Edited)}),await T({extension:m.J.InvoicesItems.qry,parameters:`_invoiceId=0&_caId=${v}`}).then(e=>{a(a=>({...a,invoicesItemsData:e}))})}});return(0,r.useEffect)(()=>{v&&T({extension:m.J.Invoice.qry,parameters:`_caId=${v}`}).then(e=>{if(e?.list?.length>0){let a=e.list.map((e,a)=>({...e,id:a+1,date:(0,x.a1)(e.date)}));q.setValues({...q.values,items:a})}})},[]),n.jsx(y.Z,{onSave:q.handleSubmit,maxAccess:t,disabledSubmit:C||A,editMode:p,isParentWindow:!1,children:n.jsx(c.R,{children:n.jsx(i.Q,{children:n.jsx(l._,{onChange:e=>q.setFieldValue("items",e),value:q.values.items,error:q.errors.items,disabled:C||A,allowDelete:!C&&!A,columns:[{component:"resourcelookup",label:s.reference,name:"invoiceId",flex:1,props:{valueField:"reference",displayField:"reference",endpointId:f.y.PurchaseInvoiceHeader.snapshot,mapping:[{from:"recordId",to:"invoiceId"},{from:"reference",to:"invoiceRef"},{from:"currencyRef",to:"currencyRef"},{from:"amount",to:"amount"},{from:"baseAmount",to:"baseAmount"},{from:"vendorName",to:"vendorName"},{from:"date",to:"date"}],columnsInDropDown:[{key:"reference",value:"Reference"}]},onChange({row:{update:e,newRow:a}}){let t=a?.date?(0,x.a1)(a?.date):"";e({date:t})}},{component:"date",name:"date",flex:1,props:{readOnly:!0},width:200}]})})})})};s()}catch(e){s(e)}})},44209:(e,a,t)=>{"use strict";t.a(e,async(e,s)=>{try{t.d(a,{Z:()=>f});var n=t(20997),r=t(16689),l=t(29352),o=t(25178),d=t(40711),c=t(18611),i=t(23385),u=t(6416),m=t(38509),x=e([l,d,m]);[l,d,m]=x.then?(await x)():x;let f=({store:e,labels:a,access:t,setStore:s})=>{let{recordId:x,invoicesItemsData:f}=e,{getRequest:b}=(0,r.useContext)(l.$),y=[{field:"sku",headerName:a.sku,flex:1},{field:"itemName",headerName:a.name,flex:1},{field:"qty",headerName:a.qty,flex:1,type:"number"},{field:"netPrice",headerName:a.netPrice,flex:1,type:"number"}];async function h(){let e=await b({extension:o.J.InvoicesItems.qry,parameters:`_invoiceId=0&_caId=${x}`});return s(a=>({...a,invoicesItemsData:e?.count==0?f:e})),e}let{query:{data:I}}=(0,m.J)({queryFn:h,endpointId:o.J.InvoicesItems.qry,datasetId:u.i.PuCostAllocation,enabled:!!x});return n.jsx(c.R,{children:n.jsx(i.Q,{children:n.jsx(d.Z,{name:"invoicesItemsTable",columns:y,gridData:f,rowId:["recordId"],isLoading:!1,maxAccess:t,pagination:!1})})})};s()}catch(e){s(e)}})},4212:(e,a,t)=>{"use strict";t.a(e,async(e,s)=>{try{t.d(a,{Z:()=>I});var n=t(20997),r=t(34698),l=t(21061),o=t(16689),d=t(6416),c=t(38782),i=t(70706),u=t(67033),m=t(44209),x=t(15169),f=t(61600),b=t(96119),y=e([c,i,u,m,x,f]);[c,i,u,m,x,f]=y.then?(await y)():y;let h=({recordId:e,window:a})=>{let[t,s]=(0,o.useState)(0),[y,h]=(0,o.useState)({recordId:e||null,isPosted:!1,isClosed:!1,baseAmount:0,invoicesItemsData:[]}),{labels:I,access:p}=(0,c.Z)({datasetId:d.i.PuCostAllocation,editMode:!!e});(0,b.Z)({title:I.PuCostAllocations,window:a});let v=[{label:I.TRX},{label:I.invoices,disabled:!y.recordId},{label:I.invoicesItems,disabled:!y.recordId},{label:I.transaction,disabled:!y.recordId},{label:I.distribution,disabled:!y.recordId}];return(0,n.jsxs)(n.Fragment,{children:[n.jsx(l.Y,{tabs:v,activeTab:t,setActiveTab:s,maxAccess:p}),n.jsx(r.Z,{height:670,index:0,value:t,maxAccess:p,children:n.jsx(i.Z,{labels:I,setStore:h,store:y,access:p})}),n.jsx(r.Z,{index:1,value:t,maxAccess:p,children:n.jsx(u.Z,{labels:I,setStore:h,editMode:!!e,store:y,maxAccess:p})}),n.jsx(r.Z,{index:2,value:t,maxAccess:p,children:n.jsx(m.Z,{labels:I,maxAccess:p,setStore:h,store:y})}),n.jsx(r.Z,{index:3,value:t,maxAccess:p,children:n.jsx(x.Z,{store:y,labels:I,access:p,setStore:h})}),n.jsx(r.Z,{index:4,value:t,maxAccess:p,children:n.jsx(f.Z,{labels:I,access:p,store:y})})]})};h.width=800,h.height=500;let I=h;s()}catch(e){s(e)}})},72363:(e,a,t)=>{"use strict";t.a(e,async(e,s)=>{try{t.d(a,{Z:()=>N});var n=t(20997),r=t(99155),l=t.n(r),o=t(16689),d=t(75609),c=t(80582),i=t(86201),u=t(29352),m=t(6416),x=t(79660),f=t(71278),b=t(95965),y=t(23385),h=t(18611),I=t(60520),p=t(25178),v=t(97969),C=t(61274),A=t(91184),T=t(66198),j=t(38509),g=e([c,i,u,f,I,C,j]);function N({labels:e,maxAccess:a,recordId:t,seqNo:s,caId:r,onSubmit:g}){let{getRequest:N}=(0,o.useContext)(u.$),{platformLabels:_}=(0,o.useContext)(I.l),q=(0,j.E)({endpointId:p.J.TrxCostType.qry}),{formik:R}=(0,b.c)({initialValues:{recordId:null,costTypeId:null,caId:r,currencyId:null,accountId:null,functionId:null,baseAmount:0,reference:"",seqNo:null,amount:0},validateOnChange:!1,validationSchema:d.object({baseAmount:d.number().required(),costTypeId:d.number().required(),reference:d.string().test("is-reference-required","reference is required",function(e){return!R.values.functionId||!!e})}),onSubmit:async e=>{let a=await g(e);i.default.success(e.recordId?_.Edited:_.Added),R.setFieldValue("recordId",a.recordId),q()}}),w=!!R.values?.recordId;return n.jsx(c.Z,{resourceId:m.i.PuCostAllocation,form:R,maxAccess:a,editMode:w,isInfo:!1,children:n.jsx(h.R,{children:n.jsx(y.Q,{children:(0,n.jsxs)(l(),{container:!0,spacing:2,children:[n.jsx(l(),{item:!0,xs:6,children:n.jsx(f.Z,{endpointId:p.J.CACostTypes.qry,name:"costTypeId",label:e.costType,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"plant Ref"},{key:"name",value:"Name"}],required:!0,values:R.values,maxAccess:a,onChange:(e,a)=>{R.setFieldValue("costTypeId",a?.recordId||"")},error:R.touched.costTypeId&&!!R.errors.costTypeId})}),n.jsx(l(),{item:!0,xs:6,children:n.jsx(A.Z,{name:"baseAmount",type:"text",label:e.baseAmount,value:R.values.baseAmount,required:!0,readOnly:R.values.functionId,maxAccess:a,onChange:e=>R.setFieldValue("baseAmount",e.target.value),onClear:()=>R.setFieldValue("baseAmount",""),error:R.touched.baseAmount&&!!R.errors.baseAmount,maxLength:10})}),n.jsx(l(),{item:!0,xs:6,children:n.jsx(f.Z,{datasetId:v.v.CA_FNCTN,name:"functionId",label:e.function,valueField:"key",displayField:"value",values:R.values,maxAccess:a,onChange:(e,a)=>{a?R.setFieldValue("functionId",a?.key):R.setValues({...R.values,reference:"",currencyId:null,baseAmount:"",amount:"",accountId:null,accountName:"",accountRef:"",functionId:""})},error:R.touched.functionId&&!!R.errors.functionId})}),n.jsx(l(),{item:!0,xs:6,children:n.jsx(f.Z,{endpointId:x.r.Currency.qry,name:"currencyId",label:e.currency,valueField:"recordId",displayField:["reference","name"],readOnly:!0,values:R.values,maxAccess:a})}),n.jsx(l(),{item:!0,xs:6,children:n.jsx(C.U,{endpointId:T.H.AgingDoc.snapshot,parameters:{_functionId:R.values.functionId},readOnly:!R.values.functionId,required:R.values.functionId,valueField:"reference",displayField:"reference",name:"reference",label:e.reference,form:R,secondDisplayField:!1,onChange:(e,a)=>{R.setValues({...R.values,accountId:a?.accountId||null,accountName:a?.accountName||"",accountRef:a?.accountRef||"",reference:a?.reference||"",currencyId:a?.currencyId||null,baseAmount:a?.baseAmount||null,amount:a?.amount||null,recordId:a?.recordId||null})},error:R.touched.reference&&!!R.errors.reference,maxAccess:a})}),n.jsx(l(),{item:!0,xs:6,children:n.jsx(A.Z,{name:"amount",label:e.amount,value:R.values.amount,maxAccess:a,readOnly:!0,maxLength:10,decimalScale:2})}),n.jsx(l(),{item:!0,xs:12,children:n.jsx(C.U,{endpointId:T.H.Account.snapshot,name:"accountId",label:e.accountRef,valueField:"reference",displayField:"name",valueShow:"accountRef",secondValueShow:"accountName",readOnly:R.values.reference,form:R,onChange:(e,a)=>{R.setFieldValue("accountId",a?.recordId||""),R.setFieldValue("accountRef",a?.reference||""),R.setFieldValue("accountName",a?.name||"")},error:R.touched.accountId&&!!R.errors.accountId,maxAccess:a})})]})})})})}[c,i,u,f,I,C,j]=g.then?(await g)():g,s()}catch(e){s(e)}})},70706:(e,a,t)=>{"use strict";t.a(e,async(e,s)=>{try{t.d(a,{Z:()=>R});var n=t(20997),r=t(99155),l=t.n(r),o=t(16689),d=t(75609),c=t(80582),i=t(86201),u=t(29352),m=t(38509),x=t(6416),f=t(95965),b=t(44619),y=t(71278),h=t(18611),I=t(23385),p=t(60520),v=t(25178),C=t(65980),A=t(79390),T=t(79660),j=t(91184),g=t(27736),N=t(68728),_=t(86794),q=e([c,i,u,m,y,p,_]);function R({labels:e,access:a,setStore:t,store:s}){let{platformLabels:r,userDefaultsData:q}=(0,o.useContext)(p.l),{recordId:R}=s,{getRequest:w,postRequest:Z}=(0,o.useContext)(u.$),k=N.J.CostAllocation,P=(0,m.E)({endpointId:v.J.PuCostAllocations.page}),{documentType:F,maxAccess:J,changeDT:S}=(0,_.H)({functionId:k,access:a,enabled:!R}),{formik:D}=(0,f.c)({initialValues:{recordId:null,plantId:null,baseAmount:0,notes:"",wip:1,dtId:null,reference:"",status:1,releaseStatus:null,date:new Date},maxAccess:J,documentType:{key:"dtId",value:F?.dtId},validateOnChange:!1,validationSchema:d.object({reference:d.string().required(),date:d.string().required()}),onSubmit:async e=>{let a={...e,date:(0,A.ku)(e.date)};await Z({extension:v.J.PuCostAllocations.set,record:JSON.stringify(a)}).then(e=>{L(e.recordId),i.default.success(V?r.Edited:r.Added),P()})}}),V=!!D.values.recordId,O=2===D.values.wip,$=3===D.values.status;async function L(e){await w({extension:v.J.PuCostAllocations.get,parameters:`_recordId=${e}`}).then(a=>{t(t=>({...t,recordId:e,isPosted:a?.record?.status===3,isClosed:a?.record?.wip===2,result:a?.record})),D.setValues({...a.record,date:(0,A.a1)(a?.record?.date)})})}let X=async()=>{let e={...D.values,date:(0,A.ku)(D.values.date)};await Z({extension:v.J.PuCostAllocations.post,record:JSON.stringify(e)}).then(async()=>{await L(e.recordId),i.default.success(r.Posted),P()})},E=async()=>{let e={...D.values,date:(0,A.ku)(D.values.date)};await Z({extension:v.J.PuCostAllocations.unpost,record:JSON.stringify(e)}).then(async e=>{await L(e.recordId),i.default.success(r.Unposted),P()})};async function M(){let e={...D.values,date:(0,A.ku)(D.values.date)};await Z({extension:v.J.PuCostAllocations.close,record:JSON.stringify(e)}).then(async e=>{await L(e.recordId),i.default.success(r.Closed),P()})}async function Y(){let e={...D.values,date:(0,A.ku)(D.values.date)};await Z({extension:v.J.PuCostAllocations.reopen,record:JSON.stringify(e)}).then(async e=>{await L(e.recordId),i.default.success(r.Reopened),P()})}let W=[{key:"GL",condition:!0,onClick:"onClickGL",datasetId:x.i.GLPuCostAllocation,disabled:!V},{key:"IV",condition:!0,onClick:"onInventoryTransaction",disabled:!V||!$},{key:"Close",condition:!O,onClick:M,disabled:!V||$},{key:"Reopen",condition:O,onClick:Y,disabled:!V||$},{key:"Unlocked",condition:!$,onClick:X,disabled:!V||!O},{key:"Locked",condition:$,onClick:"onUnpostConfirmation",onSuccess:E,disabled:!V||!O},{key:"Attachment",condition:!0,onClick:"onClickAttachment",disabled:!V}];return n.jsx(c.Z,{resourceId:x.i.PuCostAllocation,functionId:k,form:D,maxAccess:J,editMode:V,actions:W,disabledSubmit:O,children:n.jsx(h.R,{children:n.jsx(I.Q,{children:(0,n.jsxs)(l(),{container:!0,spacing:2,children:[n.jsx(l(),{item:!0,xs:6,children:n.jsx(y.Z,{endpointId:T.r.DocumentType.qry,parameters:`_startAt=0&_pageSize=1000&_dgId=${k}`,name:"dtId",label:e.doctype,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],valueField:"recordId",displayField:["reference","name"],values:D.values,maxAccess:J,onChange:(e,a)=>{D.setFieldValue("dtId",a?.recordId||""),S(a)},readOnly:V,error:D.touched.dtId&&!!D.errors.dtId})}),n.jsx(l(),{item:!0,xs:6,children:n.jsx(y.Z,{endpointId:T.r.Plant.qry,name:"plantId",label:e.plant,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"plant Ref"},{key:"name",value:"Name"}],values:D.values,maxAccess:J,onChange:(e,a)=>{D.setFieldValue("plantId",a?.recordId||"")},readOnly:O,error:D.touched.plantId&&!!D.errors.plantId})}),n.jsx(l(),{item:!0,xs:6,children:n.jsx(b.Z,{name:"reference",label:e.reference,value:D.values.reference,rows:2,maxAccess:J,onChange:D.handleChange,readOnly:V,onClear:()=>D.setFieldValue("reference",""),error:D.touched.reference&&!!D.errors.reference})}),n.jsx(l(),{item:!0,xs:6,children:n.jsx(j.Z,{name:"baseAmount",label:e.amount,value:D.values?.baseAmount,maxAccess:J,readOnly:!0,decimalScale:2})}),n.jsx(l(),{item:!0,xs:6,children:n.jsx(g.Z,{name:"date",required:!0,label:e.date,value:D?.values?.date,onChange:D.setFieldValue,editMode:V,maxAccess:J,onClear:()=>D.setFieldValue("date",null),readOnly:O,error:D.touched.date&&!!D.errors.date})}),n.jsx(l(),{item:!0,xs:6,children:n.jsx(C.Z,{name:"notes",label:e.notes,value:D.values.notes,maxLength:"100",rows:2,maxAccess:J,onChange:D.handleChange,readOnly:O,onClear:()=>D.setFieldValue("notes",""),error:D.touched.notes&&!!D.errors.notes})})]})})})})}[c,i,u,m,y,p,_]=q.then?(await q)():q,s()}catch(e){s(e)}})},15169:(e,a,t)=>{"use strict";t.a(e,async(e,s)=>{try{t.d(a,{Z:()=>T});var n=t(20997),r=t(16689),l=t(29352),o=t(25178),d=t(99155),c=t.n(d),i=t(86201),u=t(40711),m=t(18611),x=t(23385),f=t(42020),b=t(91184),y=t(60520),h=t(24644),I=t(677),p=t(38509),v=t(6416),C=t(72363),A=e([l,i,u,y,h,I,p,C]);[l,i,u,y,h,I,p,C]=A.then?(await A)():A;let T=({store:e,labels:a,access:t,setStore:s})=>{let{platformLabels:d}=(0,r.useContext)(y.l),{recordId:A,isClosed:T}=e,{getRequest:j,postRequest:g}=(0,r.useContext)(l.$),{stack:N}=(0,I.zY)(),_=(0,r.useRef)([]),{query:{data:q},invalidate:R}=(0,p.J)({queryFn:Z,endpointId:o.J.TrxCostType.qry,datasetId:v.i.PuCostAllocation,enabled:!!A}),w=[{field:"costTypeName",headerName:a.costType,flex:1},{field:"baseAmount",headerName:a.baseAmount,flex:1,type:"number"},{field:"accountRef",headerName:a.accountRef,flex:1},{field:"accountName",headerName:a.accountName,flex:1},{field:"currencyRef",headerName:a.currency,flex:1},{field:"amount",headerName:a.amount,flex:1,type:"number"}];async function Z(){return await j({extension:o.J.TrxCostType.qry,parameters:`_caId=${A}`})}let k=async e=>{await g({extension:o.J.TrxCostType.del,record:JSON.stringify(e)}),R(),F(q.list.filter(a=>a.seqNo!==e.seqNo)),i.default.success(d.Deleted)},P=(0,p.E)({endpointId:o.J.PuCostAllocations.page});async function F(a){let t=a?.reduce((e,a)=>e+parseFloat(a.baseAmount)||0,0);return await g({extension:o.J.PuCostAllocations.set,record:JSON.stringify({...e?.result,baseAmount:t})}),s(e=>({...e,result:{...e?.result,baseAmount:t}})),P(),!0}async function J(e){let a;let t=_.current||[],s=t.findIndex(a=>a.seqNo===e.seqNo);if(s>-1){let n=t.slice();n[s]=e,a=n}else a=[...t,e];e.seqNo=e.seqNo??t?.reduce((e,a)=>Math.max(e,a.seqNo),0)+1;let n=await g({extension:o.J.TrxCostType.set,record:JSON.stringify(e)});return F(a),n}function S(e){N({Component:C.Z,props:{labels:a,recordId:e?.caId,caId:A,seqNo:e?.seqNo,onSubmit:J,maxAccess:t},width:600,height:400,title:a.transaction})}(0,r.useEffect)(()=>{_.current=q?.list??[]},[q]);let D=q?q.list.reduce((e,a)=>e+a.baseAmount,0):0;return(0,n.jsxs)(m.R,{children:[n.jsx(f.g,{children:n.jsx(h.Z,{maxAccess:t,labels:a,onAdd:()=>{S()},disableAdd:T})}),n.jsx(x.Q,{children:n.jsx(u.Z,{name:"transactionTable",columns:w,gridData:q,rowId:["recordId"],isLoading:!1,onDelete:T?null:k,onEdit:T?null:e=>{S(e)},maxAccess:t,pagination:!1})}),n.jsx(f.g,{children:n.jsx(c(),{container:!0,justifyContent:"flex-end",sx:{p:2},children:n.jsx(c(),{item:!0,xs:3,children:n.jsx(b.Z,{name:"baseAmounts",label:a.totalBaseAmounts,value:D,readOnly:!0})})})})]})};s()}catch(e){s(e)}})}};