"use strict";exports.id=95502,exports.ids=[95502],exports.modules={68624:(e,r,a)=>{a.d(r,{Z:()=>o});var n=a(79660);a(6416);var t=a(82204),d=a(75281);let l=async(e,r,a)=>{try{let n=await e({extension:r,parameters:a});return r.includes("qry")?n:n.record}catch(e){return null}},s=(e,r,a,n)=>{let d=(e=JSON.parse(JSON.stringify(e))).record.controls,l=d.find(e=>"reference"===e.controlId);return l?l.accessLevel=r?.mandatory?t.$7:t.rr:r?.mandatory?d.push({sgId:0,resourceId:"",controlId:`${n?n+".":""}reference`,accessLevel:r?.mandatory?t.$7:t.rr}):r?.readOnly?d.push({sgId:0,resourceId:"",controlId:`${n?n+".":""}reference`,accessLevel:r?.readOnly?t.rr:t.$7}):d=e.record.controls.filter(e=>"reference"!=e.controlId),a&&d.push({sgId:0,resourceId:"",controlId:`${n?n+".":""}dtId`,accessLevel:t.$7}),{...e,record:{...e.record,controls:d}}},i=async(e,r,a)=>{let t,s;switch(a){case"dtId":let i=(0,d.m)("userData"),o=i?.userId;s=`_userId=${o}&_functionId=${r}`,t=n.r.UserFunction.get;break;case"glbSysNumberRange":s=`_recordId=${r}`,t=n.r.SystemFunction.get;break;case"DocumentType":s=`_dgId=${r}&_startAt=0&_pageSize=50`,t=n.r.DocumentType.qry;break;case"DcTypNumberRange":s=`_recordId=${r}`,t=n.r.DocumentType.get;break;case"isExternal":s=`_recordId=${r}`,t=n.r.NumberRange.get;break;default:return null}return await l(e,t,s)},o=async(e,r,a,n,t=!0,d)=>{let l,o,c,u;let m=void 0===n&&r&&await i(e,r,"dtId"),h=m?.dtId,I="",y=!0;if(m&&void 0===n||"nraId"===n){if(h){let r=await i(e,h,"DcTypNumberRange");l=r?.nraId,y=!(r?.activeStatus<0),l||(I="Assign the document type to a number range")}if((!h||!y)&&t&&r){let a=await i(e,r,"DocumentType");u=a?.list?.filter(e=>e?.activeStatus===1).length>0}}if(("nraId"===n||void 0===n)&&r){if((!h||h)&&!l||l&&!y){let a=await i(e,r,"glbSysNumberRange");(l=a?.nraId)&&u&&(u=!1),y=!0}I=l||u?"":"Assign the system Function to a number range"}n>0&&!l&&(l=n),l&&y?(c=await i(e,l,"isExternal"),o={readOnly:!c?.external,mandatory:!!c?.external},a&&(a=await s(a,o,u,d))):!l&&a&&(a=await s(a,o,u,d));let x=d?`${d}.reference`:"reference";return{dtId:h,resetReference:o?.readOnly,dcTypeRequired:u,reference:{fieldName:x,isEmpty:!(c?.external===void 0||c?.external)},errorMessage:I,maxAccess:a,selectNraId:n}}},75281:(e,r,a)=>{a.d(r,{m:()=>n});let n=e=>{let r=window.sessionStorage.getItem(e);return r?JSON.parse(r):null}},86794:(e,r,a)=>{a.a(e,async(e,n)=>{try{a.d(r,{G:()=>c,H:()=>u});var t=a(49752),d=a(16689),l=a(70305),s=a(68624),i=a(29352),o=e([t,l,i]);function c({functionId:e,action:r,hasDT:a}){let{getRequest:n}=(0,d.useContext)(i.$),{stack:t}=(0,l.V)();return{proxyAction:async()=>{let d=await (0,s.Z)(n,e,"",void 0,a);d?.errorMessage?t({message:d?.errorMessage}):await r()}}}function u({functionId:e,access:r,hasDT:a,enabled:n=!0,objectName:o=""}){let{getRequest:c}=(0,d.useContext)(i.$),{stack:u}=(0,l.V)(),[m,h]=(0,d.useState)(),I=async n=>{let t=await (0,s.Z)(c,e,r,n,a,o);if(!t.errorMessage)return t;u({message:t?.errorMessage})},y=(0,t.useQuery)({retry:!1,staleTime:0,enabled:n,queryKey:[e,m,!!r,n],queryFn:m||"nraId"===m?()=>I(m):()=>I()});return{documentType:y.data,maxAccess:y?.data?.maxAccess||r,changeDT(e){h(e?.nraId||"nraId")}}}[t,l,i]=o.then?(await o)():o,n()}catch(e){n(e)}})},95502:(e,r,a)=>{a.a(e,async(e,n)=>{try{a.d(r,{Z:()=>P});var t=a(20997),d=a(99155),l=a.n(d),s=a(16689),i=a(75609),o=a(80582),c=a(528),u=a(86201),m=a(29352),h=a(38509),I=a(6416),y=a(44619),x=a(95965),g=a(60520),p=a(18611),f=a(27736),v=a(71278),D=a(79660),b=a(68728),F=a(65980),j=a(86794),C=a(79390),w=a(42020),O=a(96995),R=a(59636),S=a(61274),V=a(91184),N=a(76788),A=a(86593),Z=a(85960),k=a(677),L=a(96119),G=a(38782),$=e([o,c,u,m,h,g,v,j,S,Z,k,G]);function P({recordId:e,window:r}){let{getRequest:a,postRequest:n}=(0,s.useContext)(m.$),{platformLabels:d}=(0,s.useContext)(g.l),$=(0,s.useRef)(null),P=b.J.ThreeDPrint,{stack:q}=(0,k.zY)(),{labels:T,access:_}=(0,G.Z)({datasetId:I.i.Printing,editMode:!!e}),{documentType:z,maxAccess:M,changeDT:J}=(0,j.H)({functionId:P,access:_,enabled:!e});(0,L.Z)({title:d.threeDPrinting,window:r});let E=(0,h.E)({endpointId:O.z.Printing.page}),{formik:U}=(0,x.c)({documentType:{key:"dtId",value:z?.dtId},initialValues:{recordId:null,reference:"",dtId:null,date:new Date,threeDDId:null,fileReference:"",setPcs:null,weight:null,machineId:null,startDate:null,endDate:null,notes:"",jobId:null,productionClassId:null,productionLineId:null,collectionId:null,productionStandardRef:"",designGroupId:null,designFamilyId:null,designerName:"",metalRef:"",collectionName:"",itemGroupName:"",density:null,nbOfLayers:null,status:1,wip:1},maxAccess:M,validateOnChange:!0,validationSchema:i.object({date:i.date().required(),threeDDId:i.number().required(),machineId:i.number().required(),setPcs:i.number().nullable()}),onSubmit:async e=>{let r={...e,date:(0,C.ku)(e?.date)},a=await n({extension:O.z.Printing.set,record:JSON.stringify(r)});$.current&&($.current.value=a.recordId,await $.current.submit()),W(a.recordId),E(),u.default.success(e.recordId?d.Added:d.Edited)}}),H=3===U.values.status,K=4==U.values.status,Q=!!U.values.recordId;async function W(e){let r=await a({extension:O.z.Printing.get,parameters:`_recordId=${e}`});U.setValues({...r.record,date:(0,C.a1)(r?.record?.date),startDate:(0,C.a1)(r?.record?.startDate),endDate:(0,C.a1)(r?.record?.endDate)})}let Y=async()=>{let e={...U.values,date:(0,C.ku)(U.values?.date)};await n({extension:O.z.Printing.post,record:JSON.stringify(e)}),W(U.values.recordId),u.default.success(d.Posted),E()};async function B(e){let r=await a({extension:A.C.getLabels,parameters:`_dataset=${e}`});return r.list?Object.fromEntries(r.list.map(({key:e,value:r})=>[e,r])):{}}let X=[{key:"Locked",condition:!0,onClick:Y,disabled:!Q||H||!K},{key:"threeDDesign",condition:!0,onClick:async()=>{let e=await B(I.i.ThreeDDesign);q({Component:Z.Z,props:{recordId:U.values?.threeDDId,labels:e},width:1200,height:700,title:e.ThreeDDesign})},disabled:!U.values.threeDDId},{key:"Start",condition:!0,onClick:ee,disabled:!Q||H||K}];async function ee(){let e={...U.values,date:(0,C.ku)(U.values?.date)},r=await n({extension:O.z.Printing.start,record:JSON.stringify(e)});u.default.success(d.Started),E(),W(r.recordId)}let er=async e=>await a({extension:O.z.ThreeDDrawing.get,parameters:`_recordId=${e}`});return t.jsx(o.Z,{resourceId:I.i.Printing,form:U,maxAccess:M,editMode:Q,actions:X,functionId:P,disabledSubmit:H,children:t.jsx(p.R,{children:t.jsx(w.g,{children:(0,t.jsxs)(l(),{container:!0,spacing:2,children:[t.jsx(l(),{item:!0,xs:6,children:(0,t.jsxs)(l(),{container:!0,spacing:2,children:[t.jsx(l(),{item:!0,xs:12,children:t.jsx(v.Z,{endpointId:D.r.DocumentType.qry,parameters:`_dgId=${P}&_startAt=0&_pageSize=50`,filter:Q?void 0:e=>1===e.activeStatus,name:"dtId",label:T.documentType,readOnly:Q,valueField:"recordId",displayField:"name",values:U?.values,onChange:async(e,r)=>{U.setFieldValue("dtId",r?.recordId||null),J(r),r?.recordId||U.setFieldValue("productionLineId",null)},error:U.touched.dtId&&!!U.errors.dtId,maxAccess:M})}),t.jsx(l(),{item:!0,xs:12,children:t.jsx(y.Z,{name:"reference",label:T.reference,value:U?.values?.reference,readOnly:Q,maxAccess:!Q&&M,onChange:U.handleChange,onClear:()=>U.setFieldValue("reference",""),error:U.touched.reference&&!!U.errors.reference})}),t.jsx(l(),{item:!0,xs:12,children:t.jsx(S.U,{endpointId:R.u.MFJobOrder.snapshot,valueField:"reference",displayField:"reference",secondDisplayField:!1,name:"jobId",label:T.jobOrder,form:U,valueShow:"jobRef",maxAccess:M,editMode:Q,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"itemName",value:"Item Name"}],readOnly:H||K,onChange:(e,r)=>{U.setFieldValue("jobId",r?.recordId||null),U.setFieldValue("jobRef",r?.reference||"")},errorCheck:"jobId"})}),t.jsx(l(),{item:!0,xs:12,children:t.jsx(S.U,{endpointId:O.z.ThreeDDrawing.snapshot3DD2,parameters:{_productionLineId:U.values.productionLineId||0},valueField:"reference",displayField:"reference",secondDisplayField:!1,name:"threeDDId",label:T.threeDD,form:U,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"date",value:"Date",type:"date"},{key:"designerRef",value:"Designer"}],valueShow:"threeDDRef",maxAccess:M,readOnly:H||K,required:!0,onChange:async(e,r)=>{if(U.setFieldValue("threeDDRef",r?.reference||""),U.setFieldValue("fileReference",r?.fileReference||""),U.setFieldValue("designerName",r?.designerName||""),U.setFieldValue("designerId",r?.designerId||""),U.setFieldValue("productionClassId",r?.productionClassId||null),U.setFieldValue("productionStandardId",r?.productionStandardId||null),U.setFieldValue("productionStandardRef",r?.productionStandardRef||""),U.setFieldValue("metalRef",r?.metalRef||""),U.setFieldValue("metalId",r?.metalId||null),U.setFieldValue("collectionName",r?.collectionName||""),U.setFieldValue("collectionId",r?.collectionId||null),U.setFieldValue("itemGroupName",r?.itemGroupName||""),U.setFieldValue("itemGroupId",r?.itemGroupId||null),r?.recordId){let e=await er(r?.recordId);U.setFieldValue("designFamilyId",e?.record?.designFamilyId||null),U.setFieldValue("designGroupId",e?.record?.designGroupId||null)}U.setFieldValue("threeDDId",r?.recordId||null)},errorCheck:"threeDDId"})}),t.jsx(l(),{item:!0,xs:12,children:t.jsx(v.Z,{endpointId:R.u.DesignFamily.qry,name:"designFamilyId",label:T.familyGroup,valueField:"recordId",displayField:"name",values:U.values,readOnly:!0,onChange:(e,r)=>U.setFieldValue("designFamilyId",r?.recordId||null),error:U?.touched?.designFamilyId&&!!U?.errors?.designFamilyId,maxAccess:M})}),t.jsx(l(),{item:!0,xs:12,children:t.jsx(v.Z,{endpointId:R.u.DesignGroup.qry,name:"designGroupId",label:T.designGroup,valueField:"recordId",displayField:"name",values:U.values,readOnly:!0,onChange:(e,r)=>U.setFieldValue("designGroupId",r?.recordId||null),error:U?.touched?.designGroupId&&!!U?.errors?.designGroupId,maxAccess:M})}),t.jsx(l(),{item:!0,xs:12,children:t.jsx(f.Z,{name:"date",required:!0,label:T.date,readOnly:H||K,value:U?.values?.date,onChange:U.setFieldValue,maxAccess:M,onClear:()=>U.setFieldValue("date",""),error:U.touched.date&&!!U.errors.date})}),t.jsx(l(),{item:!0,xs:12,children:t.jsx(N.Z,{name:"startDate",label:T.startDate,value:U.values?.startDate,readOnly:!0})}),t.jsx(l(),{item:!0,xs:12,children:t.jsx(N.Z,{name:"endDate",label:T.endDate,value:U.values?.endDate,readOnly:!0})}),t.jsx(l(),{item:!0,xs:12,children:t.jsx(v.Z,{endpointId:R.u.Machine.qry,name:"machineId",label:T.machine,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:U.values,onChange:(e,r)=>{U.setFieldValue("machineId",r?.recordId||null)},required:!0,readOnly:H||K,error:U.touched.machineId&&!!U.errors.machineId,maxAccess:M})}),t.jsx(l(),{item:!0,xs:12,children:t.jsx(v.Z,{endpointId:R.u.ProductionLine.qry,parameters:"_startAt=0&_pageSize=1000",values:U.values,name:"productionLineId",label:T.productionLine,valueField:"recordId",displayField:["reference","name"],displayFieldWidth:1,maxAccess:M,readOnly:!0,error:U.touched.productionLineId&&U.errors.productionLineId})}),t.jsx(l(),{item:!0,xs:12,children:t.jsx(v.Z,{endpointId:R.u.ProductionClass.qry,values:U.values,name:"productionClassId",label:T.productionClass,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],maxAccess:M,readOnly:H||K,onChange:(e,r)=>{U.setFieldValue("productionClassId",r?.recordId||null)},error:U.touched.productionClassId&&!!U.errors.productionClassId})}),t.jsx(l(),{item:!0,xs:12,children:t.jsx(V.Z,{name:"nbOfLayers",label:T.nbOfLayers,value:U.values.nbOfLayers,maxAccess:M,maxLength:4,decimalScale:0,readOnly:H,onChange:U.handleChange,onClear:()=>U.setFieldValue("nbOfLayers",""),error:U.touched.nbOfLayers&&!!U.errors.nbOfLayers})}),t.jsx(l(),{item:!0,xs:12,children:t.jsx(V.Z,{name:"density",label:T.density,value:U.values.density,maxAccess:M,readOnly:H,maxLength:9,decimalScale:3,onChange:U.handleChange,onClear:()=>U.setFieldValue("density",null),error:U.touched.density&&!!U.errors.density})}),t.jsx(l(),{item:!0,xs:12,children:t.jsx(V.Z,{name:"setPcs",label:T.pieces,value:U.values.setPcs,maxAccess:M,readOnly:H,maxLength:4,decimalScale:0,onChange:U.handleChange,onClear:()=>U.setFieldValue("setPcs",null),error:U.touched.setPcs&&!!U.errors.setPcs})}),t.jsx(l(),{item:!0,xs:12,children:t.jsx(V.Z,{name:"weight",label:T.weight,value:U.values.weight,maxAccess:M,readOnly:H,onChange:U.handleChange,maxLength:8,decimalScale:2,onClear:()=>U.setFieldValue("weight",null),error:U.touched.weight&&!!U.errors.weight})})]})}),t.jsx(l(),{item:!0,xs:6,children:(0,t.jsxs)(l(),{container:!0,spacing:2,children:[t.jsx(l(),{item:!0,xs:12,children:t.jsx(c.Z,{ref:$,resourceId:I.i.Printing,seqNo:0,recordId:e,height:250})}),t.jsx(l(),{item:!0,xs:12,children:t.jsx(y.Z,{name:"fileReference",label:T.threeDDFile,value:U.values.fileReference,maxAccess:M,onChange:U.handleChange,readOnly:H,onClear:()=>U.setFieldValue("fileReference",""),error:U.touched.fileReference&&!!U.errors.fileReference})}),t.jsx(l(),{item:!0,xs:12,children:t.jsx(y.Z,{name:"designerName",label:T.designer,value:U.values.designerName,maxAccess:M,readOnly:!0,error:U.touched.designerName&&!!U.errors.designerName})}),t.jsx(l(),{item:!0,xs:12,children:t.jsx(y.Z,{name:"productionStandardRef",label:T.productionStandard,value:U.values.productionStandardRef,maxAccess:M,readOnly:!0,error:U.touched.productionStandardRef&&!!U.errors.productionStandardRef})}),t.jsx(l(),{item:!0,xs:12,children:t.jsx(y.Z,{name:"metalRef",label:T.purity,value:U.values.metalRef,maxAccess:M,readOnly:!0,error:U.touched.metalRef&&!!U.errors.metalRef})}),t.jsx(l(),{item:!0,xs:12,children:t.jsx(y.Z,{name:"collectionName",label:T.collection,value:U.values.collectionName,maxAccess:M,readOnly:!0,error:U.touched.collectionName&&!!U.errors.collectionName})}),t.jsx(l(),{item:!0,xs:12,children:t.jsx(y.Z,{name:"itemGroupName",label:T.itemGroup,value:U.values.itemGroupName,maxAccess:M,readOnly:!0,error:U.touched.itemGroupName&&!!U.errors.itemGroupName})}),t.jsx(l(),{item:!0,xs:12,children:t.jsx(F.Z,{name:"notes",type:"text",label:T.notes,value:U.values.notes,readOnly:H,rows:3,maxAccess:M,onChange:e=>U.setFieldValue("notes",e.target.value||null),onClear:()=>U.setFieldValue("notes",""),error:U.touched.notes&&!!U.errors.notes})})]})})]})})})})}[o,c,u,m,h,g,v,j,S,Z,k,G]=$.then?(await $)():$,P.width=750,P.height=650,n()}catch(e){n(e)}})}};