"use strict";exports.id=20936,exports.ids=[20936],exports.modules={70208:(e,t,a)=>{a.a(e,async(e,d)=>{try{a.d(t,{Z:()=>w});var s=a(20997),l=a(40711),r=a(99155),n=a.n(r),i=a(95965),u=a(71278),o=a(18611),c=a(23385),m=a(16689),p=a(29352),I=a(79660),y=a(97996),x=a(42020),v=a(61274),h=a(44619),f=a(60520),b=a(96119),F=a(18687),A=a(70755),g=a(38509),P=a(6416),V=e([l,u,p,v,f,F,g]);function w({labels:e,shipment:t=!1,bill:a=!1,deliveryOrder:d=!1,form:r,handleAddressValues:V,checkedAddressId:w,window:D}){let{getRequest:C}=(0,m.useContext)(p.$),{platformLabels:k}=(0,m.useContext)(f.l);(0,b.Z)({title:k.AddressFilter,window:D});let{formik:T}=(0,i.c)({initialValues:{search:"",cityId:null,countryId:null},validateOnChange:!0,onSubmit:async()=>{let e=O?.list?.find(e=>e.checked);if(!e?.addressId){V({shipAddress:"",BillAddress:"",address:""}),D.close();return}if(t||a||d){let s=await j(e?.addressId);t&&V({shipAddress:s,shipAddressId:e?.addressId,shipToAddressId:e?.addressId}),a&&V({billAddress:s,billAddressId:e?.addressId,billToAddressId:e?.addressId}),d&&V({address:s,addressId:e?.addressId})}D.close()}});async function j(e){if(!e)return;let t=await C({extension:I.r.Address.format,parameters:`_addressId=${e}`});return t?.record?.formattedAddress.replace(/(\r\n|\r|\n)+/g,"\r\n")}let S=async(e={})=>{let{_startAt:t=0,_pageSize:a=50}=e,d=!!T.values.search&&!!T.values.countryId&&!!T.values.cityId&&!!r.clientId,s=await C({extension:d?y.P.FilterAddress.snapshot:y.P.Address.page,parameters:d?`_countryId=${T.values.countryId}&_cityId=${T.values.cityId}&_clientId=${r.clientId}&_filter=${T.values.search}`:`_startAt=${t}&_pageSize=${a}&_params=1|${r.clientId}`}),l=s?.list?.map(e=>({addressId:e.addressId||e.recordId,address:e.formattedAddress??`${e.name||""}, ${e.street1||""}, ${e.street2||""}, ${e.city||""}, ${e.phone||""},${e.phone2||""},${e.email1||""}`,checked:(e.addressId||e.recordId)===w}))||[];return{list:l,_startAt:t,count:l.length}},{query:{data:O},paginationParameters:Z,refetch:$}=(0,g.J)({queryFn:S,endpointId:y.P.Address.page,datasetId:P.i.Address});return s.jsx(F.Z,{onSave:T.handleSubmit,children:(0,s.jsxs)(o.R,{children:[s.jsx(x.g,{children:(0,s.jsxs)(n(),{container:!0,spacing:2,children:[s.jsx(n(),{item:!0,xs:12,children:s.jsx(u.Z,{endpointId:I.r.Country.qry,name:"countryId",label:e.country,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:T.values,onChange:(e,t)=>{T.setFieldValue("cityId",""),T.setFieldValue("countryId",t?.recordId||null)}})}),s.jsx(n(),{item:!0,xs:12,children:s.jsx(v.U,{endpointId:I.r.City.snapshot,parameters:{_countryId:T.values.countryId,_stateId:0},valueField:"name",displayField:"name",name:"city",label:e.city,form:T,secondDisplayField:!1,onChange:(e,t)=>{T.setFieldValue("cityId",t?.recordId||null),T.setFieldValue("city",t?.name||null)}})}),s.jsx(n(),{item:!0,xs:6,children:s.jsx(h.Z,{name:"search",value:T.values.search,label:e.search,onClear:()=>{T.setFieldValue("search","")},onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),e.stopPropagation())},onChange:T.handleChange})}),s.jsx(n(),{item:!0,xs:2,children:s.jsx(A.Z,{label:e.apply,onClick:$,disabled:!(T.values.countryId&&T.values.cityId)})})]})}),s.jsx(c.Q,{children:s.jsx(l.Z,{name:"addressFilterTable",columns:[{field:"address",headerName:"",flex:6}],gridData:O,rowId:["addressId"],pageSize:50,paginationType:"api",paginationParameters:Z,checkTitle:"",checkboxFlex:1,rowSelection:"single",showCheckboxColumn:!0,viewCheckButtons:!0})})]})})}[l,u,p,v,f,F,g]=V.then?(await V)():V,w.width=950,w.height=600,d()}catch(e){d(e)}})},20936:(e,t,a)=>{a.a(e,async(e,d)=>{try{a.d(t,{Z:()=>K});var s=a(20997),l=a(27736),r=a(79390),n=a(99155),i=a.n(n),u=a(16689),o=a(75609),c=a(80582),m=a(86201),p=a(29352),I=a(38509),y=a(6416),x=a(44619),v=a(65980),h=a(71278),f=a(79660),b=a(54242),F=a(68728),A=a(61274),g=a(23385),P=a(15051),V=a(18611),w=a(42020),D=a(91184),C=a(97996),k=a(95965),T=a(70638),j=a(677),S=a(60520),O=a(82173),Z=a(57629),$=a(42614),N=a(70208),q=a(70305),R=a(86794),_=a(75217),L=a(67906),W=a(24356),z=a(93105),B=a(38782),Q=a(96119),J=a(44719),M=a(59636),E=a(45516),U=e([c,m,p,I,h,A,P,T,j,S,N,q,R,_,W,B,J,E]);[c,m,p,I,h,A,P,T,j,S,N,q,R,_,W,B,J,E]=U.then?(await U)():U;let X=({recordId:e,currency:t,window:d})=>{let{getRequest:n,postRequest:U}=(0,u.useContext)(p.$),{stack:X}=(0,j.zY)(),{stack:K}=(0,q.V)(),{platformLabels:Y,defaultsData:G,userDefaultsData:H}=(0,u.useContext)(S.l),[ee,et]=(0,u.useState)({text:"%",value:2}),[ea,ed]=(0,u.useState)({}),es=(0,u.useRef)([]),[el,er]=(0,u.useState)([]),[en,ei]=(0,u.useState)(!1),[eu,eo]=(0,u.useState)({userDefaultsList:{},systemDefaultsList:{}}),ec=(0,u.useRef)({}),{labels:em,access:ep}=(0,B.Z)({datasetId:y.i.SalesOrder,editMode:!!e});(0,Q.Z)({title:em.salesOrder,window:d});let eI=G?.list?.find(({key:e})=>"allowSalesNoLinesTrx"===e)?.value=="true",{documentType:ey,maxAccess:ex,changeDT:ev}=(0,R.H)({functionId:F.J.SalesOrder,access:ep,enabled:!e});async function eh(e){if(!e)return null;let t=await n({extension:C.P.SalesPerson.get,parameters:`_recordId=${e}`}),a=t?.record;return!a||a.isInactive?null:e}let ef={recordId:e,dtId:null,reference:"",date:new Date,dueDate:new Date,plantId:null,clientId:"",currencyId:parseInt(t),szId:"",spId:null,siteId:null,description:"",status:1,releaseStatus:"",wip:1,deliveryStatus:1,printStatusName:"",isVattable:!1,exWorks:!1,taxId:"",shipAddress:"",billAddress:"",subtotal:"",miscAmount:0,amount:0,vatAmount:"",tdAmount:0,overdraft:!1,plId:"",ptId:"",billToAddressId:"",shipToAddressId:"",maxDiscount:"",currentDiscount:"",exRate:1,rateCalcMethod:"",tdType:2,tdPct:0,initialTdPct:0,baseAmount:0,volume:"",weight:"",qty:0,serializedAddress:"",items:[{id:1,orderId:e||0,itemId:"",sku:"",itemName:"",seqNo:"",siteId:"",muId:"",qty:0,volume:0,weight:1,msId:0,muQty:0,baseQty:0,mdType:1,basePrice:0,mdValue:0,unitPrice:0,unitCost:0,overheadId:"",vatAmount:0,mdAmount:0,upo:0,extendedPrice:0,mdAmountPct:null,priceType:1,applyVat:!1,taxId:"",taxDetails:null,notes:""}]},eb=(0,I.E)({endpointId:C.P.SalesOrder.page}),{schema:eF,requiredFields:eA}=(0,z.m)({sku:e=>e?.sku,itemName:e=>e?.itemName,qty:e=>e?.qty>0},eI,ex,"items"),{formik:eg}=(0,k.c)({maxAccess:ex,documentType:{key:"dtId",value:ey?.dtId},conditionSchema:["items"],initialValues:ef,validateOnChange:!0,validationSchema:o.object({date:o.string().required(),currencyId:o.string().required(),clientId:o.string().required(),items:o.array().of(eF)}),onSubmit:async e=>{let t={...e};if(delete t.items,t.date=(0,r.ku)(t.date),t.dueDate=(0,r.ku)(t.dueDate),t.miscAmount=t.miscAmount||0,e.rateCalcMethod||delete t.rateCalcMethod,t.serializedAddress){let e={clientId:t.clientId,address:ea},a=await U({extension:C.P.Address.set,record:JSON.stringify(e)});t.shipToAddressId=a.recordId}let a=e.items.filter(e=>Object.values(eA)?.every(t=>t(e)))?.map((t,a)=>{let{physicalProperty:d,...s}=t;return{...s,seqNo:a+1,siteId:e.siteId,applyVat:e.isVattable}}),d=await U({extension:C.P.SalesOrder.set2,record:JSON.stringify({header:t,items:a})}),s=eP?Y.Edited:Y.Added;m.default.success(s),await eq(d.recordId),eb()}}),eP=!!eg.values.recordId,eV=2===eg.values.wip;async function ew(e,t){if(!e)return;let a=el?.filter(e=>e.msId===t)||[];es.current=a}function eD(e,t,a){let d=parseFloat(e)||0;return t===a?(d<0||d>100)&&(d=0):d<0&&(d=0),d}let eC=[{component:"resourcelookup",label:em.sku,name:"sku",flex:2,props:{endpointId:b.$.Item.snapshot,parameters:{_categoryId:0,_msId:0,_startAt:0,_size:1e3},displayField:"sku",valueField:"sku",mapping:[{from:"recordId",to:"itemId"},{from:"sku",to:"sku"},{from:"name",to:"itemName"},{from:"msId",to:"msId"},{from:"isInactive",to:"isInactive"}],columnsInDropDown:[{key:"sku",value:"SKU"},{key:"name",value:"Item Name"}],displayFieldWidth:5},async onChange({row:{update:e,newRow:t}}){if(!t.itemId)return;if(t.isInactive){e({...eg.initialValues.items[0],id:t.id}),K({message:em.inactiveItem});return}ew(t?.itemId,t?.msId);let a=await ez(t.itemId),d=await eB(t.itemId),s=el?.filter(e=>e.recordId===d?.defSaleMUId)?.[0],l=await eJ(t.itemId,e,s?.recordId||0),r=null,n=null;if(eg.values.taxId){let e=(await eQ(eg.values.taxId)).map(e=>({taxId:eg.values.taxId,taxCodeId:e.taxCodeId,taxBase:e.taxBase,amount:e.amount}));r=eg.values.taxId,n=e}else if(d.taxId){let e=(await eQ(d.taxId)).map(e=>({taxId:d.taxId,taxCodeId:e.taxCodeId,taxBase:e.taxBase,amount:e.amount}));r=d.taxId,n=e}e({volume:a?.volume||0,weight:a?.weight||0,vatAmount:d?.vatPct||0,basePrice:l?.basePrice||0,unitPrice:l?.unitPrice||0,upo:l?.upo||0,priceType:l?.priceType||1,mdAmount:eg.values.initialTdPct||0,qty:0,msId:d?.msId,muRef:s?.reference||"",muId:s?.recordId||null,muQty:0,extendedPrice:0,mdValue:0,taxId:r,taxDetails:n||null,mdType:1,siteId:eg?.values?.siteId,siteRef:await e3(eg?.values?.siteId)})}},{component:"textfield",label:em.itemName,name:"itemName",flex:3,props:{readOnly:!0}},{component:"resourcecombobox",label:em.site,name:"siteRef",props:{endpointId:b.$.Site.qry,displayField:"reference",valueField:"recordId",mapping:[{from:"recordId",to:"siteId"},{from:"reference",to:"siteRef"},{from:"name",to:"siteName"}],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],displayFieldWidth:3}},{component:"resourcecombobox",label:em.measurementUnit,name:"muRef",props:{store:es?.current,displayField:"reference",valueField:"recordId",mapping:[{from:"reference",to:"muRef"},{from:"qty",to:"muQty"},{from:"recordId",to:"muId"}]},async onChange({row:{update:e,newRow:t}}){t?.muId||e({baseQty:0});let a=es?.current.find(e=>e.recordId===t?.muId),d=t?.muQty??a?.qty,s=await eJ(t?.itemId,"",t?.muId),l=eM({...t,baseQty:t?.qty*d||0,basePrice:s?.basePrice||0,unitPrice:s?.unitPrice||0,upo:s?.upo||0,priceType:s?.priceType||1},O.bT);e(l)},propsReducer:({props:e})=>({...e,store:es?.current})},{component:"numberfield",label:em.quantity,name:"qty",updateOn:"blur",props:{decimalScale:2},async onChange({row:{update:e,newRow:t}}){ew(t?.itemId,t?.msId);let a=es?.current.find(e=>e.recordId===t?.muId),d=t?.muQty??a?.qty,s=eM(t,O.bT);e({...s,baseQty:t?.qty*d})}},{component:"numberfield",label:em.volume,name:"volume",props:{decimalScale:2,readOnly:!0}},{component:"numberfield",label:em.weight,name:"weight",props:{decimalScale:2,readOnly:!0}},{component:"numberfield",label:em.baseprice,name:"basePrice",updateOn:"blur",props:{decimalScale:5},async onChange({row:{update:e,newRow:t}}){let a=eM(t,O.yO);e(a)}},{component:"numberfield",label:em.unitPrice,name:"unitPrice",updateOn:"blur",props:{decimalScale:5},async onChange({row:{update:e,newRow:t}}){let a=eM(t,O.Xf);e(a)}},{component:"numberfield",label:em.upo,name:"upo",updateOn:"blur",props:{decimalScale:2},async onChange({row:{update:e,newRow:t}}){let a=eM(t,O.zL);e(a)}},{component:"numberfield",label:em.VAT,name:"vatAmount",props:{decimalScale:2,readOnly:!0}},{component:"button",name:"taxDetailsButton",props:{onCondition:e=>e.itemId&&e.taxId?{imgSrc:a(36778).default.src,hidden:!1}:{imgSrc:"",hidden:!0}},label:em.tax,onClick:(e,t)=>{X({Component:W.Z,props:{taxId:t?.taxId,obj:t}})}},{component:"numberfield",label:em.markdown,name:"mdAmount",updateOn:"blur",flex:2,props:{decimalScale:2,ShowDiscountIcons:!0,iconsClicked:ek,type:"numeric",iconKey:({value:e,data:t})=>(e?.mdType||t?.mdType)===O.Xo?"%":"123"},async onChange({row:{update:e,newRow:t}}){let a=eM(t,O.On);e(a),function(e,t){let a=Number(e.unitPrice)*(eg.values.maxDiscount/100);eg.values.maxDiscount&&(1==e.mdType?e.mdAmount>eg.values.maxDiscount&&function(e,t,a){if(parseFloat(t.mdAmount)>e){eg.setFieldValue("mdAmount",e),t.mdAmount=e;let d=eM(t,O.On);a(d),K({message:em.clientMaxPctDiscount+" "+e+"%"})}}(eg.values.maxDiscount,e,t):e.mdAmount>a&&function(e,t,a,d){if(e>t){eg.setFieldValue("mdType",2),eg.setFieldValue("mdAmount",t),a.mdType=2,a.mdAmount=t;let e=eM(a,O.On);d(e),K({message:em.clientMaxDiscount+" "+t})}}(e.mdAmount,a,e,t))}(t,e)}},{component:"button",name:"saTrx",label:em.salesTrx,props:{onCondition:e=>({disabled:!e.itemId})},onClick:(e,t,a,d)=>{X({Component:_.Z,props:{recordId:0,functionId:F.J.SalesInvoice,itemId:t?.itemId,clientId:eg?.values?.clientId}})}},{component:"numberfield",label:em.extendedprice,name:"extendedPrice",updateOn:"blur",props:{decimalScale:2},async onChange({row:{update:e,newRow:t}}){let a=eM(t,O.bh);e(a)}},{component:"textfield",label:em.notes,name:"notes",flex:2}];async function ek({updateRow:e,value:t,data:a}){let d=(t?.mdType||a?.mdType)===O.Xo?O.RD:O.Xo,s=eD(t?.mdAmount,d,O.Xo);e({id:a.id,changes:{mdAmount:s,mdAmountPct:d,mdType:d},commitOnBlur:!0})}async function eT(){let e={...eg.values};delete e.items,e.date=(0,r.ku)(e.date),e.dueDate=(0,r.ku)(e.dueDate);let t=await U({extension:C.P.SalesOrder.close,record:JSON.stringify(e)});m.default.success(Y.Closed),eb(),await eq(t.recordId)}async function ej(){let e={...eg.values};delete e.items,e.date=(0,r.ku)(e.date),e.dueDate=(0,r.ku)(e.dueDate);let t=await U({extension:C.P.SalesOrder.reopen,record:JSON.stringify(e)});m.default.success(Y.Reopened),eb(),await eq(t.recordId)}async function eS(){let e={...eg.values};delete e.items,e.date=(0,r.ku)(e.date),e.dueDate=(0,r.ku)(e.dueDate);let t=await U({extension:C.P.SalesOrder.cancel,record:JSON.stringify(e)});m.default.success(Y.Cancel),eb(),await eq(t.recordId)}async function eO(){let e={...eg.values};delete e.items,e.date=(0,r.ku)(e.date),e.dueDate=(0,r.ku)(e.dueDate),await U({extension:C.P.SalesOrder.postToInvoice,record:JSON.stringify(e)}),m.default.success(Y.Invoice),eb(),d.close()}async function eZ(){X({Component:T.Z,props:{functionId:F.J.SalesOrder,recordId:eg.values.recordId}})}async function e$(){let e=await U({extension:M.u.ProductionOrderFromSaleOrder.gen,record:JSON.stringify({soId:eg.values.recordId})});X({Component:E.Z,props:{recordId:e.recordId}}),m.default.success(Y.Generated)}let eN=[{key:"RecordRemarks",condition:!0,onClick:"onRecordRemarks",disabled:!eP},{key:"Approval",condition:!0,onClick:"onApproval",disabled:!eV},{key:"Close",condition:!eV,onClick:eT,disabled:eV||!eP},{key:"Reopen",condition:eV,onClick:ej,disabled:!(eV&&(1==eg.values.deliveryStatus||5==eg.values.deliveryStatus))},{key:"Terminate",condition:!0,onClick:eS,disabled:!((2==eg.values.deliveryStatus||1==eg.values.deliveryStatus)&&4==eg.values.status)},{key:"WorkFlow",condition:!0,onClick:eZ,disabled:!eP},{key:"Invoice",condition:!0,onClick:eO,disabled:!(1===eg.values.deliveryStatus&&3!==eg.values.status&&eV)},{key:"generateProdOrder",condition:!0,onClick:e$,disabled:!(1===eg.values.deliveryStatus&&3!==eg.values.status&&eV)}];async function eq(e){if(!e)return;let{header:t,items:a}=await eR(e),d=await eL(t?.clientId),s=await e_(t?.shipToAddressId),l=await e_(t?.billToAddressId);t?.tdType==1||t?.tdType==null?et({text:"123",value:1}):et({text:"%",value:2});let r=t?.isVattable?ec.current:{},n=a?.length!=0?await Promise.all(a?.map(async(e,t)=>{let a=await eB(e?.itemId);return{...e,id:t+1,basePrice:e.basePrice,unitPrice:e.unitPrice,upo:e.upo,vatAmount:e.vatAmount,extendedPrice:e.extendedPrice,msId:a?.msId||e.msId,taxDetails:r?.[e?.taxId]||null}})):eg.initialValues.items;eg.setValues({...t,currentDiscount:t?.tdType==1||t?.tdType==null?t?.tdAmount:t?.tdPct,amount:parseFloat(t?.amount).toFixed(2),shipAddress:s,billAddress:l,tdPct:t?.tdPct||0,initialTdPct:d?.record?.tdPct||0,items:n})}async function eR(e){let t=await n({extension:C.P.SalesOrder.get2,parameters:`_recordId=${e}`});return t.record.header.date=(0,r.a1)(t?.record?.header?.date),t.record}async function e_(e){if(!e)return;let t=await n({extension:f.r.Address.format,parameters:`_addressId=${e}`});return t?.record?.formattedAddress.replace(/(\r\n|\r|\n)+/g,"\r\n")}let eL=async e=>{if(e)return await n({extension:C.P.Client.get,parameters:`_recordId=${e}`})};async function eW(e){if(!e)return;let t=await eL(e);eg.setFieldValue("currencyId",t?.record?.currencyId);let a=await eh(t?.record?.spId||eg.values.spId);eg.setFieldValue("spId",a),eg.setFieldValue("ptId",t?.record?.ptId),eg.setFieldValue("plId",t?.record?.plId||eu.systemDefaultsList.plId||0),eg.setFieldValue("szId",t?.record?.szId),eg.setFieldValue("shipToAddressId",t?.record?.shipAddressId||null),eg.setFieldValue("billToAddressId",t?.record?.billAddressId||null);let d=await e_(t?.record?.shipAddressId),s=await e_(t?.record?.billAddressId);eg.setFieldValue("shipAddress",d||""),eg.setFieldValue("billAddress",s||"")}async function ez(e){let t=await n({extension:b.$.ItemPhysProp.get,parameters:`_itemId=${e}`});return t?.record}async function eB(e){let t=await n({extension:b.$.Item.get,parameters:`_recordId=${e}`});return t?.record}async function eQ(e){return e&&ec.current[e]?ec.current[e]:[]}async function eJ(e,t,a){if(!eg.values.currencyId){t({itemId:null,itemName:null,sku:null}),K({message:em.noCurrency});return}let d=await n({extension:C.P.ItemConvertPrice.get,parameters:`_itemId=${e}&_clientId=${eg.values.clientId}&_currencyId=${eg.values.currencyId}&_plId=${eg.values.plId}&_muId=${a||0}`});return d?.record}function eM(e,t,a){en||ei(!0);let d=eD(e?.mdAmount,e?.mdType,O.Xo),s=(0,O.Ch)({priceType:e?.priceType||0,basePrice:parseFloat(e?.basePrice)||0,volume:e?.volume||0,weight:e?.weight,unitPrice:e?.unitPrice||0,upo:parseFloat(e?.upo)||0,qty:e?.qty,extendedPrice:e?.extendedPrice,mdAmount:d,mdType:e?.mdType,baseLaborPrice:0,totalWeightPerG:0,mdValue:e?.mdValue,tdPct:eg?.values?.tdPct||0,dirtyField:t}),l=(0,Z.VW)({priceType:s?.priceType,basePrice:s?.basePrice,qty:s?.qty,weight:s?.weight,extendedPrice:s?.extendedPrice,baseLaborPrice:s?.baseLaborPrice,vatAmount:s?.vatAmount||0,tdPct:eg?.values?.tdPct||0,taxDetails:eg.values.isVattable?e.taxDetails:null}),r={...e,id:e?.id,qty:s?.qty,volume:s?.volume,weight:s?.weight,basePrice:s?.basePrice,unitPrice:s?.unitPrice,extendedPrice:s?.extendedPrice,upo:s?.upo,mdValue:s?.mdValue,mdType:s?.mdType,mdAmount:s?.mdAmount,vatAmount:l?.vatAmount};return a?{changes:r}:r}let eE=eg.values.items?.filter(e=>void 0!==e.itemId).map(e=>({...e,basePrice:e.basePrice||0,unitPrice:e.unitPrice||0,upo:e.upo||0,vatAmount:e.vatAmount||0,weight:e.weight||0,volume:e.volume||0,extendedPrice:e.extendedPrice||0})),eU=(0,$.Ww)(eE),eX=0==eg.values.miscAmount?0:parseFloat(eg.values.miscAmount),eK=(0,$.Ot)(eE,{totalQty:0,totalWeight:0,totalVolume:0,totalUpo:0,sumVat:0,sumExtended:parseFloat(eU),tdAmount:parseFloat(eg.values.tdAmount),net:0,miscAmount:eX}),eY=en?eK?.totalQty:eg.values?.qty||0,eG=en?eK?.net:eg.values?.amount||0,eH=en?eK?.totalVolume:eg.values?.volume||0,e0=en?eK?.totalWeight:eg.values?.weight||0,e1=en?eU:eg.values?.subtotal||0,e2=en?eK?.sumVat:eg.values?.vatAmount||0;function e6(e,t,a,d){var s;s=function(e,t,a,d){let s=(0,$.Yi)({tdAmount:parseFloat(d),tdPlain:1==e,tdPct:2==e,tdType:e,subtotal:e1,currentDiscount:d,hiddenTdPct:t,hiddenTdAmount:parseFloat(a),typeChange:e});return eg.setFieldValue("tdAmount",s?.hiddenTdAmount?s?.hiddenTdAmount?.toFixed(2):0),eg.setFieldValue("tdType",s?.tdType),eg.setFieldValue("currentDiscount",s?.currentDiscount||0),eg.setFieldValue("tdPct",s?.hiddenTdPct||0),s?.hiddenTdPct||0}(e,t,a,d),eg.values.items.map((e,t)=>{let a=(0,Z.VW)({priceType:e?.priceType,basePrice:e?.basePrice,qty:e?.qty,weight:e?.weight,extendedPrice:e?.extendedPrice,baseLaborPrice:parseFloat(e?.baseLaborPrice),vatAmount:e?.vatAmount,tdPct:s,taxDetails:eg.values.isVattable?e.taxDetails:null});eg.setFieldValue(`items[${t}].vatAmount`,a?.vatAmount)})}function e9(e){Object.entries(e).forEach(([e,t])=>{eg.setFieldValue(e,t)})}function e5(e,t){X({Component:N.Z,props:{maxAccess:ex,labels:em,shipment:e,bill:t,checkedAddressId:e?eg.values?.shipToAddressId:eg.values?.billToAddressId,form:eg.values,handleAddressValues:e9}})}let e7=async()=>{let e=await n({extension:C.P.SalesOrder.pack,parameters:""}),t=(e?.record?.taxDetails||[]).reduce((e,t)=>(e[t.taxId]||(e[t.taxId]=[]),e[t.taxId].push(t),e),{});return ec.current=t,e?.record?.measurementUnits||[]};async function e3(e){if(!e)return;let t=await n({extension:b.$.Site.get,parameters:`_recordId=${e}`});return t?.record?.reference}async function e4(){let e=["siteId","salesTD","plId"],t=["plantId","siteId","spId"],a=(G?.list||[]).reduce((t,{key:a,value:d})=>(e.includes(a)&&(t[a]="True"===d||"False"===d?d:d?parseInt(d):null),t),{}),d=(H?.list||[]).reduce((e,{key:a,value:d})=>(t.includes(a)&&(e[a]=d?parseInt(d):null),e),{});return eo(e=>({...e,userDefaultsList:d,systemDefaultsList:a})),{userDefaultsList:d,systemDefaultsList:a}}async function e8(e){if(!e)return;let t=await n({extension:C.P.DocumentTypeDefault.get,parameters:`_dtId=${e}`}),a=await eh(t?.record?.spId||eu.userDefaultsList.spId);eg.setFieldValue("spId",a),eg.setFieldValue("plantId",t?.record?.plantId||eu.userDefaultsList.plantId||null)}async function te(){let e={printStatus:2,recordId:eg.values.recordId};await U({extension:C.P.PrintedSA.printed,record:JSON.stringify(e)}),eb()}return(0,u.useEffect)(()=>{let e="",{name:t,street1:a,street2:d,city:s,phone:l,phone2:r,email1:n}=ea;(t||a||d||s||l||r||n)&&(e=`${t||""}
${a||""}
${d||""}
${s||""}
${l||""}
${r||""}
${n||""}`),eg.setFieldValue("shipAddress",e),eg.setFieldValue("serializedAddress",e)},[ea]),(0,u.useEffect)(()=>{eg.setFieldValue("qty",parseFloat(eY).toFixed(2)),eg.setFieldValue("amount",parseFloat(eG).toFixed(2)),eg.setFieldValue("volume",parseFloat(eH).toFixed(2)),eg.setFieldValue("weight",parseFloat(e0).toFixed(2)),eg.setFieldValue("subtotal",parseFloat(e1).toFixed(2)),eg.setFieldValue("vatAmount",parseFloat(e2).toFixed(2))},[eY,eG,eH,e0,e1,e2]),(0,u.useEffect)(()=>{if(en){let e=parseFloat(eg.values.tdPct)*parseFloat(e1)/100;e6(eg.values.tdType,eg.values.tdPct,e,eg.values.currentDiscount)}},[e1]),(0,u.useEffect)(()=>{eg.values?.dtId&!e&&e8(eg.values?.dtId)},[eg.values?.dtId]),(0,u.useEffect)(()=>{!async function(){let t=await e7();er(t);let a=await e4();if(e)eq(e);else{a.systemDefaultsList.salesTD?(et({text:"%",value:2}),eg.setFieldValue("tdType",2)):(et({text:"123",value:1}),eg.setFieldValue("tdType",1));let e=a.userDefaultsList.siteId,t=a.systemDefaultsList.siteId,d=a.userDefaultsList.plantId,s=a.userDefaultsList.spId,l=await eh(parseInt(s));eg.setFieldValue("siteId",parseInt(e||t)),eg.setFieldValue("spId",l),eg.setFieldValue("plantId",parseInt(d))}}()},[]),s.jsx(c.Z,{resourceId:y.i.SalesOrder,functionId:F.J.SalesOrder,form:eg,maxAccess:ex,previewReport:eP,previewBtnClicked:te,isClosed:eV,actions:eN,editMode:eP,disabledSubmit:eV&&!eP,disabledSavedClear:eV&&!eP,children:(0,s.jsxs)(V.R,{children:[s.jsx(w.g,{children:(0,s.jsxs)(i(),{container:!0,spacing:2,children:[s.jsx(i(),{item:!0,xs:8,children:(0,s.jsxs)(i(),{container:!0,spacing:2,children:[s.jsx(i(),{item:!0,xs:4,children:s.jsx(h.Z,{endpointId:C.P.SalesOrder.pack,reducer:e=>e?.record?.documentTypes,name:"dtId",label:em.documentType,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],readOnly:eP,valueField:"recordId",displayField:["reference","name"],values:eg.values,maxAccess:ex,onChange:(e,t)=>{ev(t),eg.setFieldValue("dtId",t?.recordId||null)},error:eg.touched.dtId&&!!eg.errors.dtId})}),s.jsx(i(),{item:!0,xs:4,children:s.jsx(h.Z,{endpointId:C.P.SalesOrder.pack,reducer:e=>e?.record?.salesPeople,filter:eP?void 0:e=>!e.isInactive,name:"spId",label:em.salesPerson,columnsInDropDown:[{key:"spRef",value:"Reference"},{key:"name",value:"Name"}],readOnly:eV,valueField:"recordId",displayField:"name",values:eg.values,displayFieldWidth:1.5,maxAccess:ex,onChange:(e,t)=>{eg.setFieldValue("spId",t?t.recordId:null)},error:eg.touched.spId&&!!eg.errors.spId})}),s.jsx(i(),{item:!0,xs:4,children:s.jsx(h.Z,{endpointId:C.P.SalesOrder.pack,reducer:e=>e?.record?.currencies,name:"currencyId",label:em.currency,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],required:!0,readOnly:eV,values:eg.values,maxAccess:ex,onChange:(e,t)=>{eg.setFieldValue("currencyId",t?.recordId||null),eg.setFieldValue("items",[{id:1}])},error:eg.touched.currencyId&&!!eg.errors.currencyId})}),s.jsx(i(),{item:!0,xs:4,children:s.jsx(x.Z,{name:"reference",label:em.reference,value:eg?.values?.reference,maxAccess:!eP&&ex,readOnly:eP,onChange:eg.handleChange,onClear:()=>eg.setFieldValue("reference",""),error:eg.touched.reference&&!!eg.errors.reference})}),s.jsx(i(),{item:!0,xs:4,children:s.jsx(l.Z,{name:"date",required:!0,label:em.date,value:eg?.values?.date,onChange:eg.setFieldValue,editMode:eP,readOnly:eV,maxAccess:ex,onClear:()=>eg.setFieldValue("date",""),error:eg.touched.date&&!!eg.errors.date})}),s.jsx(i(),{item:!0,xs:4,children:s.jsx(h.Z,{endpointId:C.P.SalesOrder.pack,reducer:e=>e?.record?.plants,name:"plantId",label:em.plant,readOnly:eV,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:eg.values,valueField:"recordId",displayField:["reference","name"],maxAccess:ex,onChange:(e,t)=>{eg.setFieldValue("plantId",t?t.recordId:null)},displayFieldWidth:2,error:eg.touched.plantId&&!!eg.errors.plantId})})]})}),s.jsx(i(),{item:!0,xs:4,children:(0,s.jsxs)(i(),{container:!0,spacing:2,children:[s.jsx(i(),{item:!0,xs:6,children:s.jsx(v.Z,{name:"shipAddress",label:em.shipTo,value:eg.values.shipAddress,rows:2.5,maxLength:"100",readOnly:!0,disabled:eg.values.exWorks,maxAccess:ex,viewDropDown:eg.values.clientId,viewAdd:eg.values.clientId&&!eP,onChange:e=>eg.setFieldValue("shipAddress",e.target.value),onClear:()=>eg.setFieldValue("shipAddress",""),onDropDown:()=>e5(!0,!1),handleAddAction:()=>void X({Component:J.Z,props:{address:ea,setAddress:ed,isCleared:!1,datasetId:y.i.ADDSalesOrder}})})}),s.jsx(i(),{item:!0,xs:6,children:s.jsx(v.Z,{name:"billAddress",label:em.billTo,value:eg.values.billAddress,rows:2.5,maxLength:"100",readOnly:eV,maxAccess:ex,viewDropDown:eg.values.clientId,onChange:e=>eg.setFieldValue("BillAddress",e.target.value),onClear:()=>eg.setFieldValue("BillAddress",""),onDropDown:()=>e5(!1,!0)})})]})}),s.jsx(i(),{item:!0,xs:3,children:s.jsx(A.U,{endpointId:C.P.Client.snapshot,valueField:"reference",displayField:"name",secondFieldLabel:em.name,name:"clientId",label:em.client,form:eg,required:!0,readOnly:eV,displayFieldWidth:6,valueShow:"clientRef",secondValueShow:"clientName",maxAccess:ex,editMode:eP,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"},{key:"szName",value:"Sales Zone"}],onChange:async(e,t)=>{eg.setFieldValue("clientId",t?.recordId),eg.setFieldValue("clientName",t?.name),eg.setFieldValue("clientRef",t?.reference),eg.setFieldValue("isVattable",t?.isSubjectToVAT||!1),eg.setFieldValue("maxDiscount",t?.maxDiscount),eg.setFieldValue("tdPct",t?.tdPct),eg.setFieldValue("initialTdPct",t?.tdPct),eg.setFieldValue("taxId",t?.taxId),ed({}),eW(t?.recordId)},errorCheck:"clientId"})}),s.jsx(i(),{item:!0,xs:1,children:s.jsx(L.Z,{name:"isVattable",value:eg.values?.isVattable,onChange:e=>eg.setFieldValue("isVattable",e.target.checked),label:em.VAT,disabled:eg.values.items[0]?.itemId,maxAccess:ex})}),s.jsx(i(),{item:!0,xs:2,children:s.jsx(h.Z,{endpointId:C.P.SalesOrder.pack,reducer:e=>e?.record?.taxSchedules,name:"taxId",label:em.tax,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],readOnly:!0,values:eg.values,onChange:(e,t)=>{eg.setFieldValue("taxId",t?t.recordId:"")},error:eg.touched.taxId&&!!eg.errors.taxId,maxAccess:ex})}),s.jsx(i(),{item:!0,xs:2,children:s.jsx(h.Z,{endpointId:C.P.SalesOrder.pack,reducer:e=>e?.record?.sites,name:"siteId",readOnly:eV,label:em.site,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:eg.values,valueField:"recordId",displayField:["reference","name"],maxAccess:ex,displayFieldWidth:2,onChange:(e,t)=>{eg.setFieldValue("siteId",t?t.recordId:null),eg.setFieldValue("siteRef",t?t.reference:null),eg.setFieldValue("siteName",t?t.name:null)},error:eg.touched.siteId&&!!eg.errors.siteId})}),s.jsx(i(),{item:!0,xs:2,children:s.jsx(h.Z,{endpointId:C.P.SalesOrder.pack,reducer:e=>e?.record?.saleZones,name:"szId",label:em.saleZone,valueField:"recordId",displayField:"name",readOnly:eV,values:eg.values,displayFieldWidth:1.5,maxAccess:ex,onChange:(e,t)=>{eg.setFieldValue("szId",t?t.recordId:null)},error:eg.touched.szId&&!!eg.errors.szId})}),s.jsx(i(),{item:!0,xs:2,children:s.jsx(L.Z,{name:"exWorks",value:eg.values?.exWorks,onChange:e=>{let{name:t,checked:a}=e.target;eg.setFieldValue(t,a),a&&eg.setFieldValue("shipAddress","")},label:em.exWorks,maxAccess:ex,disabled:eV})})]})}),s.jsx(g.Q,{children:s.jsx(P._,{onChange:(e,t)=>{eg.setFieldValue("items",e),"delete"===t&&ei(!0)},onSelectionChange:(e,t,a)=>{"muRef"==a&&ew(e?.itemId,e?.msId)},value:eg.values.items,error:eg.errors.items,initialValues:eg?.initialValues?.items?.[0],columns:eC,name:"items",maxAccess:ex,disabled:eV||!eg.values.clientId,allowDelete:!eV})}),s.jsx(w.g,{children:(0,s.jsxs)(i(),{container:!0,spacing:2,sx:{pt:2},children:[s.jsx(i(),{item:!0,xs:6,children:(0,s.jsxs)(i(),{container:!0,spacing:2,children:[s.jsx(i(),{item:!0,xs:12,children:s.jsx(v.Z,{name:"description",label:em.description,value:eg.values.description,rows:3,editMode:eP,readOnly:eV,maxAccess:ex,onChange:e=>eg.setFieldValue("description",e.target.value),onClear:()=>eg.setFieldValue("description",""),error:eg.touched.description&&!!eg.errors.description})}),s.jsx(i(),{item:!0,xs:12,children:s.jsx(L.Z,{name:"overdraft",value:eg.values?.overdraft,onChange:e=>eg.setFieldValue("overdraft",e.target.checked),readOnly:!0,label:em.overdraft,maxAccess:ep})})]})}),s.jsx(i(),{item:!0,xs:3,children:(0,s.jsxs)(i(),{container:!0,spacing:2,children:[s.jsx(i(),{item:!0,xs:12,children:s.jsx(D.Z,{name:"totalQTY",label:em.totQty,value:eY,readOnly:!0})}),s.jsx(i(),{item:!0,xs:12,children:s.jsx(D.Z,{name:"totalVolume",maxAccess:ex,label:em.totVolume,value:eH,readOnly:!0})}),s.jsx(i(),{item:!0,xs:12,children:s.jsx(D.Z,{name:"totalWeight",maxAccess:ex,label:em.totWeight,value:e0,readOnly:!0})})]})}),s.jsx(i(),{item:!0,xs:3,children:(0,s.jsxs)(i(),{container:!0,spacing:2,children:[s.jsx(i(),{item:!0,xs:12,children:s.jsx(D.Z,{name:"subTotal",maxAccess:ex,label:em.subtotal,value:e1,readOnly:!0})}),s.jsx(i(),{item:!0,xs:12,children:s.jsx(D.Z,{name:"discount",maxAccess:ex,label:em.discount,value:eg.values.currentDiscount,displayCycleButton:!0,readOnly:eV,iconKey:ee.text,cycleButtonLabel:ee.text,decimalScale:2,handleButtonClick:()=>{let e,t,a;ei(!0),1==ee.value?(t=eg.values.currentDiscount<0||eg.values.currentDiscount>100?0:eg.values.currentDiscount,e=parseFloat(t)*parseFloat(e1)/100,a=t,eg.setFieldValue("tdAmount",e),eg.setFieldValue("tdPct",t),eg.setFieldValue("currentDiscount",t)):(e=eg.values.currentDiscount<0||e1<eg.values.currentDiscount?0:eg.values.currentDiscount,t=parseFloat(e)/parseFloat(e1)*100,a=e,eg.setFieldValue("tdPct",t),eg.setFieldValue("tdAmount",e),eg.setFieldValue("currentDiscount",e)),et(d=>{let s="%"===d.text?{text:"123",value:1}:{text:"%",value:2};return eg.setFieldValue("tdType",s.value),e6(s.value,t,e,a),s})},ShowDiscountIcons:!0,onChange:e=>{let t=Number(e.target.value.replace(/,/g,""));1==eg.values.tdType?((t<0||e1<t)&&(t=0),eg.setFieldValue("tdAmount",t)):((t<0||t>100)&&(t=0),eg.setFieldValue("tdPct",t)),eg.setFieldValue("currentDiscount",t)},onBlur:async e=>{ei(!0);let t=Number(e.target.value.replace(/,/g,"")),a=Number(e.target.value.replace(/,/g,"")),d=Number(e.target.value.replace(/,/g,""));1==eg.values.tdType&&(a=parseFloat(t)/parseFloat(e1)*100,eg.setFieldValue("tdPct",a)),2==eg.values.tdType&&(d=parseFloat(t)*parseFloat(e1)/100,eg.setFieldValue("tdAmount",d)),e6(eg.values.tdType,a,d,t)},onClear:()=>{eg.setFieldValue("tdAmount",0),eg.setFieldValue("tdPct",0),e6(eg.values.tdType,0,0,0)}})}),s.jsx(i(),{item:!0,xs:12,children:s.jsx(D.Z,{name:"miscAmount",maxAccess:ex,label:em.misc,value:eg.values.miscAmount||0,decimalScale:2,readOnly:eV,onChange:e=>eg.setFieldValue("miscAmount",e.target.value),onBlur:async()=>{ei(!0)},onClear:()=>{eg.setFieldValue("miscAmount",0)}})}),s.jsx(i(),{item:!0,xs:12,children:s.jsx(D.Z,{name:"vatAmount",maxAccess:ex,label:em.VAT,value:e2,readOnly:!0})}),s.jsx(i(),{item:!0,xs:12,children:s.jsx(D.Z,{name:"amount",maxAccess:ex,label:em.net,value:eG,readOnly:!0})})]})})]})})]})})};X.width=1300,X.height=750;let K=X;d()}catch(e){d(e)}})}};