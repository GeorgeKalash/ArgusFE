exports.id=2832,exports.ids=[2832],exports.modules={3:e=>{e.exports={root:"WorkFlow_root__EINm1"}},72172:(e,a,t)=>{"use strict";t.d(a,{K:()=>r});let l="RG.FI.asmx/",r={FiOpeningBalance:{gen:l+"genOBA"},FiAging:{qry:l+"FI404"},AccountSummary:{AccFI405b:l+"FI405b"},DocumentAging:{AgingFI406a:l+"FI406a",AgingFI406b:l+"FI406b"},TrialBalance:{FI402View:l+"FI402o",FI401o2:l+"FI401o2"}}},81313:(e,a,t)=>{"use strict";t.a(e,async(e,l)=>{try{t.d(a,{Z:()=>N});var r=t(20997),s=t(16689),n=t(87316),i=t.n(n),d=t(29352),c=t(61274),o=t(6416),u=t(38509),m=t(42020),p=t(23385),I=t(18611),h=t(71278),f=t(66198),x=t(70755),v=t(97969),y=t(60520),g=t(95965),b=t(79660),F=t(40711),w=t(72172),j=t(96119),k=e([d,c,u,h,y,F]);function N({accountId:e,moduleId:a,window:t}){let{getRequest:l}=(0,s.useContext)(d.$),{platformLabels:n}=(0,s.useContext)(y.l),[k,N]=(0,s.useState)([]);(0,j.Z)({title:n.AccountSummary,window:t});let{labels:C,access:A}=(0,u.J)({datasetId:o.i.AccountSummary}),P=[{field:"days",headerName:C.days,flex:1,type:"number"}],[D,S]=(0,s.useState)(P),{formik:V}=(0,g.c)({maxAccess:A,initialValues:{accountId:null,accountRef:"",accountName:"",agpId:null,moduleId:a}});async function O(){let e;let t=2,r=[...P],s=await l({extension:b.r.Currency.qry,parameters:"_filter="});if(1==a?e=s?.list?.filter(e=>e.sale):2==a&&(e=s?.list?.filter(e=>e.purchase)),0==e.length)return;e?.forEach((e,a)=>{r.push({field:`column${a+1}`,headerName:e.reference,flex:1,type:"number"})}),S(r);let n=await l({extension:f.H.AgingLeg.qry,parameters:`_agpId=${V.values.agpId}`}),i=n?.list?.map(a=>{let t=Array(e.length+2).fill(0);return t[0]=null,t[1]=a.days,t}),d=(e||[]).map(e=>l({extension:w.K.AccountSummary.AccFI405b,parameters:`_agpId=${V.values.agpId}&_currencyId=${e.recordId}&_accountId=${V.values.accountId}`}).then(e=>({summaryRes:e})));(await Promise.all(d)).forEach(({summaryRes:e})=>{e?.list?.forEach(e=>{i?.forEach(a=>{a[1]==e.seqDays&&(a[t]=e.amount)})}),t++});let c=Array(e.length+2).fill(null);for(let a=2;a<e.length+2;a++){let e=0;i?.map(t=>{e+=Number(t[a]||0)}),c[a]=e}let o=i.filter(e=>null!==e[1]).map(e=>{let[a,t,...l]=e,r={days:t};return l.forEach((e,a)=>{r[`column${a+1}`]=e.toFixed(2)}),r}),u={};for(let a=0;a<e.length;a++)u[`column${a+1}`]=c[a+2].toFixed(2)??0;o.push(u),N({list:o})}return(0,r.jsxs)(I.R,{children:[r.jsx(m.g,{children:(0,r.jsxs)(i(),{container:!0,spacing:2,p:2,children:[r.jsx(i(),{item:!0,xs:12,children:r.jsx(c.U,{endpointId:f.H.Account.snapshot,name:"accountId",label:C.account,valueField:"reference",displayField:"name",valueShow:"accountRef",secondValueShow:"accountName",form:V,readOnly:V.values.accountId&&V.values.moduleId,required:!0,maxAccess:A,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],onChange:async(e,a)=>{V.setFieldValue("accountId",a?.recordId||null),V.setFieldValue("accountName",a?.name||""),V.setFieldValue("accountRef",a?.reference||"")}})}),r.jsx(i(),{item:!0,xs:6,children:r.jsx(h.Z,{endpointId:f.H.AgingProfile.qry,parameters:"_startAt=0&_pageSize=1000&filter=",name:"agpId",label:C.agingProfile,values:V.values,valueField:"recordId",displayField:"name",maxAccess:A,required:!0,onChange:(e,a)=>{V.setFieldValue("agpId",a?.recordId||null),a?.recordId||N({list:[]})}})}),r.jsx(i(),{item:!0,xs:5,children:r.jsx(h.Z,{datasetId:v.v.FI_AGING_MODULE,label:C.module,name:"moduleId",values:V.values,valueField:"key",displayField:"value",maxAccess:A,required:!0,readOnly:V.values.moduleId,onChange:(e,a)=>{V.setFieldValue("moduleId",a?.key||null)}})}),r.jsx(i(),{item:!0,xs:1,children:r.jsx(x.Z,{onClick:O,image:"preview.png",disabled:!V.values.agpId||!V.values.moduleId||!V.values.accountId,tooltipText:n.Preview})})]})}),r.jsx(p.Q,{children:r.jsx(F.Z,{columns:D,gridData:k,isLoading:!1,pagination:!1})})]})}[d,c,u,h,y,F]=k.then?(await k)():k,N.width=1e3,N.height=500,l()}catch(e){l(e)}})},2832:(e,a,t)=>{"use strict";t.a(e,async(e,l)=>{try{t.d(a,{Z:()=>E});var r=t(20997),s=t(27736),n=t(79390),i=t(99155),d=t.n(i),c=t(16689),o=t(75609),u=t(80582),m=t(86201),p=t(29352),I=t(6416),h=t(44619),f=t(65980),x=t(71278),v=t(68728),y=t(61274),g=t(23385),b=t(15051),F=t(18611),w=t(42020),j=t(91184),k=t(97996),N=t(95965),C=t(70638),A=t(677),P=t(60520),D=t(57629),S=t(86794),V=t(40711),O=t(24356),Z=t(13893),R=t(82173),L=t(60349),q=t(70305),_=t(81313),T=e([u,m,p,x,y,b,C,A,P,S,V,O,Z,q,_]);[u,m,p,x,y,b,C,A,P,S,V,O,Z,q,_]=T.then?(await T)():T;let $=({labels:e,access:a,recordId:l,invalidate:i})=>{let{getRequest:T,postRequest:$}=(0,c.useContext)(p.$),{stack:E}=(0,A.zY)(),{stack:W}=(0,q.V)(),{platformLabels:J,defaultsData:G,userDefaultsData:B,systemChecks:z}=(0,c.useContext)(P.l),[H,M]=(0,c.useState)(!1),U=(0,c.useRef)(null),{documentType:K,maxAccess:Q,changeDT:X}=(0,S.H)({functionId:v.J.DraftSerialsIn,access:a,enabled:!l});(0,c.useEffect)(()=>{K?.dtId&&ej(K.dtId)},[K?.dtId]);let Y=parseInt(G?.list?.find(e=>"currencyId"===e.key)?.value),ee=parseInt(G?.list?.find(e=>"plId"===e.key)?.value),ea=parseInt(B?.list?.find(e=>"spId"===e.key)?.value),et=parseInt(B?.list?.find(e=>"siteId"===e.key)?.value),{formik:el}=(0,N.c)({maxAccess:Q,documentType:{key:"dtId",value:K?.dtId},initialValues:{recordId:l||"",dtId:null,reference:"",date:new Date,plantId:null,clientId:null,clientRef:"",clientName:"",currencyId:Y||null,spId:ea||null,siteId:et||null,description:"",status:1,wip:1,isVattable:!1,taxId:null,subtotal:0,amount:0,vatAmount:0,plId:ee||null,ptId:null,weight:0,accountId:null,disSkuLookup:!1,autoSrlNo:!0,search:"",serials:[{id:1,draftId:l||0,srlNo:"",metalId:"",designId:"",itemId:"",sku:"",itemName:"",seqNo:"",extendedPrice:0,baseLaborPrice:0,weight:0,metalRef:"",designRef:"",vatAmount:0,vatPct:0,unitPrice:0,taxId:null,taxDetails:null,priceType:0,volume:0}],metalGridData:[],itemGridData:[]},validateOnChange:!0,validationSchema:o.object({date:o.string().required(),currencyId:o.string().required(),clientId:o.string().required(),spId:o.string().required(),siteId:o.string().required(),serials:o.array().of(o.object().shape({srlNo:o.string().test({name:"srlNo-first-row-check",test(e,a){let{parent:t}=a;return t?.id==1||(!(t?.id>1)||!!e)&&e}})}))}),onSubmit:async e=>{let{itemGridData:a,metalGridData:t,search:l,autoSrlNo:r,disSkuLookup:s,serials:d,date:c,...o}=e,u={...o,pcs:d.length,date:(0,n.ku)(c)},p=el.values.serials.filter(e=>e.srlNo).map(({taxDetails:e,recordId:a,...t},l)=>({...t,seqNo:l+1,draftId:a||0}));$({extension:k.P.DraftInvoice.set2,record:JSON.stringify({header:u,items:p})}).then(async e=>{m.default.success(ei?J.Edited:J.Added),await es(e.recordId),i()})}});async function er(){if(U.current)return;let e=await T({extension:k.P.DraftInvoice.pack,parameters:""}),a=e?.record?.taxDetails||[];U.current=a}async function es(e){let a=await ep(e);await eg(a)}let en=z?.find(e=>e.checkId===L.F.POS_JUMP_TO_NEXT_LINE)?.value,ei=!!el.values.recordId,ed=2===el.values.wip,ec=async e=>{if(!e?.draftId||!e?.itemId)return!0;let a={draftId:el?.values?.recordId,lineItem:e};return await $({extension:k.P.DraftInvoiceSerial.del,record:JSON.stringify(a)}),!0};async function eo(e,a){if(a?.srlNo){a.draftId=e;let t=await $({extension:k.P.DraftInvoiceSerial.append,record:JSON.stringify({draftId:e,lineItem:a}),noHandleError:!0});return t?.error?(W({message:t?.error}),!1):(m.default.success(J.Saved),i(),!0)}}function eu(e){return e.reduce((e,a)=>{let t=parseFloat(a.unitPrice)||0,l=parseFloat(a.vatAmount)||0,r=parseFloat(a.weight)||0;return e.subtotal+=t,e.vatAmount+=l,e.weight+=r,e.amount+=t+l,e},{subtotal:0,vatAmount:0,weight:0,amount:0})}async function em(e){let a=[e],t=eu(a),{itemGridData:l,metalGridData:r,search:s,autoSrlNo:i,disSkuLookup:d,date:c,...o}=el.values,u={header:{...o,pcs:a.length,...t,date:(0,n.ku)(c)},items:[e]},p=await $({extension:k.P.DraftInvoice.set2,record:JSON.stringify(u)});p?.recordId&&(m.default.success(J.Saved),es(p?.recordId))}async function ep(e){if(!e)return null;let a=await T({extension:k.P.DraftInvoice.get2,parameters:`_recordId=${e}`}),t=await T({extension:k.P.Client.get,parameters:`_recordId=${a?.record?.header?.clientId}`});return a.record.header.date=(0,n.a1)(a?.record?.header?.date),a.record.header.accountId=t.record.accountId,a?.record||{}}let eI=[{component:"textfield",label:e.srlNo,name:"srlNo",flex:1.2,...el?.values?.autoSrlNo&&{updateOn:"blur"},jumpToNextLine:en,disableDuplicate:!0,propsReducer:({row:e,props:a})=>({...a,readOnly:e?.srlNo}),async onChange({row:{update:e,newRow:a,oldRow:t,addRow:l}}){if(!a?.srlNo)return;let r=await T({extension:k.P.DraftInvoiceSerial.get,parameters:`_currencyId=${el?.values?.currencyId}&_plId=${el?.values?.plId}&_srlNo=${a?.srlNo}&_siteId=${el?.values?.siteId}`});if(el?.values?.autoSrlNo){let t={fieldName:"srlNo",changes:{id:a.id,seqNo:a.id,draftId:el?.values?.recordId||0,srlNo:r?.record?.srlNo||"",sku:r?.record?.sku||"",itemName:r?.record?.itemName||"",weight:r?.record?.weight||0,itemId:r?.record?.itemId||null,priceType:r?.record?.priceType||0,metalId:r?.record?.metalId||null,metalRef:r?.record?.metalRef||"",designId:r?.record?.designId||null,designRef:r?.record?.designRef||null,categoryName:r?.record?.categoryName,volume:r?.record?.volume||0,baseLaborPrice:r?.record?.baseLaborPrice||0,unitPrice:parseFloat(r?.record?.unitPrice).toFixed(2)||0,vatPct:r?.record?.vatPct||0,vatAmount:parseFloat(r?.record?.vatAmount).toFixed(2)||0,...r?.record?.taxId&&{taxId:el.values?.taxId||r?.record?.taxId,taxDetails:await eb(el.values?.taxId||r?.record?.taxId)}}},{unitPrice:s,baseLaborPrice:n}=function(e,a){H||M(!0);let t=(0,R.Ch)({priceType:3,basePrice:0,volume:parseFloat(e?.volume||0),weight:1,unitPrice:parseFloat(e?.baseLaborPrice),upo:0,qty:parseFloat(e?.weight),extendedPrice:parseFloat(e?.unitPrice).toFixed(2),mdAmount:0,mdType:0,baseLaborPrice:0,totalWeightPerG:0,mdValue:0,tdPct:0,dirtyField:a}),l=(0,D.VW)({priceType:t?.priceType,basePrice:0,qty:parseFloat(e?.weight),weight:parseFloat(e?.weight),extendedPrice:parseFloat(t?.extendedPrice),tdPct:0,baseLaborPrice:0,taxDetails:parseFloat(e?.taxDetails)});return{unitPrice:parseFloat(t?.extendedPrice).toFixed(2),baseLaborPrice:parseFloat(t?.unitPrice).toFixed(2),vatAmount:parseFloat(l?.vatAmount).toFixed(2)}}(t.changes,R.Xf);t.changes.unitPrice=s,t.changes.baseLaborPrice=n,null!=t.changes.taxId&&(t.changes.extendedPrice=s,t.changes.taxDetails=await eb(t.changes.taxId)),H||M(!0),(el?.values?.recordId?await eo(el?.values?.recordId,t.changes):await em(t.changes))?await l(t):e({...el?.initialValues?.serials,id:a?.id,srlNo:""})}}},{component:"numberfield",label:e.weight,name:"weight",props:{readOnly:!0}},{component:"textfield",label:e.sku,name:"sku",props:{readOnly:!0}},{component:"textfield",label:e.itemName,name:"itemName",flex:2,props:{readOnly:!0}},{component:"textfield",label:e.metalRef,name:"metalRef",flex:.6,props:{readOnly:!0}},{component:"numberfield",label:e.vatAmount,name:"vatAmount",props:{readOnly:!0}},{component:"button",name:"taxDetailsButton",flex:.75,props:{onCondition:e=>e.itemId&&e.taxId?{imgSrc:t(36778).default.src,hidden:!1}:{imgSrc:"",hidden:!0}},label:e.tax,onClick:(e,a)=>{a.qty=a.weight,a.basePrice=0,E({Component:O.Z,props:{taxId:a?.taxId,obj:a}})}},{component:"numberfield",label:e.baseLaborPrice,name:"baseLaborPrice",updateOn:"blur",props:{decimalScale:2,readOnly:!0}},{component:"numberfield",label:e.unitPrice,name:"unitPrice",props:{readOnly:!0}}];async function eh(){let{serials:e,...a}=el.values;await $({extension:k.P.DraftInvoice.close,record:JSON.stringify({...a,date:(0,n.ku)(el.values.date)})}).then(()=>{m.default.success(J.Closed),i(),es(el?.values?.recordId)})}async function ef(){let{serials:e,...a}=el.values;await $({extension:k.P.DraftInvoice.reopen,record:JSON.stringify({...a,date:(0,n.ku)(el.values.date)})}).then(()=>{m.default.success(J.Reopened),i(),es(el?.values?.recordId)})}async function ex(){E({Component:C.Z,props:{functionId:v.J.DraftSerialsIn,recordId:el.values.recordId}})}async function ev(){E({Component:Z.Z,props:{endPoint:k.P.DraftInvoiceSerial.batch,header:{draftId:el?.values?.recordId},onCloseimport:async()=>{await es(el.values.recordId)},maxAccess:Q}})}let ey=[{key:"Close",condition:!ed,onClick:eh,disabled:ed||!ei||!el?.values?.serials?.[0]?.srlNo},{key:"Reopen",condition:ed,onClick:ef,disabled:!ed||3==el.values.status||!ei},{key:"WorkFlow",condition:!0,onClick:ex,disabled:!ei},{key:"Import",condition:!0,onClick:()=>ev(),disabled:!ei||1!=el.values.status||ed},{key:"AccountSummary",condition:!0,onClick:()=>{E({Component:_.Z,props:{accountId:parseInt(el.values.accountId),moduleId:1}})},disabled:!el.values.clientId}];async function eg(e){if(!e)return;let{header:a={},items:t=[]}=e,l=await Promise.all((t||[]).map(async(e,t)=>{let l=a?.isVattable&&e.taxId?await eb(e.taxId):null;return{...e,id:t+1,baseLaborPrice:parseFloat(e.baseLaborPrice).toFixed(2),unitPrice:parseFloat(e.unitPrice).toFixed(2),vatAmount:parseFloat(e.vatAmount).toFixed(2),amount:parseFloat(e.amount).toFixed(2),taxDetails:l}}));await el.setValues({...el.values,...a,plId:ee||el?.values?.plId,amount:a?.amount,vatAmount:a?.vatAmount,subtotal:a?.subtotal,weight:a?.weight,serials:l.length?l:el?.initialValues?.serials})}async function eb(e){if(!e)return[];let a=U.current;return a?a?.filter(a=>a.taxId===e):[]}let eF=el.values.search?el.values.serials.filter(e=>e.srlNo?.toString()?.includes(el.values.search)||e.sku?.toString()?.toLowerCase()?.includes(el.values.search.toLowerCase())||e.itemName?.toString()?.toLowerCase()?.includes(el.values.search.toLowerCase())||e.weight?.toString()?.includes(el.values.search)):el.values.serials,ew=(e,a,t)=>{if("delete"===a){let e=el.values.serials;e=e.filter(e=>e.id!==t.id),el.setFieldValue("serials",e),M(!0)}else el.setFieldValue("serials",e)};async function ej(e){if(e){let a=await T({extension:k.P.DocumentTypeDefault.get,parameters:`_dtId=${e}`});el.setFieldValue("plantId",a?.record?.plantId||null),el.setFieldValue("spId",a?.record?.spId||ea||null),el.setFieldValue("siteId",a?.record?.siteId||et||null)}}async function ek(){if(Object.keys(await el.validateForm()).length){let e=await el.validateForm(),a=Object.keys(e).reduce((e,a)=>(el.touched[a]||(e[a]=!0),e),{});Object.keys(a).length&&el.setTouched(a,!0)}}return(0,c.useEffect)(()=>{if(el?.values?.serials?.length){let a=el?.values?.serials,t=a.reduce((e,{metalId:a,weight:t,metalRef:l})=>(a&&(e[a]||(e[a]={metal:l,pcs:0,totalWeight:0}),e[a].pcs+=1,e[a].totalWeight+=parseFloat(t||0)),e),{});Object.keys(t).forEach(e=>{t[e].totalWeight=parseFloat(t[e].totalWeight.toFixed(2))}),el.setFieldValue("metalGridData",Object.values(t));var e=0;let l=a.reduce((a,{sku:t,itemId:l,itemName:r,weight:s,categoryName:n})=>(l&&(a[l]||(e++,a[l]={sku:t,pcs:0,weight:0,itemName:r,seqNo:e,categoryName:n}),a[l].pcs+=1,a[l].weight=parseFloat((a[l].weight+parseFloat(s||0)).toFixed(2))),a),{});el.setFieldValue("itemGridData",Object.values(l).sort((e,a)=>e.seqNo-a.seqNo))}},[el?.values?.serials]),(0,c.useEffect)(()=>{if(!el.values.serials?.length)return;let e=eu(el.values.serials);el.setFieldValue("subtotal",e.subtotal),el.setFieldValue("vatAmount",e.vatAmount),el.setFieldValue("weight",e.weight),el.setFieldValue("amount",e.amount)},[el.values.serials]),(0,c.useEffect)(()=>{!async function(){ee||W({message:e.noSelectedplId}),await er(),el?.values?.recordId&&await es(el?.values?.recordId)}()},[]),r.jsx(u.Z,{resourceId:I.i.DraftSerialsInvoices,functionId:v.J.DraftSerialsIn,form:el,maxAccess:Q,previewReport:ei,isClosed:ed,actions:ey,editMode:ei,disabledSubmit:ed&&!ei,disabledSavedClear:ed&&!ei,children:(0,r.jsxs)(F.R,{children:[r.jsx(w.g,{children:(0,r.jsxs)(d(),{container:!0,spacing:2,children:[r.jsx(d(),{item:!0,xs:4,children:r.jsx(x.Z,{endpointId:k.P.DraftInvoice.pack,reducer:e=>e?.record?.documentTypes,name:"dtId",label:e.documentType,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],readOnly:ei,required:!0,valueField:"recordId",displayField:["reference","name"],values:el.values,maxAccess:Q,onChange:async(e,a)=>{el.setFieldValue("dtId",a?.recordId),await ej(a?.recordId),X(a)},error:el.touched.dtId&&!!el.errors.dtId})}),r.jsx(d(),{item:!0,xs:4,children:r.jsx(x.Z,{endpointId:k.P.DraftInvoice.pack,reducer:e=>e?.record?.sites,name:"siteId",readOnly:ed||el?.values?.serials?.some(e=>e.srlNo),label:e.site,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:el.values,required:!0,valueField:"recordId",displayField:["reference","name"],maxAccess:Q,onChange:(a,t)=>{t?.isInactive?(el.setFieldValue("siteId",null),W({message:e.inactiveSite})):el.setFieldValue("siteId",t?.recordId)},error:el.touched.siteId&&!!el.errors.siteId})}),r.jsx(d(),{item:!0,xs:2,children:r.jsx(x.Z,{endpointId:k.P.DraftInvoice.pack,reducer:e=>e?.record?.currencies,filter:e=>1===e.currencyType,name:"currencyId",label:e.currency,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],required:!0,readOnly:ed,values:el.values,maxAccess:Q,onChange:(e,a)=>{el.setFieldValue("currencyId",a?.recordId||null)},error:el.touched.currencyId&&!!el.errors.currencyId})}),r.jsx(d(),{item:!0,xs:2,children:r.jsx(h.Z,{name:"search",value:el.values.search,label:J.Search,onClear:()=>{el.setFieldValue("search","")},onChange:e=>{let{value:a}=e.target;el.setFieldValue("search",a)},onSearch:e=>el.setFieldValue("search",e),search:!0})}),r.jsx(d(),{item:!0,xs:4,children:r.jsx(h.Z,{name:"reference",label:e.reference,value:el?.values?.reference,maxAccess:!ei&&Q,readOnly:ei,onChange:el.handleChange,onClear:()=>el.setFieldValue("reference",""),error:el.touched.reference&&!!el.errors.reference})}),r.jsx(d(),{item:!0,xs:4,children:r.jsx(x.Z,{endpointId:k.P.DraftInvoice.pack,reducer:e=>e?.record?.plants,name:"plantId",label:e.plant,readOnly:!0,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:el.values,valueField:"recordId",displayField:["reference","name"],maxAccess:Q,onChange:(e,a)=>{el.setFieldValue("plantId",a?.recordId)},error:el.touched.plantId&&!!el.errors.plantId})}),r.jsx(d(),{item:!0,xs:4,children:r.jsx(x.Z,{endpointId:el?.values?.clientId&&k.P.Contact.contact,parameters:`_clientId=${el.values.clientId}`,name:"contactId",label:e.contact,readOnly:ed,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:el.values,valueField:"recordId",displayField:["reference","name"],maxAccess:Q,onChange:(e,a)=>{el.setFieldValue("contactId",a?.recordId||null)},error:el.touched.contactId&&!!el.errors.contactId})}),r.jsx(d(),{item:!0,xs:4,children:r.jsx(s.Z,{name:"date",required:!0,label:e.postingDate,value:el?.values?.date,onChange:el.setFieldValue,editMode:ei,readOnly:ed,maxAccess:Q,onClear:()=>el.setFieldValue("date",""),error:el.touched.date&&!!el.errors.date})}),r.jsx(d(),{item:!0,xs:4,children:r.jsx(x.Z,{endpointId:k.P.DraftInvoice.pack,reducer:e=>e?.record?.salesPeople,name:"spId",required:!0,label:e.salesPerson,columnsInDropDown:[{key:"spRef",value:"Reference"},{key:"name",value:"Name"}],readOnly:ed,valueField:"recordId",displayField:"name",values:el.values,onChange:(e,a)=>{el.setFieldValue("spId",a?.recordId||null)},error:el.touched.spId&&!!el.errors.spId})}),r.jsx(d(),{item:!0,xs:4,children:r.jsx(x.Z,{endpointId:k.P.DraftInvoice.pack,reducer:e=>e?.record?.taxSchedules,name:"taxId",label:e.tax,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],readOnly:!0,values:el.values,maxAccess:Q,onChange:(e,a)=>{el.setFieldValue("taxId",a?.recordId||null)},error:el.touched.taxId&&!!el.errors.taxId})}),r.jsx(d(),{item:!0,xs:8,children:r.jsx(d(),{item:!0,xs:12,children:r.jsx(y.U,{endpointId:k.P.Client.snapshot,filter:{isInactive:!1},valueField:"reference",displayField:"name",secondFieldLabel:e.name,name:"clientId",label:e.client,form:el,required:!0,readOnly:ed,displayFieldWidth:2,firstFieldWidth:3,valueShow:"clientRef",secondValueShow:"clientName",maxAccess:Q,editMode:ei,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"},{key:"szName",value:"Sales Zone"},{key:"keywords",value:"Keywords"},{key:"cgName",value:"Client Group"}],onChange:async(e,a)=>{el.setFieldValue("clientName",a?.name),el.setFieldValue("clientRef",a?.reference),el.setFieldValue("accountId",a?.accountId),el.setFieldValue("isVattable",a?.isSubjectToVAT||!1),el.setFieldValue("taxId",a?.taxId),el.setFieldValue("clientId",a?.recordId||null)},errorCheck:"clientId"})})}),r.jsx(d(),{item:!0,xs:4,children:r.jsx(f.Z,{name:"description",label:e.description,value:el.values.description,rows:1.25,editMode:ei,readOnly:ed,maxAccess:Q,onChange:e=>el.setFieldValue("description",e.target.value),onClear:()=>el.setFieldValue("description",""),error:el.touched.description&&!!el.errors.description})})]})}),r.jsx(g.Q,{children:r.jsx(b._,{onChange:(e,a,t)=>ew(e,a,t),value:eF||[],error:el.errors.serials,initialValues:el?.initialValues?.serials?.[0],columns:eI,name:"serials",maxAccess:Q,disabled:ed||Object.entries(el?.errors||{}).filter(([e])=>"serials"!==e).length>0,allowDelete:!ed,allowAddNewLine:!el?.values?.search&&(el.values?.serials?.length===0||!!el.values?.serials?.[el.values?.serials?.length-1]?.srlNo),autoDelete:ec,onValidationRequired:ek})}),(0,r.jsxs)(d(),{container:!0,spacing:2,children:[r.jsx(d(),{item:!0,xs:6.5,sx:{display:"flex",flex:1},children:r.jsx(V.Z,{name:"item",columns:[{field:"seqNo",headerName:e.seqNo,type:"number",flex:.75},{field:"sku",headerName:e.sku,flex:1},{field:"itemName",headerName:e.itemDesc,flex:2},{field:"categoryName",headerName:e.category,flex:2},{field:"pcs",headerName:e.pcs,type:"number",flex:1},{field:"weight",headerName:e.weight,type:"number",flex:1}],gridData:{count:1,list:el?.values?.itemGridData},rowId:["sku"],maxAccess:a,pagination:!1})}),r.jsx(d(),{item:!0,xs:3,sx:{display:"flex",flex:1},children:r.jsx(V.Z,{name:"metal",gridData:{count:1,list:el?.values?.metalGridData},maxAccess:a,columns:[{field:"metal",headerName:e.metal,flex:1},{field:"pcs",headerName:e.pcs,type:"number",flex:1},{field:"totalWeight",headerName:e.totalWeight,type:"number",flex:1}],rowId:["metal"],pagination:!1})}),r.jsx(d(),{item:!0,xs:.5}),r.jsx(d(),{item:!0,xs:2,children:(0,r.jsxs)(d(),{container:!0,spacing:2,children:[r.jsx(d(),{item:!0,xs:12}),r.jsx(d(),{item:!0,xs:12,children:r.jsx(j.Z,{name:"weight",maxAccess:Q,label:e.totalWeight,value:el.values.weight,readOnly:!0})}),r.jsx(d(),{item:!0,xs:12}),r.jsx(d(),{item:!0,xs:12,children:r.jsx(j.Z,{name:"subtotal",maxAccess:Q,label:e.subtotal,value:el.values.subtotal,readOnly:!0})}),r.jsx(d(),{item:!0,xs:12,children:r.jsx(j.Z,{name:"vatAmount",maxAccess:Q,label:e.vat,value:el.values.vatAmount,readOnly:!0})}),r.jsx(d(),{item:!0,xs:12,children:r.jsx(j.Z,{name:"amount",maxAccess:Q,label:e.total,value:el.values.amount,readOnly:!0})})]})})]})]})})};$.width=1300,$.height=750;let E=$;l()}catch(e){l(e)}})},7801:(e,a,t)=>{"use strict";t.a(e,async(e,l)=>{try{t.d(a,{Z:()=>u});var r=t(20997),s=t(60520),n=t(99912),i=t(16689),d=t(96119),c=e([s,n]);[s,n]=c.then?(await c)():c;let o=({window:e,onConfirm:a,fullScreen:t,open:l,dialogText:c})=>{let{platformLabels:o}=(0,i.useContext)(s.l);return(0,d.Z)({title:o.import,window:e}),r.jsx(n.Z,{open:l?.flag||!1,DialogText:c,okButtonAction:()=>{"function"==typeof a&&a(),e.close()},fullScreen:t,cancelButtonAction:()=>e.close(),height:"140px"})};o.width=470,o.height=170;let u=o;l()}catch(e){l(e)}})},13893:(e,a,t)=>{"use strict";t.a(e,async(e,l)=>{try{t.d(a,{Z:()=>w});var r=t(20997),s=t(16689),n=t(99155),i=t.n(n),d=t(18611),c=t(44619),o=t(65980),u=t(2296),m=t(60520),p=t(7801),I=t(677),h=t(29352),f=t(86201),x=t(23385),v=t(70755),y=t(96119),g=t(18687),b=e([m,p,I,h,f,g]);[m,p,I,h,f,g]=b.then?(await b)():b;let F=({endPoint:e,header:a,onCloseimport:t,maxAccess:l,window:n})=>{let{stack:b}=(0,I.zY)(),{platformLabels:F}=(0,s.useContext)(m.l),w=(0,s.useRef)(null),[j,k]=(0,s.useState)(null),[N,C]=(0,s.useState)([]),{postRequest:A}=(0,s.useContext)(h.$);(0,y.Z)({title:F.importSerials,window:n});let P=(0,u.useFormik)({initialValues:{serials:"",serialCount:0}}),D=e=>{let a=e.split("\n").filter(e=>""!==e.trim()).length;P.setFieldValue("serialCount",a)},S=async()=>{b({Component:p.Z,props:{open:{flag:!0},fullScreen:!1,onConfirm:V,dialogText:F.importConfirmation}})},V=async()=>{let l=P.values.serials?.replace(/\n/g,",\r\n"),r={...a,serials:l||N};await A({extension:e,record:JSON.stringify(r)}),f.default.success(F.Imported),t(),n.close()},O=[{key:"Import",condition:!0,onClick:S,disabled:!j?.name&&!P?.values?.serials}];return r.jsx(g.Z,{actions:O,onSave:()=>S(),disabledSubmit:!j?.name&&!P?.values?.serials,isSaved:!1,children:(0,r.jsxs)(d.R,{children:[r.jsx(x.Q,{children:(0,r.jsxs)(i(),{container:!0,spacing:2,children:[r.jsx(i(),{item:!0,xs:7,children:r.jsx(c.Z,{name:"name",label:F.SelectCSV,value:j?.name,disabled:P.values.serials||!!j?.name,readOnly:!0,maxAccess:l})}),r.jsx(i(),{item:!0,xs:3,children:r.jsx(v.Z,{onClick:()=>{w.current.click()},label:`${F.Browse}...`,color:"primary",disabled:!!j?.name||P.values.serials})}),r.jsx(i(),{item:!0,xs:2,children:r.jsx(v.Z,{image:"clear.png",onClick:()=>{k(null),C([]),w.current.value=null},label:F.Clear,color:"#f44336"})}),(0,r.jsxs)(i(),{item:!0,xs:12,children:[P.values.serialCount>0&&(0,r.jsxs)("label",{style:{marginBottom:"8px",display:"block"},maxAccess:l,children:[F.serials," ( ",P.values.serialCount," )"]}),r.jsx(o.Z,{name:"serials",label:F.serials,value:P.values.serials,rows:3,readOnly:j?.name,onChange:e=>{P.setFieldValue("serials",e.target.value),D(e.target.value)},onClear:()=>{P.setFieldValue("serials",""),P.setFieldValue("serialCount",0)},error:P.touched.serials&&!!P.errors.serials,maxAccess:l})]})]})}),r.jsx("input",{type:"file",accept:".csv",ref:w,style:{display:"none"},onChange:e=>{let a=e.target.files[0];if(k(a),a){let e=new FileReader;e.onload=e=>{let a=e.target.result;C(a)},e.readAsText(a)}}})]})})};F.width=550,F.height=270;let w=F;l()}catch(e){l(e)}})},70638:(e,a,t)=>{"use strict";t.a(e,async(e,l)=>{try{t.d(a,{Z:()=>f});var r=t(20997),s=t(16689),n=t(97996),i=t(29352),d=t(73846),c=t(96119),o=t(60520),u=t(20562),m=t(3),p=t.n(m),I=e([i,d,o]);[i,d,o]=I.then?(await I)():I;let h=({functionId:e,recordId:a,window:t})=>{let{getRequest:l}=(0,s.useContext)(i.$),{languageId:m}=(0,s.useContext)(d.V),{platformLabels:I}=(0,s.useContext)(o.l),h=a+"-"+e;(0,c.Z)({title:I.WorkFlow,window:t});let{width:f}=(0,u.d)(),x=f<=1024,v=f>1024&&f<=1280,y=x?10:v?12:14,g=x?75:v?85:95,b=x?15:v?20:25,F=async()=>{var t=`_functionId=${e}&_recordId=${a}`;let r=await l({extension:n.P.WorkFlow.graph,parameters:t});return r?.record},w=e=>{let a=[],t=[],l="",r="";return e.objects.forEach(e=>{a.push({functionName:e.functionName,reference:e.reference,date:e.date})}),e.workflow.forEach(a=>{e.objects.forEach(e=>{let t=e.functionName.split(" ").join("\r\n");a.parentId===e.recordId&&a.parentFunctionId===e.functionId&&(l=e.reference+"\r\n"+e.date+"\r\n"+t,a.parentId),a.childId===e.recordId&&a.childFunctionId===e.functionId&&(r=e.reference+"\r\n"+e.date+"\r\n"+t,a.childId)}),""===l||""===r||t.push({from:l,to:r,value:1,labelText:""}),l="",r=""}),t};return(0,s.useEffect)(()=>{!async function(){var e=await F();if(e){let a=(e,a)=>{let t=document.createElement("script");t.type="text/javascript",t.src=e,t.async=!0,t.onload=a,document.head.appendChild(t)};a("https://cdn.amcharts.com/lib/4/core.js",()=>{a("https://cdn.amcharts.com/lib/4/charts.js",()=>{a("https://cdn.amcharts.com/lib/4/themes/animated.js",()=>{am4core.ready(()=>{let a=am4core.create(h,am4charts.SankeyDiagram),t=w(e);a.data=t,a.dataFields.fromName="from",a.dataFields.toName="to",a.dataFields.value="value",a.paddingRight=2===m?0:40,a.paddingLeft=2===m?40:0,a.tooltip.label.fontSize=y;let l=a.nodes.template;l.draggable=!1,l.inert=!0,l.clickable=!1,l.width=g,l.height=b,l.nameLabel.label.fontSize=y,l.nameLabel.locationX=2===m?.85:0,l.nameLabel.height=void 0,l.nameLabel.label.fontWeight="bold";let r=a.links.template;r.middleLine.strokeOpacity=.3,r.middleLine.stroke=am4core.color("#555"),r.middleLine.strokeWidth=5,r.middleLine.hoverable=!1,r.fillOpacity=0,r.hoverable=!0,r.hoverOnFocus=!0,r.fill=am4core.color("#A8C686"),r.isHover=!0,a.appear(1e3,100)})})})})}}()},[]),r.jsx("div",{id:h,className:p().root})};h.width=950;let f=h;l()}catch(e){l(e)}})}};