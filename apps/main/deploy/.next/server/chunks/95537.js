"use strict";exports.id=95537,exports.ids=[95537],exports.modules={95537:(e,a,r)=>{r.a(e,async(e,n)=>{try{r.d(a,{Z:()=>M});var t=r(20997),s=r(16689),o=r(99155),d=r.n(o),l=r(75609),c=r(44619),i=r(80582),u=r(6416),m=r(71278),f=r(61932),p=r(29352),I=r(79660),h=r(38509),y=r(27736),C=r(86201),x=r(70305),v=r(68728),A=r(15105),b=r(15051),g=r(65980),w=r(16774),F=r(79390),k=r(18611),j=r(42020),N=r(23385),P=r(677),q=r(95965),V=r(4902),R=r(19138),S=r(43991),T=r(70638),D=r(86794),G=r(38782),O=r(96119),Z=e([i,m,p,h,C,x,A,b,P,T,D,G]);[i,m,p,h,C,x,A,b,P,T,D,G]=Z.then?(await Z)():Z;let _=({recordId:e,plantId:a,cashAccountId:r,dtId:n,refetch:o,window:Z})=>{let[_,M]=(0,s.useState)(!!e),{getRequest:$,postRequest:J}=(0,s.useContext)(p.$),{stack:B}=(0,x.V)(),{stack:L}=(0,P.zY)(),[E,H]=(0,s.useState)(!1),[U,W]=(0,s.useState)(!0),z=(0,h.E)({endpointId:f.G.CashTransfer.page}),{labels:Q,access:Y}=(0,G.Z)({datasetId:u.i.CashTransfer,editMode:!!e});(0,O.Z)({title:Q.cashTransfer,window:Z});let[K,X]=(0,s.useState)({recordId:e||null,dtId:parseInt(n),reference:"",date:new Date,toPlantId:parseInt(a),fromPlantId:parseInt(a),fromCashAccountId:parseInt(r),toCashAccountId:"",baseAmount:"",notes:"",wip:"",status:"",statusName:"",releaseStatus:"",rsName:"",wipName:"",transfers:[{id:1,transferId:e||0,seqNo:"",currencyId:"",currencyName:"",currencyRef:"",amount:"",baseAmount:"",exRate:"",rateCalcMethod:"",balance:0}]}),{maxAccess:ee}=(0,D.H)({functionId:v.J.CashTransfer,access:Y,enabled:!e,hasDT:!1}),{formik:ea}=(0,q.c)({maxAccess:ee,initialValues:K,validateOnChange:!0,validationSchema:l.object({fromCashAccountId:l.string().required(),fromPlantId:l.string().required(),date:l.string().required(),toPlantId:l.string().required(),toCashAccountId:l.string().nullable().test("",function(e){let{fromPlantId:a,toPlantId:r}=this.parent;return a!=r||!!e}),transfers:l.array().of(l.object().shape({currencyName:l.string().required(),amount:l.string().nullable().required()})).required()}),onSubmit:async e=>{let a={...e};delete a.transfers,a.date=(0,F.ku)(a.date),a.status=""===a.status?1:a.status,a.wip=""===a.wip?1:a.wip,a.baseAmount=er;let r=ea.values.transfers.map((e,a)=>({...e,seqNo:a+1,transferId:ea.values.recordId||0}));if(1===r.length&&""===r[0].currencyId){B({message:"Grid not filled. Please fill the grid before saving."});return}let n=await J({extension:f.G.CashTransfer.set,record:JSON.stringify({header:a,items:r})});if(n.recordId){C.default.success("Record Updated Successfully"),ea.setFieldValue("recordId",n.recordId),M(!0);let e=await $({extension:f.G.CashTransfer.get,parameters:`_recordId=${n.recordId}`});ea.setFieldValue("reference",e.record.reference),z()}}}),er=ea.values.transfers.reduce((e,a)=>{let r=parseFloat(a.baseAmount?.toString().replace(/,/g,""))||0;return e+r},0),en=async()=>{let{transfers:e,...a}=ea.values,r={...a};if(r.date=(0,F.ku)(r.date),r.wip=""===r.wip?1:r.wip,r.status=""===r.status?1:r.status,r.baseAmount=er,(await J({extension:f.G.CashTransfer.close,record:JSON.stringify(r)})).recordId){C.default.success("Record Closed Successfully"),z(),H(!0);let e=await $({extension:f.G.CashTransfer.get,parameters:`_recordId=${ea.values.recordId}`});e?.record?.status==4&&W(!1)}},et=async()=>{let{transfers:e,...a}=ea.values,r={...a};r.date=(0,F.ku)(r.date),r.wip=""===r.wip?1:r.wip,r.status=""===r.status?1:r.status,r.baseAmount=er,(await J({extension:f.G.CashTransfer.reopen,record:JSON.stringify(r)})).recordId&&(C.default.success("Record Closed Successfully"),z(),o&&(o(),Z.close()),H(!1),W(!0))},es=async(e,a)=>{let r=(await $({extension:f.G.CurrencyTransfer.qry,parameters:`_transferId=${e}`})).list.map(e=>({...e,id:e.seqNo,amount:parseFloat(e.amount).toFixed(2),balance:parseFloat(e?.balance).toFixed(2)??0}));ea.setValues({...a,transfers:r})},eo=async()=>{if(r){let e=await $({extension:f.G.CashAccount.get,parameters:`_recordId=${r}`});e.record&&(ea.setFieldValue("fromCARef",e.record.accountNo),ea.setFieldValue("fromCAName",e.record.name))}};(0,s.useEffect)(()=>{!async function(){if(e){let a=await $({extension:f.G.CashTransfer.get,parameters:`_recordId=${e}`});a.record.date=(0,F.a1)(a.record.date),H(2===a.record.wip),W(4!==a.record.status),await es(e,a.record)}else eo()}()},[]);let ed=async()=>{L({Component:T.Z,props:{functionId:v.J.CashTransfer,recordId:ea.values.recordId}})},el=[{key:"WorkFlow",condition:!0,onClick:ed,disabled:!_},{key:"Close",condition:!E,onClick:en,disabled:E||!_},{key:"Reopen",condition:E,onClick:et,disabled:!E||!_||3===ea.values.releaseStatus&&3===ea.values.status},{key:"Approval",condition:!0,onClick:"onApproval",disabled:!E},{key:"Shipment",condition:!0,onClick:()=>{L({Component:A.u,props:{recordId:ea.values.recordId,functionId:v.J.CashTransfer,editMode:E,totalBaseAmount:er}})},disabled:_&&ea.values.fromPlantId==ea.values.toPlantId||!_},{key:"Account Balance",condition:!0,onClick:"onClickAC",disabled:!1},{key:"Cash Transaction",condition:!0,onClick:"transactionClicked",disabled:!_}];return t.jsx(i.Z,{resourceId:u.i.CashTransfer,form:ea,editMode:_,maxAccess:ee,functionId:v.J.CashTransfer,actions:el,disabledSubmit:E,children:(0,t.jsxs)(k.R,{children:[t.jsx(j.g,{children:(0,t.jsxs)(d(),{container:!0,children:[(0,t.jsxs)(d(),{container:!0,rowGap:2,xs:6,sx:{px:2},spacing:2,children:[t.jsx(d(),{item:!0,xs:12,children:t.jsx(c.Z,{name:"reference",label:Q.reference,value:ea?.values?.reference,maxAccess:ee,maxLength:"15",readOnly:_,error:ea.touched.reference&&!!ea.errors.reference})}),t.jsx(d(),{item:!0,xs:12,children:t.jsx(m.Z,{endpointId:I.r.Plant.qry,name:"fromPlantId",label:Q.fromPlant,values:ea.values,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],readOnly:!0,required:!0,maxAccess:ee,onChange:(e,a)=>{ea&&ea.setFieldValue("fromPlantId",a?.recordId)},error:ea.touched.fromPlantId&&!!ea.errors.fromPlantId})}),t.jsx(d(),{item:!0,xs:12,children:t.jsx(m.Z,{endpointId:f.G.CashAccount.qry,parameters:"_type=0",name:"fromCashAccountId",label:Q.fromCashAcc,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:ea.values,readOnly:!0,required:!0,maxAccess:ee,onChange:(e,a)=>{ea.setFieldValue("fromCashAccountId",a?.recordId||null)},error:ea.touched.fromCashAccountId&&!!ea.errors.fromCashAccountId})})]}),(0,t.jsxs)(d(),{container:!0,rowGap:2,xs:6,sx:{px:2},spacing:2,children:[t.jsx(d(),{item:!0,xs:12,children:t.jsx(y.Z,{name:"date",required:!0,readOnly:E,label:Q.date,value:ea?.values?.date,onChange:ea.setFieldValue,editMode:_,maxAccess:ee,onClear:()=>ea.setFieldValue("date",""),error:ea.touched.date&&!!ea.errors.date})}),t.jsx(d(),{item:!0,xs:12,children:t.jsx(m.Z,{endpointId:I.r.Plant.qry,name:"toPlantId",label:Q.toPlant,values:ea.values,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],required:!0,readOnly:E,maxAccess:ee,onChange:(e,a)=>{ea.setFieldValue("toPlantId",a?a.recordId:null),ea.setFieldValue("toCashAccountId",null),ea.setFieldValue("toCARef",null),ea.setFieldValue("toCAName",null)},error:ea.touched.toPlantId&&!!ea.errors.toPlantId})}),t.jsx(d(),{item:!0,xs:12,children:t.jsx(m.Z,{endpointId:f.G.CashAccount.qry,parameters:"_type=0",name:"toCashAccountId",label:Q.toCashAcc,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],values:ea.values,required:ea.values.fromPlantId===ea.values.toPlantId,filter:e=>e.plantId===ea.values.toPlantId,readOnly:!ea.values.toPlantId||E,maxAccess:ee,onChange:(e,a)=>{ea.setFieldValue("toCashAccountId",a?.recordId||null)},error:ea.touched.toCashAccountId&&!!ea.errors.toCashAccountId})})]})]})}),t.jsx(N.Q,{children:t.jsx(b._,{onChange:e=>ea.setFieldValue("transfers",e),value:ea.values.transfers,error:ea.errors.transfers,allowDelete:!E,allowAddNewLine:!E,maxAccess:ee,initialValues:ea?.initialValues?.transfers?.[0],name:"currencies",columns:[{component:"resourcecombobox",label:Q.currency,name:"currencyName",props:{disabled:E,endpointId:I.r.Currency.qry,displayField:"reference",valueField:"recordId",mapping:[{from:"recordId",to:"currencyId"},{from:"name",to:"currencyName"},{from:"reference",to:"currencyRef"}],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}]},widthDropDown:200,displayFieldWidth:2,async onChange({row:{update:e,newRow:a}}){if(a?.currencyId&&a.currencyId){var r;let n=await (r=a?.currencyId,$({extension:V.q.Currency.get,parameters:`_currencyId=${r}&_date=${(0,F.Uf)(ea.values.date)}&_rateDivision=${R.B.FINANCIALS}`}));e({exRate:n.record?.exRate,rateCalcMethod:n.record?.rateCalcMethod})}}},{component:"numberfield",label:Q.amount,name:"amount",props:{readOnly:E},async onChange({row:{update:e,newRow:a}}){if(a?.amount&&a?.amount){let r=(0,S.fB)({amount:a?.amount,exRate:a?.exRate,baseAmount:a?.baseAmount,rateCalcMethod:a?.rateCalcMethod,dirtyField:S.H9});e({baseAmount:r.baseAmount})}}},{component:"numberfield",label:Q.baseAmount,name:"baseAmount",props:{readOnly:!0}},{component:"numberfield",name:"balance",label:Q.balance,props:{readOnly:!0}}]})}),t.jsx(j.g,{children:t.jsx(w.Z,{container:!0,rowGap:1,xs:7,style:{marginTop:"10px"},children:t.jsx(g.Z,{name:"notes",label:Q.note,value:ea.values.notes,rows:3,readOnly:E,maxLength:"100",editMode:_,maxAccess:ee,onChange:e=>ea.setFieldValue("notes",e.target.value),onClear:()=>ea.setFieldValue("notes","")})})})]})})};_.width=1100,_.height=650;let M=_;n()}catch(e){n(e)}})}};