"use strict";exports.id=32618,exports.ids=[32618],exports.modules={32618:(e,a,r)=>{r.a(e,async(e,t)=>{try{r.d(a,{Z:()=>L});var l=r(20997),n=r(99155),d=r.n(n),s=r(16689),u=r(75609),o=r(80582),c=r(29352),i=r(38509),m=r(6416),x=r(44619),h=r(95965),y=r(60520),v=r(18611),p=r(23385),I=r(27736),A=r(71278),f=r(68728),F=r(97969),C=r(86794),R=r(79390),w=r(65305),V=r(86201),g=r(61274),j=r(79660),N=r(91184),q=r(27559),_=r(677),O=r(74548),S=r(8995),b=r(5162),Z=r(67906),k=r(38782),M=r(96119),T=e([o,c,i,y,A,C,V,g,q,_,k]);[o,c,i,y,A,C,V,g,q,_,k]=T.then?(await T)():T;let E=({recordId:e,plantId:a,dtId:r,isOpenOutwards:t=!1,refetch:n,window:T})=>{let{getRequest:E,postRequest:L}=(0,s.useContext)(c.$),{platformLabels:B,defaultsData:D}=(0,s.useContext)(y.l),{stack:$}=(0,_.zY)(),{labels:J,access:U}=(0,k.Z)({datasetId:m.i.OutwardsReturn});(0,M.Z)({title:J.outwardsReturn,window:T});let{maxAccess:P}=(0,C.H)({functionId:f.J.OutwardsReturn,access:U,hasDT:!1}),H=(0,i.E)({endpointId:w.N.OutwardsReturn.page});async function G(e){return await E({extension:w.N.OutwardsReturn.get,parameters:`_recordId=${e}`})}async function Q(e){return await E({extension:w.N.OutwardsTransfer.get,parameters:`_recordId=${e}`})}let{formik:W}=(0,h.c)({initialValues:{recordId:e||null,dtId:r||null,reference:"",owt_Id:null,owt_reference:"",owt_rateCalcMethod:null,owt_exRate:null,ad_exRate:null,ad_rateCalcMethod:null,exRateChangeStatus:null,requestedBy:null,date:new Date,currencyId:null,corId:null,clientId:null,cashAccountId:null,wip:1,status:1,corReplyStatus:null,plantName:null,plantRef:null,currencyName:null,currencyRef:null,corName:null,corRef:null,plantId:parseInt(a),cashAccountName:null,cashAccountRef:null,fcAmount:"",productId:"",productName:"",dispersalType:null,dispersalName:null,corCurrencyId:null,corRateCalcMethod:null,corExRate:null,commission:null,vatAmount:null,reasonId:null,tdAmount:null,amount:null,exRate:null,rateCalcMethod:null,lcAmount:"",releaseStatus:null,otpVerified:!1,settlementStatus:null,interfaceId:null,attemptNo:1},maxAccess:P,validateOnChange:!0,validationSchema:u.object({date:u.string().required(),owt_Id:u.number().required(),owt_reference:u.string().required(),requestedBy:u.string().required(),currencyId:u.string().required(),clientId:u.number().required(),corId:u.number().required(),fcAmount:u.string().required(),dispersalName:u.string().required(),vatAmount:u.string().required(),settlementStatus:u.number().required(),reasonId:u.number().required(),lcAmount:u.string().required().test(function(e){let{amount:a}=this.parent;return parseFloat(e)<=parseFloat(a||0)}),exRate:u.string().required(),commission:u.string().required(),amount:u.string().required()}),onSubmit:async a=>{let r={...a};r.date=(0,R.ku)(r.date);let l=await L({extension:w.N.OutwardsReturn.set,record:JSON.stringify(r)});if(l.recordId){var d;V.default.success(B.Added);let a=await G(l.recordId);W.setValues({...a.record,cellPhone:a.record.cellPhone,date:(0,R.a1)(a.record.date)}),e||(d=l.recordId,$({Component:q.Z,props:{values:W.values,recordId:d,functionId:f.J.OutwardsReturn}})),t&&n(),en(l.recordId)}else V.default.success(B.Edited);H()}});async function Y(){let e=D?.list?.find(({key:e})=>"baseCurrencyId"===e)?.value;return e&&await W.setFieldValue("raCurrencyId",e),e}let z=(e,a,r)=>1===r?e*a:e/a,X=!!W.values.recordId,K=2===W.values.wip,ee=async e=>{let a=await L({extension:w.N.OutwardsReturn.close,record:JSON.stringify({recordId:W.values.recordId??e})});a.recordId&&(V.default.success(B.Closed),H(),en(a.recordId))},ea=async()=>{let e={...W.values};e.date=(0,R.ku)(e.date);let a=await L({extension:w.N.OutwardsReturn.reopen,record:JSON.stringify(e)});a.recordId&&(V.default.success(B.Reopened),H(),en(a.recordId))},er=3===W.values.status,et=async()=>{let e={...W.values};e.date=(0,R.ku)(e.date);let a=await L({extension:w.N.OutwardsReturn.post,record:JSON.stringify(e)});a.recordId&&(V.default.success(B.Posted),H(),en(a.recordId))},el=[{key:"Close",condition:!K,onClick:ee,disabled:K||!X},{key:"Reopen",condition:K,onClick:ea,disabled:!K||er},{key:"Locked",condition:!0,onClick:et,disabled:er||!X||!K},{key:"Approval",condition:!0,onClick:"onApproval",disabled:!K}],en=async e=>{let a=await Y(),r=await G(e),t=await Q(r?.record?.owt_Id);if(a){let e=await ed(r.record.plantId,r.record?.currencyId,t?.record?.rateTypeId,a),l=parseFloat(e?.rate);if(isNaN(l))return;let n=parseFloat(t?.record?.fcAmount||0);parseFloat(t?.record?.lcAmount||0);let d=parseInt(t?.record?.rateCalcMethod,10),s=z(n,l,d);W.setValues({...r.record,amount:t?.record?.amount,owt_lcAmount:t?.record?.lcAmount,derivedLcAmount:s,date:(0,R.a1)(r.record.date)})}};async function ed(e,a,r,t){if(e&&a&&r&&t)return(await E({extension:S.u.ExchangeMap.get,parameters:`_plantId=${e}&_currencyId=${a}&_rateTypeId=${r}&_raCurrencyId=${t}`})).record}(0,s.useEffect)(()=>{!async function(){e&&en(e)}()},[]),(0,s.useEffect)(()=>{!async function(){(e||X)&&await Y()}()},[e,X]);let es=(e,a)=>{e===a&&W.setFieldValue("exRateChangeStatus","1"),e<a&&W.setFieldValue("exRateChangeStatus","3"),e>a&&W.setFieldValue("exRateChangeStatus","2")};return l.jsx(o.Z,{resourceId:m.i.OutwardsReturn,form:W,maxAccess:P,actions:el,editMode:X,functionId:f.J.OutwardsReturn,previewReport:X,disabledSubmit:!t&&(er||K),children:l.jsx(v.R,{children:l.jsx(p.Q,{children:l.jsx(d(),{container:!0,spacing:2,sx:{pt:5,display:"flex"},children:(0,l.jsxs)(d(),{container:!0,item:!0,xs:12,spacing:2,sx:{display:"flex",flexDirection:"row"},children:[l.jsx(d(),{item:!0,xs:6,children:(0,l.jsxs)(b.Z,{title:"Outwards Transfer",children:[l.jsx(d(),{item:!0,xs:6,children:l.jsx(x.Z,{name:"reference",label:J.reference,value:W?.values?.reference,maxAccess:!X&&P,maxLength:"30",readOnly:X||er||K,onChange:W.handleChange,error:W.touched.reference&&!!W.errors.reference})}),l.jsx(d(),{item:!0,xs:6,children:l.jsx(I.Z,{name:"date",label:J.date,value:W.values?.date,required:!0,readOnly:er||K||t,onChange:W.setFieldValue,onClear:()=>W.setFieldValue("date",""),error:W.touched.date&&!!W.errors.date,maxAccess:P})}),l.jsx(d(),{item:!0,xs:6,children:l.jsx(g.U,{endpointId:w.N.OutwardsTransfer.snapshot,valueField:"reference",displayField:"reference",name:"owt_reference",secondDisplayField:!1,required:!0,label:J.outwards,form:W,readOnly:er||K||t,columnsInDropDown:[{key:"reference",value:"Ref."},{key:"amount",value:"Amount"},{key:"commission",value:"Commission"},{key:"corName",value:"Correspondent"},{key:"clientName",value:"Client Name"},{key:"currencyRef",value:"Currency Ref."}],displayFieldWidth:4,onChange:async(e,a)=>{W.setFieldValue("owt_Id",a?a.recordId:""),W.setFieldValue("owt_reference",a?a.reference:""),W.setFieldValue("owt_exRate",a?a.exRate:""),W.setFieldValue("owt_rateCalcMethod",a?a.rateCalcMethod:""),W.setFieldValue("owt_lcAmount",a?a.lcAmount:""),W.setFieldValue("clientId",a?a.clientId:""),W.setFieldValue("clientName",a?a.clientName:""),W.setFieldValue("clientRef",a?a.clientRef:""),W.setFieldValue("currencyId",a?a.currencyId:""),W.setFieldValue("currencyName",a?a.currencyName:""),W.setFieldValue("currencyRef",a?a.currencyRef:""),W.setFieldValue("fcAmount",a?a.fcAmount:""),W.setFieldValue("corId",a?a.corId:""),W.setFieldValue("corName",a?a.corName:""),W.setFieldValue("corRef",a?a.corRef:""),W.setFieldValue("corReplyStatus",a?a.corReplyStatus:""),W.setFieldValue("cashAccountId",a?a.cashAccountId:""),W.setFieldValue("cashAccountName",a?a.cashAccountName:""),W.setFieldValue("cashAccountRef",a?a.cashAccountRef:""),W.setFieldValue("dispersalType",a?a.dispersalType:""),W.setFieldValue("dispersalName",a?a.dispersalName:""),W.setFieldValue("corRateCalcMethod",a?a.corRateCalcMethod:""),W.setFieldValue("corExRate",a?a.corExRate:""),W.setFieldValue("commission",a?a.commission:""),W.setFieldValue("vatAmount",a?a.vatAmount:""),W.setFieldValue("tdAmount",a?a.tdAmount:""),W.setFieldValue("amount",a?a.amount:""),W.setFieldValue("releaseStatus",a?a.releaseStatus:""),W.setFieldValue("corCurrencyId",a?a.corCurrencyId:""),W.setFieldValue("productId",a?a.productId:""),W.setFieldValue("productName",a?a.productName:""),W.setFieldValue("rateTypeId",a?a.rateTypeId:""),W.setFieldValue("owt_Id",a?.recordId||"");let r=await Y(),[t,l]=await Promise.all([a?.corId?E({extension:O.d.Correspondent.get,parameters:`_recordId=${a?.corId}`}):Promise.resolve({record:{}}),ed(W.values?.plantId,a?.currencyId,a?.rateTypeId,r)]);W.setFieldValue("interfaceId",t?.record?.interfaceId);let n=parseFloat(a?.fcAmount||0),d=parseFloat(a?.lcAmount||0),s=parseInt(a?.rateCalcMethod,10),u=z(n,l?.rate,s);W.values.originalLcAmount||W.setFieldValue("originalLcAmount",Math.min(d,u)),W.setFieldValue("derivedLcAmount",u),W.setFieldValue("exRate",Math.min(parseFloat(a?.exRate||0),l?.rate||0)),W.setFieldValue("rateCalcMethod",Math.min(parseInt(a?.rateCalcMethod,10)||0,s)),W.setFieldValue("ad_exRate",l?.rate),W.setFieldValue("ad_rateCalcMethod",l?.rateCalcMethod)},error:W.touched.owt_reference&&!!W.errors.owt_reference,maxAccess:P})}),l.jsx(d(),{item:!0,xs:6,children:l.jsx(A.Z,{endpointId:j.r.Currency.qry,name:"currencyId",label:J.currency,valueField:"recordId",displayField:["reference","name"],maxAccess:P,values:W.values,error:W.touched.currencyId&&!!W.errors.currencyId,readOnly:X})}),l.jsx(d(),{item:!0,xs:6,children:l.jsx(N.Z,{name:"fcAmount",label:J.fcAmount,value:W?.values?.fcAmount,required:!0,readOnly:!0,maxAccess:P,onChange:W.handleChange,onClear:()=>W.setFieldValue("fcAmount",""),error:W.touched.fcAmount&&!!W.errors.fcAmount})}),l.jsx(d(),{item:!0,xs:6,children:l.jsx(N.Z,{name:"owt_lcAmount",label:J.lcAmount,value:W?.values?.owt_lcAmount,required:!0,readOnly:!0,maxAccess:P,onChange:W.handleChange,onClear:()=>W.setFieldValue("owt_lcAmount",""),error:W.touched.owt_lcAmount&&!!W.errors.owt_lcAmount})}),l.jsx(d(),{item:!0,xs:6,children:l.jsx(x.Z,{name:"dispersalName",label:J.dispersalName,value:W?.values?.dispersalName,onChange:W.handleChange,error:W.touched.dispersalName&&!!W.errors.dispersalName,maxAccess:P,readOnly:!0,required:!0})}),l.jsx(d(),{item:!0,xs:6,children:l.jsx(g.U,{readOnly:!0,valueField:"reference",displayField:"name",name:"clientId",label:J.client,form:W,required:!0,displayFieldWidth:2,valueShow:"clientRef",secondValueShow:"clientName",maxAccess:P,error:W.touched.clientId&&!!W.errors.clientId})}),l.jsx(d(),{item:!0,xs:6,children:l.jsx(N.Z,{name:"owt_exRate",label:J.exRate,value:W?.values?.owt_exRate,required:!0,readOnly:!0,maxAccess:P})}),l.jsx(d(),{item:!0,xs:6,children:l.jsx(x.Z,{name:"productName",label:J.product,value:W?.values?.productName,onChange:W.handleChange,error:W.touched.productName&&!!W.errors.productName,maxAccess:P,readOnly:!0})}),l.jsx(d(),{item:!0,xs:6,children:l.jsx(N.Z,{name:"commission",label:J.commission,value:W?.values?.commission,required:!0,readOnly:!0,maxAccess:P,error:W.touched.commission&&!!W.errors.commission})}),l.jsx(d(),{item:!0,xs:6,children:l.jsx(N.Z,{name:"vatAmount",label:J.vatAmount,value:W?.values?.vatAmount,readOnly:!0,required:!0,maxAccess:P,onChange:W.handleChange,onClear:()=>W.setFieldValue("vatAmount",""),error:W.touched.vatAmount&&!!W.errors.vatAmount})}),l.jsx(d(),{item:!0,xs:12,children:l.jsx(g.U,{valueField:"reference",displayField:"name",name:"corId",label:J.correspondent,form:W,required:!0,valueShow:"corRef",secondValueShow:"corName",readOnly:!0,maxAccess:P,error:W.touched.corId&&!!W.errors.corId})}),l.jsx(d(),{item:!0,xs:6,children:l.jsx(N.Z,{name:"tdAmount",label:J.tdAmount,value:W?.values?.tdAmount,readOnly:!0,maxAccess:P,onChange:W.handleChange,onClear:()=>W.setFieldValue("tdAmount",""),error:W.touched.tdAmount&&!!W.errors.tdAmount})}),l.jsx(d(),{item:!0,xs:6,children:l.jsx(Z.Z,{name:"otpVerified",value:W.values?.otpVerified,onChange:e=>W.setFieldValue("otpVerified",e.target.checked),label:J.otpVerified,disabled:!0,maxAccess:U})}),l.jsx(d(),{item:!0,xs:6,children:l.jsx(N.Z,{name:"amount",label:J.amount,value:W?.values?.amount,required:!0,readOnly:!0,maxAccess:P,onChange:W.handleChange,onClear:()=>W.setFieldValue("amount",""),error:W.touched.amount&&!!W.errors.amount})})]})}),(0,l.jsxs)(d(),{item:!0,xs:6,children:[(0,l.jsxs)(b.Z,{title:"Calculated",children:[l.jsx(d(),{item:!0,xs:12,children:l.jsx(A.Z,{datasetId:F.v.REQUESTED_BY,name:"requestedBy",label:J.requestedBy,valueField:"key",displayField:"value",values:W.values,required:!0,readOnly:er||K||t,maxAccess:P,onChange:(e,a)=>{W.setFieldValue("requestedBy",a?.key)},error:W.touched.requestedBy&&!!W.errors.requestedBy})}),l.jsx(d(),{item:!0,xs:12,children:l.jsx(A.Z,{endpointId:w.N.OutwardReturnReason.qry,name:"reasonId",label:J.returnReason,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],filter:e=>{let a=W.values.requestedBy;return"1"===a?e.company:"2"===a?e.correspondant:"3"!==a||e.client},values:W.values,onChange:(e,a)=>{if(W.setFieldValue("reasonId",a?a?.recordId:""),a?.rateStatus=="1")W.setFieldValue("lcAmount",W.values.amount),es(W?.values?.amount,W?.values?.amount);else if(a?.rateStatus=="2")W.setFieldValue("lcAmount",W.values.derivedLcAmount),es(W?.values?.amount,W?.values?.derivedLcAmount);else if(a?.rateStatus=="3"){let e=W.values.originalLcAmount;W.setFieldValue("lcAmount",Math.min(W.values.amount,W.values.derivedLcAmount)),es(W?.values?.amount,e)}},required:!0,maxAccess:P,error:W.touched.reasonId&&!!W.errors.reasonId,readOnly:er||K||t||!W.values.requestedBy})}),l.jsx(d(),{item:!0,xs:12,children:l.jsx(A.Z,{datasetId:F.v.SETTLEMENT_STATUS,name:"settlementStatus",label:J.settlementStatus,valueField:"key",displayField:"value",values:W.values,onChange:(e,a)=>{W.setFieldValue("settlementStatus",a?.key)},defaultIndex:W?.values?.interfaceId&&0,required:!0,readOnly:!e||t&&!!W.values.interfaceId||!t&&(er||K||!!W.values.interfaceId),maxAccess:P,error:W.touched.settlementStatus&&!!W.errors.settlementStatus})}),l.jsx(d(),{item:!0,xs:12,children:l.jsx(N.Z,{name:"ad_exRate",label:J.exRate,value:W?.values?.ad_exRate,required:!0,readOnly:!0,maxAccess:P,onChange:W.handleChange,onClear:()=>W.setFieldValue("ad_exRate",""),error:W.touched.ad_exRate&&!!W.errors.ad_exRate})}),l.jsx(d(),{item:!0,xs:12,children:l.jsx(N.Z,{name:"derivedLcAmount",label:J.amount,value:W?.values?.derivedLcAmount,required:!0,readOnly:!0})})]}),(0,l.jsxs)(b.Z,{title:"Amount",children:[l.jsx(d(),{item:!0,xs:12,children:l.jsx(N.Z,{name:"lcAmount",label:J.lcAmount,value:W?.values?.lcAmount,required:!0,readOnly:!0,maxAccess:P,onChange:W.handleChange,onClear:()=>W.setFieldValue("lcAmount",""),error:W.touched.lcAmount&&!!W.errors.lcAmount})}),l.jsx(d(),{item:!0,xs:12,children:l.jsx(A.Z,{datasetId:F.v.EXCHANGE_RATE_CHANGE_STATUS,name:"exRateChangeStatus",label:J.exRateChangeStatus,valueField:"key",displayField:"value",values:W.values,required:!0,readOnly:!0,maxAccess:P})})]})]})]})})})})})};E.width=1200,E.height=630;let L=E;t()}catch(e){t(e)}})}};