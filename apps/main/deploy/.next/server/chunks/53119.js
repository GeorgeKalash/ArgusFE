exports.id=53119,exports.ids=[53119],exports.modules={10593:e=>{e.exports={radioGroup:"CustomRadioButtonGroup_radioGroup__nJ_DE",radio:"CustomRadioButtonGroup_radio__n8LPY"}},59085:(e,a,t)=>{"use strict";t.d(a,{Z:()=>f});var l=t(20997);t(16689);var n=t(17581),i=t.n(n),r=t(47501),s=t.n(r),d=t(68931),o=t.n(d),c=t(66829),u=t(10593),m=t.n(u),p=t(86085),h=t.n(p);let f=({options:e=[],value:a,onChange:t,row:n=!0,maxAccess:r,name:d,readOnly:u,hidden:p,required:f=!1,...y})=>{let{_readOnly:I,_required:x,_hidden:v}=(0,c.W)(d,r,f,u,p),g=I||v;return v?null:l.jsx(i(),{row:n,value:a,onChange:t,className:m().radioGroup,...y,children:e.map(({label:e,value:a,disabled:t=!1})=>l.jsx(s(),{value:a,disabled:g||t,required:x,label:e,classes:{label:h().inputLabel},control:l.jsx(o(),{className:m().radio,classes:{root:h().outlinedRoot}})},a))})}},22552:(e,a,t)=>{"use strict";t.a(e,async(e,l)=>{try{t.d(a,{Z:()=>p});var n=t(20997);t(16689);var i=t(2296),r=t(99155),s=t.n(r),d=t(44619),o=t(80582),c=t(18611),u=t(23385),m=e([o]);function p({formik:e,labels:a,window:t}){let l=(0,i.useFormik)({validateOnChange:!0,initialValues:{idNo:e.values.idNo,cellPhone:e.values.cellPhone,idNoRepeat:"",cellPhoneRepeat:""},validate:a=>{let t={};return e.values.clientId||a.cellPhoneRepeat||a.idNoRepeat?!e.values.clientId&&a.cellPhoneRepeat&&a.cellPhone!==a.cellPhoneRepeat&&(t.cellPhoneRepeat="Cell Phone must match"):t.cellPhoneRepeat="Cell Phone Confirm is required",a.idNoRepeat||a.cellPhoneRepeat?a.idNoRepeat&&a.idNo.toString()!=a.idNoRepeat.toString()&&(t.idNoRepeat="Id Number must match"):t.idNoRepeat="Id number Confirm is required",t},onSubmit:a=>{e.setFieldValue("cellPhoneConfirm",a?.cellPhoneRepeat),e.setFieldValue("idNoConfirm",a?.idNoRepeat),e.handleSubmit(),t.close()}});return n.jsx(n.Fragment,{children:n.jsx(o.Z,{form:l,isInfo:!1,children:n.jsx(c.R,{children:n.jsx(u.Q,{children:(0,n.jsxs)(s(),{container:!0,spacing:2,children:[n.jsx(s(),{item:!0,xs:12,sx:{position:"relative",width:"100%"},children:n.jsx(d.Z,{name:"idNoRepeat",label:a.confirmIdNumber,value:l.values?.idNoRepeat,onChange:l.handleChange,maxLength:"15",onClear:()=>{l.setFieldValue("idNoRepeat","")},error:l.touched.idNoRepeat&&!!l.errors.idNoRepeat,helperText:l.touched.idNoRepeat&&l.errors.idNoRepeat})}),!e.values.clientId&&n.jsx(s(),{item:!0,xs:12,sx:{position:"relative",width:"100%"},children:n.jsx(d.Z,{name:"cellPhoneRepeat",label:a.cellPhoneConfirm,value:l.values?.cellPhoneRepeat,onChange:l.handleChange,maxLength:"15",onClear:()=>{l.setFieldValue("cellPhoneRepeat","")},error:l.touched.cellPhoneRepeat&&!!l.errors.cellPhoneRepeat,helperText:l.touched.cellPhoneRepeat&&l.errors.cellPhoneRepeat})})]})})})})})}o=(m.then?(await m)():m)[0],l()}catch(e){l(e)}})},53119:(e,a,t)=>{"use strict";t.a(e,async(e,l)=>{try{t.d(a,{Z:()=>W});var n=t(20997),i=t(99155),r=t.n(i),s=t(67906),d=t(16689),o=t(86201),c=t(27736),u=t(44619),m=t(91824),p=t(5162),h=t(68728),f=t(71278),y=t(70305),I=t(79390),x=t(29352),v=t(30967),g=t(8995),N=t(91370),C=t(79660),V=t(677),F=t(75609),_=t(29832),w=t(38509),b=t(22552),j=t(80582),R=t(15051),A=t(48395),k=t(16774),D=t(18611),P=t(91184),T=t(74548),Z=t(6416),O=t(86794),S=t(95965),$=t(23385),q=t(27559),E=t(60520),B=t(42207),M=t(98081),L=t(97969),J=t(12127),U=t(59085),Y=t(38782),G=t(96119),K=t(23267),z=t(70755),H=e([o,m,f,y,x,V,_,w,b,j,R,O,q,E,M,J,Y,K]);[o,m,f,y,x,V,_,w,b,j,R,O,q,E,M,J,Y,K]=H.then?(await H)():H;let Q=({recordId:e,plantId:a,window:t})=>{let{getRequest:l,postRequest:i}=(0,d.useContext)(x.$),[H,Q]=(0,d.useState)(!1),[W,X]=(0,d.useState)(!1),{stack:ee}=(0,y.V)(),{stack:ea}=(0,V.zY)(),[et,el]=(0,d.useState)([]),[en]=(0,_.Z)(),[ei,er]=(0,d.useState)(null),[es,ed]=(0,d.useState)(null),[eo,ec]=(0,d.useState)(null),[eu,em]=(0,d.useState)(h.J.CurrencyPurchase),{platformLabels:ep}=(0,d.useContext)(E.l),[eh,ef]=(0,d.useState)({});async function ey(e){e||eV.setFieldValue("id_type","");let a=await en(e);a&&eV.setFieldValue("id_type",a.recordId)}let eI=(0,w.E)({endpointId:A.s.CurrencyTrading.snapshot}),{labels:ex,access:ev}=(0,Y.Z)({datasetId:Z.i.CashInvoice,editMode:!!e});(0,G.Z)({title:ex?.cashInvoice,window:t});let eg={recordId:null,reference:null,operations:[{id:1,currencyId:"",oldNote:!1,fcAmount:"",defaultRate:"",exRate:"",lcAmount:"",minRate:"",maxRate:""}],amount:eh.initialValuePayment||[],date:"",clientId:null,clientName:null,clientType:"1",firstName:null,lastName:null,middleName:null,fl_firstName:null,fl_lastName:null,fl_middleName:null,birthDate:null,resident:!1,professionId:null,sponsorName:"",idNo:null,id_type:null,expiryDate:null,remarks:null,purpose_of_exchange:null,nationalityId:null,nationalityType:null,cellPhone:null,status:"1",type:-1,wip:1,functionId:h.J.CurrencyPurchase,idNoConfirm:"",cellPhoneConfirm:"",otp:!1,search:null},{maxAccess:eN}=(0,O.H)({functionId:eu,access:ev,hasDT:!1,enabled:!e});async function eC({key:e}){let a=await l({extension:N.L.CtClientIndividual.get3,parameters:`_key=${e}`});return X(!1),eV.setFieldValue("idNo",a?.record?.clientIDView.idNo),eV.setFieldValue("firstName",a?.record?.clientIndividual.firstName),eV.setFieldValue("clientId",a?.record?.clientId),eV.setFieldValue("middleName",a?.record?.clientIndividual.middleName),eV.setFieldValue("lastName",a?.record?.clientIndividual.lastName),eV.setFieldValue("fl_firstName",a?.record?.clientIndividual.fl_firstName),eV.setFieldValue("fl_lastName",a?.record?.clientIndividual.fl_lastName),eV.setFieldValue("fl_middleName",a?.record?.clientIndividual.fl_middleName),eV.setFieldValue("birthDate",(0,I.a1)(a?.record?.clientIndividual.birthDate)),eV.setFieldValue("resident",a?.record?.clientIndividual.isResident),eV.setFieldValue("professionId",a?.record?.clientMaster.professionId),eV.setFieldValue("sponsorName",a?.record?.clientIndividual.sponsorName),eV.setFieldValue("id_type",a?.record?.clientIDView.idtId),eV.setFieldValue("nationalityId",a?.record?.clientMaster.nationalityId),eV.setFieldValue("nationalityType",a?.record?.clientMaster.nationalityId===195?1:2),eV.setFieldValue("cellPhone",a?.record?.clientMaster.cellPhone),eV.setFieldValue("expiryDate",(0,I.a1)(a?.record?.clientIDView.idExpiryDate)),X(!0),a.record}let{formik:eV}=(0,S.c)({maxAccess:eN,initialValues:eg,validateOnChange:!0,validateOnBlur:!0,validate:e=>{let a={},t=eF(e.operations);return t&&!e.id_type&&(a.id_type=" "),t&&!e.idNo&&(a.idNo=" "),t&&!e.birthDate&&(a.birthDate=" "),t&&!e.firstName&&(a.firstName=" "),t&&!e.lastName&&(a.lastName=" "),t&&!e.expiryDate&&(a.expiryDate=" "),t&&!e.nationalityId&&(a.nationalityId=" "),t&&!e.cellPhone&&(a.cellPhone=" "),t&&!e.professionId&&(a.professionId=" "),a},validationSchema:F.object({date:F.string().required(),nationalityType:F.number().required(),operations:F.array().of(F.object().shape({currencyId:F.string().test({name:"currencyId-last-row-check",message:"currencyId is required",test(e,a){let{parent:t}=a;return 1==t.id&&!!e||(1!=t.id||!!e)&&(t.id>1&&(!t.fcAmount||0==t.fcAmount)&&(!t.lcAmount||0==t.lcAmount)&&(!t.exRate||0==t.exRate)||e)}}),exRate:F.string().test({name:"exRate-last-row-check",message:"exRate is required",test(e,a){let{parent:t}=a;return 1==t.id&&!!e||(1!=t.id||!!e)&&(t.id>1&&!t.currencyId&&(!t.lcAmount||0==t.lcAmount)&&(!t.fcAmount||0==t.fcAmount)||e)}}),fcAmount:F.string().test({name:"fcAmount-last-row-check",message:"fcAmount is required",test(e,a){let{parent:t}=a;return 1==t.id&&!!e||(1!=t.id||!!e)&&(t.id>1&&!t.currencyId&&(!t.lcAmount||0==t.lcAmount)&&(!t.exRate||0==t.exRate)||e)}}),lcAmount:F.string().test({name:"fcAmount-last-row-check",message:"lcAmount is required",test(e,a){let{parent:t}=a;return 1==t.id&&!!e||(1!=t.id||!!e)&&(t.id>1&&!t.currencyId&&(!t.fcAmount||0==t.fcAmount)&&(!t.exRate||0==t.exRate)||e)}})})).required(),amount:eh?.paymentValidation}),onSubmit:async t=>{let n=t.operations[t.operations.length-1],r=!n.currencyId&&!n.currencyId&&!n.exRate&&!n.fcAmount,s=t.operations;if(r&&(s=t.operations?.filter((e,a)=>a!==t.operations.length-1)),!(!t?.idNoConfirm&&t?.clientId)&&(t?.clientId||t.cellPhoneConfirm||t?.idNoConfirm)||eb||t?.idNo===null){let{record:n}=await l({extension:C.r.UserFunction.get,parameters:`_userId=${eS}&_functionId=${t.functionId}`}),{dtId:r}=n,{record:d}=await l({extension:C.r.UserDefaults.get,parameters:`_userId=${eS}&_key=cashAccountId`}),{record:c}=await l({extension:g.u.Defaults.get,parameters:"_key=ct_minOtp_CIVAmount"}),u=t.clientId||0;console.log(eV.values.amount);let m={header:{recordId:t?.recordId||null,dtId:r,reference:t.reference,nationalityId:t.nationalityId,nationalityType:t.nationalityType,status:t.status,date:(0,I.ku)(t.date),functionId:t.functionId,plantId:a||t.plantId,clientId:eE<5e3&&!u?-1:u,cashAccountId:d.value,poeId:t.purpose_of_exchange,wip:t.wip,amount:eE,notes:t.remarks},items:s.map(({id:e,...a})=>({seqNo:e,...a})),clientMaster:{category:t.clientType,reference:null,name:null,flName:null,keyword:null,nationalityId:t.nationalityId,nationalityType:t.nationalityType,status:1,addressId:null,cellPhone:t.cellPhone,oldReference:null,otp:!1,createdDate:(0,I.ku)(t.date),expiryDate:t.expiryDate,professionId:t.professionId},clientIndividual:{clientId:eE<5e3&&!u?-1:u,firstName:t.firstName,lastName:t.lastName,middleName:t.middleName,fl_firstName:t.fl_firstName,fl_lastName:t.fl_lastName,fl_middleName:t.fl_middleName,birthDate:(0,I.ku)(t.birthDate),isResident:t.resident,sponsorName:t.sponsorName},clientID:{idNo:t.idNo,clientId:eE<5e3&&!u?-1:u,idtId:t.id_type,idExpiryDate:(0,I.ku)(t.expiryDate),idIssueDate:null,idCityId:null,isDiplomat:!1},cash:eV.values.amount.length>0&&eV.values.amount.map(({seqNo:e,types:a,cashAccountId:t,...l})=>({seqNo:e,cashAccountId:d.value,...l}))};if(t.idNo){let a=await eC({key:t.idNo});if(eE>c.value&&!e){if(!a?.clientRemittance){ee({message:"You need to create full KYC file for this client."});return}}else if(a?.clientId){let t=await l({extension:A.s.CurrencyTrading.get3,parameters:`_clientId=${a.clientId}`});if(parseInt(t.record.baseAmount)+parseInt(eE)>c.value&&!a.clientRemittance&&!e){ee({message:"You need to create full KYC file for this client."});return}}}let p=await i({extension:A.s.CurrencyTrading.set2,record:JSON.stringify(m)}),h=e?ep.Added:ep.Edited;o.default.success(h),eV.setFieldValue("recordId",p.recordId);let f=await eO(p.recordId);(eE>c.value||totalBaseAmount>c.value)&&!e&&eL(p.recordId,f),eI()}else ea({Component:b.Z,props:{formik:eV,labels:ex},title:ex.confirmation,width:400,height:400})}}),eF=e=>e.reduce((e,a)=>{let t=parseFloat(a.lcAmount?.toString()?.replace(/,/g,""))||0;return e+t},0)>=5e3,e_=eV.values.operations.filter(e=>1!==e.id&&!e.currencyId&&!e.currencyRef&&!e.exRate&&(!e.fcAmount||0==e.fcAmount)&&(!e.lcAmount||0==e.lcAmount)),ew=async a=>{let t=await l({extension:A.s.CurrencyTrading.get2,parameters:`_recordId=${eV.values.recordId??a}`}),n=t?.record,r={recordId:n.headerView?.recordId,reference:n.headerView?.reference,nationalityId:n.headerView?.nationalityId,nationalityType:n.headerView?.nationalityType,status:n.headerView?.status,functionId:n.headerView?.functionId,plantId:n.headerView?.plantId,clientId:n.headerView?.clientId,cashAccountId:n.headerView.cashAccountId,poeId:n.headerView?.poeId,wip:n.headerView?.wip,otpVerified:n.headerView?.otpVerified,amount:String(eE||"").replaceAll(",",""),notes:n.headerView?.notes},s=await i({extension:A.s.CurrencyTrading.close,record:JSON.stringify(r)});if(s.recordId){e&&o.default.success(ep.Closed),eV.setFieldValue("recordId",s.recordId);let a=await eO(s.recordId);eA&&eL(s.recordId,a)}eI()},eb=!!eV.values.recordId,ej=2===eV.values.wip,eR=3===eV.values.status,eA=4===eV.values.status;async function ek(e){if(e){let a=await l({extension:C.r.Defaults.get,parameters:e===h.J.CurrencyPurchase?"_key=ct_cash_purchase_ratetype_id":e===h.J.CurrencySale?"_key=ct_cash_sales_ratetype_id":""});a.record?.value?er(a.record.value):ee({message:ep.rateTypeUndefined}),eV.setFieldValue("functionId",e)}}let[eD,eP]=(0,d.useState)(!1),[eT,eZ]=(0,d.useState)(!1);async function eO(e){let a=(await l({extension:A.s.CurrencyTrading.get2,parameters:`_recordId=${e}`})).record;if(a)return eV.setFieldValue("recordId",a.headerView.recordId),eV.setFieldValue("reference",a.headerView.reference),eV.setFieldValue("nationalityId",a.headerView.nationalityId),eV.setFieldValue("nationalityType",195===a.headerView.nationalityId?1:2),eV.setFieldValue("operations",a.items.map(({seqNo:e,...a})=>({id:e,...a}))),eV.setFieldValue("amount",a?.cash?.length!=0?a.cash?.map((e,a)=>({id:a+1,pos:e?.type!=3,...e})):eV.initialValues.amount),eV.setFieldValue("clientType",a.clientMaster.category),eV.setFieldValue("date",(0,I.a1)(a.headerView.date)),eV.setFieldValue("clientId",a.clientIndividual?.clientId),eV.setFieldValue("clientName",a.headerView.clientName),eV.setFieldValue("functionId",a.headerView.functionId),eV.setFieldValue("plantId",a.headerView.plantId),eV.setFieldValue("wip",a.headerView.wip),eV.setFieldValue("firstName",a.clientIndividual?.firstName),eV.setFieldValue("lastName",a.clientIndividual?.lastName),eV.setFieldValue("middleName",a.clientIndividual?.middleName),eV.setFieldValue("fl_firstName",a.clientIndividual?.fl_firstName),eV.setFieldValue("fl_lastName",a.clientIndividual?.fl_lastName),eV.setFieldValue("fl_middleName",a.clientIndividual?.fl_middleName),eV.setFieldValue("birthDate",(0,I.a1)(a?.clientIndividual?.birthDate)),eV.setFieldValue("resident",a?.clientIndividual?.isResident),eV.setFieldValue("professionId",a.clientMaster?.professionId),eV.setFieldValue("sponsorName",a.clientIndividual?.sponsorName),eV.setFieldValue("idNo",a.clientIDView.idNo),eV.setFieldValue("id_type",a.clientIDView.idtId),eV.setFieldValue("expiryDate",(0,I.a1)(a.clientIDView.idExpiryDate)),eV.setFieldValue("remarks",a.headerView.notes),eV.setFieldValue("purpose_of_exchange",a.headerView.poeId),eV.setFieldValue("nationalityId",a.clientMaster.nationalityId),eV.setFieldValue("cellPhone",a.clientMaster.cellPhone),eV.setFieldValue("status",a.headerView.status),eV.setFieldValue("cashAccountId",a.headerView.cashAccountId),eV.setFieldValue("otp",a.headerView.otpVerified),ek(a.headerView.functionId),a?.clientIndividual?.clientId}(0,d.useEffect)(()=>{!async function(){ek(eV.values.functionId),e&&await eO(e),e||eV.setFieldValue("date",new Date)}()},[]);let{userId:eS}=JSON.parse(window?.sessionStorage?.getItem("userData"));async function e$({currencyId:e}){if(e){let t=await l({extension:C.r.Defaults.get,parameters:"_key=baseCurrencyId"});return(await l({extension:g.u.ExchangeMap.get,parameters:`_plantId=${a||eV.values.plantId}&_currencyId=${e}&_rateTypeId=${ei}&_racurrencyId=${t.record.value}`})).record}}async function eq(){let e=eV.values,{record:t}=await l({extension:C.r.UserDefaults.get,parameters:`_userId=${eS}&_key=cashAccountId`}),n={recordId:e?.recordId||null,date:(0,I.ku)(e.date),reference:e.reference,nationalityId:e.nationalityId,nationalityType:e.nationalityType,status:e.status,functionId:e.functionId,plantId:a||e.plantId,clientId:e.clientId,cashAccountId:t.value,poeId:e.purpose_of_exchange,wip:e.wip,otpVerified:e.otp,amount:String(eE||"").replaceAll(",",""),notes:e.remarks},r=await i({extension:A.s.CurrencyTrading.reopen,record:JSON.stringify(n)});r.recordId&&(o.default.success(ep.Reopened),await eO(r.recordId)),eI()}let eE=eV.values.operations.reduce((e,a)=>{let t=parseFloat(a.lcAmount?.toString()?.replace(/,/g,""))||0;return e+t},0),eB=eV.values.amount.reduce((e,{amount:a})=>e+parseFloat(a?.toString()?.replace(/,/g,""))||0,0),eM=eE-eB;function eL(e,a){ea({Component:q.Z,props:{values:eV.values,recordId:e,clientId:a,functionId:eV.values.functionId,onSuccess:()=>{ew(e)}}})}async function eJ({numberId:e}){let a=await l({extension:v.u.CtClientIndividual.get2,parameters:`_numberId=${e}`});Q(!1);let t=a&&a.record;t&&(eV.setFieldValue("clientId",t.clientIndividual.clientId),eV.setFieldValue("firstName",t.clientIndividual.firstName),eV.setFieldValue("middleName",t.clientIndividual.middleName),eV.setFieldValue("lastName",t.clientIndividual.lastName),eV.setFieldValue("fl_firstName",t.clientIndividual.fl_firstName),eV.setFieldValue("fl_lastName",t.clientIndividual.fl_lastName),eV.setFieldValue("fl_middleName",t.clientIndividual.fl_middleName),eV.setFieldValue("birthDate",(0,I.a1)(t.clientIndividual.birthDate)),eV.setFieldValue("resident",t.clientIndividual.isResident),eV.setFieldValue("sponsorName",t.clientIndividual.sponsorName),eV.setFieldValue("expiryDate",(0,I.a1)(t.client.expiryDate)),eV.setFieldValue("professionId",t.client.professionId),eV.setFieldValue("nationalityId",t.client.nationalityId),eV.setFieldValue("nationalityType",195===t.client.nationalityId?1:2),eV.setFieldValue("cellPhone",t.client.cellPhone),Q(!0))}let eU=async()=>{let e=eV.values,t={recordId:e?.recordId||null,date:(0,I.ku)(e.date),reference:e.reference,nationalityId:e.nationalityId,nationalityType:e.nationalityType,status:e.status,functionId:e.functionId,plantId:a||e.plantId,clientId:e.clientId,cashAccountId:e.cashAccountId,poeId:e.purpose_of_exchange,wip:e.wip,otpVerified:e.otp,amount:String(eE||"").replaceAll(",",""),notes:e.remarks},l=await i({extension:A.s.CurrencyTrading.post,record:JSON.stringify(t)});l&&(o.default.success(ep.Posted),await eO(l.recordId),eI())},eY=[{key:"Locked",condition:!0,onClick:()=>{if(eV.values.otp)eU();else{ea({Component:J.Z,props:{values:eV.values,PlantSupervisors:!0,onClose:()=>eU()},expandable:!1,spacing:!1});return}},disabled:!eb||eR},{key:"Close",condition:!ej,onClick:ew,disabled:ej||!eb},{key:"Reopen",condition:ej,onClick:eq,disabled:!ej},{key:"OTP",condition:!0,onClick:eL,disabled:!eb||eR&&!eA},{key:"Approval",condition:!0,onClick:"onApproval",disabled:!ej},{key:"Account Balance",condition:!0,onClick:"onClickAC",disabled:!1}];return n.jsx(j.Z,{actions:eY,form:eV,initialValues:eg,setIDInfoAutoFilled:()=>{X(!1),Q(!1)},resourceId:Z.i.CashInvoice,editMode:eb,isClosed:ej,disabledSubmit:eM>0,previewReport:eb,isParentWindow:!1,maxAccess:eN,children:n.jsx(D.R,{children:n.jsx($.Q,{children:(0,n.jsxs)(r(),{container:!0,spacing:2,children:[n.jsx(r(),{item:!0,xs:12,children:n.jsx(p.Z,{title:"Transaction",children:(0,n.jsxs)(r(),{container:!0,spacing:2,children:[n.jsx(r(),{item:!0,xs:3,children:n.jsx(u.Z,{name:"reference",label:ex.reference,value:eV.values.reference,readOnly:eb,maxLength:"20",onChange:eV.handleChange,onClear:()=>eV.setFieldValue("reference",""),error:eV.touched.reference&&!!eV.errors.reference,maxAccess:eN})}),n.jsx(k.Z,{hideonempty:!0,item:!0,xs:3,children:n.jsx(c.Z,{name:"date",label:ex.date,value:eV.values?.date,required:!0,onChange:eV.setFieldValue,onClear:()=>eV.setFieldValue("date",""),readOnly:eb||ej,error:eV.touched.date&&!!eV.errors.date,helperText:eV.touched.date&&eV.errors.date,maxAccess:eN})}),n.jsx(r(),{item:!0,xs:3,children:n.jsx(f.Z,{datasetId:L.v.DOCUMENT_STATUS,name:"status",label:ex.status,valueField:"key",displayField:"value",values:eV.values,readOnly:!0,onChange:(e,a)=>{eV&&eV.setFieldValue("status",a?.key)},maxAccess:eN,error:eV.touched.status&&!!eV.errors.status})}),n.jsx(r(),{item:!0,xs:3,children:n.jsx(u.Z,{name:"search",label:ex.search,value:eV.values.search,readOnly:eb||ej,maxLength:"20",required:!0,onChange:e=>{let a=e.target.value;ec(a),a&&eo!=a&&eC({key:a})},onFocus:e=>{ec(e)},onClear:()=>eV.setFieldValue("search",""),error:eV.touched.search&&!!eV.errors.search,maxAccess:eN})}),n.jsx(r(),{item:!0,xs:3,children:n.jsx(U.Z,{options:[{label:ex.purchase,value:h.J.CurrencyPurchase},{label:ex.sale,value:h.J.CurrencySale}],value:eV.values.functionId,onChange:e=>{let a=e.target.value;ek(parseInt(a)),em(a),eV.setFieldValue("reference","")},disabledCondition:()=>eV?.values?.operations[0]?.currencyId!==""})}),n.jsx(r(),{item:!0,xs:3,children:n.jsx(f.Z,{datasetId:L.v.NATIONALITY,name:"nationalityType",label:ex.nationalityType,readOnly:eb||ej||W,valueField:"key",displayField:"value",values:eV.values,required:!0,onChange:(e,a)=>{eV&&eV.setFieldValue("nationalityType",a?.key||null)},maxAccess:eN,error:eV.touched.nationalityType&&!!eV.errors.nationalityType})}),n.jsx(r(),{item:!0,xs:6,children:n.jsx(U.Z,{options:[{label:ex.individual,value:"1"},{label:ex.corporate,value:"2",disabled:!0}],value:eV.values.clientType,onChange:e=>eV.setFieldValue("clientType",e.target.value),disabledCondition:()=>eV?.values?.operations[0]?.currencyId!==""})})]})})}),n.jsx(r(),{item:!0,xs:12,children:n.jsx(p.Z,{title:"Individual",children:(0,n.jsxs)(r(),{container:!0,spacing:2,children:[n.jsx(r(),{item:!0,xs:4,children:(0,n.jsxs)(r(),{container:!0,spacing:2,children:[n.jsx(r(),{item:!0,xs:12,children:n.jsx(u.Z,{name:"idNo",label:ex.idNo,type:eD&&eV.values.idNo?"password":"",value:eV.values.idNo,readOnly:eb||ej||W,required:eE>=5e3,maxLength:"20",onBlur:e=>{let a=e.target.value;ed(a),a&&a!==es&&(eP(!0),ey(a),eJ({numberId:a}))},onFocus:e=>{eP(!1)},onClear:()=>{eV.setFieldValue("idNo",""),ed("")},onChange:eV.handleChange,error:eV.touched.idNo&&!!eV.errors.idNo,maxAccess:eN})}),n.jsx(r(),{item:!0,xs:6,children:n.jsx(c.Z,{name:"birthDate",label:ex.birthDate,value:eV.values?.birthDate,required:eE>=5e3,onChange:eV.setFieldValue,onClear:()=>eV.setFieldValue("birthDate",""),error:eV.touched.birthDate&&!!eV.errors.birthDate,readOnly:eb||ej||W||H,maxAccess:eN})}),n.jsx(r(),{item:!0,xs:6,children:n.jsx(B.Z,{name:"birthdatehijri",label:ex.birthDateHijri,value:eV.values?.birthDate,onChange:(e,a)=>{eV.setFieldValue("birthDate",a)},readOnly:eb||ej||W||H,onClear:()=>eV.setFieldValue("birthDate","")})}),n.jsx(r(),{item:!0,xs:6,children:n.jsx(f.Z,{name:"id_type",endpointId:g.u.IdTypes.qry,label:ex.id_type,valueField:"recordId",displayField:"name",onChange:(e,a)=>{eV.setFieldValue("id_type",a?.key||null)},readOnly:eb||ej||W||H,values:eV.values,required:eE>=5e3,maxAccess:eN,error:eV.touched.id_type&&!!eV.errors.id_type})}),n.jsx(r(),{item:!0,xs:6,children:n.jsx(z.Z,{label:ex.fetch,onClick:()=>ea({Component:m.Z,props:{idTypes:et,clientformik:eV,labels:ex}}),disabled:!!(!eV?.values?.id_type||!eV?.values?.birthDate||!eV.values.idNo||eV.values?.expiryDate&&new Date(eV.values?.expiryDate)>=new Date)})}),n.jsx(r(),{item:!0,xs:6,children:n.jsx(c.Z,{name:"expiryDate",label:ex.expiryDate,value:eV.values?.expiryDate,required:eE>=5e3,onChange:eV.setFieldValue,onClear:()=>eV.setFieldValue("expiryDate",""),error:eV.touched.expiryDate&&!!eV.errors.expiryDate,readOnly:eb||ej||W||H,maxAccess:eN})})]})}),n.jsx(r(),{item:!0,xs:8,children:(0,n.jsxs)(r(),{container:!0,spacing:2,children:[n.jsx(r(),{item:!0,xs:4,children:n.jsx(u.Z,{name:"firstName",label:ex.firstName,value:eV.values.firstName,readOnly:eb||ej||W||H,required:eE>=5e3,maxLength:"20",onChange:eV.handleChange,forceUpperCase:!0,onClear:()=>eV.setFieldValue("firstName",""),error:eV.touched.firstName&&!!eV.errors.firstName,maxAccess:eN})}),n.jsx(r(),{item:!0,xs:4,children:n.jsx(u.Z,{name:"middleName",label:ex.middleName,value:eV.values.middleName,readOnly:eb||ej||W||H,maxLength:"20",onChange:eV.handleChange,forceUpperCase:!0,onClear:()=>eV.setFieldValue("middleName",""),error:eV.touched.middleName&&!!eV.errors.middleName,maxAccess:eN})}),n.jsx(r(),{item:!0,xs:4,children:n.jsx(u.Z,{name:"lastName",label:ex.lastName,value:eV.values.lastName,readOnly:eb||ej||W||H,required:eE>=5e3,maxLength:"20",onChange:eV.handleChange,forceUpperCase:!0,onClear:()=>eV.setFieldValue("lastName",""),error:eV.touched.lastName&&!!eV.errors.lastName,maxAccess:eN})}),n.jsx(r(),{item:!0,xs:12,children:(0,n.jsxs)(K.Z,{container:!0,spacing:2,children:[n.jsx(r(),{item:!0,xs:4,children:n.jsx(u.Z,{name:"fl_firstName",label:ex.fl_firstName,value:eV.values.fl_firstName,readOnly:eb||ej||W||H,dir:"rtl",language:"arabic",onChange:eV.handleChange,forceUpperCase:!0,onClear:()=>eV.setFieldValue("fl_firstName",""),error:eV.touched.fl_firstName&&!!eV.errors.fl_firstName,maxAccess:eN})}),n.jsx(r(),{item:!0,xs:4,children:n.jsx(u.Z,{name:"fl_middleName",label:ex.fl_middleName,value:eV.values.fl_middleName,readOnly:eb||ej||W||H,dir:"rtl",language:"arabic",onChange:eV.handleChange,forceUpperCase:!0,onClear:()=>eV.setFieldValue("fl_middleName",""),error:eV.touched.fl_middleName&&!!eV.errors.fl_middleName,maxAccess:eN})}),n.jsx(r(),{item:!0,xs:4,children:n.jsx(u.Z,{name:"fl_lastName",label:ex.fl_lastName,value:eV.values.fl_lastName,readOnly:eb||ej||W||H,dir:"rtl",language:"arabic",onChange:eV.handleChange,forceUpperCase:!0,onClear:()=>eV.setFieldValue("fl_lastName",""),error:eV.touched.fl_lastName&&!!eV.errors.fl_lastName,maxAccess:eN})})]})}),n.jsx(r(),{item:!0,xs:4,children:n.jsx(u.Z,{name:"cellPhone",phone:!0,label:ex.cellPhone,value:eV.values?.cellPhone,onChange:eV.handleChange,onBlur:e=>{eZ(!0)},onFocus:e=>{eZ(!1)},maxLength:"20",required:eE>=5e3,onClear:()=>eV.setFieldValue("cellPhone",""),error:eV.touched.cellPhone&&!!eV.errors.cellPhone,maxAccess:eN,readOnly:eb||ej||W})}),n.jsx(r(),{item:!0,xs:4,children:n.jsx(f.Z,{name:"nationalityId",endpointId:C.r.Country.qry,label:ex.nationalityId,valueField:"recordId",displayField:["reference","name","flName"],values:eV.values,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"},{key:"flName",value:"Foreign Language Name"}],required:eE>=5e3,onChange:(e,a)=>{eV&&eV.setFieldValue("nationalityId",a?.recordId)},maxAccess:eN,readOnly:eb||ej||W,error:eV.touched.nationalityId&&!!eV.errors.nationalityId})}),n.jsx(r(),{item:!0,xs:4,children:n.jsx(f.Z,{name:"professionId",endpointId:T.d.Profession.qry,label:ex.professionId,valueField:"recordId",displayField:["reference","name"],readOnly:eb||ej||W||H,values:eV.values,required:eE>=5e3,columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],onChange:(e,a)=>{eV&&eV.setFieldValue("professionId",a?.key)},maxAccess:eN,error:eV.touched.professionId&&!!eV.errors.professionId})}),n.jsx(r(),{item:!0,xs:6,children:n.jsx(u.Z,{name:"sponsorName",label:ex.sponsorName,value:eV.values.sponsorName,readOnly:eb||ej,maxLength:"20",onChange:eV.handleChange,forceUpperCase:!0,onClear:()=>eV.setFieldValue("sponsorName",""),error:eV.touched.sponsorName&&!!eV.errors.sponsorName,maxAccess:eN})}),n.jsx(r(),{item:!0,xs:6,children:n.jsx(u.Z,{name:"remarks",label:ex.remarks,value:eV.values.remarks,readOnly:eb||ej,maxLength:"20",onChange:eV.handleChange,forceUpperCase:!0,onClear:()=>eV.setFieldValue("remarks",""),error:eV.touched.remarks&&!!eV.errors.remarks,maxAccess:eN})}),n.jsx(r(),{item:!0,xs:4,children:n.jsx(f.Z,{name:"purpose_of_exchange",endpointId:g.u.PurposeExchange.qry,label:ex.purpose_of_exchange,valueField:"recordId",displayField:["reference","name"],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}],onChange:(e,a)=>{eV&&eV.setFieldValue("purpose_of_exchange",a?.key)},readOnly:eb||ej,values:eV.values,maxAccess:eN,error:eV.touched.purpose_of_exchange&&!!eV.errors.purpose_of_exchange})}),n.jsx(r(),{item:!0,xs:2,children:n.jsx(s.Z,{name:"resident",value:eV.values.resident,onChange:e=>eV.setFieldValue("resident",e.target.checked),label:"Resident",maxAccess:eN,disabled:eb||ej||W||H})}),n.jsx(r(),{item:!0,xs:2,children:n.jsx(s.Z,{name:"otp",value:eV.values.otp,onChange:e=>eV.setFieldValue("otp",e.target.checked),label:"Otp",maxAccess:eN,disabled:!0})})]})})]})})}),n.jsx(r(),{item:!0,xs:12,children:n.jsx(p.Z,{title:"Operations",children:n.jsx(R._,{onChange:e=>eV.setFieldValue("operations",e),value:eV.values.operations,error:!(e_.length<1)||eV.errors.operations,initialValues:eV?.initialValues?.operations?.[0],height:175,disabled:ej,maxAccess:eN,allowDelete:!eb,name:"operations",bg:eV.values.functionId&&(parseInt(eV.values.functionId)===h.J.CurrencySale?"#C7F6C7":"rgb(245, 194, 193)"),columns:[{component:"resourcecombobox",label:ex.currency,name:"currencyId",props:{endpointId:C.r.Currency.qry,displayField:["reference","name"],valueField:"recordId",mapping:[{from:"recordId",to:"currencyId"},{from:"name",to:"currencyName"},{from:"reference",to:"currencyRef"}],columnsInDropDown:[{key:"reference",value:"Reference"},{key:"name",value:"Name"}]},async onChange({row:{update:e,oldRow:a,newRow:t}}){if(!t?.currencyId){e({currencyId:"",currencyName:"",currencyRef:"",exRate:"",defaultRate:"",rateCalcMethod:"",minRate:"",maxRate:""});return}let l=await e$({currencyId:t?.currencyId});if(!l?.rate){e({exRate:"",defaultRate:"",rateCalcMethod:"",minRate:"",maxRate:""}),ee({message:`Rate not defined for ${t.currencyName}.`});return}if(l&&t.fcAmount){let a=l.rate,n=l.rateCalcMethod,i=1===n?t.fcAmount*a:2===n?t.fcAmount/a:0;isNaN(i)||e({lcAmount:i})}e({currencyId:t.currencyId,exRate:l?.rate,defaultRate:l?.rate,rateCalcMethod:l?.rateCalcMethod,minRate:l?.minRate,maxRate:l?.maxRate})},flex:1.5},{component:"numberfield",label:ex.fcAmount,name:"fcAmount",async onChange({row:{update:e,newRow:a}}){let t=a.fcAmount,l=a.rateCalcMethod,n=a.exRate,i=1===l?t*n:2===l?t/n:0;isNaN(i)||e({lcAmount:i?.toFixed(2)})}},{component:"numberfield",label:ex.defaultRate,name:"defaultRate",props:{readOnly:!0}},{component:"numberfield",name:"exRate",label:ex.Rate,props:{readOnly:!1},updateOn:"blur",async onChange({row:{update:e,newRow:a}}){let t=a.fcAmount,l=a.lcAmount,n=a.rateCalcMethod,i=a.exRate;if(i){if(i>=a.minRate&&i<=a.maxRate){if(t){let a=1===n?t*i:2===n?t/i:0;isNaN(a)||e({lcAmount:a.toFixed(2)})}else if(l){let a=2===n?l*i:1===n?l/i:0;isNaN(a)||e({fcAmount:a.toFixed(2)})}else e({exRate:a?.exRate})}else{ee({message:`Rate not in the [${a.minRate}-${a.maxRate}]range.`}),e({exRate:""});return}}}},{component:"numberfield",name:"lcAmount",label:ex.lcAmount,props:{readOnly:!1},async onChange({row:{update:e,newRow:a}}){let t=a.lcAmount,l=a.rateCalcMethod,n=a.exRate,i=2===l?t*n:1===l?t/n:0;i&&a.exRate&&e({fcAmount:i.toFixed(2)})}}]})})}),n.jsx(r(),{item:!0,xs:12,children:n.jsx(p.Z,{title:"Amount",children:(0,n.jsxs)(r(),{container:!0,spacing:2,children:[n.jsx(r(),{item:!0,xs:9,children:n.jsx(M.Z,{height:175,onChange:e=>eV.setFieldValue("amount",e),value:eV.values.amount,error:eV.errors.amount,name:"amount",setFormik:ef,data:{recordId:eV.values?.recordId,reference:eV.values?.reference,clientName:eV.values?.clientName,viewPosButtons:2===eV.values.wip},amount:eE,disabled:eb||ej})},eV.values.amount?.length),n.jsx(r(),{item:!0,xs:3,children:(0,n.jsxs)(r(),{container:!0,spacing:2,children:[n.jsx(r(),{item:!0,xs:12,children:n.jsx(P.Z,{label:ex.netAmount,value:eE,readOnly:!0})}),n.jsx(r(),{item:!0,xs:12,children:n.jsx(P.Z,{label:ex.amountReceived,value:eB,readOnly:!0})}),n.jsx(r(),{item:!0,xs:12,children:n.jsx(P.Z,{format:e=>0===e?"0.00":e,label:ex.balanceToPay,value:eM,readOnly:!0})})]})})]})})})]})})})})};Q.width=1200,Q.height=600;let W=Q;l()}catch(e){l(e)}})},12127:(e,a,t)=>{"use strict";t.a(e,async(e,l)=>{try{t.d(a,{Z:()=>g});var n=t(20997),i=t(16689),r=t(87316),s=t.n(r),d=t(31059),o=t.n(d),c=t(86201),u=t(99648),m=t(644),p=t(70305),h=t(60520),f=t(26176),y=t(29352),I=t(96119),x=e([c,u,m,p,h,y]);[c,u,m,p,h,y]=x.then?(await x)():x;let v=({loggedUser:e,onClose:a,window:t,PlantSupervisors:l=!1,values:r})=>{let[d,x]=(0,i.useState)(["","","","","",""]),[v,g]=(0,i.useState)(""),[N,C]=(0,i.useState)(0),{apiUrl:V,languageId:F}=(0,m.a)(),{platformLabels:_}=(0,i.useContext)(h.l),{postRequest:w}=(0,i.useContext)(y.$),b=(0,p.V)();async function j(e){b&&await b.stack(e)}(0,I.Z)({title:_.OTPVerification,window:t});let R=l=>{if(l.length>1){let i=e.accessToken;var n=new FormData;n.append("record",JSON.stringify({otp:l})),(0,u.default)({method:"POST",url:V+f.y.checkOTP,headers:{Authorization:"Bearer "+i,"Content-Type":"multipart/form-data",LanguageId:F},data:n}).then(e=>{c.default.success(_.verificationCompleted),t.close(),a()}).catch(e=>{j({message:e,height:e.response?.status===404||e.response?.status===500?400:""})})}else g(_.AllFieldsRequired)},A=async e=>{if(e.length>1){var l={plantId:r.plantId,otp:e};await w({extension:f.y.PlantSupervisors.verify,record:JSON.stringify(l)}).then(e=>{c.default.success(_.verificationCompleted),t.close(),a()})}else g(_.AllFieldsRequired)},k=(e,a)=>{document.getElementById(`otp-input-${e}`).select();let t=a.target.value,l=[...d];isNaN(t)||""===t?"deleteContentBackward"===a.nativeEvent.inputType?(l[e]="",x(l),e>0&&""!==document.getElementById(`otp-input-${e-1}`).value&&document.getElementById(`otp-input-${e}`).focus()):""!==t&&""!==document.getElementById(`otp-input-${e}`).value&&(document.getElementById(`otp-input-${e}`).select(),l[e]=t,x(l)):(l[e]=t,x(l),e<d.length-1&&""!==t?(document.getElementById(`otp-input-${e+1}`).focus(),document.getElementById(`otp-input-${e+1}`).select()):e===d.length-1&&l.every(e=>""!==e)&&P(l))};(0,i.useEffect)(()=>{(function(){C(0);var e=0;d.map((a,t)=>""!==a&&e++),e>5&&C(e)})()},[d]);let D=(e,a)=>{let t=a.target.value;"ArrowRight"==a.key&&e<6?(document.getElementById(`otp-input-${e+1}`)?.focus(),document.getElementById(`otp-input-${e+1}`)?.select()):"ArrowLeft"==a.key&&e>0?(document.getElementById(`otp-input-${e-1}`)?.focus(),document.getElementById(`otp-input-${e-1}`)?.select()):t===document.getElementById(`otp-input-${e}`).value&&document.getElementById(`otp-input-${e}`)?.select()},P=e=>{let a=e?e.join(""):d.join("");l?A(a):R(a)};return(0,i.useEffect)(()=>{let e=setTimeout(()=>{let e=document.getElementById("otp-input-0");e&&(e.focus(),e.select())},0);return()=>clearTimeout(e)},[]),n.jsx("div",{width:500,height:300,onClose:a,children:(0,n.jsxs)(s(),{className:o().phoneVerificationContainer,children:[n.jsx("p",{children:_.TwoFactorAuthentication}),n.jsx(s(),{className:o().otpInputContainer,children:d.map((e,a)=>n.jsx("input",{className:o().inputText,type:"text",id:`otp-input-${a}`,maxLength:"1",onKeyUp:e=>D(a,e),value:e,onChange:e=>k(a,e)},a))}),n.jsx("button",{className:o().verifyButton,onClick:P,disabled:N<5,children:_.verifyOTP}),v&&n.jsx("p",{className:o().errorMessage,children:v})]})})};v.width=400,v.height=400;let g=v;l()}catch(e){l(e)}})}};